diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/config/file_contexts.subs_dist refpolicy/config/file_contexts.subs_dist
--- refpolicy/config/file_contexts.subs_dist	2012-03-30 14:48:20.000000000 +0200
+++ refpolicy/config/file_contexts.subs_dist	2012-08-15 10:07:50.028520056 +0200
@@ -1,7 +1,11 @@
+/etc/init.d /etc/rc.d/init.d
 /lib32 /lib
 /lib64 /lib
 /run /var/run
 /run/lock /var/lock
 /usr/lib32 /usr/lib
 /usr/lib64 /usr/lib
+/usr/local/lib64 /usr/lib
+/usr/local/lib32 /usr/lib
+/usr/local/lib/ /usr/lib/
 /var/run/lock /var/lock
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/admin/bootloader.if refpolicy/policy/modules/admin/bootloader.if
--- refpolicy/policy/modules/admin/bootloader.if	2012-05-04 15:14:47.000000000 +0200
+++ refpolicy/policy/modules/admin/bootloader.if	2012-10-10 21:49:27.990028145 +0200
@@ -47,6 +47,25 @@
 
 ########################################
 ## <summary>
+##	Execute bootloader in the caller domain.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`bootloader_exec',`
+	gen_require(`
+		type bootloader_exec_t;
+	')
+
+	corecmd_search_bin($1)
+	can_exec($1, bootloader_exec_t)
+')
+
+########################################
+## <summary>
 ##	Read the bootloader configuration file.
 ## </summary>
 ## <param name="domain">
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/admin/bootloader.te refpolicy/policy/modules/admin/bootloader.te
--- refpolicy/policy/modules/admin/bootloader.te	2012-05-04 15:14:47.000000000 +0200
+++ refpolicy/policy/modules/admin/bootloader.te	2012-10-10 21:49:41.619027212 +0200
@@ -1,4 +1,4 @@
-policy_module(bootloader, 1.13.0)
+policy_module(bootloader, 1.13.1)
 
 ########################################
 #
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/admin/dmesg.te refpolicy/policy/modules/admin/dmesg.te
--- refpolicy/policy/modules/admin/dmesg.te	2012-05-04 15:14:47.000000000 +0200
+++ refpolicy/policy/modules/admin/dmesg.te	2012-07-17 17:30:25.567244653 +0200
@@ -27,6 +27,7 @@
 kernel_read_proc_symlinks(dmesg_t)
 
 dev_read_sysfs(dmesg_t)
+dev_dontaudit_rw_generic_chr_files(dmesg_t) # early access when /dev/console isn't relabeled by udev yet
 
 fs_search_auto_mountpoints(dmesg_t)
 
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/admin/netutils.te refpolicy/policy/modules/admin/netutils.te
--- refpolicy/policy/modules/admin/netutils.te	2012-05-04 15:14:47.000000000 +0200
+++ refpolicy/policy/modules/admin/netutils.te	2012-10-30 21:17:53.610413062 +0100
@@ -1,4 +1,4 @@
-policy_module(netutils, 1.11.0)
+policy_module(netutils, 1.11.1)
 
 ########################################
 #
@@ -35,7 +35,7 @@
 # Perform network administration operations and have raw access to the network.
 allow netutils_t self:capability { net_admin net_raw setuid setgid };
 dontaudit netutils_t self:capability sys_tty_config;
-allow netutils_t self:process signal_perms;
+allow netutils_t self:process { setcap signal_perms };
 allow netutils_t self:netlink_route_socket create_netlink_socket_perms;
 allow netutils_t self:packet_socket create_socket_perms;
 allow netutils_t self:udp_socket create_socket_perms;
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/admin/su.if refpolicy/policy/modules/admin/su.if
--- refpolicy/policy/modules/admin/su.if	2012-05-04 15:16:38.000000000 +0200
+++ refpolicy/policy/modules/admin/su.if	2012-04-21 20:07:09.717210979 +0200
@@ -73,6 +73,7 @@
 
 	# for the rootok check
 	selinux_compute_access_vector($1_su_t)
+	selinux_get_fs_mount($1_su_t)
 
 	auth_domtrans_chk_passwd($1_su_t)
 	auth_dontaudit_read_shadow($1_su_t)
@@ -205,6 +206,7 @@
 
 	# needed for pam_rootok
 	selinux_compute_access_vector($1_su_t)
+	selinux_get_fs_mount($1_su_t)
 
 	auth_domtrans_chk_passwd($1_su_t)
 	auth_dontaudit_read_shadow($1_su_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/abrt.fc refpolicy/policy/modules/contrib/abrt.fc
--- refpolicy/policy/modules/contrib/abrt.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/abrt.fc	2012-09-27 20:03:30.720126498 +0200
@@ -1,20 +1,30 @@
-/etc/abrt(/.*)?				gen_context(system_u:object_r:abrt_etc_t,s0)
-/etc/rc\.d/init\.d/abrt		--	gen_context(system_u:object_r:abrt_initrc_exec_t,s0)
+/etc/abrt(/.*)?	gen_context(system_u:object_r:abrt_etc_t,s0)
+/etc/rc\.d/init\.d/abrt	--	gen_context(system_u:object_r:abrt_initrc_exec_t,s0)
 
-/usr/bin/abrt-pyhook-helper 	--	gen_context(system_u:object_r:abrt_helper_exec_t,s0)
-
-/usr/libexec/abrt-pyhook-helper --	gen_context(system_u:object_r:abrt_helper_exec_t,s0)
-/usr/libexec/abrt-hook-python 	--	gen_context(system_u:object_r:abrt_helper_exec_t,s0)
-
-/usr/sbin/abrtd			--	gen_context(system_u:object_r:abrt_exec_t,s0)
-
-/var/cache/abrt(/.*)?			gen_context(system_u:object_r:abrt_var_cache_t,s0)
-/var/cache/abrt-di(/.*)?		gen_context(system_u:object_r:abrt_var_cache_t,s0)
-
-/var/log/abrt-logger		--	gen_context(system_u:object_r:abrt_var_log_t,s0)
-
-/var/run/abrt\.pid		--	gen_context(system_u:object_r:abrt_var_run_t,s0)
-/var/run/abrtd?\.lock		--	gen_context(system_u:object_r:abrt_var_run_t,s0)
-/var/run/abrt(/.*)?			gen_context(system_u:object_r:abrt_var_run_t,s0)
-
-/var/spool/abrt(/.*)?			gen_context(system_u:object_r:abrt_var_cache_t,s0)
+/usr/bin/abrt-pyhook-helper	--	gen_context(system_u:object_r:abrt_helper_exec_t,s0)
+/usr/bin/abrt-retrace-worker	--	gen_context(system_u:object_r:abrt_retrace_worker_exec_t,s0)
+/usr/bin/coredump2packages	--	gen_context(system_u:object_r:abrt_retrace_coredump_exec_t,s0)
+/usr/bin/retrace-server-worker	--	gen_context(system_u:object_r:abrt_retrace_worker_exec_t,s0)
+
+/usr/libexec/abrt-pyhook-helper	--	gen_context(system_u:object_r:abrt_helper_exec_t,s0)
+/usr/libexec/abrt-handle-event	--	gen_context(system_u:object_r:abrt_handle_event_exec_t,s0)
+/usr/libexec/abrt-hook-python	--	gen_context(system_u:object_r:abrt_helper_exec_t,s0)
+
+/usr/sbin/abrtd	--	gen_context(system_u:object_r:abrt_exec_t,s0)
+/usr/sbin/abrt-dbus	--	gen_context(system_u:object_r:abrt_exec_t,s0)
+
+/var/cache/abrt(/.*)?	gen_context(system_u:object_r:abrt_var_cache_t,s0)
+/var/cache/abrt-di(/.*)?	gen_context(system_u:object_r:abrt_var_cache_t,s0)
+/var/cache/abrt-retrace(/.*)?	gen_context(system_u:object_r:abrt_retrace_cache_t,s0)
+/var/cache/retrace-server(/.*)?	gen_context(system_u:object_r:abrt_retrace_cache_t,s0)
+
+/var/log/abrt-logger	--	gen_context(system_u:object_r:abrt_var_log_t,s0)
+
+/var/run/abrt\.pid	--	gen_context(system_u:object_r:abrt_var_run_t,s0)
+/var/run/abrtd?\.lock	--	gen_context(system_u:object_r:abrt_var_run_t,s0)
+/var/run/abrtd?\.socket	--	gen_context(system_u:object_r:abrt_var_run_t,s0)
+/var/run/abrt(/.*)?	gen_context(system_u:object_r:abrt_var_run_t,s0)
+
+/var/spool/abrt(/.*)?	gen_context(system_u:object_r:abrt_var_cache_t,s0)
+/var/spool/abrt-retrace(/.*)?	gen_context(system_u:object_r:abrt_retrace_spool_t,s0)
+/var/spool/retrace-server(/.*)?	gen_context(system_u:object_r:abrt_retrace_spool_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/abrt.if refpolicy/policy/modules/contrib/abrt.if
--- refpolicy/policy/modules/contrib/abrt.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/abrt.if	2012-10-28 18:59:00.807026443 +0100
@@ -1,4 +1,4 @@
-## <summary>ABRT - automated bug-reporting tool</summary>
+## <summary>Automated bug-reporting tool.</summary>
 
 ######################################
 ## <summary>
@@ -40,7 +40,7 @@
 
 ########################################
 ## <summary>
-##	Send a null signal to abrt.
+##	Send null signals to abrt.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -58,7 +58,7 @@
 
 ########################################
 ## <summary>
-##	Allow the domain to read abrt state files in /proc.
+##	Read process state of abrt.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -116,7 +116,8 @@
 
 #####################################
 ## <summary>
-##	Execute abrt-helper in the abrt-helper domain.
+##	Execute abrt-helper in the abrt
+##	helper domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -129,13 +130,15 @@
 		type abrt_helper_t, abrt_helper_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, abrt_helper_exec_t, abrt_helper_t)
 ')
 
 ########################################
 ## <summary>
-##	Execute abrt helper in the abrt_helper domain, and
-##	allow the specified role the abrt_helper domain.
+##	Execute abrt helper in the abrt
+##	helper domain, and allow the
+##	specified role the abrt helper domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -151,17 +154,17 @@
 #
 interface(`abrt_run_helper',`
 	gen_require(`
-		type abrt_helper_t;
+		attribute_role abrt_helper_roles;
 	')
 
 	abrt_domtrans_helper($1)
-	role $2 types abrt_helper_t;
+	roleattribute $2 abrt_helper_roles;
 ')
 
 ########################################
 ## <summary>
-##	Send and receive messages from
-##	abrt over dbus.
+##	Create, read, write, and delete
+##	abrt cache files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -170,16 +173,35 @@
 ## </param>
 #
 interface(`abrt_cache_manage',`
+	refpolicywarn(`$0($*) has been deprecated, use abrt_manage_cache() instead.')
+	abrt_manage_cache($1)
+')
+
+########################################
+## <summary>
+##	Create, read, write, and delete
+##	abrt cache content.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`abrt_manage_cache',`
 	gen_require(`
 		type abrt_var_cache_t;
 	')
 
+	files_search_var($1)
 	manage_files_pattern($1, abrt_var_cache_t, abrt_var_cache_t)
+	manage_lnk_files_pattern($1, abrt_var_cache_t, abrt_var_cache_t)
+	manage_dirs_pattern($1, abrt_var_cache_t, abrt_var_cache_t)
 ')
 
 ####################################
 ## <summary>
-##	Read abrt configuration file.
+##	Read abrt configuration files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -198,7 +220,7 @@
 
 ######################################
 ## <summary>
-##	Read abrt logs.
+##	Read abrt log files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -236,7 +258,8 @@
 
 ######################################
 ## <summary>
-##	Create, read, write, and delete abrt PID files.
+##	Create, read, write, and delete
+##	abrt PID files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -255,8 +278,8 @@
 
 #####################################
 ## <summary>
-##	All of the rules required to administrate
-##	an abrt environment
+##	All of the rules required to
+##	administrate an abrt environment,
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -265,21 +288,21 @@
 ## </param>
 ## <param name="role">
 ##	<summary>
-##	The role to be allowed to manage the abrt domain.
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <rolecap/>
 #
 interface(`abrt_admin',`
 	gen_require(`
-		type abrt_t, abrt_etc_t;
-		type abrt_var_cache_t, abrt_var_log_t;
-		type abrt_var_run_t, abrt_tmp_t;
-		type abrt_initrc_exec_t;
+		attribute abrt_domain;
+		type abrt_t, abrt_etc_t, abrt_initrc_exec_t;
+		type abrt_var_cache_t, abrt_var_log_t, abrt_retrace_cache_t;
+		type abrt_var_run_t, abrt_tmp_t, abrt_retrace_spool_t;
 	')
 
-	allow $1 abrt_t:process { ptrace signal_perms };
-	ps_process_pattern($1, abrt_t)
+	allow $1 abrt_domain:process { ptrace signal_perms };
+	ps_process_pattern($1, abrt_domain)
 
 	init_labeled_script_domtrans($1, abrt_initrc_exec_t)
 	domain_system_change_exemption($1)
@@ -293,7 +316,7 @@
 	admin_pattern($1, abrt_var_log_t)
 
 	files_search_var($1)
-	admin_pattern($1, abrt_var_cache_t)
+	admin_pattern($1, { abrt_retrace_cache_t abrt_var_cache_t abrt_retrace_spool_t })
 
 	files_search_pids($1)
 	admin_pattern($1, abrt_var_run_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/abrt.te refpolicy/policy/modules/contrib/abrt.te
--- refpolicy/policy/modules/contrib/abrt.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/abrt.te	2012-10-28 18:59:00.807026443 +0100
@@ -1,43 +1,91 @@
-policy_module(abrt, 1.2.0)
+policy_module(abrt, 1.3.2)
 
 ########################################
 #
 # Declarations
 #
 
-type abrt_t;
+## <desc>
+##	<p>
+##	Determine whether ABRT can modify
+##	public files used for public file
+##	transfer services.
+##	</p>
+## </desc>
+gen_tunable(abrt_anon_write, false)
+
+## <desc>
+##	<p>
+##	Determine whether ABRT can run in
+##	the abrt_handle_event_t domain to
+##	handle ABRT event scripts.
+##	</p>
+## </desc>
+gen_tunable(abrt_handle_event, false)
+
+attribute abrt_domain;
+
+attribute_role abrt_helper_roles;
+roleattribute system_r abrt_helper_roles;
+
+type abrt_t, abrt_domain;
 type abrt_exec_t;
 init_daemon_domain(abrt_t, abrt_exec_t)
 
 type abrt_initrc_exec_t;
 init_script_file(abrt_initrc_exec_t)
 
-# etc files
 type abrt_etc_t;
 files_config_file(abrt_etc_t)
 
-# log files
 type abrt_var_log_t;
 logging_log_file(abrt_var_log_t)
 
-# tmp files
 type abrt_tmp_t;
 files_tmp_file(abrt_tmp_t)
 
-# var/cache files
 type abrt_var_cache_t;
 files_type(abrt_var_cache_t)
 
-# pid files
 type abrt_var_run_t;
 files_pid_file(abrt_var_run_t)
 
-# type needed to allow all domains
-# to handle /var/cache/abrt
-type abrt_helper_t;
+type abrt_dump_oops_t, abrt_domain;
+type abrt_dump_oops_exec_t;
+init_system_domain(abrt_dump_oops_t, abrt_dump_oops_exec_t)
+
+type abrt_handle_event_t, abrt_domain;
+type abrt_handle_event_exec_t;
+domain_type(abrt_handle_event_t)
+domain_entry_file(abrt_handle_event_t, abrt_handle_event_exec_t)
+role system_r types abrt_handle_event_t;
+
+type abrt_helper_t, abrt_domain;
 type abrt_helper_exec_t;
 application_domain(abrt_helper_t, abrt_helper_exec_t)
-role system_r types abrt_helper_t;
+role abrt_helper_roles types abrt_helper_t;
+
+type abrt_retrace_coredump_t, abrt_domain;
+type abrt_retrace_coredump_exec_t;
+domain_type(abrt_retrace_coredump_t)
+domain_entry_file(abrt_retrace_coredump_t, abrt_retrace_coredump_exec_t)
+role system_r types abrt_retrace_coredump_t;
+
+type abrt_retrace_worker_t, abrt_domain;
+type abrt_retrace_worker_exec_t;
+domain_type(abrt_retrace_worker_t)
+domain_entry_file(abrt_retrace_worker_t, abrt_retrace_worker_exec_t)
+role system_r types abrt_retrace_worker_t;
+
+type abrt_retrace_cache_t;
+files_type(abrt_retrace_cache_t)
+
+type abrt_retrace_spool_t;
+files_type(abrt_retrace_spool_t)
+
+type abrt_watch_log_t, abrt_domain;
+type abrt_watch_log_exec_t;
+init_daemon_domain(abrt_watch_log_t, abrt_watch_log_exec_t)
 
 ifdef(`enable_mcs',`
 	init_ranged_daemon_domain(abrt_t, abrt_exec_t, s0 - mcs_systemhigh)
@@ -45,47 +93,43 @@
 
 ########################################
 #
-# abrt local policy
+# Local policy
 #
 
-allow abrt_t self:capability { chown kill setuid setgid sys_nice dac_override };
+allow abrt_t self:capability { chown dac_override fowner fsetid kill setgid setuid sys_nice };
 dontaudit abrt_t self:capability sys_rawio;
-allow abrt_t self:process { signal signull setsched getsched };
-
+allow abrt_t self:process { setpgid sigkill signal signull setsched getsched };
 allow abrt_t self:fifo_file rw_fifo_file_perms;
-allow abrt_t self:tcp_socket create_stream_socket_perms;
-allow abrt_t self:udp_socket create_socket_perms;
-allow abrt_t self:unix_dgram_socket create_socket_perms;
-allow abrt_t self:netlink_route_socket r_netlink_socket_perms;
+allow abrt_t self:tcp_socket { accept listen };
 
-# abrt etc files
+allow abrt_t abrt_etc_t:dir list_dir_perms;
 rw_files_pattern(abrt_t, abrt_etc_t, abrt_etc_t)
 
-# log file
 manage_files_pattern(abrt_t, abrt_var_log_t, abrt_var_log_t)
 logging_log_filetrans(abrt_t, abrt_var_log_t, file)
 
-# abrt tmp files
 manage_dirs_pattern(abrt_t, abrt_tmp_t, abrt_tmp_t)
 manage_files_pattern(abrt_t, abrt_tmp_t, abrt_tmp_t)
+manage_lnk_files_pattern(abrt_t, abrt_tmp_t, abrt_tmp_t)
 files_tmp_filetrans(abrt_t, abrt_tmp_t, { file dir })
 
-# abrt var/cache files
 manage_files_pattern(abrt_t, abrt_var_cache_t, abrt_var_cache_t)
 manage_dirs_pattern(abrt_t, abrt_var_cache_t, abrt_var_cache_t)
 manage_lnk_files_pattern(abrt_t, abrt_var_cache_t, abrt_var_cache_t)
 files_var_filetrans(abrt_t, abrt_var_cache_t, { file dir })
 files_spool_filetrans(abrt_t, abrt_var_cache_t, dir)
 
-# abrt pid files
 manage_files_pattern(abrt_t, abrt_var_run_t, abrt_var_run_t)
 manage_dirs_pattern(abrt_t, abrt_var_run_t, abrt_var_run_t)
 manage_sock_files_pattern(abrt_t, abrt_var_run_t, abrt_var_run_t)
 manage_lnk_files_pattern(abrt_t, abrt_var_run_t, abrt_var_run_t)
-files_pid_filetrans(abrt_t, abrt_var_run_t, { file dir })
+files_pid_filetrans(abrt_t, abrt_var_run_t, { file dir sock_file })
+
+can_exec(abrt_t, abrt_tmp_t)
 
 kernel_read_ring_buffer(abrt_t)
 kernel_read_system_state(abrt_t)
+kernel_request_load_module(abrt_t)
 kernel_rw_kernel_sysctl(abrt_t)
 
 corecmd_exec_bin(abrt_t)
@@ -96,14 +140,17 @@
 corenet_all_recvfrom_unlabeled(abrt_t)
 corenet_tcp_sendrecv_generic_if(abrt_t)
 corenet_tcp_sendrecv_generic_node(abrt_t)
-corenet_tcp_sendrecv_generic_port(abrt_t)
+corenet_tcp_sendrecv_all_ports(abrt_t)
 corenet_tcp_bind_generic_node(abrt_t)
+
+corenet_sendrecv_all_client_packets(abrt_t)
 corenet_tcp_connect_http_port(abrt_t)
 corenet_tcp_connect_ftp_port(abrt_t)
 corenet_tcp_connect_all_ports(abrt_t)
-corenet_sendrecv_http_client_packets(abrt_t)
 
 dev_getattr_all_chr_files(abrt_t)
+dev_getattr_all_blk_files(abrt_t)
+dev_read_rand(abrt_t)
 dev_read_urand(abrt_t)
 dev_rw_sysfs(abrt_t)
 dev_dontaudit_read_raw_memory(abrt_t)
@@ -113,44 +160,55 @@
 domain_signull_all_domains(abrt_t)
 
 files_getattr_all_files(abrt_t)
-files_read_etc_files(abrt_t)
+files_read_config_files(abrt_t)
+files_read_etc_runtime_files(abrt_t)
 files_read_var_symlinks(abrt_t)
-files_read_var_lib_files(abrt_t)
 files_read_usr_files(abrt_t)
-files_read_generic_tmp_files(abrt_t)
 files_read_kernel_modules(abrt_t)
-files_dontaudit_list_default(abrt_t)
 files_dontaudit_read_default_files(abrt_t)
+files_dontaudit_read_all_symlinks(abrt_t)
+files_dontaudit_getattr_all_sockets(abrt_t)
+files_list_mnt(abrt_t)
 
-fs_list_inotifyfs(abrt_t)
 fs_getattr_all_fs(abrt_t)
 fs_getattr_all_dirs(abrt_t)
+fs_list_inotifyfs(abrt_t)
 fs_read_fusefs_files(abrt_t)
 fs_read_noxattr_fs_files(abrt_t)
 fs_read_nfs_files(abrt_t)
 fs_read_nfs_symlinks(abrt_t)
 fs_search_all(abrt_t)
 
-sysnet_read_config(abrt_t)
+auth_use_nsswitch(abrt_t)
 
 logging_read_generic_logs(abrt_t)
-logging_send_syslog_msg(abrt_t)
 
-miscfiles_read_generic_certs(abrt_t)
-miscfiles_read_localization(abrt_t)
+miscfiles_read_public_files(abrt_t)
 
 userdom_dontaudit_read_user_home_content_files(abrt_t)
 
+tunable_policy(`abrt_anon_write',`
+	miscfiles_manage_public_files(abrt_t)
+')
+
+optional_policy(`
+	apache_list_modules(abrt_t)
+	apache_read_module_files(abrt_t)
+')
+
 optional_policy(`
 	dbus_system_domain(abrt_t, abrt_exec_t)
+
+	optional_policy(`
+		policykit_dbus_chat(abrt_t)
+	')
 ')
 
 optional_policy(`
-	nis_use_ypbind(abrt_t)
+	dmesg_domtrans(abrt_t)
 ')
 
 optional_policy(`
-	policykit_dbus_chat(abrt_t)
 	policykit_domtrans_auth(abrt_t)
 	policykit_read_lib(abrt_t)
 	policykit_read_reload(abrt_t)
@@ -162,28 +220,42 @@
 	corecmd_exec_all_executables(abrt_t)
 ')
 
-# to install debuginfo packages
 optional_policy(`
 	rpm_exec(abrt_t)
 	rpm_dontaudit_manage_db(abrt_t)
 	rpm_manage_cache(abrt_t)
+	rpm_manage_log(abrt_t)
 	rpm_manage_pid_files(abrt_t)
 	rpm_read_db(abrt_t)
 	rpm_signull(abrt_t)
 ')
 
-# to run mailx plugin
 optional_policy(`
 	sendmail_domtrans(abrt_t)
 ')
 
 optional_policy(`
-	sssd_stream_connect(abrt_t)
+	sosreport_domtrans(abrt_t)
+	sosreport_read_tmp_files(abrt_t)
+	sosreport_delete_tmp_files(abrt_t)
+')
+
+#######################################
+#
+# Handle-event local policy
+#
+
+allow abrt_handle_event_t self:fifo_file rw_fifo_file_perms;
+
+tunable_policy(`abrt_handle_event',`
+	domtrans_pattern(abrt_t, abrt_handle_event_exec_t, abrt_handle_event_t)
+',`
+	can_exec(abrt_t, abrt_handle_event_exec_t)
 ')
 
 ########################################
 #
-# abrt--helper local policy
+# Helper local policy
 #
 
 allow abrt_helper_t self:capability { chown setgid sys_nice };
@@ -200,23 +272,19 @@
 read_files_pattern(abrt_helper_t, abrt_var_run_t, abrt_var_run_t)
 read_lnk_files_pattern(abrt_helper_t, abrt_var_run_t, abrt_var_run_t)
 
-domain_read_all_domains_state(abrt_helper_t)
+corecmd_read_all_executables(abrt_helper_t)
 
-files_read_etc_files(abrt_helper_t)
+domain_read_all_domains_state(abrt_helper_t)
 
 fs_list_inotifyfs(abrt_helper_t)
 fs_getattr_all_fs(abrt_helper_t)
 
 auth_use_nsswitch(abrt_helper_t)
 
-logging_send_syslog_msg(abrt_helper_t)
-
-miscfiles_read_localization(abrt_helper_t)
-
 term_dontaudit_use_all_ttys(abrt_helper_t)
 term_dontaudit_use_all_ptys(abrt_helper_t)
 
-ifdef(`hide_broken_symptoms', `
+ifdef(`hide_broken_symptoms',`
 	userdom_dontaudit_read_user_home_content_files(abrt_helper_t)
 	userdom_dontaudit_read_user_tmp_files(abrt_helper_t)
 	dev_dontaudit_read_all_blk_files(abrt_helper_t)
@@ -225,3 +293,121 @@
 	dev_dontaudit_write_all_blk_files(abrt_helper_t)
 	fs_dontaudit_rw_anon_inodefs_files(abrt_helper_t)
 ')
+
+#######################################
+#
+# Retrace coredump policy
+#
+
+allow abrt_retrace_coredump_t self:fifo_file rw_fifo_file_perms;
+
+list_dirs_pattern(abrt_retrace_coredump_t, abrt_retrace_cache_t, abrt_retrace_cache_t)
+read_files_pattern(abrt_retrace_coredump_t, abrt_retrace_cache_t, abrt_retrace_cache_t)
+read_lnk_files_pattern(abrt_retrace_coredump_t, abrt_retrace_cache_t, abrt_retrace_cache_t)
+
+list_dirs_pattern(abrt_retrace_coredump_t, abrt_retrace_spool_t, abrt_retrace_spool_t)
+read_files_pattern(abrt_retrace_coredump_t, abrt_retrace_spool_t, abrt_retrace_spool_t)
+read_lnk_files_pattern(abrt_retrace_coredump_t, abrt_retrace_spool_t, abrt_retrace_spool_t)
+
+corecmd_exec_bin(abrt_retrace_coredump_t)
+corecmd_exec_shell(abrt_retrace_coredump_t)
+
+dev_read_urand(abrt_retrace_coredump_t)
+
+files_read_usr_files(abrt_retrace_coredump_t)
+
+sysnet_dns_name_resolve(abrt_retrace_coredump_t)
+
+optional_policy(`
+	rpm_exec(abrt_retrace_coredump_t)
+	rpm_dontaudit_manage_db(abrt_retrace_coredump_t)
+	rpm_manage_cache(abrt_retrace_coredump_t)
+	rpm_manage_log(abrt_retrace_coredump_t)
+	rpm_manage_pid_files(abrt_retrace_coredump_t)
+	rpm_read_db(abrt_retrace_coredump_t)
+	rpm_signull(abrt_retrace_coredump_t)
+')
+
+#######################################
+#
+# Retrace worker policy
+#
+
+allow abrt_retrace_worker_t self:capability setuid;
+allow abrt_retrace_worker_t self:fifo_file rw_fifo_file_perms;
+
+domtrans_pattern(abrt_retrace_worker_t, abrt_retrace_coredump_exec_t, abrt_retrace_coredump_t)
+allow abrt_retrace_worker_t abrt_retrace_coredump_exec_t:file ioctl;
+
+manage_dirs_pattern(abrt_retrace_worker_t, abrt_retrace_spool_t, abrt_retrace_spool_t)
+manage_files_pattern(abrt_retrace_worker_t, abrt_retrace_spool_t, abrt_retrace_spool_t)
+manage_lnk_files_pattern(abrt_retrace_worker_t, abrt_retrace_spool_t, abrt_retrace_spool_t)
+
+allow abrt_retrace_worker_t abrt_etc_t:file read_file_perms;
+
+can_exec(abrt_retrace_worker_t, abrt_retrace_worker_exec_t)
+
+corecmd_exec_bin(abrt_retrace_worker_t)
+corecmd_exec_shell(abrt_retrace_worker_t)
+
+dev_read_urand(abrt_retrace_worker_t)
+
+files_read_usr_files(abrt_retrace_worker_t)
+
+sysnet_dns_name_resolve(abrt_retrace_worker_t)
+
+########################################
+#
+# Dump oops local policy
+#
+
+allow abrt_dump_oops_t self:capability dac_override;
+allow abrt_dump_oops_t self:fifo_file rw_fifo_file_perms;
+allow abrt_dump_oops_t self:unix_stream_socket { accept listen };
+
+files_search_spool(abrt_dump_oops_t)
+manage_dirs_pattern(abrt_dump_oops_t, abrt_var_cache_t, abrt_var_cache_t)
+manage_files_pattern(abrt_dump_oops_t, abrt_var_cache_t, abrt_var_cache_t)
+manage_lnk_files_pattern(abrt_dump_oops_t, abrt_var_cache_t, abrt_var_cache_t)
+files_var_filetrans(abrt_dump_oops_t, abrt_var_cache_t, { file dir })
+
+read_files_pattern(abrt_dump_oops_t, abrt_var_run_t, abrt_var_run_t)
+read_lnk_files_pattern(abrt_dump_oops_t, abrt_var_run_t, abrt_var_run_t)
+
+read_files_pattern(abrt_dump_oops_t, abrt_etc_t, abrt_etc_t)
+
+kernel_read_kernel_sysctls(abrt_dump_oops_t)
+kernel_read_ring_buffer(abrt_dump_oops_t)
+
+domain_use_interactive_fds(abrt_dump_oops_t)
+
+fs_list_inotifyfs(abrt_dump_oops_t)
+
+logging_read_generic_logs(abrt_dump_oops_t)
+
+#######################################
+#
+# Watch log local policy
+#
+
+allow abrt_watch_log_t self:fifo_file rw_fifo_file_perms;
+allow abrt_watch_log_t self:unix_stream_socket { accept listen };
+
+read_files_pattern(abrt_watch_log_t, abrt_etc_t, abrt_etc_t)
+
+domtrans_pattern(abrt_watch_log_t, abrt_dump_oops_exec_t, abrt_dump_oops_t)
+
+logging_read_all_logs(abrt_watch_log_t)
+
+#######################################
+#
+# Global local policy
+#
+
+kernel_read_system_state(abrt_domain)
+
+files_read_etc_files(abrt_domain)
+
+logging_send_syslog_msg(abrt_domain)
+
+miscfiles_read_localization(abrt_domain)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/accountsd.fc refpolicy/policy/modules/contrib/accountsd.fc
--- refpolicy/policy/modules/contrib/accountsd.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/accountsd.fc	2012-10-08 20:11:27.007033586 +0200
@@ -1,3 +1,5 @@
-/usr/libexec/accounts-daemon		--	gen_context(system_u:object_r:accountsd_exec_t,s0)
+/usr/libexec/accounts-daemon	--	gen_context(system_u:object_r:accountsd_exec_t,s0)
 
-/var/lib/AccountsService(/.*)?			gen_context(system_u:object_r:accountsd_var_lib_t,s0)
+/usr/lib/accountsservice/accounts-daemon	--	gen_context(system_u:object_r:accountsd_exec_t,s0)
+
+/var/lib/AccountsService(/.*)?	gen_context(system_u:object_r:accountsd_var_lib_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/accountsd.if refpolicy/policy/modules/contrib/accountsd.if
--- refpolicy/policy/modules/contrib/accountsd.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/accountsd.if	2012-09-27 20:03:30.721126498 +0200
@@ -1,13 +1,14 @@
-## <summary>AccountsService and daemon for manipulating user account information via D-Bus</summary>
+## <summary>AccountsService and daemon for manipulating user account information via D-Bus.</summary>
 
 ########################################
 ## <summary>
-##	Execute a domain transition to run accountsd.
+##	Execute a domain transition to
+##	run accountsd.
 ## </summary>
 ## <param name="domain">
-## <summary>
-##	Domain allowed access.
-## </summary>
+##	<summary>
+##	Domain allowed to transition.
+##	</summary>
 ## </param>
 #
 interface(`accountsd_domtrans',`
@@ -15,17 +16,18 @@
 		type accountsd_t, accountsd_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, accountsd_exec_t, accountsd_t)
 ')
 
 ########################################
 ## <summary>
-##	Do not audit attempts to read and write Accounts Daemon
-##	fifo file.
+##	Do not audit attempts to read and
+##	write Accounts Daemon fifo files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
-##	Domain allowed access.
+##	Domain to not audit.
 ##	</summary>
 ## </param>
 #
@@ -118,8 +120,8 @@
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate
-##	an accountsd environment
+##	All of the rules required to
+##	administrate an accountsd environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -138,7 +140,7 @@
 		type accountsd_t;
 	')
 
-	allow $1 accountsd_t:process { ptrace signal_perms getattr };
+	allow $1 accountsd_t:process { ptrace signal_perms };
 	ps_process_pattern($1, accountsd_t)
 
 	accountsd_manage_lib_files($1)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/accountsd.te refpolicy/policy/modules/contrib/accountsd.te
--- refpolicy/policy/modules/contrib/accountsd.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/accountsd.te	2012-10-08 20:11:27.031033570 +0200
@@ -1,4 +1,8 @@
-policy_module(accountsd, 1.0.0)
+policy_module(accountsd, 1.0.4)
+
+gen_require(`
+	class passwd all_passwd_perms;
+')
 
 ########################################
 #
@@ -14,27 +18,34 @@
 
 ########################################
 #
-# accountsd local policy
+# Local policy
 #
 
-allow accountsd_t self:capability { dac_override setuid setgid sys_ptrace };
+allow accountsd_t self:capability { chown dac_override setuid setgid sys_ptrace };
+allow accountsd_t self:process signal;
 allow accountsd_t self:fifo_file rw_fifo_file_perms;
+allow accountsd_t self:passwd { rootok passwd chfn chsh };
 
 manage_dirs_pattern(accountsd_t, accountsd_var_lib_t, accountsd_var_lib_t)
 manage_files_pattern(accountsd_t, accountsd_var_lib_t, accountsd_var_lib_t)
-files_var_lib_filetrans(accountsd_t, accountsd_var_lib_t, { file dir })
+files_var_lib_filetrans(accountsd_t, accountsd_var_lib_t, dir)
 
 kernel_read_kernel_sysctls(accountsd_t)
+kernel_read_system_state(accountsd_t)
 
 corecmd_exec_bin(accountsd_t)
 
-files_read_usr_files(accountsd_t)
+dev_read_sysfs(accountsd_t)
+
 files_read_mnt_files(accountsd_t)
+files_read_usr_files(accountsd_t)
 
+fs_getattr_xattr_fs(accountsd_t)
 fs_list_inotifyfs(accountsd_t)
 fs_read_noxattr_fs_files(accountsd_t)
 
 auth_use_nsswitch(accountsd_t)
+auth_read_login_records(accountsd_t)
 auth_read_shadow(accountsd_t)
 
 miscfiles_read_localization(accountsd_t)
@@ -49,6 +60,7 @@
 usermanage_domtrans_passwd(accountsd_t)
 
 optional_policy(`
+	consolekit_dbus_chat(accountsd_t)
 	consolekit_read_log(accountsd_t)
 ')
 
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/acct.fc refpolicy/policy/modules/contrib/acct.fc
--- refpolicy/policy/modules/contrib/acct.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/acct.fc	2012-09-27 20:03:30.721126498 +0200
@@ -1,9 +1,11 @@
+/etc/cron\.(daily|monthly)/acct	--	gen_context(system_u:object_r:acct_exec_t,s0)
 
-/etc/cron\.(daily|monthly)/acct -- gen_context(system_u:object_r:acct_exec_t,s0)
+/etc/rc\.d/init\.d/psacct	--	gen_context(system_u:object_r:acct_initrc_exec_t,s0)
 
-/sbin/accton		--	gen_context(system_u:object_r:acct_exec_t,s0)
+/sbin/accton	--	gen_context(system_u:object_r:acct_exec_t,s0)
 
 /usr/sbin/accton	--	gen_context(system_u:object_r:acct_exec_t,s0)
 
-/var/account(/.*)?		gen_context(system_u:object_r:acct_data_t,s0)
-/var/log/account(/.*)?		gen_context(system_u:object_r:acct_data_t,s0)
+/var/account(/.*)?	gen_context(system_u:object_r:acct_data_t,s0)
+
+/var/log/account(/.*)?	gen_context(system_u:object_r:acct_data_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/acct.if refpolicy/policy/modules/contrib/acct.if
--- refpolicy/policy/modules/contrib/acct.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/acct.if	2012-09-27 20:03:30.721126498 +0200
@@ -1,8 +1,9 @@
-## <summary>Berkeley process accounting</summary>
+## <summary>Berkeley process accounting.</summary>
 
 ########################################
 ## <summary>
-##	Transition to the accounting management domain.
+##	Transition to the accounting
+##	management domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -21,7 +22,8 @@
 
 ########################################
 ## <summary>
-##	Execute accounting management tools in the caller domain.
+##	Execute accounting management tools
+##	in the caller domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -40,7 +42,8 @@
 
 ########################################
 ## <summary>
-##	Execute accounting management data in the caller domain.
+##	Execute accounting management data
+##	in the caller domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -48,8 +51,6 @@
 ##	</summary>
 ## </param>
 #
-# cjp: this is added for logrotate, and does
-# not make sense to me.
 interface(`acct_exec_data',`
 	gen_require(`
 		type acct_data_t;
@@ -61,7 +62,8 @@
 
 ########################################
 ## <summary>
-##	Create, read, write, and delete process accounting data.
+##	Create, read, write, and delete
+##	process accounting data.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -78,3 +80,37 @@
 	manage_files_pattern($1, acct_data_t, acct_data_t)
 	manage_lnk_files_pattern($1, acct_data_t, acct_data_t)
 ')
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an acct environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`acct_admin',`
+	gen_require(`
+		type acct_t, acct_initrc_exec_t, acct_data_t;
+	')
+
+	allow $1 acct_t:process { ptrace signal_perms };
+	ps_process_pattern($1, acct_t)
+
+	init_labeled_script_domtrans($1, acct_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 acct_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	logging_search_logs($1)
+	admin_pattern($1, acct_data_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/acct.te refpolicy/policy/modules/contrib/acct.te
--- refpolicy/policy/modules/contrib/acct.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/acct.te	2012-09-27 20:03:30.721126498 +0200
@@ -1,4 +1,4 @@
-policy_module(acct, 1.5.0)
+policy_module(acct, 1.5.1)
 
 ########################################
 #
@@ -9,6 +9,9 @@
 type acct_exec_t;
 init_system_domain(acct_t, acct_exec_t)
 
+type acct_initrc_exec_t;
+init_script_file(acct_initrc_exec_t)
+
 type acct_data_t;
 logging_log_file(acct_data_t)
 
@@ -17,13 +20,10 @@
 # Local Policy
 #
 
-# gzip needs chown capability for some reason
-allow acct_t self:capability { sys_pacct chown fsetid };
-# not sure why we need kill, the command "last" is reported as using it
-dontaudit acct_t self:capability { kill sys_tty_config };
-
-allow acct_t self:fifo_file rw_fifo_file_perms;
+allow acct_t self:capability { chown fsetid kill sys_pacct };
+dontaudit acct_t self:capability sys_tty_config;
 allow acct_t self:process signal_perms;
+allow acct_t self:fifo_file rw_fifo_file_perms;
 
 manage_files_pattern(acct_t, acct_data_t, acct_data_t)
 manage_lnk_files_pattern(acct_t, acct_data_t, acct_data_t)
@@ -34,26 +34,24 @@
 kernel_read_system_state(acct_t)
 kernel_read_kernel_sysctls(acct_t)
 
+corecmd_exec_bin(acct_t)
+corecmd_exec_shell(acct_t)
+
 dev_read_sysfs(acct_t)
-# for SSP
 dev_read_urand(acct_t)
 
+domain_use_interactive_fds(acct_t)
+
 fs_search_auto_mountpoints(acct_t)
 fs_getattr_xattr_fs(acct_t)
 
 term_dontaudit_use_console(acct_t)
 term_dontaudit_use_generic_ptys(acct_t)
 
-corecmd_exec_bin(acct_t)
-corecmd_exec_shell(acct_t)
-
-domain_use_interactive_fds(acct_t)
-
-files_read_etc_files(acct_t)
 files_read_etc_runtime_files(acct_t)
 files_list_usr(acct_t)
-# for nscd
-files_dontaudit_search_pids(acct_t)
+
+auth_use_nsswitch(acct_t)
 
 init_use_fds(acct_t)
 init_use_script_ptys(acct_t)
@@ -63,8 +61,8 @@
 
 miscfiles_read_localization(acct_t)
 
-userdom_dontaudit_use_unpriv_user_fds(acct_t)
 userdom_dontaudit_search_user_home_dirs(acct_t)
+userdom_dontaudit_use_unpriv_user_fds(acct_t)
 
 optional_policy(`
 	optional_policy(`
@@ -77,10 +75,6 @@
 ')
 
 optional_policy(`
-	nscd_socket_use(acct_t)
-')
-
-optional_policy(`
 	seutil_sigchld_newrole(acct_t)
 ')
 
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/ada.fc refpolicy/policy/modules/contrib/ada.fc
--- refpolicy/policy/modules/contrib/ada.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/ada.fc	2012-09-27 20:03:30.722126498 +0200
@@ -1,7 +1,5 @@
-#
-# /usr
-#
 /usr/bin/gnatbind	--	gen_context(system_u:object_r:ada_exec_t,s0)
-/usr/bin/gnatls		--	gen_context(system_u:object_r:ada_exec_t,s0)
+/usr/bin/gnatls	--	gen_context(system_u:object_r:ada_exec_t,s0)
 /usr/bin/gnatmake	--	gen_context(system_u:object_r:ada_exec_t,s0)
-/usr/libexec/gcc(/.*)?/gnat1 -- gen_context(system_u:object_r:ada_exec_t,s0)
+
+/usr/libexec/gcc(/.*)?/gnat1	--	gen_context(system_u:object_r:ada_exec_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/ada.if refpolicy/policy/modules/contrib/ada.if
--- refpolicy/policy/modules/contrib/ada.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/ada.if	2012-09-27 20:03:30.722126498 +0200
@@ -1,4 +1,4 @@
-## <summary>GNAT Ada95 compiler</summary>
+## <summary>GNAT Ada95 compiler.</summary>
 
 ########################################
 ## <summary>
@@ -37,9 +37,9 @@
 #
 interface(`ada_run',`
 	gen_require(`
-		type ada_t;
+		attribute_role ada_roles;
 	')
 
 	ada_domtrans($1)
-	role $2 types ada_t;
+	roleattribute $2 ada_roles;
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/ada.te refpolicy/policy/modules/contrib/ada.te
--- refpolicy/policy/modules/contrib/ada.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/ada.te	2012-09-27 20:03:30.722126498 +0200
@@ -1,14 +1,17 @@
-policy_module(ada, 1.4.0)
+policy_module(ada, 1.4.1)
 
 ########################################
 #
 # Declarations
 #
 
+attribute_role ada_roles;
+roleattribute system_r ada_roles;
+
 type ada_t;
 type ada_exec_t;
 application_domain(ada_t, ada_exec_t)
-role system_r types ada_t;
+role ada_roles types ada_t;
 
 ########################################
 #
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/afs.fc refpolicy/policy/modules/contrib/afs.fc
--- refpolicy/policy/modules/contrib/afs.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/afs.fc	2012-09-27 20:03:30.722126498 +0200
@@ -1,5 +1,7 @@
-/etc/rc\.d/init\.d/openafs-client -- gen_context(system_u:object_r:afs_initrc_exec_t,s0)
-/etc/rc\.d/init\.d/afs	--	gen_context(system_u:object_r:afs_initrc_exec_t,s0)
+/etc/(open)?afs(/.*)?	gen_context(system_u:object_r:afs_config_t,s0)
+
+/etc/rc\.d/init\.d/openafs-client	--	gen_context(system_u:object_r:afs_initrc_exec_t,s0)
+/etc/rc\.d/init\.d/(open)?afs	--	gen_context(system_u:object_r:afs_initrc_exec_t,s0)
 
 /usr/afs/bin/bosserver	--	gen_context(system_u:object_r:afs_bosserver_exec_t,s0)
 /usr/afs/bin/fileserver	--	gen_context(system_u:object_r:afs_fsserver_exec_t,s0)
@@ -9,24 +11,32 @@
 /usr/afs/bin/volserver	--	gen_context(system_u:object_r:afs_fsserver_exec_t,s0)
 /usr/afs/bin/vlserver	--	gen_context(system_u:object_r:afs_vlserver_exec_t,s0)
 
-/usr/afs/db		-d	gen_context(system_u:object_r:afs_dbdir_t,s0)
+/usr/afs/db	-d	gen_context(system_u:object_r:afs_dbdir_t,s0)
 /usr/afs/db/pr.*	--	gen_context(system_u:object_r:afs_pt_db_t,s0)
 /usr/afs/db/ka.*	--	gen_context(system_u:object_r:afs_ka_db_t,s0)
 /usr/afs/db/vl.*	--	gen_context(system_u:object_r:afs_vl_db_t,s0)
 
-/usr/afs/etc(/.*)?		gen_context(system_u:object_r:afs_config_t,s0)
+/usr/afs/etc(/.*)?	gen_context(system_u:object_r:afs_config_t,s0)
+
+/usr/afs/local(/.*)?	gen_context(system_u:object_r:afs_config_t,s0)
 
-/usr/afs/local(/.*)?		gen_context(system_u:object_r:afs_config_t,s0)
+/usr/afs/logs(/.*)?	gen_context(system_u:object_r:afs_logfile_t,s0)
 
-/usr/afs/logs(/.*)?		gen_context(system_u:object_r:afs_logfile_t,s0)
+/usr/libexec/openafs/fileserver	--	gen_context(system_u:object_r:afs_fsserver_exec_t,s0)
+/usr/libexec/openafs/kaserver	--	gen_context(system_u:object_r:afs_kaserver_exec_t,s0)
+/usr/libexec/openafs/ptserver	--	gen_context(system_u:object_r:afs_ptserver_exec_t,s0)
+/usr/libexec/openafs/salvager	--	gen_context(system_u:object_r:afs_fsserver_exec_t,s0)
+/usr/libexec/openafs/volserver	--	gen_context(system_u:object_r:afs_fsserver_exec_t,s0)
+/usr/libexec/openafs/vlserver	--	gen_context(system_u:object_r:afs_vlserver_exec_t,s0)
 
-/usr/sbin/afsd		--	gen_context(system_u:object_r:afs_exec_t,s0)
+/usr/sbin/afsd	--	gen_context(system_u:object_r:afs_exec_t,s0)
+/usr/sbin/bosserver	--	gen_context(system_u:object_r:afs_bosserver_exec_t,s0)
 
-/usr/vice/cache(/.*)?		gen_context(system_u:object_r:afs_cache_t,s0)
+/usr/vice/cache(/.*)?	gen_context(system_u:object_r:afs_cache_t,s0)
 /usr/vice/etc/afsd	--	gen_context(system_u:object_r:afs_exec_t,s0)
 
-/var/cache/afs(/.*)?		gen_context(system_u:object_r:afs_cache_t,s0)
+/var/cache/(open)?afs(/.*)?	gen_context(system_u:object_r:afs_cache_t,s0)
 
-/vicepa				gen_context(system_u:object_r:afs_files_t,s0)
-/vicepb				gen_context(system_u:object_r:afs_files_t,s0)
-/vicepc				gen_context(system_u:object_r:afs_files_t,s0)
+/vicepa	gen_context(system_u:object_r:afs_files_t,s0)
+/vicepb	gen_context(system_u:object_r:afs_files_t,s0)
+/vicepc	gen_context(system_u:object_r:afs_files_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/afs.if refpolicy/policy/modules/contrib/afs.if
--- refpolicy/policy/modules/contrib/afs.if	2012-05-04 15:16:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/afs.if	2012-09-27 20:03:30.722126498 +0200
@@ -1,4 +1,4 @@
-## <summary>Andrew Filesystem server</summary>
+## <summary>Andrew Filesystem server.</summary>
 
 ########################################
 ## <summary>
@@ -40,7 +40,7 @@
 
 ########################################
 ## <summary>
-##	read/write afs cache files
+##	Read and write afs cache files.
 ## </summary>
 ## <param name="domain">
 ## <summary>
@@ -77,8 +77,8 @@
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate 
-##	an afs environment
+##	All of the rules required to
+##	administrate an afs environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -87,23 +87,39 @@
 ## </param>
 ## <param name="role">
 ##	<summary>
-##	The role to be allowed to manage the afs domain.
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <rolecap/>
 #
 interface(`afs_admin',`
 	gen_require(`
-		type afs_t, afs_initrc_exec_t;
+		attribute afs_domain;
+		type afs_initrc_exec_t, afs_dbdir_t, afs_pt_db_t;
+		type afs_ka_db_t, afs_vl_db_t, afs_config_t;
+		type afs_logfile_t, afs_cache_t, afs_files_t;
 	')
 
-	allow $1 afs_t:process { ptrace signal_perms getattr };
-	read_files_pattern($1, afs_t, afs_t)
+	allow $1 afs_domain:process { ptrace signal_perms };
+	ps_process_pattern($1, afs_domain)
 
-	# Allow afs_admin to restart the afs service
 	afs_initrc_domtrans($1)
 	domain_system_change_exemption($1)
 	role_transition $2 afs_initrc_exec_t system_r;
 	allow $2 system_r;
 
+	files_search_etc($1)
+	admin_pattern($1, afs_config_t)
+
+	files_search_var($1)
+	admin_pattern($1, afs_cache_t)
+
+	files_search_var_lib($1)
+	admin_pattern($1, { afs_dbdir_t afs_pt_db_t afs_ka_db_t })
+	admin_pattern($1, afs_vl_db_t)
+
+	logging_search_logs($1)
+	admin_pattern($1, afs_logfile_t)
+
+	admin_pattern($1, afs_files_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/afs.te refpolicy/policy/modules/contrib/afs.te
--- refpolicy/policy/modules/contrib/afs.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/afs.te	2012-09-27 20:03:30.722126498 +0200
@@ -1,15 +1,17 @@
-policy_module(afs, 1.7.0)
+policy_module(afs, 1.8.2)
 
 ########################################
 #
 # Declarations
 #
 
-type afs_t;
+attribute afs_domain;
+
+type afs_t, afs_domain;
 type afs_exec_t;
 init_daemon_domain(afs_t, afs_exec_t)
 
-type afs_bosserver_t;
+type afs_bosserver_t, afs_domain;
 type afs_bosserver_exec_t;
 init_daemon_domain(afs_bosserver_t, afs_bosserver_exec_t)
 
@@ -26,7 +28,7 @@
 type afs_files_t;
 files_type(afs_files_t)
 
-type afs_fsserver_t;
+type afs_fsserver_t, afs_domain;
 type afs_fsserver_exec_t;
 domain_type(afs_fsserver_t)
 domain_entry_file(afs_fsserver_t, afs_fsserver_exec_t)
@@ -38,7 +40,7 @@
 type afs_ka_db_t;
 files_type(afs_ka_db_t)
 
-type afs_kaserver_t;
+type afs_kaserver_t, afs_domain;
 type afs_kaserver_exec_t;
 domain_type(afs_kaserver_t)
 domain_entry_file(afs_kaserver_t, afs_kaserver_exec_t)
@@ -50,7 +52,7 @@
 type afs_pt_db_t;
 files_type(afs_pt_db_t)
 
-type afs_ptserver_t;
+type afs_ptserver_t, afs_domain;
 type afs_ptserver_exec_t;
 domain_type(afs_ptserver_t)
 domain_entry_file(afs_ptserver_t, afs_ptserver_exec_t)
@@ -59,7 +61,7 @@
 type afs_vl_db_t;
 files_type(afs_vl_db_t)
 
-type afs_vlserver_t;
+type afs_vlserver_t, afs_domain;
 type afs_vlserver_exec_t;
 domain_type(afs_vlserver_t)
 domain_entry_file(afs_vlserver_t, afs_vlserver_exec_t)
@@ -70,11 +72,10 @@
 # afs client local policy
 #
 
-allow afs_t self:capability { sys_admin sys_nice sys_tty_config };
+allow afs_t self:capability { dac_override sys_admin sys_nice sys_tty_config };
 allow afs_t self:process { setsched signal };
-allow afs_t self:udp_socket create_socket_perms;
 allow afs_t self:fifo_file rw_file_perms;
-allow afs_t self:unix_stream_socket create_stream_socket_perms;
+allow afs_t self:unix_stream_socket { accept listen };
 
 manage_files_pattern(afs_t, afs_cache_t, afs_cache_t)
 manage_dirs_pattern(afs_t, afs_cache_t, afs_cache_t)
@@ -82,18 +83,7 @@
 
 kernel_rw_afs_state(afs_t)
 
-corenet_all_recvfrom_unlabeled(afs_t)
-corenet_all_recvfrom_netlabel(afs_t)
-corenet_tcp_sendrecv_generic_if(afs_t)
-corenet_udp_sendrecv_generic_if(afs_t)
-corenet_tcp_sendrecv_generic_node(afs_t)
-corenet_udp_sendrecv_generic_node(afs_t)
-corenet_tcp_sendrecv_all_ports(afs_t)
-corenet_udp_sendrecv_all_ports(afs_t)
-corenet_udp_bind_generic_node(afs_t)
-
 files_mounton_mnt(afs_t)
-files_read_etc_files(afs_t)
 files_read_usr_files(afs_t)
 files_rw_etc_runtime_files(afs_t)
 
@@ -103,10 +93,6 @@
 
 logging_send_syslog_msg(afs_t)
 
-miscfiles_read_localization(afs_t)
-
-sysnet_dns_name_resolve(afs_t)
-
 ########################################
 #
 # AFS bossserver local policy
@@ -114,7 +100,6 @@
 
 allow afs_bosserver_t self:process { setsched signal_perms };
 allow afs_bosserver_t self:tcp_socket create_stream_socket_perms;
-allow afs_bosserver_t self:udp_socket create_socket_perms;
 
 can_exec(afs_bosserver_t, afs_bosserver_exec_t)
 
@@ -142,26 +127,19 @@
 
 corenet_all_recvfrom_unlabeled(afs_bosserver_t)
 corenet_all_recvfrom_netlabel(afs_bosserver_t)
-corenet_tcp_sendrecv_generic_if(afs_bosserver_t)
 corenet_udp_sendrecv_generic_if(afs_bosserver_t)
-corenet_tcp_sendrecv_generic_node(afs_bosserver_t)
 corenet_udp_sendrecv_generic_node(afs_bosserver_t)
-corenet_tcp_sendrecv_all_ports(afs_bosserver_t)
-corenet_udp_sendrecv_all_ports(afs_bosserver_t)
 corenet_udp_bind_generic_node(afs_bosserver_t)
+
 corenet_udp_bind_afs_bos_port(afs_bosserver_t)
 corenet_sendrecv_afs_bos_server_packets(afs_bosserver_t)
+corenet_udp_sendrecv_afs_bos_port(afs_bosserver_t)
 
-files_read_etc_files(afs_bosserver_t)
 files_list_home(afs_bosserver_t)
 files_read_usr_files(afs_bosserver_t)
 
-miscfiles_read_localization(afs_bosserver_t)
-
 seutil_read_config(afs_bosserver_t)
 
-sysnet_read_config(afs_bosserver_t)
-
 ########################################
 #
 # fileserver local policy
@@ -172,7 +150,6 @@
 allow afs_fsserver_t self:process { setsched signal_perms };
 allow afs_fsserver_t self:fifo_file rw_fifo_file_perms;
 allow afs_fsserver_t self:tcp_socket create_stream_socket_perms;
-allow afs_fsserver_t self:udp_socket create_socket_perms;
 
 read_files_pattern(afs_fsserver_t, afs_config_t, afs_config_t)
 allow afs_fsserver_t afs_config_t:dir list_dir_perms;
@@ -196,21 +173,21 @@
 kernel_read_system_state(afs_fsserver_t)
 kernel_read_kernel_sysctls(afs_fsserver_t)
 
+corenet_all_recvfrom_unlabeled(afs_fsserver_t)
+corenet_all_recvfrom_netlabel(afs_fsserver_t)
 corenet_tcp_sendrecv_generic_if(afs_fsserver_t)
 corenet_udp_sendrecv_generic_if(afs_fsserver_t)
 corenet_tcp_sendrecv_generic_node(afs_fsserver_t)
 corenet_udp_sendrecv_generic_node(afs_fsserver_t)
-corenet_tcp_sendrecv_all_ports(afs_fsserver_t)
-corenet_udp_sendrecv_all_ports(afs_fsserver_t)
-corenet_all_recvfrom_unlabeled(afs_fsserver_t)
-corenet_all_recvfrom_netlabel(afs_fsserver_t)
 corenet_tcp_bind_generic_node(afs_fsserver_t)
 corenet_udp_bind_generic_node(afs_fsserver_t)
+
+corenet_sendrecv_afs_fs_server_packets(afs_fsserver_t)
 corenet_tcp_bind_afs_fs_port(afs_fsserver_t)
 corenet_udp_bind_afs_fs_port(afs_fsserver_t)
-corenet_sendrecv_afs_fs_server_packets(afs_fsserver_t)
+corenet_tcp_sendrecv_afs_fs_port(afs_fsserver_t)
+corenet_udp_sendrecv_afs_fs_port(afs_fsserver_t)
 
-files_read_etc_files(afs_fsserver_t)
 files_read_etc_runtime_files(afs_fsserver_t)
 files_list_home(afs_fsserver_t)
 files_read_usr_files(afs_fsserver_t)
@@ -225,12 +202,8 @@
 
 logging_send_syslog_msg(afs_fsserver_t)
 
-miscfiles_read_localization(afs_fsserver_t)
-
 seutil_read_config(afs_fsserver_t)
 
-sysnet_read_config(afs_fsserver_t)
-
 userdom_dontaudit_use_user_terminals(afs_fsserver_t)
 
 ########################################
@@ -240,7 +213,6 @@
 
 allow afs_kaserver_t self:unix_stream_socket create_stream_socket_perms;
 allow afs_kaserver_t self:tcp_socket create_stream_socket_perms;
-allow afs_kaserver_t self:udp_socket create_socket_perms;
 
 manage_files_pattern(afs_kaserver_t, afs_config_t, afs_config_t)
 
@@ -254,28 +226,23 @@
 
 corenet_all_recvfrom_unlabeled(afs_kaserver_t)
 corenet_all_recvfrom_netlabel(afs_kaserver_t)
-corenet_tcp_sendrecv_generic_if(afs_kaserver_t)
 corenet_udp_sendrecv_generic_if(afs_kaserver_t)
-corenet_tcp_sendrecv_generic_node(afs_kaserver_t)
 corenet_udp_sendrecv_generic_node(afs_kaserver_t)
-corenet_tcp_sendrecv_all_ports(afs_kaserver_t)
-corenet_udp_sendrecv_all_ports(afs_kaserver_t)
 corenet_udp_bind_generic_node(afs_kaserver_t)
-corenet_udp_bind_afs_ka_port(afs_kaserver_t)
-corenet_udp_bind_kerberos_port(afs_kaserver_t)
+
 corenet_sendrecv_afs_ka_server_packets(afs_kaserver_t)
+corenet_udp_bind_afs_ka_port(afs_kaserver_t)
+corenet_udp_sendrecv_afs_ka_port(afs_kaserver_t)
+
 corenet_sendrecv_kerberos_server_packets(afs_kaserver_t)
+corenet_udp_bind_kerberos_port(afs_kaserver_t)
+corenet_udp_sendrecv_kerberos_port(afs_kaserver_t)
 
-files_read_etc_files(afs_kaserver_t)
 files_list_home(afs_kaserver_t)
 files_read_usr_files(afs_kaserver_t)
 
-miscfiles_read_localization(afs_kaserver_t)
-
 seutil_read_config(afs_kaserver_t)
 
-sysnet_read_config(afs_kaserver_t)
-
 userdom_dontaudit_use_user_terminals(afs_kaserver_t)
 
 ########################################
@@ -285,7 +252,6 @@
 
 allow afs_ptserver_t self:unix_stream_socket create_stream_socket_perms;
 allow afs_ptserver_t self:tcp_socket create_stream_socket_perms;
-allow afs_ptserver_t self:udp_socket create_socket_perms;
 
 read_files_pattern(afs_ptserver_t, afs_config_t, afs_config_t)
 allow afs_ptserver_t afs_config_t:dir list_dir_perms;
@@ -308,12 +274,6 @@
 corenet_udp_bind_afs_pt_port(afs_ptserver_t)
 corenet_sendrecv_afs_pt_server_packets(afs_ptserver_t)
 
-files_read_etc_files(afs_ptserver_t)
-
-miscfiles_read_localization(afs_ptserver_t)
-
-sysnet_read_config(afs_ptserver_t)
-
 userdom_dontaudit_use_user_terminals(afs_ptserver_t)
 
 ########################################
@@ -323,7 +283,6 @@
 
 allow afs_vlserver_t self:unix_stream_socket create_stream_socket_perms;
 allow afs_vlserver_t self:tcp_socket create_stream_socket_perms;
-allow afs_vlserver_t self:udp_socket create_socket_perms;
 
 read_files_pattern(afs_vlserver_t, afs_config_t, afs_config_t)
 allow afs_vlserver_t afs_config_t:dir list_dir_perms;
@@ -346,10 +305,17 @@
 corenet_udp_bind_afs_vl_port(afs_vlserver_t)
 corenet_sendrecv_afs_vl_server_packets(afs_vlserver_t)
 
-files_read_etc_files(afs_vlserver_t)
+userdom_dontaudit_use_user_terminals(afs_vlserver_t)
+
+########################################
+#
+# Global local policy
+#
+
+allow afs_domain self:udp_socket create_socket_perms;
 
-miscfiles_read_localization(afs_vlserver_t)
+files_read_etc_files(afs_domain)
 
-sysnet_read_config(afs_vlserver_t)
+miscfiles_read_localization(afs_domain)
 
-userdom_dontaudit_use_user_terminals(afs_vlserver_t)
+sysnet_read_config(afs_domain)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/aiccu.fc refpolicy/policy/modules/contrib/aiccu.fc
--- refpolicy/policy/modules/contrib/aiccu.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/aiccu.fc	2012-09-27 20:03:30.722126498 +0200
@@ -1,6 +1,7 @@
-/etc/aiccu.conf			--	gen_context(system_u:object_r:aiccu_etc_t,s0)
+/etc/aiccu\.conf	--	gen_context(system_u:object_r:aiccu_etc_t,s0)
+
 /etc/rc\.d/init\.d/aiccu	--	gen_context(system_u:object_r:aiccu_initrc_exec_t,s0)
 
-/usr/sbin/aiccu			--	gen_context(system_u:object_r:aiccu_exec_t,s0)
+/usr/sbin/aiccu	--	gen_context(system_u:object_r:aiccu_exec_t,s0)
 
-/var/run/aiccu\.pid		--	gen_context(system_u:object_r:aiccu_var_run_t,s0)
+/var/run/aiccu\.pid	--	gen_context(system_u:object_r:aiccu_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/aiccu.if refpolicy/policy/modules/contrib/aiccu.if
--- refpolicy/policy/modules/contrib/aiccu.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/aiccu.if	2012-09-27 20:03:30.723126498 +0200
@@ -58,8 +58,8 @@
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate
-##	an aiccu environment
+##	All of the rules required to
+##	administrate an aiccu environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/aiccu.te refpolicy/policy/modules/contrib/aiccu.te
--- refpolicy/policy/modules/contrib/aiccu.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/aiccu.te	2012-10-06 19:00:57.112741225 +0200
@@ -1,4 +1,4 @@
-policy_module(aiccu, 1.0.0)
+policy_module(aiccu, 1.0.2)
 
 ########################################
 #
@@ -20,18 +20,18 @@
 
 ########################################
 #
-# aiccu local policy
+# Local policy
 #
 
 allow aiccu_t self:capability { kill net_admin net_raw };
 dontaudit aiccu_t self:capability sys_tty_config;
 allow aiccu_t self:process signal;
 allow aiccu_t self:fifo_file rw_fifo_file_perms;
-allow aiccu_t self:netlink_route_socket create_netlink_socket_perms;
-allow aiccu_t self:tcp_socket create_stream_socket_perms;
+allow aiccu_t self:netlink_route_socket nlmsg_write;
+allow aiccu_t self:tcp_socket { accept listen };
 allow aiccu_t self:tun_socket create_socket_perms;
-allow aiccu_t self:udp_socket create_stream_socket_perms;
-allow aiccu_t self:unix_stream_socket create_stream_socket_perms;
+allow aiccu_t self:udp_socket { accept listen };
+allow aiccu_t self:unix_stream_socket { accept listen };
 
 allow aiccu_t aiccu_etc_t:file read_file_perms;
 
@@ -45,13 +45,13 @@
 
 corenet_all_recvfrom_netlabel(aiccu_t)
 corenet_all_recvfrom_unlabeled(aiccu_t)
+corenet_tcp_bind_generic_node(aiccu_t)
 corenet_tcp_sendrecv_generic_if(aiccu_t)
 corenet_tcp_sendrecv_generic_node(aiccu_t)
-corenet_tcp_sendrecv_generic_port(aiccu_t)
-corenet_tcp_sendrecv_sixxsconfig_port(aiccu_t)
-corenet_tcp_bind_generic_node(aiccu_t)
-corenet_tcp_connect_sixxsconfig_port(aiccu_t)
+
 corenet_sendrecv_sixxsconfig_client_packets(aiccu_t)
+corenet_tcp_connect_sixxsconfig_port(aiccu_t)
+corenet_tcp_sendrecv_sixxsconfig_port(aiccu_t)
 
 corenet_rw_tun_tap_dev(aiccu_t)
 
@@ -71,6 +71,6 @@
 ')
 
 optional_policy(`
-	sysnet_domtrans_ifconfig(aiccu_t)
 	sysnet_dns_name_resolve(aiccu_t)
+	sysnet_domtrans_ifconfig(aiccu_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/aide.fc refpolicy/policy/modules/contrib/aide.fc
--- refpolicy/policy/modules/contrib/aide.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/aide.fc	2012-09-27 20:03:30.723126498 +0200
@@ -1,6 +1,6 @@
-/usr/sbin/aide		--	gen_context(system_u:object_r:aide_exec_t,mls_systemhigh)
+/usr/sbin/aide	--	gen_context(system_u:object_r:aide_exec_t,mls_systemhigh)
 
-/var/lib/aide(/.*)		gen_context(system_u:object_r:aide_db_t,mls_systemhigh)
+/var/lib/aide(/.*)	gen_context(system_u:object_r:aide_db_t,mls_systemhigh)
 
-/var/log/aide(/.*)?		gen_context(system_u:object_r:aide_log_t,mls_systemhigh)
+/var/log/aide(/.*)?	gen_context(system_u:object_r:aide_log_t,mls_systemhigh)
 /var/log/aide\.log	--	gen_context(system_u:object_r:aide_log_t,mls_systemhigh)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/aide.if refpolicy/policy/modules/contrib/aide.if
--- refpolicy/policy/modules/contrib/aide.if	2012-05-04 15:16:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/aide.if	2012-09-27 20:03:30.723126498 +0200
@@ -1,8 +1,8 @@
-## <summary>Aide filesystem integrity checker</summary>
+## <summary>Aide filesystem integrity checker.</summary>
 
 ########################################
 ## <summary>
-##	Execute aide in the aide domain
+##	Execute aide in the aide domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -21,7 +21,9 @@
 
 ########################################
 ## <summary>
-##	Execute aide programs in the AIDE domain.
+##	Execute aide programs in the AIDE
+##	domain and allow the specified role
+##	the AIDE domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -30,29 +32,34 @@
 ## </param>
 ## <param name="role">
 ##	<summary>
-##	The role to allow the AIDE domain.
+##	Role allowed access.
 ##	</summary>
 ## </param>
 #
 interface(`aide_run',`
 	gen_require(`
-		type aide_t;
+		attribute_role aide_roles;
 	')
 
 	aide_domtrans($1)
-	role $2 types aide_t;
+	roleattribute $2 aide_roles;
 ')
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate 
-##	an aide environment
+##	All of the rules required to
+##	administrate an aide environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
 ##	Domain allowed access.
 ##	</summary>
 ## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
 ## <rolecap/>
 #
 interface(`aide_admin',`
@@ -63,6 +70,8 @@
 	allow $1 aide_t:process { ptrace signal_perms };
 	ps_process_pattern($1, aide_t)
 
+	aide_run($1, $2)
+
 	files_list_etc($1)
 	admin_pattern($1, aide_db_t)
 
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/aide.te refpolicy/policy/modules/contrib/aide.te
--- refpolicy/policy/modules/contrib/aide.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/aide.te	2012-09-27 20:03:30.723126498 +0200
@@ -1,42 +1,45 @@
-policy_module(aide, 1.6.0)
+policy_module(aide, 1.6.1)
 
 ########################################
 #
 # Declarations
 #
 
+attribute_role aide_roles;
+
 type aide_t;
 type aide_exec_t;
 application_domain(aide_t, aide_exec_t)
+role aide_roles types aide_t;
 
-# log files
 type aide_log_t;
 logging_log_file(aide_log_t)
 
-# aide database
 type aide_db_t;
 files_type(aide_db_t)
 
 ########################################
 #
-# aide local policy
+# Local policy
 #
 
 allow aide_t self:capability { dac_override fowner };
 
-# database actions
 manage_files_pattern(aide_t, aide_db_t, aide_db_t)
 
-# logs
-manage_files_pattern(aide_t, aide_log_t, aide_log_t)
+create_files_pattern(aide_t, aide_log_t, aide_log_t)
+append_files_pattern(aide_t, aide_log_t, aide_log_t)
+setattr_files_pattern(aide_t, aide_log_t, aide_log_t)
 logging_log_filetrans(aide_t, aide_log_t, file)
 
 files_read_all_files(aide_t)
+files_read_all_symlinks(aide_t)
 
 logging_send_audit_msgs(aide_t)
-# AIDE can be configured to log to syslog
 logging_send_syslog_msg(aide_t)
 
-seutil_use_newrole_fds(aide_t)
-
 userdom_use_user_terminals(aide_t)
+
+optional_policy(`
+	seutil_use_newrole_fds(aide_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/aisexec.fc refpolicy/policy/modules/contrib/aisexec.fc
--- refpolicy/policy/modules/contrib/aisexec.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/aisexec.fc	2012-09-27 20:03:30.723126498 +0200
@@ -1,9 +1,9 @@
-/etc/rc\.d/init\.d/openais		--	gen_context(system_u:object_r:aisexec_initrc_exec_t,s0)
+/etc/rc\.d/init\.d/openais	--	gen_context(system_u:object_r:aisexec_initrc_exec_t,s0)
 
-/usr/sbin/aisexec			--	gen_context(system_u:object_r:aisexec_exec_t,s0)
+/usr/sbin/aisexec	--	gen_context(system_u:object_r:aisexec_exec_t,s0)
 
-/var/lib/openais(/.*)?				gen_context(system_u:object_r:aisexec_var_lib_t,s0)
+/var/lib/openais(/.*)?	gen_context(system_u:object_r:aisexec_var_lib_t,s0)
 
-/var/log/cluster/aisexec\.log		--	gen_context(system_u:object_r:aisexec_var_log_t,s0)
+/var/log/cluster/aisexec\.log.*	--	gen_context(system_u:object_r:aisexec_var_log_t,s0)
 
-/var/run/aisexec\.pid			--	gen_context(system_u:object_r:aisexec_var_run_t,s0)
+/var/run/aisexec.*	gen_context(system_u:object_r:aisexec_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/aisexec.if refpolicy/policy/modules/contrib/aisexec.if
--- refpolicy/policy/modules/contrib/aisexec.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/aisexec.if	2012-09-27 20:03:30.723126498 +0200
@@ -1,4 +1,4 @@
-## <summary>Aisexec Cluster Engine</summary>
+## <summary>Aisexec Cluster Engine.</summary>
 
 ########################################
 ## <summary>
@@ -15,12 +15,13 @@
 		type aisexec_t, aisexec_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, aisexec_exec_t, aisexec_t)
 ')
 
 #####################################
 ## <summary>
-##	Connect to aisexec over a unix domain
+##	Connect to aisexec over a unix
 ##	stream socket.
 ## </summary>
 ## <param name="domain">
@@ -40,7 +41,7 @@
 
 #######################################
 ## <summary>
-##	Allow the specified domain to read aisexec's log files.
+##	Read aisexec log files content.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -60,8 +61,8 @@
 
 ######################################
 ## <summary>
-##	All of the rules required to administrate
-##	an aisexec environment
+##	All of the rules required to
+##	administrate an aisexec environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -70,7 +71,7 @@
 ## </param>
 ## <param name="role">
 ##	<summary>
-##	The role to be allowed to manage the aisexecd domain.
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <rolecap/>
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/aisexec.te refpolicy/policy/modules/contrib/aisexec.te
--- refpolicy/policy/modules/contrib/aisexec.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/aisexec.te	2012-09-27 20:03:30.724126498 +0200
@@ -1,4 +1,4 @@
-policy_module(aisexec, 1.1.0)
+policy_module(aisexec, 1.1.1)
 
 ########################################
 #
@@ -29,20 +29,18 @@
 
 ########################################
 #
-# aisexec local policy
+# Local policy
 #
 
 allow aisexec_t self:capability { sys_nice sys_resource ipc_lock ipc_owner };
 allow aisexec_t self:process { setrlimit setsched signal };
 allow aisexec_t self:fifo_file rw_fifo_file_perms;
 allow aisexec_t self:sem create_sem_perms;
-allow aisexec_t self:unix_stream_socket { create_stream_socket_perms connectto };
-allow aisexec_t self:unix_dgram_socket create_socket_perms;
-allow aisexec_t self:udp_socket create_socket_perms;
+allow aisexec_t self:unix_stream_socket { accept listen connectto };
 
 manage_dirs_pattern(aisexec_t, aisexec_tmp_t, aisexec_tmp_t)
 manage_files_pattern(aisexec_t, aisexec_tmp_t, aisexec_tmp_t)
-files_tmp_filetrans(aisexec_t, aisexec_tmp_t, { file dir })
+files_tmp_filetrans(aisexec_t, aisexec_tmp_t, { dir file })
 
 manage_dirs_pattern(aisexec_t, aisexec_tmpfs_t, aisexec_tmpfs_t)
 manage_files_pattern(aisexec_t, aisexec_tmpfs_t, aisexec_tmpfs_t)
@@ -51,11 +49,12 @@
 manage_files_pattern(aisexec_t, aisexec_var_lib_t, aisexec_var_lib_t)
 manage_dirs_pattern(aisexec_t, aisexec_var_lib_t, aisexec_var_lib_t)
 manage_sock_files_pattern(aisexec_t, aisexec_var_lib_t, aisexec_var_lib_t)
-files_var_lib_filetrans(aisexec_t, aisexec_var_lib_t, { file dir sock_file })
+files_var_lib_filetrans(aisexec_t, aisexec_var_lib_t, dir)
 
-manage_files_pattern(aisexec_t, aisexec_var_log_t, aisexec_var_log_t)
-manage_sock_files_pattern(aisexec_t, aisexec_var_log_t, aisexec_var_log_t)
-logging_log_filetrans(aisexec_t, aisexec_var_log_t, { sock_file file })
+append_files_pattern(aisexec_t, aisexec_var_log_t, aisexec_var_log_t)
+create_files_pattern(aisexec_t, aisexec_var_log_t, aisexec_var_log_t)
+setattr_files_pattern(aisexec_t, aisexec_var_log_t, aisexec_var_log_t)
+logging_log_filetrans(aisexec_t, aisexec_var_log_t, file)
 
 manage_files_pattern(aisexec_t, aisexec_var_run_t, aisexec_var_run_t)
 manage_sock_files_pattern(aisexec_t, aisexec_var_run_t, aisexec_var_run_t)
@@ -65,9 +64,26 @@
 
 corecmd_exec_bin(aisexec_t)
 
+corenet_all_recvfrom_unlabeled(aisexec_t)
+corenet_all_recvfrom_netlabel(aisexec_t)
+corenet_tcp_sendrecv_generic_if(aisexec_t)
+corenet_udp_sendrecv_generic_if(aisexec_t)
+corenet_tcp_sendrecv_generic_node(aisexec_t)
+corenet_udp_sendrecv_generic_node(aisexec_t)
+corenet_tcp_bind_generic_node(aisexec_t)
+corenet_udp_bind_generic_node(aisexec_t)
+
+corenet_sendrecv_netsupport_server_packets(aisexec_t)
 corenet_udp_bind_netsupport_port(aisexec_t)
+corenet_udp_sendrecv_netsupport_port(aisexec_t)
+
+corenet_sendrecv_generic_server_packets(aisexec_t)
 corenet_tcp_bind_reserved_port(aisexec_t)
+corenet_tcp_sendrecv_reserved_port(aisexec_t)
+
+corenet_sendrecv_cluster_server_packets(aisexec_t)
 corenet_udp_bind_cluster_port(aisexec_t)
+corenet_udp_sendrecv_cluster_port(aisexec_t)
 
 dev_read_urand(aisexec_t)
 
@@ -89,7 +105,6 @@
 ')
 
 optional_policy(`
-	# to communication with RHCS
 	rhcs_rw_dlm_controld_semaphores(aisexec_t)
 
 	rhcs_rw_fenced_semaphores(aisexec_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/alsa.fc refpolicy/policy/modules/contrib/alsa.fc
--- refpolicy/policy/modules/contrib/alsa.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/alsa.fc	2012-09-27 20:03:30.724126498 +0200
@@ -1,20 +1,22 @@
 HOME_DIR/\.asoundrc	--	gen_context(system_u:object_r:alsa_home_t,s0)
 
-/bin/alsaunmute		--	gen_context(system_u:object_r:alsa_exec_t,s0)
+/bin/alsaunmute	--	gen_context(system_u:object_r:alsa_exec_t,s0)
 
-/etc/alsa/asound\.state --	gen_context(system_u:object_r:alsa_etc_rw_t,s0)
-/etc/alsa/pcm(/.*)?		gen_context(system_u:object_r:alsa_etc_rw_t,s0)
-/etc/asound(/.*)?		gen_context(system_u:object_r:alsa_etc_rw_t,s0)
+/etc/alsa/asound\.state	--	gen_context(system_u:object_r:alsa_etc_rw_t,s0)
+/etc/alsa/pcm(/.*)?	gen_context(system_u:object_r:alsa_etc_rw_t,s0)
+/etc/asound(/.*)?	gen_context(system_u:object_r:alsa_etc_rw_t,s0)
 /etc/asound\.state	--	gen_context(system_u:object_r:alsa_etc_rw_t,s0)
 
-/sbin/alsactl 		--	gen_context(system_u:object_r:alsa_exec_t,s0)
-/sbin/salsa 		--	gen_context(system_u:object_r:alsa_exec_t,s0)
+/sbin/alsactl	--	gen_context(system_u:object_r:alsa_exec_t,s0)
+/sbin/salsa	--	gen_context(system_u:object_r:alsa_exec_t,s0)
 
-/usr/bin/ainit 		--	gen_context(system_u:object_r:alsa_exec_t,s0)
+/usr/bin/ainit	--	gen_context(system_u:object_r:alsa_exec_t,s0)
+/usr/bin/alsaunmute	--	gen_context(system_u:object_r:alsa_exec_t,s0)
 
 /usr/sbin/alsactl	--	gen_context(system_u:object_r:alsa_exec_t,s0)
+/usr/sbin/salsa	--	gen_context(system_u:object_r:alsa_exec_t,s0)
 
 /usr/share/alsa/alsa\.conf	gen_context(system_u:object_r:alsa_etc_rw_t,s0)
 /usr/share/alsa/pcm(/.*)?	gen_context(system_u:object_r:alsa_etc_rw_t,s0)
 
-/var/lib/alsa(/.*)?		gen_context(system_u:object_r:alsa_var_lib_t,s0)
+/var/lib/alsa(/.*)?	gen_context(system_u:object_r:alsa_var_lib_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/alsa.if refpolicy/policy/modules/contrib/alsa.if
--- refpolicy/policy/modules/contrib/alsa.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/alsa.if	2012-11-01 21:37:18.845784379 +0100
@@ -1,4 +1,23 @@
-## <summary>Ainit ALSA configuration tool.</summary>
+## <summary>Advanced Linux Sound Architecture utilities.</summary>
+
+########################################
+## <summary>
+##	Role access for alsa.
+## </summary>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <param name="domain">
+##	<summary>
+##	User domain for the role.
+##	</summary>
+## </param>
+#
+template(`alsa_role',`
+	refpolicywarn(`$0($*) has been deprecated')
+')
 
 ########################################
 ## <summary>
@@ -38,11 +57,11 @@
 #
 interface(`alsa_run',`
 	gen_require(`
-		type alsa_t;
+		attribute_role alsa_roles;
 	')
 
 	alsa_domtrans($1)
-	role $2 types alsa_t;
+	roleattribute $2 alsa_roles;
 ')
 
 ########################################
@@ -83,7 +102,7 @@
 
 ########################################
 ## <summary>
-##	Read writable Alsa config files.
+##	Read writable Alsa configuration content.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -133,7 +152,8 @@
 
 ########################################
 ## <summary>
-##	Manage alsa home files.
+##	Create, read, write, and delete
+##	alsa home files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -190,6 +210,36 @@
 
 ########################################
 ## <summary>
+##	Create objects in user home
+##	directories with the generic alsa
+##	home type.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="object_class">
+##	<summary>
+##	Class of the object being created.
+##	</summary>
+## </param>
+## <param name="name" optional="true">
+##	<summary>
+##	The name of the object being created.
+##	</summary>
+## </param>
+#
+interface(`alsa_home_filetrans_alsa_home',`
+	gen_require(`
+		type alsa_home_t;
+	')
+
+	userdom_user_home_dir_filetrans($1, alsa_home_t, $2, $3)
+')
+
+########################################
+## <summary>
 ##	Read Alsa lib files.
 ## </summary>
 ## <param name="domain">
@@ -206,3 +256,33 @@
 	files_search_var_lib($1)
 	read_files_pattern($1, alsa_var_lib_t, alsa_var_lib_t)
 ')
+
+########################################
+## <summary>
+##	Mark the selected domain as an alsa-capable domain
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain that links with alsa
+##	</summary>
+## </param>
+## <param name="tmpfstype">
+##	<summary>
+##	Tmpfs type used for shared memory of the given domain
+##	</summary>
+## </param>
+#
+interface(`alsa_domain',`
+	gen_require(`
+		attribute alsadomain;
+		attribute alsatmpfsfile;
+	')
+
+	typeattribute $1 alsadomain;
+	typeattribute $2 alsatmpfsfile;
+
+	# Perhaps we can introduce a tunable for the next?
+	allow $1 alsadomain:sem create_sem_perms;
+	allow $1 alsadomain:shm rw_shm_perms;
+	allow $1 alsatmpfsfile:file rw_file_perms;
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/alsa.te refpolicy/policy/modules/contrib/alsa.te
--- refpolicy/policy/modules/contrib/alsa.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/alsa.te	2012-11-01 21:35:26.999784141 +0100
@@ -1,14 +1,16 @@
-policy_module(alsa, 1.11.0)
+policy_module(alsa, 1.11.4)
 
 ########################################
 #
 # Declarations
 #
 
+attribute_role alsa_roles;
+
 type alsa_t;
 type alsa_exec_t;
 init_system_domain(alsa_t, alsa_exec_t)
-role system_r types alsa_t;
+role alsa_roles types alsa_t;
 
 type alsa_etc_rw_t;
 files_config_file(alsa_etc_rw_t)
@@ -31,8 +33,7 @@
 dontaudit alsa_t self:capability sys_admin;
 allow alsa_t self:sem create_sem_perms;
 allow alsa_t self:shm create_shm_perms;
-allow alsa_t self:unix_stream_socket create_stream_socket_perms;
-allow alsa_t self:unix_dgram_socket create_socket_perms;
+allow alsa_t self:unix_stream_socket { accept listen };
 
 allow alsa_t alsa_home_t:file read_file_perms;
 
@@ -49,18 +50,17 @@
 
 manage_dirs_pattern(alsa_t, alsa_var_lib_t, alsa_var_lib_t)
 manage_files_pattern(alsa_t, alsa_var_lib_t, alsa_var_lib_t)
-files_search_var_lib(alsa_t)
 
 kernel_read_system_state(alsa_t)
 
+corecmd_exec_bin(alsa_t)
+
 dev_read_sound(alsa_t)
-dev_write_sound(alsa_t)
 dev_read_sysfs(alsa_t)
+dev_write_sound(alsa_t)
 
-corecmd_exec_bin(alsa_t)
-
-files_read_etc_files(alsa_t)
 files_read_usr_files(alsa_t)
+files_search_var_lib(alsa_t)
 
 term_dontaudit_use_console(alsa_t)
 term_dontaudit_use_generic_ptys(alsa_t)
@@ -78,6 +78,19 @@
 userdom_manage_unpriv_user_shared_mem(alsa_t)
 userdom_search_user_home_dirs(alsa_t)
 
+ifdef(`distro_gentoo',`
+	attribute alsadomain;
+	attribute alsatmpfsfile;
+
+	typeattribute alsa_t alsadomain;
+
+	################################
+	#
+	# alsadomain policy
+	#
+	allow alsadomain self:sem create_sem_perms;
+')
+
 optional_policy(`
 	hal_use_fds(alsa_t)
 	hal_write_log(alsa_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/amanda.fc refpolicy/policy/modules/contrib/amanda.fc
--- refpolicy/policy/modules/contrib/amanda.fc	2012-05-04 16:14:16.000000000 +0200
+++ refpolicy/policy/modules/contrib/amanda.fc	2012-09-27 20:03:30.724126498 +0200
@@ -1,26 +1,27 @@
-/etc/amanda(/.*)?			gen_context(system_u:object_r:amanda_config_t,s0)
-/etc/amanda/.*/tapelist(/.*)?		gen_context(system_u:object_r:amanda_data_t,s0)
-/etc/amandates				gen_context(system_u:object_r:amanda_amandates_t,s0)
-/etc/dumpdates				gen_context(system_u:object_r:amanda_dumpdates_t,s0)
+/etc/amanda(/.*)?	gen_context(system_u:object_r:amanda_config_t,s0)
+/etc/amanda/.*/tapelist(/.*)?	gen_context(system_u:object_r:amanda_data_t,s0)
+/etc/amandates	gen_context(system_u:object_r:amanda_amandates_t,s0)
+/etc/dumpdates	gen_context(system_u:object_r:amanda_dumpdates_t,s0)
 # empty m4 string so the index macro is not invoked
-/etc/amanda/.*/index`'(/.*)?		gen_context(system_u:object_r:amanda_data_t,s0)
+/etc/amanda/.*/index`'(/.*)?	gen_context(system_u:object_r:amanda_data_t,s0)
 
-/root/restore			-d	gen_context(system_u:object_r:amanda_recover_dir_t,s0)
+/root/restore	-d	gen_context(system_u:object_r:amanda_recover_dir_t,s0)
 
-/usr/lib/amanda			-d	gen_context(system_u:object_r:amanda_usr_lib_t,s0)
-/usr/lib/amanda/.+		--	gen_context(system_u:object_r:amanda_exec_t,s0)
-/usr/lib/amanda/amandad		--	gen_context(system_u:object_r:amanda_inetd_exec_t,s0)
+/usr/lib/amanda	-d	gen_context(system_u:object_r:amanda_usr_lib_t,s0)
+/usr/lib/amanda/.+	--	gen_context(system_u:object_r:amanda_exec_t,s0)
+/usr/lib/amanda/amandad	--	gen_context(system_u:object_r:amanda_inetd_exec_t,s0)
 /usr/lib/amanda/amidxtaped	--	gen_context(system_u:object_r:amanda_inetd_exec_t,s0)
 /usr/lib/amanda/amindexd	--	gen_context(system_u:object_r:amanda_inetd_exec_t,s0)
 
-/usr/sbin/amrecover		--	gen_context(system_u:object_r:amanda_recover_exec_t,s0)
+/usr/sbin/amandad	--	gen_context(system_u:object_r:amanda_inetd_exec_t,s0)
+/usr/sbin/amrecover	--	gen_context(system_u:object_r:amanda_recover_exec_t,s0)
 
-/var/lib/amanda			-d	gen_context(system_u:object_r:amanda_var_lib_t,s0)
-/var/lib/amanda/[^/]+(/.*)?		gen_context(system_u:object_r:amanda_data_t,s0)
-/var/lib/amanda/[^/]*/log(/.*)?		gen_context(system_u:object_r:amanda_log_t,s0)
+/var/lib/amanda	-d	gen_context(system_u:object_r:amanda_var_lib_t,s0)
+/var/lib/amanda/[^/]+(/.*)?	gen_context(system_u:object_r:amanda_data_t,s0)
+/var/lib/amanda/[^/]*/log(/.*)?	gen_context(system_u:object_r:amanda_log_t,s0)
 /var/lib/amanda/\.amandahosts	--	gen_context(system_u:object_r:amanda_config_t,s0)
 /var/lib/amanda/gnutar-lists(/.*)?	gen_context(system_u:object_r:amanda_gnutarlists_t,s0)
 # the null string in here because index is a m4 builtin function
 /var/lib/amanda/[^/]+/index`'(/.*)?	gen_context(system_u:object_r:amanda_var_lib_t,s0)
 
-/var/log/amanda(/.*)?			gen_context(system_u:object_r:amanda_log_t,s0)
+/var/log/amanda(/.*)?	gen_context(system_u:object_r:amanda_log_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/amanda.if refpolicy/policy/modules/contrib/amanda.if
--- refpolicy/policy/modules/contrib/amanda.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/amanda.if	2012-09-27 20:03:30.724126498 +0200
@@ -40,11 +40,11 @@
 #
 interface(`amanda_run_recover',`
 	gen_require(`
-		type amanda_recover_t;
+		attribute_role amanda_recover_roles;
 	')
 
 	amanda_domtrans_recover($1)
-	role $2 types amanda_recover_t;
+	roleattribute $2 amanda_recover_roles;
 ')
 
 ########################################
@@ -81,7 +81,7 @@
 		type amanda_dumpdates_t;
 	')
 
-	dontaudit $1 amanda_dumpdates_t:file { getattr read };
+	dontaudit $1 amanda_dumpdates_t:file read_file_perms;
 ')
 
 ########################################
@@ -124,7 +124,7 @@
 
 ########################################
 ## <summary>
-##	Read and append amanda logs.
+##	Read and append amanda log files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/amanda.te refpolicy/policy/modules/contrib/amanda.te
--- refpolicy/policy/modules/contrib/amanda.te	2012-07-25 20:33:04.000000000 +0200
+++ refpolicy/policy/modules/contrib/amanda.te	2012-09-27 20:03:30.724126498 +0200
@@ -1,14 +1,16 @@
-policy_module(amanda, 1.14.0)
+policy_module(amanda, 1.14.2)
 
 #######################################
 #
 # Declarations
 #
 
+attribute_role amanda_recover_roles;
+roleattribute system_r amanda_recover_roles;
+
 type amanda_t;
 type amanda_inetd_exec_t;
 inetd_service_domain(amanda_t, amanda_inetd_exec_t)
-role system_r types amanda_t;
 
 type amanda_exec_t;
 domain_entry_file(amanda_t, amanda_exec_t)
@@ -43,7 +45,7 @@
 type amanda_recover_t;
 type amanda_recover_exec_t;
 application_domain(amanda_recover_t, amanda_recover_exec_t)
-role system_r types amanda_recover_t;
+role amanda_recover_roles types amanda_recover_t;
 
 type amanda_recover_dir_t;
 files_type(amanda_recover_dir_t)
@@ -54,16 +56,14 @@
 
 ########################################
 #
-# Amanda local policy
+# Local policy
 #
 
 allow amanda_t self:capability { chown dac_override setuid kill };
 allow amanda_t self:process { setpgid signal };
 allow amanda_t self:fifo_file rw_fifo_file_perms;
-allow amanda_t self:unix_stream_socket create_stream_socket_perms;
-allow amanda_t self:unix_dgram_socket create_socket_perms;
-allow amanda_t self:tcp_socket create_stream_socket_perms;
-allow amanda_t self:udp_socket create_socket_perms;
+allow amanda_t self:unix_stream_socket { accept listen };
+allow amanda_t self:tcp_socket { accept listen };
 
 allow amanda_t amanda_amandates_t:file rw_file_perms;
 
@@ -75,9 +75,6 @@
 
 allow amanda_t amanda_dumpdates_t:file rw_file_perms;
 
-can_exec(amanda_t, amanda_exec_t)
-can_exec(amanda_t, amanda_inetd_exec_t)
-
 allow amanda_t amanda_gnutarlists_t:dir rw_dir_perms;
 allow amanda_t amanda_gnutarlists_t:file manage_file_perms;
 allow amanda_t amanda_gnutarlists_t:lnk_file manage_lnk_file_perms;
@@ -87,14 +84,16 @@
 
 manage_files_pattern(amanda_t, amanda_log_t, amanda_log_t)
 manage_dirs_pattern(amanda_t, amanda_log_t, amanda_log_t)
-logging_log_filetrans(amanda_t, amanda_log_t, { file dir })
+logging_log_filetrans(amanda_t, amanda_log_t, dir)
 
 manage_files_pattern(amanda_t, amanda_tmp_t, amanda_tmp_t)
 manage_dirs_pattern(amanda_t, amanda_tmp_t, amanda_tmp_t)
 files_tmp_filetrans(amanda_t, amanda_tmp_t, { file dir })
 
-kernel_read_system_state(amanda_t)
+can_exec(amanda_t, { amanda_exec_t amanda_inetd_exec_t })
+
 kernel_read_kernel_sysctls(amanda_t)
+kernel_read_system_state(amanda_t)
 kernel_dontaudit_getattr_unlabeled_files(amanda_t)
 kernel_dontaudit_read_proc_symlinks(amanda_t)
 
@@ -104,15 +103,11 @@
 corenet_all_recvfrom_unlabeled(amanda_t)
 corenet_all_recvfrom_netlabel(amanda_t)
 corenet_tcp_sendrecv_generic_if(amanda_t)
-corenet_udp_sendrecv_generic_if(amanda_t)
-corenet_raw_sendrecv_generic_if(amanda_t)
 corenet_tcp_sendrecv_generic_node(amanda_t)
-corenet_udp_sendrecv_generic_node(amanda_t)
-corenet_raw_sendrecv_generic_node(amanda_t)
 corenet_tcp_sendrecv_all_ports(amanda_t)
-corenet_udp_sendrecv_all_ports(amanda_t)
 corenet_tcp_bind_generic_node(amanda_t)
-corenet_udp_bind_generic_node(amanda_t)
+
+corenet_sendrecv_all_server_packets(amanda_t)
 corenet_tcp_bind_all_rpc_ports(amanda_t)
 corenet_tcp_bind_generic_port(amanda_t)
 corenet_dontaudit_tcp_bind_all_ports(amanda_t)
@@ -120,7 +115,6 @@
 dev_getattr_all_blk_files(amanda_t)
 dev_getattr_all_chr_files(amanda_t)
 
-files_read_etc_files(amanda_t)
 files_read_etc_runtime_files(amanda_t)
 files_list_all(amanda_t)
 files_read_all_files(amanda_t)
@@ -144,15 +138,14 @@
 
 ########################################
 #
-# Amanda recover local policy
+# Recover local policy
 #
 
 allow amanda_recover_t self:capability { fowner fsetid kill setgid setuid chown dac_override };
 allow amanda_recover_t self:process { sigkill sigstop signal };
 allow amanda_recover_t self:fifo_file rw_fifo_file_perms;
-allow amanda_recover_t self:unix_stream_socket { connect create read write };
-allow amanda_recover_t self:tcp_socket create_stream_socket_perms;
-allow amanda_recover_t self:udp_socket create_socket_perms;
+allow amanda_recover_t self:unix_stream_socket create_socket_perms;
+allow amanda_recover_t self:tcp_socket { accept listen };
 
 manage_files_pattern(amanda_recover_t, amanda_log_t, amanda_log_t)
 manage_lnk_files_pattern(amanda_recover_t, amanda_log_t, amanda_log_t)
@@ -171,8 +164,8 @@
 manage_sock_files_pattern(amanda_recover_t, amanda_tmp_t, amanda_tmp_t)
 files_tmp_filetrans(amanda_recover_t, amanda_tmp_t, { dir file lnk_file sock_file fifo_file })
 
-kernel_read_system_state(amanda_recover_t)
 kernel_read_kernel_sysctls(amanda_recover_t)
+kernel_read_system_state(amanda_recover_t)
 
 corecmd_exec_shell(amanda_recover_t)
 corecmd_exec_bin(amanda_recover_t)
@@ -187,16 +180,18 @@
 corenet_udp_sendrecv_all_ports(amanda_recover_t)
 corenet_tcp_bind_generic_node(amanda_recover_t)
 corenet_udp_bind_generic_node(amanda_recover_t)
+
+corenet_sendrecv_generic_server_packets(amanda_recover_t)
 corenet_tcp_bind_reserved_port(amanda_recover_t)
-corenet_tcp_connect_amanda_port(amanda_recover_t)
+
 corenet_sendrecv_amanda_client_packets(amanda_recover_t)
+corenet_tcp_connect_amanda_port(amanda_recover_t)
 
 domain_use_interactive_fds(amanda_recover_t)
 
-files_read_etc_files(amanda_recover_t)
 files_read_etc_runtime_files(amanda_recover_t)
-files_search_tmp(amanda_recover_t)
 files_search_pids(amanda_recover_t)
+files_search_tmp(amanda_recover_t)
 
 auth_use_nsswitch(amanda_recover_t)
 
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/amavis.fc refpolicy/policy/modules/contrib/amavis.fc
--- refpolicy/policy/modules/contrib/amavis.fc	2012-05-04 16:10:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/amavis.fc	2012-09-27 20:03:30.725126498 +0200
@@ -1,18 +1,28 @@
+/etc/amavis(d)?\.conf	--	gen_context(system_u:object_r:amavis_etc_t,s0)
+/etc/amavisd(/.*)?	gen_context(system_u:object_r:amavis_etc_t,s0)
 
-/etc/amavis(d)?\.conf		--	gen_context(system_u:object_r:amavis_etc_t,s0)
-/etc/amavisd(/.*)?			gen_context(system_u:object_r:amavis_etc_t,s0)
 /etc/rc\.d/init\.d/amavis	--	gen_context(system_u:object_r:amavis_initrc_exec_t,s0)
+/etc/rc\.d/init\.d/amavisd-snmp	--	gen_context(system_u:object_r:amavis_initrc_exec_t,s0)
 
-/usr/sbin/amavisd.*		--	gen_context(system_u:object_r:amavis_exec_t,s0)
 /usr/lib/AntiVir/antivir	--	gen_context(system_u:object_r:amavis_exec_t,s0)
 
+/usr/sbin/amavisd.*	--	gen_context(system_u:object_r:amavis_exec_t,s0)
+
 ifdef(`distro_debian',`
 /usr/sbin/amavisd-new-cronjob	--	gen_context(system_u:object_r:amavis_exec_t,s0)
 ')
 
-/var/amavis(/.*)?			gen_context(system_u:object_r:amavis_var_lib_t,s0)
-/var/lib/amavis(/.*)?			gen_context(system_u:object_r:amavis_var_lib_t,s0)
-/var/log/amavisd\.log		--	gen_context(system_u:object_r:amavis_var_log_t,s0)
-/var/run/amavis(d)?(/.*)?		gen_context(system_u:object_r:amavis_var_run_t,s0)
-/var/spool/amavisd(/.*)?		gen_context(system_u:object_r:amavis_spool_t,s0)
-/var/virusmails(/.*)?			gen_context(system_u:object_r:amavis_quarantine_t,s0)
+/var/opt/f-secure(/.*)?	gen_context(system_u:object_r:amavis_var_lib_t,s0)
+
+/var/amavis(/.*)?	gen_context(system_u:object_r:amavis_var_lib_t,s0)
+
+/var/lib/amavis(/.*)?	gen_context(system_u:object_r:amavis_var_lib_t,s0)
+
+/var/log/amavisd\.log.*	--	gen_context(system_u:object_r:amavis_var_log_t,s0)
+
+/var/run/amavis(d)?(/.*)?	gen_context(system_u:object_r:amavis_var_run_t,s0)
+/var/run/amavisd-snmp-subagent\.pid	--	gen_context(system_u:object_r:amavis_var_run_t,s0)
+
+/var/spool/amavisd(/.*)?	gen_context(system_u:object_r:amavis_spool_t,s0)
+
+/var/virusmails(/.*)?	gen_context(system_u:object_r:amavis_quarantine_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/amavis.if refpolicy/policy/modules/contrib/amavis.if
--- refpolicy/policy/modules/contrib/amavis.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/amavis.if	2012-10-10 21:34:23.744026215 +0200
@@ -1,7 +1,4 @@
-## <summary>
-##	Daemon that interfaces mail transfer agents and content
-##	checkers, such as virus scanners.
-## </summary>
+## <summary>High-performance interface between an email server and content checkers.</summary>
 
 ########################################
 ## <summary>
@@ -61,7 +58,8 @@
 
 ########################################
 ## <summary>
-##	Manage amavis spool files.
+##	Create, read, write, and delete
+##	amavis spool files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -99,6 +97,11 @@
 ##	Class of the object being created.
 ##	</summary>
 ## </param>
+## <param name="name" optional="true">
+##	<summary>
+##	The name of the object being created.
+##	</summary>
+## </param>
 #
 interface(`amavis_spool_filetrans',`
 	gen_require(`
@@ -106,7 +109,7 @@
 	')
 
 	files_search_spool($1)
-	filetrans_pattern($1, amavis_spool_t, $2, $3)
+	filetrans_pattern($1, amavis_spool_t, $2, $3, $4)
 ')
 
 ########################################
@@ -170,7 +173,7 @@
 
 ########################################
 ## <summary>
-##	Set the attributes of amavis pid files.
+##	Set attributes of amavis pid files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -189,7 +192,7 @@
 
 ########################################
 ## <summary>
-##	Create of amavis pid files.
+##	Create amavis pid files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -202,14 +205,15 @@
 		type amavis_var_run_t;
 	')
 
+	allow $1 amavis_var_run_t:dir add_entry_dir_perms;
 	allow $1 amavis_var_run_t:file create_file_perms;
 	files_search_pids($1)
 ')
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate
-##	an amavis environment
+##	All of the rules required to
+##	administrate an amavis environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -227,8 +231,7 @@
 	gen_require(`
 		type amavis_t, amavis_tmp_t, amavis_var_log_t;
 		type amavis_spool_t, amavis_var_lib_t, amavis_var_run_t;
-		type amavis_etc_t, amavis_quarantine_t;
-		type amavis_initrc_exec_t;
+		type amavis_etc_t, amavis_quarantine_t, amavis_initrc_exec_t;
 	')
 
 	allow $1 amavis_t:process { ptrace signal_perms };
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/amavis.te refpolicy/policy/modules/contrib/amavis.te
--- refpolicy/policy/modules/contrib/amavis.te	2012-07-25 20:33:04.000000000 +0200
+++ refpolicy/policy/modules/contrib/amavis.te	2012-09-27 20:03:30.725126498 +0200
@@ -1,39 +1,40 @@
-policy_module(amavis, 1.14.0)
+policy_module(amavis, 1.14.1)
 
 ########################################
 #
 # Declarations
 #
 
+## <desc>
+##	<p>
+##	Determine whether amavis can
+##	use JIT compiler.
+##	</p>
+## </desc>
+gen_tunable(amavis_use_jit, false)
+
 type amavis_t;
 type amavis_exec_t;
-domain_type(amavis_t)
 init_daemon_domain(amavis_t, amavis_exec_t)
 
-# configuration files
 type amavis_etc_t;
 files_config_file(amavis_etc_t)
 
 type amavis_initrc_exec_t;
 init_script_file(amavis_initrc_exec_t)
 
-# pid files
 type amavis_var_run_t;
 files_pid_file(amavis_var_run_t)
 
-# var/lib files
 type amavis_var_lib_t;
 files_type(amavis_var_lib_t)
 
-# log files
 type amavis_var_log_t;
 logging_log_file(amavis_var_log_t)
 
-# tmp files
 type amavis_tmp_t;
 files_tmp_file(amavis_tmp_t)
 
-# virus quarantine
 type amavis_quarantine_t;
 files_type(amavis_quarantine_t)
 
@@ -42,127 +43,124 @@
 
 ########################################
 #
-# amavis local policy
+# Local policy
 #
 
 allow amavis_t self:capability { kill chown dac_override setgid setuid };
 dontaudit amavis_t self:capability sys_tty_config;
-allow amavis_t self:process { signal sigchld sigkill signull };
+allow amavis_t self:process signal_perms;
 allow amavis_t self:fifo_file rw_fifo_file_perms;
-allow amavis_t self:unix_stream_socket create_stream_socket_perms;
-allow amavis_t self:unix_dgram_socket create_socket_perms;
+allow amavis_t self:unix_stream_socket { accept connectto listen };
 allow amavis_t self:tcp_socket { listen accept };
-allow amavis_t self:netlink_route_socket r_netlink_socket_perms;
 
-# configuration files
 allow amavis_t amavis_etc_t:dir list_dir_perms;
 read_files_pattern(amavis_t, amavis_etc_t, amavis_etc_t)
 read_lnk_files_pattern(amavis_t, amavis_etc_t, amavis_etc_t)
 
-can_exec(amavis_t, amavis_exec_t)
-
-# mail quarantine
 manage_dirs_pattern(amavis_t, amavis_quarantine_t, amavis_quarantine_t)
 manage_files_pattern(amavis_t, amavis_quarantine_t, amavis_quarantine_t)
 manage_sock_files_pattern(amavis_t, amavis_quarantine_t, amavis_quarantine_t)
 
-# Spool Files
 manage_dirs_pattern(amavis_t, amavis_spool_t, amavis_spool_t)
 manage_files_pattern(amavis_t, amavis_spool_t, amavis_spool_t)
 manage_lnk_files_pattern(amavis_t, amavis_spool_t, amavis_spool_t)
 manage_sock_files_pattern(amavis_t, amavis_spool_t, amavis_spool_t)
 filetrans_pattern(amavis_t, amavis_spool_t, amavis_var_run_t, sock_file)
-files_search_spool(amavis_t)
 
-# tmp files
 manage_files_pattern(amavis_t, amavis_tmp_t, amavis_tmp_t)
 allow amavis_t amavis_tmp_t:dir setattr_dir_perms;
 files_tmp_filetrans(amavis_t, amavis_tmp_t, file)
 
-# var/lib files for amavis
 manage_dirs_pattern(amavis_t, amavis_var_lib_t, amavis_var_lib_t)
 manage_files_pattern(amavis_t, amavis_var_lib_t, amavis_var_lib_t)
 manage_sock_files_pattern(amavis_t, amavis_var_lib_t, amavis_var_lib_t)
-files_search_var_lib(amavis_t)
 
-# log files
 allow amavis_t amavis_var_log_t:dir setattr_dir_perms;
 manage_files_pattern(amavis_t, amavis_var_log_t, amavis_var_log_t)
 manage_sock_files_pattern(amavis_t, amavis_var_log_t, amavis_var_log_t)
 logging_log_filetrans(amavis_t, amavis_var_log_t, { sock_file file dir })
 
-# pid file
 manage_dirs_pattern(amavis_t, amavis_var_run_t, amavis_var_run_t)
 manage_files_pattern(amavis_t, amavis_var_run_t, amavis_var_run_t)
 manage_sock_files_pattern(amavis_t, amavis_var_run_t, amavis_var_run_t)
 files_pid_filetrans(amavis_t, amavis_var_run_t, { dir file sock_file })
 
+can_exec(amavis_t, amavis_exec_t)
+
 kernel_read_kernel_sysctls(amavis_t)
-# amavis tries to access /proc/self/stat, /etc/shadow and /root - perl...
 kernel_dontaudit_list_proc(amavis_t)
 kernel_dontaudit_read_proc_symlinks(amavis_t)
 kernel_dontaudit_read_system_state(amavis_t)
 
-# find perl
 corecmd_exec_bin(amavis_t)
 corecmd_exec_shell(amavis_t)
 
 corenet_all_recvfrom_unlabeled(amavis_t)
 corenet_all_recvfrom_netlabel(amavis_t)
 corenet_tcp_sendrecv_generic_if(amavis_t)
+corenet_udp_sendrecv_generic_if(amavis_t)
 corenet_tcp_sendrecv_generic_node(amavis_t)
+corenet_udp_sendrecv_generic_node(amavis_t)
+corenet_tcp_sendrecv_all_ports(amavis_t)
+corenet_udp_sendrecv_all_ports(amavis_t)
 corenet_tcp_bind_generic_node(amavis_t)
 corenet_udp_bind_generic_node(amavis_t)
-# amavis uses well-defined ports
-corenet_tcp_sendrecv_amavisd_recv_port(amavis_t)
-corenet_tcp_sendrecv_amavisd_send_port(amavis_t)
-# just the other side not. ;-)
-corenet_tcp_sendrecv_all_ports(amavis_t)
-# connect to backchannel port
+
+corenet_sendrecv_amavisd_send_client_packets(amavis_t)
 corenet_tcp_connect_amavisd_send_port(amavis_t)
-# bind to incoming port
+
+corenet_sendrecv_amavisd_recv_server_packets(amavis_t)
 corenet_tcp_bind_amavisd_recv_port(amavis_t)
+
+corenet_sendrecv_generic_server_packets(amavis_t)
 corenet_udp_bind_generic_port(amavis_t)
 corenet_dontaudit_udp_bind_all_ports(amavis_t)
+
+corenet_sendrecv_razor_client_packets(amavis_t)
 corenet_tcp_connect_razor_port(amavis_t)
 
 dev_read_rand(amavis_t)
+dev_read_sysfs(amavis_t)
 dev_read_urand(amavis_t)
 
 domain_use_interactive_fds(amavis_t)
+domain_dontaudit_read_all_domains_state(amavis_t)
 
-files_read_etc_files(amavis_t)
 files_read_etc_runtime_files(amavis_t)
 files_read_usr_files(amavis_t)
+files_search_spool(amavis_t)
 
 fs_getattr_xattr_fs(amavis_t)
 
+auth_use_nsswitch(amavis_t)
 auth_dontaudit_read_shadow(amavis_t)
 
-# uses uptime which reads utmp - redhat bug 561383
+init_read_state(amavis_t)
 init_read_utmp(amavis_t)
 init_stream_connect_script(amavis_t)
 
 logging_send_syslog_msg(amavis_t)
 
-miscfiles_read_generic_certs(amavis_t)
 miscfiles_read_localization(amavis_t)
 
-sysnet_dns_name_resolve(amavis_t)
-sysnet_use_ldap(amavis_t)
-
 userdom_dontaudit_search_user_home_dirs(amavis_t)
 
-# Cron handling
-cron_use_fds(amavis_t)
-cron_use_system_job_fds(amavis_t)
-cron_rw_pipes(amavis_t)
-
-mta_read_config(amavis_t)
+tunable_policy(`amavis_use_jit',`
+	allow amavis_t self:process execmem;
+',`
+	dontaudit amavis_t self:process execmem;
+')
 
 optional_policy(`
 	clamav_stream_connect(amavis_t)
 	clamav_domtrans_clamscan(amavis_t)
+	clamav_read_state_clamd(amavis_t)
+')
+
+optional_policy(`
+	cron_use_fds(amavis_t)
+	cron_use_system_job_fds(amavis_t)
+	cron_rw_pipes(amavis_t)
 ')
 
 optional_policy(`
@@ -171,11 +169,12 @@
 ')
 
 optional_policy(`
-	nslcd_stream_connect(amavis_t)
+	mta_read_config(amavis_t)
 ')
 
 optional_policy(`
 	postfix_read_config(amavis_t)
+	postfix_list_spool(amavis_t)
 ')
 
 optional_policy(`
@@ -188,6 +187,10 @@
 ')
 
 optional_policy(`
+	snmp_manage_var_lib_files(amavis_t)
+')
+
+optional_policy(`
 	spamassassin_exec(amavis_t)
 	spamassassin_exec_client(amavis_t)
 	spamassassin_read_lib_files(amavis_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/amtu.fc refpolicy/policy/modules/contrib/amtu.fc
--- refpolicy/policy/modules/contrib/amtu.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/amtu.fc	2012-09-27 20:03:30.725126498 +0200
@@ -1 +1,5 @@
+/etc/rc\.d/init\.d/amtu	--	gen_context(system_u:object_r:amtu_initrc_exec_t,s0)
+
 /usr/bin/amtu	--	gen_context(system_u:object_r:amtu_exec_t,s0)
+
+/usr/sbin/amtu	--	gen_context(system_u:object_r:amtu_exec_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/amtu.if refpolicy/policy/modules/contrib/amtu.if
--- refpolicy/policy/modules/contrib/amtu.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/amtu.if	2012-09-27 20:03:30.725126498 +0200
@@ -38,9 +38,40 @@
 #
 interface(`amtu_run',`
 	gen_require(`
-		type amtu_t;
+		attribute_role amtu_roles;
 	')
 
 	amtu_domtrans($1)
-	role $2 types amtu_t;
+	roleattribute $2 amtu_roles;
+')
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an amtu environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`amtu_admin',`
+	gen_require(`
+		type amtu_t, amtu_initrc_exec_t;
+	')
+
+	allow $1 amtu_t:process { ptrace signal_perms };
+	ps_process_pattern($1, amtu_t)
+
+	init_labeled_script_domtrans($1, amtu_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 amtu_initrc_exec_t system_r;
+	allow $2 system_r;
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/amtu.te refpolicy/policy/modules/contrib/amtu.te
--- refpolicy/policy/modules/contrib/amtu.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/amtu.te	2012-09-27 20:03:30.725126498 +0200
@@ -1,18 +1,23 @@
-policy_module(amtu, 1.2.0)
+policy_module(amtu, 1.2.3)
 
 ########################################
 #
 # Declarations
 #
 
+attribute_role amtu_roles;
+
 type amtu_t;
 type amtu_exec_t;
-domain_type(amtu_t)
-domain_entry_file(amtu_t, amtu_exec_t)
+init_system_domain(amtu_t, amtu_exec_t)
+role amtu_roles types amtu_t;
+
+type amtu_initrc_exec_t;
+init_script_file(amtu_initrc_exec_t)
 
 ########################################
 #
-# amtu local policy
+# Local policy
 #
 
 kernel_read_system_state(amtu_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/anaconda.te refpolicy/policy/modules/contrib/anaconda.te
--- refpolicy/policy/modules/contrib/anaconda.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/anaconda.te	2012-09-27 20:03:30.725126498 +0200
@@ -1,4 +1,8 @@
-policy_module(anaconda, 1.6.0)
+policy_module(anaconda, 1.6.1)
+
+gen_require(`
+	class passwd all_passwd_perms;
+')
 
 ########################################
 #
@@ -8,6 +12,7 @@
 type anaconda_t;
 type anaconda_exec_t;
 domain_type(anaconda_t)
+domain_entry_file(anaconda_t, anaconda_exec_t)
 domain_obj_id_change_exemption(anaconda_t)
 role system_r types anaconda_t;
 
@@ -17,13 +22,12 @@
 #
 
 allow anaconda_t self:process execmem;
+allow anaconda_t self:passwd { rootok passwd chfn chsh };
 
 kernel_domtrans_to(anaconda_t, anaconda_exec_t)
 
 init_domtrans_script(anaconda_t)
 
-libs_domtrans_ldconfig(anaconda_t)
-
 logging_send_syslog_msg(anaconda_t)
 
 modutils_domtrans_insmod(anaconda_t)
@@ -34,10 +38,6 @@
 userdom_user_home_dir_filetrans_user_home_content(anaconda_t, { dir file lnk_file fifo_file sock_file })
 
 optional_policy(`
-	kudzu_domtrans(anaconda_t)
-')
-
-optional_policy(`
 	rpm_domtrans(anaconda_t)
 	rpm_domtrans_script(anaconda_t)
 ')
@@ -51,9 +51,5 @@
 ')
 
 optional_policy(`
-	unconfined_domain(anaconda_t)
-')
-
-optional_policy(`
-	usermanage_domtrans_admin_passwd(anaconda_t)
+	unconfined_domain_noaudit(anaconda_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/apache.fc refpolicy/policy/modules/contrib/apache.fc
--- refpolicy/policy/modules/contrib/apache.fc	2012-05-04 16:14:58.000000000 +0200
+++ refpolicy/policy/modules/contrib/apache.fc	2012-09-27 20:03:30.726126498 +0200
@@ -1,111 +1,159 @@
-HOME_DIR/((www)|(web)|(public_html))(/.+)? gen_context(system_u:object_r:httpd_user_content_t,s0)
+HOME_DIR/((www)|(web)|(public_html))(/.+)?	gen_context(system_u:object_r:httpd_user_content_t,s0)
+HOME_DIR/((www)|(web)|(public_html))/cgi-bin(/.+)?	gen_context(system_u:object_r:httpd_user_script_exec_t,s0)
+HOME_DIR/((www)|(web)|(public_html))(/.*)?/\.htaccess	--	gen_context(system_u:object_r:httpd_user_htaccess_t,s0)
+HOME_DIR/((www)|(web)|(public_html))(/.*)?/logs(/.*)?	gen_context(system_u:object_r:httpd_user_ra_content_t,s0)
+
+/etc/apache(2)?(/.*)?	gen_context(system_u:object_r:httpd_config_t,s0)
+/etc/apache-ssl(2)?(/.*)?	gen_context(system_u:object_r:httpd_config_t,s0)
+/etc/cherokee(/.*)?	gen_context(system_u:object_r:httpd_config_t,s0)
+/etc/drupal.*	gen_context(system_u:object_r:httpd_sys_rw_content_t,s0)
+/etc/htdig(/.*)?	gen_context(system_u:object_r:httpd_sys_content_t,s0)
+/etc/httpd(/.*)?	gen_context(system_u:object_r:httpd_config_t,s0)
+/etc/httpd/conf/keytab	--	gen_context(system_u:object_r:httpd_keytab_t,s0)
+/etc/httpd/logs	gen_context(system_u:object_r:httpd_log_t,s0)
+/etc/httpd/modules	gen_context(system_u:object_r:httpd_modules_t,s0)
+/etc/lighttpd(/.*)?	gen_context(system_u:object_r:httpd_config_t,s0)
+/etc/mock/koji(/.*)?	gen_context(system_u:object_r:httpd_sys_rw_content_t,s0)
 
-/etc/apache(2)?(/.*)?			gen_context(system_u:object_r:httpd_config_t,s0)
-/etc/apache-ssl(2)?(/.*)?		gen_context(system_u:object_r:httpd_config_t,s0)
-/etc/drupal(/.*)?			gen_context(system_u:object_r:httpd_sys_rw_content_t,s0)
-/etc/htdig(/.*)?			gen_context(system_u:object_r:httpd_sys_content_t,s0)
-/etc/httpd(/.*)?			gen_context(system_u:object_r:httpd_config_t,s0)
-/etc/httpd/conf/keytab		--	gen_context(system_u:object_r:httpd_keytab_t,s0)
-/etc/httpd/logs				gen_context(system_u:object_r:httpd_log_t,s0)
-/etc/httpd/modules			gen_context(system_u:object_r:httpd_modules_t,s0)
-/etc/lighttpd(/.*)?			gen_context(system_u:object_r:httpd_config_t,s0)
-/etc/mock/koji(/.*)? 			gen_context(system_u:object_r:httpd_sys_rw_content_t,s0)
+/etc/rc\.d/init\.d/cherokee	--	gen_context(system_u:object_r:httpd_initrc_exec_t,s0)
 /etc/rc\.d/init\.d/httpd	--	gen_context(system_u:object_r:httpd_initrc_exec_t,s0)
 /etc/rc\.d/init\.d/lighttpd	--	gen_context(system_u:object_r:httpd_initrc_exec_t,s0)
 
-/etc/vhosts			--	gen_context(system_u:object_r:httpd_config_t,s0)
-/etc/zabbix/web(/.*)?			gen_context(system_u:object_r:httpd_sys_rw_content_t,s0)
+/etc/vhosts	--	gen_context(system_u:object_r:httpd_config_t,s0)
+/etc/WebCalendar(/.*)?	gen_context(system_u:object_r:httpd_sys_rw_content_t,s0)
+/etc/zabbix/web(/.*)?	gen_context(system_u:object_r:httpd_sys_rw_content_t,s0)
 
-/srv/([^/]*/)?www(/.*)?			gen_context(system_u:object_r:httpd_sys_content_t,s0)
-/srv/gallery2(/.*)?			gen_context(system_u:object_r:httpd_sys_content_t,s0)
+/opt/.*\.cgi	--	gen_context(system_u:object_r:httpd_sys_script_exec_t,s0)
+/opt/dirsrv/var/run/dirsrv/dsgw/cookies(/.*)?	gen_context(system_u:object_r:httpd_var_run_t,s0)
 
-/usr/bin/htsslpass 		--	gen_context(system_u:object_r:httpd_helper_exec_t,s0)
-/usr/bin/mongrel_rails		--	gen_context(system_u:object_r:httpd_exec_t,s0)
+/srv/([^/]*/)?www(/.*)?	gen_context(system_u:object_r:httpd_sys_content_t,s0)
+/srv/gallery2(/.*)?	gen_context(system_u:object_r:httpd_sys_content_t,s0)
 
-/usr/lib/apache-ssl/.+		--	gen_context(system_u:object_r:httpd_exec_t,s0)
-/usr/lib/cgi-bin(/.*)?			gen_context(system_u:object_r:httpd_sys_script_exec_t,s0)
-/usr/lib/dirsrv/cgi-bin(/.*)?		gen_context(system_u:object_r:httpd_sys_script_exec_t,s0)
-/usr/lib/apache(/.*)?			gen_context(system_u:object_r:httpd_modules_t,s0)
-/usr/lib/apache2/modules(/.*)?		gen_context(system_u:object_r:httpd_modules_t,s0)
+/usr/.*\.cgi	--	gen_context(system_u:object_r:httpd_sys_script_exec_t,s0)
+
+/usr/bin/htsslpass	--	gen_context(system_u:object_r:httpd_helper_exec_t,s0)
+/usr/bin/mongrel_rails	--	gen_context(system_u:object_r:httpd_exec_t,s0)
+
+/usr/lib/apache-ssl/.+	--	gen_context(system_u:object_r:httpd_exec_t,s0)
+/usr/lib/apache(/.*)?	gen_context(system_u:object_r:httpd_modules_t,s0)
+/usr/lib/apache2/modules(/.*)?	gen_context(system_u:object_r:httpd_modules_t,s0)
 /usr/lib/apache(2)?/suexec(2)?	--	gen_context(system_u:object_r:httpd_suexec_exec_t,s0)
-/usr/lib/cgi-bin/(nph-)?cgiwrap(d)? --	gen_context(system_u:object_r:httpd_suexec_exec_t,s0)
-/usr/lib/httpd(/.*)?			gen_context(system_u:object_r:httpd_modules_t,s0)
-/usr/lib/lighttpd(/.*)?			gen_context(system_u:object_r:httpd_modules_t,s0)
+/usr/lib/cgi-bin(/.*)?	gen_context(system_u:object_r:httpd_sys_script_exec_t,s0)
+/usr/lib/cgi-bin/(nph-)?cgiwrap(d)?	--	gen_context(system_u:object_r:httpd_suexec_exec_t,s0)
+/usr/lib/cherokee(/.*)?	gen_context(system_u:object_r:httpd_modules_t,s0)
+/usr/lib/dirsrv/cgi-bin(/.*)?	gen_context(system_u:object_r:httpd_sys_script_exec_t,s0)
+/usr/lib/httpd(/.*)?	gen_context(system_u:object_r:httpd_modules_t,s0)
+/usr/lib/lighttpd(/.*)?	gen_context(system_u:object_r:httpd_modules_t,s0)
 
-/usr/sbin/apache(2)?		--	gen_context(system_u:object_r:httpd_exec_t,s0)
+/usr/libexec/httpd-ssl-pass-dialog	--	gen_context(system_u:object_r:httpd_passwd_exec_t,s0)
+
+/usr/sbin/apache(2)?	--	gen_context(system_u:object_r:httpd_exec_t,s0)
 /usr/sbin/apache-ssl(2)?	--	gen_context(system_u:object_r:httpd_exec_t,s0)
+/usr/sbin/cherokee	--	gen_context(system_u:object_r:httpd_exec_t,s0)
+/usr/sbin/httpd\.event	--	gen_context(system_u:object_r:httpd_exec_t,s0)
 /usr/sbin/httpd(\.worker)?	--	gen_context(system_u:object_r:httpd_exec_t,s0)
-/usr/sbin/lighttpd		--	gen_context(system_u:object_r:httpd_exec_t,s0)
-/usr/sbin/rotatelogs		--	gen_context(system_u:object_r:httpd_rotatelogs_exec_t,s0)
-/usr/sbin/suexec		--	gen_context(system_u:object_r:httpd_suexec_exec_t,s0)
+/usr/sbin/lighttpd	--	gen_context(system_u:object_r:httpd_exec_t,s0)
+/usr/sbin/rotatelogs	--	gen_context(system_u:object_r:httpd_rotatelogs_exec_t,s0)
+/usr/sbin/suexec	--	gen_context(system_u:object_r:httpd_suexec_exec_t,s0)
 
-ifdef(`distro_suse', `
-/usr/sbin/httpd2-.*		--	gen_context(system_u:object_r:httpd_exec_t,s0)
+ifdef(`distro_suse',`
+/usr/sbin/httpd2-.*	--	gen_context(system_u:object_r:httpd_exec_t,s0)
 ')
 
-/usr/share/dirsrv(/.*)?			gen_context(system_u:object_r:httpd_sys_content_t,s0)
-/usr/share/drupal(/.*)?			gen_context(system_u:object_r:httpd_sys_content_t,s0)
-/usr/share/htdig(/.*)?			gen_context(system_u:object_r:httpd_sys_content_t,s0)
-/usr/share/icecast(/.*)?		gen_context(system_u:object_r:httpd_sys_content_t,s0)
-/usr/share/mythweb(/.*)?		gen_context(system_u:object_r:httpd_sys_content_t,s0)
-/usr/share/mythweb/mythweb\.pl		gen_context(system_u:object_r:httpd_sys_script_exec_t,s0)
-/usr/share/mythtv/mythweather/scripts(/.*)? gen_context(system_u:object_r:httpd_sys_script_exec_t,s0)
-/usr/share/mythtv/data(/.*)?		gen_context(system_u:object_r:httpd_sys_content_t,s0)
-/usr/share/ntop/html(/.*)?		gen_context(system_u:object_r:httpd_sys_content_t,s0)
-/usr/share/openca/htdocs(/.*)?		gen_context(system_u:object_r:httpd_sys_content_t,s0)
-/usr/share/selinux-policy[^/]*/html(/.*)? gen_context(system_u:object_r:httpd_sys_content_t,s0)
-/usr/share/wordpress-mu/wp-config\.php	-- gen_context(system_u:object_r:httpd_sys_script_exec_t,s0)
-/usr/share/wordpress-mu/wp-content(/.*)? gen_context(system_u:object_r:httpd_sys_rw_content_t,s0)
-/usr/share/wordpress/wp-content/uploads(/.*)? gen_context(system_u:object_r:httpd_sys_rw_content_t,s0)
-
-/var/cache/httpd(/.*)?			gen_context(system_u:object_r:httpd_cache_t,s0)
-/var/cache/lighttpd(/.*)?		gen_context(system_u:object_r:httpd_cache_t,s0)
-/var/cache/mason(/.*)?			gen_context(system_u:object_r:httpd_cache_t,s0)
-/var/cache/mediawiki(/.*)?		gen_context(system_u:object_r:httpd_cache_t,s0)
-/var/cache/mod_.*			gen_context(system_u:object_r:httpd_cache_t,s0)
-/var/cache/mod_gnutls(/.*)?		gen_context(system_u:object_r:httpd_cache_t,s0)
-/var/cache/mod_proxy(/.*)?		gen_context(system_u:object_r:httpd_cache_t,s0)
-/var/cache/mod_ssl(/.*)?		gen_context(system_u:object_r:httpd_cache_t,s0)
-/var/cache/php-.*			gen_context(system_u:object_r:httpd_cache_t,s0)
+/usr/share/dirsrv(/.*)?	gen_context(system_u:object_r:httpd_sys_content_t,s0)
+/usr/share/doc/ghc/html(/.*)?	gen_context(system_u:object_r:httpd_sys_content_t,s0)
+/usr/share/drupal.*	gen_context(system_u:object_r:httpd_sys_content_t,s0)
+/usr/share/htdig(/.*)?	gen_context(system_u:object_r:httpd_sys_content_t,s0)
+/usr/share/icecast(/.*)?	gen_context(system_u:object_r:httpd_sys_content_t,s0)
+/usr/share/jetty/bin/jetty\.sh	--	gen_context(system_u:object_r:httpd_exec_t,s0)
+/usr/share/mythweb(/.*)?	gen_context(system_u:object_r:httpd_sys_content_t,s0)
+/usr/share/mythweb/mythweb\.pl	gen_context(system_u:object_r:httpd_sys_script_exec_t,s0)
+/usr/share/mythtv/mythweather/scripts(/.*)?	gen_context(system_u:object_r:httpd_sys_script_exec_t,s0)
+/usr/share/mythtv/data(/.*)?	gen_context(system_u:object_r:httpd_sys_content_t,s0)
+/usr/share/ntop/html(/.*)?	gen_context(system_u:object_r:httpd_sys_content_t,s0)
+/usr/share/openca/htdocs(/.*)?	gen_context(system_u:object_r:httpd_sys_content_t,s0)
+/usr/share/selinux-policy[^/]*/html(/.*)?	gen_context(system_u:object_r:httpd_sys_content_t,s0)
+/usr/share/wordpress/.*\.php	--	gen_context(system_u:object_r:httpd_sys_script_exec_t,s0)
+/usr/share/wordpress-mu/wp-config\.php	--	gen_context(system_u:object_r:httpd_sys_script_exec_t,s0)
+/usr/share/wordpress-mu/wp-content(/.*)?	gen_context(system_u:object_r:httpd_sys_rw_content_t,s0)
+/usr/share/wordpress/wp-content/uploads(/.*)?	gen_context(system_u:object_r:httpd_sys_rw_content_t,s0)
+/usr/share/wordpress/wp-content/upgrade(/.*)?	gen_context(system_u:object_r:httpd_sys_rw_content_t,s0)
+/usr/share/wordpress/wp-includes/.*\.php	--	gen_context(system_u:object_r:httpd_sys_script_exec_t,s0)
+
+/var/cache/httpd(/.*)?	gen_context(system_u:object_r:httpd_cache_t,s0)
+/var/cache/lighttpd(/.*)?	gen_context(system_u:object_r:httpd_cache_t,s0)
+/var/cache/mason(/.*)?	gen_context(system_u:object_r:httpd_cache_t,s0)
+/var/cache/mediawiki(/.*)?	gen_context(system_u:object_r:httpd_cache_t,s0)
+/var/cache/mod_.*	gen_context(system_u:object_r:httpd_cache_t,s0)
+/var/cache/mod_gnutls(/.*)?	gen_context(system_u:object_r:httpd_cache_t,s0)
+/var/cache/mod_proxy(/.*)?	gen_context(system_u:object_r:httpd_cache_t,s0)
+/var/cache/mod_ssl(/.*)?	gen_context(system_u:object_r:httpd_cache_t,s0)
+/var/cache/php-.*	gen_context(system_u:object_r:httpd_cache_t,s0)
 /var/cache/php-eaccelerator(/.*)?	gen_context(system_u:object_r:httpd_cache_t,s0)
-/var/cache/php-mmcache(/.*)?		gen_context(system_u:object_r:httpd_cache_t,s0)
-/var/cache/rt3(/.*)?			gen_context(system_u:object_r:httpd_cache_t,s0)
-/var/cache/ssl.*\.sem		--	gen_context(system_u:object_r:httpd_cache_t,s0)
-
-/var/lib/cacti/rra(/.*)?		gen_context(system_u:object_r:httpd_sys_content_t,s0)
-/var/lib/dav(/.*)?			gen_context(system_u:object_r:httpd_var_lib_t,s0)
-/var/lib/drupal(/.*)?			gen_context(system_u:object_r:httpd_sys_rw_content_t,s0)
-/var/lib/htdig(/.*)?			gen_context(system_u:object_r:httpd_sys_content_t,s0)
-/var/lib/httpd(/.*)?			gen_context(system_u:object_r:httpd_var_lib_t,s0)
-/var/lib/php/session(/.*)?		gen_context(system_u:object_r:httpd_var_run_t,s0)
+/var/cache/php-mmcache(/.*)?	gen_context(system_u:object_r:httpd_cache_t,s0)
+/var/cache/rt3(/.*)?	gen_context(system_u:object_r:httpd_cache_t,s0)
+/var/cache/ssl.*\.sem	--	gen_context(system_u:object_r:httpd_cache_t,s0)
+
+/var/lib/cacti/rra(/.*)?	gen_context(system_u:object_r:httpd_sys_content_t,s0)
+/var/lib/cherokee(/.*)?	gen_context(system_u:object_r:httpd_var_lib_t,s0)
+/var/lib/dav(/.*)?	gen_context(system_u:object_r:httpd_var_lib_t,s0)
+/var/lib/php(/.*)?	gen_context(system_u:object_r:httpd_var_lib_t,s0)
+/var/lib/dokuwiki(/.*)?	gen_context(system_u:object_r:httpd_sys_rw_content_t,s0)
+/var/lib/drupal.*	gen_context(system_u:object_r:httpd_sys_rw_content_t,s0)
+/var/lib/htdig(/.*)?	gen_context(system_u:object_r:httpd_sys_content_t,s0)
+/var/lib/httpd(/.*)?	gen_context(system_u:object_r:httpd_var_lib_t,s0)
+/var/lib/lighttpd(/.*)?	gen_context(system_u:object_r:httpd_var_lib_t,s0)
+/var/lib/php/session(/.*)?	gen_context(system_u:object_r:httpd_var_run_t,s0)
+/var/lib/pootle/po(/.*)?	gen_context(system_u:object_r:httpd_sys_rw_content_t,s0)
+/var/lib/rt3/data/RT-Shredder(/.*)?	gen_context(system_u:object_r:httpd_var_lib_t,s0)
 /var/lib/squirrelmail/prefs(/.*)?	gen_context(system_u:object_r:httpd_squirrelmail_t,s0)
+/var/lib/stickshift/.httpd.d(/.*)?	gen_context(system_u:object_r:httpd_config_t,s0)
+/var/lib/svn(/.*)?	gen_context(system_u:object_r:httpd_sys_rw_content_t,s0)
+/var/lib/trac(/.*)?	gen_context(system_u:object_r:httpd_sys_content_t,s0)
+
+/var/log/apache(2)?(/.*)?	gen_context(system_u:object_r:httpd_log_t,s0)
+/var/log/apache-ssl(2)?(/.*)?	gen_context(system_u:object_r:httpd_log_t,s0)
+/var/log/cacti(/.*)?	gen_context(system_u:object_r:httpd_log_t,s0)
+/var/log/cgiwrap\.log.*	--	gen_context(system_u:object_r:httpd_log_t,s0)
+/var/log/cherokee(/.*)?	gen_context(system_u:object_r:httpd_log_t,s0)
+/var/log/dirsrv/admin-serv(/.*)?	gen_context(system_u:object_r:httpd_log_t,s0)
+/var/log/httpd(/.*)?	gen_context(system_u:object_r:httpd_log_t,s0)
+/var/log/lighttpd(/.*)?	gen_context(system_u:object_r:httpd_log_t,s0)
+/var/log/piranha(/.*)?	gen_context(system_u:object_r:httpd_log_t,s0)
+/var/log/roundcubemail(/.*)?	gen_context(system_u:object_r:httpd_log_t,s0)
+/var/log/suphp\.log.*	--	gen_context(system_u:object_r:httpd_log_t,s0)
 
-/var/log/apache(2)?(/.*)?		gen_context(system_u:object_r:httpd_log_t,s0)
-/var/log/apache-ssl(2)?(/.*)?		gen_context(system_u:object_r:httpd_log_t,s0)
-/var/log/cacti(/.*)?			gen_context(system_u:object_r:httpd_log_t,s0)
-/var/log/cgiwrap\.log.*		--	gen_context(system_u:object_r:httpd_log_t,s0)
-/var/log/httpd(/.*)?			gen_context(system_u:object_r:httpd_log_t,s0)
-/var/log/lighttpd(/.*)?			gen_context(system_u:object_r:httpd_log_t,s0)
-/var/log/piranha(/.*)?			gen_context(system_u:object_r:httpd_log_t,s0)
-
-ifdef(`distro_debian', `
-/var/log/horde2(/.*)?			gen_context(system_u:object_r:httpd_log_t,s0)
+ifdef(`distro_debian',`
+/var/log/horde2(/.*)?	gen_context(system_u:object_r:httpd_log_t,s0)
 ')
 
-/var/run/apache.*			gen_context(system_u:object_r:httpd_var_run_t,s0)
-/var/run/gcache_port		-s	gen_context(system_u:object_r:httpd_var_run_t,s0)
-/var/run/httpd.*			gen_context(system_u:object_r:httpd_var_run_t,s0)
-/var/run/lighttpd(/.*)?			gen_context(system_u:object_r:httpd_var_run_t,s0)
-/var/run/mod_.*				gen_context(system_u:object_r:httpd_var_run_t,s0)
-/var/run/wsgi.*			-s	gen_context(system_u:object_r:httpd_var_run_t,s0)
-
-/var/spool/gosa(/.*)?			gen_context(system_u:object_r:httpd_sys_rw_content_t,s0)
-/var/spool/squirrelmail(/.*)?		gen_context(system_u:object_r:squirrelmail_spool_t,s0)
-/var/spool/viewvc(/.*)?			gen_context(system_u:object_r:httpd_sys_rw_content_t, s0)
-
-/var/www(/.*)?				gen_context(system_u:object_r:httpd_sys_content_t,s0)
-/var/www(/.*)?/logs(/.*)?		gen_context(system_u:object_r:httpd_log_t,s0)
-/var/www/[^/]*/cgi-bin(/.*)?		gen_context(system_u:object_r:httpd_sys_script_exec_t,s0)
-/var/www/cgi-bin(/.*)?			gen_context(system_u:object_r:httpd_sys_script_exec_t,s0)
-/var/www/icons(/.*)?			gen_context(system_u:object_r:httpd_sys_content_t,s0)
-/var/www/perl(/.*)?			gen_context(system_u:object_r:httpd_sys_script_exec_t,s0)
+/var/run/apache.*	gen_context(system_u:object_r:httpd_var_run_t,s0)
+/var/run/cherokee\.pid	--	gen_context(system_u:object_r:httpd_var_run_t,s0)
+/var/run/dirsrv/admin-serv.*	gen_context(system_u:object_r:httpd_var_run_t,s0)
+/var/run/gcache_port	-s	gen_context(system_u:object_r:httpd_var_run_t,s0)
+/var/run/httpd.*	gen_context(system_u:object_r:httpd_var_run_t,s0)
+/var/run/lighttpd(/.*)?	gen_context(system_u:object_r:httpd_var_run_t,s0)
+/var/run/mod_.*	gen_context(system_u:object_r:httpd_var_run_t,s0)
+/var/run/wsgi.*	-s	gen_context(system_u:object_r:httpd_var_run_t,s0)
+/var/run/user/apache(/.*)?	gen_context(system_u:object_r:httpd_tmp_t,s0)
+
+/var/spool/gosa(/.*)?	gen_context(system_u:object_r:httpd_sys_rw_content_t,s0)
+/var/spool/squirrelmail(/.*)?	gen_context(system_u:object_r:squirrelmail_spool_t,s0)
+/var/spool/viewvc(/.*)?	gen_context(system_u:object_r:httpd_sys_rw_content_t, s0)
+
+/var/www(/.*)?	gen_context(system_u:object_r:httpd_sys_content_t,s0)
+/var/www(/.*)?/logs(/.*)?	gen_context(system_u:object_r:httpd_log_t,s0)
+/var/www/[^/]*/cgi-bin(/.*)?	gen_context(system_u:object_r:httpd_sys_script_exec_t,s0)
+/var/www/cgi-bin(/.*)?	gen_context(system_u:object_r:httpd_sys_script_exec_t,s0)
+/var/www/gallery/albums(/.*)?	gen_context(system_u:object_r:httpd_sys_rw_content_t,s0)
+/var/www/html/[^/]*/cgi-bin(/.*)?	gen_context(system_u:object_r:httpd_sys_script_exec_t,s0)
+/var/www/html/[^/]*/sites/default/settings\.php	--	gen_context(system_u:object_r:httpd_sys_rw_content_t, s0)
+/var/www/html/[^/]*/sites/default/files(/.*)?	gen_context(system_u:object_r:httpd_sys_rw_content_t, s0)
+/var/www/html/configuration\.php	gen_context(system_u:object_r:httpd_sys_rw_content_t,s0)
+/var/www/html/wp-content(/.*)?	gen_context(system_u:object_r:httpd_sys_rw_content_t,s0)
+/var/www/icons(/.*)?	gen_context(system_u:object_r:httpd_sys_content_t,s0)
+/var/www/moodledata(/.*)?	gen_context(system_u:object_r:httpd_sys_rw_content_t,s0)
+/var/www/perl(/.*)?	gen_context(system_u:object_r:httpd_sys_script_exec_t,s0)
+/var/www/svn(/.*)?	gen_context(system_u:object_r:httpd_sys_rw_content_t,s0)
+/var/www/svn/conf(/.*)?	gen_context(system_u:object_r:httpd_sys_content_t,s0)
+/var/www/svn/hooks(/.*)?	gen_context(system_u:object_r:httpd_sys_script_exec_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/apache.if refpolicy/policy/modules/contrib/apache.if
--- refpolicy/policy/modules/contrib/apache.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/apache.if	2012-11-01 22:32:26.952791428 +0100
@@ -1,9 +1,9 @@
-## <summary>Apache web server</summary>
+## <summary>Various web servers.</summary>
 
 ########################################
 ## <summary>
-##	Create a set of derived types for apache
-##	web content.
+##	Create a set of derived types for
+##	httpd web content.
 ## </summary>
 ## <param name="prefix">
 ##	<summary>
@@ -13,30 +13,37 @@
 #
 template(`apache_content_template',`
 	gen_require(`
-		attribute httpdcontent;
-		attribute httpd_exec_scripts;
-		attribute httpd_script_exec_type;
-		type httpd_t, httpd_suexec_t, httpd_log_t;
-	')
-	# allow write access to public file transfer
-	# services files.
+		attribute httpdcontent, httpd_exec_scripts, httpd_script_exec_type;
+		attribute httpd_script_domains, httpd_htaccess_type;
+		type httpd_t, httpd_suexec_t;
+	')
+
+	########################################
+	#
+	# Declarations
+	#
+
+	## <desc>
+	##	<p>
+	##	Determine whether the script domain can
+	##	modify public files used for public file
+	##	transfer services. Directories/Files must
+	##	be labeled public_content_rw_t.
+	##	</p>
+	## </desc>
 	gen_tunable(allow_httpd_$1_script_anon_write, false)
 
-	#This type is for webpages
 	type httpd_$1_content_t, httpdcontent; # customizable
 	typealias httpd_$1_content_t alias httpd_$1_script_ro_t;
 	files_type(httpd_$1_content_t)
 
-	# This type is used for .htaccess files
-	type httpd_$1_htaccess_t; # customizable;
+	type httpd_$1_htaccess_t, httpd_htaccess_type; # customizable;
 	files_type(httpd_$1_htaccess_t)
 
-	# Type that CGI scripts run as
-	type httpd_$1_script_t;
+	type httpd_$1_script_t, httpd_script_domains;
 	domain_type(httpd_$1_script_t)
 	role system_r types httpd_$1_script_t;
 
-	# This type is used for executable scripts files
 	type httpd_$1_script_exec_t, httpd_script_exec_type; # customizable;
 	corecmd_shell_entry_type(httpd_$1_script_t)
 	domain_entry_file(httpd_$1_script_t, httpd_$1_script_exec_t)
@@ -49,37 +56,20 @@
 	typealias httpd_$1_ra_content_t alias { httpd_$1_script_ra_t httpd_$1_content_ra_t };
 	files_type(httpd_$1_ra_content_t)
 
-	read_files_pattern(httpd_t, httpd_$1_content_t, httpd_$1_htaccess_t)
-
-	domtrans_pattern(httpd_suexec_t, httpd_$1_script_exec_t, httpd_$1_script_t)
-
-	allow httpd_t { httpd_$1_content_t httpd_$1_rw_content_t httpd_$1_script_exec_t }:dir search_dir_perms;
-	allow httpd_suexec_t { httpd_$1_content_t httpd_$1_content_t httpd_$1_rw_content_t httpd_$1_script_exec_t }:dir search_dir_perms;
-
-	allow httpd_$1_script_t self:fifo_file rw_file_perms;
-	allow httpd_$1_script_t self:unix_stream_socket connectto;
-
-	allow httpd_$1_script_t httpd_t:fifo_file write;
-	# apache should set close-on-exec
-	dontaudit httpd_$1_script_t httpd_t:unix_stream_socket { read write };
-
-	# Allow the script process to search the cgi directory, and users directory
-	allow httpd_$1_script_t httpd_$1_content_t:dir search_dir_perms;
-
-	append_files_pattern(httpd_$1_script_t, httpd_log_t, httpd_log_t)
-	logging_search_logs(httpd_$1_script_t)
+	########################################
+	#
+	# Policy
+	#
 
 	can_exec(httpd_$1_script_t, httpd_$1_script_exec_t)
-	allow httpd_$1_script_t httpd_$1_script_exec_t:dir list_dir_perms;
 
-	allow httpd_$1_script_t httpd_$1_ra_content_t:dir { list_dir_perms add_entry_dir_perms };
-	read_files_pattern(httpd_$1_script_t, httpd_$1_ra_content_t, httpd_$1_ra_content_t)
-	append_files_pattern(httpd_$1_script_t, httpd_$1_ra_content_t, httpd_$1_ra_content_t)
-	read_lnk_files_pattern(httpd_$1_script_t, httpd_$1_ra_content_t, httpd_$1_ra_content_t)
-
-	allow httpd_$1_script_t httpd_$1_content_t:dir list_dir_perms;
-	read_files_pattern(httpd_$1_script_t, httpd_$1_content_t, httpd_$1_content_t)
-	read_lnk_files_pattern(httpd_$1_script_t, httpd_$1_content_t, httpd_$1_content_t)
+	allow httpd_$1_script_t httpd_$1_ra_content_t:dir { list_dir_perms add_entry_dir_perms setattr_dir_perms };
+	allow httpd_$1_script_t httpd_$1_ra_content_t:file { append_file_perms read_file_perms create_file_perms setattr_file_perms };
+	allow httpd_$1_script_t httpd_$1_ra_content_t:lnk_file read_lnk_file_perms;
+
+	allow httpd_$1_script_t { httpd_$1_content_t httpd_$1_script_exec_t }:dir list_dir_perms;
+	allow httpd_$1_script_t httpd_$1_content_t:file read_file_perms;
+	allow httpd_$1_script_t { httpd_$1_content_t httpd_$1_script_exec_t }:lnk_file read_lnk_file_perms;
 
 	manage_dirs_pattern(httpd_$1_script_t, httpd_$1_rw_content_t, httpd_$1_rw_content_t)
 	manage_files_pattern(httpd_$1_script_t, httpd_$1_rw_content_t, httpd_$1_rw_content_t)
@@ -88,114 +78,64 @@
 	manage_sock_files_pattern(httpd_$1_script_t, httpd_$1_rw_content_t, httpd_$1_rw_content_t)
 	files_tmp_filetrans(httpd_$1_script_t, httpd_$1_rw_content_t, { dir file lnk_file sock_file fifo_file })
 
-	kernel_dontaudit_search_sysctl(httpd_$1_script_t)
-	kernel_dontaudit_search_kernel_sysctl(httpd_$1_script_t)
-
-	dev_read_rand(httpd_$1_script_t)
-	dev_read_urand(httpd_$1_script_t)
-
-	corecmd_exec_all_executables(httpd_$1_script_t)
-
-	files_exec_etc_files(httpd_$1_script_t)
-	files_read_etc_files(httpd_$1_script_t)
-	files_search_home(httpd_$1_script_t)
-
-	libs_exec_ld_so(httpd_$1_script_t)
-	libs_exec_lib_files(httpd_$1_script_t)
-
-	miscfiles_read_fonts(httpd_$1_script_t)
-	miscfiles_read_public_files(httpd_$1_script_t)
-
-	seutil_dontaudit_search_config(httpd_$1_script_t)
-
-	tunable_policy(`httpd_enable_cgi && httpd_unified',`
-		allow httpd_$1_script_t httpdcontent:file entrypoint;
+	allow { httpd_t httpd_suexec_t } httpd_$1_content_t:dir list_dir_perms;
+	allow { httpd_t httpd_suexec_t } { httpd_$1_content_t httpd_$1_htaccess_t }:file read_file_perms;
+	allow { httpd_t httpd_suexec_t } httpd_$1_content_t:lnk_file read_lnk_file_perms;
+
+	ifdef(`distro_gentoo',`
+		gen_require(`
+			attribute httpd_rw_content;
+			attribute httpd_ra_content;
+			type httpd_log_t;
+		')
 
-		manage_dirs_pattern(httpd_$1_script_t, httpdcontent, httpdcontent)
-		manage_files_pattern(httpd_$1_script_t, httpdcontent, httpdcontent)
-		manage_lnk_files_pattern(httpd_$1_script_t, httpdcontent, httpdcontent)
-		can_exec(httpd_$1_script_t, httpdcontent)
+		typeattribute httpd_$1_rw_content_t httpd_rw_content;
+		typeattribute httpd_$1_ra_content_t httpd_ra_content;
 	')
 
 	tunable_policy(`allow_httpd_$1_script_anon_write',`
 		miscfiles_manage_public_files(httpd_$1_script_t)
 	')
 
-	# Allow the web server to run scripts and serve pages
 	tunable_policy(`httpd_builtin_scripting',`
 		manage_dirs_pattern(httpd_t, httpd_$1_rw_content_t, httpd_$1_rw_content_t)
 		manage_files_pattern(httpd_t, httpd_$1_rw_content_t, httpd_$1_rw_content_t)
+		manage_fifo_files_pattern(httpd_t, httpd_$1_rw_content_t, httpd_$1_rw_content_t)
 		manage_lnk_files_pattern(httpd_t, httpd_$1_rw_content_t, httpd_$1_rw_content_t)
-		rw_sock_files_pattern(httpd_t, httpd_$1_rw_content_t, httpd_$1_rw_content_t)
+		manage_sock_files_pattern(httpd_t, httpd_$1_rw_content_t, httpd_$1_rw_content_t)
 
-		allow httpd_t httpd_$1_ra_content_t:dir { list_dir_perms add_entry_dir_perms };
-		read_files_pattern(httpd_t, httpd_$1_ra_content_t, httpd_$1_ra_content_t)
-		append_files_pattern(httpd_t, httpd_$1_ra_content_t, httpd_$1_ra_content_t)
-		read_lnk_files_pattern(httpd_t, httpd_$1_ra_content_t, httpd_$1_ra_content_t)
-
-		allow httpd_t httpd_$1_content_t:dir list_dir_perms;
-		read_files_pattern(httpd_t, httpd_$1_content_t, httpd_$1_content_t)
-		read_lnk_files_pattern(httpd_t, httpd_$1_content_t, httpd_$1_content_t)
-
-		allow httpd_t httpd_$1_content_t:dir list_dir_perms;
-		read_files_pattern(httpd_t, httpd_$1_content_t, httpd_$1_content_t)
-		read_lnk_files_pattern(httpd_t, httpd_$1_content_t, httpd_$1_content_t)
+		allow httpd_t httpd_$1_ra_content_t:dir { list_dir_perms add_entry_dir_perms setattr_dir_perms };
+		allow httpd_t httpd_$1_ra_content_t:file { append_file_perms read_file_perms create_file_perms setattr_file_perms };
+		allow httpd_t httpd_$1_ra_content_t:lnk_file read_lnk_file_perms;
+	')
+
+	tunable_policy(`httpd_builtin_scripting && httpd_tmp_exec',`
+		can_exec(httpd_t, httpd_$1_rw_content_t)
 	')
 
 	tunable_policy(`httpd_enable_cgi',`
 		allow httpd_$1_script_t httpd_$1_script_exec_t:file entrypoint;
-
-		# privileged users run the script:
-		domtrans_pattern(httpd_exec_scripts, httpd_$1_script_exec_t, httpd_$1_script_t)
-
-		# apache runs the script:
-		domtrans_pattern(httpd_t, httpd_$1_script_exec_t, httpd_$1_script_t)
-
-		allow httpd_t httpd_$1_script_t:process { signal sigkill sigstop };
-		allow httpd_t httpd_$1_script_exec_t:dir list_dir_perms;
-
-		allow httpd_$1_script_t self:process { setsched signal_perms };
-		allow httpd_$1_script_t self:unix_stream_socket create_stream_socket_perms;
-
-		allow httpd_$1_script_t httpd_t:fd use;
-		allow httpd_$1_script_t httpd_t:process sigchld;
-
-		kernel_read_system_state(httpd_$1_script_t)
-
-		dev_read_urand(httpd_$1_script_t)
-
-		fs_getattr_xattr_fs(httpd_$1_script_t)
-
-		files_read_etc_runtime_files(httpd_$1_script_t)
-		files_read_usr_files(httpd_$1_script_t)
-
-		libs_read_lib_files(httpd_$1_script_t)
-
-		miscfiles_read_localization(httpd_$1_script_t)
+		domtrans_pattern({ httpd_t httpd_suexec_t httpd_exec_scripts }, httpd_$1_script_exec_t, httpd_$1_script_t)
 	')
 
-	optional_policy(`
-		tunable_policy(`httpd_enable_cgi && allow_ypbind',`
-			nis_use_ypbind_uncond(httpd_$1_script_t)
-		')
+	tunable_policy(`httpd_enable_cgi && httpd_tmp_exec',`
+		can_exec(httpd_$1_script_t, httpd_$1_rw_content_t)
 	')
 
-	optional_policy(`
-		postgresql_unpriv_client(httpd_$1_script_t)
-
-		tunable_policy(`httpd_enable_cgi && httpd_can_network_connect_db',`
-			postgresql_tcp_connect(httpd_$1_script_t)
-		')
+	tunable_policy(`httpd_enable_cgi && httpd_unified',`
+		allow httpd_$1_script_t { httpd_$1_content_t httpd_$1_ra_content_t }:file entrypoint;
+		allow httpd_$1_script_t { httpd_$1_content_t httpd_$1_ra_content_t }:dir manage_dir_perms;
+		allow httpd_$1_script_t { httpd_$1_content_t httpd_$1_ra_content_t }:file manage_file_perms;
 	')
 
-	optional_policy(`
-		nscd_socket_use(httpd_$1_script_t)
+	tunable_policy(`httpd_enable_cgi && httpd_unified && httpd_builtin_scripting',`
+		filetrans_pattern(httpd_t, httpd_$1_content_t, httpd_$1_rw_content_t, { file dir fifo_file lnk_file sock_file })
 	')
 ')
 
 ########################################
 ## <summary>
-##	Role access for apache
+##	Role access for apache.
 ## </summary>
 ## <param name="role">
 ##	<summary>
@@ -204,7 +144,7 @@
 ## </param>
 ## <param name="domain">
 ##	<summary>
-##	User domain for the role
+##	User domain for the role.
 ##	</summary>
 ## </param>
 #
@@ -218,38 +158,33 @@
 
 	role $1 types httpd_user_script_t;
 
-	allow $2 httpd_user_htaccess_t:file { manage_file_perms relabelto relabelfrom };
+	allow $2 httpd_user_htaccess_t:file { manage_file_perms relabel_file_perms };
 
-	manage_dirs_pattern($2, httpd_user_content_t, httpd_user_content_t)
-	manage_files_pattern($2, httpd_user_content_t, httpd_user_content_t)
-	manage_lnk_files_pattern($2, httpd_user_content_t, httpd_user_content_t)
-	relabel_dirs_pattern($2, httpd_user_content_t, httpd_user_content_t)
-	relabel_files_pattern($2, httpd_user_content_t, httpd_user_content_t)
-	relabel_lnk_files_pattern($2, httpd_user_content_t, httpd_user_content_t)
-
-	manage_dirs_pattern($2, httpd_user_ra_content_t, httpd_user_ra_content_t)
-	manage_files_pattern($2, httpd_user_ra_content_t, httpd_user_ra_content_t)
-	manage_lnk_files_pattern($2, httpd_user_ra_content_t, httpd_user_ra_content_t)
-	relabel_dirs_pattern($2, httpd_user_ra_content_t, httpd_user_ra_content_t)
-	relabel_files_pattern($2, httpd_user_ra_content_t, httpd_user_ra_content_t)
-	relabel_lnk_files_pattern($2, httpd_user_ra_content_t, httpd_user_ra_content_t)
-
-	manage_dirs_pattern($2, httpd_user_rw_content_t, httpd_user_rw_content_t)
-	manage_files_pattern($2, httpd_user_rw_content_t, httpd_user_rw_content_t)
-	manage_lnk_files_pattern($2, httpd_user_rw_content_t, httpd_user_rw_content_t)
-	relabel_dirs_pattern($2, httpd_user_rw_content_t, httpd_user_rw_content_t)
-	relabel_files_pattern($2, httpd_user_rw_content_t, httpd_user_rw_content_t)
-	relabel_lnk_files_pattern($2, httpd_user_rw_content_t, httpd_user_rw_content_t)
-
-	manage_dirs_pattern($2, httpd_user_script_exec_t, httpd_user_script_exec_t)
-	manage_files_pattern($2, httpd_user_script_exec_t, httpd_user_script_exec_t)
-	manage_lnk_files_pattern($2, httpd_user_script_exec_t, httpd_user_script_exec_t)
-	relabel_dirs_pattern($2, httpd_user_script_exec_t, httpd_user_script_exec_t)
-	relabel_files_pattern($2, httpd_user_script_exec_t, httpd_user_script_exec_t)
-	relabel_lnk_files_pattern($2, httpd_user_script_exec_t, httpd_user_script_exec_t)
+	allow $2 httpd_user_content_t:dir { manage_dir_perms relabel_dir_perms };
+	allow $2 httpd_user_content_t:file { manage_file_perms relabel_file_perms };
+	allow $2 httpd_user_content_t:lnk_file { manage_lnk_file_perms relabel_lnk_file_perms };
+
+	allow $2 httpd_user_ra_content_t:dir { manage_dir_perms relabel_dir_perms };
+	allow $2 httpd_user_ra_content_t:file { manage_file_perms relabel_file_perms };
+	allow $2 httpd_user_ra_content_t:lnk_file { manage_lnk_file_perms relabel_lnk_file_perms };
+
+	allow $2 httpd_user_rw_content_t:dir { manage_dir_perms relabel_dir_perms };
+	allow $2 httpd_user_rw_content_t:file { manage_file_perms relabel_file_perms };
+	allow $2 httpd_user_rw_content_t:lnk_file { manage_lnk_file_perms relabel_lnk_file_perms };
+
+	allow $2 httpd_user_script_exec_t:dir { manage_dir_perms relabel_dir_perms };
+	allow $2 httpd_user_script_exec_t:file { manage_file_perms relabel_file_perms };
+	allow $2 httpd_user_script_exec_t:lnk_file { manage_lnk_file_perms relabel_lnk_file_perms };
+
+	userdom_user_home_dir_filetrans($2, httpd_user_content_t, dir, "public_html")
+	userdom_user_home_dir_filetrans($2, httpd_user_content_t, dir, "web")
+	userdom_user_home_dir_filetrans($2, httpd_user_content_t, dir, "www")
+
+	filetrans_pattern($2, httpd_user_content_t, httpd_user_htaccess_t, file, ".htaccess")
+	filetrans_pattern($2, httpd_user_content_t, httpd_user_script_exec_t, dir, "cgi-bin")
+	filetrans_pattern($2, httpd_user_content_t, httpd_user_ra_content_t, dir, "logs")
 
 	tunable_policy(`httpd_enable_cgi',`
-		# If a user starts a script by hand it gets the proper context
 		domtrans_pattern($2, httpd_user_script_exec_t, httpd_user_script_t)
 	')
 
@@ -260,7 +195,7 @@
 
 ########################################
 ## <summary>
-##	Read httpd user scripts executables.
+##	Read user httpd script executable files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -280,7 +215,7 @@
 
 ########################################
 ## <summary>
-##	Read user web content.
+##	Read user httpd content.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -300,7 +235,7 @@
 
 ########################################
 ## <summary>
-##	Transition to apache.
+##	Execute httpd with a domain transition.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -317,9 +252,27 @@
 	domtrans_pattern($1, httpd_exec_t, httpd_t)
 ')
 
+########################################
+## <summary>
+##	Execute httpd server in the httpd domain.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed to transition.
+##	</summary>
+## </param>
+#
+interface(`apache_initrc_domtrans',`
+	gen_require(`
+		type httpd_initrc_exec_t;
+	')
+
+	init_labeled_script_domtrans($1, httpd_initrc_exec_t)
+')
+
 #######################################
 ## <summary>
-##	Send a generic signal to apache.
+##	Send generic signals to httpd.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -337,7 +290,7 @@
 
 ########################################
 ## <summary>
-##	Send a null signal to apache.
+##	Send null signals to httpd.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -355,7 +308,7 @@
 
 ########################################
 ## <summary>
-##	Send a SIGCHLD signal to apache.
+##	Send child terminated signals to httpd.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -373,7 +326,8 @@
 
 ########################################
 ## <summary>
-##	Inherit and use file descriptors from Apache.
+##	Inherit and use file descriptors
+##	from httpd.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -391,8 +345,8 @@
 
 ########################################
 ## <summary>
-##	Do not audit attempts to read and write Apache
-##	unnamed pipes.
+##	Do not audit attempts to read and
+##	write httpd unnamed pipes.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -410,8 +364,8 @@
 
 ########################################
 ## <summary>
-##	Do not audit attempts to read and write Apache
-##	unix domain stream sockets.
+##	Do not audit attempts to read and
+##	write httpd unix domain stream sockets.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -429,8 +383,8 @@
 
 ########################################
 ## <summary>
-##	Do not audit attempts to read and write Apache
-##	TCP sockets.
+##	Do not audit attempts to read and
+##	write httpd TCP sockets.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -448,7 +402,8 @@
 
 ########################################
 ## <summary>
-##	Create, read, write, and delete all web content.
+##	Create, read, write, and delete
+##	all httpd content.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -473,8 +428,7 @@
 
 ########################################
 ## <summary>
-##	Allow domain to  set the attributes
-##	of the APACHE cache directory.
+##	Set attributes httpd cache directories.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -487,13 +441,12 @@
 		type httpd_cache_t;
 	')
 
-	allow $1 httpd_cache_t:dir setattr;
+	allow $1 httpd_cache_t:dir setattr_dir_perms;
 ')
 
 ########################################
 ## <summary>
-##	Allow the specified domain to list
-##	Apache cache.
+##	List httpd cache directories.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -511,8 +464,7 @@
 
 ########################################
 ## <summary>
-##	Allow the specified domain to read
-##	and write Apache cache files.
+##	Read and write httpd cache files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -530,8 +482,25 @@
 
 ########################################
 ## <summary>
-##	Allow the specified domain to delete
-##	Apache cache.
+##	Delete httpd cache directories.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`apache_delete_cache_dirs',`
+	gen_require(`
+		type httpd_cache_t;
+	')
+
+	delete_dirs_pattern($1, httpd_cache_t, httpd_cache_t)
+')
+
+########################################
+## <summary>
+##	Delete httpd cache files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -549,8 +518,7 @@
 
 ########################################
 ## <summary>
-##	Allow the specified domain to read
-##	apache configuration files.
+##	Read httpd configuration files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -572,8 +540,27 @@
 
 ########################################
 ## <summary>
-##	Allow the specified domain to manage
-##	apache configuration files.
+##	Search httpd configuration directories.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`apache_search_config',`
+	gen_require(`
+		type httpd_config_t;
+	')
+
+	files_search_etc($1)
+	allow $1 httpd_config_t:dir search_dir_perms;
+')
+
+########################################
+## <summary>
+##	Create, read, write, and delete
+##	httpd configuration files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -594,8 +581,8 @@
 
 ########################################
 ## <summary>
-##	Execute the Apache helper program with
-##	a domain transition.
+##	Execute the Apache helper program
+##	with a domain transition.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -632,17 +619,16 @@
 #
 interface(`apache_run_helper',`
 	gen_require(`
-		type httpd_helper_t;
+		attribute_role httpd_helper_roles;
 	')
 
 	apache_domtrans_helper($1)
-	role $2 types httpd_helper_t;
+	roleattribute $2 httpd_helper_roles;
 ')
 
 ########################################
 ## <summary>
-##	Allow the specified domain to read
-##	apache log files.
+##	Read httpd log files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -664,8 +650,7 @@
 
 ########################################
 ## <summary>
-##	Allow the specified domain to append
-##	to apache log files.
+##	Append httpd log files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -685,8 +670,8 @@
 
 ########################################
 ## <summary>
-##	Do not audit attempts to append to the
-##	Apache logs.
+##	Do not audit attempts to append
+##	httpd log files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -699,13 +684,13 @@
 		type httpd_log_t;
 	')
 
-	dontaudit $1 httpd_log_t:file { getattr append };
+	dontaudit $1 httpd_log_t:file append_file_perms;
 ')
 
 ########################################
 ## <summary>
-##	Allow the specified domain to manage
-##	to apache log files.
+##	Create, read, write, and delete
+##	httpd log files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -726,8 +711,8 @@
 
 ########################################
 ## <summary>
-##	Do not audit attempts to search Apache
-##	module directories.
+##	Do not audit attempts to search
+##	httpd module directories.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -745,9 +730,7 @@
 
 ########################################
 ## <summary>
-##	Allow the specified domain to list
-##	the contents of the apache modules
-##	directory.
+##	List httpd module directories.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -765,8 +748,7 @@
 
 ########################################
 ## <summary>
-##	Allow the specified domain to execute
-##	apache modules.
+##	Execute httpd module files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -786,7 +768,27 @@
 
 ########################################
 ## <summary>
-##	Execute a domain transition to run httpd_rotatelogs.
+##	Read httpd module files.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`apache_read_module_files',`
+	gen_require(`
+		type httpd_modules_t;
+	')
+
+	libs_search_lib($1)
+	read_files_pattern($1, httpd_modules_t, httpd_modules_t)
+')
+
+########################################
+## <summary>
+##	Execute a domain transition to
+##	run httpd_rotatelogs.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -799,13 +801,13 @@
 		type httpd_rotatelogs_t, httpd_rotatelogs_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, httpd_rotatelogs_exec_t, httpd_rotatelogs_t)
 ')
 
 ########################################
 ## <summary>
-##	Allow the specified domain to list
-##	apache system content files.
+##	List httpd system content directories.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -824,8 +826,8 @@
 
 ########################################
 ## <summary>
-##	Allow the specified domain to manage
-##	apache system content files.
+##	Create, read, write, and delete
+##	httpd system content files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -834,7 +836,6 @@
 ## </param>
 ## <rolecap/>
 #
-# Note that httpd_sys_content_t is found in /var, /etc, /srv and /usr
 interface(`apache_manage_sys_content',`
 	gen_require(`
 		type httpd_sys_content_t;
@@ -848,8 +849,30 @@
 
 ########################################
 ## <summary>
-##	Execute all web scripts in the system
-##	script domain.
+##	Create, read, write, and delete
+##	httpd system rw content.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`apache_manage_sys_rw_content',`
+	gen_require(`
+		type httpd_sys_rw_content_t;
+	')
+
+	apache_search_sys_content($1)
+	manage_dirs_pattern($1, httpd_sys_rw_content_t, httpd_sys_rw_content_t)
+	manage_files_pattern($1,httpd_sys_rw_content_t, httpd_sys_rw_content_t)
+	manage_lnk_files_pattern($1, httpd_sys_rw_content_t, httpd_sys_rw_content_t)
+')
+
+########################################
+## <summary>
+##	Execute all httpd scripts in the
+##	system script domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -857,8 +880,6 @@
 ##	</summary>
 ## </param>
 #
-# cjp: this interface specifically added to allow
-# sysadm_t to run scripts
 interface(`apache_domtrans_sys_script',`
 	gen_require(`
 		attribute httpdcontent;
@@ -872,8 +893,9 @@
 
 ########################################
 ## <summary>
-##	Do not audit attempts to read and write Apache
-##	system script unix domain stream sockets.
+##	Do not audit attempts to read and
+##	write httpd system script unix
+##	domain stream sockets.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -911,7 +933,7 @@
 ########################################
 ## <summary>
 ##	Execute all user scripts in the user
-##	script domain.  Add user script domains
+##	script domain. Add user script domains
 ##	to the specified role.
 ## </summary>
 ## <param name="domain">
@@ -921,7 +943,7 @@
 ## </param>
 ## <param name="role">
 ##	<summary>
-##	Role allowed access..
+##	Role allowed access.
 ##	</summary>
 ## </param>
 #
@@ -936,8 +958,7 @@
 
 ########################################
 ## <summary>
-##	Allow the specified domain to read
-##	apache squirrelmail data.
+##	Read httpd squirrelmail data files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -955,8 +976,7 @@
 
 ########################################
 ## <summary>
-##	Allow the specified domain to append
-##	apache squirrelmail data.
+##	Append httpd squirrelmail data files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -974,7 +994,7 @@
 
 ########################################
 ## <summary>
-##	Search apache system content.
+##	Search httpd system content.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -987,12 +1007,13 @@
 		type httpd_sys_content_t;
 	')
 
+	files_search_var($1)
 	allow $1 httpd_sys_content_t:dir search_dir_perms;
 ')
 
 ########################################
 ## <summary>
-##	Read apache system content.
+##	Read httpd system content.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -1012,7 +1033,7 @@
 
 ########################################
 ## <summary>
-##	Search apache system CGI directories.
+##	Search httpd system CGI directories.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -1030,7 +1051,8 @@
 
 ########################################
 ## <summary>
-##	Create, read, write, and delete all user web content.
+##	Create, read, write, and delete all
+##	user httpd content.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -1040,22 +1062,13 @@
 ## <rolecap/>
 #
 interface(`apache_manage_all_user_content',`
-	gen_require(`
-		attribute httpd_user_content_type, httpd_user_script_exec_type;
-	')
-
-	manage_dirs_pattern($1, httpd_user_content_type, httpd_user_content_type)
-	manage_files_pattern($1, httpd_user_content_type, httpd_user_content_type)
-	manage_lnk_files_pattern($1, httpd_user_content_type, httpd_user_content_type)
-
-	manage_dirs_pattern($1, httpd_user_script_exec_type, httpd_user_script_exec_type)
-	manage_files_pattern($1, httpd_user_script_exec_type, httpd_user_script_exec_type)
-	manage_lnk_files_pattern($1, httpd_user_script_exec_type, httpd_user_script_exec_type)
+	refpolicywarn(`$0($*) has been deprecated, use apache_manage_all_content() instead.')
+	apache_manage_all_content($1)
 ')
 
 ########################################
 ## <summary>
-##	Search system script state directory.
+##	Search system script state directories.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -1073,8 +1086,7 @@
 
 ########################################
 ## <summary>
-##	Allow the specified domain to read
-##	apache tmp files.
+##	Read httpd tmp files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -1093,8 +1105,8 @@
 
 ########################################
 ## <summary>
-##	Dontaudit attempts to write
-##	apache tmp files.
+##	Do not audit attempts to write
+##	httpd tmp files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -1116,9 +1128,6 @@
 ## </summary>
 ##	<desc>
 ##	<p>
-##	Execute CGI in the specified domain.
-##	</p>
-##	<p>
 ##	This is an interface to support third party modules
 ##	and its use is not allowed in upstream reference
 ##	policy.
@@ -1148,14 +1157,9 @@
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate an apache environment
+##	All of the rules required to
+##	administrate an apache environment.
 ## </summary>
-## <param name="prefix">
-##	<summary>
-##	Prefix of the domain. Example, user would be
-##	the prefix for the uder_t domain.
-##	</summary>
-## </param>
 ## <param name="domain">
 ##	<summary>
 ##	Domain allowed access.
@@ -1170,18 +1174,19 @@
 #
 interface(`apache_admin',`
 	gen_require(`
-		attribute httpdcontent;
-		attribute httpd_script_exec_type;
-
+		attribute httpdcontent, httpd_script_exec_type;
+		attribute httpd_script_domains, httpd_htaccess_type;
 		type httpd_t, httpd_config_t, httpd_log_t;
-		type httpd_modules_t, httpd_lock_t;
-		type httpd_var_run_t, httpd_php_tmp_t;
-		type httpd_suexec_tmp_t, httpd_tmp_t;
-		type httpd_initrc_exec_t;
+		type httpd_modules_t, httpd_lock_t, httpd_helper_t;
+		type httpd_var_run_t, httpd_keytab_t, httpd_passwd_t;
+		type httpd_suexec_tmp_t, httpd_tmp_t, httpd_rotatelogs_t;
+		type httpd_initrc_exec_t, httpd_suexec_t;
 	')
 
-	allow $1 httpd_t:process { getattr ptrace signal_perms };
-	ps_process_pattern($1, httpd_t)
+	allow $1 { httpd_script_domains httpd_t httpd_helper_t }:process { ptrace signal_perms };
+	allow $1 { httpd_rotatelogs_t httpd_suexec_t httpd_passwd_t }:process { ptrace signal_perms };
+	ps_process_pattern($1, { httpd_script_domains httpd_t httpd_helper_t })
+	ps_process_pattern($1, { httpd_rotatelogs_t httpd_suexec_t httpd_passwd_t })
 
 	init_labeled_script_domtrans($1, httpd_initrc_exec_t)
 	domain_system_change_exemption($1)
@@ -1192,7 +1197,7 @@
 	miscfiles_manage_public_files($1)
 
 	files_search_etc($1)
-	admin_pattern($1, httpd_config_t)
+	admin_pattern($1, { httpd_config_t httpd_keytab_t })
 
 	logging_search_logs($1)
 	admin_pattern($1, httpd_log_t)
@@ -1205,14 +1210,131 @@
 	admin_pattern($1, httpd_var_run_t)
 	files_pid_filetrans($1, httpd_var_run_t, file)
 
-	kernel_search_proc($1)
-	allow $1 httpd_t:dir list_dir_perms;
+	admin_pattern($1, { httpdcontent httpd_script_exec_type httpd_htaccess_type })
+	admin_pattern($1, { httpd_tmp_t httpd_suexec_tmp_t })
+
+	apache_run_all_scripts($1, $2)
+	apache_run_helper($1, $2)
+')
+
+########################################
+## <summary>
+##	Read all appendable content.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`apache_read_all_ra_content',`
+	gen_require(`
+		attribute httpd_ra_content;
+	')
+
+	read_files_pattern($1, httpd_ra_content, httpd_ra_content)
+	read_lnk_files_pattern($1, httpd_ra_content, httpd_ra_content)
+')
+
+########################################
+## <summary>
+##	Append to all appendable web content files.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`apache_append_all_ra_content',`
+	gen_require(`
+		attribute httpd_ra_content;
+	')
+
+	apache_search_all_content($1)
+	append_files_pattern($1, httpd_ra_content, httpd_ra_content)
+')
 
-	read_lnk_files_pattern($1, httpd_t, httpd_t)
+########################################
+## <summary>
+##	Read all read/write content.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`apache_read_all_rw_content',`
+	gen_require(`
+		attribute httpd_rw_content;
+	')
+
+	read_files_pattern($1, httpd_rw_content, httpd_rw_content)
+	read_lnk_files_pattern($1, httpd_rw_content, httpd_rw_content)
+')
+
+########################################
+## <summary>
+##	Manage all read/write content.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`apache_manage_all_rw_content',`
+	gen_require(`
+		attribute httpd_rw_content;
+	')
+
+	manage_dirs_pattern($1, httpd_rw_content, httpd_rw_content)
+	manage_files_pattern($1, httpd_rw_content, httpd_rw_content)
+	manage_lnk_files_pattern($1, httpd_rw_content, httpd_rw_content)
+')
+
+########################################
+## <summary>
+##	Read all web content.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`apache_read_all_content',`
+	gen_require(`
+		attribute httpdcontent, httpd_script_exec_type;
+	')
+
+	read_files_pattern($1, httpdcontent, httpdcontent)
+	read_lnk_files_pattern($1, httpdcontent, httpdcontent)
+
+	read_files_pattern($1, httpd_script_exec_type, httpd_script_exec_type)
+	read_lnk_files_pattern($1, httpd_script_exec_type, httpd_script_exec_type)
+')
+
+########################################
+## <summary>
+##	Search all apache content.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`apache_search_all_content',`
+	gen_require(`
+		attribute httpdcontent;
+	')
 
-	admin_pattern($1, httpdcontent)
-	admin_pattern($1, httpd_script_exec_type)
-	admin_pattern($1, httpd_tmp_t)
-	admin_pattern($1, httpd_php_tmp_t)
-	admin_pattern($1, httpd_suexec_tmp_t)
+	allow $1 httpdcontent:dir search_dir_perms;
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/apache.te refpolicy/policy/modules/contrib/apache.te
--- refpolicy/policy/modules/contrib/apache.te	2012-07-25 20:33:04.000000000 +0200
+++ refpolicy/policy/modules/contrib/apache.te	2012-11-14 20:06:26.809495282 +0100
@@ -1,17 +1,4 @@
-policy_module(apache, 2.4.0)
-
-#
-# NOTES:
-#  This policy will work with SUEXEC enabled as part of the Apache
-#  configuration. However, the user CGI scripts will run under the
-#  system_u:system_r:httpd_user_script_t.
-#
-#  The user CGI scripts must be labeled with the httpd_user_script_exec_t
-#  type, and the directory containing the scripts should also be labeled
-#  with these types. This policy allows the user role to perform that
-#  relabeling. If it is desired that only admin role should be able to relabel
-#  the user CGI scripts, then relabel rule for user roles should be removed.
-#
+policy_module(apache, 2.6.4)
 
 ########################################
 #
@@ -19,167 +6,279 @@
 #
 
 ## <desc>
-## <p>
-## Allow Apache to modify public files
-## used for public file transfer services. Directories/Files must
-## be labeled public_content_rw_t.
-## </p>
+##	<p>
+##	Determine whether httpd can modify
+##	public files used for public file
+##	transfer services. Directories/Files must
+##	be labeled public_content_rw_t.
+##	</p>
 ## </desc>
 gen_tunable(allow_httpd_anon_write, false)
 
 ## <desc>
-## <p>
-## Allow Apache to use mod_auth_pam
-## </p>
+##	<p>
+##	Determine whether httpd can use mod_auth_pam.
+##	</p>
 ## </desc>
 gen_tunable(allow_httpd_mod_auth_pam, false)
 
 ## <desc>
-## <p>
-## Allow httpd to use built in scripting (usually php)
-## </p>
+##	<p>
+##	Determine whether httpd can use built in scripting.
+##	</p>
 ## </desc>
 gen_tunable(httpd_builtin_scripting, false)
 
 ## <desc>
-## <p>
-## Allow HTTPD scripts and modules to connect to the network using TCP.
-## </p>
+##	<p>
+##	Determine whether httpd can check spam.
+##	</p>
+## </desc>
+gen_tunable(httpd_can_check_spam, false)
+
+## <desc>
+##	<p>
+##	Determine whether httpd scripts and modules
+##	can connect to the network using TCP.
+##	</p>
 ## </desc>
 gen_tunable(httpd_can_network_connect, false)
 
 ## <desc>
-## <p>
-## Allow HTTPD scripts and modules to connect to databases over the network.
-## </p>
+##	<p>
+##	Determine whether httpd scripts and modules
+##	can connect to cobbler over the network.
+##	</p>
+## </desc>
+gen_tunable(httpd_can_network_connect_cobbler, false)
+
+## <desc>
+##	<p>
+##	Determine whether scripts and modules can
+##	connect to databases over the network.
+##	</p>
 ## </desc>
 gen_tunable(httpd_can_network_connect_db, false)
 
 ## <desc>
-## <p>
-## Allow httpd to act as a relay
-## </p>
+##	<p>
+##	Determine whether httpd can connect to
+##	ldap over the network.
+##	</p>
+## </desc>
+gen_tunable(httpd_can_network_connect_ldap, false)
+
+## <desc>
+##	<p>
+##	Determine whether httpd can connect
+##	to memcache server over the network.
+##	</p>
+## </desc>
+gen_tunable(httpd_can_network_connect_memcache, false)
+
+## <desc>
+##	<p>
+##	Determine whether httpd can act as a relay.
+##	</p>
 ## </desc>
 gen_tunable(httpd_can_network_relay, false)
 
 ## <desc>
-## <p>
-## Allow http daemon to send mail
-## </p>
+##	<p>
+##	Determine whether httpd daemon can
+##	connect to zabbix over the network.
+##	</p>
+## </desc>
+gen_tunable(httpd_can_network_connect_zabbix, false)
+
+## <desc>
+##	<p>
+##	Determine whether httpd can send mail.
+##	</p>
 ## </desc>
 gen_tunable(httpd_can_sendmail, false)
 
 ## <desc>
-## <p>
-## Allow Apache to communicate with avahi service via dbus
-## </p>
+##	<p>
+##	Determine whether httpd can communicate
+##	with avahi service via dbus.
+##	</p>
 ## </desc>
 gen_tunable(httpd_dbus_avahi, false)
 
 ## <desc>
-## <p>
-## Allow httpd cgi support
-## </p>
+##	<p>
+##	Determine wether httpd can use support.
+##	</p>
 ## </desc>
 gen_tunable(httpd_enable_cgi, false)
 
 ## <desc>
-## <p>
-## Allow httpd to act as a FTP server by
-## listening on the ftp port.
-## </p>
+##	<p>
+##	Determine whether httpd can act as a
+##	FTP server by listening on the ftp port.
+##	</p>
 ## </desc>
 gen_tunable(httpd_enable_ftp_server, false)
 
 ## <desc>
-## <p>
-## Allow httpd to read home directories
-## </p>
+##	<p>
+##	Determine whether httpd can traverse
+##	user home directories.
+##	</p>
 ## </desc>
 gen_tunable(httpd_enable_homedirs, false)
 
 ## <desc>
-## <p>
-## Allow httpd daemon to change its resource limits
-## </p>
+##	<p>
+##	Determine whether httpd gpg can modify
+##	public files used for public file
+##	transfer services. Directories/Files must
+##	be labeled public_content_rw_t.
+##	</p>
+## </desc>
+gen_tunable(httpd_gpg_anon_write, false)
+
+## <desc>
+##	<p>
+##	Determine whether httpd can execute
+##	its temporary content.
+##	</p>
+## </desc>
+gen_tunable(httpd_tmp_exec, false)
+
+## <desc>
+##	<p>
+##	Determine whether httpd scripts and
+##	modules can use execmem and execstack.
+##	</p>
+## </desc>
+gen_tunable(httpd_execmem, false)
+
+## <desc>
+##	<p>
+##	Determine whether httpd can connect
+##	to port 80 for graceful shutdown.
+##	</p>
+## </desc>
+gen_tunable(httpd_graceful_shutdown, false)
+
+## <desc>
+##	<p>
+##	Determine whether httpd can
+##	manage IPA content files.
+##	</p>
+## </desc>
+gen_tunable(httpd_manage_ipa, false)
+
+## <desc>
+##	<p>
+##	Determine whether httpd can use mod_auth_ntlm_winbind.
+##	</p>
+## </desc>
+gen_tunable(httpd_mod_auth_ntlm_winbind, false)
+
+## <desc>
+##	<p>
+##	Determine whether httpd can read
+##	generic user home content files.
+##	</p>
+## </desc>
+gen_tunable(httpd_read_user_content, false)
+
+## <desc>
+##	<p>
+##	Determine whether httpd can change
+##	its resource limits.
+##	</p>
 ## </desc>
 gen_tunable(httpd_setrlimit, false)
 
 ## <desc>
-## <p>
-## Allow HTTPD to run SSI executables in the same domain as system CGI scripts.
-## </p>
+##	<p>
+##	Determine whether httpd can run
+##	SSI executables in the same domain
+##	as system CGI scripts.
+##	</p>
 ## </desc>
 gen_tunable(httpd_ssi_exec, false)
 
 ## <desc>
-## <p>
-## Unify HTTPD to communicate with the terminal.
-## Needed for entering the passphrase for certificates at
-## the terminal.
-## </p>
+##	<p>
+##	Determine whether httpd can communicate
+##	with the terminal. Needed for entering the
+##	passphrase for certificates at the terminal.
+##	</p>
 ## </desc>
 gen_tunable(httpd_tty_comm, false)
 
 ## <desc>
-## <p>
-## Unify HTTPD handling of all content files.
-## </p>
+##	<p>
+##	Determine whether httpd can have full access
+##	to its content types.
+##	</p>
 ## </desc>
 gen_tunable(httpd_unified, false)
 
 ## <desc>
-## <p>
-## Allow httpd to access cifs file systems
-## </p>
+##	<p>
+##	Determine whether httpd can use
+##	cifs file systems.
+##	</p>
 ## </desc>
 gen_tunable(httpd_use_cifs, false)
 
 ## <desc>
-## <p>
-## Allow httpd to run gpg
-## </p>
+##	<p>
+##	Determine whether httpd can
+##	use fuse file systems.
+##	</p>
+## </desc>
+gen_tunable(httpd_use_fusefs, false)
+
+## <desc>
+##	<p>
+##	Determine whether httpd can use gpg.
+##	</p>
 ## </desc>
 gen_tunable(httpd_use_gpg, false)
 
 ## <desc>
-## <p>
-## Allow httpd to access nfs file systems
-## </p>
+##	<p>
+##	Determine whether httpd can use
+##	nfs file systems.
+##	</p>
 ## </desc>
 gen_tunable(httpd_use_nfs, false)
 
 attribute httpdcontent;
-attribute httpd_user_content_type;
+attribute httpd_htaccess_type;
 
-# domains that can exec all users scripts
+# domains that can exec all scripts
 attribute httpd_exec_scripts;
 
 attribute httpd_script_exec_type;
-attribute httpd_user_script_exec_type;
 
-# user script domains
+# all script domains
 attribute httpd_script_domains;
 
+attribute_role httpd_helper_roles;
+roleattribute system_r httpd_helper_roles;
+
 type httpd_t;
 type httpd_exec_t;
 init_daemon_domain(httpd_t, httpd_exec_t)
-role system_r types httpd_t;
 
-# httpd_cache_t is the type given to the /var/cache/httpd
-# directory and the files under that directory
 type httpd_cache_t;
 files_type(httpd_cache_t)
 
-# httpd_config_t is the type given to the configuration files
 type httpd_config_t;
-files_type(httpd_config_t)
+files_config_file(httpd_config_t)
 
 type httpd_helper_t;
 type httpd_helper_exec_t;
-domain_type(httpd_helper_t)
-domain_entry_file(httpd_helper_t, httpd_helper_exec_t)
-role system_r types httpd_helper_t;
+application_domain(httpd_helper_t, httpd_helper_exec_t)
+role httpd_helper_roles types httpd_helper_t;
 
 type httpd_initrc_exec_t;
 init_script_file(httpd_initrc_exec_t)
@@ -190,20 +289,9 @@
 type httpd_log_t;
 logging_log_file(httpd_log_t)
 
-# httpd_modules_t is the type given to module files (libraries)
-# that come with Apache /etc/httpd/modules and /usr/lib/apache
 type httpd_modules_t;
 files_type(httpd_modules_t)
 
-type httpd_php_t;
-type httpd_php_exec_t;
-domain_type(httpd_php_t)
-domain_entry_file(httpd_php_t, httpd_php_exec_t)
-role system_r types httpd_php_t;
-
-type httpd_php_tmp_t;
-files_tmp_file(httpd_php_tmp_t)
-
 type httpd_rotatelogs_t;
 type httpd_rotatelogs_exec_t;
 init_daemon_domain(httpd_rotatelogs_t, httpd_rotatelogs_exec_t)
@@ -211,8 +299,10 @@
 type httpd_squirrelmail_t;
 files_type(httpd_squirrelmail_t)
 
-# SUEXEC runs user scripts as their own user ID
-type httpd_suexec_t; #, daemon;
+type squirrelmail_spool_t;
+files_tmp_file(squirrelmail_spool_t)
+
+type httpd_suexec_t;
 type httpd_suexec_exec_t;
 domain_type(httpd_suexec_t)
 domain_entry_file(httpd_suexec_t, httpd_suexec_exec_t)
@@ -221,8 +311,8 @@
 type httpd_suexec_tmp_t;
 files_tmp_file(httpd_suexec_tmp_t)
 
-# setup the system domain for system CGI scripts
 apache_content_template(sys)
+corecmd_shell_entry_type(httpd_sys_script_t)
 typealias httpd_sys_content_t alias ntop_http_content_t;
 
 type httpd_tmp_t;
@@ -238,7 +328,6 @@
 userdom_user_home_content(httpd_user_script_exec_t)
 userdom_user_home_content(httpd_user_ra_content_t)
 userdom_user_home_content(httpd_user_rw_content_t)
-typeattribute httpd_user_script_t httpd_script_domains;
 typealias httpd_user_content_t alias { httpd_staff_content_t httpd_sysadm_content_t };
 typealias httpd_user_content_t alias { httpd_auditadm_content_t httpd_secadm_content_t };
 typealias httpd_user_content_t alias { httpd_staff_script_ro_t httpd_sysadm_script_ro_t };
@@ -254,16 +343,27 @@
 typealias httpd_user_ra_content_t alias { httpd_staff_script_ra_t httpd_sysadm_script_ra_t };
 typealias httpd_user_ra_content_t alias { httpd_auditadm_script_ra_t httpd_secadm_script_ra_t };
 
-# for apache2 memory mapped files
 type httpd_var_lib_t;
 files_type(httpd_var_lib_t)
 
 type httpd_var_run_t;
 files_pid_file(httpd_var_run_t)
 
-# File Type of squirrelmail attachments
-type squirrelmail_spool_t;
-files_tmp_file(squirrelmail_spool_t)
+type httpd_passwd_t;
+type httpd_passwd_exec_t;
+domain_type(httpd_passwd_t)
+domain_entry_file(httpd_passwd_t, httpd_passwd_exec_t)
+role system_r types httpd_passwd_t;
+
+type httpd_gpg_t;
+domain_type(httpd_gpg_t)
+gpg_entry_type(httpd_gpg_t)
+role system_r types httpd_gpg_t;
+
+ifdef(`distro_gentoo',`
+	attribute httpd_ra_content;
+	attribute httpd_rw_content;
+')
 
 optional_policy(`
 	prelink_object_file(httpd_modules_t)
@@ -271,11 +371,11 @@
 
 ########################################
 #
-# Apache server local policy
+# Local policy
 #
 
 allow httpd_t self:capability { chown dac_override kill setgid setuid sys_nice sys_tty_config };
-dontaudit httpd_t self:capability { net_admin sys_tty_config };
+dontaudit httpd_t self:capability net_admin;
 allow httpd_t self:process ~{ ptrace setcurrent setexec setfscreate setrlimit execmem execstack execheap };
 allow httpd_t self:fd use;
 allow httpd_t self:sock_file read_sock_file_perms;
@@ -284,33 +384,27 @@
 allow httpd_t self:sem create_sem_perms;
 allow httpd_t self:msgq create_msgq_perms;
 allow httpd_t self:msg { send receive };
-allow httpd_t self:unix_dgram_socket { create_socket_perms sendto };
-allow httpd_t self:unix_stream_socket { create_stream_socket_perms connectto };
-allow httpd_t self:tcp_socket create_stream_socket_perms;
-allow httpd_t self:udp_socket create_socket_perms;
+allow httpd_t self:unix_dgram_socket sendto;
+allow httpd_t self:unix_stream_socket { accept connectto listen };
+allow httpd_t self:tcp_socket { accept listen };
 
-# Allow httpd_t to put files in /var/cache/httpd etc
 manage_dirs_pattern(httpd_t, httpd_cache_t, httpd_cache_t)
 manage_files_pattern(httpd_t, httpd_cache_t, httpd_cache_t)
 manage_lnk_files_pattern(httpd_t, httpd_cache_t, httpd_cache_t)
+files_var_filetrans(httpd_t, httpd_cache_t, dir)
 
-# Allow the httpd_t to read the web servers config files
 allow httpd_t httpd_config_t:dir list_dir_perms;
 read_files_pattern(httpd_t, httpd_config_t, httpd_config_t)
 read_lnk_files_pattern(httpd_t, httpd_config_t, httpd_config_t)
 
-can_exec(httpd_t, httpd_exec_t)
-
 allow httpd_t httpd_lock_t:file manage_file_perms;
 files_lock_filetrans(httpd_t, httpd_lock_t, file)
 
-allow httpd_t httpd_log_t:dir setattr;
+allow httpd_t httpd_log_t:dir setattr_dir_perms;
 create_files_pattern(httpd_t, httpd_log_t, httpd_log_t)
 append_files_pattern(httpd_t, httpd_log_t, httpd_log_t)
 read_files_pattern(httpd_t, httpd_log_t, httpd_log_t)
 read_lnk_files_pattern(httpd_t, httpd_log_t, httpd_log_t)
-# cjp: need to refine create interfaces to
-# cut this back to add_name only
 logging_log_filetrans(httpd_t, httpd_log_t, file)
 
 allow httpd_t httpd_modules_t:dir list_dir_perms;
@@ -318,8 +412,6 @@
 read_files_pattern(httpd_t, httpd_modules_t, httpd_modules_t)
 read_lnk_files_pattern(httpd_t, httpd_modules_t, httpd_modules_t)
 
-apache_domtrans_rotatelogs(httpd_t)
-# Apache-httpd needs to be able to send signals to the log rotate procs.
 allow httpd_t httpd_rotatelogs_t:process signal_perms;
 
 manage_dirs_pattern(httpd_t, httpd_squirrelmail_t, httpd_squirrelmail_t)
@@ -328,16 +420,14 @@
 
 allow httpd_t httpd_suexec_exec_t:file read_file_perms;
 
-allow httpd_t httpd_sys_content_t:dir list_dir_perms;
-read_files_pattern(httpd_t, httpd_sys_content_t, httpd_sys_content_t)
-read_lnk_files_pattern(httpd_t, httpd_sys_content_t, httpd_sys_content_t)
-
 allow httpd_t httpd_sys_script_t:unix_stream_socket connectto;
 
 manage_dirs_pattern(httpd_t, httpd_tmp_t, httpd_tmp_t)
 manage_files_pattern(httpd_t, httpd_tmp_t, httpd_tmp_t)
+manage_sock_files_pattern(httpd_t, httpd_tmp_t, httpd_tmp_t)
 manage_lnk_files_pattern(httpd_t, httpd_tmp_t, httpd_tmp_t)
-files_tmp_filetrans(httpd_t, httpd_tmp_t, { file dir lnk_file })
+files_tmp_filetrans(httpd_t, httpd_tmp_t, { file dir lnk_file sock_file })
+userdom_user_tmp_filetrans(httpd_t, httpd_tmp_t, dir)
 
 manage_dirs_pattern(httpd_t, httpd_tmpfs_t, httpd_tmpfs_t)
 manage_files_pattern(httpd_t, httpd_tmpfs_t, httpd_tmpfs_t)
@@ -346,8 +436,9 @@
 manage_sock_files_pattern(httpd_t, httpd_tmpfs_t, httpd_tmpfs_t)
 fs_tmpfs_filetrans(httpd_t, httpd_tmpfs_t, { dir file lnk_file sock_file fifo_file })
 
+manage_dirs_pattern(httpd_t, httpd_var_lib_t, httpd_var_lib_t)
 manage_files_pattern(httpd_t, httpd_var_lib_t, httpd_var_lib_t)
-files_var_lib_filetrans(httpd_t, httpd_var_lib_t, file)
+files_var_lib_filetrans(httpd_t, httpd_var_lib_t, { dir file })
 
 setattr_dirs_pattern(httpd_t, httpd_var_run_t, httpd_var_run_t)
 manage_dirs_pattern(httpd_t, httpd_var_run_t, httpd_var_run_t)
@@ -359,56 +450,62 @@
 manage_files_pattern(httpd_t, squirrelmail_spool_t, squirrelmail_spool_t)
 manage_lnk_files_pattern(httpd_t, squirrelmail_spool_t, squirrelmail_spool_t)
 
+can_exec(httpd_t, httpd_exec_t)
+
+domtrans_pattern(httpd_t, httpd_helper_exec_t, httpd_helper_t)
+domtrans_pattern(httpd_t, httpd_passwd_exec_t, httpd_passwd_t)
+domtrans_pattern(httpd_t, httpd_rotatelogs_exec_t, httpd_rotatelogs_t)
+domtrans_pattern(httpd_t, httpd_suexec_exec_t, httpd_suexec_t)
+
 kernel_read_kernel_sysctls(httpd_t)
-# for modules that want to access /proc/meminfo
+kernel_read_network_state(httpd_t)
 kernel_read_system_state(httpd_t)
+kernel_search_network_sysctl(httpd_t)
 
 corenet_all_recvfrom_unlabeled(httpd_t)
 corenet_all_recvfrom_netlabel(httpd_t)
 corenet_tcp_sendrecv_generic_if(httpd_t)
-corenet_udp_sendrecv_generic_if(httpd_t)
 corenet_tcp_sendrecv_generic_node(httpd_t)
-corenet_udp_sendrecv_generic_node(httpd_t)
-corenet_tcp_sendrecv_all_ports(httpd_t)
-corenet_udp_sendrecv_all_ports(httpd_t)
 corenet_tcp_bind_generic_node(httpd_t)
+
+corenet_sendrecv_http_server_packets(httpd_t)
 corenet_tcp_bind_http_port(httpd_t)
+corenet_tcp_sendrecv_http_port(httpd_t)
+
+corenet_sendrecv_http_cache_server_packets(httpd_t)
 corenet_tcp_bind_http_cache_port(httpd_t)
-corenet_sendrecv_http_server_packets(httpd_t)
-# Signal self for shutdown
-corenet_tcp_connect_http_port(httpd_t)
+corenet_tcp_sendrecv_http_cache_port(httpd_t)
+
+corecmd_exec_bin(httpd_t)
+corecmd_exec_shell(httpd_t)
 
 dev_read_sysfs(httpd_t)
 dev_read_rand(httpd_t)
 dev_read_urand(httpd_t)
 dev_rw_crypto(httpd_t)
 
+domain_use_interactive_fds(httpd_t)
+
 fs_getattr_all_fs(httpd_t)
 fs_search_auto_mountpoints(httpd_t)
 
-auth_use_nsswitch(httpd_t)
-
-# execute perl
-corecmd_exec_bin(httpd_t)
-corecmd_exec_shell(httpd_t)
-
-domain_use_interactive_fds(httpd_t)
+fs_getattr_all_fs(httpd_t)
+fs_read_anon_inodefs_files(httpd_t)
+fs_read_iso9660_files(httpd_t)
+fs_search_auto_mountpoints(httpd_t)
 
 files_dontaudit_getattr_all_pids(httpd_t)
 files_read_usr_files(httpd_t)
 files_list_mnt(httpd_t)
 files_search_spool(httpd_t)
+files_read_var_symlinks(httpd_t)
 files_read_var_lib_files(httpd_t)
 files_search_home(httpd_t)
 files_getattr_home_dir(httpd_t)
-# for modules that want to access /etc/mtab
 files_read_etc_runtime_files(httpd_t)
-# Allow httpd_t to have access to files such as nisswitch.conf
-files_read_etc_files(httpd_t)
-# for tomcat
 files_read_var_lib_symlinks(httpd_t)
 
-fs_search_auto_mountpoints(httpd_sys_script_t)
+auth_use_nsswitch(httpd_t)
 
 libs_read_lib_files(httpd_t)
 
@@ -418,39 +515,79 @@
 miscfiles_read_fonts(httpd_t)
 miscfiles_read_public_files(httpd_t)
 miscfiles_read_generic_certs(httpd_t)
+miscfiles_read_tetex_data(httpd_t)
 
 seutil_dontaudit_search_config(httpd_t)
 
 userdom_use_unpriv_users_fds(httpd_t)
 
-tunable_policy(`allow_httpd_anon_write',`
-	miscfiles_manage_public_files(httpd_t)
+ifdef(`TODO',`
+	tunable_policy(`allow_httpd_mod_auth_pam',`
+		auth_domtrans_chk_passwd(httpd_t)
+
+		logging_send_audit_msgs(httpd_t)
+	')
 ')
 
-ifdef(`TODO', `
-#
-# We need optionals to be able to be within booleans to make this work
-#
-tunable_policy(`allow_httpd_mod_auth_pam',`
-	auth_domtrans_chk_passwd(httpd_t)
+ifdef(`hide_broken_symptoms',`
+	libs_exec_lib_files(httpd_t)
 ')
+
+tunable_policy(`allow_httpd_anon_write',`
+	miscfiles_manage_public_files(httpd_t)
 ')
 
 tunable_policy(`httpd_can_network_connect',`
+	corenet_sendrecv_all_client_packets(httpd_t)
 	corenet_tcp_connect_all_ports(httpd_t)
+	corenet_tcp_sendrecv_all_ports(httpd_t)
+')
+
+tunable_policy(`httpd_can_network_connect_db',`
+	corenet_sendrecv_gds_db_client_packets(httpd_t)
+	corenet_tcp_connect_gds_db_port(httpd_t)
+	corenet_tcp_sendrecv_gds_db_port(httpd_t)
+	corenet_sendrecv_mssql_client_packets(httpd_t)
+	corenet_tcp_connect_mssql_port(httpd_t)
+	corenet_tcp_sendrecv_mssql_port(httpd_t)
+	corenet_sendrecv_oracledb_client_packets(httpd_t)
+	corenet_tcp_connect_oracledb_port(httpd_t)
+	corenet_tcp_sendrecv_oracledb_port(httpd_t)
 ')
 
 tunable_policy(`httpd_can_network_relay',`
-	# allow httpd to work as a relay
-	corenet_tcp_connect_gopher_port(httpd_t)
-	corenet_tcp_connect_ftp_port(httpd_t)
-	corenet_tcp_connect_http_port(httpd_t)
-	corenet_tcp_connect_http_cache_port(httpd_t)
-	corenet_tcp_connect_memcache_port(httpd_t)
 	corenet_sendrecv_gopher_client_packets(httpd_t)
+	corenet_tcp_connect_gopher_port(httpd_t)
+	corenet_tcp_sendrecv_gopher_port(httpd_t)
 	corenet_sendrecv_ftp_client_packets(httpd_t)
+	corenet_tcp_connect_ftp_port(httpd_t)
+	corenet_tcp_sendrecv_ftp_port(httpd_t)
 	corenet_sendrecv_http_client_packets(httpd_t)
+	corenet_tcp_connect_http_port(httpd_t)
+	corenet_tcp_sendrecv_http_port(httpd_t)
 	corenet_sendrecv_http_cache_client_packets(httpd_t)
+	corenet_tcp_connect_http_cache_port(httpd_t)
+	corenet_tcp_sendrecv_http_cache_port(httpd_t)
+	corenet_sendrecv_squid_client_packets(httpd_t)
+	corenet_tcp_connect_squid_port(httpd_t)
+	corenet_tcp_sendrecv_squid_port(httpd_t)
+')
+
+tunable_policy(`httpd_builtin_scripting',`
+	exec_files_pattern(httpd_t, httpd_script_exec_type, httpd_script_exec_type)
+
+	allow httpd_t httpdcontent:dir list_dir_perms;
+	allow httpd_t httpdcontent:file read_file_perms;
+	allow httpd_t httpdcontent:lnk_file read_lnk_file_perms;
+')
+
+tunable_policy(`httpd_enable_cgi',`
+	allow httpd_t httpd_script_domains:process { signal sigkill sigstop };
+	allow httpd_t httpd_script_exec_type:dir list_dir_perms;
+')
+
+tunable_policy(`httpd_enable_cgi && httpd_use_gpg',`
+	gpg_spec_domtrans(httpd_t, httpd_gpg_t)
 ')
 
 tunable_policy(`httpd_enable_cgi && httpd_use_nfs',`
@@ -461,37 +598,92 @@
 	fs_cifs_domtrans(httpd_t, httpd_sys_script_t)
 ')
 
+# tunable_policy(`httpd_enable_cgi && httpd_use_fusefs',`
+#	fs_fusefs_domtrans(httpd_t, httpd_sys_script_t)
+# ')
+
 tunable_policy(`httpd_enable_cgi && httpd_unified && httpd_builtin_scripting',`
 	domtrans_pattern(httpd_t, httpdcontent, httpd_sys_script_t)
 
 	manage_dirs_pattern(httpd_t, httpdcontent, httpdcontent)
 	manage_files_pattern(httpd_t, httpdcontent, httpdcontent)
+	manage_fifo_files_pattern(httpd_t, httpdcontent, httpdcontent)
 	manage_lnk_files_pattern(httpd_t, httpdcontent, httpdcontent)
+	manage_sock_files_pattern(httpd_t, httpdcontent, httpdcontent)
 ')
 
 tunable_policy(`httpd_enable_ftp_server',`
+	corenet_sendrecv_ftp_server_packets(httpd_t)
 	corenet_tcp_bind_ftp_port(httpd_t)
+	corenet_tcp_sendrecv_ftp_port(httpd_t)
 ')
 
 tunable_policy(`httpd_enable_homedirs',`
-	userdom_read_user_home_content_files(httpd_t)
+	userdom_search_user_home_dirs(httpd_t)
 ')
 
 tunable_policy(`httpd_enable_homedirs && use_nfs_home_dirs',`
+	fs_list_auto_mountpoints(httpd_t)
 	fs_read_nfs_files(httpd_t)
 	fs_read_nfs_symlinks(httpd_t)
 ')
 
+tunable_policy(`httpd_enable_homedirs && use_nfs_home_dirs && httpd_builtin_scripting',`
+	fs_exec_nfs_files(httpd_t)
+')
+
 tunable_policy(`httpd_enable_homedirs && use_samba_home_dirs',`
+	fs_list_auto_mountpoints(httpd_t)
 	fs_read_cifs_files(httpd_t)
 	fs_read_cifs_symlinks(httpd_t)
 ')
 
+tunable_policy(`httpd_enable_homedirs && use_samba_home_dirs && httpd_builtin_scripting',`
+	fs_exec_cifs_files(httpd_t)
+')
+
+tunable_policy(`httpd_execmem',`
+	allow httpd_t self:process { execmem execstack };
+')
+
 tunable_policy(`httpd_can_sendmail',`
-	# allow httpd to connect to mail servers
-	corenet_tcp_connect_smtp_port(httpd_t)
 	corenet_sendrecv_smtp_client_packets(httpd_t)
+	corenet_tcp_connect_smtp_port(httpd_t)
+	corenet_tcp_sendrecv_smtp_port(httpd_t)
+	corenet_sendrecv_pop_client_packets(httpd_t)
+	corenet_tcp_connect_pop_port(httpd_t)
+	corenet_tcp_sendrecv_pop_port(httpd_t)
+
 	mta_send_mail(httpd_t)
+	mta_signal_system_mail(httpd_t)
+')
+
+optional_policy(`
+	tunable_policy(`httpd_can_network_connect_zabbix',`
+		zabbix_tcp_connect(httpd_t)
+	')
+')
+
+optional_policy(`
+	tunable_policy(`httpd_can_sendmail && httpd_can_check_spam',`
+		spamassassin_domtrans_client(httpd_t)
+	')
+')
+
+tunable_policy(`httpd_graceful_shutdown',`
+	corenet_sendrecv_http_client_packets(httpd_t)
+	corenet_tcp_connect_http_port(httpd_t)
+	corenet_tcp_sendrecv_http_port(httpd_t)
+')
+
+optional_policy(`
+	tunable_policy(`httpd_mod_auth_ntlm_winbind',`
+		samba_domtrans_winbind_helper(httpd_t)
+	')
+')
+
+tunable_policy(`httpd_read_user_content',`
+	userdom_read_user_home_content_files(httpd_t)
 ')
 
 tunable_policy(`httpd_setrlimit',`
@@ -501,21 +693,51 @@
 
 tunable_policy(`httpd_ssi_exec',`
 	corecmd_shell_domtrans(httpd_t, httpd_sys_script_t)
-	allow httpd_sys_script_t httpd_t:fd use;
-	allow httpd_sys_script_t httpd_t:fifo_file rw_file_perms;
-	allow httpd_sys_script_t httpd_t:process sigchld;
 ')
 
-# When the admin starts the server, the server wants to access
-# the TTY or PTY associated with the session. The httpd appears
-# to run correctly without this permission, so the permission
-# are dontaudited here.
+tunable_policy(`httpd_tmp_exec && httpd_builtin_scripting',`
+	can_exec(httpd_t, httpd_tmp_t)
+')
+
 tunable_policy(`httpd_tty_comm',`
 	userdom_use_user_terminals(httpd_t)
 ',`
 	userdom_dontaudit_use_user_terminals(httpd_t)
 ')
 
+tunable_policy(`httpd_use_cifs',`
+	fs_list_auto_mountpoints(httpd_t)
+	fs_manage_cifs_dirs(httpd_t)
+	fs_manage_cifs_files(httpd_t)
+	fs_manage_cifs_symlinks(httpd_t)
+')
+
+tunable_policy(`httpd_use_cifs && httpd_builtin_scripting',`
+	fs_exec_cifs_files(httpd_t)
+')
+
+tunable_policy(`httpd_use_fusefs',`
+	fs_list_auto_mountpoints(httpd_t)
+	fs_manage_fusefs_dirs(httpd_t)
+	fs_manage_fusefs_files(httpd_t)
+	fs_read_fusefs_symlinks(httpd_t)
+')
+
+tunable_policy(`httpd_use_fusefs && httpd_builtin_scripting',`
+	fs_exec_fusefs_files(httpd_t)
+')
+
+tunable_policy(`httpd_use_nfs',`
+	fs_list_auto_mountpoints(httpd_t)
+	fs_manage_nfs_dirs(httpd_t)
+	fs_manage_nfs_files(httpd_t)
+	fs_manage_nfs_symlinks(httpd_t)
+')
+
+tunable_policy(`httpd_use_nfs && httpd_builtin_scripting',`
+	fs_exec_nfs_files(httpd_t)
+')
+
 optional_policy(`
 	calamaris_read_www_files(httpd_t)
 ')
@@ -525,7 +747,8 @@
 ')
 
 optional_policy(`
-	cobbler_search_lib(httpd_t)
+	cobbler_read_config(httpd_t)
+	cobbler_read_lib_files(httpd_t)
 ')
 
 optional_policy(`
@@ -540,7 +763,7 @@
 	daemontools_service_domain(httpd_t, httpd_exec_t)
 ')
 
- optional_policy(`
+optional_policy(`
 	dbus_system_bus_client(httpd_t)
 
 	tunable_policy(`httpd_dbus_avahi',`
@@ -549,33 +772,51 @@
 ')
 
 optional_policy(`
-	tunable_policy(`httpd_enable_cgi && httpd_use_gpg',`
-		gpg_domtrans(httpd_t)
-	')
+	git_read_generic_sys_content_files(httpd_t)
+')
+
+optional_policy(`
+	gitosis_read_lib_files(httpd_t)
 ')
 
 optional_policy(`
 	kerberos_keytab_template(httpd, httpd_t)
+	kerberos_manage_host_rcache(httpd_t)
+	kerberos_tmp_filetrans_host_rcache(httpd_t, file, "HTTP_23")
+	kerberos_tmp_filetrans_host_rcache(httpd_t, file, "HTTP_48")
 ')
 
 optional_policy(`
-	# needed by FreeIPA
 	ldap_stream_connect(httpd_t)
+
+	tunable_policy(`httpd_can_network_connect_ldap',`
+		ldap_tcp_connect(httpd_t)
+	')
 ')
 
 optional_policy(`
 	mailman_signal_cgi(httpd_t)
 	mailman_domtrans_cgi(httpd_t)
 	mailman_read_data_files(httpd_t)
-	# should have separate types for public and private archives
 	mailman_search_data(httpd_t)
 	mailman_read_archive(httpd_t)
 ')
 
 optional_policy(`
-	# Allow httpd to work with mysql
+	memcached_stream_connect(httpd_t)
+
+	tunable_policy(`httpd_can_network_connect_memcache',`
+		memcached_tcp_connect(httpd_t)
+	')
+
+	tunable_policy(`httpd_manage_ipa',`
+		memcached_manage_pid_files(httpd_t)
+	')
+')
+
+optional_policy(`
+	mysql_read_config(httpd_t)
 	mysql_stream_connect(httpd_t)
-	mysql_rw_db_sockets(httpd_t)
 
 	tunable_policy(`httpd_can_network_connect_db',`
 		mysql_tcp_connect(httpd_t)
@@ -594,7 +835,10 @@
 ')
 
 optional_policy(`
-	# Allow httpd to work with postgresql
+	pcscd_read_pid_files(httpd_t)
+')
+
+optional_policy(`
 	postgresql_stream_connect(httpd_t)
 	postgresql_unpriv_client(httpd_t)
 
@@ -604,10 +848,22 @@
 ')
 
 optional_policy(`
+	puppet_read_lib_files(httpd_t)
+')
+
+optional_policy(`
+	rpc_search_nfs_state_data(httpd_t)
+')
+
+optional_policy(`
 	seutil_sigchld_newrole(httpd_t)
 ')
 
 optional_policy(`
+	smokeping_read_lib_files(httpd_t)
+')
+
+optional_policy(`
 	snmp_dontaudit_read_snmp_var_lib_files(httpd_t)
 	snmp_dontaudit_write_snmp_var_lib_files(httpd_t)
 ')
@@ -622,95 +878,40 @@
 
 ########################################
 #
-# Apache helper local policy
+# Helper local policy
 #
 
-domtrans_pattern(httpd_t, httpd_helper_exec_t, httpd_helper_t)
+read_files_pattern(httpd_helper_t, httpd_config_t, httpd_config_t)
 
-allow httpd_helper_t httpd_config_t:file read_file_perms;
+append_files_pattern(httpd_helper_t, httpd_log_t, httpd_log_t)
+read_lnk_files_pattern(httpd_helper_t, httpd_log_t, httpd_log_t)
 
-allow httpd_helper_t httpd_log_t:file append_file_perms;
+files_search_etc(httpd_helper_t)
 
+logging_search_logs(httpd_helper_t)
 logging_send_syslog_msg(httpd_helper_t)
 
-userdom_use_user_terminals(httpd_helper_t)
-
-########################################
-#
-# Apache PHP script local policy
-#
-
-allow httpd_php_t self:process ~{ ptrace setcurrent setexec setfscreate setrlimit execmem execstack execheap };
-allow httpd_php_t self:fd use;
-allow httpd_php_t self:fifo_file rw_fifo_file_perms;
-allow httpd_php_t self:sock_file read_sock_file_perms;
-allow httpd_php_t self:unix_dgram_socket create_socket_perms;
-allow httpd_php_t self:unix_stream_socket create_stream_socket_perms;
-allow httpd_php_t self:unix_dgram_socket sendto;
-allow httpd_php_t self:unix_stream_socket connectto;
-allow httpd_php_t self:shm create_shm_perms;
-allow httpd_php_t self:sem create_sem_perms;
-allow httpd_php_t self:msgq create_msgq_perms;
-allow httpd_php_t self:msg { send receive };
-
-domtrans_pattern(httpd_t, httpd_php_exec_t, httpd_php_t)
-
-# allow php to read and append to apache logfiles
-allow httpd_php_t httpd_log_t:file { read_file_perms append_file_perms };
-
-manage_dirs_pattern(httpd_php_t, httpd_php_tmp_t, httpd_php_tmp_t)
-manage_files_pattern(httpd_php_t, httpd_php_tmp_t, httpd_php_tmp_t)
-files_tmp_filetrans(httpd_php_t, httpd_php_tmp_t, { file dir })
-
-fs_search_auto_mountpoints(httpd_php_t)
-
-auth_use_nsswitch(httpd_php_t)
-
-libs_exec_lib_files(httpd_php_t)
-
-userdom_use_unpriv_users_fds(httpd_php_t)
-
-tunable_policy(`httpd_can_network_connect_db',`
-	corenet_tcp_connect_mysqld_port(httpd_t)
-	corenet_sendrecv_mysqld_client_packets(httpd_t)
-	corenet_tcp_connect_mysqld_port(httpd_sys_script_t)
-	corenet_sendrecv_mysqld_client_packets(httpd_sys_script_t)
-	corenet_tcp_connect_mysqld_port(httpd_suexec_t)
-	corenet_sendrecv_mysqld_client_packets(httpd_suexec_t)
-
-	corenet_tcp_connect_mssql_port(httpd_t)
-	corenet_sendrecv_mssql_client_packets(httpd_t)
-	corenet_tcp_connect_mssql_port(httpd_sys_script_t)
-	corenet_sendrecv_mssql_client_packets(httpd_sys_script_t)
-	corenet_tcp_connect_mssql_port(httpd_suexec_t)
-	corenet_sendrecv_mssql_client_packets(httpd_suexec_t)
-')
-
-optional_policy(`
-	mysql_stream_connect(httpd_php_t)
-	mysql_read_config(httpd_php_t)
-')
-
-optional_policy(`
-	postgresql_stream_connect(httpd_php_t)
+tunable_policy(`httpd_tty_comm',`
+	userdom_use_user_terminals(httpd_helper_t)
+',`
+	userdom_dontaudit_use_user_terminals(httpd_helper_t)
 ')
 
 ########################################
 #
-# Apache suexec local policy
+# Suexec local policy
 #
 
 allow httpd_suexec_t self:capability { setuid setgid };
 allow httpd_suexec_t self:process signal_perms;
-allow httpd_suexec_t self:unix_stream_socket create_stream_socket_perms;
-
-domtrans_pattern(httpd_t, httpd_suexec_exec_t, httpd_suexec_t)
+allow httpd_suexec_t self:fifo_file rw_fifo_file_perms;
+allow httpd_suexec_t self:tcp_socket { accept listen };
+allow httpd_suexec_t self:unix_stream_socket { accept listen };
 
 create_files_pattern(httpd_suexec_t, httpd_log_t, httpd_log_t)
 append_files_pattern(httpd_suexec_t, httpd_log_t, httpd_log_t)
 read_files_pattern(httpd_suexec_t, httpd_log_t, httpd_log_t)
-
-allow httpd_suexec_t httpd_t:fifo_file read_fifo_file_perms;
+read_lnk_files_pattern(httpd_suexec_t, httpd_log_t, httpd_log_t)
 
 manage_dirs_pattern(httpd_suexec_t, httpd_suexec_tmp_t, httpd_suexec_tmp_t)
 manage_files_pattern(httpd_suexec_t, httpd_suexec_tmp_t, httpd_suexec_tmp_t)
@@ -720,15 +921,19 @@
 kernel_list_proc(httpd_suexec_t)
 kernel_read_proc_symlinks(httpd_suexec_t)
 
-dev_read_urand(httpd_suexec_t)
+corenet_all_recvfrom_unlabeled(httpd_suexec_t)
+corenet_all_recvfrom_netlabel(httpd_suexec_t)
+corenet_tcp_sendrecv_generic_if(httpd_suexec_t)
+corenet_tcp_sendrecv_generic_node(httpd_suexec_t)
 
-fs_search_auto_mountpoints(httpd_suexec_t)
-
-# for shell scripts
 corecmd_exec_bin(httpd_suexec_t)
 corecmd_exec_shell(httpd_suexec_t)
 
-files_read_etc_files(httpd_suexec_t)
+dev_read_urand(httpd_suexec_t)
+
+fs_read_iso9660_files(httpd_suexec_t)
+fs_search_auto_mountpoints(httpd_suexec_t)
+
 files_read_usr_files(httpd_suexec_t)
 files_dontaudit_search_pids(httpd_suexec_t)
 files_search_home(httpd_suexec_t)
@@ -741,59 +946,256 @@
 miscfiles_read_localization(httpd_suexec_t)
 miscfiles_read_public_files(httpd_suexec_t)
 
-tunable_policy(`httpd_can_network_connect',`
-	allow httpd_suexec_t self:tcp_socket create_stream_socket_perms;
-	allow httpd_suexec_t self:udp_socket create_socket_perms;
+tunable_policy(`httpd_builtin_scripting',`
+	exec_files_pattern(httpd_suexec_t, httpd_script_exec_type, httpd_script_exec_type)
 
-	corenet_all_recvfrom_unlabeled(httpd_suexec_t)
-	corenet_all_recvfrom_netlabel(httpd_suexec_t)
-	corenet_tcp_sendrecv_generic_if(httpd_suexec_t)
-	corenet_udp_sendrecv_generic_if(httpd_suexec_t)
-	corenet_tcp_sendrecv_generic_node(httpd_suexec_t)
-	corenet_udp_sendrecv_generic_node(httpd_suexec_t)
-	corenet_tcp_sendrecv_all_ports(httpd_suexec_t)
-	corenet_udp_sendrecv_all_ports(httpd_suexec_t)
+	allow httpd_suexec_t httpdcontent:dir list_dir_perms;
+	allow httpd_suexec_t httpdcontent:file read_file_perms;
+	allow httpd_suexec_t httpdcontent:lnk_file read_lnk_file_perms;
+')
+
+tunable_policy(`httpd_can_network_connect',`
 	corenet_tcp_connect_all_ports(httpd_suexec_t)
 	corenet_sendrecv_all_client_packets(httpd_suexec_t)
+	corenet_tcp_sendrecv_all_ports(httpd_suexec_t)
+')
+
+tunable_policy(`httpd_can_network_connect_db',`
+	corenet_sendrecv_gds_db_client_packets(httpd_suexec_t)
+	corenet_tcp_connect_gds_db_port(httpd_suexec_t)
+	corenet_tcp_sendrecv_gds_db_port(httpd_suexec_t)
+	corenet_sendrecv_mssql_client_packets(httpd_suexec_t)
+	corenet_tcp_connect_mssql_port(httpd_suexec_t)
+	corenet_tcp_sendrecv_mssql_port(httpd_suexec_t)
+	corenet_sendrecv_oracledb_client_packets(httpd_suexec_t)
+	corenet_tcp_connect_oracledb_port(httpd_suexec_t)
+	corenet_tcp_sendrecv_oracledb_port(httpd_suexec_t)
+')
+
+tunable_policy(`httpd_can_sendmail',`
+	corenet_sendrecv_smtp_client_packets(httpd_suexec_t)
+	corenet_tcp_connect_smtp_port(httpd_suexec_t)
+	corenet_tcp_sendrecv_smtp_port(httpd_suexec_t)
+	corenet_sendrecv_pop_client_packets(httpd_suexec_t)
+	corenet_tcp_connect_pop_port(httpd_suexec_t)
+	corenet_tcp_sendrecv_pop_port(httpd_suexec_t)
+	mta_send_mail(httpd_suexec_t)
+	mta_signal_system_mail(httpd_suexec_t)
 ')
 
 tunable_policy(`httpd_enable_cgi && httpd_unified',`
-	allow httpd_sys_script_t httpdcontent:file entrypoint;
 	domtrans_pattern(httpd_suexec_t, httpdcontent, httpd_sys_script_t)
+')
 
+tunable_policy(`httpd_enable_homedirs && use_samba_home_dirs',`
+	fs_list_auto_mountpoints(httpd_suexec_t)
+	fs_read_cifs_files(httpd_suexec_t)
+	fs_read_cifs_symlinks(httpd_suexec_t)
+')
+
+tunable_policy(`httpd_enable_homedirs && use_samba_home_dirs && httpd_builtin_scripting',`
+	fs_exec_cifs_files(httpd_suexec_t)
 ')
 
 tunable_policy(`httpd_enable_homedirs && use_nfs_home_dirs',`
+	fs_list_auto_mountpoints(httpd_suexec_t)
 	fs_read_nfs_files(httpd_suexec_t)
 	fs_read_nfs_symlinks(httpd_suexec_t)
+')
+
+tunable_policy(`httpd_enable_homedirs && use_nfs_home_dirs && httpd_builtin_scripting',`
 	fs_exec_nfs_files(httpd_suexec_t)
 ')
 
-tunable_policy(`httpd_enable_homedirs && use_samba_home_dirs',`
-	fs_read_cifs_files(httpd_suexec_t)
-	fs_read_cifs_symlinks(httpd_suexec_t)
+tunable_policy(`httpd_execmem',`
+	allow httpd_suexec_t self:process { execmem execstack };
+')
+
+tunable_policy(`httpd_tmp_exec',`
+	can_exec(httpd_suexec_t, httpd_suexec_tmp_t)
+')
+
+tunable_policy(`httpd_tty_comm',`
+	userdom_use_user_terminals(httpd_suexec_t)
+',`
+	userdom_dontaudit_use_user_terminals(httpd_suexec_t)
+')
+
+tunable_policy(`httpd_use_cifs',`
+	fs_list_auto_mountpoints(httpd_suexec_t)
+	fs_manage_cifs_dirs(httpd_suexec_t)
+	fs_manage_cifs_files(httpd_suexec_t)
+	fs_manage_cifs_symlinks(httpd_suexec_t)
+')
+
+tunable_policy(`httpd_use_cifs && httpd_builtin_scripting',`
 	fs_exec_cifs_files(httpd_suexec_t)
 ')
 
+tunable_policy(`httpd_use_fusefs',`
+	fs_list_auto_mountpoints(httpd_suexec_t)
+	fs_manage_fusefs_dirs(httpd_suexec_t)
+	fs_manage_fusefs_files(httpd_suexec_t)
+	fs_read_fusefs_symlinks(httpd_suexec_t)
+')
+
+tunable_policy(`httpd_use_fusefs && httpd_builtin_scripting',`
+	fs_exec_fusefs_files(httpd_suexec_t)
+')
+
+tunable_policy(`httpd_use_nfs',`
+	fs_list_auto_mountpoints(httpd_suexec_t)
+	fs_manage_nfs_dirs(httpd_suexec_t)
+	fs_manage_nfs_files(httpd_suexec_t)
+	fs_manage_nfs_symlinks(httpd_suexec_t)
+')
+
+tunable_policy(`httpd_use_nfs && httpd_builtin_scripting',`
+	fs_exec_nfs_files(httpd_suexec_t)
+')
+
 optional_policy(`
 	mailman_domtrans_cgi(httpd_suexec_t)
 ')
 
 optional_policy(`
-	mta_stub(httpd_suexec_t)
+	mysql_stream_connect(httpd_suexec_t)
+	mysql_read_config(httpd_suexec_t)
+
+	tunable_policy(`httpd_can_network_connect_db',`
+		mysql_tcp_connect(httpd_suexec_t)
+	')
+')
+
+optional_policy(`
+	postgresql_stream_connect(httpd_suexec_t)
+	postgresql_unpriv_client(httpd_suexec_t)
+
+	tunable_policy(`httpd_can_network_connect_db',`
+		postgresql_tcp_connect(httpd_suexec_t)
+	')
+')
 
-	# apache should set close-on-exec
-	dontaudit httpd_suexec_t httpd_t:unix_stream_socket { read write };
+tunable_policy(`httpd_read_user_content',`
+	userdom_read_user_home_content_files(httpd_suexec_t)
+')
+
+tunable_policy(`httpd_enable_homedirs',`
+	userdom_search_user_home_dirs(httpd_suexec_t)
 ')
 
 ########################################
 #
-# Apache system script local policy
+# Common script local policy
 #
 
-allow httpd_sys_script_t self:process getsched;
+allow httpd_script_domains self:fifo_file rw_file_perms;
+allow httpd_script_domains self:unix_stream_socket connectto;
+
+allow httpd_script_domains httpd_sys_content_t:dir search_dir_perms;
+
+append_files_pattern(httpd_script_domains, httpd_log_t, httpd_log_t)
+read_lnk_files_pattern(httpd_script_domains, httpd_log_t, httpd_log_t)
+
+kernel_dontaudit_search_sysctl(httpd_script_domains)
+kernel_dontaudit_search_kernel_sysctl(httpd_script_domains)
+
+corenet_all_recvfrom_unlabeled(httpd_script_domains)
+corenet_all_recvfrom_netlabel(httpd_script_domains)
+corenet_tcp_sendrecv_generic_if(httpd_script_domains)
+corenet_tcp_sendrecv_generic_node(httpd_script_domains)
+
+corecmd_exec_all_executables(httpd_script_domains)
+
+dev_read_rand(httpd_script_domains)
+dev_read_urand(httpd_script_domains)
+
+files_exec_etc_files(httpd_script_domains)
+files_read_etc_files(httpd_script_domains)
+files_search_home(httpd_script_domains)
+
+libs_exec_ld_so(httpd_script_domains)
+libs_exec_lib_files(httpd_script_domains)
+
+logging_search_logs(httpd_script_domains)
+
+miscfiles_read_fonts(httpd_script_domains)
+miscfiles_read_public_files(httpd_script_domains)
+
+seutil_dontaudit_search_config(httpd_script_domains)
+
+tunable_policy(`httpd_enable_cgi && httpd_unified',`
+	allow httpd_script_domains httpdcontent:file entrypoint;
+
+	manage_dirs_pattern(httpd_script_domains, httpdcontent, httpdcontent)
+	manage_files_pattern(httpd_script_domains, httpdcontent, httpdcontent)
+	manage_lnk_files_pattern(httpd_script_domains, httpdcontent, httpdcontent)
+
+	can_exec(httpd_script_domains, httpdcontent)
+')
+
+tunable_policy(`httpd_enable_cgi',`
+	allow httpd_script_domains self:process { setsched signal_perms };
+	allow httpd_script_domains self:unix_stream_socket create_stream_socket_perms;
+
+	kernel_read_system_state(httpd_script_domains)
+
+	fs_getattr_all_fs(httpd_script_domains)
+
+	files_read_etc_runtime_files(httpd_script_domains)
+	files_read_usr_files(httpd_script_domains)
+
+	libs_read_lib_files(httpd_script_domains)
+
+	miscfiles_read_localization(httpd_script_domains)
+')
+
+optional_policy(`
+	tunable_policy(`httpd_enable_cgi && allow_ypbind',`
+		nis_use_ypbind_uncond(httpd_script_domains)
+	')
+')
+
+tunable_policy(`httpd_enable_cgi && httpd_can_network_connect_db',`
+	corenet_sendrecv_gds_db_client_packets(httpd_script_domains)
+	corenet_tcp_connect_gds_db_port(httpd_script_domains)
+	corenet_tcp_sendrecv_gds_db_port(httpd_script_domains)
+	corenet_sendrecv_mssql_client_packets(httpd_script_domains)
+	corenet_tcp_connect_mssql_port(httpd_script_domains)
+	corenet_tcp_sendrecv_mssql_port(httpd_script_domains)
+	corenet_sendrecv_oracledb_client_packets(httpd_script_domains)
+	corenet_tcp_connect_oracledb_port(httpd_script_domains)
+	corenet_tcp_sendrecv_oracledb_port(httpd_script_domains)
+')
+
+optional_policy(`
+	mysql_read_config(httpd_script_domains)
+	mysql_stream_connect(httpd_script_domains)
+
+	tunable_policy(`httpd_enable_cgi && httpd_can_network_connect_db',`
+		mysql_tcp_connect(httpd_script_domains)
+	')
+')
+
+optional_policy(`
+	postgresql_stream_connect(httpd_script_domains)
+
+	tunable_policy(`httpd_enable_cgi && httpd_can_network_connect_db',`
+		postgresql_tcp_connect(httpd_script_domains)
+	')
+')
+
+optional_policy(`
+	nscd_socket_use(httpd_script_domains)
+')
+
+########################################
+#
+# System script local policy
+#
+
+allow httpd_sys_script_t self:tcp_socket { accept listen };
 
-allow httpd_sys_script_t httpd_t:unix_stream_socket rw_stream_socket_perms;
 allow httpd_sys_script_t httpd_t:tcp_socket { read write };
 
 dontaudit httpd_sys_script_t httpd_config_t:dir search;
@@ -801,82 +1203,104 @@
 allow httpd_sys_script_t httpd_squirrelmail_t:file { append_file_perms read_file_perms };
 
 allow httpd_sys_script_t squirrelmail_spool_t:dir list_dir_perms;
-read_files_pattern(httpd_sys_script_t, squirrelmail_spool_t, squirrelmail_spool_t)
-read_lnk_files_pattern(httpd_sys_script_t, squirrelmail_spool_t, squirrelmail_spool_t)
+allow httpd_sys_script_t squirrelmail_spool_t:file read_file_perms;
+allow httpd_sys_script_t squirrelmail_spool_t:lnk_file read_lnk_file_perms;
 
 kernel_read_kernel_sysctls(httpd_sys_script_t)
 
+fs_search_auto_mountpoints(httpd_sys_script_t)
+
+files_read_var_symlinks(httpd_sys_script_t)
 files_search_var_lib(httpd_sys_script_t)
 files_search_spool(httpd_sys_script_t)
 
-# Should we add a boolean?
 apache_domtrans_rotatelogs(httpd_sys_script_t)
 
-ifdef(`distro_redhat',`
-	allow httpd_sys_script_t httpd_log_t:file append_file_perms;
-')
+auth_use_nsswitch(httpd_sys_script_t)
 
 tunable_policy(`httpd_can_sendmail',`
+	corenet_sendrecv_smtp_client_packets(httpd_sys_script_t)
+	corenet_tcp_connect_smtp_port(httpd_sys_script_t)
+	corenet_tcp_sendrecv_smtp_port(httpd_sys_script_t)
+	corenet_sendrecv_pop_client_packets(httpd_sys_script_t)
+	corenet_tcp_connect_pop_port(httpd_sys_script_t)
+	corenet_tcp_sendrecv_pop_port(httpd_sys_script_t)
+
 	mta_send_mail(httpd_sys_script_t)
+	mta_signal_system_mail(httpd_sys_script_t)
 ')
 
-tunable_policy(`httpd_enable_cgi && httpd_can_network_connect',`
-	allow httpd_sys_script_t self:tcp_socket create_stream_socket_perms;
-	allow httpd_sys_script_t self:udp_socket create_socket_perms;
+tunable_policy(`httpd_enable_homedirs',`
+	userdom_search_user_home_dirs(httpd_sys_script_t)
+')
 
-	corenet_tcp_bind_all_nodes(httpd_sys_script_t)
-	corenet_udp_bind_all_nodes(httpd_sys_script_t)
-	corenet_all_recvfrom_unlabeled(httpd_sys_script_t)
-	corenet_all_recvfrom_netlabel(httpd_sys_script_t)
-	corenet_tcp_sendrecv_all_if(httpd_sys_script_t)
-	corenet_udp_sendrecv_all_if(httpd_sys_script_t)
-	corenet_tcp_sendrecv_all_nodes(httpd_sys_script_t)
-	corenet_udp_sendrecv_all_nodes(httpd_sys_script_t)
-	corenet_tcp_sendrecv_all_ports(httpd_sys_script_t)
-	corenet_udp_sendrecv_all_ports(httpd_sys_script_t)
+tunable_policy(`httpd_enable_cgi && httpd_can_network_connect',`
 	corenet_tcp_connect_all_ports(httpd_sys_script_t)
 	corenet_sendrecv_all_client_packets(httpd_sys_script_t)
+	corenet_tcp_sendrecv_all_ports(httpd_sys_script_t)
 ')
 
-tunable_policy(`httpd_enable_homedirs',`
+tunable_policy(`httpd_execmem',`
+	allow httpd_sys_script_t self:process { execmem execstack };
+')
+
+tunable_policy(`httpd_read_user_content',`
 	userdom_read_user_home_content_files(httpd_sys_script_t)
 ')
 
-tunable_policy(`httpd_enable_homedirs && use_nfs_home_dirs',`
-	fs_read_nfs_files(httpd_sys_script_t)
-	fs_read_nfs_symlinks(httpd_sys_script_t)
+tunable_policy(`httpd_use_cifs',`
+	fs_list_auto_mountpoints(httpd_sys_script_t)
+	fs_manage_cifs_dirs(httpd_sys_script_t)
+	fs_manage_cifs_files(httpd_sys_script_t)
+	fs_manage_cifs_symlinks(httpd_sys_script_t)
 ')
 
-tunable_policy(`httpd_enable_homedirs && use_samba_home_dirs',`
-	fs_read_cifs_files(httpd_sys_script_t)
-	fs_read_cifs_symlinks(httpd_sys_script_t)
+tunable_policy(`httpd_use_cifs && httpd_builtin_scripting',`
+	fs_exec_cifs_files(httpd_sys_script_t)
 ')
 
-optional_policy(`
-	clamav_domtrans_clamscan(httpd_sys_script_t)
+tunable_policy(`httpd_use_fusefs',`
+	fs_list_auto_mountpoints(httpd_sys_script_t)
+	fs_manage_fusefs_dirs(httpd_sys_script_t)
+	fs_manage_fusefs_files(httpd_sys_script_t)
+	fs_read_fusefs_symlinks(httpd_sys_script_t)
+')
+
+tunable_policy(`httpd_use_fusefs && httpd_builtin_scripting',`
+	fs_exec_fusefs_files(httpd_sys_script_t)
+')
+
+tunable_policy(`httpd_use_nfs',`
+	fs_list_auto_mountpoints(httpd_sys_script_t)
+	fs_manage_nfs_dirs(httpd_sys_script_t)
+	fs_manage_nfs_files(httpd_sys_script_t)
+	fs_manage_nfs_symlinks(httpd_sys_script_t)
+')
+
+tunable_policy(`httpd_use_nfs && httpd_builtin_scripting',`
+	fs_exec_nfs_files(httpd_sys_script_t)
 ')
 
 optional_policy(`
-	mysql_stream_connect(httpd_sys_script_t)
-	mysql_rw_db_sockets(httpd_sys_script_t)
+	clamav_domtrans_clamscan(httpd_sys_script_t)
 ')
 
 optional_policy(`
-	postgresql_stream_connect(httpd_sys_script_t)
+	postgresql_unpriv_client(httpd_sys_script_t)
 ')
 
 ########################################
 #
-# httpd_rotatelogs local policy
+# Rotatelogs local policy
 #
 
 allow httpd_rotatelogs_t self:capability dac_override;
 
 manage_files_pattern(httpd_rotatelogs_t, httpd_log_t, httpd_log_t)
+read_lnk_files_pattern(httpd_rotatelogs_t, httpd_log_t, httpd_log_t)
 
 kernel_read_kernel_sysctls(httpd_rotatelogs_t)
 kernel_dontaudit_list_proc(httpd_rotatelogs_t)
-kernel_dontaudit_read_proc_symlinks(httpd_rotatelogs_t)
 
 files_read_etc_files(httpd_rotatelogs_t)
 
@@ -890,15 +1314,8 @@
 #
 
 optional_policy(`
-	type httpd_unconfined_script_t;
-	type httpd_unconfined_script_exec_t;
-	domain_type(httpd_unconfined_script_t)
-	domain_entry_file(httpd_unconfined_script_t, httpd_unconfined_script_exec_t)
-	domtrans_pattern(httpd_t, httpd_unconfined_script_exec_t, httpd_unconfined_script_t)
+	apache_content_template(unconfined)
 	unconfined_domain(httpd_unconfined_script_t)
-
-	role system_r types httpd_unconfined_script_t;
-	allow httpd_t httpd_unconfined_script_t:process signal_perms;
 ')
 
 ########################################
@@ -906,13 +1323,87 @@
 # User content local policy
 #
 
-tunable_policy(`httpd_enable_cgi && httpd_unified',`
-	allow httpd_user_script_t httpdcontent:file entrypoint;
-')
-
-# allow accessing files/dirs below the users home dir
 tunable_policy(`httpd_enable_homedirs',`
-	userdom_search_user_home_dirs(httpd_t)
-	userdom_search_user_home_dirs(httpd_suexec_t)
 	userdom_search_user_home_dirs(httpd_user_script_t)
 ')
+
+tunable_policy(`httpd_enable_homedirs && use_samba_home_dirs',`
+	fs_list_auto_mountpoints(httpd_user_script_t)
+	fs_read_cifs_files(httpd_user_script_t)
+	fs_read_cifs_symlinks(httpd_user_script_t)
+')
+
+tunable_policy(`httpd_enable_homedirs && use_samba_home_dirs && httpd_builtin_scripting',`
+	fs_exec_cifs_files(httpd_user_script_t)
+')
+
+tunable_policy(`httpd_enable_homedirs && use_nfs_home_dirs',`
+	fs_list_auto_mountpoints(httpd_user_script_t)
+	fs_read_nfs_files(httpd_user_script_t)
+	fs_read_nfs_symlinks(httpd_user_script_t)
+')
+
+tunable_policy(`httpd_enable_homedirs && use_nfs_home_dirs && httpd_builtin_scripting',`
+	fs_exec_nfs_files(httpd_user_script_t)
+')
+
+tunable_policy(`httpd_read_user_content',`
+	userdom_read_user_home_content_files(httpd_user_script_t)
+')
+
+optional_policy(`
+	postgresql_unpriv_client(httpd_user_script_t)
+')
+
+########################################
+#
+# Passwd local policy
+#
+
+allow httpd_passwd_t self:fifo_file manage_fifo_file_perms;
+allow httpd_passwd_t self:unix_stream_socket create_stream_socket_perms;
+allow httpd_passwd_t self:unix_dgram_socket create_socket_perms;
+
+dontaudit httpd_passwd_t httpd_config_t:file read_file_perms;
+
+kernel_read_system_state(httpd_passwd_t)
+
+corecmd_exec_bin(httpd_passwd_t)
+corecmd_exec_shell(httpd_passwd_t)
+
+dev_read_urand(httpd_passwd_t)
+
+domain_use_interactive_fds(httpd_passwd_t)
+
+auth_use_nsswitch(httpd_passwd_t)
+
+miscfiles_read_generic_certs(httpd_passwd_t)
+miscfiles_read_localization(httpd_passwd_t)
+
+########################################
+#
+# GPG local policy
+#
+
+allow httpd_gpg_t self:process setrlimit;
+
+allow httpd_gpg_t httpd_t:fd use;
+allow httpd_gpg_t httpd_t:fifo_file rw_fifo_file_perms;
+allow httpd_gpg_t httpd_t:process sigchld;
+
+dev_read_rand(httpd_gpg_t)
+dev_read_urand(httpd_gpg_t)
+
+files_read_usr_files(httpd_gpg_t)
+
+miscfiles_read_localization(httpd_gpg_t)
+
+gpg_exec(httpd_gpg_t)
+
+tunable_policy(`httpd_gpg_anon_write',`
+	miscfiles_manage_public_files(httpd_gpg_t)
+')
+
+optional_policy(`
+	apache_manage_sys_rw_content(httpd_gpg_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/apcupsd.fc refpolicy/policy/modules/contrib/apcupsd.fc
--- refpolicy/policy/modules/contrib/apcupsd.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/apcupsd.fc	2012-09-27 20:03:30.727126498 +0200
@@ -1,15 +1,18 @@
 /etc/rc\.d/init\.d/apcupsd	--	gen_context(system_u:object_r:apcupsd_initrc_exec_t,s0)
 
-/sbin/apcupsd			--	gen_context(system_u:object_r:apcupsd_exec_t,s0)
+/sbin/apcupsd	--	gen_context(system_u:object_r:apcupsd_exec_t,s0)
 
-/usr/sbin/apcupsd		--	gen_context(system_u:object_r:apcupsd_exec_t,s0)
+/usr/sbin/apcupsd	--	gen_context(system_u:object_r:apcupsd_exec_t,s0)
+
+/var/lock/subsys/apcupsd	--	gen_context(system_u:object_r:apcupsd_lock_t,s0)
 
 /var/log/apcupsd\.events.*	--	gen_context(system_u:object_r:apcupsd_log_t,s0)
 /var/log/apcupsd\.status.*	--	gen_context(system_u:object_r:apcupsd_log_t,s0)
 
-/var/run/apcupsd\.pid		--	gen_context(system_u:object_r:apcupsd_var_run_t,s0)
+/var/run/apcupsd\.pid	--	gen_context(system_u:object_r:apcupsd_var_run_t,s0)
 
 /var/www/apcupsd/multimon\.cgi	--	gen_context(system_u:object_r:httpd_apcupsd_cgi_script_exec_t,s0)
 /var/www/apcupsd/upsfstats\.cgi	--	gen_context(system_u:object_r:httpd_apcupsd_cgi_script_exec_t,s0)
 /var/www/apcupsd/upsimage\.cgi	--	gen_context(system_u:object_r:httpd_apcupsd_cgi_script_exec_t,s0)
 /var/www/apcupsd/upsstats\.cgi	--	gen_context(system_u:object_r:httpd_apcupsd_cgi_script_exec_t,s0)
+/var/www/cgi-bin/apcgui(/.*)?	gen_context(system_u:object_r:httpd_apcupsd_cgi_script_exec_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/apcupsd.if refpolicy/policy/modules/contrib/apcupsd.if
--- refpolicy/policy/modules/contrib/apcupsd.if	2012-05-04 15:16:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/apcupsd.if	2012-09-27 20:03:30.727126498 +0200
@@ -1,8 +1,9 @@
-## <summary>APC UPS monitoring daemon</summary>
+## <summary>APC UPS monitoring daemon.</summary>
 
 ########################################
 ## <summary>
-##	Execute a domain transition to run apcupsd.
+##	Execute a domain transition to
+##	run apcupsd.
 ## </summary>
 ## <param name="domain">
 ## <summary>
@@ -21,7 +22,8 @@
 
 ########################################
 ## <summary>
-##	Execute apcupsd server in the apcupsd domain.
+##	Execute apcupsd server in the
+##	apcupsd domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -58,7 +60,7 @@
 
 ########################################
 ## <summary>
-##	Allow the specified domain to read apcupsd's log files.
+##	Read apcupsd log files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -79,8 +81,7 @@
 
 ########################################
 ## <summary>
-##	Allow the specified domain to append
-##	apcupsd log files.
+##	Append apcupsd log files.
 ## </summary>
 ## <param name="domain">
 ## 	<summary>
@@ -100,7 +101,8 @@
 
 ########################################
 ## <summary>
-##	Execute a domain transition to run httpd_apcupsd_cgi_script.
+##	Execute a domain transition to
+##	run httpd_apcupsd_cgi_script.
 ## </summary>
 ## <param name="domain">
 ## <summary>
@@ -113,18 +115,18 @@
 		type httpd_apcupsd_cgi_script_t, httpd_apcupsd_cgi_script_exec_t;
 	')
 
+	files_search_var($1)
+	domtrans_pattern($1, httpd_apcupsd_cgi_script_exec_t, httpd_apcupsd_cgi_script_t)
+
 	optional_policy(`
 		apache_search_sys_content($1)
 	')
-
-	files_search_var($1)
-	domtrans_pattern($1, httpd_apcupsd_cgi_script_exec_t, httpd_apcupsd_cgi_script_t)
 ')
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate 
-##	an apcupsd environment
+##	All of the rules required to
+##	administrate an apcupsd environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -133,17 +135,15 @@
 ## </param>
 ## <param name="role">
 ##	<summary>
-##	The role to be allowed to manage the apcupsd domain.
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <rolecap/>
 #
 interface(`apcupsd_admin',`
 	gen_require(`
-		type apcupsd_t, apcupsd_tmp_t;
-		type apcupsd_log_t, apcupsd_lock_t;
-		type apcupsd_var_run_t;
-		type apcupsd_initrc_exec_t;
+		type apcupsd_t, apcupsd_tmp_t, apcupsd_log_t;
+		type apcupsd_var_run_t, apcupsd_initrc_exec_t, apcupsd_lock_t;
 	')
 
 	allow $1 apcupsd_t:process { ptrace signal_perms };
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/apcupsd.te refpolicy/policy/modules/contrib/apcupsd.te
--- refpolicy/policy/modules/contrib/apcupsd.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/apcupsd.te	2012-10-27 13:44:57.305007515 +0200
@@ -1,4 +1,4 @@
-policy_module(apcupsd, 1.8.0)
+policy_module(apcupsd, 1.8.3)
 
 ########################################
 #
@@ -26,7 +26,7 @@
 
 ########################################
 #
-# apcupsd local policy
+# Local policy
 #
 
 allow apcupsd_t self:capability { dac_override setgid sys_tty_config };
@@ -38,9 +38,10 @@
 allow apcupsd_t apcupsd_lock_t:file manage_file_perms;
 files_lock_filetrans(apcupsd_t, apcupsd_lock_t, file)
 
-allow apcupsd_t apcupsd_log_t:dir setattr;
-manage_files_pattern(apcupsd_t, apcupsd_log_t, apcupsd_log_t)
-logging_log_filetrans(apcupsd_t, apcupsd_log_t, { file dir })
+append_files_pattern(apcupsd_t, apcupsd_log_t, apcupsd_log_t)
+create_files_pattern(apcupsd_t, apcupsd_log_t, apcupsd_log_t)
+setattr_files_pattern(apcupsd_t, apcupsd_log_t, apcupsd_log_t)
+logging_log_filetrans(apcupsd_t, apcupsd_log_t, file)
 
 manage_files_pattern(apcupsd_t, apcupsd_tmp_t, apcupsd_tmp_t)
 files_tmp_filetrans(apcupsd_t, apcupsd_tmp_t, file)
@@ -59,28 +60,19 @@
 corenet_tcp_sendrecv_generic_node(apcupsd_t)
 corenet_tcp_sendrecv_all_ports(apcupsd_t)
 corenet_tcp_bind_generic_node(apcupsd_t)
+
 corenet_tcp_bind_apcupsd_port(apcupsd_t)
 corenet_sendrecv_apcupsd_server_packets(apcupsd_t)
 corenet_tcp_connect_apcupsd_port(apcupsd_t)
 
 dev_rw_generic_usb_dev(apcupsd_t)
 
-# Init script handling
-domain_use_interactive_fds(apcupsd_t)
-
 files_read_etc_files(apcupsd_t)
-files_search_locks(apcupsd_t)
-# Creates /etc/nologin
 files_manage_etc_runtime_files(apcupsd_t)
-files_etc_filetrans_etc_runtime(apcupsd_t, file)
+files_etc_filetrans_etc_runtime(apcupsd_t, file, "nologin")
 
-# https://bugzilla.redhat.com/bugzilla/show_bug.cgi?id=240805
 term_use_unallocated_ttys(apcupsd_t)
 
-#apcupsd runs shutdown, probably need a shutdown domain
-init_rw_utmp(apcupsd_t)
-init_telinit(apcupsd_t)
-
 logging_send_syslog_msg(apcupsd_t)
 
 miscfiles_read_localization(apcupsd_t)
@@ -104,7 +96,7 @@
 
 ########################################
 #
-# apcupsd_cgi Declarations
+# CGI local policy
 #
 
 optional_policy(`
@@ -118,6 +110,7 @@
 	corenet_tcp_sendrecv_generic_if(httpd_apcupsd_cgi_script_t)
 	corenet_tcp_sendrecv_generic_node(httpd_apcupsd_cgi_script_t)
 	corenet_tcp_sendrecv_all_ports(httpd_apcupsd_cgi_script_t)
+	corenet_sendrecv_apcupsd_client_packets(httpd_apcupsd_cgi_script_t)
 	corenet_tcp_connect_apcupsd_port(httpd_apcupsd_cgi_script_t)
 	corenet_udp_sendrecv_generic_if(httpd_apcupsd_cgi_script_t)
 	corenet_udp_sendrecv_generic_node(httpd_apcupsd_cgi_script_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/apm.fc refpolicy/policy/modules/contrib/apm.fc
--- refpolicy/policy/modules/contrib/apm.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/apm.fc	2012-09-27 20:03:30.727126498 +0200
@@ -1,23 +1,18 @@
+/etc/rc\.d/init\.d/acpid	--	gen_context(system_u:object_r:apmd_initrc_exec_t,s0)
 
-#
-# /usr
-#
-/usr/bin/apm		--	gen_context(system_u:object_r:apm_exec_t,s0)
+/usr/bin/apm	--	gen_context(system_u:object_r:apm_exec_t,s0)
 
-/usr/sbin/acpid		--	gen_context(system_u:object_r:apmd_exec_t,s0)
-/usr/sbin/apmd		--	gen_context(system_u:object_r:apmd_exec_t,s0)
+/usr/sbin/acpid	--	gen_context(system_u:object_r:apmd_exec_t,s0)
+/usr/sbin/apmd	--	gen_context(system_u:object_r:apmd_exec_t,s0)
 /usr/sbin/powersaved	--	gen_context(system_u:object_r:apmd_exec_t,s0)
 
-#
-# /var
-#
+/var/lock/subsys/acpid	--	gen_context(system_u:object_r:apmd_lock_t,s0)
+
 /var/log/acpid.*	--	gen_context(system_u:object_r:apmd_log_t,s0)
 
-/var/run/\.?acpid\.socket -s	gen_context(system_u:object_r:apmd_var_run_t,s0)
+/var/run/\.?acpid\.socket	-s	gen_context(system_u:object_r:apmd_var_run_t,s0)
 /var/run/apmd\.pid	--	gen_context(system_u:object_r:apmd_var_run_t,s0)
-/var/run/powersaved\.pid --	gen_context(system_u:object_r:apmd_var_run_t,s0)
-/var/run/powersave_socket -s	gen_context(system_u:object_r:apmd_var_run_t,s0)
+/var/run/powersaved\.pid	--	gen_context(system_u:object_r:apmd_var_run_t,s0)
+/var/run/powersave_socket	-s	gen_context(system_u:object_r:apmd_var_run_t,s0)
 
-ifdef(`distro_suse',`
-/var/lib/acpi(/.*)?		gen_context(system_u:object_r:apmd_var_lib_t,s0)
-')
+/var/lib/acpi(/.*)?	gen_context(system_u:object_r:apmd_var_lib_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/apm.if refpolicy/policy/modules/contrib/apm.if
--- refpolicy/policy/modules/contrib/apm.if	2012-05-04 15:16:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/apm.if	2012-09-27 20:03:30.727126498 +0200
@@ -1,8 +1,8 @@
-## <summary>Advanced power management daemon</summary>
+## <summary>Advanced power management.</summary>
 
 ########################################
 ## <summary>
-##	Execute APM in the apm domain.
+##	Execute apm in the apm domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -21,7 +21,33 @@
 
 ########################################
 ## <summary>
-##	Use file descriptors for apmd.
+##	Execute apm in the apm domain
+##	and allow the specified role
+##	the apm domain.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed to transition.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+#
+interface(`apm_run_client',`
+	gen_require(`
+		attribute_role apm_roles;
+	')
+
+	apm_domtrans_client($1)
+	roleattribute $2 apm_roles;
+')
+
+########################################
+## <summary>
+##	Use apmd file descriptors.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -39,7 +65,7 @@
 
 ########################################
 ## <summary>
-##	Write to apmd unnamed pipes.
+##	Write apmd unnamed pipes.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -57,7 +83,8 @@
 
 ########################################
 ## <summary>
-##	Read and write to an apm unix stream socket.
+##	Read and write to apmd unix
+##	stream sockets.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -75,7 +102,7 @@
 
 ########################################
 ## <summary>
-##	Append to apm's log file.
+##	Append apmd log files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -89,12 +116,13 @@
 	')
 
 	logging_search_logs($1)
-	allow $1 apmd_log_t:file append;
+	allow $1 apmd_log_t:file append_file_perms;
 ')
 
 ########################################
 ## <summary>
-##	Connect to apmd over an unix stream socket.
+##	Connect to apmd over an unix
+##	stream socket.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -108,6 +136,55 @@
 	')
 
 	files_search_pids($1)
-	allow $1 apmd_var_run_t:sock_file write;
-	allow $1 apmd_t:unix_stream_socket connectto;
+	stream_connect_pattern($1, apmd_var_run_t, apmd_var_run_t, apmd_t)
+')
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an apm environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`apm_admin',`
+	gen_require(`
+		type apmd_t, apmd_initrc_exec_t, apmd_log_t;
+		type apmd_lock_t, apmd_var_run_t, apmd_var_lib_t;
+		type apmd_tmp_t;
+	')
+
+	allow $1 apmd_t:process { ptrace signal_perms };
+	ps_process_pattern($1, apmd_t)
+
+	init_labeled_script_domtrans($1, apmd_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 apmd_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	logging_search_logs($1)
+	admin_pattern($1, apmd_log_t)
+
+	files_search_locks($1)
+	admin_pattern($1, apmd_lock_t)
+
+	files_search_pids($1)
+	admin_pattern($1, apmd_var_run_t)
+
+	files_search_var_lib($1)
+	admin_pattern($1, apmd_var_lib_t)
+
+	files_search_tmp($1)
+	admin_pattern($1, apmd_tmp_t)
+
+	apm_run_client($1, $2)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/apm.te refpolicy/policy/modules/contrib/apm.te
--- refpolicy/policy/modules/contrib/apm.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/apm.te	2012-10-27 13:44:57.305007515 +0200
@@ -1,17 +1,27 @@
-policy_module(apm, 1.11.0)
+policy_module(apm, 1.11.3)
 
 ########################################
 #
 # Declarations
 #
+
+attribute_role apm_roles;
+roleattribute system_r apm_roles;
+
 type apmd_t;
 type apmd_exec_t;
 init_daemon_domain(apmd_t, apmd_exec_t)
 
+type apmd_initrc_exec_t;
+init_script_file(apmd_initrc_exec_t)
+
 type apm_t;
 type apm_exec_t;
 application_domain(apm_t, apm_exec_t)
-role system_r types apm_t;
+role apm_roles types apm_t;
+
+type apmd_lock_t;
+files_lock_file(apmd_lock_t)
 
 type apmd_log_t;
 logging_log_file(apmd_log_t)
@@ -19,22 +29,15 @@
 type apmd_tmp_t;
 files_tmp_file(apmd_tmp_t)
 
+type apmd_var_lib_t;
+files_type(apmd_var_lib_t)
+
 type apmd_var_run_t;
 files_pid_file(apmd_var_run_t)
 
-ifdef(`distro_redhat',`
-	type apmd_lock_t;
-	files_lock_file(apmd_lock_t)
-')
-
-ifdef(`distro_suse',`
-	type apmd_var_lib_t;
-	files_type(apmd_var_lib_t)
-')
-
 ########################################
 #
-# apm client Local policy
+# Client local policy
 #
 
 allow apm_t self:capability { dac_override sys_admin };
@@ -53,17 +56,18 @@
 
 ########################################
 #
-# apm daemon Local policy
+# Server local policy
 #
 
-# mknod: controlling an orderly resume of PCMCIA requires creating device
-# nodes 254,{0,1,2} for some reason.
 allow apmd_t self:capability { sys_admin sys_nice sys_time kill mknod };
 dontaudit apmd_t self:capability { setuid dac_override dac_read_search sys_ptrace sys_tty_config };
 allow apmd_t self:process { signal_perms getsession };
 allow apmd_t self:fifo_file rw_fifo_file_perms;
-allow apmd_t self:unix_dgram_socket create_socket_perms;
-allow apmd_t self:unix_stream_socket create_stream_socket_perms;
+allow apmd_t self:netlink_socket create_socket_perms;
+allow apmd_t self:unix_stream_socket { accept listen };
+
+allow apmd_t apmd_lock_t:file manage_file_perms;
+files_lock_filetrans(apmd_t, apmd_lock_t, file)
 
 allow apmd_t apmd_log_t:file manage_file_perms;
 logging_log_filetrans(apmd_t, apmd_log_t, file)
@@ -72,29 +76,44 @@
 manage_files_pattern(apmd_t, apmd_tmp_t, apmd_tmp_t)
 files_tmp_filetrans(apmd_t, apmd_tmp_t, { file dir })
 
+manage_dirs_pattern(apmd_t, apmd_var_lib_t, apmd_var_lib_t)
+manage_files_pattern(apmd_t, apmd_var_lib_t, apmd_var_lib_t)
+files_var_lib_filetrans(apmd_t, apmd_var_lib_t, dir)
+
 manage_files_pattern(apmd_t, apmd_var_run_t, apmd_var_run_t)
 manage_sock_files_pattern(apmd_t, apmd_var_run_t, apmd_var_run_t)
 files_pid_filetrans(apmd_t, apmd_var_run_t, { file sock_file })
 
+can_exec(apmd_t, apmd_var_run_t)
+
 kernel_read_kernel_sysctls(apmd_t)
 kernel_rw_all_sysctls(apmd_t)
 kernel_read_system_state(apmd_t)
 kernel_write_proc_files(apmd_t)
 
+dev_read_input(apmd_t)
+dev_read_mouse(apmd_t)
 dev_read_realtime_clock(apmd_t)
 dev_read_urand(apmd_t)
 dev_rw_apm_bios(apmd_t)
 dev_rw_sysfs(apmd_t)
-dev_dontaudit_getattr_all_chr_files(apmd_t) # Excessive?
-dev_dontaudit_getattr_all_blk_files(apmd_t) # Excessive?
+dev_dontaudit_getattr_all_chr_files(apmd_t)
+dev_dontaudit_getattr_all_blk_files(apmd_t)
+
+files_exec_etc_files(apmd_t)
+files_read_etc_runtime_files(apmd_t)
+files_dontaudit_getattr_all_files(apmd_t)
+files_dontaudit_getattr_all_symlinks(apmd_t)
+files_dontaudit_getattr_all_pipes(apmd_t)
+files_dontaudit_getattr_all_sockets(apmd_t)
 
 fs_dontaudit_list_tmpfs(apmd_t)
 fs_getattr_all_fs(apmd_t)
 fs_search_auto_mountpoints(apmd_t)
-fs_dontaudit_getattr_all_files(apmd_t) # Excessive?
-fs_dontaudit_getattr_all_symlinks(apmd_t) # Excessive?
-fs_dontaudit_getattr_all_pipes(apmd_t) # Excessive?
-fs_dontaudit_getattr_all_sockets(apmd_t) # Excessive?
+fs_dontaudit_getattr_all_files(apmd_t)
+fs_dontaudit_getattr_all_symlinks(apmd_t)
+fs_dontaudit_getattr_all_pipes(apmd_t)
+fs_dontaudit_getattr_all_sockets(apmd_t)
 
 selinux_search_fs(apmd_t)
 
@@ -104,25 +123,18 @@
 domain_dontaudit_ptrace_all_domains(apmd_t)
 domain_use_interactive_fds(apmd_t)
 domain_dontaudit_getattr_all_sockets(apmd_t)
-domain_dontaudit_getattr_all_key_sockets(apmd_t) # Excessive?
-domain_dontaudit_list_all_domains_state(apmd_t) # Excessive?
+domain_dontaudit_getattr_all_key_sockets(apmd_t)
+domain_dontaudit_list_all_domains_state(apmd_t)
 
-files_exec_etc_files(apmd_t)
-files_read_etc_runtime_files(apmd_t)
-files_dontaudit_getattr_all_files(apmd_t) # Excessive?
-files_dontaudit_getattr_all_symlinks(apmd_t) # Excessive?
-files_dontaudit_getattr_all_pipes(apmd_t) # Excessive?
-files_dontaudit_getattr_all_sockets(apmd_t) # Excessive?
+auth_use_nsswitch(apmd_t)
 
 init_domtrans_script(apmd_t)
-init_rw_utmp(apmd_t)
-init_telinit(apmd_t)
 
 libs_exec_ld_so(apmd_t)
 libs_exec_lib_files(apmd_t)
 
-logging_send_syslog_msg(apmd_t)
 logging_send_audit_msgs(apmd_t)
+logging_send_syslog_msg(apmd_t)
 
 miscfiles_read_localization(apmd_t)
 miscfiles_read_hwdata(apmd_t)
@@ -134,37 +146,7 @@
 
 userdom_dontaudit_use_unpriv_user_fds(apmd_t)
 userdom_dontaudit_search_user_home_dirs(apmd_t)
-userdom_dontaudit_search_user_home_content(apmd_t) # Excessive?
-
-ifdef(`distro_redhat',`
-	allow apmd_t apmd_lock_t:file manage_file_perms;
-	files_lock_filetrans(apmd_t, apmd_lock_t, file)
-
-	can_exec(apmd_t, apmd_var_run_t)
-
-	# ifconfig_exec_t needs to be run in its own domain for Red Hat
-	optional_policy(`
-		sysnet_domtrans_ifconfig(apmd_t)
-	')
-
-	optional_policy(`
-		iptables_domtrans(apmd_t)
-	')
-
-	optional_policy(`
-		netutils_domtrans(apmd_t)
-	')
-
-',`
-	# for ifconfig which is run all the time
-	kernel_dontaudit_search_sysctl(apmd_t)
-')
-
-ifdef(`distro_suse',`
-	manage_dirs_pattern(apmd_t, apmd_var_lib_t, apmd_var_lib_t)
-	manage_files_pattern(apmd_t, apmd_var_lib_t, apmd_var_lib_t)
-	files_var_lib_filetrans(apmd_t, apmd_var_lib_t, file)
-')
+userdom_dontaudit_search_user_home_content(apmd_t)
 
 optional_policy(`
 	automount_domtrans(apmd_t)
@@ -181,6 +163,12 @@
 ')
 
 optional_policy(`
+	devicekit_manage_pid_files(apmd_t)
+	devicekit_manage_log_files(apmd_t)
+	devicekit_relabel_log_files(apmd_t)
+')
+
+optional_policy(`
 	dbus_system_bus_client(apmd_t)
 
 	optional_policy(`
@@ -193,6 +181,14 @@
 ')
 
 optional_policy(`
+	fstools_domtrans(apmd_t)
+')
+
+optional_policy(`
+	iptables_domtrans(apmd_t)
+')
+
+optional_policy(`
 	logrotate_use_fds(apmd_t)
 ')
 
@@ -201,7 +197,7 @@
 ')
 
 optional_policy(`
-	nscd_socket_use(apmd_t)
+	netutils_domtrans(apmd_t)
 ')
 
 optional_policy(`
@@ -214,19 +210,22 @@
 ')
 
 optional_policy(`
-	udev_read_db(apmd_t)
-	udev_read_state(apmd_t) #necessary?
+	shutdown_domtrans(apmd_t)
+')
+
+optional_policy(`
+	sysnet_domtrans_ifconfig(apmd_t)
 ')
 
 optional_policy(`
-	unconfined_domain(apmd_t)
+	udev_read_db(apmd_t)
+	udev_read_state(apmd_t)
 ')
 
 optional_policy(`
 	vbetool_domtrans(apmd_t)
 ')
 
-# cjp: related to sleep/resume (?)
 optional_policy(`
 	xserver_domtrans(apmd_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/apt.fc refpolicy/policy/modules/contrib/apt.fc
--- refpolicy/policy/modules/contrib/apt.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/apt.fc	2012-10-27 13:02:51.702002124 +0200
@@ -1,21 +1,17 @@
-/usr/bin/apt-get		--	gen_context(system_u:object_r:apt_exec_t,s0)
-# apt-shell is redhat specific
-/usr/bin/apt-shell		--	gen_context(system_u:object_r:apt_exec_t,s0)
-# other package managers
-/usr/bin/aptitude		--	gen_context(system_u:object_r:apt_exec_t,s0)
-/usr/sbin/synaptic		--	gen_context(system_u:object_r:apt_exec_t,s0)
+ifndef(`distro_redhat',`
+/usr/bin/apt-get	--	gen_context(system_u:object_r:apt_exec_t,s0)
+/usr/bin/apt-shell	--	gen_context(system_u:object_r:apt_exec_t,s0)
+/usr/bin/aptitude	--	gen_context(system_u:object_r:apt_exec_t,s0)
+/usr/sbin/synaptic	--	gen_context(system_u:object_r:apt_exec_t,s0)
+')
 
-# package cache repository
-/var/cache/apt(/.*)?			gen_context(system_u:object_r:apt_var_cache_t,s0)
+/var/cache/apt(/.*)?	gen_context(system_u:object_r:apt_var_cache_t,s0)
 
-# package list repository
-/var/lib/apt(/.*)?			gen_context(system_u:object_r:apt_var_lib_t,s0)
-/var/lib/aptitude(/.*)?			gen_context(system_u:object_r:apt_var_lib_t,s0)
+/var/lib/apt(/.*)?	gen_context(system_u:object_r:apt_var_lib_t,s0)
+/var/lib/aptitude(/.*)?	gen_context(system_u:object_r:apt_var_lib_t,s0)
 
-# aptitude lock
-/var/lock/aptitude			gen_context(system_u:object_r:apt_lock_t,s0)
-# aptitude log
-/var/log/aptitude.*			gen_context(system_u:object_r:apt_var_log_t,s0)
+/var/lock/aptitude	gen_context(system_u:object_r:apt_lock_t,s0)
 
-# dpkg terminal log
-/var/log/apt(/.*)?			gen_context(system_u:object_r:apt_var_log_t,s0)
+/var/log/aptitude.*	gen_context(system_u:object_r:apt_var_log_t,s0)
+
+/var/log/apt(/.*)?	gen_context(system_u:object_r:apt_var_log_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/apt.if refpolicy/policy/modules/contrib/apt.if
--- refpolicy/policy/modules/contrib/apt.if	2012-05-04 15:16:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/apt.if	2012-09-27 20:03:30.728126498 +0200
@@ -1,4 +1,4 @@
-## <summary>APT advanced package tool.</summary>
+## <summary>Advanced package tool.</summary>
 
 ########################################
 ## <summary>
@@ -15,7 +15,6 @@
 		type apt_t, apt_exec_t;
 	')
 
-	files_search_usr($1)
 	corecmd_search_bin($1)
 	domtrans_pattern($1, apt_exec_t, apt_t)
 ')
@@ -31,24 +30,23 @@
 ## </param>
 ## <param name="role">
 ##	<summary>
-##	The role to allow the apt domain.
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <rolecap/>
 #
 interface(`apt_run',`
 	gen_require(`
-		type apt_t;
+		attribute_role apt_roles;
 	')
 
 	apt_domtrans($1)
-	role $2 types apt_t;
-	# TODO: likely have to add dpkg_run here.
+	roleattribute $2 apt_roles;
 ')
 
 ########################################
 ## <summary>
-##	Inherit and use file descriptors from apt.
+##	Use apt file descriptors.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -62,12 +60,12 @@
 	')
 
 	allow $1 apt_t:fd use;
-	# TODO: enforce dpkg_use_fd?
 ')
 
 ########################################
 ## <summary>
-##	Do not audit attempts to use file descriptors from apt.
+##	Do not audit attempts to use
+##	apt file descriptors.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -85,7 +83,7 @@
 
 ########################################
 ## <summary>
-##	Read from an unnamed apt pipe.
+##	Read apt unnamed pipes.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -99,12 +97,11 @@
 	')
 
 	allow $1 apt_t:fifo_file read_fifo_file_perms;
-	# TODO: enforce dpkg_read_pipes?
 ')
 
 ########################################
 ## <summary>
-##	Read and write an unnamed apt pipe.
+##	Read and write apt unnamed pipes.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -118,12 +115,11 @@
 	')
 
 	allow $1 apt_t:fifo_file rw_file_perms;
-	# TODO: enforce dpkg_rw_pipes?
 ')
 
 ########################################
 ## <summary>
-##	Read from and write to apt ptys.
+##	Read and write apt ptys.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -141,7 +137,7 @@
 
 ########################################
 ## <summary>
-##	Read the apt package cache.
+##	Read apt package cache content.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -156,13 +152,13 @@
 
 	files_search_var($1)
 	allow $1 apt_var_cache_t:dir list_dir_perms;
-	dontaudit $1 apt_var_cache_t:dir write;
+	dontaudit $1 apt_var_cache_t:dir write_dir_perms;
 	allow $1 apt_var_cache_t:file read_file_perms;
 ')
 
 ########################################
 ## <summary>
-##	Read the apt package database.
+##	Read apt package database content.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -183,7 +179,8 @@
 
 ########################################
 ## <summary>
-##	Create, read, write, and delete the apt package database.
+##	Create, read, write, and delete
+##	apt package database content.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -198,15 +195,14 @@
 
 	files_search_var_lib($1)
 	manage_files_pattern($1, apt_var_lib_t, apt_var_lib_t)
-	# cjp: shouldnt this be manage_lnk_files?
-	rw_lnk_files_pattern($1, apt_var_lib_t, apt_var_lib_t)
-	delete_lnk_files_pattern($1, apt_var_lib_t, apt_var_lib_t)
+	manage_lnk_files_pattern($1, apt_var_lib_t, apt_var_lib_t)
 ')
 
 ########################################
 ## <summary>
-##	Do not audit attempts to create, read, 
-##	write, and delete the apt package database.
+##	Do not audit attempts to create,
+##	read, write, and delete apt
+##	package database content.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/apt.te refpolicy/policy/modules/contrib/apt.te
--- refpolicy/policy/modules/contrib/apt.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/apt.te	2012-10-27 13:02:51.713002124 +0200
@@ -1,21 +1,21 @@
-policy_module(apt, 1.7.0)
+policy_module(apt, 1.7.4)
 
 ########################################
 #
 # Declarations
 #
 
+attribute_role apt_roles;
+
 type apt_t;
 type apt_exec_t;
 init_system_domain(apt_t, apt_exec_t)
 domain_system_change_exemption(apt_t)
-role system_r types apt_t;
+role apt_roles types apt_t;
 
-# pseudo terminal for running dpkg
 type apt_devpts_t;
 term_pty(apt_devpts_t)
 
-# aptitude lock file
 type apt_lock_t;
 files_lock_file(apt_lock_t)
 
@@ -25,44 +25,37 @@
 type apt_tmpfs_t;
 files_tmpfs_file(apt_tmpfs_t)
 
-# package cache
 type apt_var_cache_t alias var_cache_apt_t;
 files_type(apt_var_cache_t)
 
-# status files
 type apt_var_lib_t alias var_lib_apt_t;
 files_type(apt_var_lib_t)
 
-# aptitude log file
 type apt_var_log_t;
 logging_log_file(apt_var_log_t)
 
 ########################################
 #
-# apt Local policy
+# Local policy
 #
 
 allow apt_t self:capability { chown dac_override fowner fsetid };
 allow apt_t self:process { signal setpgid fork };
 allow apt_t self:fd use;
 allow apt_t self:fifo_file rw_fifo_file_perms;
-allow apt_t self:unix_dgram_socket create_socket_perms;
-allow apt_t self:unix_stream_socket rw_stream_socket_perms;
 allow apt_t self:unix_dgram_socket sendto;
-allow apt_t self:unix_stream_socket connectto;
+allow apt_t self:unix_stream_socket { accept connectto listen };
 allow apt_t self:udp_socket { connect create_socket_perms };
 allow apt_t self:tcp_socket create_stream_socket_perms;
 allow apt_t self:shm create_shm_perms;
 allow apt_t self:sem create_sem_perms;
 allow apt_t self:msgq create_msgq_perms;
 allow apt_t self:msg { send receive };
-# Run update
 allow apt_t self:netlink_route_socket r_netlink_socket_perms;
 
-# lock files
 allow apt_t apt_lock_t:dir manage_dir_perms;
 allow apt_t apt_lock_t:file manage_file_perms;
-files_lock_filetrans(apt_t, apt_lock_t, {dir file})
+files_lock_filetrans(apt_t, apt_lock_t, { dir file })
 
 manage_dirs_pattern(apt_t, apt_tmp_t, apt_tmp_t)
 manage_files_pattern(apt_t, apt_tmp_t, apt_tmp_t)
@@ -75,38 +68,29 @@
 manage_sock_files_pattern(apt_t, apt_tmpfs_t, apt_tmpfs_t)
 fs_tmpfs_filetrans(apt_t, apt_tmpfs_t, { dir file lnk_file sock_file fifo_file })
 
-# Access /var/cache/apt files
 manage_files_pattern(apt_t, apt_var_cache_t, apt_var_cache_t)
 files_var_filetrans(apt_t, apt_var_cache_t, dir)
 
-# Access /var/lib/apt files
 manage_files_pattern(apt_t, apt_var_lib_t, apt_var_lib_t)
 files_var_lib_filetrans(apt_t, apt_var_lib_t, dir)
 
-# log files
 allow apt_t apt_var_log_t:file manage_file_perms;
 logging_log_filetrans(apt_t, apt_var_log_t, file)
 
 kernel_read_system_state(apt_t)
 kernel_read_kernel_sysctls(apt_t)
 
-# to launch dpkg-preconfigure
 corecmd_exec_bin(apt_t)
 corecmd_exec_shell(apt_t)
 
 corenet_all_recvfrom_unlabeled(apt_t)
 corenet_all_recvfrom_netlabel(apt_t)
 corenet_tcp_sendrecv_generic_if(apt_t)
-corenet_udp_sendrecv_generic_if(apt_t)
 corenet_tcp_sendrecv_generic_node(apt_t)
-corenet_udp_sendrecv_generic_node(apt_t)
 corenet_tcp_sendrecv_all_ports(apt_t)
-corenet_udp_sendrecv_all_ports(apt_t)
-# TODO: really allow all these?
-corenet_tcp_bind_generic_node(apt_t)
-corenet_udp_bind_generic_node(apt_t)
-corenet_tcp_connect_all_ports(apt_t)
+
 corenet_sendrecv_all_client_packets(apt_t)
+corenet_tcp_connect_all_ports(apt_t)
 
 dev_read_urand(apt_t)
 
@@ -136,13 +120,11 @@
 
 userdom_use_user_terminals(apt_t)
 
-# with boolean, for cron-apt and such?
-#optional_policy(`
-#	cron_system_entry(apt_t,apt_exec_t)
-#')
+optional_policy(`
+	cron_system_entry(apt_t, apt_exec_t)
+')
 
 optional_policy(`
-	# dpkg interaction
 	dpkg_read_db(apt_t)
 	dpkg_domtrans(apt_t)
 	dpkg_lock_db(apt_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/arpwatch.fc refpolicy/policy/modules/contrib/arpwatch.fc
--- refpolicy/policy/modules/contrib/arpwatch.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/arpwatch.fc	2012-09-27 20:03:30.728126498 +0200
@@ -1,12 +1,9 @@
-/etc/rc\.d/init\.d/arpwatch --	gen_context(system_u:object_r:arpwatch_initrc_exec_t,s0)
+/etc/rc\.d/init\.d/arpwatch	--	gen_context(system_u:object_r:arpwatch_initrc_exec_t,s0)
 
-#
-# /usr
-#
 /usr/sbin/arpwatch	--	gen_context(system_u:object_r:arpwatch_exec_t,s0)
 
-#
-# /var
-#
-/var/arpwatch(/.*)?		gen_context(system_u:object_r:arpwatch_data_t,s0)
-/var/lib/arpwatch(/.*)?		gen_context(system_u:object_r:arpwatch_data_t,s0)
+/var/arpwatch(/.*)?	gen_context(system_u:object_r:arpwatch_data_t,s0)
+
+/var/lib/arpwatch(/.*)?	gen_context(system_u:object_r:arpwatch_data_t,s0)
+
+/var/run/arpwatch.*\.pid	--	gen_context(system_u:object_r:arpwatch_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/arpwatch.if refpolicy/policy/modules/contrib/arpwatch.if
--- refpolicy/policy/modules/contrib/arpwatch.if	2012-05-04 15:16:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/arpwatch.if	2012-09-27 20:03:30.728126498 +0200
@@ -2,7 +2,8 @@
 
 ########################################
 ## <summary>
-##	Execute arpwatch server in the arpwatch domain.
+##	Execute arpwatch server in the
+##	arpwatch domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -20,7 +21,7 @@
 
 ########################################
 ## <summary>
-##	Search arpwatch's data file directories.
+##	Search arpwatch data file directories.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -39,7 +40,8 @@
 
 ########################################
 ## <summary>
-##	Create arpwatch data files.
+##	Create, read, write, and delete
+##	arpwatch data files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -58,7 +60,8 @@
 
 ########################################
 ## <summary>
-##	Read and write arpwatch temporary files.
+##	Read and write arpwatch temporary
+##	files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -77,7 +80,8 @@
 
 ########################################
 ## <summary>
-##	Read and write arpwatch temporary files.
+##	Create, read, write, and delete
+##	arpwatch temporary files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -96,8 +100,8 @@
 
 ########################################
 ## <summary>
-##	Do not audit attempts to read and write
-##	arpwatch packet sockets.
+##	Do not audit attempts to read and
+##	write arpwatch packet sockets.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -115,8 +119,8 @@
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate 
-##	an arpwatch environment
+##	All of the rules required to
+##	administrate an arpwatch environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -125,19 +129,18 @@
 ## </param>
 ## <param name="role">
 ##	<summary>
-##	The role to be allowed to manage the arpwatch domain.
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <rolecap/>
 #
 interface(`arpwatch_admin',`
 	gen_require(`
-		type arpwatch_t, arpwatch_tmp_t;
+		type arpwatch_t, arpwatch_tmp_t, arpwatch_initrc_exec_t;
 		type arpwatch_data_t, arpwatch_var_run_t;
-		type arpwatch_initrc_exec_t;
 	')
 
-	allow $1 arpwatch_t:process { ptrace signal_perms getattr };
+	allow $1 arpwatch_t:process { ptrace signal_perms };
 	ps_process_pattern($1, arpwatch_t)
 
 	arpwatch_initrc_domtrans($1)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/arpwatch.te refpolicy/policy/modules/contrib/arpwatch.te
--- refpolicy/policy/modules/contrib/arpwatch.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/arpwatch.te	2012-09-27 20:03:30.728126498 +0200
@@ -1,4 +1,4 @@
-policy_module(arpwatch, 1.10.0)
+policy_module(arpwatch, 1.10.4)
 
 ########################################
 #
@@ -9,12 +9,12 @@
 type arpwatch_exec_t;
 init_daemon_domain(arpwatch_t, arpwatch_exec_t)
 
-type arpwatch_data_t;
-files_type(arpwatch_data_t)
-
 type arpwatch_initrc_exec_t;
 init_script_file(arpwatch_initrc_exec_t)
 
+type arpwatch_data_t;
+files_type(arpwatch_data_t)
+
 type arpwatch_tmp_t;
 files_tmp_file(arpwatch_tmp_t)
 
@@ -25,13 +25,12 @@
 #
 # Local policy
 #
+
 allow arpwatch_t self:capability { net_admin net_raw setgid setuid };
 dontaudit arpwatch_t self:capability sys_tty_config;
 allow arpwatch_t self:process signal_perms;
-allow arpwatch_t self:unix_dgram_socket create_socket_perms;
-allow arpwatch_t self:unix_stream_socket create_stream_socket_perms;
-allow arpwatch_t self:tcp_socket { connect create_stream_socket_perms };
-allow arpwatch_t self:udp_socket create_socket_perms;
+allow arpwatch_t self:unix_stream_socket { accept listen };
+allow arpwatch_t self:tcp_socket { accept listen };
 allow arpwatch_t self:packet_socket create_socket_perms;
 allow arpwatch_t self:socket create_socket_perms;
 
@@ -46,23 +45,11 @@
 manage_files_pattern(arpwatch_t, arpwatch_var_run_t, arpwatch_var_run_t)
 files_pid_filetrans(arpwatch_t, arpwatch_var_run_t, file)
 
-kernel_read_network_state(arpwatch_t)
 kernel_read_kernel_sysctls(arpwatch_t)
-kernel_list_proc(arpwatch_t)
-kernel_read_proc_symlinks(arpwatch_t)
+kernel_read_network_state(arpwatch_t)
+kernel_read_system_state(arpwatch_t)
 kernel_request_load_module(arpwatch_t)
 
-corenet_all_recvfrom_unlabeled(arpwatch_t)
-corenet_all_recvfrom_netlabel(arpwatch_t)
-corenet_tcp_sendrecv_generic_if(arpwatch_t)
-corenet_udp_sendrecv_generic_if(arpwatch_t)
-corenet_raw_sendrecv_generic_if(arpwatch_t)
-corenet_tcp_sendrecv_generic_node(arpwatch_t)
-corenet_udp_sendrecv_generic_node(arpwatch_t)
-corenet_raw_sendrecv_generic_node(arpwatch_t)
-corenet_tcp_sendrecv_all_ports(arpwatch_t)
-corenet_udp_sendrecv_all_ports(arpwatch_t)
-
 dev_read_sysfs(arpwatch_t)
 dev_read_usbmon_dev(arpwatch_t)
 dev_rw_generic_usb_dev(arpwatch_t)
@@ -70,11 +57,8 @@
 fs_getattr_all_fs(arpwatch_t)
 fs_search_auto_mountpoints(arpwatch_t)
 
-corecmd_read_bin_symlinks(arpwatch_t)
-
 domain_use_interactive_fds(arpwatch_t)
 
-files_read_etc_files(arpwatch_t)
 files_read_usr_files(arpwatch_t)
 files_search_var_lib(arpwatch_t)
 
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/asterisk.fc refpolicy/policy/modules/contrib/asterisk.fc
--- refpolicy/policy/modules/contrib/asterisk.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/asterisk.fc	2012-09-27 20:03:30.729126498 +0200
@@ -1,9 +1,13 @@
-/etc/asterisk(/.*)?		gen_context(system_u:object_r:asterisk_etc_t,s0)
-/etc/rc\.d/init\.d/asterisk --	gen_context(system_u:object_r:asterisk_initrc_exec_t,s0)
+/etc/asterisk(/.*)?	gen_context(system_u:object_r:asterisk_etc_t,s0)
+
+/etc/rc\.d/init\.d/asterisk	--	gen_context(system_u:object_r:asterisk_initrc_exec_t,s0)
 
 /usr/sbin/asterisk	--	gen_context(system_u:object_r:asterisk_exec_t,s0)
 
-/var/lib/asterisk(/.*)?		gen_context(system_u:object_r:asterisk_var_lib_t,s0)
-/var/log/asterisk(/.*)?		gen_context(system_u:object_r:asterisk_log_t,s0)
-/var/run/asterisk(/.*)?		gen_context(system_u:object_r:asterisk_var_run_t,s0)
+/var/lib/asterisk(/.*)?	gen_context(system_u:object_r:asterisk_var_lib_t,s0)
+
+/var/log/asterisk(/.*)?	gen_context(system_u:object_r:asterisk_log_t,s0)
+
+/var/run/asterisk.*	gen_context(system_u:object_r:asterisk_var_run_t,s0)
+
 /var/spool/asterisk(/.*)?	gen_context(system_u:object_r:asterisk_spool_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/asterisk.if refpolicy/policy/modules/contrib/asterisk.if
--- refpolicy/policy/modules/contrib/asterisk.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/asterisk.if	2012-09-27 20:03:30.729126498 +0200
@@ -1,4 +1,4 @@
-## <summary>Asterisk IP telephony server</summary>
+## <summary>Asterisk IP telephony server.</summary>
 
 ######################################
 ## <summary>
@@ -21,7 +21,7 @@
 
 #####################################
 ## <summary>
-##	Connect to asterisk over a unix domain
+##	Connect to asterisk over a unix domain.
 ##	stream socket.
 ## </summary>
 ## <param name="domain">
@@ -41,7 +41,8 @@
 
 #######################################
 ## <summary>
-##	Allow changing the attributes of the asterisk log files and directories
+##	Set attributes of asterisk log
+##	files and directories.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -56,13 +57,13 @@
 
 	setattr_files_pattern($1, asterisk_log_t, asterisk_log_t)
 	setattr_dirs_pattern($1, asterisk_log_t, asterisk_log_t)
-
 	logging_search_logs($1)
 ')
 
 #######################################
 ## <summary>
-##	Allow changing the attributes of the asterisk PID files
+##	Set attributes of the asterisk
+##	PID content.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -82,8 +83,8 @@
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate
-##	an asterisk environment
+##	All of the rules required to
+##	administrate an asterisk environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -92,7 +93,7 @@
 ## </param>
 ## <param name="role">
 ##	<summary>
-##	The role to be allowed to manage the asterisk domain.
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <rolecap/>
@@ -101,11 +102,10 @@
 	gen_require(`
 		type asterisk_t, asterisk_var_run_t, asterisk_spool_t;
 		type asterisk_etc_t, asterisk_tmp_t, asterisk_log_t;
-		type asterisk_var_lib_t;
-		type asterisk_initrc_exec_t;
+		type asterisk_var_lib_t, asterisk_initrc_exec_t;
 	')
 
-	allow $1 asterisk_t:process { ptrace signal_perms getattr };
+	allow $1 asterisk_t:process { ptrace signal_perms };
 	ps_process_pattern($1, asterisk_t)
 
 	init_labeled_script_domtrans($1, asterisk_initrc_exec_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/asterisk.te refpolicy/policy/modules/contrib/asterisk.te
--- refpolicy/policy/modules/contrib/asterisk.te	2012-07-25 20:33:04.000000000 +0200
+++ refpolicy/policy/modules/contrib/asterisk.te	2012-09-27 20:03:30.729126498 +0200
@@ -1,4 +1,4 @@
-policy_module(asterisk, 1.11.0)
+policy_module(asterisk, 1.11.2)
 
 ########################################
 #
@@ -8,14 +8,13 @@
 type asterisk_t;
 type asterisk_exec_t;
 init_daemon_domain(asterisk_t, asterisk_exec_t)
-application_executable_file(asterisk_exec_t)
-
-type asterisk_etc_t;
-files_config_file(asterisk_etc_t)
 
 type asterisk_initrc_exec_t;
 init_script_file(asterisk_initrc_exec_t)
 
+type asterisk_etc_t;
+files_config_file(asterisk_etc_t)
+
 type asterisk_log_t;
 logging_log_file(asterisk_log_t)
 
@@ -33,32 +32,29 @@
 
 type asterisk_var_run_t;
 files_pid_file(asterisk_var_run_t)
+init_daemon_run_dir(asterisk_var_run_t, "asterisk")
 
 ########################################
 #
 # Local policy
 #
 
-# dac_override for /var/run/asterisk
-allow asterisk_t self:capability { dac_override setgid setuid sys_nice net_admin chown };
-dontaudit asterisk_t self:capability sys_tty_config;
+allow asterisk_t self:capability { dac_override chown setgid setuid sys_nice net_admin };
+dontaudit asterisk_t self:capability { sys_module sys_tty_config };
 allow asterisk_t self:process { getsched setsched signal_perms getcap setcap };
 allow asterisk_t self:fifo_file rw_fifo_file_perms;
 allow asterisk_t self:sem create_sem_perms;
 allow asterisk_t self:shm create_shm_perms;
-allow asterisk_t self:unix_stream_socket { connectto listen accept };
-allow asterisk_t self:tcp_socket create_stream_socket_perms;
-allow asterisk_t self:udp_socket create_socket_perms;
+allow asterisk_t self:unix_stream_socket { accept connectto listen };
+allow asterisk_t self:tcp_socket { accept listen };
 
 allow asterisk_t asterisk_etc_t:dir list_dir_perms;
 read_files_pattern(asterisk_t, asterisk_etc_t, asterisk_etc_t)
 read_lnk_files_pattern(asterisk_t, asterisk_etc_t, asterisk_etc_t)
-files_search_etc(asterisk_t)
-
-can_exec(asterisk_t, asterisk_exec_t)
 
-manage_files_pattern(asterisk_t, asterisk_log_t, asterisk_log_t)
-logging_log_filetrans(asterisk_t, asterisk_log_t, { file dir })
+append_files_pattern(asterisk_t, asterisk_log_t, asterisk_log_t)
+create_files_pattern(asterisk_t, asterisk_log_t, asterisk_log_t)
+setattr_files_pattern(asterisk_t, asterisk_log_t, asterisk_log_t)
 
 manage_dirs_pattern(asterisk_t, asterisk_spool_t, asterisk_spool_t)
 manage_files_pattern(asterisk_t, asterisk_spool_t, asterisk_spool_t)
@@ -75,15 +71,17 @@
 fs_tmpfs_filetrans(asterisk_t, asterisk_tmpfs_t, { dir file lnk_file sock_file fifo_file })
 
 manage_files_pattern(asterisk_t, asterisk_var_lib_t, asterisk_var_lib_t)
-files_var_lib_filetrans(asterisk_t, asterisk_var_lib_t, file)
 
 manage_files_pattern(asterisk_t, asterisk_var_run_t, asterisk_var_run_t)
 manage_fifo_files_pattern(asterisk_t, asterisk_var_run_t, asterisk_var_run_t)
 manage_sock_files_pattern(asterisk_t, asterisk_var_run_t, asterisk_var_run_t)
 files_pid_filetrans(asterisk_t, asterisk_var_run_t, file)
 
-kernel_read_system_state(asterisk_t)
+can_exec(asterisk_t, asterisk_exec_t)
+
 kernel_read_kernel_sysctls(asterisk_t)
+kernel_read_network_state(asterisk_t)
+kernel_read_system_state(asterisk_t)
 kernel_request_load_module(asterisk_t)
 
 corecmd_exec_bin(asterisk_t)
@@ -99,18 +97,33 @@
 corenet_udp_sendrecv_all_ports(asterisk_t)
 corenet_tcp_bind_generic_node(asterisk_t)
 corenet_udp_bind_generic_node(asterisk_t)
+
+corenet_sendrecv_asterisk_server_packets(asterisk_t)
 corenet_tcp_bind_asterisk_port(asterisk_t)
-corenet_tcp_bind_sip_port(asterisk_t)
 corenet_udp_bind_asterisk_port(asterisk_t)
+
+corenet_sendrecv_embrace_dp_c_client_packets(asterisk_t)
+corenet_tcp_connect_embrace_dp_c_port(asterisk_t)
+
+corenet_sendrecv_sip_server_packets(asterisk_t)
+corenet_tcp_bind_sip_port(asterisk_t)
 corenet_udp_bind_sip_port(asterisk_t)
-corenet_sendrecv_asterisk_server_packets(asterisk_t)
-# for VOIP voice channels.
+
+corenet_sendrecv_generic_server_packets(asterisk_t)
 corenet_tcp_bind_generic_port(asterisk_t)
 corenet_udp_bind_generic_port(asterisk_t)
 corenet_dontaudit_udp_bind_all_ports(asterisk_t)
-corenet_sendrecv_generic_server_packets(asterisk_t)
-corenet_tcp_connect_postgresql_port(asterisk_t)
-corenet_tcp_connect_snmp_port(asterisk_t)
+
+corenet_sendrecv_jabber_client_client_packets(asterisk_t)
+corenet_tcp_connect_jabber_client_port(asterisk_t)
+
+corenet_sendrecv_pdps_client_packets(asterisk_t)
+corenet_tcp_connect_pdps_port(asterisk_t)
+
+corenet_sendrecv_pktcable_cops_client_packets(asterisk_t)
+corenet_tcp_connect_pktcable_cops_port(asterisk_t)
+
+corenet_sendrecv_sip_client_packets(asterisk_t)
 corenet_tcp_connect_sip_port(asterisk_t)
 
 dev_rw_generic_usb_dev(asterisk_t)
@@ -122,11 +135,9 @@
 
 domain_use_interactive_fds(asterisk_t)
 
-files_read_etc_files(asterisk_t)
-files_search_spool(asterisk_t)
-# demo files installed in /usr/share/asterisk/sounds/demo-instruct.gsm
-# are labeled usr_t
 files_read_usr_files(asterisk_t)
+files_search_spool(asterisk_t)
+files_dontaudit_search_home(asterisk_t)
 
 fs_getattr_all_fs(asterisk_t)
 fs_list_inotifyfs(asterisk_t)
@@ -143,7 +154,12 @@
 userdom_dontaudit_search_user_home_dirs(asterisk_t)
 
 optional_policy(`
+	alsa_read_rw_config(asterisk_t)
+')
+
+optional_policy(`
 	mysql_stream_connect(asterisk_t)
+	mysql_tcp_connect(asterisk_t)
 ')
 
 optional_policy(`
@@ -156,6 +172,7 @@
 
 optional_policy(`
 	postgresql_stream_connect(asterisk_t)
+	postgresql_tcp_connect(asterisk_t)
 ')
 
 optional_policy(`
@@ -165,6 +182,7 @@
 optional_policy(`
 	snmp_read_snmp_var_lib_files(asterisk_t)
 	snmp_stream_connect(asterisk_t)
+	snmp_tcp_connect(asterisk_t)
 ')
 
 optional_policy(`
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/authbind.fc refpolicy/policy/modules/contrib/authbind.fc
--- refpolicy/policy/modules/contrib/authbind.fc	2012-05-04 16:10:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/authbind.fc	2012-09-27 20:03:30.729126498 +0200
@@ -1,3 +1,3 @@
-/etc/authbind(/.*)?			gen_context(system_u:object_r:authbind_etc_t,s0)
+/etc/authbind(/.*)?	gen_context(system_u:object_r:authbind_etc_t,s0)
 
 /usr/lib/authbind/helper	--	gen_context(system_u:object_r:authbind_exec_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/authbind.if refpolicy/policy/modules/contrib/authbind.if
--- refpolicy/policy/modules/contrib/authbind.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/authbind.if	2012-09-27 20:03:30.729126498 +0200
@@ -1,8 +1,8 @@
-## <summary>Tool for non-root processes to bind to reserved ports</summary>
+## <summary>Tool for non-root processes to bind to reserved ports.</summary>
 
 ########################################
 ## <summary>
-##	Use authbind to bind to a reserved port.
+##	Execute authbind in the authbind domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -15,6 +15,32 @@
 		type authbind_t, authbind_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, authbind_exec_t, authbind_t)
-	allow authbind_t $1:{ tcp_socket udp_socket } rw_socket_perms;
+')
+
+########################################
+## <summary>
+##	Execute authbind in the authbind
+##	domain, and allow the specified
+##	role the authbind domain.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed to transition.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+#
+interface(`authbind_run',`
+	gen_require(`
+		attribute_role authbind_roles;
+	')
+
+	authbind_domtrans($1)
+	roleattribute $2 authbind_roles;
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/authbind.te refpolicy/policy/modules/contrib/authbind.te
--- refpolicy/policy/modules/contrib/authbind.te	2012-07-25 20:33:04.000000000 +0200
+++ refpolicy/policy/modules/contrib/authbind.te	2012-09-27 20:03:30.729126498 +0200
@@ -1,14 +1,17 @@
-policy_module(authbind, 1.2.0)
+policy_module(authbind, 1.2.1)
 
 ########################################
 #
 # Declarations
 #
 
+attribute_role authbind_roles;
+roleattribute system_r authbind_roles;
+
 type authbind_t;
 type authbind_exec_t;
 application_domain(authbind_t, authbind_exec_t)
-role system_r types authbind_t;
+role authbind_roles types authbind_t;
 
 type authbind_etc_t;
 files_config_file(authbind_etc_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/automount.fc refpolicy/policy/modules/contrib/automount.fc
--- refpolicy/policy/modules/contrib/automount.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/automount.fc	2012-09-27 20:03:30.729126498 +0200
@@ -1,16 +1,8 @@
-#
-# /etc
-#
-/etc/apm/event\.d/autofs --	gen_context(system_u:object_r:automount_exec_t,s0)
+/etc/apm/event\.d/autofs	--	gen_context(system_u:object_r:automount_exec_t,s0)
 /etc/rc\.d/init\.d/autofs	--	gen_context(system_u:object_r:automount_initrc_exec_t,s0)
 
-#
-# /usr
-#
 /usr/sbin/automount	--	gen_context(system_u:object_r:automount_exec_t,s0)
 
-#
-# /var
-#
+/var/lock/subsys/autofs	--	gen_context(system_u:object_r:automount_lock_t,s0)
 
-/var/run/autofs.*		gen_context(system_u:object_r:automount_var_run_t,s0)
+/var/run/autofs.*	gen_context(system_u:object_r:automount_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/automount.if refpolicy/policy/modules/contrib/automount.if
--- refpolicy/policy/modules/contrib/automount.if	2012-05-04 15:16:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/automount.if	2012-09-27 20:03:30.730126498 +0200
@@ -21,7 +21,7 @@
 
 ########################################
 ## <summary>
-##	Send automount a signal
+##	Send generic signals to automount.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -55,7 +55,7 @@
 
 ########################################
 ## <summary>
-##	Allow the domain to read state files in /proc.
+##	Read automount process state.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -68,12 +68,16 @@
 		type automount_t;
 	')
 
+	kernel_search_proc($1)
+	allow $1 automount_t:dir list_dir_perms;
 	read_files_pattern($1, automount_t, automount_t)
+	read_lnk_files_pattern($1, automount_t, automount_t)
 ')
 
 ########################################
 ## <summary>
-##	Do not audit attempts to file descriptors for automount.
+##	Do not audit attempts to use
+##	automount file descriptors.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -91,7 +95,8 @@
 
 ########################################
 ## <summary>
-##	Do not audit attempts to write automount daemon unnamed pipes.
+##	Do not audit attempts to write
+##	automount unnamed pipes.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -109,8 +114,9 @@
 
 ########################################
 ## <summary>
-##	Do not audit attempts to get the attributes
-##	of automount temporary directories.
+##	Do not audit attempts to get
+##	attributes of automount temporary
+##	directories.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -123,13 +129,13 @@
 		type automount_tmp_t;
 	')
 
-	dontaudit $1 automount_tmp_t:dir getattr;
+	dontaudit $1 automount_tmp_t:dir getattr_dir_perms;
 ')
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate 
-##	an automount environment
+##	All of the rules required to
+##	administrate an automount environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -138,7 +144,7 @@
 ## </param>
 ## <param name="role">
 ##	<summary>
-##	The role to be allowed to manage the automount domain.
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <rolecap/>
@@ -149,7 +155,7 @@
 		type automount_var_run_t, automount_initrc_exec_t;
 	')
 
-	allow $1 automount_t:process { ptrace signal_perms getattr };
+	allow $1 automount_t:process { ptrace signal_perms };
 	ps_process_pattern($1, automount_t)
 
 	init_labeled_script_domtrans($1, automount_initrc_exec_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/automount.te refpolicy/policy/modules/contrib/automount.te
--- refpolicy/policy/modules/contrib/automount.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/automount.te	2012-10-24 17:01:40.358003140 +0200
@@ -1,4 +1,4 @@
-policy_module(automount, 1.13.0)
+policy_module(automount, 1.13.2)
 
 ########################################
 #
@@ -31,10 +31,7 @@
 dontaudit automount_t self:capability sys_tty_config;
 allow automount_t self:process { signal_perms getpgid setpgid setsched setrlimit };
 allow automount_t self:fifo_file rw_fifo_file_perms;
-allow automount_t self:unix_stream_socket create_socket_perms;
-allow automount_t self:unix_dgram_socket create_socket_perms;
-allow automount_t self:tcp_socket create_stream_socket_perms;
-allow automount_t self:udp_socket create_socket_perms;
+allow automount_t self:tcp_socket { accept listen };
 allow automount_t self:rawip_socket create_socket_perms;
 
 can_exec(automount_t, automount_exec_t)
@@ -45,9 +42,6 @@
 manage_dirs_pattern(automount_t, automount_tmp_t, automount_tmp_t)
 manage_files_pattern(automount_t, automount_tmp_t, automount_tmp_t)
 files_tmp_filetrans(automount_t, automount_tmp_t, { file dir })
-
-# Allow automount to create and delete directories in / and /home
-allow automount_t automount_tmp_t:dir manage_dir_perms;
 files_home_filetrans(automount_t, automount_tmp_t, dir)
 files_root_filetrans(automount_t, automount_tmp_t, dir)
 
@@ -58,24 +52,13 @@
 kernel_read_kernel_sysctls(automount_t)
 kernel_read_irq_sysctls(automount_t)
 kernel_read_fs_sysctls(automount_t)
+kernel_read_vm_sysctls(automount_t)
 kernel_read_proc_symlinks(automount_t)
 kernel_read_system_state(automount_t)
 kernel_read_network_state(automount_t)
 kernel_list_proc(automount_t)
 kernel_dontaudit_search_xen_state(automount_t)
 
-files_search_boot(automount_t)
-# Automount is slowly adding all mount functionality internally
-files_search_all(automount_t)
-files_mounton_all_mountpoints(automount_t)
-files_mount_all_file_type_fs(automount_t)
-files_unmount_all_file_type_fs(automount_t)
-files_manage_non_security_dirs(automount_t)
-
-fs_mount_all_fs(automount_t)
-fs_unmount_all_fs(automount_t)
-fs_search_all(automount_t)
-
 corecmd_exec_bin(automount_t)
 corecmd_exec_shell(automount_t)
 
@@ -89,10 +72,11 @@
 corenet_udp_sendrecv_all_ports(automount_t)
 corenet_tcp_bind_generic_node(automount_t)
 corenet_udp_bind_generic_node(automount_t)
+
+corenet_sendrecv_all_client_packets(automount_t)
+corenet_sendrecv_all_server_packets(automount_t)
 corenet_tcp_connect_portmap_port(automount_t)
 corenet_tcp_connect_all_ports(automount_t)
-corenet_dontaudit_tcp_connect_all_reserved_ports(automount_t)
-corenet_sendrecv_all_client_packets(automount_t)
 # Automount execs showmount when you browse /net.  This is required until
 # Someone writes a showmount policy
 corenet_tcp_bind_reserved_port(automount_t)
@@ -100,36 +84,42 @@
 corenet_udp_bind_reserved_port(automount_t)
 corenet_udp_bind_all_rpc_ports(automount_t)
 
-dev_read_sysfs(automount_t)
-dev_rw_autofs(automount_t)
-# for SSP
-dev_read_rand(automount_t)
-dev_read_urand(automount_t)
-
-domain_use_interactive_fds(automount_t)
-domain_dontaudit_read_all_domains_state(automount_t)
-
 files_dontaudit_write_var_dirs(automount_t)
 files_getattr_all_dirs(automount_t)
-files_list_mnt(automount_t)
+files_getattr_default_dirs(automount_t)
 files_getattr_home_dir(automount_t)
-files_read_etc_files(automount_t)
-files_read_etc_runtime_files(automount_t)
-# for if the mount point is not labelled
 files_getattr_isid_type_dirs(automount_t)
-files_getattr_default_dirs(automount_t)
-# because config files can be shell scripts
 files_exec_etc_files(automount_t)
+files_list_mnt(automount_t)
+files_manage_non_security_dirs(automount_t)
+files_mount_all_file_type_fs(automount_t)
+files_mounton_all_mountpoints(automount_t)
 files_mounton_mnt(automount_t)
+files_read_etc_runtime_files(automount_t)
+files_read_usr_files(automount_t)
+files_search_boot(automount_t)
+files_search_all(automount_t)
+files_unmount_all_file_type_fs(automount_t)
 
-fs_getattr_all_fs(automount_t)
 fs_getattr_all_dirs(automount_t)
-fs_search_auto_mountpoints(automount_t)
+fs_getattr_all_fs(automount_t)
 fs_manage_auto_mountpoints(automount_t)
-fs_unmount_autofs(automount_t)
-fs_mount_autofs(automount_t)
 fs_manage_autofs_symlinks(automount_t)
+fs_mount_all_fs(automount_t)
+fs_mount_autofs(automount_t)
 fs_read_nfs_files(automount_t)
+fs_search_all(automount_t)
+fs_search_auto_mountpoints(automount_t)
+fs_unmount_all_fs(automount_t)
+fs_unmount_autofs(automount_t)
+
+dev_read_rand(automount_t)
+dev_read_sysfs(automount_t)
+dev_read_urand(automount_t)
+dev_rw_autofs(automount_t)
+
+domain_use_interactive_fds(automount_t)
+domain_dontaudit_read_all_domains_state(automount_t)
 
 storage_rw_fuse(automount_t)
 
@@ -143,16 +133,10 @@
 miscfiles_read_localization(automount_t)
 miscfiles_read_generic_certs(automount_t)
 
-# Run mount in the mount_t domain.
 mount_domtrans(automount_t)
 mount_signal(automount_t)
 
 userdom_dontaudit_use_unpriv_user_fds(automount_t)
-userdom_dontaudit_search_user_home_dirs(automount_t)
-
-optional_policy(`
-	bind_search_cache(automount_t)
-')
 
 optional_policy(`
 	fstools_domtrans(automount_t)
@@ -165,10 +149,6 @@
 ')
 
 optional_policy(`
-	rpc_search_nfs_state_data(automount_t)
-')
-
-optional_policy(`
 	samba_read_config(automount_t)
 	samba_manage_var_files(automount_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/avahi.fc refpolicy/policy/modules/contrib/avahi.fc
--- refpolicy/policy/modules/contrib/avahi.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/avahi.fc	2012-09-27 20:03:30.730126498 +0200
@@ -1,9 +1,9 @@
 /etc/rc\.d/init\.d/avahi.*	--	gen_context(system_u:object_r:avahi_initrc_exec_t,s0)
 
-/usr/sbin/avahi-daemon		--	gen_context(system_u:object_r:avahi_exec_t,s0)
-/usr/sbin/avahi-dnsconfd 	--	gen_context(system_u:object_r:avahi_exec_t,s0)
-/usr/sbin/avahi-autoipd 	--	gen_context(system_u:object_r:avahi_exec_t,s0)
+/usr/sbin/avahi-daemon	--	gen_context(system_u:object_r:avahi_exec_t,s0)
+/usr/sbin/avahi-dnsconfd	--	gen_context(system_u:object_r:avahi_exec_t,s0)
+/usr/sbin/avahi-autoipd	--	gen_context(system_u:object_r:avahi_exec_t,s0)
 
-/var/run/avahi-daemon(/.*)? 		gen_context(system_u:object_r:avahi_var_run_t,s0)
+/var/run/avahi-daemon(/.*)?	gen_context(system_u:object_r:avahi_var_run_t,s0)
 
-/var/lib/avahi-autoipd(/.*)?		gen_context(system_u:object_r:avahi_var_lib_t,s0)
+/var/lib/avahi-autoipd(/.*)?	gen_context(system_u:object_r:avahi_var_lib_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/avahi.if refpolicy/policy/modules/contrib/avahi.if
--- refpolicy/policy/modules/contrib/avahi.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/avahi.if	2012-09-27 20:03:30.730126498 +0200
@@ -1,4 +1,4 @@
-## <summary>mDNS/DNS-SD daemon implementing Apple ZeroConf architecture</summary>
+## <summary>mDNS/DNS-SD daemon implementing Apple ZeroConf architecture.</summary>
 
 ########################################
 ## <summary>
@@ -21,7 +21,7 @@
 
 ########################################
 ## <summary>
-##	Send avahi a signal
+##	Send generic signals to avahi.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -39,7 +39,7 @@
 
 ########################################
 ## <summary>
-##	Send avahi a kill signal.
+##	Send kill signals to avahi.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -57,7 +57,7 @@
 
 ########################################
 ## <summary>
-##	Send avahi a signull
+##	Send null signals to avahi.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -96,7 +96,8 @@
 
 ########################################
 ## <summary>
-##	Connect to avahi using a unix domain stream socket.
+##	Connect to avahi using a unix
+$$	stream socket.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -115,7 +116,8 @@
 
 ########################################
 ## <summary>
-##	Do not audit attempts to search the avahi pid directory.
+##	Do not audit attempts to search
+##	avahi pid directories.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -133,8 +135,8 @@
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate
-##	an avahi environment
+##	All of the rules required to
+##	administrate an avahi environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -143,7 +145,7 @@
 ## </param>
 ## <param name="role">
 ##	<summary>
-##	The role to be allowed to manage the avahi domain.
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <rolecap/>
@@ -151,6 +153,7 @@
 interface(`avahi_admin',`
 	gen_require(`
 		type avahi_t, avahi_var_run_t, avahi_initrc_exec_t;
+		type avahi_var_lib_t;
 	')
 
 	allow $1 avahi_t:process { ptrace signal_perms };
@@ -161,6 +164,9 @@
 	role_transition $2 avahi_initrc_exec_t system_r;
 	allow $2 system_r;
 
-	files_list_pids($1)
+	files_search_pids($1)
 	admin_pattern($1, avahi_var_run_t)
+
+	files_search_var_lib($1)
+	admin_pattern($1, avahi_var_lib_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/avahi.te refpolicy/policy/modules/contrib/avahi.te
--- refpolicy/policy/modules/contrib/avahi.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/avahi.te	2012-10-06 19:00:45.272741201 +0200
@@ -1,4 +1,4 @@
-policy_module(avahi, 1.13.0)
+policy_module(avahi, 1.13.2)
 
 ########################################
 #
@@ -27,10 +27,8 @@
 dontaudit avahi_t self:capability sys_tty_config;
 allow avahi_t self:process { setrlimit signal_perms getcap setcap };
 allow avahi_t self:fifo_file rw_fifo_file_perms;
-allow avahi_t self:unix_stream_socket { connectto create_stream_socket_perms };
-allow avahi_t self:unix_dgram_socket create_socket_perms;
-allow avahi_t self:tcp_socket create_stream_socket_perms;
-allow avahi_t self:udp_socket create_socket_perms;
+allow avahi_t self:unix_stream_socket { accept connectto listen };
+allow avahi_t self:tcp_socket { accept listen };
 allow avahi_t self:packet_socket create_socket_perms;
 
 manage_dirs_pattern(avahi_t, avahi_var_lib_t, avahi_var_lib_t)
@@ -43,9 +41,10 @@
 allow avahi_t avahi_var_run_t:dir setattr_dir_perms;
 files_pid_filetrans(avahi_t, avahi_var_run_t, { dir file })
 
-kernel_read_system_state(avahi_t)
 kernel_read_kernel_sysctls(avahi_t)
 kernel_read_network_state(avahi_t)
+kernel_read_system_state(avahi_t)
+kernel_request_load_module(avahi_t)
 
 corecmd_exec_bin(avahi_t)
 corecmd_exec_shell(avahi_t)
@@ -60,10 +59,10 @@
 corenet_udp_sendrecv_all_ports(avahi_t)
 corenet_tcp_bind_generic_node(avahi_t)
 corenet_udp_bind_generic_node(avahi_t)
+
+corenet_sendrecv_howl_server_packets(avahi_t)
 corenet_tcp_bind_howl_port(avahi_t)
 corenet_udp_bind_howl_port(avahi_t)
-corenet_send_howl_client_packets(avahi_t)
-corenet_receive_howl_server_packets(avahi_t)
 
 dev_read_sysfs(avahi_t)
 dev_read_urand(avahi_t)
@@ -74,7 +73,6 @@
 
 domain_use_interactive_fds(avahi_t)
 
-files_read_etc_files(avahi_t)
 files_read_etc_runtime_files(avahi_t)
 files_read_usr_files(avahi_t)
 
@@ -97,10 +95,14 @@
 
 optional_policy(`
 	dbus_system_domain(avahi_t, avahi_exec_t)
-	dbus_system_bus_client(avahi_t)
-	dbus_connect_system_bus(avahi_t)
 
-	init_dbus_chat_script(avahi_t)
+	optional_policy(`
+		init_dbus_chat_script(avahi_t)
+	')
+')
+
+optional_policy(`
+	rpcbind_signull(avahi_t)
 ')
 
 optional_policy(`
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/awstats.fc refpolicy/policy/modules/contrib/awstats.fc
--- refpolicy/policy/modules/contrib/awstats.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/awstats.fc	2012-09-27 20:03:30.730126498 +0200
@@ -1,5 +1,5 @@
-/usr/share/awstats/tools/.+\.pl		--	gen_context(system_u:object_r:awstats_exec_t,s0)
-/usr/share/awstats/wwwroot(/.*)?		gen_context(system_u:object_r:httpd_awstats_content_t,s0)
+/usr/share/awstats/tools/.+\.pl	--	gen_context(system_u:object_r:awstats_exec_t,s0)
+/usr/share/awstats/wwwroot(/.*)?	gen_context(system_u:object_r:httpd_awstats_content_t,s0)
 /usr/share/awstats/wwwroot/cgi-bin(/.*)?	gen_context(system_u:object_r:httpd_awstats_script_exec_t,s0)
 
-/var/lib/awstats(/.*)?				gen_context(system_u:object_r:awstats_var_lib_t,s0)
+/var/lib/awstats(/.*)?	gen_context(system_u:object_r:awstats_var_lib_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/awstats.if refpolicy/policy/modules/contrib/awstats.if
--- refpolicy/policy/modules/contrib/awstats.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/awstats.if	2012-10-10 21:47:43.772027923 +0200
@@ -1,11 +1,28 @@
+## <summary>Log file analyzer for advanced statistics.</summary>
+
+########################################
 ## <summary>
-##	AWStats is a free powerful and featureful tool that generates advanced
-##	web, streaming, ftp or mail server statistics, graphically.
+##	Execute the awstats program in
+##	the awstats domain.
 ## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed to transition.
+##	</summary>
+## </param>
+#
+interface(`awstats_domtrans',`
+	gen_require(`
+		type awstats_t, awstats_exec_t;
+	')
+
+	corecmd_search_bin($1)
+	domtrans_pattern($1, awstats_exec_t, awstats_t)
+')
 
 ########################################
 ## <summary>
-##	Read and write awstats unnamed pipes.
+##	Read and write awstats unnamed pipes. (Deprecated)
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -14,16 +31,12 @@
 ## </param>
 #
 interface(`awstats_rw_pipes',`
-	gen_require(`
-		type awstats_t;
-	')
-
-	allow $1 awstats_t:fifo_file rw_fifo_file_perms;
+	refpolicywarn(`$0($*) has been deprecated.')
 ')
 
 ########################################
 ## <summary>
-##	Execute awstats cgi scripts in the caller domain.
+##	Execute awstats cgi scripts in the caller domain. (Deprecated)
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -32,11 +45,5 @@
 ## </param>
 #
 interface(`awstats_cgi_exec',`
-	gen_require(`
-		type httpd_awstats_script_exec_t, httpd_awstats_content_t;
-	')
-
-	allow $1 httpd_awstats_content_t:dir search_dir_perms;
-	allow $1 httpd_awstats_script_exec_t:dir search_dir_perms;
-	can_exec($1, httpd_awstats_script_exec_t)
+	refpolicywarn(`$0($*) has been deprecated.')
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/awstats.te refpolicy/policy/modules/contrib/awstats.te
--- refpolicy/policy/modules/contrib/awstats.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/awstats.te	2012-10-24 22:20:03.916043917 +0200
@@ -1,4 +1,4 @@
-policy_module(awstats, 1.4.0)
+policy_module(awstats, 1.4.3)
 
 ########################################
 #
@@ -21,22 +21,21 @@
 
 ########################################
 #
-# awstats policy
+# Local policy
 #
 
-awstats_rw_pipes(awstats_t)
-awstats_cgi_exec(awstats_t)
-
-can_exec(awstats_t, awstats_exec_t)
+allow awstats_t self:fifo_file rw_fifo_file_perms;
 
 manage_dirs_pattern(awstats_t, awstats_tmp_t, awstats_tmp_t)
 manage_files_pattern(awstats_t, awstats_tmp_t, awstats_tmp_t)
 files_tmp_filetrans(awstats_t, awstats_tmp_t, { dir file })
 
 manage_files_pattern(awstats_t, awstats_var_lib_t, awstats_var_lib_t)
-files_var_lib_filetrans(awstats_t, awstats_var_lib_t, file)
 
-# dontaudit access to /proc/meminfo
+allow awstats_t { httpd_awstats_content_t  httpd_awstats_script_exec_t }:dir search_dir_perms;
+
+can_exec(awstats_t, { awstats_exec_t httpd_awstats_script_exec_t })
+
 kernel_dontaudit_read_system_state(awstats_t)
 
 corecmd_exec_bin(awstats_t)
@@ -44,10 +43,9 @@
 
 dev_read_urand(awstats_t)
 
+files_dontaudit_search_all_mountpoints(awstats_t)
 files_read_etc_files(awstats_t)
-# e.g. /usr/share/awstats/lang/awstats-en.txt
 files_read_usr_files(awstats_t)
-files_dontaudit_search_all_mountpoints(awstats_t)
 
 fs_list_inotifyfs(awstats_t)
 
@@ -66,7 +64,6 @@
 ')
 
 optional_policy(`
-	# dontaudit searching nscd pid directory
 	nscd_dontaudit_search_pid(awstats_t)
 ')
 
@@ -76,10 +73,12 @@
 
 ########################################
 #
-# awstats cgi script policy
+# CGI local policy
 #
 
 allow httpd_awstats_script_t awstats_var_lib_t:dir list_dir_perms;
 
 read_files_pattern(httpd_awstats_script_t, awstats_var_lib_t, awstats_var_lib_t)
 files_search_var_lib(httpd_awstats_script_t)
+
+apache_read_log(httpd_awstats_script_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/backup.fc refpolicy/policy/modules/contrib/backup.fc
--- refpolicy/policy/modules/contrib/backup.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/backup.fc	2012-09-27 20:03:30.731126498 +0200
@@ -1,13 +1,4 @@
-# backup
-# label programs that do backups to other files on disk (IE a cron job that
-# calls tar) in backup_exec_t and label the directory for storing them as
-# backup_store_t, Debian uses /var/backups
+/etc/cron\.daily/aptitude	--	gen_context(system_u:object_r:backup_exec_t,s0)
+/etc/cron\.daily/standard	--	gen_context(system_u:object_r:backup_exec_t,s0)
 
-#/usr/local/bin/backup-script	--	gen_context(system_u:object_r:backup_exec_t,s0)
-
-ifdef(`distro_debian',`
-/etc/cron.daily/aptitude	--	gen_context(system_u:object_r:backup_exec_t,s0)
-/etc/cron.daily/standard	--	gen_context(system_u:object_r:backup_exec_t,s0)
-')
-
-/var/backups(/.*)?			gen_context(system_u:object_r:backup_store_t,s0)
+/var/backups(/.*)?	gen_context(system_u:object_r:backup_store_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/backup.if refpolicy/policy/modules/contrib/backup.if
--- refpolicy/policy/modules/contrib/backup.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/backup.if	2012-09-27 20:03:30.731126498 +0200
@@ -1,4 +1,4 @@
-## <summary>System backup scripts</summary>
+## <summary>System backup scripts.</summary>
 
 ########################################
 ## <summary>
@@ -15,13 +15,15 @@
 		type backup_t, backup_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, backup_exec_t, backup_t)
 ')
 
 ########################################
 ## <summary>
-##	Execute backup in the backup domain, and
-##	allow the specified role the backup domain.
+##	Execute backup in the backup
+##	domain, and allow the specified
+##	role the backup domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -37,9 +39,9 @@
 #
 interface(`backup_run',`
 	gen_require(`
-		type backup_t;
+		attribute_role backup_roles;
 	')
 
 	backup_domtrans($1)
-	role $2 types backup_t;
+	roleattribute $2 backup_roles;
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/backup.te refpolicy/policy/modules/contrib/backup.te
--- refpolicy/policy/modules/contrib/backup.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/backup.te	2012-09-27 20:03:30.731126498 +0200
@@ -1,15 +1,17 @@
-policy_module(backup, 1.5.0)
+policy_module(backup, 1.5.2)
 
 ########################################
 #
 # Declarations
 #
 
+attribute_role backup_roles;
+roleattribute system_r backup_roles;
+
 type backup_t;
 type backup_exec_t;
-domain_type(backup_t)
-domain_entry_file(backup_t, backup_exec_t)
-role system_r types backup_t;
+application_domain(backup_t, backup_exec_t)
+role backup_roles types backup_t;
 
 type backup_store_t;
 files_type(backup_store_t)
@@ -25,7 +27,7 @@
 allow backup_t self:tcp_socket create_socket_perms;
 allow backup_t self:udp_socket create_socket_perms;
 
-allow backup_t backup_store_t:file setattr;
+allow backup_t backup_store_t:file setattr_file_perms;
 manage_files_pattern(backup_t, backup_store_t, backup_store_t)
 rw_files_pattern(backup_t, backup_store_t, backup_store_t)
 read_lnk_files_pattern(backup_t, backup_store_t, backup_store_t)
@@ -39,19 +41,14 @@
 corenet_all_recvfrom_unlabeled(backup_t)
 corenet_all_recvfrom_netlabel(backup_t)
 corenet_tcp_sendrecv_generic_if(backup_t)
-corenet_udp_sendrecv_generic_if(backup_t)
-corenet_raw_sendrecv_generic_if(backup_t)
 corenet_tcp_sendrecv_generic_node(backup_t)
-corenet_udp_sendrecv_generic_node(backup_t)
-corenet_raw_sendrecv_generic_node(backup_t)
 corenet_tcp_sendrecv_all_ports(backup_t)
-corenet_udp_sendrecv_all_ports(backup_t)
+
 corenet_tcp_connect_all_ports(backup_t)
 corenet_sendrecv_all_client_packets(backup_t)
 
 dev_getattr_all_blk_files(backup_t)
 dev_getattr_all_chr_files(backup_t)
-# for SSP
 dev_read_urand(backup_t)
 
 domain_use_interactive_fds(backup_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/bacula.fc refpolicy/policy/modules/contrib/bacula.fc
--- refpolicy/policy/modules/contrib/bacula.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/bacula.fc	2012-09-27 20:03:30.731126498 +0200
@@ -1,20 +1,17 @@
-#
-# /usr
-#
-/usr/sbin/bacula-(.*)?	--	gen_context(system_u:object_r:bacula_exec_t,s0)
-/usr/sbin/bat			gen_context(system_u:object_r:bacula_admin_exec_t,s0)
-/usr/sbin/bconsole		gen_context(system_u:object_r:bacula_admin_exec_t,s0)
-
-#
-# /etc
-#
-/etc/bacula(/.*)?		gen_context(system_u:object_r:bacula_etc_t,s0)
-
-#
-# /var
-#
-/var/lib/bacula(/.*)?		gen_context(system_u:object_r:bacula_var_lib_t,s0)
-
-# A separate disk for backups mounted at /bacula or beginning with
-# /bacula also matches a restore directory like /bacula-restores
-/bacula(.*)?			gen_context(system_u:object_r:bacula_store_t,s0)
+/bacula(/.*)?	gen_context(system_u:object_r:bacula_store_t,s0)
+
+/etc/bacula.*	gen_context(system_u:object_r:bacula_etc_t,s0)
+
+/etc/rc\.d/init\.d/bacula.*	--	gen_context(system_u:object_r:bacula_initrc_exec_t,s0)
+
+/usr/sbin/bacula.*	--	gen_context(system_u:object_r:bacula_exec_t,s0)
+/usr/sbin/bat	--	gen_context(system_u:object_r:bacula_admin_exec_t,s0)
+/usr/sbin/bconsole	--	gen_context(system_u:object_r:bacula_admin_exec_t,s0)
+
+/var/lib/bacula.*	gen_context(system_u:object_r:bacula_var_lib_t,s0)
+
+/var/log/bacula.*	gen_context(system_u:object_r:bacula_log_t,s0)
+
+/var/run/bacula.*	--	gen_context(system_u:object_r:bacula_var_run_t,s0)
+
+/var/spool/bacula.*	gen_context(system_u:object_r:bacula_spool_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/bacula.if refpolicy/policy/modules/contrib/bacula.if
--- refpolicy/policy/modules/contrib/bacula.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/bacula.if	2012-09-27 20:03:30.731126498 +0200
@@ -1,8 +1,9 @@
-## <summary>bacula backup program</summary>
+## <summary>Cross platform network backup.</summary>
 
 ########################################
 ## <summary>
-##	Execute user interfaces in the bacula_admin domain.
+##	Execute bacula admin bacula
+##	admin domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -15,13 +16,15 @@
 		type bacula_admin_t, bacula_admin_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, bacula_admin_exec_t, bacula_admin_t)
 ')
 
 ########################################
 ## <summary>
-##	Execute user interfaces in the bacula_admin domain, and
-##	allow the specified role to transition to the bacula_admin domain.
+##	Execute user interfaces in the
+##	bacula admin domain, and allow the
+##	specified role the bacula admin domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -37,9 +40,59 @@
 #
 interface(`bacula_run_admin',`
 	gen_require(`
-		type bacula_admin_t;
+		attribute_role bacula_admin_roles;
 	')
 
 	bacula_domtrans_admin($1)
-	role $2 types bacula_admin_t;
+	roleattribute $2 bacula_admin_roles;
+')
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an bacula environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`bacula_admin',`
+	gen_require(`
+		type bacula_t, bacula_etc_t, bacula_log_t;
+		type bacula_spool_t, bacula_var_lib_t;
+		type bacula_var_run_t, bacula_initrc_exec_t;
+	')
+
+	allow $1 bacula_t:process { ptrace signal_perms };
+	ps_process_pattern($1, bacula_t)
+
+	init_labeled_script_domtrans($1, bacula_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 bacula_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	files_search_etc($1)
+	admin_pattern($1, bacula_etc_t)
+
+	logging_search_logs($1)
+	admin_pattern($1, bacula_log_t)
+
+	files_search_var($1)
+	admin_pattern($1, bacula_spool_t)
+
+	files_search_var_lib($1)
+	admin_pattern($1, bacula_var_lib_t)
+
+	files_search_pids($1)
+	admin_pattern($1, bacula_var_run_t)
+
+	bacula_run_admin($1, $2)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/bacula.te refpolicy/policy/modules/contrib/bacula.te
--- refpolicy/policy/modules/contrib/bacula.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/bacula.te	2012-10-06 19:01:04.208741242 +0200
@@ -1,17 +1,28 @@
-policy_module(bacula, 1.0.0)
+policy_module(bacula, 1.1.1)
 
 ########################################
 #
 # Declarations
 #
 
+attribute_role bacula_admin_roles;
+
 type bacula_t;
 type bacula_exec_t;
 init_daemon_domain(bacula_t, bacula_exec_t)
 
+type bacula_initrc_exec_t;
+init_script_file(bacula_initrc_exec_t)
+
 type bacula_etc_t;
 files_type(bacula_etc_t)
 
+type bacula_log_t;
+logging_log_file(bacula_log_t)
+
+type bacula_spool_t;
+files_type(bacula_spool_t)
+
 type bacula_store_t;
 files_type(bacula_store_t)
 files_mountpoint(bacula_store_t)
@@ -25,29 +36,36 @@
 type bacula_admin_t;
 type bacula_admin_exec_t;
 application_domain(bacula_admin_t, bacula_admin_exec_t)
+role bacula_admin_roles types bacula_admin_t;
 
 ########################################
 #
-# Local policy - bacula daemon
+# Local policy
 #
 
 allow bacula_t self:capability { dac_read_search dac_override chown fowner fsetid};
 allow bacula_t self:process signal;
 allow bacula_t self:fifo_file rw_fifo_file_perms;
-allow bacula_t self:tcp_socket create_stream_socket_perms;
-allow bacula_t self:udp_socket create_socket_perms;
-allow bacula_t self:netlink_route_socket create_netlink_socket_perms;
+allow bacula_t self:tcp_socket { accept listen };
 
 read_files_pattern(bacula_t, bacula_etc_t, bacula_etc_t)
 
+append_files_pattern(bacula_t, bacula_log_t, bacula_log_t)
+create_files_pattern(bacula_t, bacula_log_t, bacula_log_t)
+setattr_files_pattern(bacula_t, bacula_log_t, bacula_log_t)
+
+manage_dirs_pattern(bacula_t, bacula_spool_t, bacula_spool_t)
+manage_files_pattern(bacula_t, bacula_spool_t, bacula_spool_t)
+
 manage_files_pattern(bacula_t, bacula_store_t, bacula_store_t)
 manage_lnk_files_pattern(bacula_t, bacula_store_t, bacula_store_t)
 manage_dirs_pattern(bacula_t, bacula_store_t, bacula_store_t)
 
+manage_dirs_pattern(bacula_t, bacula_var_lib_t, bacula_var_lib_t)
 manage_files_pattern(bacula_t, bacula_var_lib_t, bacula_var_lib_t)
-files_var_lib_filetrans(bacula_t, bacula_var_lib_t, file)
+files_var_lib_filetrans(bacula_t, bacula_var_lib_t, dir)
 
-allow bacula_t bacula_var_run_t:file { create_file_perms write_file_perms unlink};
+allow bacula_t bacula_var_run_t:file manage_file_perms;
 files_pid_filetrans(bacula_t, bacula_var_run_t, file)
 
 kernel_read_kernel_sysctls(bacula_t)
@@ -56,15 +74,26 @@
 corecmd_exec_bin(bacula_t)
 corecmd_exec_shell(bacula_t)
 
+corenet_all_recvfrom_unlabeled(bacula_t)
+corenet_all_recvfrom_netlabel(bacula_t)
+corenet_tcp_sendrecv_generic_if(bacula_t)
+corenet_udp_sendrecv_generic_if(bacula_t)
+corenet_tcp_sendrecv_generic_node(bacula_t)
+corenet_udp_sendrecv_generic_node(bacula_t)
+corenet_tcp_sendrecv_all_ports(bacula_t)
+corenet_udp_sendrecv_all_ports(bacula_t)
 corenet_tcp_bind_generic_node(bacula_t)
 corenet_udp_bind_generic_node(bacula_t)
-corenet_tcp_bind_generic_port(bacula_t)
+
+corenet_sendrecv_generic_server_packets(bacula_t)
 corenet_udp_bind_generic_port(bacula_t)
+
+corenet_sendrecv_hplip_server_packets(bacula_t)
 corenet_tcp_bind_hplip_port(bacula_t)
 corenet_udp_bind_hplip_port(bacula_t)
+
+corenet_sendrecv_all_client_packets(bacula_t)
 corenet_tcp_connect_all_ports(bacula_t)
-corenet_tcp_connect_smtp_port(bacula_t)
-# Bacula's default port are listed already under hplip
 
 dev_getattr_all_blk_files(bacula_t)
 dev_getattr_all_chr_files(bacula_t)
@@ -80,6 +109,8 @@
 
 logging_send_syslog_msg(bacula_t)
 
+sysnet_dns_name_resolve(bacula_t)
+
 optional_policy(`
 	mysql_stream_connect(bacula_t)
 	mysql_tcp_connect(bacula_t)
@@ -96,16 +127,24 @@
 
 ########################################
 #
-# Local policy - bacula admin client
+# Client local policy
 #
+
 allow bacula_admin_t self:process signal;
-allow bacula_admin_t self:tcp_socket create_stream_socket_perms;
+allow bacula_admin_t self:tcp_socket { accept listen };
 allow bacula_admin_t self:dgram_socket_class_set create_socket_perms;
 
 read_files_pattern(bacula_admin_t, bacula_etc_t, bacula_etc_t)
 
+corenet_all_recvfrom_unlabeled(bacula_admin_t)
+corenet_all_recvfrom_netlabel(bacula_admin_t)
+corenet_tcp_sendrecv_generic_if(bacula_admin_t)
+corenet_tcp_sendrecv_generic_node(bacula_admin_t)
+corenet_tcp_sendrecv_all_ports(bacula_admin_t)
+corenet_tcp_bind_generic_node(bacula_admin_t)
+
+corenet_sendrecv_hplip_client_packets(bacula_admin_t)
 corenet_tcp_connect_hplip_port(bacula_admin_t)
-corenet_udp_sendrecv_hplip_port(bacula_admin_t)
 
 domain_use_interactive_fds(bacula_admin_t)
 
@@ -117,4 +156,3 @@
 
 userdom_dontaudit_search_user_home_dirs(bacula_admin_t)
 userdom_use_user_ptys(bacula_admin_t)
-
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/bcfg2.fc refpolicy/policy/modules/contrib/bcfg2.fc
--- refpolicy/policy/modules/contrib/bcfg2.fc	2012-07-10 14:14:31.000000000 +0200
+++ refpolicy/policy/modules/contrib/bcfg2.fc	2012-09-27 20:03:30.732126498 +0200
@@ -1,7 +1,7 @@
-/etc/rc\.d/init\.d/bcfg2					--	gen_context(system_u:object_r:bcfg2_initrc_exec_t,s0)
+/etc/rc\.d/init\.d/bcfg2-server	--	gen_context(system_u:object_r:bcfg2_initrc_exec_t,s0)
 
-/usr/sbin/bcfg2-server						--	gen_context(system_u:object_r:bcfg2_exec_t,s0)
+/usr/sbin/bcfg2-server	--	gen_context(system_u:object_r:bcfg2_exec_t,s0)
 
-/var/lib/bcfg2(/.*)?							gen_context(system_u:object_r:bcfg2_var_lib_t,s0)
+/var/lib/bcfg2(/.*)?	gen_context(system_u:object_r:bcfg2_var_lib_t,s0)
 
-/var/run/bcfg2-server\.pid					--	gen_context(system_u:object_r:bcfg2_var_run_t,s0)
+/var/run/bcfg2-server\.pid	--	gen_context(system_u:object_r:bcfg2_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/bcfg2.if refpolicy/policy/modules/contrib/bcfg2.if
--- refpolicy/policy/modules/contrib/bcfg2.if	2012-07-10 14:14:31.000000000 +0200
+++ refpolicy/policy/modules/contrib/bcfg2.if	2012-09-27 20:03:30.732126498 +0200
@@ -1,8 +1,8 @@
-## <summary>bcfg2-server daemon which serves configurations to clients based on the data in its repository</summary>
+## <summary>configuration management suite.</summary>
 
 ########################################
 ## <summary>
-##	Execute bcfg2 in the bcfg2 domain..
+##	Execute bcfg2 in the bcfg2 domain.
 ## </summary>
 ## <param name="domain">
 ## <summary>
@@ -25,7 +25,7 @@
 ## </summary>
 ## <param name="domain">
 ##	<summary>
-##	Domain allowed access.
+##	Domain allowed to transition.
 ##	</summary>
 ## </param>
 #
@@ -77,7 +77,8 @@
 
 ########################################
 ## <summary>
-##	Manage bcfg2 lib files.
+##	Create, read, write, and delete
+##	bcfg2 lib files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -96,7 +97,8 @@
 
 ########################################
 ## <summary>
-##	Manage bcfg2 lib directories.
+##	Create, read, write, and delete
+##	bcfg2 lib directories.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -115,8 +117,8 @@
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate
-##	an bcfg2 environment
+##	All of the rules required to
+##	administrate an bcfg2 environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -132,9 +134,8 @@
 #
 interface(`bcfg2_admin',`
 	gen_require(`
-		type bcfg2_t;
-		type bcfg2_initrc_exec_t;
-		type bcfg2_var_lib_t;
+		type bcfg2_t, bcfg2_initrc_exec_t, bcfg2_var_lib_t;
+		type bcfg2_var_run_t;
 	')
 
 	allow $1 bcfg2_t:process { ptrace signal_perms };
@@ -145,6 +146,9 @@
 	role_transition $2 bcfg2_initrc_exec_t system_r;
 	allow $2 system_r;
 
+	files_search_pids($1)
+	admin_pattern($1, bcfg2_var_run_t)
+
 	files_search_var_lib($1)
 	admin_pattern($1, bcfg2_var_lib_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/bcfg2.te refpolicy/policy/modules/contrib/bcfg2.te
--- refpolicy/policy/modules/contrib/bcfg2.te	2012-07-10 14:14:31.000000000 +0200
+++ refpolicy/policy/modules/contrib/bcfg2.te	2012-09-27 20:03:30.732126498 +0200
@@ -1,4 +1,4 @@
-policy_module(bcfg2, 1.0.0)
+policy_module(bcfg2, 1.0.1)
 
 ########################################
 #
@@ -20,22 +20,32 @@
 
 ########################################
 #
-# bcfg2 local policy
+# Local policy
 #
 
 allow bcfg2_t self:fifo_file rw_fifo_file_perms;
-allow bcfg2_t self:tcp_socket create_stream_socket_perms;
-allow bcfg2_t self:unix_stream_socket { connectto create_stream_socket_perms };
+allow bcfg2_t self:tcp_socket { accept listen };
+allow bcfg2_t self:unix_stream_socket { accept connectto listen };
 
 manage_dirs_pattern(bcfg2_t, bcfg2_var_lib_t, bcfg2_var_lib_t)
 manage_files_pattern(bcfg2_t, bcfg2_var_lib_t, bcfg2_var_lib_t)
-files_var_lib_filetrans(bcfg2_t, bcfg2_var_lib_t, dir )
+files_var_lib_filetrans(bcfg2_t, bcfg2_var_lib_t, dir)
 
 manage_files_pattern(bcfg2_t, bcfg2_var_run_t, bcfg2_var_run_t)
-files_pid_filetrans(bcfg2_t, bcfg2_var_run_t, file )
+files_pid_filetrans(bcfg2_t, bcfg2_var_run_t, file)
 
 kernel_read_system_state(bcfg2_t)
 
+corenet_all_recvfrom_unlabeled(bcfg2_t)
+corenet_all_recvfrom_netlabel(bcfg2_t)
+corenet_tcp_sendrecv_generic_if(bcfg2_t)
+corenet_tcp_sendrecv_generic_node(bcfg2_t)
+corenet_tcp_bind_generic_node(bcfg2_t)
+
+corenet_sendrecv_cyphesis_server_packets(bcfg2_t)
+corenet_tcp_bind_cyphesis_port(bcfg2_t)
+corenet_tcp_sendrecv_cyphesis_port(bcfg2_t)
+
 corecmd_exec_bin(bcfg2_t)
 
 dev_read_urand(bcfg2_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/bind.fc refpolicy/policy/modules/contrib/bind.fc
--- refpolicy/policy/modules/contrib/bind.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/bind.fc	2012-09-27 20:03:30.732126498 +0200
@@ -1,63 +1,54 @@
-/etc/rc\.d/init\.d/named --	gen_context(system_u:object_r:named_initrc_exec_t,s0)
-/etc/rc\.d/init\.d/unbound --	gen_context(system_u:object_r:named_initrc_exec_t,s0)
+/etc/rc\.d/init\.d/named	--	gen_context(system_u:object_r:named_initrc_exec_t,s0)
+/etc/rc\.d/init\.d/unbound	--	gen_context(system_u:object_r:named_initrc_exec_t,s0)
 
-/etc/rndc.*		--	gen_context(system_u:object_r:named_conf_t,s0)
-/etc/rndc\.key 		-- 	gen_context(system_u:object_r:dnssec_t,s0)
-/etc/unbound(/.*)?		gen_context(system_u:object_r:named_conf_t,s0)
+/etc/bind(/.*)?	gen_context(system_u:object_r:named_zone_t,s0)
+/etc/bind/named\.conf.*	--	gen_context(system_u:object_r:named_conf_t,s0)
+/etc/bind/rndc\.key	--	gen_context(system_u:object_r:dnssec_t,s0)
+/etc/dnssec-trigger/dnssec_trigger_server\.key	--	gen_context(system_u:object_r:dnssec_t,s0)
+/etc/named\.rfc1912\.zones	--	gen_context(system_u:object_r:named_conf_t,s0)
+/etc/named\.root\.hints	--	gen_context(system_u:object_r:named_conf_t,s0)
+/etc/named\.conf	--	gen_context(system_u:object_r:named_conf_t,s0)
+/etc/named\.caching-nameserver\.conf	--	gen_context(system_u:object_r:named_conf_t,s0)
+/etc/rndc.*	--	gen_context(system_u:object_r:named_conf_t,s0)
+/etc/rndc\.key	--	gen_context(system_u:object_r:dnssec_t,s0)
+/etc/unbound(/.*)?	gen_context(system_u:object_r:named_conf_t,s0)
+/etc/unbound/.*\.key	--	gen_context(system_u:object_r:dnssec_t,s0)
 
 /usr/sbin/lwresd	--	gen_context(system_u:object_r:named_exec_t,s0)
-/usr/sbin/named		--	gen_context(system_u:object_r:named_exec_t,s0)
-/usr/sbin/named-checkconf --	gen_context(system_u:object_r:named_checkconf_exec_t,s0)
-/usr/sbin/r?ndc		--	gen_context(system_u:object_r:ndc_exec_t,s0)
+/usr/sbin/named	--	gen_context(system_u:object_r:named_exec_t,s0)
+/usr/sbin/named-checkconf	--	gen_context(system_u:object_r:named_checkconf_exec_t,s0)
+/usr/sbin/r?ndc	--	gen_context(system_u:object_r:ndc_exec_t,s0)
 /usr/sbin/unbound	--	gen_context(system_u:object_r:named_exec_t,s0)
 
-/var/log/named.*	--	gen_context(system_u:object_r:named_log_t,s0)
+/var/bind(/.*)?	gen_context(system_u:object_r:named_cache_t,s0)
+/var/bind/pri(/.*)?	gen_context(system_u:object_r:named_zone_t,s0)
 
-/var/run/ndc		-s	gen_context(system_u:object_r:named_var_run_t,s0)
-/var/run/bind(/.*)?		gen_context(system_u:object_r:named_var_run_t,s0)
-/var/run/named(/.*)?		gen_context(system_u:object_r:named_var_run_t,s0)
-/var/run/unbound(/.*)?		gen_context(system_u:object_r:named_var_run_t,s0)
-
-ifdef(`distro_debian',`
-/etc/bind(/.*)?			gen_context(system_u:object_r:named_zone_t,s0)
-/etc/bind/named\.conf	--	gen_context(system_u:object_r:named_conf_t,s0)
-/etc/bind/named\.conf\.local --	gen_context(system_u:object_r:named_conf_t,s0)
-/etc/bind/named\.conf\.options -- gen_context(system_u:object_r:named_conf_t,s0)
-/etc/bind/rndc\.key	--	gen_context(system_u:object_r:dnssec_t,s0)
-/var/cache/bind(/.*)?		gen_context(system_u:object_r:named_cache_t,s0)
-')
+/var/cache/bind(/.*)?	gen_context(system_u:object_r:named_cache_t,s0)
 
-ifdef(`distro_gentoo',`
-/etc/bind(/.*)?			gen_context(system_u:object_r:named_zone_t,s0)
-/etc/bind/named\.conf	--	gen_context(system_u:object_r:named_conf_t,s0)
-/etc/bind/rndc\.key	--	gen_context(system_u:object_r:dnssec_t,s0)
-/var/bind(/.*)?			gen_context(system_u:object_r:named_cache_t,s0)
-/var/bind/pri(/.*)?		gen_context(system_u:object_r:named_zone_t,s0)
-')
+/var/log/named.*	--	gen_context(system_u:object_r:named_log_t,s0)
 
-ifdef(`distro_redhat',`
-/etc/named\.rfc1912.zones --	gen_context(system_u:object_r:named_conf_t,s0)
-/etc/named\.root\.hints	--	gen_context(system_u:object_r:named_conf_t,s0)
-/etc/named\.conf	--	gen_context(system_u:object_r:named_conf_t,s0)
-/etc/named\.caching-nameserver\.conf -- gen_context(system_u:object_r:named_conf_t,s0)
-/var/named(/.*)?		gen_context(system_u:object_r:named_zone_t,s0)
-/var/named/slaves(/.*)?		gen_context(system_u:object_r:named_cache_t,s0)
-/var/named/data(/.*)?		gen_context(system_u:object_r:named_cache_t,s0)
+/var/named(/.*)?	gen_context(system_u:object_r:named_zone_t,s0)
+/var/named/slaves(/.*)?	gen_context(system_u:object_r:named_cache_t,s0)
+/var/named/data(/.*)?	gen_context(system_u:object_r:named_cache_t,s0)
 /var/named/named\.ca	--	gen_context(system_u:object_r:named_conf_t,s0)
-/var/named/chroot(/.*)?		gen_context(system_u:object_r:named_conf_t,s0)
-/var/named/chroot/etc/rndc\.key -- gen_context(system_u:object_r:dnssec_t,s0)
-/var/named/chroot/etc/named\.conf -- gen_context(system_u:object_r:named_conf_t,s0)
-/var/named/chroot/etc/named\.rfc1912.zones -- gen_context(system_u:object_r:named_conf_t,s0)
-/var/named/chroot/etc/named\.root\.hints -- gen_context(system_u:object_r:named_conf_t,s0)
-/var/named/chroot/etc/named\.caching-nameserver\.conf -- gen_context(system_u:object_r:named_conf_t,s0)
+/var/named/chroot(/.*)?	gen_context(system_u:object_r:named_conf_t,s0)
+/var/named/chroot/etc/rndc\.key	--	gen_context(system_u:object_r:dnssec_t,s0)
+/var/named/chroot/etc/named\.conf	--	gen_context(system_u:object_r:named_conf_t,s0)
+/var/named/chroot/etc/named\.rfc1912\.zones	--	gen_context(system_u:object_r:named_conf_t,s0)
+/var/named/chroot/etc/named\.root\.hints	--	gen_context(system_u:object_r:named_conf_t,s0)
+/var/named/chroot/etc/named\.caching-nameserver\.conf	--	gen_context(system_u:object_r:named_conf_t,s0)
 /var/named/chroot/proc(/.*)?	<<none>>
-/var/named/chroot/var/run/named.* gen_context(system_u:object_r:named_var_run_t,s0)
-/var/named/chroot/var/tmp(/.*)? gen_context(system_u:object_r:named_cache_t,s0)
-/var/named/chroot/var/named(/.*)? gen_context(system_u:object_r:named_zone_t,s0)
-/var/named/chroot/var/named/slaves(/.*)? gen_context(system_u:object_r:named_cache_t,s0)
-/var/named/chroot/var/named/data(/.*)? gen_context(system_u:object_r:named_cache_t,s0)
+/var/named/chroot/var/run/named.*	gen_context(system_u:object_r:named_var_run_t,s0)
+/var/named/chroot/var/tmp(/.*)?	gen_context(system_u:object_r:named_cache_t,s0)
+/var/named/chroot/var/named(/.*)?	gen_context(system_u:object_r:named_zone_t,s0)
+/var/named/chroot/var/named/slaves(/.*)?	gen_context(system_u:object_r:named_cache_t,s0)
+/var/named/chroot/var/named/data(/.*)?	gen_context(system_u:object_r:named_cache_t,s0)
 /var/named/chroot/var/named/dynamic(/.*)?	gen_context(system_u:object_r:named_cache_t,s0)
-/var/named/chroot/var/named/named\.ca -- gen_context(system_u:object_r:named_conf_t,s0)
+/var/named/chroot/var/named/named\.ca	--	gen_context(system_u:object_r:named_conf_t,s0)
 /var/named/chroot/var/log/named.*	--	gen_context(system_u:object_r:named_log_t,s0)
-/var/named/dynamic(/.*)?		gen_context(system_u:object_r:named_cache_t,s0)
-')
+/var/named/dynamic(/.*)?	gen_context(system_u:object_r:named_cache_t,s0)
+
+/var/run/ndc	-s	gen_context(system_u:object_r:named_var_run_t,s0)
+/var/run/bind(/.*)?	gen_context(system_u:object_r:named_var_run_t,s0)
+/var/run/named(/.*)?	gen_context(system_u:object_r:named_var_run_t,s0)
+/var/run/unbound(/.*)?	gen_context(system_u:object_r:named_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/bind.if refpolicy/policy/modules/contrib/bind.if
--- refpolicy/policy/modules/contrib/bind.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/bind.if	2012-11-06 21:18:51.556011602 +0100
@@ -1,4 +1,4 @@
-## <summary>Berkeley internet name domain DNS server.</summary>
+## <summary>Berkeley Internet name domain DNS server.</summary>
 
 ########################################
 ## <summary>
@@ -33,12 +33,13 @@
 		type ndc_t, ndc_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, ndc_exec_t, ndc_t)
 ')
 
 ########################################
 ## <summary>
-##	Send generic signals to BIND.
+##	Send generic signals to bind.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -56,7 +57,7 @@
 
 ########################################
 ## <summary>
-##	Send null sigals to BIND.
+##	Send null signals to bind.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -74,7 +75,7 @@
 
 ########################################
 ## <summary>
-##	Send BIND the kill signal
+##	Send kill signals to bind.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -109,11 +110,11 @@
 #
 interface(`bind_run_ndc',`
 	gen_require(`
-		type ndc_t;
+		attribute_role ndc_roles;
 	')
 
 	bind_domtrans_ndc($1)
-	role $2 types ndc_t;
+	roleattribute $2 ndc_roles;
 ')
 
 ########################################
@@ -131,12 +132,13 @@
 		type named_t, named_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, named_exec_t, named_t)
 ')
 
 ########################################
 ## <summary>
-##	Read DNSSEC keys.
+##	Read dnssec key files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -154,7 +156,7 @@
 
 ########################################
 ## <summary>
-##	Read BIND named configuration files.
+##	Read bind named configuration files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -172,7 +174,7 @@
 
 ########################################
 ## <summary>
-##	Write BIND named configuration files.
+##	Write bind named configuration files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -186,13 +188,13 @@
 	')
 
 	write_files_pattern($1, named_conf_t, named_conf_t)
-	allow $1 named_conf_t:file setattr;
+	allow $1 named_conf_t:file setattr_file_perms;
 ')
 
 ########################################
 ## <summary>
 ##	Create, read, write, and delete
-##	BIND configuration directories.
+##	bind configuration directories.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -210,7 +212,7 @@
 
 ########################################
 ## <summary>
-##	Search the BIND cache directory.
+##	Search bind cache directories.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -232,7 +234,7 @@
 ########################################
 ## <summary>
 ##	Create, read, write, and delete
-##	BIND cache files.
+##	bind cache files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -253,7 +255,7 @@
 
 ########################################
 ## <summary>
-##	Set the attributes of the BIND pid directory.
+##	Set attributes of bind pid directories.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -266,12 +268,12 @@
 		type named_var_run_t;
 	')
 
-	allow $1 named_var_run_t:dir setattr;
+	allow $1 named_var_run_t:dir setattr_dir_perms;
 ')
 
 ########################################
 ## <summary>
-##	Set the attributes of the BIND zone directory.
+##	Set attributes of bind zone directories.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -284,12 +286,12 @@
 		type named_zone_t;
 	')
 
-	allow $1 named_zone_t:dir setattr;
+	allow $1 named_zone_t:dir setattr_dir_perms;
 ')
 
 ########################################
 ## <summary>
-##	Read BIND zone files.
+##	Read bind zone files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -308,7 +310,8 @@
 
 ########################################
 ## <summary>
-##	Manage BIND zone files.
+##	Create, read, write, and delete
+##	bind zone files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -341,8 +344,8 @@
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate
-##	an bind environment
+##	All of the rules required to
+##	administrate an bind environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -351,7 +354,7 @@
 ## </param>
 ## <param name="role">
 ##	<summary>
-##	The role to be allowed to manage the bind domain.
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <rolecap/>
@@ -359,19 +362,12 @@
 interface(`bind_admin',`
 	gen_require(`
 		type named_t, named_tmp_t, named_log_t;
-		type named_conf_t, named_var_lib_t, named_var_run_t;
-		type named_cache_t, named_zone_t;
-		type dnssec_t, ndc_t;
-		type named_initrc_exec_t;
+		type named_cache_t, named_zone_t, named_initrc_exec_t;
+		type dnssec_t, ndc_t, named_conf_t, named_var_run_t;
 	')
 
-	allow $1 named_t:process { ptrace signal_perms };
-	ps_process_pattern($1, named_t)
-
-	allow $1 ndc_t:process { ptrace signal_perms };
-	ps_process_pattern($1, ndc_t)
-
-	bind_run_ndc($1, $2)
+	allow $1 { named_t ndc_t }:process { ptrace signal_perms };
+	ps_process_pattern($1, { named_t ndc_t })
 
 	init_labeled_script_domtrans($1, named_initrc_exec_t)
 	domain_system_change_exemption($1)
@@ -387,13 +383,11 @@
 	files_list_etc($1)
 	admin_pattern($1, named_conf_t)
 
-	admin_pattern($1, named_cache_t)
-	admin_pattern($1, named_zone_t)
-	admin_pattern($1, dnssec_t)
-
-	files_list_var_lib($1)
-	admin_pattern($1, named_var_lib_t)
+	files_list_var($1)
+	admin_pattern($1, { dnssec_t named_cache_t named_zone_t })
 
 	files_list_pids($1)
 	admin_pattern($1, named_var_run_t)
+
+	bind_run_ndc($1, $2)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/bind.te refpolicy/policy/modules/contrib/bind.te
--- refpolicy/policy/modules/contrib/bind.te	2012-07-10 14:45:57.000000000 +0200
+++ refpolicy/policy/modules/contrib/bind.te	2012-11-06 21:18:51.573011602 +0100
@@ -1,4 +1,4 @@
-policy_module(bind, 1.11.0)
+policy_module(bind, 1.12.7)
 
 ########################################
 #
@@ -6,26 +6,33 @@
 #
 
 ## <desc>
-## <p>
-## Allow BIND to write the master zone files.
-## Generally this is used for dynamic DNS or zone transfers.
-## </p>
+##	<p>
+##	Determine whether Bind can bind tcp socket to http ports.
+##	</p>
+## </desc>
+gen_tunable(named_tcp_bind_http_port, false)
+
+## <desc>
+##	<p>
+##	Determine whether Bind can write to master zone files.
+##	Generally this is used for dynamic DNS or zone transfers.
+##	</p>
 ## </desc>
 gen_tunable(named_write_master_zones, false)
 
-# for DNSSEC key files
+attribute_role ndc_roles;
+
 type dnssec_t;
 files_security_file(dnssec_t)
+files_mountpoint(dnssec_t)
 
 type named_t;
 type named_exec_t;
 init_daemon_domain(named_t, named_exec_t)
-role system_r types named_t;
 
 type named_checkconf_exec_t;
 init_system_domain(named_t, named_checkconf_exec_t)
 
-# A type for configuration files of named.
 type named_conf_t;
 files_type(named_conf_t)
 files_mountpoint(named_conf_t)
@@ -53,47 +60,45 @@
 type ndc_t;
 type ndc_exec_t;
 init_system_domain(ndc_t, ndc_exec_t)
-role system_r types ndc_t;
+role ndc_roles types ndc_t;
 
 ########################################
 #
-# Named local policy
+# Local policy
 #
 
 allow named_t self:capability { chown dac_override fowner setgid setuid sys_chroot sys_nice sys_resource };
 dontaudit named_t self:capability sys_tty_config;
 allow named_t self:process { setsched getcap setcap setrlimit signal_perms };
 allow named_t self:fifo_file rw_fifo_file_perms;
-allow named_t self:unix_stream_socket create_stream_socket_perms;
-allow named_t self:unix_dgram_socket create_socket_perms;
-allow named_t self:tcp_socket create_stream_socket_perms;
-allow named_t self:udp_socket create_socket_perms;
+allow named_t self:unix_stream_socket { accept listen };
+allow named_t self:tcp_socket { accept listen };
 
 allow named_t dnssec_t:file read_file_perms;
 
-# read configuration
 allow named_t named_conf_t:dir list_dir_perms;
 read_files_pattern(named_t, named_conf_t, named_conf_t)
 read_lnk_files_pattern(named_t, named_conf_t, named_conf_t)
 
-# write cache for secondary zones
 manage_files_pattern(named_t, named_cache_t, named_cache_t)
 manage_lnk_files_pattern(named_t, named_cache_t, named_cache_t)
 
 can_exec(named_t, named_exec_t)
 
-manage_files_pattern(named_t, named_log_t, named_log_t)
-logging_log_filetrans(named_t, named_log_t, { file dir })
+append_files_pattern(named_t, named_log_t, named_log_t)
+create_files_pattern(named_t, named_log_t, named_log_t)
+setattr_files_pattern(named_t, named_log_t, named_log_t)
+logging_log_filetrans(named_t, named_log_t, file)
 
 manage_dirs_pattern(named_t, named_tmp_t, named_tmp_t)
 manage_files_pattern(named_t, named_tmp_t, named_tmp_t)
 files_tmp_filetrans(named_t, named_tmp_t, { file dir })
 
+manage_dirs_pattern(named_t, named_var_run_t, named_var_run_t)
 manage_files_pattern(named_t, named_var_run_t, named_var_run_t)
 manage_sock_files_pattern(named_t, named_var_run_t, named_var_run_t)
-files_pid_filetrans(named_t, named_var_run_t, { file sock_file })
+files_pid_filetrans(named_t, named_var_run_t, { dir file sock_file })
 
-# read zone files
 allow named_t named_zone_t:dir list_dir_perms;
 read_files_pattern(named_t, named_zone_t, named_zone_t)
 read_lnk_files_pattern(named_t, named_zone_t, named_zone_t)
@@ -110,20 +115,25 @@
 corenet_udp_sendrecv_generic_if(named_t)
 corenet_tcp_sendrecv_generic_node(named_t)
 corenet_udp_sendrecv_generic_node(named_t)
-corenet_tcp_sendrecv_all_ports(named_t)
-corenet_udp_sendrecv_all_ports(named_t)
 corenet_tcp_bind_generic_node(named_t)
 corenet_udp_bind_generic_node(named_t)
+
+corenet_sendrecv_all_server_packets(named_t)
 corenet_tcp_bind_dns_port(named_t)
 corenet_udp_bind_dns_port(named_t)
+corenet_tcp_sendrecv_dns_port(named_t)
+corenet_udp_sendrecv_dns_port(named_t)
+
 corenet_tcp_bind_rndc_port(named_t)
-corenet_tcp_connect_all_ports(named_t)
-corenet_sendrecv_dns_server_packets(named_t)
-corenet_sendrecv_dns_client_packets(named_t)
-corenet_sendrecv_rndc_server_packets(named_t)
-corenet_sendrecv_rndc_client_packets(named_t)
+corenet_tcp_sendrecv_rndc_port(named_t)
+
 corenet_dontaudit_udp_bind_all_reserved_ports(named_t)
 corenet_udp_bind_all_unreserved_ports(named_t)
+corenet_udp_sendrecv_all_ports(named_t)
+
+corenet_sendrecv_all_client_packets(named_t)
+corenet_tcp_connect_all_ports(named_t)
+corenet_tcp_sendrecv_all_ports(named_t)
 
 dev_read_sysfs(named_t)
 dev_read_rand(named_t)
@@ -131,7 +141,6 @@
 
 domain_use_interactive_fds(named_t)
 
-files_read_etc_files(named_t)
 files_read_etc_runtime_files(named_t)
 
 fs_getattr_all_fs(named_t)
@@ -141,12 +150,18 @@
 
 logging_send_syslog_msg(named_t)
 
-miscfiles_read_localization(named_t)
 miscfiles_read_generic_certs(named_t)
+miscfiles_read_localization(named_t)
 
 userdom_dontaudit_use_unpriv_user_fds(named_t)
 userdom_dontaudit_search_user_home_dirs(named_t)
 
+tunable_policy(`named_tcp_bind_http_port',`
+	corenet_sendrecv_http_server_packets(named_t)
+	corenet_tcp_bind_http_port(named_t)
+	corenet_tcp_sendrecv_http_port(named_t)
+')
+
 tunable_policy(`named_write_master_zones',`
 	manage_dirs_pattern(named_t, named_zone_t, named_zone_t)
 	manage_files_pattern(named_t, named_zone_t, named_zone_t)
@@ -154,13 +169,12 @@
 ')
 
 optional_policy(`
+	dbus_system_domain(named_t, named_exec_t)
+
 	init_dbus_chat_script(named_t)
 
 	sysnet_dbus_chat_dhcpc(named_t)
 
-	dbus_system_bus_client(named_t)
-	dbus_connect_system_bus(named_t)
-
 	optional_policy(`
 		networkmanager_dbus_chat(named_t)
 	')
@@ -171,14 +185,10 @@
 ')
 
 optional_policy(`
-	# needed by FreeIPA with DNS support
 	ldap_stream_connect(named_t)
 ')
 
 optional_policy(`
-	# this seems like fds that arent being
-	# closed. these should probably be
-	# dontaudits instead.
 	networkmanager_rw_udp_sockets(named_t)
 	networkmanager_rw_packet_sockets(named_t)
 	networkmanager_rw_routing_sockets(named_t)
@@ -197,25 +207,23 @@
 # NDC local policy
 #
 
-# cjp: why net_admin?!
 allow ndc_t self:capability { dac_override net_admin };
-allow ndc_t self:process { fork signal_perms };
+allow ndc_t self:process signal_perms;
 allow ndc_t self:fifo_file rw_fifo_file_perms;
-allow ndc_t self:unix_stream_socket { connect create_stream_socket_perms };
-allow ndc_t self:tcp_socket create_socket_perms;
-allow ndc_t self:netlink_route_socket r_netlink_socket_perms;
+allow ndc_t self:unix_stream_socket { accept listen };
 
 allow ndc_t dnssec_t:file read_file_perms;
-allow ndc_t dnssec_t:lnk_file { getattr read };
+allow ndc_t dnssec_t:lnk_file read_lnk_file_perms;
 
 stream_connect_pattern(ndc_t, named_var_run_t, named_var_run_t, named_t)
 
 allow ndc_t named_conf_t:file read_file_perms;
-allow ndc_t named_conf_t:lnk_file { getattr read };
+allow ndc_t named_conf_t:lnk_file read_lnk_file_perms;
 
 allow ndc_t named_zone_t:dir search_dir_perms;
 
 kernel_read_kernel_sysctls(ndc_t)
+kernel_read_system_state(ndc_t)
 
 corenet_all_recvfrom_unlabeled(ndc_t)
 corenet_all_recvfrom_netlabel(ndc_t)
@@ -223,16 +231,20 @@
 corenet_tcp_sendrecv_generic_node(ndc_t)
 corenet_tcp_sendrecv_all_ports(ndc_t)
 corenet_tcp_bind_generic_node(ndc_t)
+
 corenet_tcp_connect_rndc_port(ndc_t)
 corenet_sendrecv_rndc_client_packets(ndc_t)
 
 domain_use_interactive_fds(ndc_t)
 
-files_read_etc_files(ndc_t)
 files_search_pids(ndc_t)
 
 fs_getattr_xattr_fs(ndc_t)
 
+term_dontaudit_use_console(ndc_t)
+
+auth_use_nsswitch(ndc_t)
+
 init_use_fds(ndc_t)
 init_use_script_ptys(ndc_t)
 
@@ -240,24 +252,10 @@
 
 miscfiles_read_localization(ndc_t)
 
-sysnet_read_config(ndc_t)
-sysnet_dns_name_resolve(ndc_t)
-
 userdom_use_user_terminals(ndc_t)
 
-term_dontaudit_use_console(ndc_t)
-
-# for /etc/rndc.key
 ifdef(`distro_redhat',`
-	allow ndc_t named_conf_t:dir search;
-')
-
-optional_policy(`
-	nis_use_ypbind(ndc_t)
-')
-
-optional_policy(`
-	nscd_socket_use(ndc_t)
+	allow ndc_t named_conf_t:dir search_dir_perms;
 ')
 
 optional_policy(`
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/bird.fc refpolicy/policy/modules/contrib/bird.fc
--- refpolicy/policy/modules/contrib/bird.fc	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/bird.fc	2012-08-08 20:44:02.974852881 +0200
@@ -0,0 +1,11 @@
+/etc/bird\.conf	--	gen_context(system_u:object_r:bird_etc_t,s0)
+
+/etc/default/bird	--	gen_context(system_u:object_r:bird_etc_t,s0)
+
+/etc/rc\.d/init\.d/bird	--	gen_context(system_u:object_r:bird_initrc_exec_t,s0)
+
+/usr/sbin/bird	--	gen_context(system_u:object_r:bird_exec_t,s0)
+
+/var/log/bird\.log.*	--	gen_context(system_u:object_r:bird_log_t,s0)
+
+/var/run/bird\.ctl	-s	gen_context(system_u:object_r:bird_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/bird.if refpolicy/policy/modules/contrib/bird.if
--- refpolicy/policy/modules/contrib/bird.if	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/bird.if	2012-09-27 20:03:30.732126498 +0200
@@ -0,0 +1,42 @@
+## <summary>BIRD Internet Routing Daemon.</summary>
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an bird environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`bird_admin',`
+	gen_require(`
+		type bird_t, bird_etc_t, bird_log_t;
+		type bird_var_run_t, bird_initrc_exec_t;
+	')
+
+	allow $1 bird_t:process { ptrace signal_perms };
+	ps_process_pattern($1, bird_t)
+
+	init_labeled_script_domtrans($1, bird_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 bird_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	files_list_etc($1)
+	admin_pattern($1, bird_etc_t)
+
+	logging_list_logs($1)
+	admin_pattern($1, bird_log_t)
+
+	files_list_pids($1)
+	admin_pattern($1, bird_var_run_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/bird.te refpolicy/policy/modules/contrib/bird.te
--- refpolicy/policy/modules/contrib/bird.te	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/bird.te	2012-09-27 20:03:30.733126498 +0200
@@ -0,0 +1,58 @@
+policy_module(bird, 1.0.1)
+
+########################################
+#
+# Declarations
+#
+
+type bird_t;
+type bird_exec_t;
+init_daemon_domain(bird_t, bird_exec_t)
+
+type bird_initrc_exec_t;
+init_script_file(bird_initrc_exec_t)
+
+type bird_etc_t;
+files_config_file(bird_etc_t)
+
+type bird_log_t;
+logging_log_file(bird_log_t)
+
+type bird_var_run_t;
+files_pid_file(bird_var_run_t)
+
+########################################
+#
+# Local policy
+#
+
+allow bird_t self:capability { net_admin net_bind_service };
+allow bird_t self:netlink_route_socket create_netlink_socket_perms;
+allow bird_t self:tcp_socket create_stream_socket_perms;
+
+allow bird_t bird_etc_t:file read_file_perms;
+
+allow bird_t bird_log_t:file { create_file_perms append_file_perms setattr_file_perms };
+logging_log_filetrans(bird_t, bird_log_t, file)
+
+allow bird_t bird_var_run_t:sock_file manage_sock_file_perms;
+files_pid_filetrans(bird_t, bird_var_run_t, sock_file)
+
+corenet_all_recvfrom_unlabeled(bird_t)
+corenet_all_recvfrom_netlabel(bird_t)
+corenet_tcp_sendrecv_generic_if(bird_t)
+corenet_tcp_bind_generic_node(bird_t)
+corenet_tcp_sendrecv_generic_node(bird_t)
+
+corenet_sendrecv_bgp_client_packets(bird_t)
+corenet_sendrecv_bgp_server_packets(bird_t)
+corenet_tcp_bind_bgp_port(bird_t)
+corenet_tcp_connect_bgp_port(bird_t)
+corenet_tcp_sendrecv_bgp_port(bird_t)
+
+# /etc/iproute2/rt_realms
+files_read_etc_files(bird_t)
+
+logging_send_syslog_msg(bird_t)
+
+miscfiles_read_localization(bird_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/bitlbee.fc refpolicy/policy/modules/contrib/bitlbee.fc
--- refpolicy/policy/modules/contrib/bitlbee.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/bitlbee.fc	2012-09-27 20:03:30.733126498 +0200
@@ -1,6 +1,14 @@
-/etc/rc\.d/init\.d/bitlbee --	gen_context(system_u:object_r:bitlbee_initrc_exec_t,s0)
-/etc/bitlbee(/.*)?		gen_context(system_u:object_r:bitlbee_conf_t,s0)
+/etc/bitlbee(/.*)?	gen_context(system_u:object_r:bitlbee_conf_t,s0)
 
+/etc/rc\.d/init\.d/bitlbee	--	gen_context(system_u:object_r:bitlbee_initrc_exec_t,s0)
+
+/usr/bin/bip	--	gen_context(system_u:object_r:bitlbee_exec_t,s0)
 /usr/sbin/bitlbee	--	gen_context(system_u:object_r:bitlbee_exec_t,s0)
 
-/var/lib/bitlbee(/.*)?		gen_context(system_u:object_r:bitlbee_var_t,s0)
+/var/lib/bitlbee(/.*)?	gen_context(system_u:object_r:bitlbee_var_t,s0)
+
+/var/log/bip(/.*)?	gen_context(system_u:object_r:bitlbee_log_t,s0)
+
+/var/run/bitlbee\.pid	--	gen_context(system_u:object_r:bitlbee_var_run_t,s0)
+/var/run/bitlbee\.sock	-s	gen_context(system_u:object_r:bitlbee_var_run_t,s0)
+/var/run/bip(/.*)?	gen_context(system_u:object_r:bitlbee_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/bitlbee.if refpolicy/policy/modules/contrib/bitlbee.if
--- refpolicy/policy/modules/contrib/bitlbee.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/bitlbee.if	2012-09-27 20:03:30.733126498 +0200
@@ -1,12 +1,12 @@
-## <summary>Bitlbee service</summary>
+## <summary>Tunnels instant messaging traffic to a virtual IRC channel.</summary>
 
 ########################################
 ## <summary>
-##	Read bitlbee configuration files
+##	Read bitlbee configuration files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
-##	Domain allowed accesss.
+##	Domain allowed access.
 ##	</summary>
 ## </param>
 #
@@ -22,8 +22,8 @@
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate
-##	an bitlbee environment
+##	All of the rules required to
+##	administrate an bitlbee environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -32,7 +32,7 @@
 ## </param>
 ## <param name="role">
 ##	<summary>
-##	The role to be allowed to manage the bitlbee domain.
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <rolecap/>
@@ -40,7 +40,8 @@
 interface(`bitlbee_admin',`
 	gen_require(`
 		type bitlbee_t, bitlbee_conf_t, bitlbee_var_t;
-		type bitlbee_initrc_exec_t;
+		type bitlbee_initrc_exec_t, bitlbee_var_run_t;
+		type bitlbee_log_t, bitlbee_tmp_t;
 	')
 
 	allow $1 bitlbee_t:process { ptrace signal_perms };
@@ -51,9 +52,18 @@
 	role_transition $2 bitlbee_initrc_exec_t system_r;
 	allow $2 system_r;
 
-	files_list_etc($1)
+	files_search_etc($1)
 	admin_pattern($1, bitlbee_conf_t)
 
-	files_list_var($1)
+	logging_search_logs($1)
+	admin_pattern($1, bitlbee_log_t)
+
+	files_search_tmp($1)
+	admin_pattern($1, bitlbee_tmp_t)
+
+	files_search_pids($1)
+	admin_pattern($1, bitlbee_var_run_t)
+
+	files_search_var_lib($1)
 	admin_pattern($1, bitlbee_var_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/bitlbee.te refpolicy/policy/modules/contrib/bitlbee.te
--- refpolicy/policy/modules/contrib/bitlbee.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/bitlbee.te	2012-10-06 20:31:39.392752842 +0200
@@ -1,4 +1,4 @@
-policy_module(bitlbee, 1.4.0)
+policy_module(bitlbee, 1.4.3)
 
 ########################################
 #
@@ -22,60 +22,92 @@
 type bitlbee_var_t;
 files_type(bitlbee_var_t)
 
+type bitlbee_log_t;
+logging_log_file(bitlbee_log_t)
+
+type bitlbee_var_run_t;
+files_pid_file(bitlbee_var_run_t)
+
 ########################################
 #
 # Local policy
 #
 
-allow bitlbee_t self:capability { setgid setuid };
-allow bitlbee_t self:process signal;
-allow bitlbee_t self:udp_socket create_socket_perms;
-allow bitlbee_t self:tcp_socket { create_stream_socket_perms connected_stream_socket_perms };
-allow bitlbee_t self:unix_stream_socket create_stream_socket_perms;
+allow bitlbee_t self:capability { dac_override kill setgid setuid sys_nice };
+allow bitlbee_t self:process { setsched signal };
 allow bitlbee_t self:fifo_file rw_fifo_file_perms;
+allow bitlbee_t self:tcp_socket { accept listen };
+allow bitlbee_t self:unix_stream_socket { accept listen };
 
-bitlbee_read_config(bitlbee_t)
+allow bitlbee_t bitlbee_conf_t:dir list_dir_perms;
+allow bitlbee_t bitlbee_conf_t:file read_file_perms;
+
+manage_dirs_pattern(bitlbee_t, bitlbee_log_t, bitlbee_log_t)
+append_files_pattern(bitlbee_t, bitlbee_log_t, bitlbee_log_t)
+create_files_pattern(bitlbee_t, bitlbee_log_t, bitlbee_log_t)
+setattr_files_pattern(bitlbee_t, bitlbee_log_t, bitlbee_log_t)
 
-# tmp files
 manage_files_pattern(bitlbee_t, bitlbee_tmp_t, bitlbee_tmp_t)
-files_tmp_filetrans(bitlbee_t, bitlbee_tmp_t, file)
+manage_dirs_pattern(bitlbee_t, bitlbee_tmp_t, bitlbee_tmp_t)
+files_tmp_filetrans(bitlbee_t, bitlbee_tmp_t, { dir file })
 
-# user account information is read and edited at runtime; give the usual
-# r/w access to bitlbee_var_t
 manage_files_pattern(bitlbee_t, bitlbee_var_t, bitlbee_var_t)
 files_var_lib_filetrans(bitlbee_t, bitlbee_var_t, file)
 
+manage_dirs_pattern(bitlbee_t, bitlbee_var_run_t, bitlbee_var_run_t)
+manage_files_pattern(bitlbee_t, bitlbee_var_run_t, bitlbee_var_run_t)
+manage_sock_files_pattern(bitlbee_t, bitlbee_var_run_t, bitlbee_var_run_t)
+files_pid_filetrans(bitlbee_t, bitlbee_var_run_t, { dir file sock_file })
+
 kernel_read_system_state(bitlbee_t)
 
 corenet_all_recvfrom_unlabeled(bitlbee_t)
-corenet_udp_sendrecv_generic_if(bitlbee_t)
-corenet_udp_sendrecv_generic_node(bitlbee_t)
+corenet_all_recvfrom_netlabel(bitlbee_t)
 corenet_tcp_sendrecv_generic_if(bitlbee_t)
 corenet_tcp_sendrecv_generic_node(bitlbee_t)
-# Allow bitlbee to connect to jabber servers
+corenet_tcp_bind_generic_node(bitlbee_t)
+
+corenet_sendrecv_jabber_client_client_packets(bitlbee_t)
 corenet_tcp_connect_jabber_client_port(bitlbee_t)
 corenet_tcp_sendrecv_jabber_client_port(bitlbee_t)
-# to AIM servers:
+
+corenet_sendrecv_aol_client_packets(bitlbee_t)
 corenet_tcp_connect_aol_port(bitlbee_t)
 corenet_tcp_sendrecv_aol_port(bitlbee_t)
-# and to MMCC (Yahoo IM) servers:
+
+corenet_sendrecv_gatekeeper_client_packets(bitlbee_t)
+corenet_tcp_connect_gatekeeper_port(bitlbee_t)
+corenet_tcp_sendrecv_gatekeeper_port(bitlbee_t)
+
+corenet_sendrecv_mmcc_client_packets(bitlbee_t)
 corenet_tcp_connect_mmcc_port(bitlbee_t)
 corenet_tcp_sendrecv_mmcc_port(bitlbee_t)
-# and to MSNP (MSN Messenger) servers:
+
+corenet_sendrecv_msnp_client_packets(bitlbee_t)
 corenet_tcp_connect_msnp_port(bitlbee_t)
 corenet_tcp_sendrecv_msnp_port(bitlbee_t)
-# MSN can use passport auth, which is over http:
+
+corenet_sendrecv_http_client_packets(bitlbee_t)
 corenet_tcp_connect_http_port(bitlbee_t)
 corenet_tcp_sendrecv_http_port(bitlbee_t)
+
+corenet_sendrecv_http_cache_client_packets(bitlbee_t)
 corenet_tcp_connect_http_cache_port(bitlbee_t)
 corenet_tcp_sendrecv_http_cache_port(bitlbee_t)
 
+corenet_sendrecv_ircd_server_packets(bitlbee_t)
+corenet_tcp_bind_ircd_port(bitlbee_t)
+corenet_sendrecv_ircd_client_packets(bitlbee_t)
+corenet_tcp_connect_ircd_port(bitlbee_t)
+corenet_tcp_sendrecv_ircd_port(bitlbee_t)
+
+corenet_sendrecv_interwise_server_packets(bitlbee_t)
+corenet_tcp_bind_interwise_port(bitlbee_t)
+corenet_tcp_sendrecv_interwise_port(bitlbee_t)
+
 dev_read_rand(bitlbee_t)
 dev_read_urand(bitlbee_t)
 
-files_read_etc_files(bitlbee_t)
-files_search_pids(bitlbee_t)
-# grant read-only access to the user help files
 files_read_usr_files(bitlbee_t)
 
 libs_legacy_use_shared_libs(bitlbee_t)
@@ -86,9 +118,6 @@
 
 miscfiles_read_localization(bitlbee_t)
 
-sysnet_dns_name_resolve(bitlbee_t)
-
 optional_policy(`
-	# normally started from inetd using tcpwrappers, so use those entry points
 	tcpd_wrapped_domain(bitlbee_t, bitlbee_exec_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/blueman.fc refpolicy/policy/modules/contrib/blueman.fc
--- refpolicy/policy/modules/contrib/blueman.fc	2012-07-10 14:17:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/blueman.fc	2012-09-27 20:03:30.733126498 +0200
@@ -1,3 +1,3 @@
 /usr/libexec/blueman-mechanism	--	gen_context(system_u:object_r:blueman_exec_t,s0)
 
-/var/lib/blueman(/.*)?			gen_context(system_u:object_r:blueman_var_lib_t,s0)
+/var/lib/blueman(/.*)?	gen_context(system_u:object_r:blueman_var_lib_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/blueman.if refpolicy/policy/modules/contrib/blueman.if
--- refpolicy/policy/modules/contrib/blueman.if	2012-07-10 14:17:38.000000000 +0200
+++ refpolicy/policy/modules/contrib/blueman.if	2012-09-27 20:03:30.733126498 +0200
@@ -1,8 +1,8 @@
-## <summary>Blueman is a tool to manage Bluetooth devices</summary>
+## <summary>Tool to manage Bluetooth devices.</summary>
 
 ########################################
 ## <summary>
-##	Execute blueman in the blueman domain..
+##	Execute blueman in the blueman domain.
 ## </summary>
 ## <param name="domain">
 ## <summary>
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/blueman.te refpolicy/policy/modules/contrib/blueman.te
--- refpolicy/policy/modules/contrib/blueman.te	2012-07-10 14:17:09.000000000 +0200
+++ refpolicy/policy/modules/contrib/blueman.te	2012-11-06 21:18:57.771011613 +0100
@@ -1,4 +1,4 @@
-policy_module(blueman, 1.0.0)
+policy_module(blueman, 1.0.3)
 
 ########################################
 #
@@ -8,15 +8,17 @@
 type blueman_t;
 type blueman_exec_t;
 dbus_system_domain(blueman_t, blueman_exec_t)
-init_daemon_domain(blueman_t, blueman_exec_t)
 
 type blueman_var_lib_t;
 files_type(blueman_var_lib_t)
 
 ########################################
 #
-# blueman local policy
+# Local policy
 #
+
+allow blueman_t self:capability sys_nice;
+allow blueman_t self:process { signal_perms setsched };
 allow blueman_t self:fifo_file rw_fifo_file_perms;
 
 manage_dirs_pattern(blueman_t, blueman_var_lib_t, blueman_var_lib_t)
@@ -33,6 +35,7 @@
 
 domain_use_interactive_fds(blueman_t)
 
+files_list_tmp(blueman_t)
 files_read_usr_files(blueman_t)
 
 auth_use_nsswitch(blueman_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/bluetooth.fc refpolicy/policy/modules/contrib/bluetooth.fc
--- refpolicy/policy/modules/contrib/bluetooth.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/bluetooth.fc	2012-09-27 20:03:30.734126498 +0200
@@ -1,30 +1,24 @@
-#
-# /etc
-#
-/etc/bluetooth(/.*)?		gen_context(system_u:object_r:bluetooth_conf_t,s0)
-/etc/bluetooth/link_key		gen_context(system_u:object_r:bluetooth_conf_rw_t,s0)
-/etc/rc\.d/init\.d/bluetooth --	gen_context(system_u:object_r:bluetooth_initrc_exec_t,s0)
+/etc/bluetooth(/.*)?	gen_context(system_u:object_r:bluetooth_conf_t,s0)
+/etc/bluetooth/link_key	--	gen_context(system_u:object_r:bluetooth_conf_rw_t,s0)
+
+/etc/rc\.d/init\.d/bluetooth	--	gen_context(system_u:object_r:bluetooth_initrc_exec_t,s0)
 /etc/rc\.d/init\.d/dund	--	gen_context(system_u:object_r:bluetooth_initrc_exec_t,s0)
 /etc/rc\.d/init\.d/pand	--	gen_context(system_u:object_r:bluetooth_initrc_exec_t,s0)
 
-#
-# /usr
-#
 /usr/bin/blue.*pin	--	gen_context(system_u:object_r:bluetooth_helper_exec_t,s0)
-/usr/bin/dund		--	gen_context(system_u:object_r:bluetooth_exec_t,s0)
-/usr/bin/hidd		--	gen_context(system_u:object_r:bluetooth_exec_t,s0)
-/usr/bin/rfcomm		--	gen_context(system_u:object_r:bluetooth_exec_t,s0)
+/usr/bin/dund	--	gen_context(system_u:object_r:bluetooth_exec_t,s0)
+/usr/bin/hidd	--	gen_context(system_u:object_r:bluetooth_exec_t,s0)
+/usr/bin/rfcomm	--	gen_context(system_u:object_r:bluetooth_exec_t,s0)
 
 /usr/sbin/bluetoothd	--	gen_context(system_u:object_r:bluetooth_exec_t,s0)
 /usr/sbin/hciattach	--	gen_context(system_u:object_r:bluetooth_exec_t,s0)
-/usr/sbin/hcid		--	gen_context(system_u:object_r:bluetooth_exec_t,s0)
+/usr/sbin/hcid	--	gen_context(system_u:object_r:bluetooth_exec_t,s0)
 /usr/sbin/hid2hci	--	gen_context(system_u:object_r:bluetooth_exec_t,s0)
-/usr/sbin/sdpd		--	gen_context(system_u:object_r:bluetooth_exec_t,s0)
+/usr/sbin/sdpd	--	gen_context(system_u:object_r:bluetooth_exec_t,s0)
 
-#
-# /var
-#
 /var/lib/bluetooth(/.*)?	gen_context(system_u:object_r:bluetooth_var_lib_t,s0)
 
-/var/run/bluetoothd_address	gen_context(system_u:object_r:bluetooth_var_run_t,s0)
-/var/run/sdp		-s	gen_context(system_u:object_r:bluetooth_var_run_t,s0)
+/var/lock/subsys/bluetoothd	--	gen_context(system_u:object_r:bluetooth_lock_t,s0)
+
+/var/run/bluetoothd_address	--	gen_context(system_u:object_r:bluetooth_var_run_t,s0)
+/var/run/sdp	-s	gen_context(system_u:object_r:bluetooth_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/bluetooth.if refpolicy/policy/modules/contrib/bluetooth.if
--- refpolicy/policy/modules/contrib/bluetooth.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/bluetooth.if	2012-10-08 20:11:35.663033648 +0200
@@ -2,7 +2,7 @@
 
 ########################################
 ## <summary>
-##	Role access for bluetooth
+##	Role access for bluetooth.
 ## </summary>
 ## <param name="role">
 ##	<summary>
@@ -17,24 +17,36 @@
 #
 interface(`bluetooth_role',`
 	gen_require(`
-		type bluetooth_helper_t, bluetooth_helper_exec_t;
-		type bluetooth_helper_tmp_t, bluetooth_helper_tmpfs_t;
-	')
-
-	role $1 types bluetooth_helper_t;
+		attribute_role bluetooth_helper_roles;
+		type bluetooth_t, bluetooth_helper_t, bluetooth_helper_exec_t;
+		type bluetooth_helper_tmp_t, bluetooth_helper_tmpfs_t, bluetooth_var_run_t;
+	')
+
+	########################################
+	#
+	# Declarations
+	#
+
+	roleattribute $1 bluetooth_helper_roles;
+
+	########################################
+	#
+	# Policy
+	#
 
 	domtrans_pattern($2, bluetooth_helper_exec_t, bluetooth_helper_t)
 
-	# allow ps to show cdrecord and allow the user to kill it
 	ps_process_pattern($2, bluetooth_helper_t)
-	allow $2 bluetooth_helper_t:process signal;
+	allow $2 bluetooth_helper_t:process { ptrace signal_perms };
+
+	allow $2 bluetooth_t:socket rw_socket_perms;
 
-	manage_dirs_pattern($2, bluetooth_helper_tmp_t, bluetooth_helper_tmp_t)
-	manage_files_pattern($2, bluetooth_helper_tmp_t, bluetooth_helper_tmp_t)
-	manage_sock_files_pattern($2, bluetooth_helper_tmp_t, bluetooth_helper_tmp_t)
+	allow $2 { bluetooth_helper_tmp_t bluetooth_helper_tmpfs_t }:dir { manage_dir_perms relabel_dir_perms };
+	allow $2 { bluetooth_helper_tmp_t bluetooth_helper_tmpfs_t }:file { manage_file_perms relabel_file_perms };
+	allow $2 bluetooth_helper_tmp_t:sock_file { manage_sock_file_perms relabel_sock_file_perms };
 
-	manage_dirs_pattern($2, bluetooth_helper_tmpfs_t, bluetooth_helper_tmpfs_t)
-	manage_files_pattern($2, bluetooth_helper_tmpfs_t, bluetooth_helper_tmpfs_t)
+	stream_connect_pattern($2, bluetooth_var_run_t, bluetooth_var_run_t, bluetooth_t)
+	files_search_pids($2)
 ')
 
 #####################################
@@ -73,12 +85,13 @@
 		type bluetooth_t, bluetooth_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, bluetooth_exec_t, bluetooth_t)
 ')
 
 ########################################
 ## <summary>
-##	Read bluetooth daemon configuration.
+##	Read bluetooth configuration files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -91,7 +104,7 @@
 		type bluetooth_conf_t;
 	')
 
-	allow $1 bluetooth_conf_t:file { getattr read ioctl };
+	allow $1 bluetooth_conf_t:file read_file_perms;
 ')
 
 ########################################
@@ -157,7 +170,8 @@
 
 ########################################
 ## <summary>
-##	Read bluetooth helper state files.
+##	Do not audit attempts to read
+##	bluetooth process state files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -170,14 +184,14 @@
 		type bluetooth_helper_t;
 	')
 
-	dontaudit $1 bluetooth_helper_t:dir search;
-	dontaudit $1 bluetooth_helper_t:file { read getattr };
+	dontaudit $1 bluetooth_helper_t:dir search_dir_perms;
+	dontaudit $1 bluetooth_helper_t:file read_file_perms;
 ')
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate
-##	an bluetooth environment
+##	All of the rules required to
+##	administrate an bluetooth environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -186,7 +200,7 @@
 ## </param>
 ## <param name="role">
 ##	<summary>
-##	The role to be allowed to manage the bluetooth domain.
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <rolecap/>
@@ -194,8 +208,8 @@
 interface(`bluetooth_admin',`
 	gen_require(`
 		type bluetooth_t, bluetooth_tmp_t, bluetooth_lock_t;
-		type bluetooth_spool_t, bluetooth_var_lib_t, bluetooth_var_run_t;
-		type bluetooth_conf_t, bluetooth_conf_rw_t;
+		type bluetooth_var_lib_t, bluetooth_var_run_t;
+		type bluetooth_conf_t, bluetooth_conf_rw_t, bluetooth_var_lib_t;
 		type bluetooth_initrc_exec_t;
 	')
 
@@ -214,11 +228,7 @@
 	admin_pattern($1, bluetooth_lock_t)
 
 	files_list_etc($1)
-	admin_pattern($1, bluetooth_conf_t)
-	admin_pattern($1, bluetooth_conf_rw_t)
-
-	files_list_spool($1)
-	admin_pattern($1, bluetooth_spool_t)
+	admin_pattern($1, { bluetooth_conf_t bluetooth_conf_rw_t })
 
 	files_list_var_lib($1)
 	admin_pattern($1, bluetooth_var_lib_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/bluetooth.te refpolicy/policy/modules/contrib/bluetooth.te
--- refpolicy/policy/modules/contrib/bluetooth.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/bluetooth.te	2012-10-08 20:11:35.678033589 +0200
@@ -1,15 +1,18 @@
-policy_module(bluetooth, 3.4.0)
+policy_module(bluetooth, 3.4.5)
 
 ########################################
 #
 # Declarations
 #
+
+attribute_role bluetooth_helper_roles;
+
 type bluetooth_t;
 type bluetooth_exec_t;
 init_daemon_domain(bluetooth_t, bluetooth_exec_t)
 
 type bluetooth_conf_t;
-files_type(bluetooth_conf_t)
+files_config_file(bluetooth_conf_t)
 
 type bluetooth_conf_rw_t;
 files_type(bluetooth_conf_rw_t)
@@ -19,6 +22,7 @@
 typealias bluetooth_helper_t alias { user_bluetooth_helper_t staff_bluetooth_helper_t sysadm_bluetooth_helper_t };
 typealias bluetooth_helper_t alias { auditadm_bluetooth_helper_t secadm_bluetooth_helper_t };
 userdom_user_application_domain(bluetooth_helper_t, bluetooth_helper_exec_t)
+role bluetooth_helper_roles types bluetooth_helper_t;
 
 type bluetooth_helper_tmp_t;
 typealias bluetooth_helper_tmp_t alias { user_bluetooth_helper_tmp_t staff_bluetooth_helper_tmp_t sysadm_bluetooth_helper_tmp_t };
@@ -47,20 +51,17 @@
 
 ########################################
 #
-# Bluetooth services local policy
+# Local policy
 #
 
-#sys_admin capability - redhat bug 573015
 allow bluetooth_t self:capability { dac_override net_bind_service net_admin net_raw setpcap sys_admin sys_tty_config ipc_lock };
 dontaudit bluetooth_t self:capability sys_tty_config;
 allow bluetooth_t self:process { getcap setcap getsched signal_perms };
 allow bluetooth_t self:fifo_file rw_fifo_file_perms;
 allow bluetooth_t self:shm create_shm_perms;
 allow bluetooth_t self:socket create_stream_socket_perms;
-allow bluetooth_t self:unix_dgram_socket create_socket_perms;
-allow bluetooth_t self:unix_stream_socket { connectto create_stream_socket_perms };
-allow bluetooth_t self:tcp_socket create_stream_socket_perms;
-allow bluetooth_t self:udp_socket create_socket_perms;
+allow bluetooth_t self:unix_stream_socket { accept connectto listen };
+allow bluetooth_t self:tcp_socket { accept listen };
 allow bluetooth_t self:netlink_kobject_uevent_socket create_socket_perms;
 
 read_files_pattern(bluetooth_t, bluetooth_conf_t, bluetooth_conf_t)
@@ -72,14 +73,12 @@
 manage_sock_files_pattern(bluetooth_t, bluetooth_conf_t, bluetooth_conf_rw_t)
 filetrans_pattern(bluetooth_t, bluetooth_conf_t, bluetooth_conf_rw_t, { dir file lnk_file sock_file fifo_file })
 
-can_exec(bluetooth_t, bluetooth_helper_exec_t)
-
 allow bluetooth_t bluetooth_lock_t:file manage_file_perms;
 files_lock_filetrans(bluetooth_t, bluetooth_lock_t, file)
 
 manage_dirs_pattern(bluetooth_t, bluetooth_tmp_t, bluetooth_tmp_t)
 manage_files_pattern(bluetooth_t, bluetooth_tmp_t, bluetooth_tmp_t)
-files_tmp_filetrans(bluetooth_t, bluetooth_tmp_t, { file dir })
+files_tmp_filetrans(bluetooth_t, bluetooth_tmp_t, { dir file })
 
 manage_dirs_pattern(bluetooth_t, bluetooth_var_lib_t, bluetooth_var_lib_t)
 manage_files_pattern(bluetooth_t, bluetooth_var_lib_t, bluetooth_var_lib_t)
@@ -89,23 +88,16 @@
 manage_sock_files_pattern(bluetooth_t, bluetooth_var_run_t, bluetooth_var_run_t)
 files_pid_filetrans(bluetooth_t, bluetooth_var_run_t, { file sock_file })
 
+can_exec(bluetooth_t, bluetooth_helper_exec_t)
+
 kernel_read_kernel_sysctls(bluetooth_t)
 kernel_read_system_state(bluetooth_t)
 kernel_read_network_state(bluetooth_t)
 kernel_request_load_module(bluetooth_t)
-#search debugfs - redhat bug 548206
 kernel_search_debugfs(bluetooth_t)
 
-corenet_all_recvfrom_unlabeled(bluetooth_t)
-corenet_all_recvfrom_netlabel(bluetooth_t)
-corenet_tcp_sendrecv_generic_if(bluetooth_t)
-corenet_udp_sendrecv_generic_if(bluetooth_t)
-corenet_raw_sendrecv_generic_if(bluetooth_t)
-corenet_tcp_sendrecv_generic_node(bluetooth_t)
-corenet_udp_sendrecv_generic_node(bluetooth_t)
-corenet_raw_sendrecv_generic_node(bluetooth_t)
-corenet_tcp_sendrecv_all_ports(bluetooth_t)
-corenet_udp_sendrecv_all_ports(bluetooth_t)
+corecmd_exec_bin(bluetooth_t)
+corecmd_exec_shell(bluetooth_t)
 
 dev_read_sysfs(bluetooth_t)
 dev_rw_usbfs(bluetooth_t)
@@ -114,23 +106,18 @@
 dev_rw_input_dev(bluetooth_t)
 dev_rw_wireless(bluetooth_t)
 
-fs_getattr_all_fs(bluetooth_t)
-fs_search_auto_mountpoints(bluetooth_t)
-fs_list_inotifyfs(bluetooth_t)
-
-#Handle bluetooth serial devices
-term_use_unallocated_ttys(bluetooth_t)
-
-corecmd_exec_bin(bluetooth_t)
-corecmd_exec_shell(bluetooth_t)
-
 domain_use_interactive_fds(bluetooth_t)
 domain_dontaudit_search_all_domains_state(bluetooth_t)
 
-files_read_etc_files(bluetooth_t)
 files_read_etc_runtime_files(bluetooth_t)
 files_read_usr_files(bluetooth_t)
 
+fs_getattr_all_fs(bluetooth_t)
+fs_search_auto_mountpoints(bluetooth_t)
+fs_list_inotifyfs(bluetooth_t)
+
+term_use_unallocated_ttys(bluetooth_t)
+
 auth_use_nsswitch(bluetooth_t)
 
 logging_send_syslog_msg(bluetooth_t)
@@ -145,13 +132,16 @@
 
 optional_policy(`
 	dbus_system_bus_client(bluetooth_t)
-	dbus_connect_system_bus(bluetooth_t)
 
 	optional_policy(`
 		cups_dbus_chat(bluetooth_t)
 	')
 
 	optional_policy(`
+		devicekit_dbus_chat_power(bluetooth_t)
+	')
+
+	optional_policy(`
 		hal_dbus_chat(bluetooth_t)
 	')
 
@@ -178,23 +168,21 @@
 
 ########################################
 #
-# Bluetooth helper programs local policy
+# Helper local policy
 #
 
 allow bluetooth_helper_t self:capability sys_nice;
 allow bluetooth_helper_t self:process getsched;
 allow bluetooth_helper_t self:fifo_file rw_fifo_file_perms;
 allow bluetooth_helper_t self:shm create_shm_perms;
-allow bluetooth_helper_t self:unix_stream_socket { create_stream_socket_perms connectto };
-allow bluetooth_helper_t self:tcp_socket create_socket_perms;
-allow bluetooth_helper_t self:netlink_route_socket r_netlink_socket_perms;
+allow bluetooth_helper_t self:unix_stream_socket { accept connectto listen };
 
 allow bluetooth_helper_t bluetooth_t:socket { read write };
 
 manage_dirs_pattern(bluetooth_helper_t, bluetooth_helper_tmp_t, bluetooth_helper_tmp_t)
 manage_files_pattern(bluetooth_helper_t, bluetooth_helper_tmp_t, bluetooth_helper_tmp_t)
 manage_sock_files_pattern(bluetooth_helper_t, bluetooth_helper_tmp_t, bluetooth_helper_tmp_t)
-files_tmp_filetrans(bluetooth_helper_t, bluetooth_helper_tmp_t, { file dir sock_file })
+files_tmp_filetrans(bluetooth_helper_t, bluetooth_helper_tmp_t, { dir file sock_file })
 
 manage_dirs_pattern(bluetooth_helper_t, bluetooth_helper_tmpfs_t, bluetooth_helper_tmpfs_t)
 manage_files_pattern(bluetooth_helper_t, bluetooth_helper_tmpfs_t, bluetooth_helper_tmpfs_t)
@@ -203,28 +191,27 @@
 kernel_read_system_state(bluetooth_helper_t)
 kernel_read_kernel_sysctls(bluetooth_helper_t)
 
-dev_read_urand(bluetooth_helper_t)
-
-term_dontaudit_use_all_ttys(bluetooth_helper_t)
-
 corecmd_exec_bin(bluetooth_helper_t)
 corecmd_exec_shell(bluetooth_helper_t)
 
+dev_read_urand(bluetooth_helper_t)
+
 domain_read_all_domains_state(bluetooth_helper_t)
 
-files_read_etc_files(bluetooth_helper_t)
 files_read_etc_runtime_files(bluetooth_helper_t)
 files_read_usr_files(bluetooth_helper_t)
 files_dontaudit_list_default(bluetooth_helper_t)
 
+term_dontaudit_use_all_ttys(bluetooth_helper_t)
+
+auth_use_nsswitch(bluetooth_helper_t)
+
 locallogin_dontaudit_use_fds(bluetooth_helper_t)
 
 logging_send_syslog_msg(bluetooth_helper_t)
 
 miscfiles_read_localization(bluetooth_helper_t)
 
-sysnet_read_config(bluetooth_helper_t)
-
 optional_policy(`
 	bluetooth_dbus_chat(bluetooth_helper_t)
 
@@ -233,9 +220,5 @@
 ')
 
 optional_policy(`
-	nscd_socket_use(bluetooth_helper_t)
-')
-
-optional_policy(`
 	xserver_user_x_domain_template(bluetooth_helper, bluetooth_helper_t, bluetooth_helper_tmpfs_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/boinc.fc refpolicy/policy/modules/contrib/boinc.fc
--- refpolicy/policy/modules/contrib/boinc.fc	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/boinc.fc	2012-09-27 20:03:30.382126498 +0200
@@ -0,0 +1,9 @@
+/etc/rc\.d/init\.d/boinc-client	--	gen_context(system_u:object_r:boinc_initrc_exec_t,s0)
+
+/usr/bin/boinc_client	--	gen_context(system_u:object_r:boinc_exec_t,s0)
+
+/var/lib/boinc(/.*)?	gen_context(system_u:object_r:boinc_var_lib_t,s0)
+/var/lib/boinc/projects(/.*)?	gen_context(system_u:object_r:boinc_project_var_lib_t,s0)
+/var/lib/boinc/slots(/.*)?	gen_context(system_u:object_r:boinc_project_var_lib_t,s0)
+
+/var/log/boinc\.log.*	--	gen_context(system_u:object_r:boinc_log_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/boinc.if refpolicy/policy/modules/contrib/boinc.if
--- refpolicy/policy/modules/contrib/boinc.if	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/boinc.if	2012-09-27 20:03:30.383126498 +0200
@@ -0,0 +1,44 @@
+## <summary>Platform for computing using volunteered resources.</summary>
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an boinc environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`boinc_admin',`
+	gen_require(`
+
+		type boinc_t, boinc_project_t, boinc_log_t;
+		type boinc_var_lib_t, boinc_tmp_t, boinc_initrc_exec_t;
+		type boinc_project_var_lib_t, boinc_project_tmp_t;
+	')
+
+	allow $1 { boinc_t boinc_project_t }:process { ptrace signal_perms };
+	ps_process_pattern($1, { boinc_t boinc_project_t })
+
+	init_labeled_script_domtrans($1, boinc_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 boinc_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	logging_search_logs($1)
+	admin_pattern($1, boinc_log_t)
+
+	files_search_tmp($1)
+	admin_pattern($1, { boinc_project_tmp_t boinc_tmp_t })
+
+	files_search_var_lib($1)
+	admin_pattern($1, { boinc_project_var_lib_t boinc_var_lib_t })
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/boinc.te refpolicy/policy/modules/contrib/boinc.te
--- refpolicy/policy/modules/contrib/boinc.te	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/boinc.te	2012-10-06 19:11:38.957742596 +0200
@@ -0,0 +1,180 @@
+policy_module(boinc, 1.0.2)
+
+########################################
+#
+# Declarations
+#
+
+type boinc_t;
+type boinc_exec_t;
+init_daemon_domain(boinc_t, boinc_exec_t)
+
+type boinc_initrc_exec_t;
+init_script_file(boinc_initrc_exec_t)
+
+type boinc_tmp_t;
+files_tmp_file(boinc_tmp_t)
+
+type boinc_tmpfs_t;
+files_tmpfs_file(boinc_tmpfs_t)
+
+type boinc_var_lib_t;
+files_type(boinc_var_lib_t)
+
+type boinc_project_var_lib_t;
+files_type(boinc_project_var_lib_t)
+
+type boinc_log_t;
+logging_log_file(boinc_log_t)
+
+type boinc_project_t;
+domain_type(boinc_project_t)
+domain_entry_file(boinc_project_t, boinc_project_var_lib_t)
+role system_r types boinc_project_t;
+
+type boinc_project_tmp_t;
+files_tmp_file(boinc_project_tmp_t)
+
+########################################
+#
+# Local policy
+#
+
+allow boinc_t self:process { setsched setpgid signull sigkill };
+allow boinc_t self:unix_stream_socket { accept listen };
+allow boinc_t self:tcp_socket { accept listen };
+allow boinc_t self:shm create_shm_perms;
+allow boinc_t self:fifo_file rw_fifo_file_perms;
+allow boinc_t self:sem create_sem_perms;
+
+manage_dirs_pattern(boinc_t, boinc_tmp_t, boinc_tmp_t)
+manage_files_pattern(boinc_t, boinc_tmp_t, boinc_tmp_t)
+files_tmp_filetrans(boinc_t, boinc_tmp_t, { dir file })
+
+manage_files_pattern(boinc_t, boinc_tmpfs_t, boinc_tmpfs_t)
+fs_tmpfs_filetrans(boinc_t, boinc_tmpfs_t, file)
+
+manage_dirs_pattern(boinc_t, boinc_var_lib_t, boinc_var_lib_t)
+manage_files_pattern(boinc_t, boinc_var_lib_t, boinc_var_lib_t)
+manage_lnk_files_pattern(boinc_t, boinc_var_lib_t, boinc_var_lib_t)
+
+# entry files to the boinc_project_t domain
+manage_dirs_pattern(boinc_t, boinc_project_var_lib_t, boinc_project_var_lib_t)
+manage_files_pattern(boinc_t, boinc_project_var_lib_t, boinc_project_var_lib_t)
+filetrans_pattern(boinc_t, boinc_var_lib_t, boinc_project_var_lib_t, dir, "slots")
+filetrans_pattern(boinc_t, boinc_var_lib_t, boinc_project_var_lib_t, dir, "projects")
+
+append_files_pattern(boinc_t, boinc_log_t, boinc_log_t)
+create_files_pattern(boinc_t, boinc_log_t, boinc_log_t)
+setattr_files_pattern(boinc_t, boinc_log_t, boinc_log_t)
+logging_log_filetrans(boinc_t, boinc_log_t, file)
+
+can_exec(boinc_t, boinc_var_lib_t)
+
+domtrans_pattern(boinc_t, boinc_project_var_lib_t, boinc_project_t)
+
+kernel_read_system_state(boinc_t)
+kernel_search_vm_sysctl(boinc_t)
+
+corenet_all_recvfrom_unlabeled(boinc_t)
+corenet_all_recvfrom_netlabel(boinc_t)
+corenet_tcp_sendrecv_generic_if(boinc_t)
+corenet_tcp_sendrecv_generic_node(boinc_t)
+corenet_tcp_bind_generic_node(boinc_t)
+
+corenet_sendrecv_boinc_client_packets(boinc_t)
+corenet_sendrecv_boinc_server_packets(boinc_t)
+corenet_tcp_bind_boinc_port(boinc_t)
+corenet_tcp_connect_boinc_port(boinc_t)
+corenet_tcp_sendrecv_boinc_port(boinc_t)
+
+corenet_sendrecv_boinc_client_server_packets(boinc_t)
+corenet_tcp_bind_boinc_client_port(boinc_t)
+corenet_tcp_sendrecv_boinc_client_port(boinc_t)
+
+corenet_sendrecv_http_client_packets(boinc_t)
+corenet_tcp_connect_http_port(boinc_t)
+corenet_tcp_sendrecv_http_port(boinc_t)
+
+corenet_sendrecv_http_cache_client_packets(boinc_t)
+corenet_tcp_connect_http_cache_port(boinc_t)
+corenet_tcp_sendrecv_http_cache_port(boinc_t)
+
+corecmd_exec_bin(boinc_t)
+corecmd_exec_shell(boinc_t)
+
+dev_read_rand(boinc_t)
+dev_read_urand(boinc_t)
+dev_read_sysfs(boinc_t)
+dev_rw_xserver_misc(boinc_t)
+
+domain_read_all_domains_state(boinc_t)
+
+files_dontaudit_getattr_boot_dirs(boinc_t)
+files_getattr_all_dirs(boinc_t)
+files_getattr_all_files(boinc_t)
+files_read_etc_files(boinc_t)
+files_read_etc_runtime_files(boinc_t)
+files_read_usr_files(boinc_t)
+
+fs_getattr_all_fs(boinc_t)
+
+term_getattr_all_ptys(boinc_t)
+term_getattr_unallocated_ttys(boinc_t)
+
+init_read_utmp(boinc_t)
+
+logging_send_syslog_msg(boinc_t)
+
+miscfiles_read_fonts(boinc_t)
+miscfiles_read_localization(boinc_t)
+
+optional_policy(`
+	mta_send_mail(boinc_t)
+')
+
+optional_policy(`
+	sysnet_dns_name_resolve(boinc_t)
+')
+
+########################################
+#
+# Project local policy
+#
+
+allow boinc_project_t self:capability { setuid setgid };
+allow boinc_project_t self:process { execmem execstack noatsecure ptrace setcap getcap setpgid setsched signal_perms };
+
+manage_dirs_pattern(boinc_project_t, boinc_project_tmp_t, boinc_project_tmp_t)
+manage_files_pattern(boinc_project_t, boinc_project_tmp_t, boinc_project_tmp_t)
+manage_sock_files_pattern(boinc_project_t, boinc_project_tmp_t, boinc_project_tmp_t)
+files_tmp_filetrans(boinc_project_t, boinc_project_tmp_t, { dir file sock_file})
+
+manage_dirs_pattern(boinc_project_t, boinc_project_var_lib_t, boinc_project_var_lib_t)
+manage_files_pattern(boinc_project_t, boinc_project_var_lib_t, boinc_project_var_lib_t)
+
+allow boinc_project_t boinc_project_var_lib_t:file execmod;
+can_exec(boinc_project_t, boinc_project_var_lib_t)
+
+allow boinc_project_t boinc_t:shm rw_shm_perms;
+allow boinc_project_t boinc_tmpfs_t:file { read write };
+
+kernel_read_kernel_sysctls(boinc_project_t)
+kernel_read_network_state(boinc_project_t)
+kernel_search_vm_sysctl(boinc_project_t)
+
+corenet_all_recvfrom_unlabeled(boinc_project_t)
+corenet_all_recvfrom_netlabel(boinc_project_t)
+corenet_tcp_sendrecv_generic_if(boinc_project_t)
+corenet_tcp_sendrecv_generic_node(boinc_project_t)
+corenet_tcp_bind_generic_node(boinc_project_t)
+
+corenet_sendrecv_boinc_client_packets(boinc_project_t)
+corenet_tcp_connect_boinc_port(boinc_project_t)
+corenet_tcp_sendrecv_boinc_port(boinc_project_t)
+
+files_dontaudit_search_home(boinc_project_t)
+
+optional_policy(`
+	java_exec(boinc_project_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/brctl.fc refpolicy/policy/modules/contrib/brctl.fc
--- refpolicy/policy/modules/contrib/brctl.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/brctl.fc	2012-09-27 20:03:30.734126498 +0200
@@ -1 +1 @@
-/usr/sbin/brctl		--	gen_context(system_u:object_r:brctl_exec_t,s0)
+/usr/sbin/brctl	--	gen_context(system_u:object_r:brctl_exec_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/brctl.if refpolicy/policy/modules/contrib/brctl.if
--- refpolicy/policy/modules/contrib/brctl.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/brctl.if	2012-09-27 20:03:30.734126498 +0200
@@ -1,4 +1,4 @@
-## <summary>Utilities for configuring the linux ethernet bridge</summary>
+## <summary>Utilities for configuring the Linux ethernet bridge.</summary>
 
 ########################################
 ## <summary>
@@ -18,3 +18,28 @@
 	corecmd_search_bin($1)
 	domtrans_pattern($1, brctl_exec_t, brctl_t)
 ')
+
+########################################
+## <summary>
+##	Execute brctl in the brctl domain, and
+##	allow the specified role the brctl domain.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed to transition.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+#
+interface(`brctl_run',`
+	gen_require(`
+		attribute_role brctl_roles;
+	')
+
+	brctl_domtrans($1)
+	roleattribute $2 brctl_roles;
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/brctl.te refpolicy/policy/modules/contrib/brctl.te
--- refpolicy/policy/modules/contrib/brctl.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/brctl.te	2012-09-27 20:03:30.735126498 +0200
@@ -1,17 +1,20 @@
-policy_module(brctl, 1.6.0)
+policy_module(brctl, 1.6.2)
 
 ########################################
 #
 # Declarations
 #
 
+attribute_role brctl_roles;
+
 type brctl_t;
 type brctl_exec_t;
 init_system_domain(brctl_t, brctl_exec_t)
+role brctl_roles types brctl_t;
 
 ########################################
 #
-# brctl local policy
+# Local policy
 #
 
 allow brctl_t self:capability net_admin;
@@ -29,7 +32,6 @@
 dev_rw_sysfs(brctl_t)
 dev_write_sysfs_dirs(brctl_t)
 
-# Init script handling
 domain_use_interactive_fds(brctl_t)
 
 files_read_etc_files(brctl_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/bugzilla.fc refpolicy/policy/modules/contrib/bugzilla.fc
--- refpolicy/policy/modules/contrib/bugzilla.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/bugzilla.fc	2012-09-27 20:03:30.735126498 +0200
@@ -1,4 +1,4 @@
 /usr/share/bugzilla(/.*)?	-d	gen_context(system_u:object_r:httpd_bugzilla_content_t,s0)
 /usr/share/bugzilla(/.*)?	--	gen_context(system_u:object_r:httpd_bugzilla_script_exec_t,s0)
 
-/var/lib/bugzilla(/.*)?			gen_context(system_u:object_r:httpd_bugzilla_rw_content_t,s0)
+/var/lib/bugzilla(/.*)?	gen_context(system_u:object_r:httpd_bugzilla_rw_content_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/bugzilla.if refpolicy/policy/modules/contrib/bugzilla.if
--- refpolicy/policy/modules/contrib/bugzilla.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/bugzilla.if	2012-09-27 20:03:30.735126498 +0200
@@ -1,9 +1,8 @@
-## <summary>Bugzilla server</summary>
+## <summary>Bugtracker.</summary>
 
 ########################################
 ## <summary>
-##	Allow the specified domain to search
-##	bugzilla directories.
+##	Search bugzilla directories.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -21,8 +20,9 @@
 
 ########################################
 ## <summary>
-##	Do not audit attempts to read and write
-##	bugzilla script unix domain stream sockets.
+##	Do not audit attempts to read and
+##	write bugzilla script unix domain
+##	stream sockets.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -40,8 +40,8 @@
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate
-##	an bugzilla environment
+##	All of the rules required to
+##	administrate an bugzilla environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -50,7 +50,7 @@
 ## </param>
 ## <param name="role">
 ##	<summary>
-##	The role to be allowed to manage the bugzilla domain.
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <rolecap/>
@@ -65,13 +65,16 @@
 	allow $1 httpd_bugzilla_script_t:process { ptrace signal_perms };
 	ps_process_pattern($1, httpd_bugzilla_script_t)
 
-	files_list_var_lib(httpd_bugzilla_script_t)
-
-	apache_list_sys_content($1)
+	files_search_usr($1)
 	admin_pattern($1, httpd_bugzilla_script_exec_t)
 	admin_pattern($1, httpd_bugzilla_script_t)
 	admin_pattern($1, httpd_bugzilla_content_t)
 	admin_pattern($1, httpd_bugzilla_htaccess_t)
-	admin_pattern($1, httpd_bugzilla_rw_content_t)
 	admin_pattern($1, httpd_bugzilla_ra_content_t)
+
+	files_search_tmp($1)
+	files_search_var_lib($1)
+	admin_pattern($1, httpd_bugzilla_rw_content_t)
+
+	apache_list_sys_content($1)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/bugzilla.te refpolicy/policy/modules/contrib/bugzilla.te
--- refpolicy/policy/modules/contrib/bugzilla.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/bugzilla.te	2012-10-15 20:34:52.346002195 +0200
@@ -1,4 +1,4 @@
-policy_module(bugzilla, 1.0.0)
+policy_module(bugzilla, 1.0.4)
 
 ########################################
 #
@@ -9,31 +9,27 @@
 
 ########################################
 #
-# bugzilla local policy
+# Local policy
 #
 
-allow httpd_bugzilla_script_t self:netlink_route_socket r_netlink_socket_perms;
-allow httpd_bugzilla_script_t self:tcp_socket create_stream_socket_perms;
-allow httpd_bugzilla_script_t self:udp_socket create_socket_perms;
+allow httpd_bugzilla_script_t self:tcp_socket { accept listen };
 
 corenet_all_recvfrom_unlabeled(httpd_bugzilla_script_t)
 corenet_all_recvfrom_netlabel(httpd_bugzilla_script_t)
 corenet_tcp_sendrecv_generic_if(httpd_bugzilla_script_t)
-corenet_udp_sendrecv_generic_if(httpd_bugzilla_script_t)
 corenet_tcp_sendrecv_generic_node(httpd_bugzilla_script_t)
-corenet_udp_sendrecv_generic_node(httpd_bugzilla_script_t)
-corenet_tcp_sendrecv_all_ports(httpd_bugzilla_script_t)
-corenet_udp_sendrecv_all_ports(httpd_bugzilla_script_t)
-corenet_tcp_connect_postgresql_port(httpd_bugzilla_script_t)
-corenet_tcp_connect_mysqld_port(httpd_bugzilla_script_t)
+
+corenet_sendrecv_http_client_packets(httpd_bugzilla_script_t)
 corenet_tcp_connect_http_port(httpd_bugzilla_script_t)
+corenet_tcp_sendrecv_http_port(httpd_bugzilla_script_t)
+
+corenet_sendrecv_smtp_client_packets(httpd_bugzilla_script_t)
 corenet_tcp_connect_smtp_port(httpd_bugzilla_script_t)
-corenet_sendrecv_postgresql_client_packets(httpd_bugzilla_script_t)
-corenet_sendrecv_mysqld_client_packets(httpd_bugzilla_script_t)
+corenet_tcp_sendrecv_smtp_port(httpd_bugzilla_script_t)
 
 files_search_var_lib(httpd_bugzilla_script_t)
 
-sysnet_read_config(httpd_bugzilla_script_t)
+sysnet_dns_name_resolve(httpd_bugzilla_script_t)
 sysnet_use_ldap(httpd_bugzilla_script_t)
 
 optional_policy(`
@@ -41,10 +37,11 @@
 ')
 
 optional_policy(`
-	mysql_search_db(httpd_bugzilla_script_t)
 	mysql_stream_connect(httpd_bugzilla_script_t)
+	mysql_tcp_connect(httpd_bugzilla_script_t)
 ')
 
 optional_policy(`
 	postgresql_stream_connect(httpd_bugzilla_script_t)
+	postgresql_tcp_connect(httpd_bugzilla_script_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/cachefilesd.fc refpolicy/policy/modules/contrib/cachefilesd.fc
--- refpolicy/policy/modules/contrib/cachefilesd.fc	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/cachefilesd.fc	2012-09-27 20:03:30.383126498 +0200
@@ -0,0 +1,9 @@
+/etc/rc\.d/init\.d/cachefilesd	--	gen_context(system_u:object_r:cachefilesd_initrc_exec_t,s0)
+
+/sbin/cachefilesd	--	gen_context(system_u:object_r:cachefilesd_exec_t,s0)
+
+/usr/sbin/cachefilesd	--	gen_context(system_u:object_r:cachefilesd_exec_t,s0)
+
+/var/cache/fscache(/.*)?	gen_context(system_u:object_r:cachefilesd_cache_t,s0)
+
+/var/run/cachefilesd\.pid	--	gen_context(system_u:object_r:cachefilesd_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/cachefilesd.if refpolicy/policy/modules/contrib/cachefilesd.if
--- refpolicy/policy/modules/contrib/cachefilesd.if	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/cachefilesd.if	2012-09-27 20:03:30.383126498 +0200
@@ -0,0 +1,39 @@
+## <summary>CacheFiles user-space management daemon.</summary>
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an cachefilesd environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`cachefilesd_admin',`
+	gen_require(`
+		type cachefilesd_t, cachefilesd_initrc_exec_t, cachefilesd_cache_t;
+		type cachefilesd_var_run_t;
+	')
+
+	allow $1 cachefilesd_t:process { ptrace signal_perms };
+	ps_process_pattern($1, cachefilesd_t)
+
+	init_labeled_script_domtrans($1, cachefilesd_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 cachefilesd_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	files_search_var($1)
+	admin_pattern($1, cachefilesd_cache_t)
+
+	files_search_pids($1)
+	admin_pattern($1, cachefilesd_var_run_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/cachefilesd.te refpolicy/policy/modules/contrib/cachefilesd.te
--- refpolicy/policy/modules/contrib/cachefilesd.te	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/cachefilesd.te	2012-10-04 19:32:33.821376442 +0200
@@ -0,0 +1,52 @@
+policy_module(cachefilesd, 1.0.1)
+
+########################################
+#
+# Declarations
+#
+
+type cachefilesd_t;
+type cachefilesd_exec_t;
+init_daemon_domain(cachefilesd_t, cachefilesd_exec_t)
+
+type cachefilesd_initrc_exec_t;
+init_script_file(cachefilesd_initrc_exec_t)
+
+type cachefilesd_cache_t;
+files_type(cachefilesd_cache_t)
+
+type cachefilesd_var_run_t;
+files_pid_file(cachefilesd_var_run_t)
+
+########################################
+#
+# Local policy
+#
+
+allow cachefilesd_t self:capability { setuid setgid sys_admin dac_override };
+
+manage_files_pattern(cachefilesd_t, cachefilesd_var_run_t, cachefilesd_var_run_t)
+files_pid_filetrans(cachefilesd_t, cachefilesd_var_run_t, file)
+
+manage_dirs_pattern(cachefilesd_t, cachefilesd_cache_t, cachefilesd_cache_t)
+manage_files_pattern(cachefilesd_t, cachefilesd_cache_t, cachefilesd_cache_t)
+
+dev_rw_cachefiles(cachefilesd_t)
+
+files_create_all_files_as(cachefilesd_t)
+files_read_etc_files(cachefilesd_t)
+
+fs_getattr_xattr_fs(cachefilesd_t)
+
+term_dontaudit_use_generic_ptys(cachefilesd_t)
+term_dontaudit_getattr_unallocated_ttys(cachefilesd_t)
+
+logging_send_syslog_msg(cachefilesd_t)
+
+miscfiles_read_localization(cachefilesd_t)
+
+init_dontaudit_use_script_ptys(cachefilesd_t)
+
+optional_policy(`
+	rpm_use_script_fds(cachefilesd_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/calamaris.fc refpolicy/policy/modules/contrib/calamaris.fc
--- refpolicy/policy/modules/contrib/calamaris.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/calamaris.fc	2012-09-27 20:03:30.735126498 +0200
@@ -1,10 +1,5 @@
-#
-# /etc
-#
-/etc/cron\.daily/calamaris --	gen_context(system_u:object_r:calamaris_exec_t,s0)
+/etc/cron\.daily/calamaris	--	gen_context(system_u:object_r:calamaris_exec_t,s0)
 
-#
-# /var
-#
 /var/log/calamaris(/.*)?	gen_context(system_u:object_r:calamaris_log_t,s0)
+
 /var/www/calamaris(/.*)?	gen_context(system_u:object_r:calamaris_www_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/calamaris.if refpolicy/policy/modules/contrib/calamaris.if
--- refpolicy/policy/modules/contrib/calamaris.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/calamaris.if	2012-09-27 20:03:30.735126498 +0200
@@ -1,8 +1,54 @@
-## <summary>Squid log analysis</summary>
+## <summary>Squid log analysis.</summary>
+
+########################################
+## <summary>
+##	Execute the calamaris in
+##	the calamaris domain.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed to transition.
+##	</summary>
+## </param>
+#
+interface(`calamaris_domtrans',`
+	gen_require(`
+		type calamaris_t, calamaris_exec_t;
+	')
+
+	files_search_etc($1)
+	domtrans_pattern($1, calamaris_exec_t, calamaris_t)
+')
+
+########################################
+## <summary>
+##	Execute calamaris in the
+##	calamaris domain, and allow the
+##	specified role the calamaris domain.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed to transition.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+#
+interface(`calamaris_run',`
+	gen_require(`
+		attribute_role calamaris_roles;
+	')
+
+	lightsquid_domtrans($1)
+	roleattribute $2 calamaris_roles;
+')
 
 #######################################
 ## <summary>
-##	Allow domain to read calamaris www files.
+##	Read calamaris www files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -19,3 +65,37 @@
 	read_files_pattern($1, calamaris_www_t, calamaris_www_t)
 	read_lnk_files_pattern($1, calamaris_www_t, calamaris_www_t)
 ')
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an calamaris environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`calamaris_admin',`
+	gen_require(`
+		type calamaris_t, calamaris_log_t, calamaris_www_t;
+	')
+
+	allow $1 calamaris_t:process { ptrace signal_perms };
+	ps_process_pattern($1, calamaris_t)
+
+	calamaris_run($1, $2)
+
+	logging_list_logs($1)
+	admin_pattern($1, calamaris_log_t)
+
+	apache_list_sys_content($1)
+	admin_pattern($1, calamaris_www_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/calamaris.te refpolicy/policy/modules/contrib/calamaris.te
--- refpolicy/policy/modules/contrib/calamaris.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/calamaris.te	2012-09-27 20:03:30.735126498 +0200
@@ -1,59 +1,49 @@
-policy_module(calamaris, 1.7.0)
+policy_module(calamaris, 1.7.2)
 
 ########################################
 #
 # Declarations
 #
 
+attribute_role calamaris_roles;
+
 type calamaris_t;
 type calamaris_exec_t;
-init_system_domain(calamaris_t, calamaris_exec_t)
-
-type calamaris_www_t;
-files_type(calamaris_www_t)
+application_domain(calamaris_t, calamaris_exec_t)
+role calamaris_roles types calamaris_t;
 
 type calamaris_log_t;
 logging_log_file(calamaris_log_t)
 
+type calamaris_www_t;
+files_type(calamaris_www_t)
+
 ########################################
 #
 # Local policy
 #
 
-# for when squid has a different UID
 allow calamaris_t self:capability dac_override;
-allow calamaris_t self:process { fork signal_perms setsched };
+allow calamaris_t self:process { signal_perms setsched };
 allow calamaris_t self:fifo_file rw_fifo_file_perms;
-allow calamaris_t self:unix_stream_socket create_stream_socket_perms;
-allow calamaris_t self:tcp_socket create_stream_socket_perms;
-allow calamaris_t self:udp_socket create_socket_perms;
+allow calamaris_t self:unix_stream_socket { accept listen };
+allow calamaris_t self:tcp_socket { accept listen };
+
+manage_dirs_pattern(calamaris_t, calamaris_log_t, calamaris_log_t)
+manage_files_pattern(calamaris_t, calamaris_log_t, calamaris_log_t)
+logging_log_filetrans(calamaris_t, calamaris_log_t, { dir file })
 
 manage_files_pattern(calamaris_t, calamaris_www_t, calamaris_www_t)
 manage_lnk_files_pattern(calamaris_t, calamaris_www_t, calamaris_www_t)
 
-manage_files_pattern(calamaris_t, calamaris_log_t, calamaris_log_t)
-logging_log_filetrans(calamaris_t, calamaris_log_t, { file dir })
-
 kernel_read_all_sysctls(calamaris_t)
 kernel_read_system_state(calamaris_t)
 
 corecmd_exec_bin(calamaris_t)
 
-corenet_all_recvfrom_unlabeled(calamaris_t)
-corenet_all_recvfrom_netlabel(calamaris_t)
-corenet_tcp_sendrecv_generic_if(calamaris_t)
-corenet_udp_sendrecv_generic_if(calamaris_t)
-corenet_tcp_sendrecv_generic_node(calamaris_t)
-corenet_udp_sendrecv_generic_node(calamaris_t)
-corenet_tcp_sendrecv_all_ports(calamaris_t)
-corenet_udp_sendrecv_all_ports(calamaris_t)
-
 dev_read_urand(calamaris_t)
 
-files_search_pids(calamaris_t)
-files_read_etc_files(calamaris_t)
 files_read_usr_files(calamaris_t)
-files_read_var_files(calamaris_t)
 files_read_etc_runtime_files(calamaris_t)
 
 libs_read_lib_files(calamaris_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/callweaver.fc refpolicy/policy/modules/contrib/callweaver.fc
--- refpolicy/policy/modules/contrib/callweaver.fc	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/callweaver.fc	2012-09-27 20:03:30.383126498 +0200
@@ -0,0 +1,11 @@
+/etc/rc\.d/init\.d/callweaver	--	gen_context(system_u:object_r:callweaver_initrc_exec_t,s0)
+
+/usr/sbin/callweaver	--	gen_context(system_u:object_r:callweaver_exec_t,s0)
+
+/var/lib/callweaver(/.*)?	gen_context(system_u:object_r:callweaver_var_lib_t,s0)
+
+/var/log/callweaver(/.*)?	gen_context(system_u:object_r:callweaver_log_t,s0)
+
+/var/run/callweaver(/.*)?	gen_context(system_u:object_r:callweaver_var_run_t,s0)
+
+/var/spool/callweaver(/.*)?	gen_context(system_u:object_r:callweaver_spool_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/callweaver.if refpolicy/policy/modules/contrib/callweaver.if
--- refpolicy/policy/modules/contrib/callweaver.if	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/callweaver.if	2012-10-10 21:47:43.789027923 +0200
@@ -0,0 +1,81 @@
+## <summary>PBX software.</summary>
+
+########################################
+## <summary>
+##	Execute callweaver in the caller domain.
+## </summary>
+## <param name="domain">
+## <summary>
+##	Domain allowed access.
+## </summary>
+## </param>
+#
+interface(`callweaver_exec',`
+	gen_require(`
+		type callweaver_exec_t;
+	')
+
+	corecmd_search_bin($1)
+	can_exec($1, callweaver_exec_t)
+')
+
+########################################
+## <summary>
+##	Connect to callweaver over a
+##	unix stream socket.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`callweaver_stream_connect',`
+	gen_require(`
+		type callweaver_t, callweaver_var_run_t;
+	')
+
+	files_search_pids($1)
+	stream_connect_pattern($1, callweaver_var_run_t, callweaver_var_run_t, callweaver_t)
+')
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an callweaver environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`callweaver_admin',`
+	gen_require(`
+		type callweaver_t, callweaver_initrc_exec_t, callweaver_log_t;
+		type callweaver_var_lib_t, callweaver_var_run_t, callweaver_spool_t;
+	')
+
+	allow $1 callweaver_t:process { ptrace signal_perms };
+	ps_process_pattern($1, callweaver_t)
+
+	init_labeled_script_domtrans($1, callweaver_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 callweaver_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	logging_search_logs($1)
+	admin_pattern($1, callweaver_log_t)
+
+	files_search_pids($1)
+	admin_pattern($1, callweaver_var_run_t)
+
+	files_search_var_lib($1)
+	admin_pattern($1, { callweaver_spool_t callweaver_var_lib_t })
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/callweaver.te refpolicy/policy/modules/contrib/callweaver.te
--- refpolicy/policy/modules/contrib/callweaver.te	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/callweaver.te	2012-10-10 21:47:43.796027923 +0200
@@ -0,0 +1,87 @@
+policy_module(callweaver, 1.0.2)
+
+########################################
+#
+# Declarations
+#
+
+type callweaver_t;
+type callweaver_exec_t;
+init_daemon_domain(callweaver_t, callweaver_exec_t)
+
+type callweaver_initrc_exec_t;
+init_script_file(callweaver_initrc_exec_t)
+
+type callweaver_log_t;
+logging_log_file(callweaver_log_t)
+
+type callweaver_var_lib_t;
+files_type(callweaver_var_lib_t)
+
+type callweaver_var_run_t;
+files_pid_file(callweaver_var_run_t)
+
+type callweaver_spool_t;
+files_type(callweaver_spool_t)
+
+########################################
+#
+# Local policy
+#
+
+allow callweaver_t self:capability { setuid sys_nice setgid };
+allow callweaver_t self:process { setsched signal };
+allow callweaver_t self:fifo_file rw_fifo_file_perms;
+allow callweaver_t self:tcp_socket { accept listen };
+allow callweaver_t self:unix_stream_socket create_stream_socket_perms;
+
+manage_dirs_pattern(callweaver_t, callweaver_log_t, callweaver_log_t)
+append_files_pattern(callweaver_t, callweaver_log_t, callweaver_log_t)
+create_files_pattern(callweaver_t, callweaver_log_t, callweaver_log_t)
+setattr_files_pattern(callweaver_t, callweaver_log_t, callweaver_log_t)
+logging_log_filetrans(callweaver_t, callweaver_log_t, { dir file })
+
+manage_dirs_pattern(callweaver_t, callweaver_var_lib_t, callweaver_var_lib_t)
+manage_files_pattern(callweaver_t, callweaver_var_lib_t, callweaver_var_lib_t)
+files_var_lib_filetrans(callweaver_t, callweaver_var_lib_t, { dir file })
+
+manage_dirs_pattern(callweaver_t, callweaver_var_run_t, callweaver_var_run_t)
+manage_files_pattern(callweaver_t, callweaver_var_run_t, callweaver_var_run_t)
+manage_sock_files_pattern(callweaver_t, callweaver_var_run_t, callweaver_var_run_t)
+files_pid_filetrans(callweaver_t, callweaver_var_run_t, { dir file sock_file })
+
+manage_dirs_pattern(callweaver_t, callweaver_spool_t, callweaver_spool_t)
+manage_files_pattern(callweaver_t, callweaver_spool_t, callweaver_spool_t)
+manage_lnk_files_pattern(callweaver_t, callweaver_spool_t, callweaver_spool_t)
+files_spool_filetrans(callweaver_t, callweaver_spool_t, { dir file })
+
+kernel_read_kernel_sysctls(callweaver_t)
+kernel_read_sysctl(callweaver_t)
+
+corenet_all_recvfrom_unlabeled(callweaver_t)
+corenet_all_recvfrom_netlabel(callweaver_t)
+corenet_udp_sendrecv_generic_if(callweaver_t)
+corenet_udp_sendrecv_generic_node(callweaver_t)
+corenet_udp_sendrecv_all_ports(callweaver_t)
+corenet_udp_bind_generic_node(callweaver_t)
+
+corenet_sendrecv_asterisk_server_packets(callweaver_t)
+corenet_udp_bind_asterisk_port(callweaver_t)
+
+corenet_sendrecv_generic_server_packets(callweaver_t)
+corenet_udp_bind_generic_port(callweaver_t)
+
+corenet_sendrecv_sip_server_packets(callweaver_t)
+corenet_udp_bind_sip_port(callweaver_t)
+
+dev_manage_generic_symlinks(callweaver_t)
+
+domain_use_interactive_fds(callweaver_t)
+
+term_getattr_pty_fs(callweaver_t)
+term_use_generic_ptys(callweaver_t)
+term_use_ptmx(callweaver_t)
+
+auth_use_nsswitch(callweaver_t)
+
+miscfiles_read_localization(callweaver_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/canna.fc refpolicy/policy/modules/contrib/canna.fc
--- refpolicy/policy/modules/contrib/canna.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/canna.fc	2012-09-27 20:03:30.736126498 +0200
@@ -1,23 +1,17 @@
-/etc/rc\.d/init\.d/canna --	gen_context(system_u:object_r:canna_initrc_exec_t,s0)
+/etc/rc\.d/init\.d/canna	--	gen_context(system_u:object_r:canna_initrc_exec_t,s0)
 
-#
-# /usr
-#
 /usr/bin/cannaping	--	gen_context(system_u:object_r:canna_exec_t,s0)
-/usr/bin/catdic		--	gen_context(system_u:object_r:canna_exec_t,s0)
+/usr/bin/catdic	--	gen_context(system_u:object_r:canna_exec_t,s0)
 
 /usr/sbin/cannaserver	--	gen_context(system_u:object_r:canna_exec_t,s0)
 /usr/sbin/jserver	--	gen_context(system_u:object_r:canna_exec_t,s0)
 
-#
-# /var
-#
 /var/lib/canna/dic(/.*)?	gen_context(system_u:object_r:canna_var_lib_t,s0)
-/var/lib/wnn/dic(/.*)?		gen_context(system_u:object_r:canna_var_lib_t,s0)
+/var/lib/wnn/dic(/.*)?	gen_context(system_u:object_r:canna_var_lib_t,s0)
 
-/var/log/canna(/.*)?		gen_context(system_u:object_r:canna_log_t,s0)
-/var/log/wnn(/.*)?		gen_context(system_u:object_r:canna_log_t,s0)
+/var/log/canna(/.*)?	gen_context(system_u:object_r:canna_log_t,s0)
+/var/log/wnn(/.*)?	gen_context(system_u:object_r:canna_log_t,s0)
 
 /var/run/\.iroha_unix	-d	gen_context(system_u:object_r:canna_var_run_t,s0)
-/var/run/\.iroha_unix/.* -s	gen_context(system_u:object_r:canna_var_run_t,s0)
-/var/run/wnn-unix(/.*)		gen_context(system_u:object_r:canna_var_run_t,s0)
+/var/run/\.iroha_unix/.*	-s	gen_context(system_u:object_r:canna_var_run_t,s0)
+/var/run/wnn-unix(/.*)	gen_context(system_u:object_r:canna_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/canna.if refpolicy/policy/modules/contrib/canna.if
--- refpolicy/policy/modules/contrib/canna.if	2012-05-04 15:16:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/canna.if	2012-09-27 20:03:30.736126498 +0200
@@ -1,8 +1,9 @@
-## <summary>Canna - kana-kanji conversion server</summary>
+## <summary>Kana-kanji conversion server.</summary>
 
 ########################################
 ## <summary>
-##	Connect to Canna using a unix domain stream socket.
+##	Connect to Canna using a unix
+##	domain stream socket.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -21,8 +22,8 @@
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate 
-##	an canna environment
+##	All of the rules required to
+##	administrate an canna environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -31,7 +32,7 @@
 ## </param>
 ## <param name="role">
 ##	<summary>
-##	The role to be allowed to manage the canna domain.
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <rolecap/>
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/canna.te refpolicy/policy/modules/contrib/canna.te
--- refpolicy/policy/modules/contrib/canna.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/canna.te	2012-09-27 20:03:30.736126498 +0200
@@ -1,4 +1,4 @@
-policy_module(canna, 1.11.0)
+policy_module(canna, 1.11.1)
 
 ########################################
 #
@@ -29,13 +29,15 @@
 allow canna_t self:capability { setgid setuid net_bind_service };
 dontaudit canna_t self:capability sys_tty_config;
 allow canna_t self:process signal_perms;
-allow canna_t self:unix_stream_socket { connectto create_stream_socket_perms};
-allow canna_t self:unix_dgram_socket create_stream_socket_perms;
+allow canna_t self:unix_stream_socket { accept connectto listen };
+allow canna_t self:unix_dgram_socket { accept listen };
 allow canna_t self:tcp_socket create_stream_socket_perms;
 
-manage_files_pattern(canna_t, canna_log_t, canna_log_t)
-allow canna_t canna_log_t:dir setattr;
-logging_log_filetrans(canna_t, canna_log_t, { file dir })
+allow canna_t canna_log_t:dir setattr_dir_perms;
+append_files_pattern(canna_t, canna_log_t, canna_log_t)
+create_files_pattern(canna_t, canna_log_t, canna_log_t)
+setattr_files_pattern(canna_t, canna_log_t, canna_log_t)
+logging_log_filetrans(canna_t, canna_log_t, file)
 
 manage_dirs_pattern(canna_t, canna_var_lib_t, canna_var_lib_t)
 manage_files_pattern(canna_t, canna_var_lib_t, canna_var_lib_t)
@@ -45,7 +47,7 @@
 manage_dirs_pattern(canna_t, canna_var_run_t, canna_var_run_t)
 manage_files_pattern(canna_t, canna_var_run_t, canna_var_run_t)
 manage_sock_files_pattern(canna_t, canna_var_run_t, canna_var_run_t)
-files_pid_filetrans(canna_t, canna_var_run_t, { dir file sock_file })
+files_pid_filetrans(canna_t, canna_var_run_t, { dir sock_file })
 
 kernel_read_kernel_sysctls(canna_t)
 kernel_read_system_state(canna_t)
@@ -54,9 +56,10 @@
 corenet_all_recvfrom_netlabel(canna_t)
 corenet_tcp_sendrecv_generic_if(canna_t)
 corenet_tcp_sendrecv_generic_node(canna_t)
-corenet_tcp_sendrecv_all_ports(canna_t)
-corenet_tcp_connect_all_ports(canna_t)
+
 corenet_sendrecv_all_client_packets(canna_t)
+corenet_tcp_connect_all_ports(canna_t)
+corenet_tcp_sendrecv_all_ports(canna_t)
 
 dev_read_sysfs(canna_t)
 
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/ccs.fc refpolicy/policy/modules/contrib/ccs.fc
--- refpolicy/policy/modules/contrib/ccs.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/ccs.fc	2012-09-27 20:03:30.736126498 +0200
@@ -1,6 +1,14 @@
-/etc/cluster(/.*)?		gen_context(system_u:object_r:cluster_conf_t,s0)
+/etc/cluster(/.*)?	gen_context(system_u:object_r:cluster_conf_t,s0)
 
-/sbin/ccsd		--	gen_context(system_u:object_r:ccs_exec_t,s0)
+/etc/rc\.d/init\.d/((ccs)|(ccsd))	--	gen_context(system_u:object_r:ccs_initrc_exec_t,s0)
 
-/var/run/cluster/ccsd\.pid --	gen_context(system_u:object_r:ccs_var_run_t,s0)
-/var/run/cluster/ccsd\.sock -s	gen_context(system_u:object_r:ccs_var_run_t,s0)
+/sbin/ccsd	--	gen_context(system_u:object_r:ccs_exec_t,s0)
+
+/usr/sbin/ccsd	--	gen_context(system_u:object_r:ccs_exec_t,s0)
+
+/var/lib/cluster/((ccs)|(ccsd)).*	gen_context(system_u:object_r:ccs_var_lib_t,s0)
+
+/var/log/cluster/((ccs)|(ccsd)).*	gen_context(system_u:object_r:ccs_var_log_t,s0)
+
+/var/run/cluster/((ccs)|(ccsd))\.pid	--	gen_context(system_u:object_r:ccs_var_run_t,s0)
+/var/run/cluster/((ccs)|(ccsd))\.sock	-s	gen_context(system_u:object_r:ccs_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/ccs.if refpolicy/policy/modules/contrib/ccs.if
--- refpolicy/policy/modules/contrib/ccs.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/ccs.if	2012-09-27 20:03:30.736126498 +0200
@@ -1,4 +1,4 @@
-## <summary>Cluster Configuration System</summary>
+## <summary>Cluster Configuration System.</summary>
 
 ########################################
 ## <summary>
@@ -15,6 +15,7 @@
 		type ccs_t, ccs_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, ccs_exec_t, ccs_t)
 ')
 
@@ -52,12 +53,14 @@
 		type cluster_conf_t;
 	')
 
+	files_search_etc($1)
 	read_files_pattern($1, cluster_conf_t, cluster_conf_t)
 ')
 
 ########################################
 ## <summary>
-##	Manage cluster configuration files.
+##	Create, read, write, and delete
+##	cluster configuration files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -70,6 +73,55 @@
 		type cluster_conf_t;
 	')
 
+	files_search_etc($1)
 	manage_dirs_pattern($1, cluster_conf_t, cluster_conf_t)
 	manage_files_pattern($1, cluster_conf_t, cluster_conf_t)
 ')
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an ccs environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`ccs_admin',`
+	gen_require(`
+		type ccs_t, ccs_initrc_exec_t, cluster_conf_t;
+		type ccs_var_lib_t_t, ccs_var_log_t;
+		type ccs_var_run_t, ccs_tmp_t;
+	')
+
+	allow $1 ccs_t:process { ptrace signal_perms };
+	ps_process_pattern($1, ccs_t)
+
+	init_labeled_script_domtrans($1, ccs_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 ccs_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	files_search_etc($1)
+	admin_pattern($1, ccs_conf_t)
+
+	files_search_var_lib($1)
+	admin_pattern($1, ccs_var_lib_t)
+
+	logging_search_logs($1)
+	admin_pattern($1, ccs_var_log_t)
+
+	files_search_pids($1)
+	admin_pattern($1, ccs_var_run_t)
+
+	files_search_tmp($1)
+	admin_pattern($1, ccs_tmp_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/ccs.te refpolicy/policy/modules/contrib/ccs.te
--- refpolicy/policy/modules/contrib/ccs.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/ccs.te	2012-10-06 19:01:40.757741319 +0200
@@ -1,4 +1,4 @@
-policy_module(ccs, 1.5.0)
+policy_module(ccs, 1.5.2)
 
 ########################################
 #
@@ -9,8 +9,11 @@
 type ccs_exec_t;
 init_daemon_domain(ccs_t, ccs_exec_t)
 
+type ccs_initrc_exec_t;
+init_script_file(ccs_initrc_exec_t)
+
 type cluster_conf_t;
-files_type(cluster_conf_t)
+files_config_file(cluster_conf_t)
 
 type ccs_tmp_t;
 files_tmp_file(ccs_tmp_t)
@@ -29,48 +32,43 @@
 
 ########################################
 #
-# ccs local policy
+# Local policy
 #
 
 allow ccs_t self:capability { ipc_owner ipc_lock sys_nice sys_resource sys_admin };
 allow ccs_t self:process { signal setrlimit setsched };
 dontaudit ccs_t self:process ptrace;
 allow ccs_t self:fifo_file rw_fifo_file_perms;
-allow ccs_t self:unix_stream_socket { connectto create_stream_socket_perms };
-allow ccs_t self:unix_dgram_socket create_socket_perms;
-allow ccs_t self:netlink_route_socket r_netlink_socket_perms;
-allow ccs_t self:tcp_socket create_stream_socket_perms;
-allow ccs_t self:udp_socket { create_socket_perms listen recv_msg send_msg };
-# cjp: this needs to be fixed to be specific
+allow ccs_t self:unix_stream_socket { accept connectto listen };
+allow ccs_t self:tcp_socket { accept listen };
+allow ccs_t self:udp_socket { accept listen recv_msg send_msg };
 allow ccs_t self:socket create_socket_perms;
 
 manage_files_pattern(ccs_t, cluster_conf_t, cluster_conf_t)
 
-# tmp file
 allow ccs_t ccs_tmp_t:dir manage_dir_perms;
 manage_dirs_pattern(ccs_t, ccs_tmp_t, ccs_tmp_t)
 manage_files_pattern(ccs_t, ccs_tmp_t, ccs_tmp_t)
-files_tmp_filetrans(ccs_t, ccs_tmp_t, { file dir })
+files_tmp_filetrans(ccs_t, ccs_tmp_t, { dir file })
 
 manage_dirs_pattern(ccs_t, ccs_tmpfs_t, ccs_tmpfs_t)
 manage_files_pattern(ccs_t, ccs_tmpfs_t, ccs_tmpfs_t)
 fs_tmpfs_filetrans(ccs_t, ccs_tmpfs_t, { dir file })
 
-# var lib files
 manage_dirs_pattern(ccs_t, ccs_var_lib_t, ccs_var_lib_t)
 manage_files_pattern(ccs_t, ccs_var_lib_t, ccs_var_lib_t)
-files_var_lib_filetrans(ccs_t, ccs_var_lib_t, { file dir })
+files_var_lib_filetrans(ccs_t, ccs_var_lib_t, { dir file })
 
-allow ccs_t ccs_var_log_t:dir setattr;
-manage_files_pattern(ccs_t, ccs_var_log_t, ccs_var_log_t)
+allow ccs_t ccs_var_log_t:dir setattr_dir_perms;
+append_files_pattern(ccs_t, ccs_var_log_t, ccs_var_log_t)
+create_files_pattern(ccs_t, ccs_var_log_t, ccs_var_log_t)
+setattr_files_pattern(ccs_t, ccs_var_log_t, ccs_var_log_t)
 manage_sock_files_pattern(ccs_t, ccs_var_log_t, ccs_var_log_t)
-logging_log_filetrans(ccs_t, ccs_var_log_t, { sock_file file dir })
+logging_log_filetrans(ccs_t, ccs_var_log_t, { file sock_file })
 
-# pid file
-manage_dirs_pattern(ccs_t, ccs_var_run_t, ccs_var_run_t)
 manage_files_pattern(ccs_t, ccs_var_run_t, ccs_var_run_t)
 manage_sock_files_pattern(ccs_t, ccs_var_run_t, ccs_var_run_t)
-files_pid_filetrans(ccs_t, ccs_var_run_t, { dir file sock_file })
+files_pid_filetrans(ccs_t, ccs_var_run_t, { file sock_file })
 
 kernel_read_kernel_sysctls(ccs_t)
 
@@ -83,12 +81,16 @@
 corenet_udp_sendrecv_generic_if(ccs_t)
 corenet_tcp_sendrecv_generic_node(ccs_t)
 corenet_udp_sendrecv_generic_node(ccs_t)
-corenet_tcp_sendrecv_all_ports(ccs_t)
-corenet_udp_sendrecv_all_ports(ccs_t)
 corenet_tcp_bind_generic_node(ccs_t)
 corenet_udp_bind_generic_node(ccs_t)
+
+corenet_sendrecv_cluster_server_packets(ccs_t)
 corenet_tcp_bind_cluster_port(ccs_t)
+corenet_tcp_sendrecv_cluster_port(ccs_t)
 corenet_udp_bind_cluster_port(ccs_t)
+corenet_udp_sendrecv_cluster_port(ccs_t)
+
+corenet_sendrecv_netsupport_server_packets(ccs_t)
 corenet_udp_bind_netsupport_port(ccs_t)
 
 dev_read_urand(ccs_t)
@@ -107,7 +109,7 @@
 userdom_manage_unpriv_user_shared_mem(ccs_t)
 userdom_manage_unpriv_user_semaphores(ccs_t)
 
-ifdef(`hide_broken_symptoms', `
+ifdef(`hide_broken_symptoms',`
 	corecmd_dontaudit_write_bin_dirs(ccs_t)
 	files_manage_isid_type_files(ccs_t)
 ')
@@ -118,5 +120,10 @@
 ')
 
 optional_policy(`
+	qpidd_rw_semaphores(ccs_t)
+	qpidd_rw_shm(ccs_t)
+')
+
+optional_policy(`
 	unconfined_use_fds(ccs_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/cdrecord.fc refpolicy/policy/modules/contrib/cdrecord.fc
--- refpolicy/policy/modules/contrib/cdrecord.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/cdrecord.fc	2012-09-27 20:03:30.737126498 +0200
@@ -1,6 +1,3 @@
-#
-# /usr
-#
 /usr/bin/cdrecord	--	gen_context(system_u:object_r:cdrecord_exec_t,s0)
 /usr/bin/growisofs	--	gen_context(system_u:object_r:cdrecord_exec_t,s0)
-/usr/bin/wodim		--	gen_context(system_u:object_r:cdrecord_exec_t,s0)
+/usr/bin/wodim	--	gen_context(system_u:object_r:cdrecord_exec_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/cdrecord.if refpolicy/policy/modules/contrib/cdrecord.if
--- refpolicy/policy/modules/contrib/cdrecord.if	2012-05-04 15:16:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/cdrecord.if	2012-10-02 20:07:29.217012081 +0200
@@ -1,33 +1,32 @@
-## <summary>Policy for cdrecord</summary>
+## <summary>Record audio or data Compact Discs from a master.</summary>
 
 ########################################
 ## <summary>
-##	Role access for cdrecord
+##	Role access for cdrecord.
 ## </summary>
 ## <param name="role">
 ##	<summary>
-##	Role allowed access
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <param name="domain">
 ##	<summary>
-##	User domain for the role
+##	User domain for the role.
 ##	</summary>
 ## </param>
 #
 interface(`cdrecord_role',`
 	gen_require(`
+		attribute_role cdrecord_roles;
 		type cdrecord_t, cdrecord_exec_t;
 	')
 
-	role $1 types cdrecord_t;
+	roleattribute $1 cdrecord_roles;
 
-	# Transition from the user domain to the derived domain.
 	domtrans_pattern($2, cdrecord_exec_t, cdrecord_t)
 
-	allow cdrecord_t $2:unix_stream_socket { getattr read write ioctl };
+	allow cdrecord_t $2:unix_stream_socket rw_socket_perms;
 
-	# allow ps to show cdrecord and allow the user to kill it 
+	allow $2 cdrecord_t:process { ptrace signal_perms };
 	ps_process_pattern($2, cdrecord_t)
-	allow $2 cdrecord_t:process signal;
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/cdrecord.te refpolicy/policy/modules/contrib/cdrecord.te
--- refpolicy/policy/modules/contrib/cdrecord.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/cdrecord.te	2012-09-27 20:03:30.737126498 +0200
@@ -1,4 +1,4 @@
-policy_module(cdrecord, 2.5.0)
+policy_module(cdrecord, 2.5.2)
 
 ########################################
 #
@@ -6,19 +6,23 @@
 #
 
 ## <desc>
-## <p>
-## Allow cdrecord to read various content.
-## nfs, samba, removable devices, user temp
-## and untrusted content files
-## </p>
+##	<p>
+##	Determine whether cdrecord can read
+##	various content. nfs, samba, removable
+##	devices, user temp and untrusted
+##	content files
+##	</p>
 ## </desc>
 gen_tunable(cdrecord_read_content, false)
 
+attribute_role cdrecord_roles;
+
 type cdrecord_t;
 type cdrecord_exec_t;
 typealias cdrecord_t alias { user_cdrecord_t staff_cdrecord_t sysadm_cdrecord_t };
 typealias cdrecord_t alias { auditadm_cdrecord_t secadm_cdrecord_t };
 userdom_user_application_domain(cdrecord_t, cdrecord_exec_t)
+role cdrecord_roles types cdrecord_t;
 
 ########################################
 #
@@ -27,13 +31,10 @@
 
 allow cdrecord_t self:capability { ipc_lock sys_nice setuid dac_override sys_rawio };
 allow cdrecord_t self:process { getcap getsched setrlimit setsched sigkill };
-allow cdrecord_t self:unix_dgram_socket create_socket_perms;
-allow cdrecord_t self:unix_stream_socket create_stream_socket_perms;
+allow cdrecord_t self:unix_stream_socket { accept listen };
 
-# growisofs uses mkisofs
 corecmd_exec_bin(cdrecord_t)
 
-# allow searching for cdrom-drive
 dev_list_all_dev_nodes(cdrecord_t)
 dev_read_sysfs(cdrecord_t)
 
@@ -45,7 +46,6 @@
 term_use_controlling_term(cdrecord_t)
 term_list_ptys(cdrecord_t)
 
-# allow cdrecord to write the CD
 storage_raw_read_removable_device(cdrecord_t)
 storage_raw_write_removable_device(cdrecord_t)
 storage_write_scsi_generic(cdrecord_t)
@@ -54,24 +54,21 @@
 
 miscfiles_read_localization(cdrecord_t)
 
-# write to the user domain tty.
 userdom_use_user_terminals(cdrecord_t)
 userdom_read_user_home_content_files(cdrecord_t)
 
-# Handle nfs home dirs
 tunable_policy(`cdrecord_read_content && use_nfs_home_dirs',`
 	fs_list_auto_mountpoints(cdrecord_t)
 	files_list_home(cdrecord_t)
 	fs_read_nfs_files(cdrecord_t)
 	fs_read_nfs_symlinks(cdrecord_t)
-
 ',`
 	files_dontaudit_list_home(cdrecord_t)
 	fs_dontaudit_list_auto_mountpoints(cdrecord_t)
 	fs_dontaudit_read_nfs_files(cdrecord_t)
 	fs_dontaudit_list_nfs(cdrecord_t)
 ')
-# Handle samba home dirs
+
 tunable_policy(`cdrecord_read_content && use_samba_home_dirs',`
 	fs_list_auto_mountpoints(cdrecord_t)
 	files_list_home(cdrecord_t)
@@ -84,7 +81,6 @@
 	fs_dontaudit_list_cifs(cdrecord_t)
 ')
 
-# Handle removable media, /tmp, and /home
 tunable_policy(`cdrecord_read_content',`
 	userdom_list_user_tmp(cdrecord_t)
 	userdom_read_user_tmp_files(cdrecord_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/certmaster.fc refpolicy/policy/modules/contrib/certmaster.fc
--- refpolicy/policy/modules/contrib/certmaster.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/certmaster.fc	2012-09-27 20:03:30.737126498 +0200
@@ -1,8 +1,11 @@
-/etc/certmaster(/.*)?			gen_context(system_u:object_r:certmaster_etc_rw_t,s0)
+/etc/certmaster(/.*)?	gen_context(system_u:object_r:certmaster_etc_rw_t,s0)
+
 /etc/rc\.d/init\.d/certmaster	--	gen_context(system_u:object_r:certmaster_initrc_exec_t,s0)
 
-/usr/bin/certmaster		--	gen_context(system_u:object_r:certmaster_exec_t,s0)
+/usr/bin/certmaster	--	gen_context(system_u:object_r:certmaster_exec_t,s0)
+
+/var/lib/certmaster(/.*)?	gen_context(system_u:object_r:certmaster_var_lib_t,s0)
+
+/var/log/certmaster(/.*)?	gen_context(system_u:object_r:certmaster_var_log_t,s0)
 
-/var/lib/certmaster(/.*)?		gen_context(system_u:object_r:certmaster_var_lib_t,s0)
-/var/log/certmaster(/.*)?		gen_context(system_u:object_r:certmaster_var_log_t,s0)
-/var/run/certmaster.*			gen_context(system_u:object_r:certmaster_var_run_t,s0)
+/var/run/certmaster.*	gen_context(system_u:object_r:certmaster_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/certmaster.if refpolicy/policy/modules/contrib/certmaster.if
--- refpolicy/policy/modules/contrib/certmaster.if	2012-05-04 15:16:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/certmaster.if	2012-09-27 20:03:30.737126498 +0200
@@ -1,4 +1,4 @@
-## <summary>Certmaster SSL certificate distribution service</summary>
+## <summary>Remote certificate distribution framework.</summary>
 
 ########################################
 ## <summary>
@@ -15,6 +15,7 @@
 		type certmaster_t, certmaster_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, certmaster_exec_t, certmaster_t)
 ')
 
@@ -58,7 +59,7 @@
 
 #######################################
 ## <summary>
-##	Append to certmaster logs.
+##	Append certmaster log files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -78,7 +79,7 @@
 #######################################
 ## <summary>
 ##	Create, read, write, and delete
-##	certmaster logs.
+##	certmaster log content.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -98,8 +99,8 @@
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate
-##	an snort environment
+##	All of the rules required to
+##	administrate an certmaster environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -108,7 +109,7 @@
 ## </param>
 ## <param name="role">
 ##	<summary>
-##	The role to be allowed to manage the syslog domain.
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <rolecap/>
@@ -129,7 +130,7 @@
 	allow $2 system_r;
 
 	files_list_etc($1)
-	miscfiles_manage_generic_cert_dirs($1)	
+	miscfiles_manage_generic_cert_dirs($1)
 	miscfiles_manage_generic_cert_files($1)	
 
 	admin_pattern($1, certmaster_etc_rw_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/certmaster.te refpolicy/policy/modules/contrib/certmaster.te
--- refpolicy/policy/modules/contrib/certmaster.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/certmaster.te	2012-09-27 20:03:30.738126498 +0200
@@ -1,4 +1,4 @@
-policy_module(certmaster, 1.2.0)
+policy_module(certmaster, 1.2.1)
 
 ########################################
 #
@@ -26,46 +26,50 @@
 
 ###########################################
 #
-# certmaster local policy
+# Local policy
 #
 
 allow certmaster_t self:capability { dac_read_search dac_override sys_tty_config };
-allow certmaster_t self:tcp_socket create_stream_socket_perms;
+allow certmaster_t self:tcp_socket { accept listen };
 
-# config files
 list_dirs_pattern(certmaster_t, certmaster_etc_rw_t, certmaster_etc_rw_t)
 manage_files_pattern(certmaster_t, certmaster_etc_rw_t, certmaster_etc_rw_t)
 
-# var/lib files for certmaster
 manage_files_pattern(certmaster_t, certmaster_var_lib_t, certmaster_var_lib_t)
 manage_dirs_pattern(certmaster_t, certmaster_var_lib_t, certmaster_var_lib_t)
-files_var_lib_filetrans(certmaster_t, certmaster_var_lib_t, { file dir })
+files_var_lib_filetrans(certmaster_t, certmaster_var_lib_t, { dir file })
 
-# log files
-manage_files_pattern(certmaster_t, certmaster_var_log_t, certmaster_var_log_t)
+append_files_pattern(certmaster_t, certmaster_var_log_t, certmaster_var_log_t)
+create_files_pattern(certmaster_t, certmaster_var_log_t, certmaster_var_log_t)
+setattr_files_pattern(certmaster_t, certmaster_var_log_t, certmaster_var_log_t)
 logging_log_filetrans(certmaster_t, certmaster_var_log_t, file )
 
-# pid file
 manage_files_pattern(certmaster_t, certmaster_var_run_t, certmaster_var_run_t)
 manage_sock_files_pattern(certmaster_t, certmaster_var_run_t, certmaster_var_run_t)
 files_pid_filetrans(certmaster_t ,certmaster_var_run_t, { file sock_file })
 
-# read meminfo
 kernel_read_system_state(certmaster_t)
 
-corecmd_search_bin(certmaster_t)
-corecmd_getattr_bin_files(certmaster_t)
+corecmd_exec_bin(certmaster_t)
 
+corenet_all_recvfrom_unlabeled(certmaster_t)
+corenet_all_recvfrom_netlabel(certmaster_t)
+corenet_tcp_sendrecv_generic_if(certmaster_t)
+corenet_tcp_sendrecv_generic_node(certmaster_t)
 corenet_tcp_bind_generic_node(certmaster_t)
+
+corenet_sendrecv_certmaster_server_packets(certmaster_t)
 corenet_tcp_bind_certmaster_port(certmaster_t)
+corenet_tcp_sendrecv_certmaster_port(certmaster_t)
+
+dev_read_urand(certmaster_t)
 
-files_search_etc(certmaster_t)
 files_list_var(certmaster_t)
-files_search_var_lib(certmaster_t)
+files_search_etc(certmaster_t)
+files_read_usr_files(certmaster_t)
 
 auth_use_nsswitch(certmaster_t)
 
 miscfiles_read_localization(certmaster_t)
-
 miscfiles_manage_generic_cert_dirs(certmaster_t)
 miscfiles_manage_generic_cert_files(certmaster_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/certmonger.fc refpolicy/policy/modules/contrib/certmonger.fc
--- refpolicy/policy/modules/contrib/certmonger.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/certmonger.fc	2012-09-27 20:03:30.738126498 +0200
@@ -1,6 +1,7 @@
 /etc/rc\.d/init\.d/certmonger	--	gen_context(system_u:object_r:certmonger_initrc_exec_t,s0)
 
-/usr/sbin/certmonger		--	gen_context(system_u:object_r:certmonger_exec_t,s0)
+/usr/sbin/certmonger	--	gen_context(system_u:object_r:certmonger_exec_t,s0)
 
-/var/lib/certmonger(/.*)?		gen_context(system_u:object_r:certmonger_var_lib_t,s0)
-/var/run/certmonger.pid		--	gen_context(system_u:object_r:certmonger_var_run_t,s0)
+/var/lib/certmonger(/.*)?	gen_context(system_u:object_r:certmonger_var_lib_t,s0)
+
+/var/run/certmonger.*	gen_context(system_u:object_r:certmonger_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/certmonger.if refpolicy/policy/modules/contrib/certmonger.if
--- refpolicy/policy/modules/contrib/certmonger.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/certmonger.if	2012-09-27 20:03:30.738126498 +0200
@@ -1,4 +1,4 @@
-## <summary>Certificate status monitor and PKI enrollment client</summary>
+## <summary>Certificate status monitor and PKI enrollment client.</summary>
 
 ########################################
 ## <summary>
@@ -15,6 +15,7 @@
 		type certmonger_t, certmonger_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, certmonger_exec_t, certmonger_t)
 ')
 
@@ -41,7 +42,8 @@
 
 ########################################
 ## <summary>
-##	Execute certmonger server in the certmonger domain.
+##	Execute certmonger server in
+##	the certmonger domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -136,8 +138,8 @@
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate
-##	an certmonger environment
+##	All of the rules required to
+##	administrate an certmonger environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -160,7 +162,6 @@
 	ps_process_pattern($1, certmonger_t)
 	allow $1 certmonger_t:process { ptrace signal_perms };
 
-	# Allow certmonger_t to restart the apache service
 	certmonger_initrc_domtrans($1)
 	domain_system_change_exemption($1)
 	role_transition $2 certmonger_initrc_exec_t system_r;
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/certmonger.te refpolicy/policy/modules/contrib/certmonger.te
--- refpolicy/policy/modules/contrib/certmonger.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/certmonger.te	2012-10-17 19:38:45.940198780 +0200
@@ -1,4 +1,4 @@
-policy_module(certmonger, 1.1.0)
+policy_module(certmonger, 1.1.4)
 
 ########################################
 #
@@ -12,61 +12,91 @@
 type certmonger_initrc_exec_t;
 init_script_file(certmonger_initrc_exec_t)
 
-type certmonger_var_run_t;
-files_pid_file(certmonger_var_run_t)
-
 type certmonger_var_lib_t;
 files_type(certmonger_var_lib_t)
 
+type certmonger_var_run_t;
+files_pid_file(certmonger_var_run_t)
+
 ########################################
 #
-# certmonger local policy
+# Local policy
 #
 
-allow certmonger_t self:capability { kill sys_nice };
+allow certmonger_t self:capability { dac_override dac_read_search setgid setuid kill sys_nice };
+dontaudit certmonger_t self:capability sys_tty_config;
+allow certmonger_t self:capability2 block_suspend;
 allow certmonger_t self:process { getsched setsched sigkill };
-allow certmonger_t self:fifo_file rw_file_perms;
-allow certmonger_t self:unix_stream_socket create_stream_socket_perms;
-allow certmonger_t self:tcp_socket create_stream_socket_perms;
-allow certmonger_t self:netlink_route_socket r_netlink_socket_perms;
+allow certmonger_t self:fifo_file rw_fifo_file_perms;
+allow certmonger_t self:unix_stream_socket { accept listen };
+allow certmonger_t self:tcp_socket { accept listen };
 
 manage_dirs_pattern(certmonger_t, certmonger_var_lib_t, certmonger_var_lib_t)
 manage_files_pattern(certmonger_t, certmonger_var_lib_t, certmonger_var_lib_t)
-files_var_lib_filetrans(certmonger_t, certmonger_var_lib_t, { file dir } )
+files_var_lib_filetrans(certmonger_t, certmonger_var_lib_t, dir)
 
 manage_dirs_pattern(certmonger_t, certmonger_var_run_t, certmonger_var_run_t)
 manage_files_pattern(certmonger_t, certmonger_var_run_t, certmonger_var_run_t)
-files_pid_filetrans(certmonger_t, certmonger_var_run_t, { file dir })
+files_pid_filetrans(certmonger_t, certmonger_var_run_t, { dir file })
+
+kernel_read_kernel_sysctls(certmonger_t)
+kernel_read_system_state(certmonger_t)
 
+corenet_all_recvfrom_unlabeled(certmonger_t)
+corenet_all_recvfrom_netlabel(certmonger_t)
 corenet_tcp_sendrecv_generic_if(certmonger_t)
 corenet_tcp_sendrecv_generic_node(certmonger_t)
-corenet_tcp_sendrecv_all_ports(certmonger_t)
+
+corenet_sendrecv_certmaster_client_packets(certmonger_t)
 corenet_tcp_connect_certmaster_port(certmonger_t)
+corenet_tcp_sendrecv_certmaster_port(certmonger_t)
+
+corecmd_exec_bin(certmonger_t)
+corecmd_exec_shell(certmonger_t)
 
 dev_read_urand(certmonger_t)
 
 domain_use_interactive_fds(certmonger_t)
 
-files_read_etc_files(certmonger_t)
 files_read_usr_files(certmonger_t)
 files_list_tmp(certmonger_t)
 
+fs_search_cgroup_dirs(certmonger_t)
+
+auth_use_nsswitch(certmonger_t)
+auth_rw_cache(certmonger_t)
+
+init_getattr_all_script_files(certmonger_t)
+
 logging_send_syslog_msg(certmonger_t)
 
 miscfiles_read_localization(certmonger_t)
 miscfiles_manage_generic_cert_files(certmonger_t)
 
-sysnet_dns_name_resolve(certmonger_t)
+userdom_search_user_home_content(certmonger_t)
+
+optional_policy(`
+	apache_initrc_domtrans(certmonger_t)
+	apache_search_config(certmonger_t)
+	apache_signal(certmonger_t)
+	apache_signull(certmonger_t)
+')
+
+optional_policy(`
+	bind_search_cache(certmonger_t)
+')
 
 optional_policy(`
-	dbus_system_bus_client(certmonger_t)
 	dbus_connect_system_bus(certmonger_t)
+	dbus_system_bus_client(certmonger_t)
 ')
 
 optional_policy(`
+	kerberos_read_keytab(certmonger_t)
 	kerberos_use(certmonger_t)
 ')
 
 optional_policy(`
+	pcscd_read_pid_files(certmonger_t)
 	pcscd_stream_connect(certmonger_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/certwatch.fc refpolicy/policy/modules/contrib/certwatch.fc
--- refpolicy/policy/modules/contrib/certwatch.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/certwatch.fc	2012-09-27 20:03:30.738126498 +0200
@@ -1 +1 @@
-/usr/bin/certwatch	-- gen_context(system_u:object_r:certwatch_exec_t,s0)
+/etc/cron\.daily/certwatch	--	gen_context(system_u:object_r:certwatch_exec_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/certwatch.if refpolicy/policy/modules/contrib/certwatch.if
--- refpolicy/policy/modules/contrib/certwatch.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/certwatch.if	2012-09-27 20:03:30.738126498 +0200
@@ -1,4 +1,4 @@
-## <summary>Digital Certificate Tracking</summary>
+## <summary>Digital Certificate Tracking.</summary>
 
 ########################################
 ## <summary>
@@ -15,16 +15,15 @@
 		type certwatch_exec_t, certwatch_t;
 	')
 
-	files_search_usr($1)
 	corecmd_search_bin($1)
 	domtrans_pattern($1, certwatch_exec_t, certwatch_t)
 ')
 
 ########################################
 ## <summary>
-##	Execute certwatch in the certwatch domain, and
-##	allow the specified role the certwatch domain,
-##	and use the caller's terminal. Has a sigchld
+##	Execute certwatch in the certwatch
+##	domain, and allow the specified role
+##	the certwatch domain.
 ##	backchannel.
 ## </summary>
 ## <param name="domain">
@@ -41,11 +40,11 @@
 #
 interface(`certwatch_run',`
 	gen_require(`
-		type certwatch_t;
+		attribute_role certwatch_roles;
 	')
 
 	certwatch_domtrans($1)
-	role $2 types certwatch_t;
+	roleattribute $2 certwatch_roles;
 ')
 
 ########################################
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/certwatch.te refpolicy/policy/modules/contrib/certwatch.te
--- refpolicy/policy/modules/contrib/certwatch.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/certwatch.te	2012-10-17 19:38:45.940198780 +0200
@@ -1,19 +1,23 @@
-policy_module(certwatch, 1.7.0)
+policy_module(certwatch, 1.7.2)
 
 ########################################
 #
 # Declarations
 #
 
+attribute_role certwatch_roles;
+roleattribute system_r certwatch_roles;
+
 type certwatch_t;
 type certwatch_exec_t;
 application_domain(certwatch_t, certwatch_exec_t)
-role system_r types certwatch_t;
+role certwatch_roles types certwatch_t;
 
 ########################################
 #
 # Local policy
 #
+
 allow certwatch_t self:capability sys_nice;
 allow certwatch_t self:process { setsched getsched };
 
@@ -48,6 +52,6 @@
 
 optional_policy(`
 	pcscd_domtrans(certwatch_t)
+	pcscd_read_pid_files(certwatch_t)
 	pcscd_stream_connect(certwatch_t)
-	pcscd_read_pub_files(certwatch_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/cfengine.fc refpolicy/policy/modules/contrib/cfengine.fc
--- refpolicy/policy/modules/contrib/cfengine.fc	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/cfengine.fc	2012-10-04 19:30:53.365376228 +0200
@@ -0,0 +1,9 @@
+/etc/rc\.d/init\.d/((cf-serverd)|(cf-monitord)|(cf-execd))	--	gen_context(system_u:object_r:cfengine_initrc_exec_t,s0)
+
+/usr/sbin/cf-serverd	--	gen_context(system_u:object_r:cfengine_serverd_exec_t,s0)
+/usr/sbin/cf-execd	--	gen_context(system_u:object_r:cfengine_execd_exec_t,s0)
+/usr/sbin/cf-monitord	--	gen_context(system_u:object_r:cfengine_monitord_exec_t,s0)
+
+/var/cfengine(/.*)?	gen_context(system_u:object_r:cfengine_var_lib_t,s0)
+
+/var/cfengine/outputs(/.*)?	gen_context(system_u:object_r:cfengine_log_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/cfengine.if refpolicy/policy/modules/contrib/cfengine.if
--- refpolicy/policy/modules/contrib/cfengine.if	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/cfengine.if	2012-10-27 13:42:48.603007240 +0200
@@ -0,0 +1,107 @@
+## <summary>System administration tool for networks.</summary>
+
+#######################################
+## <summary>
+##	The template to define a cfengine domain.
+## </summary>
+## <param name="domain_prefix">
+##	<summary>
+##	Domain prefix to be used.
+##	</summary>
+## </param>
+#
+template(`cfengine_domain_template',`
+	gen_require(`
+		attribute cfengine_domain;
+		type cfengine_log_t, cfengine_var_lib_t;
+	')
+
+	########################################
+	#
+	# Declarations
+	#
+
+	type cfengine_$1_t, cfengine_domain;
+	type cfengine_$1_exec_t;
+	init_daemon_domain(cfengine_$1_t, cfengine_$1_exec_t)
+
+	########################################
+	#
+	# Policy
+	#
+
+	auth_use_nsswitch(cfengine_$1_t)
+')
+
+########################################
+## <summary>
+##	Read cfengine lib files.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`cfengine_read_lib_files',`
+	gen_require(`
+		type cfengine_var_lib_t;
+	')
+
+	files_search_var_lib($1)
+	read_files_pattern($1, cfengine_var_lib_t, cfengine_var_lib_t)
+')
+
+####################################
+## <summary>
+##	Do not audit attempts to write
+##	cfengine log files.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain to not audit.
+##	</summary>
+## </param>
+#
+interface(`cfengine_dontaudit_write_log_files',`
+	gen_require(`
+		type cfengine_var_log_t;
+	')
+
+	dontaudit $1 cfengine_var_log_t:file write_file_perms;
+')
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an cfengine environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`cfengine_admin',`
+	gen_require(`
+		attribute cfengine_domain;
+		type cfengine_initrc_exec_t, cfengine_log_t, cfengine_var_lib_t;
+	')
+
+	allow $1 cfengine_domain:process { ptrace signal_perms };
+	ps_process_pattern($1, cfengine_domain)
+
+	init_labeled_script_domtrans($1, cfengine_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 cfengine_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	files_search_var_lib($1)
+	admin_pattern($1, { cfengine_log_t cfengine_var_lib_t })
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/cfengine.te refpolicy/policy/modules/contrib/cfengine.te
--- refpolicy/policy/modules/contrib/cfengine.te	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/cfengine.te	2012-10-27 13:42:48.604007240 +0200
@@ -0,0 +1,77 @@
+policy_module(cfengine, 1.0.2)
+
+########################################
+#
+# Declarations
+#
+
+attribute cfengine_domain;
+
+cfengine_domain_template(serverd)
+cfengine_domain_template(execd)
+cfengine_domain_template(monitord)
+
+type cfengine_initrc_exec_t;
+init_script_file(cfengine_initrc_exec_t)
+
+type cfengine_var_lib_t;
+files_type(cfengine_var_lib_t)
+
+type cfengine_log_t;
+logging_log_file(cfengine_log_t)
+
+########################################
+#
+# Common cfengine domain local policy
+#
+
+allow cfengine_domain self:capability { chown kill setgid setuid sys_chroot };
+allow cfengine_domain self:process { setfscreate signal };
+allow cfengine_domain self:fifo_file rw_fifo_file_perms;
+allow cfengine_domain self:unix_stream_socket { accept listen };
+
+manage_dirs_pattern(cfengine_domain, cfengine_var_lib_t, cfengine_var_lib_t)
+manage_files_pattern(cfengine_domain, cfengine_var_lib_t, cfengine_var_lib_t)
+manage_lnk_files_pattern(cfengine_domain, cfengine_var_lib_t, cfengine_var_lib_t)
+files_var_lib_filetrans(cfengine_domain, cfengine_var_lib_t, dir)
+
+manage_dirs_pattern(cfengine_domain, cfengine_log_t, cfengine_log_t)
+append_files_pattern(cfengine_domain, cfengine_log_t, cfengine_log_t)
+create_files_pattern(cfengine_domain, cfengine_log_t, cfengine_log_t)
+setattr_files_pattern(cfengine_domain, cfengine_log_t, cfengine_log_t)
+logging_log_filetrans(cfengine_domain, cfengine_log_t, dir)
+
+kernel_read_system_state(cfengine_domain)
+
+corecmd_exec_bin(cfengine_domain)
+corecmd_exec_shell(cfengine_domain)
+
+dev_read_urand(cfengine_domain)
+dev_read_sysfs(cfengine_domain)
+
+logging_send_syslog_msg(cfengine_domain)
+
+miscfiles_read_localization(cfengine_domain)
+
+sysnet_domtrans_ifconfig(cfengine_domain)
+
+########################################
+#
+# Exec local policy
+#
+
+kernel_read_sysctl(cfengine_execd_t)
+
+domain_read_all_domains_state(cfengine_execd_t)
+
+########################################
+#
+# Monitord local policy
+#
+
+kernel_read_hotplug_sysctls(cfengine_monitord_t)
+kernel_read_network_state(cfengine_monitord_t)
+
+domain_read_all_domains_state(cfengine_monitord_t)
+
+fs_getattr_xattr_fs(cfengine_monitord_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/cgroup.fc refpolicy/policy/modules/contrib/cgroup.fc
--- refpolicy/policy/modules/contrib/cgroup.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/cgroup.fc	2012-09-24 21:18:06.942582806 +0200
@@ -1,15 +1,19 @@
-/etc/cgconfig.conf		--	gen_context(system_u:object_r:cgconfig_etc_t,s0)
-/etc/cgrules.conf		--	gen_context(system_u:object_r:cgrules_etc_t,s0)
+/etc/cgconfig\.conf	--	gen_context(system_u:object_r:cgconfig_etc_t,s0)
+/etc/cgrules\.conf	--	gen_context(system_u:object_r:cgrules_etc_t,s0)
 
-/etc/sysconfig/cgconfig		--	gen_context(system_u:object_r:cgconfig_etc_t,s0)
-/etc/sysconfig/cgred.conf	--	gen_context(system_u:object_r:cgrules_etc_t,s0)
+/etc/sysconfig/cgconfig	--	gen_context(system_u:object_r:cgconfig_etc_t,s0)
+/etc/sysconfig/cgred\.conf	--	gen_context(system_u:object_r:cgrules_etc_t,s0)
 
 /etc/rc\.d/init\.d/cgconfig	--	gen_context(system_u:object_r:cgconfig_initrc_exec_t,s0)
 /etc/rc\.d/init\.d/cgred	--	gen_context(system_u:object_r:cgred_initrc_exec_t,s0)
 
-/sbin/cgconfigparser		--	gen_context(system_u:object_r:cgconfig_exec_t,s0)
-/sbin/cgrulesengd		--	gen_context(system_u:object_r:cgred_exec_t,s0)
-/sbin/cgclear			--	gen_context(system_u:object_r:cgclear_exec_t,s0)
+/sbin/cgconfigparser	--	gen_context(system_u:object_r:cgconfig_exec_t,s0)
+/sbin/cgrulesengd	--	gen_context(system_u:object_r:cgred_exec_t,s0)
+/sbin/cgclear	--	gen_context(system_u:object_r:cgclear_exec_t,s0)
 
-/var/log/cgrulesengd\.log	--	gen_context(system_u:object_r:cgred_log_t,s0)
-/var/run/cgred.*			gen_context(system_u:object_r:cgred_var_run_t,s0)
+/usr/sbin/cgconfigparser	--	gen_context(system_u:object_r:cgconfig_exec_t,s0)
+/usr/sbin/cgrulesengd	--	gen_context(system_u:object_r:cgred_exec_t,s0)
+/usr/sbin/cgclear	--	gen_context(system_u:object_r:cgclear_exec_t,s0)
+
+/var/log/cgrulesengd\.log.*	--	gen_context(system_u:object_r:cgred_log_t,s0)
+/var/run/cgred.*	gen_context(system_u:object_r:cgred_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/cgroup.if refpolicy/policy/modules/contrib/cgroup.if
--- refpolicy/policy/modules/contrib/cgroup.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/cgroup.if	2012-09-24 21:18:06.942582806 +0200
@@ -171,29 +171,20 @@
 		type cgrules_etc_t, cgclear_t;
 	')
 
-	allow $1 cgclear_t:process { ptrace signal_perms };
-	ps_process_pattern($1, cgclear_t)
+	allow $1 { cgclear_t cgconfig_t cgred_t }:process { ptrace signal_perms };
+	ps_process_pattern($1, { cgclear_t cgconfig_t cgred_t })
 
-	allow $1 cgconfig_t:process { ptrace signal_perms };
-	ps_process_pattern($1, cgconfig_t)
-
-	allow $1 cgred_t:process { ptrace signal_perms };
-	ps_process_pattern($1, cgred_t)
-
-	admin_pattern($1, cgconfig_etc_t)
-	admin_pattern($1, cgrules_etc_t)
+	admin_pattern($1, { cgconfig_etc_t cgrules_etc_t })
 	files_list_etc($1)
 
 	admin_pattern($1, cgred_var_run_t)
 	files_list_pids($1)
 
 	cgroup_initrc_domtrans_cgconfig($1)
+	cgroup_initrc_domtrans_cgred($1)
 	domain_system_change_exemption($1)
-	role_transition $2 cgconfig_initrc_exec_t system_r;
+	role_transition $2 { cgconfig_initrc_exec_t cgred_initrc_exec_t } system_r;
 	allow $2 system_r;
 
-	cgroup_initrc_domtrans_cgred($1)
-	role_transition $2 cgred_initrc_exec_t system_r;
-
 	cgroup_run_cgclear($1, $2)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/cgroup.te refpolicy/policy/modules/contrib/cgroup.te
--- refpolicy/policy/modules/contrib/cgroup.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/cgroup.te	2012-11-06 21:18:53.174011606 +0100
@@ -1,4 +1,4 @@
-policy_module(cgroup, 1.1.0)
+policy_module(cgroup, 1.1.3)
 
 ########################################
 #
@@ -37,11 +37,13 @@
 
 ########################################
 #
-# cgclear personal policy.
+# cgclear local policy
 #
 
 allow cgclear_t self:capability { dac_read_search dac_override sys_admin };
 
+allow cgclear_t cgconfig_etc_t:file read_file_perms;
+
 kernel_read_system_state(cgclear_t)
 
 domain_setpriority_all_domains(cgclear_t)
@@ -52,18 +54,16 @@
 
 ########################################
 #
-# cgconfig personal policy.
+# cgconfig local policy
 #
 
 allow cgconfig_t self:capability { dac_override fowner fsetid chown sys_admin sys_tty_config };
 
 allow cgconfig_t cgconfig_etc_t:file read_file_perms;
 
-# search will do.
 kernel_list_unlabeled(cgconfig_t)
 kernel_read_system_state(cgconfig_t)
 
-# /etc/nsswitch.conf, /etc/passwd
 files_read_etc_files(cgconfig_t)
 
 fs_manage_cgroup_dirs(cgconfig_t)
@@ -74,23 +74,23 @@
 
 ########################################
 #
-# cgred personal policy.
+# cgred local policy
 #
 
 allow cgred_t self:capability { chown fsetid net_admin sys_admin sys_ptrace dac_override };
 allow cgred_t self:netlink_socket { write bind create read };
 allow cgred_t self:unix_dgram_socket { write create connect };
 
-manage_files_pattern(cgred_t, cgred_log_t, cgred_log_t)
-logging_log_filetrans(cgred_t, cgred_log_t, file)
-
 allow cgred_t cgrules_etc_t:file read_file_perms;
 
-# rc script creates pid file
+allow cgred_t cgred_log_t:file { append_file_perms create_file_perms setattr_file_perms };
+logging_log_filetrans(cgred_t, cgred_log_t, file)
+
 manage_files_pattern(cgred_t, cgred_var_run_t, cgred_var_run_t)
 manage_sock_files_pattern(cgred_t, cgred_var_run_t, cgred_var_run_t)
 files_pid_filetrans(cgred_t, cgred_var_run_t, { file sock_file })
 
+kernel_read_all_sysctls(cgred_t)
 kernel_read_system_state(cgred_t)
 
 domain_read_all_domains_state(cgred_t)
@@ -99,7 +99,6 @@
 files_getattr_all_files(cgred_t)
 files_getattr_all_sockets(cgred_t)
 files_read_all_symlinks(cgred_t)
-# /etc/group
 files_read_etc_files(cgred_t)
 
 fs_write_cgroup_files(cgred_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/chromium.fc refpolicy/policy/modules/contrib/chromium.fc
--- refpolicy/policy/modules/contrib/chromium.fc	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/chromium.fc	2012-10-31 21:33:18.984599453 +0100
@@ -0,0 +1,10 @@
+/usr/lib/chromium-browser/chrome			--	gen_context(system_u:object_r:chromium_exec_t,s0)
+
+# Although this should be in the core definitions, it makes more sense to
+# logically keep it close to the module(s) that use it.
+
+/usr/lib/chromium-browser/nacl_helper_bootstrap		--	gen_context(system_u:object_r:bin_t,s0)
+
+HOME_DIR/\.cache/chromium(/.*)?					gen_context(system_u:object_r:chromium_xdg_cache_t,s0)
+HOME_DIR/\.config/chromium(/.*)?				gen_context(system_u:object_r:chromium_xdg_config_t,s0)
+
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/chromium.if refpolicy/policy/modules/contrib/chromium.if
--- refpolicy/policy/modules/contrib/chromium.if	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/chromium.if	2012-07-25 10:58:41.275701064 +0200
@@ -0,0 +1,126 @@
+## <summary>
+##	Chromium browser
+## </summary>
+
+#######################################
+## <summary>
+## 	Role access for chromium
+## </summary>
+## <param name="role">
+##	<summary>
+##	Role allowed access
+##	</summary>
+## </param>
+## <param name="domain">
+## 	<summary>
+##	User domain for the role
+##	</summary>
+## </param>
+#
+interface(`chromium_role',`
+	gen_require(`
+		type chromium_t;
+		type chromium_renderer_t;
+		type chromium_exec_t;
+	')
+
+	role $1 types chromium_t;
+	role $1 types chromium_renderer_t;
+
+	# Transition from the user domain to the derived domain
+	chromium_domtrans($2)
+
+	# Allow ps to show chromium processes and allow the user to signal it
+	ps_process_pattern($2, chromium_t)
+	ps_process_pattern($2, chromium_renderer_t)
+	allow $2 chromium_t:process signal_perms;
+	allow $2 chromium_renderer_t:process signal_perms;
+')
+#######################################
+## <summary>
+##	Read-write access to Chromiums' temporary fifo files
+## </summary>
+## <param name="domain">
+## 	<summary>
+##	Domain allowed access
+##	</summary>
+## </param>
+#
+interface(`chromium_rw_tmp_pipes',`
+	gen_require(`
+		type chromium_tmp_t;
+	')
+
+	rw_fifo_files_pattern($1, chromium_tmp_t, chromium_tmp_t)
+')
+##############################################
+## <summary>
+##	Automatically use the specified type for resources created in chromium's
+##	temporary locations
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain that creates the resource(s)
+##	</summary>
+## </param>
+## <param name="class">
+##	<summary>
+##	Type of the resource created
+##	</summary>
+## </param>
+## <param name="filename" optional="true">
+##	<summary>
+##	The name of the resource being created
+##	</summary>
+## </param>
+#
+interface(`chromium_tmp_filetrans',`
+	gen_require(`
+		type chromium_tmp_t;
+	')
+
+	search_dirs_pattern($1, chromium_tmp_t, chromium_tmp_t)
+	filetrans_pattern($1, chromium_tmp_t, $2, $3, $4)
+')
+#######################################
+## <summary>
+## 	Execute a domain transition to the chromium domain (chromium_t)
+## </summary>
+## <param name="domain">
+## 	<summary>
+##	Domain allowed access
+##	</summary>
+## </param>
+#
+interface(`chromium_domtrans',`
+	gen_require(`
+		type chromium_t;
+		type chromium_exec_t;
+	')
+
+	corecmd_search_bin($1)
+	domtrans_pattern($1, chromium_exec_t, chromium_t)
+')
+#######################################
+## <summary>
+## 	Execute chromium in the chromium domain and allow the specified role to access the chromium domain
+## </summary>
+## <param name="domain">
+## 	<summary>
+##	Domain allowed access
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access
+##	</summary>
+## </param>
+#
+interface(`chromium_run',`
+	gen_require(`
+		type chromium_t;
+	')
+
+	chromium_domtrans($1)
+	role $2 types chromium_t;
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/chromium.te refpolicy/policy/modules/contrib/chromium.te
--- refpolicy/policy/modules/contrib/chromium.te	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/chromium.te	2012-10-04 20:03:15.400380374 +0200
@@ -0,0 +1,263 @@
+policy_module(chromium, 1.0.0)
+
+########################################
+#
+# Declarations
+#
+
+## <desc>
+## <p>
+## Allow chromium to read user content
+## </p>
+## </desc>
+gen_tunable(chromium_read_user_content, true)
+
+## <desc>
+## <p>
+## Allow chromium to write (manage) user content
+## </p>
+## </desc>
+gen_tunable(chromium_manage_user_content, false)
+
+## <desc>
+## <p>
+## Allow the use of java plugins
+## </p>
+## <p>
+## Some of these plugins require the use of named pipes (fifo files) that are
+## created within the temporary directory of the first browser that instantiated
+## the plugin. Hence, if other browsers need access to java plugins, they will
+## get search rights in chromium's tmp locations
+## </p>
+## </desc>
+gen_tunable(chromium_use_java, false)
+
+## <desc>
+## <p>
+## Allow chromium to read system information
+## </p>
+## <p>
+## Although not needed for regular browsing, this will allow chromium to update
+## its own memory consumption based on system state, support additional
+## debugging, detect specific devices, etc. 
+## </p>
+## </desc>
+gen_tunable(chromium_read_system_info, false)
+
+type chromium_t;
+domain_dyntrans_type(chromium_t)
+
+type chromium_exec_t;
+application_domain(chromium_t, chromium_exec_t)
+
+type chromium_renderer_t;
+domain_base_type(chromium_renderer_t)
+
+type chromium_tmp_t;
+userdom_user_tmp_file(chromium_tmp_t)
+
+type chromium_tmpfs_t;
+userdom_user_tmpfs_file(chromium_tmpfs_t)
+
+type chromium_xdg_config_t;
+xdg_config_home_content(chromium_xdg_config_t)
+
+type chromium_xdg_cache_t;
+xdg_cache_home_content(chromium_xdg_cache_t)
+
+
+
+########################################
+#
+# chromium local policy
+#
+
+allow chromium_t self:process { getsched setsched signal };
+allow chromium_t self:fifo_file rw_fifo_file_perms;;
+allow chromium_t self:sem create_sem_perms;
+allow chromium_t self:netlink_kobject_uevent_socket client_stream_socket_perms;
+
+allow chromium_t chromium_exec_t:file execute_no_trans;
+allow chromium_t chromium_renderer_t:dir list_dir_perms;
+allow chromium_t chromium_renderer_t:file rw_file_perms;
+allow chromium_t chromium_renderer_t:fd use;
+allow chromium_t chromium_renderer_t:process signal_perms;
+allow chromium_t chromium_renderer_t:shm rw_shm_perms;
+allow chromium_t chromium_renderer_t:unix_dgram_socket { read write };
+allow chromium_t chromium_renderer_t:unix_stream_socket { read write };
+
+allow chromium_t self:process execmem;	# Load in plugins
+
+# tmp has a wide class access (used for plugins)
+manage_files_pattern(chromium_t, chromium_tmp_t, chromium_tmp_t)
+manage_dirs_pattern(chromium_t, chromium_tmp_t, chromium_tmp_t)
+manage_lnk_files_pattern(chromium_t, chromium_tmp_t, chromium_tmp_t)
+manage_sock_files_pattern(chromium_t, chromium_tmp_t, chromium_tmp_t)
+manage_fifo_files_pattern(chromium_t, chromium_tmp_t, chromium_tmp_t)
+files_tmp_filetrans(chromium_t, chromium_tmp_t, { file dir sock_file })
+
+manage_files_pattern(chromium_t, chromium_tmpfs_t, chromium_tmpfs_t)
+fs_tmpfs_filetrans(chromium_t, chromium_tmpfs_t, file)
+fs_tmpfs_filetrans(chromium_renderer_t, chromium_tmpfs_t, file)
+
+manage_files_pattern(chromium_t, chromium_xdg_config_t, chromium_xdg_config_t)
+manage_lnk_files_pattern(chromium_t, chromium_xdg_config_t, chromium_xdg_config_t)
+manage_dirs_pattern(chromium_t, chromium_xdg_config_t, chromium_xdg_config_t)
+xdg_config_home_filetrans(chromium_t, chromium_xdg_config_t, dir, "chromium")
+
+manage_files_pattern(chromium_t, chromium_xdg_cache_t, chromium_xdg_cache_t)
+manage_dirs_pattern(chromium_t, chromium_xdg_cache_t, chromium_xdg_cache_t)
+xdg_cache_home_filetrans(chromium_t, chromium_xdg_cache_t, dir, "chromium")
+
+dyntrans_pattern(chromium_t, chromium_renderer_t)
+
+corecmd_exec_bin(chromium_t)
+
+corenet_tcp_connect_all_unreserved_ports(chromium_t)
+corenet_tcp_connect_ftp_port(chromium_t)
+corenet_tcp_connect_http_port(chromium_t)
+
+dev_read_sound(chromium_t)
+dev_write_sound(chromium_t)
+dev_read_urand(chromium_t)
+
+domain_dontaudit_search_all_domains_state(chromium_t)
+
+files_search_home(chromium_t)
+files_read_usr_files(chromium_t)
+files_read_etc_files(chromium_t)
+
+fs_dontaudit_getattr_xattr_fs(chromium_t)
+
+getty_dontaudit_use_fds(chromium_t)
+
+miscfiles_manage_user_certs(chromium_t)
+miscfiles_read_all_certs(chromium_t)
+miscfiles_read_localization(chromium_t)
+miscfiles_user_home_dir_filetrans_cert_home(chromium_t, dir, ".nss")
+
+sysnet_dns_name_resolve(chromium_t) 
+
+userdom_dontaudit_list_user_home_dirs(chromium_t)
+# Debugging. Also on user_tty_device_t if X is started through "startx" for instance
+userdom_use_user_terminals(chromium_t)
+
+
+xdg_read_generic_data_home_files(chromium_t)
+xdg_read_generic_config_home_files(chromium_t)
+
+xserver_user_x_domain_template(chromium, chromium_t, chromium_tmpfs_t)
+
+tunable_policy(`chromium_read_system_info',`
+	kernel_read_kernel_sysctls(chromium_t)
+	# Memory optimizations & optimizations based on OS/version
+	kernel_read_system_state(chromium_t)
+
+	# Debugging (sys/kernel/debug) and device information (sys/bus and sys/devices).
+	dev_read_sysfs(chromium_t)
+
+	files_read_etc_runtime_files(chromium_t)
+',`
+	kernel_dontaudit_read_kernel_sysctls(chromium_t)
+	kernel_dontaudit_read_system_state(chromium_t)
+
+	dev_dontaudit_read_sysfs(chromium_t)
+
+	files_dontaudit_read_etc_runtime(chromium_t)
+')
+
+tunable_policy(`chromium_read_user_content',`
+	userdom_read_user_home_content_files(chromium_t)
+	userdom_read_user_home_content_symlinks(chromium_t)
+	userdom_search_user_home_content(chromium_t)
+')
+
+tunable_policy(`chromium_manage_user_content',`
+	userdom_manage_user_home_content_files(chromium_t)
+	userdom_manage_user_home_content_dirs(chromium_t)
+')
+
+optional_policy(`
+	alsa_domain(chromium_t, chromium_tmpfs_t)
+	alsa_read_rw_config(chromium_t)
+')
+
+optional_policy(`
+	cups_read_config(chromium_t)
+	cups_stream_connect(chromium_t)
+')
+
+optional_policy(`
+	dbus_all_session_bus_client(chromium_t)
+	dbus_system_bus_client(chromium_t)
+
+	optional_policy(`
+		unconfined_dbus_chat(chromium_t)
+	')
+')
+
+optional_policy(`
+	flash_manage_home(chromium_t)
+')
+
+optional_policy(`
+	# Java (iced-tea) plugin .so creates /tmp/icedteaplugin-<name> directory
+	# and fifo files within. These are then used by the renderer and a
+	# freshly forked java process to communicate between each other.
+	tunable_policy(`chromium_use_java',`
+		java_noatsecure_domtrans(chromium_t)
+	')
+')
+
+optional_policy(`
+	# Chromium reads in .mozilla for user plugins
+	mozilla_read_user_home(chromium_t)
+')
+
+########################################
+#
+# chromium_renderer local policy
+#
+
+allow chromium_renderer_t self:process execmem;
+
+allow chromium_renderer_t self:fifo_file rw_fifo_file_perms;
+allow chromium_renderer_t self:shm create_shm_perms;
+allow chromium_renderer_t self:unix_dgram_socket { create read sendto };
+allow chromium_renderer_t self:unix_stream_socket { create getattr read write };
+
+allow chromium_renderer_t chromium_t:fd use;
+allow chromium_renderer_t chromium_t:unix_stream_socket rw_stream_socket_perms;
+allow chromium_renderer_t chromium_tmpfs_t:file rw_file_perms;
+
+dontaudit chromium_renderer_t chromium_t:dir search;	# /proc/... access
+dontaudit chromium_renderer_t self:process getsched;
+
+read_files_pattern(chromium_renderer_t, chromium_xdg_config_t, chromium_xdg_config_t)
+
+rw_fifo_files_pattern(chromium_renderer_t, chromium_tmp_t, chromium_tmp_t)
+
+dev_read_urand(chromium_renderer_t)
+
+files_dontaudit_list_tmp(chromium_renderer_t)
+files_dontaudit_read_etc_files(chromium_renderer_t)
+files_search_var(chromium_renderer_t)
+
+init_sigchld(chromium_renderer_t)
+
+miscfiles_read_localization(chromium_renderer_t)
+
+userdom_dontaudit_use_all_users_fds(chromium_renderer_t)
+userdom_use_user_terminals(chromium_renderer_t)
+
+xdg_read_generic_config_home_files(chromium_renderer_t)
+
+xserver_user_x_domain_template(chromium_renderer, chromium_renderer_t, chromium_tmpfs_t)
+
+tunable_policy(`chromium_read_system_info',`
+	kernel_read_kernel_sysctls(chromium_renderer_t)
+	kernel_read_system_state(chromium_renderer_t)
+',`
+	kernel_dontaudit_read_kernel_sysctls(chromium_renderer_t)
+	kernel_dontaudit_read_system_state(chromium_renderer_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/chronyd.fc refpolicy/policy/modules/contrib/chronyd.fc
--- refpolicy/policy/modules/contrib/chronyd.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/chronyd.fc	2012-09-27 20:03:30.739126498 +0200
@@ -1,9 +1,13 @@
-/etc/chrony\.keys		--	gen_context(system_u:object_r:chronyd_keys_t,s0)
+/etc/chrony\.keys	--	gen_context(system_u:object_r:chronyd_keys_t,s0)
 
 /etc/rc\.d/init\.d/chronyd	--	gen_context(system_u:object_r:chronyd_initrc_exec_t,s0)
 
-/usr/sbin/chronyd		--	gen_context(system_u:object_r:chronyd_exec_t,s0)
+/usr/sbin/chronyd	--	gen_context(system_u:object_r:chronyd_exec_t,s0)
 
-/var/lib/chrony(/.*)?			gen_context(system_u:object_r:chronyd_var_lib_t,s0)
-/var/log/chrony(/.*)?			gen_context(system_u:object_r:chronyd_var_log_t,s0)
-/var/run/chronyd\.pid		--	gen_context(system_u:object_r:chronyd_var_run_t,s0)
+/var/lib/chrony(/.*)?	gen_context(system_u:object_r:chronyd_var_lib_t,s0)
+
+/var/log/chrony(/.*)?	gen_context(system_u:object_r:chronyd_var_log_t,s0)
+
+/var/run/chronyd(/.*)	gen_context(system_u:object_r:chronyd_var_run_t,s0)
+/var/run/chronyd\.pid	--	gen_context(system_u:object_r:chronyd_var_run_t,s0)
+/var/run/chronyd\.sock	-s	gen_context(system_u:object_r:chronyd_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/chronyd.if refpolicy/policy/modules/contrib/chronyd.if
--- refpolicy/policy/modules/contrib/chronyd.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/chronyd.if	2012-10-10 21:47:43.796027923 +0200
@@ -1,4 +1,4 @@
-## <summary>Chrony NTP background daemon</summary>
+## <summary>Chrony NTP background daemon.</summary>
 
 #####################################
 ## <summary>
@@ -19,9 +19,28 @@
 	domtrans_pattern($1, chronyd_exec_t, chronyd_t)
 ')
 
+########################################
+## <summary>
+##	Execute chronyd server in the
+##	chronyd domain.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed to transition.
+##	</summary>
+## </param>
+#
+interface(`chronyd_initrc_domtrans',`
+	gen_require(`
+		type chronyd_initrc_exec_t;
+	')
+
+	init_labeled_script_domtrans($1, chronyd_initrc_exec_t)
+')
+
 ####################################
 ## <summary>
-##	Execute chronyd
+##	Execute chronyd in the caller domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -34,12 +53,13 @@
 		type chronyd_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	can_exec($1, chronyd_exec_t)
 ')
 
 #####################################
 ## <summary>
-##	Read chronyd logs.
+##	Read chronyd log files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -56,10 +76,91 @@
 	read_files_pattern($1, chronyd_var_log_t, chronyd_var_log_t)
 ')
 
+########################################
+## <summary>
+##	Read and write chronyd shared memory.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`chronyd_rw_shm',`
+	gen_require(`
+		type chronyd_t, chronyd_tmpfs_t;
+	')
+
+	allow $1 chronyd_t:shm rw_shm_perms;
+	allow $1 chronyd_tmpfs_t:dir list_dir_perms;
+	rw_files_pattern($1, chronyd_tmpfs_t, chronyd_tmpfs_t)
+	read_lnk_files_pattern($1, chronyd_tmpfs_t, chronyd_tmpfs_t)
+	fs_search_tmpfs($1)
+')
+
+########################################
+## <summary>
+##	Connect to chronyd using a unix
+##	domain stream socket.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`chronyd_stream_connect',`
+	gen_require(`
+		type chronyd_t, chronyd_var_run_t;
+	')
+
+	files_search_pids($1)
+	stream_connect_pattern($1, chronyd_var_run_t, chronyd_var_run_t, chronyd_t)
+')
+
+########################################
+## <summary>
+##	Send to chronyd using a unix domain
+##	datagram socket.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`chronyd_dgram_send',`
+	gen_require(`
+		type chronyd_t, chronyd_var_run_t;
+	')
+
+	files_search_pids($1)
+	dgram_send_pattern($1, chronyd_var_run_t, chronyd_var_run_t, chronyd_t)
+')
+
+########################################
+## <summary>
+##	Read chronyd key files.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`chronyd_read_key_files',`
+	gen_require(`
+		type chronyd_keys_t;
+	')
+
+	files_search_etc($1)
+	read_files_pattern($1, chronyd_keys_t, chronyd_keys_t)
+')
+
 ####################################
 ## <summary>
-##	All of the rules required to administrate
-##	an chronyd environment
+##	All of the rules required to
+##	administrate an chronyd environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -68,7 +169,7 @@
 ## </param>
 ## <param name="role">
 ##	<summary>
-##	The role to be allowed to manage the chronyd domain.
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <rolecap/>
@@ -83,7 +184,7 @@
 	allow $1 chronyd_t:process { ptrace signal_perms };
 	ps_process_pattern($1, chronyd_t)
 
-	init_labeled_script_domtrans($1, chronyd_initrc_exec_t)
+	chronyd_initrc_domtrans($1)
 	domain_system_change_exemption($1)
 	role_transition $2 chronyd_initrc_exec_t system_r;
 	allow $2 system_r;
@@ -99,7 +200,4 @@
 
 	files_search_pids($1)
 	admin_pattern($1, chronyd_var_run_t)
-
-	files_search_tmp($1)
-	admin_pattern($1, chronyd_tmp_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/chronyd.te refpolicy/policy/modules/contrib/chronyd.te
--- refpolicy/policy/modules/contrib/chronyd.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/chronyd.te	2012-10-10 21:47:43.814027915 +0200
@@ -1,4 +1,4 @@
-policy_module(chronyd, 1.1.0)
+policy_module(chronyd, 1.1.4)
 
 ########################################
 #
@@ -15,6 +15,9 @@
 type chronyd_keys_t;
 files_type(chronyd_keys_t)
 
+type chronyd_tmpfs_t;
+files_tmpfs_file(chronyd_tmpfs_t)
+
 type chronyd_var_lib_t;
 files_type(chronyd_var_lib_t)
 
@@ -30,31 +33,49 @@
 #
 
 allow chronyd_t self:capability { dac_override ipc_lock setuid setgid sys_resource sys_time };
-allow chronyd_t self:process { getcap setcap setrlimit };
+allow chronyd_t self:process { getcap setcap setrlimit signal };
 allow chronyd_t self:shm create_shm_perms;
-allow chronyd_t self:udp_socket create_socket_perms;
-allow chronyd_t self:unix_dgram_socket create_socket_perms;
+allow chronyd_t self:fifo_file rw_fifo_file_perms;
 
 allow chronyd_t chronyd_keys_t:file read_file_perms;
 
+manage_dirs_pattern(chronyd_t, chronyd_tmpfs_t, chronyd_tmpfs_t)
+manage_files_pattern(chronyd_t, chronyd_tmpfs_t, chronyd_tmpfs_t)
+fs_tmpfs_filetrans(chronyd_t, chronyd_tmpfs_t, { dir file })
+
 manage_files_pattern(chronyd_t, chronyd_var_lib_t, chronyd_var_lib_t)
 manage_dirs_pattern(chronyd_t, chronyd_var_lib_t, chronyd_var_lib_t)
 manage_sock_files_pattern(chronyd_t, chronyd_var_lib_t, chronyd_var_lib_t)
-files_var_lib_filetrans(chronyd_t, chronyd_var_lib_t, { file dir })
+files_var_lib_filetrans(chronyd_t, chronyd_var_lib_t, dir)
 
-manage_files_pattern(chronyd_t, chronyd_var_log_t, chronyd_var_log_t)
 manage_dirs_pattern(chronyd_t, chronyd_var_log_t, chronyd_var_log_t)
-logging_log_filetrans(chronyd_t, chronyd_var_log_t, { file dir })
+append_files_pattern(chronyd_t, chronyd_var_log_t, chronyd_var_log_t)
+create_files_pattern(chronyd_t, chronyd_var_log_t, chronyd_var_log_t)
+setattr_files_pattern(chronyd_t, chronyd_var_log_t, chronyd_var_log_t)
+logging_log_filetrans(chronyd_t, chronyd_var_log_t, dir)
 
-manage_files_pattern(chronyd_t, chronyd_var_run_t, chronyd_var_run_t)
 manage_dirs_pattern(chronyd_t, chronyd_var_run_t, chronyd_var_run_t)
-files_pid_filetrans(chronyd_t, chronyd_var_run_t, file)
+manage_files_pattern(chronyd_t, chronyd_var_run_t, chronyd_var_run_t)
+manage_sock_files_pattern(chronyd_t, chronyd_var_run_t, chronyd_var_run_t)
+files_pid_filetrans(chronyd_t, chronyd_var_run_t, { dir file sock_file })
+
+kernel_read_system_state(chronyd_t)
+kernel_read_network_state(chronyd_t)
 
+corenet_all_recvfrom_unlabeled(chronyd_t)
+corenet_all_recvfrom_netlabel(chronyd_t)
+corenet_udp_sendrecv_generic_if(chronyd_t)
+corenet_udp_sendrecv_generic_node(chronyd_t)
+corenet_udp_bind_generic_node(chronyd_t)
+
+corenet_sendrecv_ntp_server_packets(chronyd_t)
 corenet_udp_bind_ntp_port(chronyd_t)
-# bind to udp/323
+corenet_udp_sendrecv_ntp_port(chronyd_t)
+
+corenet_sendrecv_chronyd_server_packets(chronyd_t)
 corenet_udp_bind_chronyd_port(chronyd_t)
+corenet_udp_sendrecv_chronyd_port(chronyd_t)
 
-# real time clock option
 dev_rw_realtime_clock(chronyd_t)
 
 auth_use_nsswitch(chronyd_t)
@@ -66,3 +87,7 @@
 optional_policy(`
 	gpsd_rw_shm(chronyd_t)
 ')
+
+optional_policy(`
+	mta_send_mail(chronyd_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/cipe.fc refpolicy/policy/modules/contrib/cipe.fc
--- refpolicy/policy/modules/contrib/cipe.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/cipe.fc	2012-09-27 20:03:30.739126498 +0200
@@ -1,4 +1,3 @@
-#
-# /usr
-#
+/etc/rc\.d/init\.d/ciped.*	--	gen_context(system_u:object_r:ciped_initrc_exec_t,s0)
+
 /usr/sbin/ciped.*	--	gen_context(system_u:object_r:ciped_exec_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/cipe.if refpolicy/policy/modules/contrib/cipe.if
--- refpolicy/policy/modules/contrib/cipe.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/cipe.if	2012-09-27 20:03:30.739126498 +0200
@@ -1 +1,32 @@
-## <summary>Encrypted tunnel daemon</summary>
+## <summary>Encrypted tunnel daemon.</summary>
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an cipe environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`cipe_admin',`
+	gen_require(`
+		type ciped_t, ciped_initrc_exec_t;
+	')
+
+	allow $1 ciped_t:process { ptrace signal_perms };
+	ps_process_pattern($1, ciped_t)
+
+	init_labeled_script_domtrans($1, ciped_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 ciped_initrc_exec_t system_r;
+	allow $2 system_r;
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/cipe.te refpolicy/policy/modules/contrib/cipe.te
--- refpolicy/policy/modules/contrib/cipe.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/cipe.te	2012-09-27 20:03:30.739126498 +0200
@@ -1,4 +1,4 @@
-policy_module(cipe, 1.5.0)
+policy_module(cipe, 1.5.1)
 
 ########################################
 #
@@ -9,6 +9,9 @@
 type ciped_exec_t;
 init_daemon_domain(ciped_t, ciped_exec_t)
 
+type ciped_initrc_exec_t;
+init_script_file(ciped_initrc_exec_t)
+
 ########################################
 #
 # Local policy
@@ -18,8 +21,6 @@
 dontaudit ciped_t self:capability sys_tty_config;
 allow ciped_t self:process signal_perms;
 allow ciped_t self:fifo_file rw_fifo_file_perms;
-allow ciped_t self:unix_dgram_socket create_socket_perms;
-allow ciped_t self:unix_stream_socket create_socket_perms;
 allow ciped_t self:udp_socket create_socket_perms;
 
 kernel_read_kernel_sysctls(ciped_t)
@@ -32,15 +33,14 @@
 corenet_all_recvfrom_netlabel(ciped_t)
 corenet_udp_sendrecv_generic_if(ciped_t)
 corenet_udp_sendrecv_generic_node(ciped_t)
-corenet_udp_sendrecv_all_ports(ciped_t)
 corenet_udp_bind_generic_node(ciped_t)
-# cipe uses the afs3-bos port (udp 7007)
-corenet_udp_bind_afs_bos_port(ciped_t)
+
 corenet_sendrecv_afs_bos_server_packets(ciped_t)
+corenet_udp_bind_afs_bos_port(ciped_t)
+corenet_udp_sendrecv_afs_bos_port(ciped_t)
 
-dev_read_sysfs(ciped_t)
 dev_read_rand(ciped_t)
-# for SSP
+dev_read_sysfs(ciped_t)
 dev_read_urand(ciped_t)
 
 domain_use_interactive_fds(ciped_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/clamav.fc refpolicy/policy/modules/contrib/clamav.fc
--- refpolicy/policy/modules/contrib/clamav.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/clamav.fc	2012-10-29 15:48:28.169186457 +0100
@@ -1,20 +1,26 @@
-/etc/clamav(/.*)?			gen_context(system_u:object_r:clamd_etc_t,s0)
-/etc/rc\.d/init\.d/clamd-wrapper --	gen_context(system_u:object_r:clamd_initrc_exec_t,s0)
+/etc/clamav(/.*)?	gen_context(system_u:object_r:clamd_etc_t,s0)
 
-/usr/bin/clamscan		--	gen_context(system_u:object_r:clamscan_exec_t,s0)
-/usr/bin/clamdscan		--	gen_context(system_u:object_r:clamscan_exec_t,s0)
-/usr/bin/freshclam		--	gen_context(system_u:object_r:freshclam_exec_t,s0)
-
-/usr/sbin/clamd			--	gen_context(system_u:object_r:clamd_exec_t,s0)
-/usr/sbin/clamav-milter		--	gen_context(system_u:object_r:clamd_exec_t,s0)
-
-/var/clamav(/.*)?			gen_context(system_u:object_r:clamd_var_lib_t,s0)
-/var/lib/clamav(/.*)?			gen_context(system_u:object_r:clamd_var_lib_t,s0)
-/var/log/clamav.*			gen_context(system_u:object_r:clamd_var_log_t,s0)
+/etc/rc\.d/init\.d/clamd-wrapper	--	gen_context(system_u:object_r:clamd_initrc_exec_t,s0)
+
+/usr/bin/clamscan	--	gen_context(system_u:object_r:clamscan_exec_t,s0)
+/usr/bin/clamdscan	--	gen_context(system_u:object_r:clamscan_exec_t,s0)
+/usr/bin/freshclam	--	gen_context(system_u:object_r:freshclam_exec_t,s0)
+
+/usr/sbin/clamd	--	gen_context(system_u:object_r:clamd_exec_t,s0)
+/usr/sbin/clamav-milter	--	gen_context(system_u:object_r:clamd_exec_t,s0)
+
+/var/clamav(/.*)?	gen_context(system_u:object_r:clamd_var_lib_t,s0)
+
+/var/lib/clamav(/.*)?	gen_context(system_u:object_r:clamd_var_lib_t,s0)
+/var/lib/clamd.*	gen_context(system_u:object_r:clamd_var_lib_t,s0)
+
+/var/log/clamav.*	gen_context(system_u:object_r:clamd_var_log_t,s0)
+/var/log/freshclam.*	--	gen_context(system_u:object_r:freshclam_var_log_t,s0)
 /var/log/clamav/freshclam.*	--	gen_context(system_u:object_r:freshclam_var_log_t,s0)
-/var/log/clamd.*			gen_context(system_u:object_r:clamd_var_log_t,s0)
+/var/log/clamd.*	gen_context(system_u:object_r:clamd_var_log_t,s0)
+
 /var/run/amavis(d)?/clamd\.pid	--	gen_context(system_u:object_r:clamd_var_run_t,s0)
-/var/run/clamav.*			gen_context(system_u:object_r:clamd_var_run_t,s0)
-/var/run/clamd.*			gen_context(system_u:object_r:clamd_var_run_t,s0)
+/var/run/clamav.*	gen_context(system_u:object_r:clamd_var_run_t,s0)
+/var/run/clamd.*	gen_context(system_u:object_r:clamd_var_run_t,s0)
+
 /var/spool/amavisd/clamd\.sock	-s	gen_context(system_u:object_r:clamd_var_run_t,s0)
-/var/spool/MailScanner(/.*)?		gen_context(system_u:object_r:clamd_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/clamav.if refpolicy/policy/modules/contrib/clamav.if
--- refpolicy/policy/modules/contrib/clamav.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/clamav.if	2012-10-06 20:33:24.757753067 +0200
@@ -1,4 +1,4 @@
-## <summary>ClamAV Virus Scanner</summary>
+## <summary>ClamAV Virus Scanner.</summary>
 
 ########################################
 ## <summary>
@@ -15,12 +15,14 @@
 		type clamd_t, clamd_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, clamd_exec_t, clamd_t)
 ')
 
 ########################################
 ## <summary>
-##	Connect to run clamd.
+##	Connect to clamd using a unix
+##	domain stream socket.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -33,13 +35,13 @@
 		type clamd_t, clamd_var_run_t;
 	')
 
+	files_search_pids($1)
 	stream_connect_pattern($1, clamd_var_run_t, clamd_var_run_t, clamd_t)
 ')
 
 ########################################
 ## <summary>
-##	Allow the specified domain to append
-##	to clamav log files.
+##	Append clamav log files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -59,6 +61,27 @@
 
 ########################################
 ## <summary>
+##	Create, read, write, and delete
+##	clamav pid content.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`clamav_manage_pid_content',`
+	gen_require(`
+		type clamd_var_run_t;
+	')
+
+	files_search_pids($1)
+	manage_dirs_pattern($1, clamd_var_run_t, clamd_var_run_t)
+	manage_files_pattern($1, clamd_var_run_t, clamd_var_run_t)
+')
+
+########################################
+## <summary>
 ##	Read clamav configuration files.
 ## </summary>
 ## <param name="domain">
@@ -78,7 +101,7 @@
 
 ########################################
 ## <summary>
-##	Search clamav libraries directories.
+##	Search clamav library directories.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -110,12 +133,13 @@
 		type clamscan_t, clamscan_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, clamscan_exec_t, clamscan_t)
 ')
 
 ########################################
 ## <summary>
-##	Execute clamscan without a transition.
+##	Execute clamscan in the caller domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -128,13 +152,35 @@
 		type clamscan_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	can_exec($1, clamscan_exec_t)
 ')
 
+#######################################
+## <summary>
+##	Read clamd process state files.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`clamav_read_state_clamd',`
+	gen_require(`
+		type clamd_t;
+	')
+
+	kernel_search_proc($1)
+	allow $1 clamd_t:dir list_dir_perms;
+	read_files_pattern($1, clamd_t, clamd_t)
+	read_lnk_files_pattern($1, clamd_t, clamd_t)
+')
+
 ########################################
 ## <summary>
-##	All of the rules required to administrate
-##	an clamav environment
+##	All of the rules required to
+##	administrate an clamav environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -143,7 +189,7 @@
 ## </param>
 ## <param name="role">
 ##	<summary>
-##	The role to be allowed to manage the clamav domain.
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <rolecap/>
@@ -151,20 +197,13 @@
 interface(`clamav_admin',`
 	gen_require(`
 		type clamd_t, clamd_etc_t, clamd_tmp_t;
-		type clamd_var_log_t, clamd_var_lib_t;
+		type clamd_var_log_t, clamd_var_lib_t, clamd_initrc_exec_t;
 		type clamd_var_run_t, clamscan_t, clamscan_tmp_t;
-		type clamd_initrc_exec_t;
 		type freshclam_t, freshclam_var_log_t;
 	')
 
-	allow $1 clamd_t:process { ptrace signal_perms };
-	ps_process_pattern($1, clamd_t)
-
-	allow $1 clamscan_t:process { ptrace signal_perms };
-	ps_process_pattern($1, clamscan_t)
-
-	allow $1 freshclam_t:process { ptrace signal_perms };
-	ps_process_pattern($1, freshclam_t)
+	allow $1 { clamd_t clamscan_t freshclam_t }:process { ptrace signal_perms };
+	ps_process_pattern($1, { clamd_t clamscan_t freshclam_t })
 
 	init_labeled_script_domtrans($1, clamd_initrc_exec_t)
 	domain_system_change_exemption($1)
@@ -178,15 +217,11 @@
 	admin_pattern($1, clamd_var_lib_t)
 
 	logging_list_logs($1)
-	admin_pattern($1, clamd_var_log_t)
+	admin_pattern($1, { clamd_var_log_t freshclam_var_log_t })
 
 	files_list_pids($1)
 	admin_pattern($1, clamd_var_run_t)
 
 	files_list_tmp($1)
-	admin_pattern($1, clamd_tmp_t)
-
-	admin_pattern($1, clamscan_tmp_t)
-
-	admin_pattern($1, freshclam_var_log_t)
+	admin_pattern($1, { clamd_tmp_t clamscan_tmp_t })
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/clamav.te refpolicy/policy/modules/contrib/clamav.te
--- refpolicy/policy/modules/contrib/clamav.te	2012-07-25 20:33:04.000000000 +0200
+++ refpolicy/policy/modules/contrib/clamav.te	2012-10-29 15:48:28.182186457 +0100
@@ -1,9 +1,25 @@
-policy_module(clamav, 1.10.0)
+policy_module(clamav, 1.10.5)
 
 ## <desc>
-## <p>
-## Allow clamd to use JIT compiler
-## </p>
+##	<p>
+##	Determine whether clamscan can
+##	read user content files.
+##	</p>
+## </desc>
+gen_tunable(clamav_read_user_content_files_clamscan, false)
+
+## <desc>
+##	<p>
+##	Determine whether clamscan can read
+##	all non-security files.
+##	</p>
+## </desc>
+gen_tunable(clamav_read_all_non_security_files_clamscan, false)
+
+## <desc>
+##	<p>
+##	Determine whether can clamd use JIT compiler.
+##	</p>
 ## </desc>
 gen_tunable(clamd_use_jit, false)
 
@@ -12,31 +28,25 @@
 # Declarations
 #
 
-# Main clamd domain
 type clamd_t;
 type clamd_exec_t;
 init_daemon_domain(clamd_t, clamd_exec_t)
 
-# configuration files
 type clamd_etc_t;
 files_config_file(clamd_etc_t)
 
 type clamd_initrc_exec_t;
 init_script_file(clamd_initrc_exec_t)
 
-# tmp files
 type clamd_tmp_t;
 files_tmp_file(clamd_tmp_t)
 
-# log files
 type clamd_var_log_t;
 logging_log_file(clamd_var_log_t)
 
-# var/lib files
 type clamd_var_lib_t;
 files_type(clamd_var_lib_t)
 
-# pid files
 type clamd_var_run_t;
 files_pid_file(clamd_var_run_t)
 typealias clamd_var_run_t alias clamd_sock_t;
@@ -45,7 +55,6 @@
 type clamscan_exec_t;
 init_daemon_domain(clamscan_t, clamscan_exec_t)
 
-# tmp files
 type clamscan_tmp_t;
 files_tmp_file(clamscan_tmp_t)
 
@@ -53,45 +62,43 @@
 type freshclam_exec_t;
 init_daemon_domain(freshclam_t, freshclam_exec_t)
 
-# log files
 type freshclam_var_log_t;
 logging_log_file(freshclam_var_log_t)
 
 ########################################
 #
-# clamd local policy
+# Clamd local policy
 #
 
 allow clamd_t self:capability { kill setgid setuid dac_override };
 dontaudit clamd_t self:capability sys_tty_config;
+allow clamd_t self:process signal;
 allow clamd_t self:fifo_file rw_fifo_file_perms;
-allow clamd_t self:unix_stream_socket { create_stream_socket_perms connectto };
-allow clamd_t self:unix_dgram_socket create_socket_perms;
+allow clamd_t self:unix_stream_socket { accept connectto listen };
 allow clamd_t self:tcp_socket { listen accept };
 
-# configuration files
 allow clamd_t clamd_etc_t:dir list_dir_perms;
 read_files_pattern(clamd_t, clamd_etc_t, clamd_etc_t)
 read_lnk_files_pattern(clamd_t, clamd_etc_t, clamd_etc_t)
 
-# tmp files
 manage_dirs_pattern(clamd_t, clamd_tmp_t, clamd_tmp_t)
 manage_files_pattern(clamd_t, clamd_tmp_t, clamd_tmp_t)
 files_tmp_filetrans(clamd_t, clamd_tmp_t, { file dir })
 
-# var/lib files for clamd
 manage_dirs_pattern(clamd_t, clamd_var_lib_t, clamd_var_lib_t)
 manage_files_pattern(clamd_t, clamd_var_lib_t, clamd_var_lib_t)
+manage_sock_files_pattern(clamd_t, clamd_var_lib_t, clamd_var_lib_t)
 
-# log files
 manage_dirs_pattern(clamd_t, clamd_var_log_t, clamd_var_log_t)
-manage_files_pattern(clamd_t, clamd_var_log_t, clamd_var_log_t)
+append_files_pattern(clamd_t, clamd_var_log_t, clamd_var_log_t)
+create_files_pattern(clamd_t, clamd_var_log_t, clamd_var_log_t)
+setattr_files_pattern(clamd_t, clamd_var_log_t, clamd_var_log_t)
 logging_log_filetrans(clamd_t, clamd_var_log_t, { dir file })
 
-# pid file
+manage_dirs_pattern(clamd_t, clamd_var_run_t, clamd_var_run_t)
 manage_files_pattern(clamd_t, clamd_var_run_t, clamd_var_run_t)
 manage_sock_files_pattern(clamd_t, clamd_var_run_t, clamd_var_run_t)
-files_pid_filetrans(clamd_t, clamd_var_run_t, { file dir })
+files_pid_filetrans(clamd_t, clamd_var_run_t, { dir file sock_file })
 
 kernel_dontaudit_list_proc(clamd_t)
 kernel_read_sysctl(clamd_t)
@@ -105,19 +112,22 @@
 corenet_tcp_sendrecv_generic_if(clamd_t)
 corenet_tcp_sendrecv_generic_node(clamd_t)
 corenet_tcp_sendrecv_all_ports(clamd_t)
-corenet_tcp_sendrecv_clamd_port(clamd_t)
 corenet_tcp_bind_generic_node(clamd_t)
-corenet_tcp_bind_clamd_port(clamd_t)
+
+corenet_sendrecv_generic_server_packets(clamd_t)
 corenet_tcp_bind_generic_port(clamd_t)
+
+corenet_sendrecv_generic_client_packets(clamd_t)
 corenet_tcp_connect_generic_port(clamd_t)
+
 corenet_sendrecv_clamd_server_packets(clamd_t)
+corenet_tcp_bind_clamd_port(clamd_t)
 
 dev_read_rand(clamd_t)
 dev_read_urand(clamd_t)
 
 domain_use_interactive_fds(clamd_t)
 
-files_read_etc_files(clamd_t)
 files_read_etc_runtime_files(clamd_t)
 files_search_spool(clamd_t)
 
@@ -127,12 +137,11 @@
 
 miscfiles_read_localization(clamd_t)
 
-cron_use_fds(clamd_t)
-cron_use_system_job_fds(clamd_t)
-cron_rw_pipes(clamd_t)
-
-mta_read_config(clamd_t)
-mta_send_mail(clamd_t)
+tunable_policy(`clamd_use_jit',`
+	allow clamd_t self:process execmem;
+',`
+	dontaudit clamd_t self:process execmem;
+')
 
 optional_policy(`
 	amavis_read_lib_files(clamd_t)
@@ -142,13 +151,18 @@
 ')
 
 optional_policy(`
+	cron_use_fds(clamd_t)
+	cron_use_system_job_fds(clamd_t)
+	cron_rw_pipes(clamd_t)
+')
+
+optional_policy(`
 	exim_read_spool_files(clamd_t)
 ')
 
-tunable_policy(`clamd_use_jit',`
-	allow clamd_t self:process execmem;
-', `
-	dontaudit clamd_t self:process execmem;
+optional_policy(`
+	mta_read_config(clamd_t)
+	mta_send_mail(clamd_t)
 ')
 
 ########################################
@@ -158,45 +172,54 @@
 
 allow freshclam_t self:capability { setgid setuid dac_override };
 allow freshclam_t self:fifo_file rw_fifo_file_perms;
-allow freshclam_t self:unix_stream_socket create_stream_socket_perms;
-allow freshclam_t self:unix_dgram_socket create_socket_perms;
-allow freshclam_t self:tcp_socket { listen accept };
+allow freshclam_t self:unix_stream_socket { accept listen };
+allow freshclam_t self:tcp_socket { accept listen };
 
-# configuration files
 allow freshclam_t clamd_etc_t:dir list_dir_perms;
 read_files_pattern(freshclam_t, clamd_etc_t, clamd_etc_t)
 read_lnk_files_pattern(freshclam_t, clamd_etc_t, clamd_etc_t)
 
-# var/lib files together with clamd
 manage_dirs_pattern(freshclam_t, clamd_var_lib_t, clamd_var_lib_t)
 manage_files_pattern(freshclam_t, clamd_var_lib_t, clamd_var_lib_t)
 
-# pidfiles- var/run together with clamd
 manage_files_pattern(freshclam_t, clamd_var_run_t, clamd_var_run_t)
-manage_sock_files_pattern(freshclam_t, clamd_var_run_t, clamd_var_run_t)
 files_pid_filetrans(freshclam_t, clamd_var_run_t, file)
 
-# log files (own logfiles only)
-manage_files_pattern(freshclam_t, freshclam_var_log_t, freshclam_var_log_t)
-allow freshclam_t freshclam_var_log_t:dir setattr;
-allow freshclam_t clamd_var_log_t:dir search_dir_perms;
+append_files_pattern(freshclam_t, freshclam_var_log_t, freshclam_var_log_t)
+create_files_pattern(freshclam_t, freshclam_var_log_t, freshclam_var_log_t)
+setattr_files_pattern(freshclam_t, freshclam_var_log_t, freshclam_var_log_t)
 logging_log_filetrans(freshclam_t, freshclam_var_log_t, file)
 
+stream_connect_pattern(freshclam_t, clamd_var_run_t, clamd_var_run_t, clamd_t)
+
+read_files_pattern(freshclam_t, clamd_var_log_t, clamd_var_log_t)
+
+kernel_read_kernel_sysctls(freshclam_t)
+kernel_read_network_state(freshclam_t)
+kernel_read_system_state(freshclam_t)
+
 corenet_all_recvfrom_unlabeled(freshclam_t)
 corenet_all_recvfrom_netlabel(freshclam_t)
 corenet_tcp_sendrecv_generic_if(freshclam_t)
 corenet_tcp_sendrecv_generic_node(freshclam_t)
-corenet_tcp_sendrecv_all_ports(freshclam_t)
+
+corenet_sendrecv_clamd_client_packets(freshclam_t)
+corenet_tcp_connect_clamd_port(freshclam_t)
 corenet_tcp_sendrecv_clamd_port(freshclam_t)
-corenet_tcp_connect_http_port(freshclam_t)
+
 corenet_sendrecv_http_client_packets(freshclam_t)
+corenet_tcp_connect_http_port(freshclam_t)
+corenet_tcp_sendrecv_http_port(freshclam_t)
+
+corenet_sendrecv_squid_client_packets(freshclam_t)
+corenet_tcp_connect_squid_port(freshclam_t)
+corenet_tcp_sendrecv_squid_port(freshclam_t)
 
 dev_read_rand(freshclam_t)
 dev_read_urand(freshclam_t)
 
 domain_use_interactive_fds(freshclam_t)
 
-files_read_etc_files(freshclam_t)
 files_read_etc_runtime_files(freshclam_t)
 
 auth_use_nsswitch(freshclam_t)
@@ -205,52 +228,60 @@
 
 miscfiles_read_localization(freshclam_t)
 
-clamav_stream_connect(freshclam_t)
+tunable_policy(`clamd_use_jit',`
+	allow freshclam_t self:process execmem;
+',`
+	dontaudit freshclam_t self:process execmem;
+')
 
 optional_policy(`
-	cron_system_entry(freshclam_t, freshclam_exec_t)
+	amavis_manage_spool_files(freshclam_t)
 ')
 
-tunable_policy(`clamd_use_jit',`
-	allow freshclam_t self:process execmem;
-', `
-	dontaudit freshclam_t self:process execmem;
+optional_policy(`
+	cron_system_entry(freshclam_t, freshclam_exec_t)
 ')
 
 ########################################
 #
-# clamscam local policy
+# Clamscam local policy
 #
 
 allow clamscan_t self:capability { setgid setuid dac_override };
-allow clamscan_t self:fifo_file rw_file_perms;
+allow clamscan_t self:fifo_file rw_fifo_file_perms;
 allow clamscan_t self:unix_stream_socket create_stream_socket_perms;
 allow clamscan_t self:unix_dgram_socket create_socket_perms;
-allow clamscan_t self:tcp_socket create_stream_socket_perms;
+allow clamscan_t self:tcp_socket { accept listen };
 
-# configuration files
 allow clamscan_t clamd_etc_t:dir list_dir_perms;
 read_files_pattern(clamscan_t, clamd_etc_t, clamd_etc_t)
 read_lnk_files_pattern(clamscan_t, clamd_etc_t, clamd_etc_t)
 
-# tmp files
 manage_dirs_pattern(clamscan_t, clamscan_tmp_t, clamscan_tmp_t)
 manage_files_pattern(clamscan_t, clamscan_tmp_t, clamscan_tmp_t)
-files_tmp_filetrans(clamscan_t, clamscan_tmp_t, { file dir })
+files_tmp_filetrans(clamscan_t, clamscan_tmp_t, { dir file })
 
-# var/lib files together with clamd
-manage_files_pattern(clamscan_t, clamd_var_lib_t, clamd_var_lib_t)
 allow clamscan_t clamd_var_lib_t:dir list_dir_perms;
+manage_files_pattern(clamscan_t, clamd_var_lib_t, clamd_var_lib_t)
+
+allow clamscan_t clamd_var_run_t:dir list_dir_perms;
+read_files_pattern(clamscan_t, clamd_var_run_t, clamd_var_run_t)
+
+stream_connect_pattern(clamscan_t, clamd_var_run_t, clamd_var_run_t, clamd_t)
+
+kernel_read_kernel_sysctls(clamscan_t)
+kernel_read_system_state(clamscan_t)
 
 corenet_all_recvfrom_unlabeled(clamscan_t)
 corenet_all_recvfrom_netlabel(clamscan_t)
 corenet_tcp_sendrecv_generic_if(clamscan_t)
 corenet_tcp_sendrecv_generic_node(clamscan_t)
-corenet_tcp_sendrecv_all_ports(clamscan_t)
-corenet_tcp_sendrecv_clamd_port(clamscan_t)
+
+corenet_sendrecv_clamd_client_packets(clamscan_t)
 corenet_tcp_connect_clamd_port(clamscan_t)
+corenet_tcp_sendrecv_clamd_port(clamscan_t)
 
-kernel_read_kernel_sysctls(clamscan_t)
+corecmd_read_all_executables(clamscan_t)
 
 files_read_etc_files(clamscan_t)
 files_read_etc_runtime_files(clamscan_t)
@@ -262,9 +293,18 @@
 miscfiles_read_localization(clamscan_t)
 miscfiles_read_public_files(clamscan_t)
 
-clamav_stream_connect(clamscan_t)
+sysnet_dns_name_resolve(clamscan_t)
+
+tunable_policy(`clamav_read_user_content_files_clamscan',`
+	userdom_read_user_home_content_files(clamscan_t)
+	userdom_dontaudit_read_user_home_content_files(clamscan_t)
+')
 
-mta_send_mail(clamscan_t)
+tunable_policy(`clamav_read_all_non_security_files_clamscan',`
+	files_read_non_security_files(clamscan_t)
+	files_getattr_all_pipes(clamscan_t)
+	files_getattr_all_sockets(clamscan_t)
+')
 
 optional_policy(`
 	amavis_read_spool_files(clamscan_t)
@@ -273,3 +313,8 @@
 optional_policy(`
 	apache_read_sys_content(clamscan_t)
 ')
+
+optional_policy(`
+	mta_send_mail(clamscan_t)
+	mta_read_queue(clamscan_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/clockspeed.fc refpolicy/policy/modules/contrib/clockspeed.fc
--- refpolicy/policy/modules/contrib/clockspeed.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/clockspeed.fc	2012-09-27 20:03:30.740126498 +0200
@@ -1,14 +1,7 @@
-
-#
-# /usr
-#
 /usr/bin/clockadd	--	gen_context(system_u:object_r:clockspeed_cli_exec_t,s0)
 /usr/bin/clockspeed	--	gen_context(system_u:object_r:clockspeed_srv_exec_t,s0)
 /usr/bin/sntpclock	--	gen_context(system_u:object_r:clockspeed_cli_exec_t,s0)
 /usr/bin/taiclock	--	gen_context(system_u:object_r:clockspeed_cli_exec_t,s0)
 /usr/bin/taiclockd	--	gen_context(system_u:object_r:clockspeed_srv_exec_t,s0)
 
-#
-# /var
-#
 /var/lib/clockspeed(/.*)?	gen_context(system_u:object_r:clockspeed_var_lib_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/clockspeed.if refpolicy/policy/modules/contrib/clockspeed.if
--- refpolicy/policy/modules/contrib/clockspeed.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/clockspeed.if	2012-09-27 20:03:30.740126498 +0200
@@ -1,8 +1,9 @@
-## <summary>Clockspeed simple network time protocol client</summary>
+## <summary>Clock speed measurement and manipulation.</summary>
 
 ########################################
 ## <summary>
-##	Execute clockspeed utilities in the clockspeed_cli domain.
+##	Execute clockspeed utilities in
+$$	the clockspeed_cli domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -15,12 +16,15 @@
 		type clockspeed_cli_t, clockspeed_cli_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, clockspeed_cli_exec_t, clockspeed_cli_t)
 ')
 
 ########################################
 ## <summary>
-##	Allow the specified role the clockspeed_cli domain.
+##	Execute clockspeed utilities in the
+##	clockspeed cli domain, and allow the
+##	specified role the clockspeed cli domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -36,9 +40,9 @@
 #
 interface(`clockspeed_run_cli',`
 	gen_require(`
-		type clockspeed_cli_t;
+		attribute_role clockspeed_cli_roles;
 	')
 
-	role $2 types clockspeed_cli_t;
 	clockspeed_domtrans_cli($1)
+	roleattribute $2 clockspeed_cli_roles;
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/clockspeed.te refpolicy/policy/modules/contrib/clockspeed.te
--- refpolicy/policy/modules/contrib/clockspeed.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/clockspeed.te	2012-09-27 20:03:30.740126498 +0200
@@ -1,13 +1,16 @@
-policy_module(clockspeed, 1.5.0)
+policy_module(clockspeed, 1.5.1)
 
 ########################################
 #
 # Declarations
 #
 
+attribute_role clockspeed_cli_roles;
+
 type clockspeed_cli_t;
 type clockspeed_cli_exec_t;
 application_domain(clockspeed_cli_t, clockspeed_cli_exec_t)
+role clockspeed_cli_roles types clockspeed_cli_t;
 
 type clockspeed_srv_t;
 type clockspeed_srv_exec_t;
@@ -30,8 +33,9 @@
 corenet_all_recvfrom_netlabel(clockspeed_cli_t)
 corenet_udp_sendrecv_generic_if(clockspeed_cli_t)
 corenet_udp_sendrecv_generic_node(clockspeed_cli_t)
-corenet_udp_sendrecv_ntp_port(clockspeed_cli_t)
+
 corenet_sendrecv_ntp_client_packets(clockspeed_cli_t)
+corenet_udp_sendrecv_ntp_port(clockspeed_cli_t)
 
 files_list_var_lib(clockspeed_cli_t)
 files_read_etc_files(clockspeed_cli_t)
@@ -57,13 +61,14 @@
 corenet_all_recvfrom_netlabel(clockspeed_srv_t)
 corenet_udp_sendrecv_generic_if(clockspeed_srv_t)
 corenet_udp_sendrecv_generic_node(clockspeed_srv_t)
-corenet_udp_sendrecv_ntp_port(clockspeed_srv_t)
 corenet_udp_bind_generic_node(clockspeed_srv_t)
-corenet_udp_bind_clockspeed_port(clockspeed_srv_t)
+
 corenet_sendrecv_clockspeed_server_packets(clockspeed_srv_t)
+corenet_udp_bind_clockspeed_port(clockspeed_srv_t)
+corenet_udp_sendrecv_clockspeed_port(clockspeed_srv_t)
 
-files_read_etc_files(clockspeed_srv_t)
 files_list_var_lib(clockspeed_srv_t)
+files_read_etc_files(clockspeed_srv_t)
 
 miscfiles_read_localization(clockspeed_srv_t)
 
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/clogd.fc refpolicy/policy/modules/contrib/clogd.fc
--- refpolicy/policy/modules/contrib/clogd.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/clogd.fc	2012-09-27 20:03:30.740126498 +0200
@@ -1,3 +1,3 @@
-/usr/sbin/clogd			--	gen_context(system_u:object_r:clogd_exec_t,s0)
+/usr/sbin/clogd	--	gen_context(system_u:object_r:clogd_exec_t,s0)
 
-/var/run/clogd\.pid		--	gen_context(system_u:object_r:clogd_var_run_t,s0)
+/var/run/clogd\.pid	--	gen_context(system_u:object_r:clogd_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/clogd.if refpolicy/policy/modules/contrib/clogd.if
--- refpolicy/policy/modules/contrib/clogd.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/clogd.if	2012-09-27 20:03:30.740126498 +0200
@@ -1,4 +1,4 @@
-## <summary>clogd - Clustered Mirror Log Server</summary>
+## <summary>Clustered Mirror Log Server.</summary>
 
 ######################################
 ## <summary>
@@ -22,7 +22,7 @@
 #####################################
 ## <summary>
 ##	Connect to clogd over a unix domain
-##	stream socket.
+##	stream socket.  (Deprecated)
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -31,17 +31,12 @@
 ## </param>
 #
 interface(`clogd_stream_connect',`
-	gen_require(`
-		type clogd_t, clogd_var_run_t;
-	')
-
-	files_search_pids($1)
-	stream_connect_pattern($1, clogd_var_run_t, clogd_var_run_t, clogd_t)
+	refpolicywarn(`$0($*) has been deprecated.')
 ')
 
 #####################################
 ## <summary>
-##	Allow read and write access to clogd semaphores.
+##	Read and write clogd semaphores.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -59,7 +54,7 @@
 
 ########################################
 ## <summary>
-##	Read and write to group shared memory.
+##	Read and write clogd shared memory.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/clogd.te refpolicy/policy/modules/contrib/clogd.te
--- refpolicy/policy/modules/contrib/clogd.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/clogd.te	2012-09-27 20:03:30.740126498 +0200
@@ -1,4 +1,4 @@
-policy_module(clogd, 1.0.0)
+policy_module(clogd, 1.0.1)
 
 ########################################
 #
@@ -12,34 +12,29 @@
 type clogd_tmpfs_t;
 files_tmpfs_file(clogd_tmpfs_t)
 
-# pid files
 type clogd_var_run_t;
 files_pid_file(clogd_var_run_t)
 
 ########################################
 #
-# clogd local policy
+# Local policy
 #
 
 allow clogd_t self:capability { net_admin mknod };
 allow clogd_t self:process signal;
-
 allow clogd_t self:sem create_sem_perms;
 allow clogd_t self:shm create_shm_perms;
 allow clogd_t self:netlink_socket create_socket_perms;
-allow clogd_t self:unix_dgram_socket create_socket_perms;
 
 manage_dirs_pattern(clogd_t, clogd_tmpfs_t, clogd_tmpfs_t)
 manage_files_pattern(clogd_t, clogd_tmpfs_t, clogd_tmpfs_t)
 fs_tmpfs_filetrans(clogd_t, clogd_tmpfs_t, { dir file })
 
-# pid files
 manage_files_pattern(clogd_t, clogd_var_run_t, clogd_var_run_t)
-manage_sock_files_pattern(clogd_t, clogd_var_run_t, clogd_var_run_t)
-files_pid_filetrans(clogd_t, clogd_var_run_t, { file })
+files_pid_filetrans(clogd_t, clogd_var_run_t, file)
 
-dev_read_lvm_control(clogd_t)
 dev_manage_generic_blk_files(clogd_t)
+dev_read_lvm_control(clogd_t)
 
 storage_raw_read_fixed_disk(clogd_t)
 storage_raw_write_fixed_disk(clogd_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/cmirrord.fc refpolicy/policy/modules/contrib/cmirrord.fc
--- refpolicy/policy/modules/contrib/cmirrord.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/cmirrord.fc	2012-09-27 20:03:30.741126498 +0200
@@ -1,5 +1,5 @@
 /etc/rc\.d/init\.d/cmirrord	--	gen_context(system_u:object_r:cmirrord_initrc_exec_t,s0)
 
-/usr/sbin/cmirrord		--	gen_context(system_u:object_r:cmirrord_exec_t,s0)
+/usr/sbin/cmirrord	--	gen_context(system_u:object_r:cmirrord_exec_t,s0)
 
-/var/run/cmirrord\.pid		--	gen_context(system_u:object_r:cmirrord_var_run_t,s0)
+/var/run/cmirrord\.pid	--	gen_context(system_u:object_r:cmirrord_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/cmirrord.if refpolicy/policy/modules/contrib/cmirrord.if
--- refpolicy/policy/modules/contrib/cmirrord.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/cmirrord.if	2012-09-27 20:03:30.741126498 +0200
@@ -1,8 +1,9 @@
-## <summary>Cluster mirror log daemon</summary>
+## <summary>Cluster mirror log daemon.</summary>
 
 ########################################
 ## <summary>
-##	Execute a domain transition to run cmirrord.
+##	Execute a domain transition to
+##	run cmirrord.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -15,12 +16,14 @@
 		type cmirrord_t, cmirrord_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, cmirrord_exec_t, cmirrord_t)
 ')
 
 ########################################
 ## <summary>
-##	Execute cmirrord server in the cmirrord domain.
+##	Execute cmirrord server in the
+##	cmirrord domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -57,7 +60,7 @@
 
 #######################################
 ## <summary>
-##	Read and write to cmirrord shared memory.
+##	Read and write cmirrord shared memory.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -80,8 +83,8 @@
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate
-##	an cmirrord environment
+##	All of the rules required to
+##	administrate an cmirrord environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/cmirrord.te refpolicy/policy/modules/contrib/cmirrord.te
--- refpolicy/policy/modules/contrib/cmirrord.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/cmirrord.te	2012-09-27 20:03:30.741126498 +0200
@@ -1,4 +1,4 @@
-policy_module(cmirrord, 1.0.0)
+policy_module(cmirrord, 1.0.1)
 
 ########################################
 #
@@ -20,23 +20,22 @@
 
 ########################################
 #
-# cmirrord local policy
+# Local policy
 #
 
 allow cmirrord_t self:capability { net_admin kill };
 dontaudit cmirrord_t self:capability sys_tty_config;
-allow cmirrord_t self:process { setfscreate signal};
+allow cmirrord_t self:process { setfscreate signal };
 allow cmirrord_t self:fifo_file rw_fifo_file_perms;
 allow cmirrord_t self:sem create_sem_perms;
 allow cmirrord_t self:shm create_shm_perms;
 allow cmirrord_t self:netlink_socket create_socket_perms;
-allow cmirrord_t self:unix_stream_socket create_stream_socket_perms;
+allow cmirrord_t self:unix_stream_socket { accept listen };
 
 manage_dirs_pattern(cmirrord_t, cmirrord_tmpfs_t, cmirrord_tmpfs_t)
 manage_files_pattern(cmirrord_t, cmirrord_tmpfs_t, cmirrord_tmpfs_t)
 fs_tmpfs_filetrans(cmirrord_t, cmirrord_tmpfs_t, { dir file })
 
-manage_dirs_pattern(cmirrord_t, cmirrord_var_run_t, cmirrord_var_run_t)
 manage_files_pattern(cmirrord_t, cmirrord_var_run_t, cmirrord_var_run_t)
 files_pid_filetrans(cmirrord_t, cmirrord_var_run_t, file)
 
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/cobbler.fc refpolicy/policy/modules/contrib/cobbler.fc
--- refpolicy/policy/modules/contrib/cobbler.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/cobbler.fc	2012-10-16 19:35:35.241013957 +0200
@@ -1,7 +1,22 @@
-/etc/cobbler(/.*)?		gen_context(system_u:object_r:cobbler_etc_t, s0)
-/etc/rc\.d/init\.d/cobblerd --	gen_context(system_u:object_r:cobblerd_initrc_exec_t, s0)
+/etc/cobbler(/.*)?	gen_context(system_u:object_r:cobbler_etc_t,s0)
 
-/usr/bin/cobblerd	--	gen_context(system_u:object_r:cobblerd_exec_t, s0)
+/etc/rc\.d/init\.d/cobblerd	--	gen_context(system_u:object_r:cobblerd_initrc_exec_t,s0)
 
-/var/lib/cobbler(/.*)?		gen_context(system_u:object_r:cobbler_var_lib_t, s0)
-/var/log/cobbler(/.*)?		gen_context(system_u:object_r:cobbler_var_log_t, s0)
+/usr/bin/cobblerd	--	gen_context(system_u:object_r:cobblerd_exec_t,s0)
+
+/var/lib/cobbler(/.*)?	gen_context(system_u:object_r:cobbler_var_lib_t,s0)
+
+/var/lib/tftpboot/etc(/.*)?	gen_context(system_u:object_r:cobbler_var_lib_t,s0)
+/var/lib/tftpboot/grub(/.*)?	gen_context(system_u:object_r:cobbler_var_lib_t,s0)
+/var/lib/tftpboot/images(/.*)?	gen_context(system_u:object_r:cobbler_var_lib_t,s0)
+/var/lib/tftpboot/memdisk	--	gen_context(system_u:object_r:cobbler_var_lib_t,s0)
+/var/lib/tftpboot/menu\.c32	--	gen_context(system_u:object_r:cobbler_var_lib_t,s0)
+/var/lib/tftpboot/ppc(/.*)?	gen_context(system_u:object_r:cobbler_var_lib_t,s0)
+/var/lib/tftpboot/pxelinux\.0	--	gen_context(system_u:object_r:cobbler_var_lib_t,s0)
+/var/lib/tftpboot/pxelinux\.cfg(/.*)?	gen_context(system_u:object_r:cobbler_var_lib_t,s0)
+/var/lib/tftpboot/s390x(/.*)?	gen_context(system_u:object_r:cobbler_var_lib_t,s0)
+/var/lib/tftpboot/yaboot	--	gen_context(system_u:object_r:cobbler_var_lib_t,s0)
+
+/var/log/cobbler(/.*)?	gen_context(system_u:object_r:cobbler_var_log_t,s0)
+
+/var/www/cobbler(/.*)?	gen_context(system_u:object_r:cobbler_var_lib_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/cobbler.if refpolicy/policy/modules/contrib/cobbler.if
--- refpolicy/policy/modules/contrib/cobbler.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/cobbler.if	2012-10-24 17:01:46.303003154 +0200
@@ -1,14 +1,4 @@
 ## <summary>Cobbler installation server.</summary>
-## <desc>
-##	<p>
-##		Cobbler is a Linux installation server that allows for
-##		rapid setup of network installation environments. It
-##		glues together and automates many associated Linux
-##		tasks so you do not have to hop between lots of various
-##		commands and applications when rolling out new systems,
-##		and, in some cases, changing existing ones.
-##	</p>
-## </desc>
 
 ########################################
 ## <summary>
@@ -25,12 +15,14 @@
 		type cobblerd_t, cobblerd_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, cobblerd_exec_t, cobblerd_t)
 ')
 
 ########################################
 ## <summary>
-##	Execute cobblerd server in the cobblerd domain.
+##	Execute cobblerd init scripts in
+##	the init script domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -48,7 +40,7 @@
 
 ########################################
 ## <summary>
-##	Read Cobbler content in /etc
+##	Read cobbler configuration files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -68,7 +60,7 @@
 ########################################
 ## <summary>
 ##	Do not audit attempts to read and write
-##	Cobbler log files (leaked fd).
+##	cobbler log files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -86,7 +78,7 @@
 
 ########################################
 ## <summary>
-##	Search cobbler dirs in /var/lib
+##	Search cobbler lib directories.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -99,13 +91,13 @@
 		type cobbler_var_lib_t;
 	')
 
-	search_dirs_pattern($1, cobbler_var_lib_t, cobbler_var_lib_t)
 	files_search_var_lib($1)
+	search_dirs_pattern($1, cobbler_var_lib_t, cobbler_var_lib_t)
 ')
 
 ########################################
 ## <summary>
-##	Read cobbler files in /var/lib
+##	Read cobbler lib files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -118,13 +110,14 @@
 		type cobbler_var_lib_t;
 	')
 
-	read_files_pattern($1, cobbler_var_lib_t, cobbler_var_lib_t)
 	files_search_var_lib($1)
+	read_files_pattern($1, cobbler_var_lib_t, cobbler_var_lib_t)
 ')
 
 ########################################
 ## <summary>
-##	Manage cobbler files in /var/lib
+##	Create, read, write, and delete
+##	cobbler lib files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -137,14 +130,14 @@
 		type cobbler_var_lib_t;
 	')
 
-	manage_files_pattern($1, cobbler_var_lib_t, cobbler_var_lib_t)
 	files_search_var_lib($1)
+	manage_files_pattern($1, cobbler_var_lib_t, cobbler_var_lib_t)
 ')
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate
-##	an cobblerd environment
+##	All of the rules required to
+##	administrate an cobbler environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -159,27 +152,54 @@
 ## <rolecap/>
 #
 interface(`cobblerd_admin',`
+	refpolicywarn(`$0($*) has been deprecated, use cobbler_admin() instead.')
+	cobbler_admin($1, $2)
+')
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an cobbler environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`cobbler_admin',`
 	gen_require(`
 		type cobblerd_t, cobbler_var_lib_t, cobbler_var_log_t;
-		type cobbler_etc_t, cobblerd_initrc_exec_t;
+		type cobbler_etc_t, cobblerd_initrc_exec_t, httpd_cobbler_content_t;
+		type httpd_cobbler_content_ra_t, httpd_cobbler_content_rw_t, cobbler_tmp_t;
 	')
 
-	allow $1 cobblerd_t:process { ptrace signal_perms getattr };
-	read_files_pattern($1, cobblerd_t, cobblerd_t)
+	allow $1 cobblerd_t:process { ptrace signal_perms };
+	ps_process_pattern($1, cobblerd_t)
+
+	cobblerd_initrc_domtrans($1)
+	domain_system_change_exemption($1)
+	role_transition $2 cobblerd_initrc_exec_t system_r;
+	allow $2 system_r;
 
 	files_search_etc($1)
 	admin_pattern($1, cobbler_etc_t)
 
-	files_list_var_lib($1)
+	files_search_tmp($1)
+	admin_pattern($1, cobbler_tmp_t)
+
+	files_search_var_lib($1)
 	admin_pattern($1, cobbler_var_lib_t)
 
 	logging_search_logs($1)
 	admin_pattern($1, cobbler_var_log_t)
 
-	admin_pattern($1, httpd_cobbler_content_rw_t)
-
-	cobblerd_initrc_domtrans($1)
-	domain_system_change_exemption($1)
-	role_transition $2 cobblerd_initrc_exec_t system_r;
-	allow $2 system_r;
+	apache_search_sys_content($1)
+	admin_pattern($1, { httpd_cobbler_content_t httpd_cobbler_content_ra_t httpd_cobbler_content_rw_t })
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/cobbler.te refpolicy/policy/modules/contrib/cobbler.te
--- refpolicy/policy/modules/contrib/cobbler.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/cobbler.te	2012-10-24 17:01:46.312003154 +0200
@@ -1,18 +1,44 @@
-policy_module(cobbler, 1.1.0)
+policy_module(cobbler, 1.1.3)
 
 ########################################
 #
-# Cobbler personal declarations.
+# Declarations
 #
 
+
 ## <desc>
-## <p>
-## Allow Cobbler to modify public files
-## used for public file transfer services.
-## </p>
+##	<p>
+##	Determine whether Cobbler can modify
+##	public files used for public file
+##	transfer services.
+##	</p>
 ## </desc>
 gen_tunable(cobbler_anon_write, false)
 
+## <desc>
+##	<p>
+##	Determine whether Cobbler can connect
+##	to the network using TCP.
+##	</p>
+## </desc>
+gen_tunable(cobbler_can_network_connect, false)
+
+## <desc>
+##	<p>
+##	Determine whether Cobbler can access
+##	cifs file systems.
+##	</p>
+## </desc>
+gen_tunable(cobbler_use_cifs, false)
+
+## <desc>
+##	<p>
+##	Determine whether Cobbler can access
+##	nfs file systems.
+##	</p>
+## </desc>
+gen_tunable(cobbler_use_nfs, false)
+
 type cobblerd_t;
 type cobblerd_exec_t;
 init_daemon_domain(cobblerd_t, cobblerd_exec_t)
@@ -26,25 +52,34 @@
 type cobbler_var_log_t;
 logging_log_file(cobbler_var_log_t)
 
-type cobbler_var_lib_t;
+type cobbler_var_lib_t alias cobbler_content_t;
 files_type(cobbler_var_lib_t)
 
+type cobbler_tmp_t;
+files_tmp_file(cobbler_tmp_t)
+
 ########################################
 #
-# Cobbler personal policy.
+# Local policy
 #
 
-allow cobblerd_t self:capability { chown dac_override fowner sys_nice };
+allow cobblerd_t self:capability { chown dac_override fowner fsetid sys_nice };
+dontaudit cobblerd_t self:capability sys_tty_config;
 allow cobblerd_t self:process { getsched setsched signal };
 allow cobblerd_t self:fifo_file rw_fifo_file_perms;
-allow cobblerd_t self:tcp_socket create_stream_socket_perms;
+allow cobblerd_t self:tcp_socket { accept listen };
 
 list_dirs_pattern(cobblerd_t, cobbler_etc_t, cobbler_etc_t)
 read_files_pattern(cobblerd_t, cobbler_etc_t, cobbler_etc_t)
 
+manage_dirs_pattern(cobblerd_t, cobbler_tmp_t, cobbler_tmp_t)
+manage_files_pattern(cobblerd_t, cobbler_tmp_t, cobbler_tmp_t)
+files_tmp_filetrans(cobblerd_t, cobbler_tmp_t, { dir file })
+
 manage_dirs_pattern(cobblerd_t, cobbler_var_lib_t, cobbler_var_lib_t)
 manage_files_pattern(cobblerd_t, cobbler_var_lib_t, cobbler_var_lib_t)
-files_var_lib_filetrans(cobblerd_t, cobbler_var_lib_t, { dir file })
+manage_lnk_files_pattern(cobblerd_t, cobbler_var_lib_t, cobbler_var_lib_t)
+files_var_lib_filetrans(cobblerd_t, cobbler_var_lib_t, dir)
 
 append_files_pattern(cobblerd_t, cobbler_var_log_t, cobbler_var_log_t)
 create_files_pattern(cobblerd_t, cobbler_var_log_t, cobbler_var_log_t)
@@ -53,31 +88,51 @@
 logging_log_filetrans(cobblerd_t, cobbler_var_log_t, file)
 
 kernel_read_system_state(cobblerd_t)
+kernel_dontaudit_search_network_state(cobblerd_t)
 
 corecmd_exec_bin(cobblerd_t)
 corecmd_exec_shell(cobblerd_t)
 
 corenet_all_recvfrom_netlabel(cobblerd_t)
 corenet_all_recvfrom_unlabeled(cobblerd_t)
-corenet_sendrecv_cobbler_server_packets(cobblerd_t)
-corenet_tcp_bind_cobbler_port(cobblerd_t)
-corenet_tcp_bind_generic_node(cobblerd_t)
 corenet_tcp_sendrecv_generic_if(cobblerd_t)
 corenet_tcp_sendrecv_generic_node(cobblerd_t)
-corenet_tcp_sendrecv_generic_port(cobblerd_t)
+corenet_tcp_bind_generic_node(cobblerd_t)
+
+corenet_sendrecv_cobbler_server_packets(cobblerd_t)
+corenet_tcp_bind_cobbler_port(cobblerd_t)
+corenet_tcp_sendrecv_cobbler_port(cobblerd_t)
+
+corenet_sendrecv_ftp_client_packets(cobblerd_t)
+corenet_tcp_connect_ftp_port(cobblerd_t)
+corenet_tcp_sendrecv_ftp_port(cobblerd_t)
+
+corenet_tcp_sendrecv_http_port(cobblerd_t)
+corenet_tcp_connect_http_port(cobblerd_t)
+corenet_sendrecv_http_client_packets(cobblerd_t)
 
 dev_read_urand(cobblerd_t)
 
-files_read_usr_files(cobblerd_t)
 files_list_boot(cobblerd_t)
 files_list_tmp(cobblerd_t)
-# read /etc/nsswitch.conf
+files_read_boot_files(cobblerd_t)
 files_read_etc_files(cobblerd_t)
+files_read_etc_runtime_files(cobblerd_t)
+files_read_usr_files(cobblerd_t)
+
+fs_getattr_all_fs(cobblerd_t)
+fs_read_iso9660_files(cobblerd_t)
+
+selinux_get_enforce_mode(cobblerd_t)
+
+term_use_console(cobblerd_t)
+
+logging_send_syslog_msg(cobblerd_t)
 
 miscfiles_read_localization(cobblerd_t)
 miscfiles_read_public_files(cobblerd_t)
 
-sysnet_read_config(cobblerd_t)
+sysnet_dns_name_resolve(cobblerd_t)
 sysnet_rw_dhcp_config(cobblerd_t)
 sysnet_write_config(cobblerd_t)
 
@@ -85,6 +140,28 @@
 	miscfiles_manage_public_files(cobblerd_t)
 ')
 
+tunable_policy(`cobbler_can_network_connect',`
+	corenet_sendrecv_all_client_packets(cobblerd_t)
+	corenet_tcp_connect_all_ports(cobblerd_t)
+	corenet_tcp_sendrecv_all_ports(cobblerd_t)
+')
+
+tunable_policy(`cobbler_use_cifs',`
+	fs_manage_cifs_dirs(cobblerd_t)
+	fs_manage_cifs_files(cobblerd_t)
+	fs_manage_cifs_symlinks(cobblerd_t)
+')
+
+tunable_policy(`cobbler_use_nfs',`
+	fs_manage_nfs_dirs(cobblerd_t)
+	fs_manage_nfs_files(cobblerd_t)
+	fs_manage_nfs_symlinks(cobblerd_t)
+')
+
+optional_policy(`
+	apache_search_sys_content(cobblerd_t)
+')
+
 optional_policy(`
 	bind_read_config(cobblerd_t)
 	bind_write_config(cobblerd_t)
@@ -95,6 +172,10 @@
 ')
 
 optional_policy(`
+	certmaster_exec(cobblerd_t)
+')
+
+optional_policy(`
 	dhcpd_domtrans(cobblerd_t)
 	dhcpd_initrc_domtrans(cobblerd_t)
 ')
@@ -111,18 +192,12 @@
 
 optional_policy(`
 	rsync_read_config(cobblerd_t)
-	rsync_write_config(cobblerd_t)
+	rsync_manage_config_files(cobblerd_t)
+	rsync_etc_filetrans_config(cobblerd_t, file, "rsync.conf")
 ')
 
 optional_policy(`
-	tftp_manage_rw_content(cobblerd_t)
+	tftp_manage_config_files(cobblerd_t)
+	tftp_etc_filetrans_config(cobblerd_t, file, "tftp")
+	tftp_filetrans_tftpdir(cobblerd_t, cobbler_var_lib_t, { dir file })
 ')
-
-########################################
-#
-# Cobbler web local policy.
-#
-
-apache_content_template(cobbler)
-manage_dirs_pattern(cobblerd_t, httpd_cobbler_content_rw_t, httpd_cobbler_content_rw_t)
-manage_files_pattern(cobblerd_t, httpd_cobbler_content_rw_t, httpd_cobbler_content_rw_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/collectd.fc refpolicy/policy/modules/contrib/collectd.fc
--- refpolicy/policy/modules/contrib/collectd.fc	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/collectd.fc	2012-09-27 20:03:30.384126498 +0200
@@ -0,0 +1,9 @@
+/etc/rc\.d/init\.d/collectd	--	gen_context(system_u:object_r:collectd_initrc_exec_t,s0)
+
+/usr/sbin/collectd	--	gen_context(system_u:object_r:collectd_exec_t,s0)
+
+/var/lib/collectd(/.*)?	gen_context(system_u:object_r:collectd_var_lib_t,s0)
+
+/var/run/collectd\.pid	--	gen_context(system_u:object_r:collectd_var_run_t,s0)
+
+/usr/share/collectd/collection3/bin/.*\.cgi	--	gen_context(system_u:object_r:httpd_collectd_script_exec_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/collectd.if refpolicy/policy/modules/contrib/collectd.if
--- refpolicy/policy/modules/contrib/collectd.if	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/collectd.if	2012-09-27 20:03:30.384126498 +0200
@@ -0,0 +1,39 @@
+## <summary>Statistics collection daemon for filling RRD files.</summary>
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an collectd environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`collectd_admin',`
+	gen_require(`
+		type collectd_t, collectd_initrc_exec_t, collectd_var_run_t;
+		type collectd_var_lib_t;
+	')
+
+	allow $1 collectd_t:process { ptrace signal_perms };
+	ps_process_pattern($1, collectd_t)
+
+	init_labeled_script_domtrans($1, collectd_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 collectd_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	files_search_pids($1)
+	admin_pattern($1, collectd_var_run_t)
+
+	files_search_var_lib($1)
+	admin_pattern($1, collectd_var_lib_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/collectd.te refpolicy/policy/modules/contrib/collectd.te
--- refpolicy/policy/modules/contrib/collectd.te	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/collectd.te	2012-09-27 20:03:30.384126498 +0200
@@ -0,0 +1,90 @@
+policy_module(collectd, 1.0.0)
+
+########################################
+#
+# Declarations
+#
+
+## <desc>
+##	<p>
+##	Determine whether collectd can connect
+##	to the network using TCP.
+##	</p>
+## </desc>
+gen_tunable(collectd_tcp_network_connect, false)
+
+type collectd_t;
+type collectd_exec_t;
+init_daemon_domain(collectd_t, collectd_exec_t)
+
+type collectd_initrc_exec_t;
+init_script_file(collectd_initrc_exec_t)
+
+type collectd_var_lib_t;
+files_type(collectd_var_lib_t)
+
+type collectd_var_run_t;
+files_pid_file(collectd_var_run_t)
+
+apache_content_template(collectd)
+
+########################################
+#
+# Local policy
+#
+
+allow collectd_t self:capability { ipc_lock sys_nice };
+allow collectd_t self:process { getsched setsched signal };
+allow collectd_t self:fifo_file rw_fifo_file_perms;
+allow collectd_t self:packet_socket create_socket_perms;
+allow collectd_t self:unix_stream_socket { accept listen };
+
+manage_dirs_pattern(collectd_t, collectd_var_lib_t, collectd_var_lib_t)
+manage_files_pattern(collectd_t, collectd_var_lib_t, collectd_var_lib_t)
+files_var_lib_filetrans(collectd_t, collectd_var_lib_t, dir)
+
+manage_files_pattern(collectd_t, collectd_var_run_t, collectd_var_run_t)
+files_pid_filetrans(collectd_t, collectd_var_run_t, file)
+
+domain_use_interactive_fds(collectd_t)
+
+kernel_read_network_state(collectd_t)
+kernel_read_net_sysctls(collectd_t)
+kernel_read_system_state(collectd_t)
+
+dev_read_rand(collectd_t)
+dev_read_sysfs(collectd_t)
+dev_read_urand(collectd_t)
+
+files_getattr_all_dirs(collectd_t)
+files_read_etc_files(collectd_t)
+files_read_usr_files(collectd_t)
+
+fs_getattr_all_fs(collectd_t)
+
+miscfiles_read_localization(collectd_t)
+
+logging_send_syslog_msg(collectd_t)
+
+sysnet_dns_name_resolve(collectd_t)
+
+tunable_policy(`collectd_tcp_network_connect',`
+	corenet_sendrecv_all_client_packets(collectd_t)
+	corenet_tcp_connect_all_ports(collectd_t)
+	corenet_tcp_sendrecv_all_ports(collectd_t)
+')
+
+optional_policy(`
+	virt_read_config(collectd_t)
+')
+
+########################################
+#
+# Web local policy
+#
+
+optional_policy(`
+	read_files_pattern(httpd_collectd_script_t, collectd_var_lib_t, collectd_var_lib_t)
+	list_dirs_pattern(httpd_collectd_script_t, collectd_var_lib_t, collectd_var_lib_t)
+	miscfiles_setattr_fonts_cache_dirs(httpd_collectd_script_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/colord.fc refpolicy/policy/modules/contrib/colord.fc
--- refpolicy/policy/modules/contrib/colord.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/colord.fc	2012-09-27 20:03:30.741126498 +0200
@@ -1,4 +1,5 @@
 /usr/libexec/colord	--	gen_context(system_u:object_r:colord_exec_t,s0)
+/usr/libexec/colord-sane	--	gen_context(system_u:object_r:colord_exec_t,s0)
 
-/var/lib/color(/.*)?		gen_context(system_u:object_r:colord_var_lib_t,s0)
-/var/lib/colord(/.*)?		gen_context(system_u:object_r:colord_var_lib_t,s0)
+/var/lib/color(/.*)?	gen_context(system_u:object_r:colord_var_lib_t,s0)
+/var/lib/colord(/.*)?	gen_context(system_u:object_r:colord_var_lib_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/colord.if refpolicy/policy/modules/contrib/colord.if
--- refpolicy/policy/modules/contrib/colord.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/colord.if	2012-09-27 20:03:30.742126498 +0200
@@ -1,4 +1,4 @@
-## <summary>GNOME color manager</summary>
+## <summary>GNOME color manager.</summary>
 
 ########################################
 ## <summary>
@@ -15,6 +15,7 @@
 		type colord_t, colord_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, colord_exec_t, colord_t)
 ')
 
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/colord.te refpolicy/policy/modules/contrib/colord.te
--- refpolicy/policy/modules/contrib/colord.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/colord.te	2012-09-27 20:03:30.742126498 +0200
@@ -1,4 +1,4 @@
-policy_module(colord, 1.0.0)
+policy_module(colord, 1.0.1)
 
 ########################################
 #
@@ -20,14 +20,16 @@
 
 ########################################
 #
-# colord local policy
+# Local policy
 #
+
 allow colord_t self:capability { dac_read_search dac_override };
+dontaudit colord_t self:capability sys_admin;
 allow colord_t self:process signal;
 allow colord_t self:fifo_file rw_fifo_file_perms;
 allow colord_t self:netlink_kobject_uevent_socket create_socket_perms;
-allow colord_t self:udp_socket create_socket_perms;
-allow colord_t self:unix_dgram_socket create_socket_perms;
+allow colord_t self:tcp_socket { accept listen };
+allow colord_t self:shm create_shm_perms;
 
 manage_dirs_pattern(colord_t, colord_tmp_t, colord_tmp_t)
 manage_files_pattern(colord_t, colord_tmp_t, colord_tmp_t)
@@ -39,17 +41,34 @@
 
 manage_dirs_pattern(colord_t, colord_var_lib_t, colord_var_lib_t)
 manage_files_pattern(colord_t, colord_var_lib_t, colord_var_lib_t)
-files_var_lib_filetrans(colord_t, colord_var_lib_t, { file dir })
+files_var_lib_filetrans(colord_t, colord_var_lib_t, dir)
 
-kernel_getattr_proc_files(colord_t)
 kernel_read_device_sysctls(colord_t)
+kernel_read_network_state(colord_t)
+kernel_read_system_state(colord_t)
+kernel_request_load_module(colord_t)
 
-corenet_all_recvfrom_unlabeled(colord_t)
 corenet_all_recvfrom_netlabel(colord_t)
+corenet_all_recvfrom_unlabeled(colord_t)
+corenet_tcp_sendrecv_generic_if(colord_t)
+corenet_udp_sendrecv_generic_if(colord_t)
+corenet_tcp_sendrecv_generic_node(colord_t)
+corenet_udp_sendrecv_generic_node(colord_t)
 corenet_udp_bind_generic_node(colord_t)
+
+corenet_sendrecv_ipp_server_packets(colord_t)
 corenet_udp_bind_ipp_port(colord_t)
+corenet_udp_sendrecv_ipp_port(colord_t)
+
+corenet_sendrecv_ipp_client_packets(colord_t)
 corenet_tcp_connect_ipp_port(colord_t)
+corenet_tcp_sendrecv_ipp_port(colord_t)
+
+corecmd_exec_bin(colord_t)
+corecmd_exec_shell(colord_t)
 
+dev_read_raw_memory(colord_t)
+dev_write_raw_memory(colord_t)
 dev_read_video_dev(colord_t)
 dev_write_video_dev(colord_t)
 dev_rw_printer(colord_t)
@@ -62,22 +81,33 @@
 domain_use_interactive_fds(colord_t)
 
 files_list_mnt(colord_t)
-files_read_etc_files(colord_t)
 files_read_usr_files(colord_t)
 
+fs_getattr_noxattr_fs(colord_t)
+fs_getattr_tmpfs(colord_t)
+fs_list_noxattr_fs(colord_t)
 fs_read_noxattr_fs_files(colord_t)
+fs_search_all(colord_t)
+fs_dontaudit_getattr_all_fs(colord_t)
+
+storage_getattr_fixed_disk_dev(colord_t)
+storage_getattr_removable_dev(colord_t)
+storage_read_scsi_generic(colord_t)
+storage_write_scsi_generic(colord_t)
+
+auth_use_nsswitch(colord_t)
 
 logging_send_syslog_msg(colord_t)
 
 miscfiles_read_localization(colord_t)
 
-sysnet_dns_name_resolve(colord_t)
-
 tunable_policy(`use_nfs_home_dirs',`
+	fs_getattr_nfs(colord_t)
 	fs_read_nfs_files(colord_t)
 ')
 
 tunable_policy(`use_samba_home_dirs',`
+	fs_getattr_cifs(colord_t)
 	fs_read_cifs_files(colord_t)
 ')
 
@@ -96,5 +126,9 @@
 ')
 
 optional_policy(`
+	sysnet_exec_ifconfig(colord_t)
+')
+
+optional_policy(`
 	udev_read_db(colord_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/comsat.fc refpolicy/policy/modules/contrib/comsat.fc
--- refpolicy/policy/modules/contrib/comsat.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/comsat.fc	2012-09-27 20:03:30.742126498 +0200
@@ -1,2 +1 @@
-
 /usr/sbin/in\.comsat	--	gen_context(system_u:object_r:comsat_exec_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/comsat.te refpolicy/policy/modules/contrib/comsat.te
--- refpolicy/policy/modules/contrib/comsat.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/comsat.te	2012-09-27 20:03:30.742126498 +0200
@@ -1,4 +1,4 @@
-policy_module(comsat, 1.7.0)
+policy_module(comsat, 1.7.1)
 
 ########################################
 #
@@ -8,7 +8,6 @@
 type comsat_t;
 type comsat_exec_t;
 inetd_udp_service_domain(comsat_t, comsat_exec_t)
-role system_r types comsat_t;
 
 type comsat_tmp_t;
 files_tmp_file(comsat_tmp_t)
@@ -25,8 +24,7 @@
 allow comsat_t self:process signal_perms;
 allow comsat_t self:fifo_file rw_fifo_file_perms;
 allow comsat_t self:netlink_tcpdiag_socket r_netlink_socket_perms;
-allow comsat_t self:tcp_socket connected_stream_socket_perms;
-allow comsat_t self:udp_socket create_socket_perms;
+allow comsat_t self:tcp_socket { accept listen };
 
 manage_dirs_pattern(comsat_t, comsat_tmp_t, comsat_tmp_t)
 manage_files_pattern(comsat_t, comsat_tmp_t, comsat_tmp_t)
@@ -39,19 +37,10 @@
 kernel_read_network_state(comsat_t)
 kernel_read_system_state(comsat_t)
 
-corenet_all_recvfrom_unlabeled(comsat_t)
-corenet_all_recvfrom_netlabel(comsat_t)
-corenet_tcp_sendrecv_generic_if(comsat_t)
-corenet_udp_sendrecv_generic_if(comsat_t)
-corenet_tcp_sendrecv_generic_node(comsat_t)
-corenet_udp_sendrecv_generic_node(comsat_t)
-corenet_udp_sendrecv_all_ports(comsat_t)
-
 dev_read_urand(comsat_t)
 
 fs_getattr_xattr_fs(comsat_t)
 
-files_read_etc_files(comsat_t)
 files_list_usr(comsat_t)
 files_search_spool(comsat_t)
 files_search_home(comsat_t)
@@ -68,7 +57,3 @@
 userdom_dontaudit_getattr_user_ttys(comsat_t)
 
 mta_getattr_spool(comsat_t)
-
-optional_policy(`
-	kerberos_use(comsat_t)
-')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/condor.fc refpolicy/policy/modules/contrib/condor.fc
--- refpolicy/policy/modules/contrib/condor.fc	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/condor.fc	2012-09-27 20:03:30.742126498 +0200
@@ -0,0 +1,21 @@
+/etc/rc\.d/init\.d/condor	--	gen_context(system_u:object_r:condor_initrc_exec_t,s0)
+
+/usr/sbin/condor_collector	--	gen_context(system_u:object_r:condor_collector_exec_t,s0)
+/usr/sbin/condor_master	--	gen_context(system_u:object_r:condor_master_exec_t,s0)
+/usr/sbin/condor_negotiator	--	gen_context(system_u:object_r:condor_negotiator_exec_t,s0)
+/usr/sbin/condor_procd	--	gen_context(system_u:object_r:condor_procd_exec_t,s0)
+/usr/sbin/condor_schedd	--	gen_context(system_u:object_r:condor_schedd_exec_t,s0)
+/usr/sbin/condor_startd	--	gen_context(system_u:object_r:condor_startd_exec_t,s0)
+/usr/sbin/condor_starter	--	gen_context(system_u:object_r:condor_startd_exec_t,s0)
+
+/var/lib/condor(/.*)?	gen_context(system_u:object_r:condor_var_lib_t,s0)
+
+/var/lib/condor/execute(/.*)?	gen_context(system_u:object_r:condor_var_lib_t,s0)
+
+/var/lib/condor/spool(/.*)?	gen_context(system_u:object_r:condor_var_lib_t,s0)
+
+/var/lock/condor(/.*)?	gen_context(system_u:object_r:condor_var_lock_t,s0)
+
+/var/log/condor(/.*)?	gen_context(system_u:object_r:condor_log_t,s0)
+
+/var/run/condor(/.*)?	gen_context(system_u:object_r:condor_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/condor.if refpolicy/policy/modules/contrib/condor.if
--- refpolicy/policy/modules/contrib/condor.if	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/condor.if	2012-09-27 20:03:30.742126498 +0200
@@ -0,0 +1,88 @@
+## <summary>High-Throughput Computing System.</summary>
+
+#######################################
+## <summary>
+##	The template to define a condor domain.
+## </summary>
+## <param name="domain_prefix">
+##	<summary>
+##	Domain prefix to be used.
+##	</summary>
+## </param>
+#
+template(`condor_domain_template',`
+	gen_require(`
+		attribute condor_domain;
+		type condor_master_t;
+	')
+
+	#############################
+	#
+	# Declarations
+	#
+
+	type condor_$1_t, condor_domain;
+	type condor_$1_exec_t;
+	domain_type(condor_$1_t)
+	domain_entry_file(condor_$1_t, condor_$1_exec_t)
+	role system_r types condor_$1_t;
+
+	#############################
+	#
+	# Policy
+	#
+
+	domtrans_pattern(condor_master_t, condor_$1_exec_t, condor_$1_t)
+	allow condor_master_t condor_$1_exec_t:file ioctl;
+
+	auth_use_nsswitch(condor_$1_t)
+')
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an condor environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`condor_admin',`
+	gen_require(`
+		attribute condor_domain;
+		type condor_initrc_exec_config_t, condor_log_t;
+		type condor_var_lib_t, condor_var_lock_t, condor_schedd_tmp_t;
+		type condor_var_run_t, condor_startd_tmp_t;
+	')
+
+	allow $1 condor_domain:process { ptrace signal_perms };
+	ps_process_pattern($1, condor_domain)
+
+	init_labeled_script_domtrans($1, condor_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 condor_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	logging_search_logs($1)
+	admin_pattern($1, condor_log_t)
+
+	files_search_locks($1)
+	admin_pattern($1, condor_var_lock_t)
+
+	files_search_var_lib($1)
+	admin_pattern($1, condor_var_lib_t)
+
+	files_search_pids($1)
+	admin_pattern($1, condor_var_run_t)
+
+	files_search_tmp($1)
+	admin_pattern($1, { condor_schedd_tmp_t condor_startd_tmp_t })
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/condor.te refpolicy/policy/modules/contrib/condor.te
--- refpolicy/policy/modules/contrib/condor.te	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/condor.te	2012-09-27 20:03:30.742126498 +0200
@@ -0,0 +1,236 @@
+policy_module(condor, 1.0.0)
+
+########################################
+#
+# Declarations
+#
+
+## <desc>
+##	<p>
+##	Determine whether Condor can connect
+##	to the network using TCP.
+##	</p>
+## </desc>
+gen_tunable(condor_tcp_network_connect, false)
+
+attribute condor_domain;
+
+type condor_master_t, condor_domain;
+type condor_master_exec_t;
+init_daemon_domain(condor_master_t, condor_master_exec_t)
+
+type condor_initrc_exec_t;
+init_script_file(condor_initrc_exec_t)
+
+type condor_schedd_tmp_t;
+files_tmp_file(condor_schedd_tmp_t)
+
+type condor_startd_tmp_t;
+files_tmp_file(condor_startd_tmp_t)
+
+type condor_startd_tmpfs_t;
+files_tmpfs_file(condor_startd_tmpfs_t)
+
+type condor_log_t;
+logging_log_file(condor_log_t)
+
+type condor_var_lib_t;
+files_type(condor_var_lib_t)
+
+type condor_var_lock_t;
+files_lock_file(condor_var_lock_t)
+
+type condor_var_run_t;
+files_pid_file(condor_var_run_t)
+
+condor_domain_template(collector)
+condor_domain_template(negotiator)
+condor_domain_template(procd)
+condor_domain_template(schedd)
+condor_domain_template(startd)
+
+#####################################
+#
+# Global local policy
+#
+
+allow condor_domain self:process signal_perms;
+allow condor_domain self:fifo_file rw_fifo_file_perms;
+allow condor_domain self:tcp_socket { accept listen };
+allow condor_domain self:unix_stream_socket { accept listen };
+
+manage_dirs_pattern(condor_domain, condor_log_t, condor_log_t)
+append_files_pattern(condor_domain, condor_log_t, condor_log_t)
+create_files_pattern(condor_domain, condor_log_t, condor_log_t)
+getattr_files_pattern(condor_domain, condor_log_t, condor_log_t)
+logging_log_filetrans(condor_domain, condor_log_t, { dir file })
+
+manage_dirs_pattern(condor_domain, condor_var_lib_t, condor_var_lib_t)
+manage_files_pattern(condor_domain, condor_var_lib_t, condor_var_lib_t)
+files_var_lib_filetrans(condor_domain, condor_var_lib_t, { dir file })
+
+manage_dirs_pattern(condor_domain, condor_var_lock_t, condor_var_lock_t)
+manage_files_pattern(condor_domain, condor_var_lock_t, condor_var_lock_t)
+files_lock_filetrans(condor_domain, condor_var_lock_t, { dir file })
+
+manage_dirs_pattern(condor_domain, condor_var_run_t, condor_var_run_t)
+manage_files_pattern(condor_domain, condor_var_run_t, condor_var_run_t)
+manage_fifo_files_pattern(condor_domain, condor_var_run_t, condor_var_run_t)
+files_pid_filetrans(condor_domain, condor_var_run_t, { dir file fifo_file })
+
+allow condor_domain condor_master_t:process signull;
+allow condor_domain condor_master_t:tcp_socket getattr;
+
+kernel_read_kernel_sysctls(condor_domain)
+kernel_read_network_state(condor_domain)
+kernel_read_system_state(condor_domain)
+
+corecmd_exec_bin(condor_domain)
+corecmd_exec_shell(condor_domain)
+
+corenet_all_recvfrom_netlabel(condor_domain)
+corenet_all_recvfrom_unlabeled(condor_domain)
+corenet_tcp_sendrecv_generic_if(condor_domain)
+corenet_tcp_sendrecv_generic_node(condor_domain)
+
+corenet_sendrecv_condor_client_packets(condor_domain)
+corenet_tcp_connect_condor_port(condor_domain)
+corenet_tcp_sendrecv_condor_port(condor_domain)
+
+domain_use_interactive_fds(condor_domain)
+
+dev_read_rand(condor_domain)
+dev_read_sysfs(condor_domain)
+dev_read_urand(condor_domain)
+
+logging_send_syslog_msg(condor_domain)
+
+miscfiles_read_localization(condor_domain)
+
+tunable_policy(`condor_tcp_network_connect',`
+	corenet_sendrecv_all_client_packets(condor_domain)
+	corenet_tcp_connect_all_ports(condor_domain)
+	corenet_tcp_sendrecv_all_ports(condor_domain)
+')
+
+optional_policy(`
+	rhcs_stream_connect_cluster(condor_domain)
+')
+
+#####################################
+#
+# Master local policy
+#
+
+allow condor_master_t self:capability { setuid setgid dac_override sys_ptrace };
+
+allow condor_master_t condor_domain:process signal;
+
+corenet_udp_sendrecv_generic_if(condor_master_t)
+corenet_udp_sendrecv_generic_node(condor_master_t)
+corenet_tcp_bind_generic_node(condor_master_t)
+corenet_udp_bind_generic_node(condor_master_t)
+
+corenet_sendrecv_condor_server_packets(condor_master_t)
+corenet_tcp_bind_condor_port(condor_master_t)
+corenet_tcp_sendrecv_condor_port(condor_master_t)
+corenet_udp_bind_condor_port(condor_master_t)
+corenet_udp_sendrecv_condor_port(condor_master_t)
+
+corenet_sendrecv_amqp_client_packets(condor_master_t)
+corenet_tcp_connect_amqp_port(condor_master_t)
+corenet_tcp_sendrecv_amqp_port(condor_master_t)
+
+domain_read_all_domains_state(condor_master_t)
+
+auth_use_nsswitch(condor_master_t)
+
+######################################
+#
+# Collector local policy
+#
+
+allow condor_collector_t self:capability { setuid setgid };
+
+allow condor_collector_t condor_master_t:tcp_socket rw_stream_socket_perms;
+allow condor_collector_t condor_master_t:udp_socket rw_socket_perms;
+
+kernel_read_network_state(condor_collector_t)
+
+#####################################
+#
+# Negotiator local policy
+#
+allow condor_negotiator_t self:capability { setuid setgid };
+allow condor_negotiator_t condor_master_t:tcp_socket rw_stream_socket_perms;
+allow condor_negotiator_t condor_master_t:udp_socket getattr;
+
+######################################
+#
+# Procd local policy
+#
+
+allow condor_procd_t self:capability { fowner chown dac_override sys_ptrace };
+
+domain_read_all_domains_state(condor_procd_t)
+
+#######################################
+#
+# Schedd local policy
+#
+
+allow condor_schedd_t self:capability { setuid chown setgid dac_override };
+
+allow condor_schedd_t condor_master_t:tcp_socket rw_stream_socket_perms;
+allow condor_schedd_t condor_master_t:udp_socket getattr;
+
+allow condor_schedd_t condor_var_lock_t:dir manage_file_perms;
+
+domtrans_pattern(condor_schedd_t, condor_procd_exec_t, condor_procd_t)
+domtrans_pattern(condor_schedd_t, condor_startd_exec_t, condor_startd_t)
+
+manage_dirs_pattern(condor_schedd_t, condor_schedd_tmp_t, condor_schedd_tmp_t)
+manage_files_pattern(condor_schedd_t, condor_schedd_tmp_t, condor_schedd_tmp_t)
+relabel_files_pattern(condor_schedd_t, condor_schedd_tmp_t, condor_schedd_tmp_t)
+files_tmp_filetrans(condor_schedd_t, condor_schedd_tmp_t, { file dir })
+
+#####################################
+#
+# Startd local policy
+#
+
+allow condor_startd_t self:capability { setuid net_admin setgid dac_override };
+allow condor_startd_t self:process execmem;
+
+manage_dirs_pattern(condor_startd_t, condor_startd_tmp_t, condor_startd_tmp_t)
+manage_files_pattern(condor_startd_t, condor_startd_tmp_t, condor_startd_tmp_t)
+relabel_files_pattern(condor_startd_t, condor_startd_tmp_t, condor_startd_tmp_t)
+files_tmp_filetrans(condor_startd_t, condor_startd_tmp_t, { file dir })
+
+manage_dirs_pattern(condor_startd_t, condor_startd_tmpfs_t, condor_startd_tmpfs_t)
+manage_files_pattern(condor_startd_t, condor_startd_tmpfs_t, condor_startd_tmpfs_t)
+fs_tmpfs_filetrans(condor_startd_t, condor_startd_tmpfs_t, { dir file })
+
+can_exec(condor_startd_t, condor_startd_exec_t)
+
+domain_read_all_domains_state(condor_startd_t)
+
+mcs_process_set_categories(condor_startd_t)
+
+init_domtrans_script(condor_startd_t)
+
+libs_exec_lib_files(condor_startd_t)
+
+files_read_usr_files(condor_startd_t)
+
+optional_policy(`
+	ssh_basic_client_template(condor_startd, condor_startd_t, system_r)
+	ssh_domtrans(condor_startd_t)
+
+	manage_files_pattern(condor_startd_ssh_t, condor_var_lib_t, condor_var_lib_t)
+	manage_dirs_pattern(condor_startd_ssh_t, condor_var_lib_t, condor_var_lib_t)
+
+	optional_policy(`
+		kerberos_use(condor_startd_ssh_t)
+	')
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/consolekit.fc refpolicy/policy/modules/contrib/consolekit.fc
--- refpolicy/policy/modules/contrib/consolekit.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/consolekit.fc	2012-09-27 20:03:30.742126498 +0200
@@ -1,7 +1,7 @@
 /usr/sbin/console-kit-daemon	--	gen_context(system_u:object_r:consolekit_exec_t,s0)
 
-/var/log/ConsoleKit(/.*)?		gen_context(system_u:object_r:consolekit_log_t,s0)
+/var/log/ConsoleKit(/.*)?	gen_context(system_u:object_r:consolekit_log_t,s0)
 
+/var/run/ConsoleKit(/.*)?	gen_context(system_u:object_r:consolekit_var_run_t,s0)
 /var/run/consolekit\.pid	--	gen_context(system_u:object_r:consolekit_var_run_t,s0)
-/var/run/console-kit-daemon\.pid --	gen_context(system_u:object_r:consolekit_var_run_t,s0)
-/var/run/ConsoleKit(/.*)?		gen_context(system_u:object_r:consolekit_var_run_t,s0)
+/var/run/console-kit-daemon\.pid	--	gen_context(system_u:object_r:consolekit_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/consolekit.if refpolicy/policy/modules/contrib/consolekit.if
--- refpolicy/policy/modules/contrib/consolekit.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/consolekit.if	2012-09-27 20:03:30.743126498 +0200
@@ -15,6 +15,7 @@
 		type consolekit_t, consolekit_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, consolekit_exec_t, consolekit_t)
 ')
 
@@ -60,7 +61,8 @@
 
 ########################################
 ## <summary>
-##	Manage consolekit log files.
+##	Create, read, write, and delete
+##	consolekit log files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/consolekit.te refpolicy/policy/modules/contrib/consolekit.te
--- refpolicy/policy/modules/contrib/consolekit.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/consolekit.te	2012-11-01 21:49:29.786785940 +0100
@@ -1,4 +1,4 @@
-policy_module(consolekit, 1.8.0)
+policy_module(consolekit, 1.8.3)
 
 ########################################
 #
@@ -12,29 +12,40 @@
 type consolekit_log_t;
 logging_log_file(consolekit_log_t)
 
+type consolekit_tmpfs_t;
+files_tmpfs_file(consolekit_tmpfs_t)
+
 type consolekit_var_run_t;
 files_pid_file(consolekit_var_run_t)
+init_daemon_run_dir(consolekit_var_run_t, "ConsoleKit")
 
 ########################################
 #
-# consolekit local policy
+# Local policy
 #
 
 allow consolekit_t self:capability { chown setuid setgid sys_tty_config dac_override sys_nice sys_ptrace };
 allow consolekit_t self:process { getsched signal };
 allow consolekit_t self:fifo_file rw_fifo_file_perms;
-allow consolekit_t self:unix_stream_socket create_stream_socket_perms;
-allow consolekit_t self:unix_dgram_socket create_socket_perms;
+allow consolekit_t self:unix_stream_socket { accept listen };
 
-manage_files_pattern(consolekit_t, consolekit_log_t, consolekit_log_t)
+create_files_pattern(consolekit_t, consolekit_log_t, consolekit_log_t)
+append_files_pattern(consolekit_t, consolekit_log_t, consolekit_log_t)
+read_files_pattern(consolekit_t, consolekit_log_t, consolekit_log_t)
+setattr_files_pattern(consolekit_t, consolekit_log_t, consolekit_log_t)
 logging_log_filetrans(consolekit_t, consolekit_log_t, file)
 
 manage_dirs_pattern(consolekit_t, consolekit_var_run_t, consolekit_var_run_t)
 manage_files_pattern(consolekit_t, consolekit_var_run_t, consolekit_var_run_t)
-files_pid_filetrans(consolekit_t, consolekit_var_run_t, { file dir })
+files_pid_filetrans(consolekit_t, consolekit_var_run_t, { dir file })
 
 kernel_read_system_state(consolekit_t)
 
+corenet_all_recvfrom_unlabeled(consolekit_t)
+corenet_all_recvfrom_netlabel(consolekit_t)
+corenet_tcp_sendrecv_generic_if(consolekit_t)
+corenet_tcp_sendrecv_generic_node(consolekit_t)
+
 corecmd_exec_bin(consolekit_t)
 corecmd_exec_shell(consolekit_t)
 
@@ -45,7 +56,6 @@
 domain_use_interactive_fds(consolekit_t)
 domain_dontaudit_ptrace_all_domains(consolekit_t)
 
-files_read_etc_files(consolekit_t)
 files_read_usr_files(consolekit_t)
 # needs to read /var/lib/dbus/machine-id
 files_read_var_lib_files(consolekit_t)
@@ -61,9 +71,6 @@
 auth_manage_pam_console_data(consolekit_t)
 auth_write_login_records(consolekit_t)
 
-init_telinit(consolekit_t)
-init_rw_utmp(consolekit_t)
-
 logging_send_syslog_msg(consolekit_t)
 logging_send_audit_msgs(consolekit_t)
 
@@ -72,6 +79,16 @@
 userdom_dontaudit_read_user_home_content_files(consolekit_t)
 userdom_read_user_tmp_files(consolekit_t)
 
+ifdef(`distro_gentoo',`
+	# consolekit daemon creates /var/run/console for tagfiles
+	auth_generic_run_filetrans_pam_console_data(consolekit_t, dir, "console")
+	auth_create_pam_console_data_dirs(consolekit_t)
+
+	optional_policy(`
+		dbus_read_lib_files(consolekit_t)
+	')
+')
+
 tunable_policy(`use_nfs_home_dirs',`
 	fs_read_nfs_files(consolekit_t)
 ')
@@ -88,6 +105,10 @@
 	')
 
 	optional_policy(`
+		policykit_dbus_chat(consolekit_t)
+	')
+
+	optional_policy(`
 		rpm_dbus_chat(consolekit_t)
 	')
 
@@ -101,20 +122,26 @@
 ')
 
 optional_policy(`
-	policykit_dbus_chat(consolekit_t)
+	networkmanager_append_log_files(consolekit_t)
+')
+
+optional_policy(`
 	policykit_domtrans_auth(consolekit_t)
 	policykit_read_lib(consolekit_t)
 	policykit_read_reload(consolekit_t)
 ')
 
 optional_policy(`
-	type consolekit_tmpfs_t;
-	files_tmpfs_file(consolekit_tmpfs_t)
+	shutdown_domtrans(consolekit_t)
+')
 
+optional_policy(`
+	corenet_sendrecv_xserver_client_packets(consolekit_t)
+	corenet_tcp_connect_xserver_port(consolekit_t)
+	corenet_tcp_sendrecv_xserver_port(consolekit_t)
+	xserver_non_drawing_client(consolekit_t)
 	xserver_read_xdm_pid(consolekit_t)
 	xserver_read_user_xauth(consolekit_t)
-	xserver_non_drawing_client(consolekit_t)
-	corenet_tcp_connect_xserver_port(consolekit_t)
 	xserver_stream_connect(consolekit_t)
 	xserver_user_x_domain_template(consolekit, consolekit_t, consolekit_tmpfs_t)
 ')
@@ -126,6 +153,5 @@
 ')
 
 optional_policy(`
-	#reading .Xauthity
 	unconfined_stream_connect(consolekit_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/corosync.fc refpolicy/policy/modules/contrib/corosync.fc
--- refpolicy/policy/modules/contrib/corosync.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/corosync.fc	2012-09-27 20:03:30.743126498 +0200
@@ -1,12 +1,15 @@
 /etc/rc\.d/init\.d/corosync	--	gen_context(system_u:object_r:corosync_initrc_exec_t,s0)
 
-/usr/sbin/corosync		--	gen_context(system_u:object_r:corosync_exec_t,s0)
+/usr/sbin/corosync	--	gen_context(system_u:object_r:corosync_exec_t,s0)
+/usr/sbin/corosync-notifyd	--	gen_context(system_u:object_r:corosync_exec_t,s0)
 
-/usr/sbin/ccs_tool		--	gen_context(system_u:object_r:corosync_exec_t,s0)
+/usr/sbin/ccs_tool	--	gen_context(system_u:object_r:corosync_exec_t,s0)
+/usr/sbin/cman_tool	--	gen_context(system_u:object_r:corosync_exec_t,s0)
 
-/var/lib/corosync(/.*)?			gen_context(system_u:object_r:corosync_var_lib_t,s0)
+/var/lib/corosync(/.*)?	gen_context(system_u:object_r:corosync_var_lib_t,s0)
 
-/var/log/cluster/corosync\.log	--	gen_context(system_u:object_r:corosync_var_log_t,s0)
+/var/log/cluster/corosync\.log.*	--	gen_context(system_u:object_r:corosync_var_log_t,s0)
 
-/var/run/cman_.*		-s	gen_context(system_u:object_r:corosync_var_run_t,s0)
-/var/run/corosync\.pid		--	gen_context(system_u:object_r:corosync_var_run_t,s0)
+/var/run/cman_.*	-s	gen_context(system_u:object_r:corosync_var_run_t,s0)
+/var/run/corosync\.pid	--	gen_context(system_u:object_r:corosync_var_run_t,s0)
+/var/run/rsctmp(/.*)?	gen_context(system_u:object_r:corosync_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/corosync.if refpolicy/policy/modules/contrib/corosync.if
--- refpolicy/policy/modules/contrib/corosync.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/corosync.if	2012-10-24 17:01:49.485003161 +0200
@@ -1,4 +1,4 @@
-## <summary>Corosync Cluster Engine</summary>
+## <summary>Corosync Cluster Engine.</summary>
 
 ########################################
 ## <summary>
@@ -15,12 +15,32 @@
 		type corosync_t, corosync_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, corosync_exec_t, corosync_t)
 ')
 
+######################################
+## <summary>
+##	Execute corosync in the caller domain.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`corosync_exec',`
+	gen_require(`
+		type corosync_exec_t;
+	')
+
+	corecmd_search_bin($1)
+	can_exec($1, corosync_exec_t)
+')
+
 #######################################
 ## <summary>
-##	Allow the specified domain to read corosync's log files.
+##	Read corosync log files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -40,8 +60,8 @@
 
 #####################################
 ## <summary>
-##	Connect to corosync over a unix domain
-##	stream socket.
+##	Connect to corosync over a unix
+##	domain stream socket.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -60,8 +80,8 @@
 
 ######################################
 ## <summary>
-##	All of the rules required to administrate
-##	an corosync environment
+##	All of the rules required to
+##	administrate an corosync environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -70,7 +90,7 @@
 ## </param>
 ## <param name="role">
 ##	<summary>
-##	The role to be allowed to manage the corosyncd domain.
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <rolecap/>
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/corosync.te refpolicy/policy/modules/contrib/corosync.te
--- refpolicy/policy/modules/contrib/corosync.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/corosync.te	2012-11-06 21:18:54.518011607 +0100
@@ -1,4 +1,4 @@
-policy_module(corosync, 1.0.0)
+policy_module(corosync, 1.0.3)
 
 ########################################
 #
@@ -8,6 +8,7 @@
 type corosync_t;
 type corosync_exec_t;
 init_daemon_domain(corosync_t, corosync_exec_t)
+domain_obj_id_change_exemption(corosync_t)
 
 type corosync_initrc_exec_t;
 init_script_file(corosync_initrc_exec_t)
@@ -29,21 +30,22 @@
 
 ########################################
 #
-# corosync local policy
+# Local policy
 #
 
-allow corosync_t self:capability { sys_nice sys_resource ipc_lock };
-allow corosync_t self:process { setrlimit setsched signal };
-
+allow corosync_t self:capability { dac_override setuid setgid sys_nice sys_admin sys_resource ipc_lock };
+# for hearbeat
+allow corosync_t self:capability { net_raw chown };
+allow corosync_t self:process { setpgid setrlimit setsched signal signull };
 allow corosync_t self:fifo_file rw_fifo_file_perms;
 allow corosync_t self:sem create_sem_perms;
-allow corosync_t self:unix_stream_socket { create_stream_socket_perms connectto };
-allow corosync_t self:unix_dgram_socket create_socket_perms;
-allow corosync_t self:udp_socket create_socket_perms;
+allow corosync_t self:shm create_shm_perms;
+allow corosync_t self:unix_stream_socket { accept connectto listen };
 
 manage_dirs_pattern(corosync_t, corosync_tmp_t, corosync_tmp_t)
 manage_files_pattern(corosync_t, corosync_tmp_t, corosync_tmp_t)
-files_tmp_filetrans(corosync_t, corosync_tmp_t, { file dir })
+relabel_files_pattern(corosync_t, corosync_tmp_t, corosync_tmp_t)
+files_tmp_filetrans(corosync_t, corosync_tmp_t, { dir file })
 
 manage_dirs_pattern(corosync_t, corosync_tmpfs_t, corosync_tmpfs_t)
 manage_files_pattern(corosync_t, corosync_tmpfs_t, corosync_tmpfs_t)
@@ -52,30 +54,49 @@
 manage_files_pattern(corosync_t, corosync_var_lib_t, corosync_var_lib_t)
 manage_dirs_pattern(corosync_t, corosync_var_lib_t, corosync_var_lib_t)
 manage_sock_files_pattern(corosync_t, corosync_var_lib_t, corosync_var_lib_t)
-files_var_lib_filetrans(corosync_t, corosync_var_lib_t, { file dir sock_file })
+manage_fifo_files_pattern(corosync_t, corosync_var_lib_t,corosync_var_lib_t)
+files_var_lib_filetrans(corosync_t,corosync_var_lib_t, { dir fifo_file file sock_file })
 
-manage_files_pattern(corosync_t, corosync_var_log_t, corosync_var_log_t)
-manage_sock_files_pattern(corosync_t, corosync_var_log_t, corosync_var_log_t)
-logging_log_filetrans(corosync_t, corosync_var_log_t, { sock_file file })
+create_files_pattern(corosync_t, corosync_var_log_t, corosync_var_log_t)
+append_files_pattern(corosync_t, corosync_var_log_t, corosync_var_log_t)
+setattr_files_pattern(corosync_t, corosync_var_log_t, corosync_var_log_t)
+logging_log_filetrans(corosync_t, corosync_var_log_t, file)
 
 manage_files_pattern(corosync_t, corosync_var_run_t, corosync_var_run_t)
 manage_sock_files_pattern(corosync_t, corosync_var_run_t, corosync_var_run_t)
-files_pid_filetrans(corosync_t, corosync_var_run_t, { file sock_file })
+manage_dirs_pattern(corosync_t, corosync_var_run_t,corosync_var_run_t)
+files_pid_filetrans(corosync_t, corosync_var_run_t, { file sock_file dir })
+
+can_exec(corosync_t, corosync_exec_t)
 
+kernel_read_net_sysctls(corosync_t)
+kernel_read_network_state(corosync_t)
+kernel_read_kernel_sysctls(corosync_t)
 kernel_read_system_state(corosync_t)
 
 corecmd_exec_bin(corosync_t)
+corecmd_exec_shell(corosync_t)
+
+corenet_all_recvfrom_unlabeled(corosync_t)
+corenet_all_recvfrom_netlabel(corosync_t)
+corenet_udp_sendrecv_generic_if(corosync_t)
+corenet_udp_sendrecv_generic_node(corosync_t)
+corenet_udp_bind_generic_node(corosync_t)
 
+corenet_sendrecv_netsupport_server_packets(corosync_t)
 corenet_udp_bind_netsupport_port(corosync_t)
+corenet_udp_sendrecv_netsupport_port(corosync_t)
 
 dev_read_urand(corosync_t)
 
 domain_read_all_domains_state(corosync_t)
 
 files_manage_mounttab(corosync_t)
+files_read_usr_files(corosync_t)
 
 auth_use_nsswitch(corosync_t)
 
+init_domtrans_script(corosync_t)
 init_read_script_state(corosync_t)
 init_rw_script_tmp_files(corosync_t)
 
@@ -83,21 +104,44 @@
 
 miscfiles_read_localization(corosync_t)
 
-userdom_rw_user_tmpfs_files(corosync_t)
+userdom_read_user_tmp_files(corosync_t)
+userdom_manage_user_tmpfs_files(corosync_t)
 
 optional_policy(`
 	ccs_read_config(corosync_t)
 ')
 
 optional_policy(`
-	# to communication with RHCS
-	rhcs_rw_dlm_controld_semaphores(corosync_t)
+	cmirrord_rw_shm(corosync_t)
+')
+
+optional_policy(`
+	consoletype_exec(corosync_t)
+')
+
+optional_policy(`
+	dbus_system_bus_client(corosync_t)
+')
 
-	rhcs_rw_fenced_semaphores(corosync_t)
+optional_policy(`
+	drbd_domtrans(corosync_t)
+')
 
-	rhcs_rw_gfs_controld_semaphores(corosync_t)
+optional_policy(`
+	qpidd_rw_shm(corosync_t)
+')
+
+optional_policy(`
+	rhcs_getattr_fenced_exec_files(corosync_t)
+	rhcs_rw_cluster_shm(corosync_t)
+	rhcs_rw_cluster_semaphores(corosync_t)
+	rhcs_stream_connect_cluster(corosync_t)
 ')
 
 optional_policy(`
 	rgmanager_manage_tmpfs_files(corosync_t)
 ')
+
+optional_policy(`
+	rpc_search_nfs_state_data(corosync_t)
+')
\ No newline at end of file
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/couchdb.fc refpolicy/policy/modules/contrib/couchdb.fc
--- refpolicy/policy/modules/contrib/couchdb.fc	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/couchdb.fc	2012-09-27 20:03:30.384126498 +0200
@@ -0,0 +1,11 @@
+/etc/couchdb(/.*)?	gen_context(system_u:object_r:couchdb_conf_t,s0)
+
+/etc/rc\.d/init\.d/couchdb	--	gen_context(system_u:object_r:couchdb_initrc_exec_t,s0)
+
+/usr/bin/couchdb	--	gen_context(system_u:object_r:couchdb_exec_t,s0)
+
+/var/lib/couchdb(/.*)?	gen_context(system_u:object_r:couchdb_var_lib_t,s0)
+
+/var/log/couchdb(/.*)?	gen_context(system_u:object_r:couchdb_log_t,s0)
+
+/var/run/couchdb(/.*)?	gen_context(system_u:object_r:couchdb_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/couchdb.if refpolicy/policy/modules/contrib/couchdb.if
--- refpolicy/policy/modules/contrib/couchdb.if	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/couchdb.if	2012-09-27 20:03:30.384126498 +0200
@@ -0,0 +1,49 @@
+## <summary>Document database server.</summary>
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an couchdb environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`couchdb_admin',`
+	gen_require(`
+		type couchdb_t, couchdb_conf_t, couchdb_initrc_exec_t;
+		type couchdb_log_t, couchdb_var_lib_t, couchdb_var_run_t;
+		type couchdb_tmp_t;
+	')
+
+	allow $1 couchdb_t:process { ptrace signal_perms };
+	ps_process_pattern($1, couchdb_t)
+
+	init_labeled_script_domtrans($1, couchdb_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 couchdb_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	files_search_etc($1)
+	admin_pattern($1, couchdb_conf_t)
+
+	logging_search_logs($1)
+	admin_pattern($1, couchdb_log_t)
+
+	files_search_tmp($1)
+	admin_pattern($1, couchdb_tmp_t)
+
+	files_search_var_lib($1)
+	admin_pattern($1, couchdb_var_lib_t)
+
+	files_search_pids($1)
+	admin_pattern($1, couchdb_var_run_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/couchdb.te refpolicy/policy/modules/contrib/couchdb.te
--- refpolicy/policy/modules/contrib/couchdb.te	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/couchdb.te	2012-09-27 20:03:30.384126498 +0200
@@ -0,0 +1,88 @@
+policy_module(couchdb, 1.0.2)
+
+########################################
+#
+# Declarations
+#
+
+type couchdb_t;
+type couchdb_exec_t;
+init_daemon_domain(couchdb_t, couchdb_exec_t)
+
+type couchdb_initrc_exec_t;
+init_script_file(couchdb_initrc_exec_t)
+
+type couchdb_conf_t;
+files_config_file(couchdb_conf_t)
+
+type couchdb_log_t;
+logging_log_file(couchdb_log_t)
+
+type couchdb_tmp_t;
+files_tmp_file(couchdb_tmp_t)
+
+type couchdb_var_lib_t;
+files_type(couchdb_var_lib_t)
+
+type couchdb_var_run_t;
+files_pid_file(couchdb_var_run_t)
+
+########################################
+#
+# Local policy
+#
+
+allow couchdb_t self:process { setsched signal signull sigkill };
+allow couchdb_t self:fifo_file rw_fifo_file_perms;
+allow couchdb_t self:unix_stream_socket create_stream_socket_perms;
+allow couchdb_t self:tcp_socket { accept listen };
+
+allow couchdb_t couchdb_conf_t:dir list_dir_perms;
+allow couchdb_t couchdb_conf_t:file read_file_perms;
+
+manage_dirs_pattern(couchdb_t, couchdb_log_t, couchdb_log_t)
+append_files_pattern(couchdb_t, couchdb_log_t, couchdb_log_t)
+create_files_pattern(couchdb_t, couchdb_log_t, couchdb_log_t)
+setattr_files_pattern(couchdb_t, couchdb_log_t, couchdb_log_t)
+logging_log_filetrans(couchdb_t, couchdb_log_t, dir)
+
+manage_dirs_pattern(couchdb_t, couchdb_tmp_t, couchdb_tmp_t)
+manage_files_pattern(couchdb_t, couchdb_tmp_t, couchdb_tmp_t)
+files_tmp_filetrans(couchdb_t, couchdb_tmp_t, { dir file })
+
+manage_dirs_pattern(couchdb_t, couchdb_var_lib_t, couchdb_var_lib_t)
+manage_files_pattern(couchdb_t, couchdb_var_lib_t, couchdb_var_lib_t)
+files_var_lib_filetrans(couchdb_t, couchdb_var_lib_t, dir)
+
+manage_dirs_pattern(couchdb_t, couchdb_var_run_t, couchdb_var_run_t)
+manage_files_pattern(couchdb_t, couchdb_var_run_t, couchdb_var_run_t)
+files_pid_filetrans(couchdb_t, couchdb_var_run_t, dir)
+
+can_exec(couchdb_t, couchdb_exec_t)
+
+kernel_read_system_state(couchdb_t)
+
+corecmd_exec_bin(couchdb_t)
+corecmd_exec_shell(couchdb_t)
+
+corenet_all_recvfrom_unlabeled(couchdb_t)
+corenet_all_recvfrom_netlabel(couchdb_t)
+corenet_tcp_sendrecv_generic_if(couchdb_t)
+corenet_tcp_sendrecv_generic_node(couchdb_t)
+corenet_tcp_bind_generic_node(couchdb_t)
+
+corenet_sendrecv_couchdb_server_packets(couchdb_t)
+corenet_tcp_bind_couchdb_port(couchdb_t)
+corenet_tcp_sendrecv_couchdb_port(couchdb_t)
+
+dev_list_sysfs(couchdb_t)
+dev_read_sysfs(couchdb_t)
+dev_read_urand(couchdb_t)
+
+files_read_usr_files(couchdb_t)
+
+fs_getattr_xattr_fs(couchdb_t)
+
+auth_use_nsswitch(couchdb_t)
+
+miscfiles_read_localization(couchdb_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/courier.fc refpolicy/policy/modules/contrib/courier.fc
--- refpolicy/policy/modules/contrib/courier.fc	2012-05-04 16:15:16.000000000 +0200
+++ refpolicy/policy/modules/contrib/courier.fc	2012-10-06 20:35:22.638753320 +0200
@@ -1,31 +1,32 @@
-/etc/courier(/.*)?				gen_context(system_u:object_r:courier_etc_t,s0)
-/etc/courier-imap(/.*)?				gen_context(system_u:object_r:courier_etc_t,s0)
+/etc/courier(/.*)?	gen_context(system_u:object_r:courier_etc_t,s0)
+/etc/courier-imap(/.*)?	gen_context(system_u:object_r:courier_etc_t,s0)
 
-/usr/bin/imapd				--	gen_context(system_u:object_r:courier_pop_exec_t,s0)
+/usr/bin/imapd	--	gen_context(system_u:object_r:courier_pop_exec_t,s0)
 
-/usr/sbin/authdaemond			--	gen_context(system_u:object_r:courier_authdaemon_exec_t,s0)
-/usr/sbin/courierlogger			--	gen_context(system_u:object_r:courier_exec_t,s0)
-/usr/sbin/courierldapaliasd		--	gen_context(system_u:object_r:courier_exec_t,s0)
-/usr/sbin/couriertcpd			--	gen_context(system_u:object_r:courier_tcpd_exec_t,s0)
-
-/usr/lib/courier/(courier-)?authlib/.* --	gen_context(system_u:object_r:courier_authdaemon_exec_t,s0)
-/usr/lib/courier/courier/.*		--	gen_context(system_u:object_r:courier_exec_t,s0)
+/usr/sbin/authdaemond	--	gen_context(system_u:object_r:courier_authdaemon_exec_t,s0)
+/usr/sbin/courier-imapd	--	gen_context(system_u:object_r:courier_pop_exec_t,s0)
+/usr/sbin/courierlogger	--	gen_context(system_u:object_r:courier_exec_t,s0)
+/usr/sbin/courierldapaliasd	--	gen_context(system_u:object_r:courier_exec_t,s0)
+/usr/sbin/couriertcpd	--	gen_context(system_u:object_r:courier_tcpd_exec_t,s0)
+/usr/sbin/imaplogin	--	gen_context(system_u:object_r:courier_authdaemon_exec_t,s0)
+
+/usr/lib/courier/authlib/.*	--	gen_context(system_u:object_r:courier_authdaemon_exec_t,s0)
+/usr/lib/courier/courier-authlib/.*	--	gen_context(system_u:object_r:courier_authdaemon_exec_t,s0)
+/usr/lib/courier/courier/.*	--	gen_context(system_u:object_r:courier_exec_t,s0)
 /usr/lib/courier/courier/courierpop.*	--	gen_context(system_u:object_r:courier_pop_exec_t,s0)
 /usr/lib/courier/courier/imaplogin	--	gen_context(system_u:object_r:courier_pop_exec_t,s0)
-/usr/lib/courier/courier/pcpd		--	gen_context(system_u:object_r:courier_pcp_exec_t,s0)
-/usr/lib/courier/imapd			--	gen_context(system_u:object_r:courier_pop_exec_t,s0)
-/usr/lib/courier/pop3d			--	gen_context(system_u:object_r:courier_pop_exec_t,s0)
-/usr/lib/courier/rootcerts(/.*)?		gen_context(system_u:object_r:courier_etc_t,s0)
-/usr/lib/courier/sqwebmail/cleancache\.pl --	gen_context(system_u:object_r:sqwebmail_cron_exec_t,s0)
-
-ifdef(`distro_gentoo',`
+/usr/lib/courier/courier/pcpd	--	gen_context(system_u:object_r:courier_pcp_exec_t,s0)
+/usr/lib/courier/imapd	--	gen_context(system_u:object_r:courier_pop_exec_t,s0)
+/usr/lib/courier/pop3d	--	gen_context(system_u:object_r:courier_pop_exec_t,s0)
+/usr/lib/courier/rootcerts(/.*)?	gen_context(system_u:object_r:courier_etc_t,s0)
+/usr/lib/courier/sqwebmail/cleancache\.pl	--	gen_context(system_u:object_r:sqwebmail_cron_exec_t,s0)
 /usr/lib/courier-imap/couriertcpd	--	gen_context(system_u:object_r:courier_tcpd_exec_t,s0)
-')
 
-/var/lib/courier(/.*)?				gen_context(system_u:object_r:courier_var_lib_t,s0)
-/var/lib/courier-imap(/.*)?			gen_context(system_u:object_r:courier_var_lib_t,s0)
 
-/var/run/courier(/.*)?				gen_context(system_u:object_r:courier_var_run_t,s0)
+/var/lib/courier(/.*)?	gen_context(system_u:object_r:courier_var_lib_t,s0)
+/var/lib/courier-imap(/.*)?	gen_context(system_u:object_r:courier_var_lib_t,s0)
+
+/var/run/courier(/.*)?	gen_context(system_u:object_r:courier_var_run_t,s0)
 
-/var/spool/authdaemon(/.*)?			gen_context(system_u:object_r:courier_spool_t,s0)
-/var/spool/courier(/.*)?			gen_context(system_u:object_r:courier_spool_t,s0)
+/var/spool/authdaemon(/.*)?	gen_context(system_u:object_r:courier_spool_t,s0)
+/var/spool/courier(/.*)?	gen_context(system_u:object_r:courier_spool_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/courier.if refpolicy/policy/modules/contrib/courier.if
--- refpolicy/policy/modules/contrib/courier.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/courier.if	2012-11-01 21:54:22.932786565 +0100
@@ -1,96 +1,43 @@
-## <summary>Courier IMAP and POP3 email servers</summary>
+## <summary>Courier IMAP and POP3 email servers.</summary>
 
-########################################
+#######################################
 ## <summary>
-##	Template for creating courier server processes.
+##	The template to define a courier domain.
 ## </summary>
-## <param name="prefix">
+## <param name="domain_prefix">
 ##	<summary>
-##	Prefix name of the server process.
+##	Domain prefix to be used.
 ##	</summary>
 ## </param>
 #
 template(`courier_domain_template',`
+	gen_require(`
+		attribute courier_domain;
+	')
 
-	##############################
+	########################################
 	#
 	# Declarations
 	#
 
-	type courier_$1_t;
+	type courier_$1_t, courier_domain;
 	type courier_$1_exec_t;
 	init_daemon_domain(courier_$1_t, courier_$1_exec_t)
 
-	##############################
+	########################################
 	#
-	# Declarations
+	# Policy
 	#
 
-	allow courier_$1_t self:capability dac_override;
-	dontaudit courier_$1_t self:capability sys_tty_config;
-	allow courier_$1_t self:process { setpgid signal_perms };
-	allow courier_$1_t self:fifo_file { read write getattr };
-	allow courier_$1_t self:tcp_socket create_stream_socket_perms;
-	allow courier_$1_t self:udp_socket create_socket_perms;
-
 	can_exec(courier_$1_t, courier_$1_exec_t)
-
-	read_files_pattern(courier_$1_t, courier_etc_t, courier_etc_t)
-	allow courier_$1_t courier_etc_t:dir list_dir_perms;
-
-	manage_dirs_pattern(courier_$1_t, courier_var_run_t, courier_var_run_t)
-	manage_files_pattern(courier_$1_t, courier_var_run_t, courier_var_run_t)
-	manage_lnk_files_pattern(courier_$1_t, courier_var_run_t, courier_var_run_t)
-	manage_sock_files_pattern(courier_$1_t, courier_var_run_t, courier_var_run_t)
-	files_search_pids(courier_$1_t)
-	files_pid_filetrans(courier_$1_t, courier_var_run_t, dir)
-
-	kernel_read_system_state(courier_$1_t)
-	kernel_read_kernel_sysctls(courier_$1_t)
-
-	corecmd_exec_bin(courier_$1_t)
-
-	corenet_all_recvfrom_unlabeled(courier_$1_t)
-	corenet_all_recvfrom_netlabel(courier_$1_t)
-	corenet_tcp_sendrecv_generic_if(courier_$1_t)
-	corenet_udp_sendrecv_generic_if(courier_$1_t)
-	corenet_tcp_sendrecv_generic_node(courier_$1_t)
-	corenet_udp_sendrecv_generic_node(courier_$1_t)
-	corenet_tcp_sendrecv_all_ports(courier_$1_t)
-	corenet_udp_sendrecv_all_ports(courier_$1_t)
-
-	dev_read_sysfs(courier_$1_t)
-
-	domain_use_interactive_fds(courier_$1_t)
-
-	files_read_etc_files(courier_$1_t)
-	files_read_etc_runtime_files(courier_$1_t)
-	files_read_usr_files(courier_$1_t)
-
-	fs_getattr_xattr_fs(courier_$1_t)
-	fs_search_auto_mountpoints(courier_$1_t)
-
-	logging_send_syslog_msg(courier_$1_t)
-
-	sysnet_read_config(courier_$1_t)
-
-	userdom_dontaudit_use_unpriv_user_fds(courier_$1_t)
-
-	optional_policy(`
-		seutil_sigchld_newrole(courier_$1_t)
-	')
-
-	optional_policy(`
-		udev_read_db(courier_$1_t)
-	')
 ')
 
 ########################################
 ## <summary>
-##	Execute the courier authentication daemon with
-##	a domain transition.
+##	Execute the courier authentication
+##	daemon with a domain transition.
 ## </summary>
-## <param name="prefix">
+## <param name="domain">
 ##	<summary>
 ##	Domain allowed to transition.
 ##	</summary>
@@ -101,15 +48,36 @@
 		type courier_authdaemon_t, courier_authdaemon_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, courier_authdaemon_exec_t, courier_authdaemon_t)
 ')
 
+#######################################
+## <summary>
+##	Connect to courier-authdaemon over
+##	a unix stream socket.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`courier_stream_connect_authdaemon',`
+	gen_require(`
+		type courier_authdaemon_t, courier_spool_t;
+	')
+
+	files_search_spool($1)
+	stream_connect_pattern($1, courier_spool_t, courier_spool_t, courier_authdaemon_t)
+')
+
 ########################################
 ## <summary>
-##	Execute the courier POP3 and IMAP server with
-##	a domain transition.
+##	Execute the courier POP3 and IMAP
+##	server with a domain transition.
 ## </summary>
-## <param name="prefix">
+## <param name="domain">
 ##	<summary>
 ##	Domain allowed to transition.
 ##	</summary>
@@ -120,14 +88,15 @@
 		type courier_pop_t, courier_pop_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, courier_pop_exec_t, courier_pop_t)
 ')
 
 ########################################
 ## <summary>
-##	Read courier config files
+##	Read courier config files.
 ## </summary>
-## <param name="prefix">
+## <param name="domain">
 ##	<summary>
 ##	Domain allowed access.
 ##	</summary>
@@ -138,6 +107,7 @@
 		type courier_etc_t;
 	')
 
+	files_search_etc($1)
 	read_files_pattern($1, courier_etc_t, courier_etc_t)
 ')
 
@@ -146,7 +116,7 @@
 ##	Create, read, write, and delete courier
 ##	spool directories.
 ## </summary>
-## <param name="prefix">
+## <param name="domain">
 ##	<summary>
 ##	Domain allowed access.
 ##	</summary>
@@ -157,6 +127,7 @@
 		type courier_spool_t;
 	')
 
+	files_search_var($1)
 	manage_dirs_pattern($1, courier_spool_t, courier_spool_t)
 ')
 
@@ -165,7 +136,7 @@
 ##	Create, read, write, and delete courier
 ##	spool files.
 ## </summary>
-## <param name="prefix">
+## <param name="domain">
 ##	<summary>
 ##	Domain allowed access.
 ##	</summary>
@@ -176,6 +147,7 @@
 		type courier_spool_t;
 	')
 
+	files_search_var($1)
 	manage_files_pattern($1, courier_spool_t, courier_spool_t)
 ')
 
@@ -183,7 +155,7 @@
 ## <summary>
 ##	Read courier spool files.
 ## </summary>
-## <param name="prefix">
+## <param name="domain">
 ##	<summary>
 ##	Domain allowed access.
 ##	</summary>
@@ -194,12 +166,13 @@
 		type courier_spool_t;
 	')
 
+	files_search_var($1)
 	read_files_pattern($1, courier_spool_t, courier_spool_t)
 ')
 
 ########################################
 ## <summary>
-##	Read and write to courier spool pipes.
+##	Read and write courier spool pipes.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -212,5 +185,44 @@
 		type courier_spool_t;
 	')
 
+	files_search_var($1)
 	allow $1 courier_spool_t:fifo_file rw_fifo_file_perms;
 ')
+
+########################################
+## <summary>
+##     Allow read/write operations on an inherited stream socket
+## </summary>
+## <param name="domain">
+##     <summary>
+##     Domain allowed access.
+##     </summary>
+## </param>
+## <rolecap/>
+#
+interface(`courier_authdaemon_rw_inherited_stream_sockets',`
+       gen_require(`
+               type courier_authdaemon_t;
+       ')
+       allow $1 courier_authdaemon_t:unix_stream_socket { read write };
+')
+
+
+########################################
+## <summary>
+##     Connect to Authdaemon using a unix domain stream socket.
+## </summary>
+## <param name="domain">
+##     <summary>
+##     Domain allowed access.
+##     </summary>
+## </param>
+## <rolecap/>
+#
+interface(`courier_authdaemon_stream_connect',`
+       gen_require(`
+               type courier_authdaemon_t, courier_var_run_t;
+       ')
+
+       stream_connect_pattern($1, courier_var_run_t, courier_var_run_t, courier_authdaemon_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/courier.te refpolicy/policy/modules/contrib/courier.te
--- refpolicy/policy/modules/contrib/courier.te	2012-07-25 20:33:04.000000000 +0200
+++ refpolicy/policy/modules/contrib/courier.te	2012-11-01 21:52:56.435786381 +0100
@@ -1,24 +1,25 @@
-policy_module(courier, 1.13.0)
+policy_module(courier, 1.13.2)
 
 ########################################
 #
 # Declarations
 #
 
+attribute courier_domain;
+
 courier_domain_template(authdaemon)
+courier_domain_template(pcp)
+courier_domain_template(pop)
+courier_domain_template(tcpd)
+courier_domain_template(sqwebmail)
+typealias courier_sqwebmail_exec_t alias sqwebmail_cron_exec_t;
 
 type courier_etc_t;
 files_config_file(courier_etc_t)
 
-courier_domain_template(pcp)
-
-courier_domain_template(pop)
-
 type courier_spool_t;
 files_type(courier_spool_t)
 
-courier_domain_template(tcpd)
-
 type courier_var_lib_t;
 files_type(courier_var_lib_t)
 
@@ -28,8 +29,56 @@
 type courier_exec_t;
 mta_agent_executable(courier_exec_t)
 
-courier_domain_template(sqwebmail)
-typealias courier_sqwebmail_exec_t alias sqwebmail_cron_exec_t;
+########################################
+#
+# Common local policy
+#
+
+allow courier_domain self:capability dac_override;
+dontaudit courier_domain self:capability sys_tty_config;
+allow courier_domain self:process { setpgid signal_perms };
+allow courier_domain self:fifo_file rw_fifo_file_perms;
+allow courier_domain self:tcp_socket create_stream_socket_perms;
+allow courier_domain self:udp_socket create_socket_perms;
+
+read_files_pattern(courier_domain, courier_etc_t, courier_etc_t)
+allow courier_domain courier_etc_t:dir list_dir_perms;
+
+manage_dirs_pattern(courier_domain, courier_var_run_t, courier_var_run_t)
+manage_files_pattern(courier_domain, courier_var_run_t, courier_var_run_t)
+manage_lnk_files_pattern(courier_domain, courier_var_run_t, courier_var_run_t)
+manage_sock_files_pattern(courier_domain, courier_var_run_t, courier_var_run_t)
+files_pid_filetrans(courier_domain, courier_var_run_t, dir)
+
+kernel_read_kernel_sysctls(courier_domain)
+kernel_read_system_state(courier_domain)
+
+corecmd_exec_bin(courier_domain)
+
+dev_read_sysfs(courier_domain)
+
+domain_use_interactive_fds(courier_domain)
+
+files_read_etc_files(courier_domain)
+files_read_etc_runtime_files(courier_domain)
+files_read_usr_files(courier_domain)
+
+fs_getattr_xattr_fs(courier_domain)
+fs_search_auto_mountpoints(courier_domain)
+
+logging_send_syslog_msg(courier_domain)
+
+sysnet_read_config(courier_domain)
+
+userdom_dontaudit_use_unpriv_user_fds(courier_domain)
+
+optional_policy(`
+	seutil_sigchld_newrole(courier_domain)
+')
+
+optional_policy(`
+	udev_read_db(courier_domain)
+')
 
 ########################################
 #
@@ -37,32 +86,27 @@
 #
 
 allow courier_authdaemon_t self:capability { setuid setgid sys_tty_config };
-allow courier_authdaemon_t self:unix_stream_socket { create_stream_socket_perms connectto };
+allow courier_authdaemon_t self:unix_stream_socket { accept connectto listen };
 
-can_exec(courier_authdaemon_t, courier_exec_t)
+create_dirs_pattern(courier_authdaemon_t, courier_var_lib_t, courier_var_lib_t)
+manage_sock_files_pattern(courier_authdaemon_t, courier_var_lib_t, courier_var_lib_t)
 
-allow courier_authdaemon_t courier_tcpd_t:fd use;
-allow courier_authdaemon_t courier_tcpd_t:tcp_socket rw_stream_socket_perms;
-allow courier_authdaemon_t courier_tcpd_t:fifo_file rw_fifo_file_perms;
+manage_sock_files_pattern(courier_authdaemon_t, courier_spool_t, courier_spool_t)
 
-allow courier_authdaemon_t courier_tcpd_t:tcp_socket rw_stream_socket_perms;
-allow courier_authdaemon_t courier_tcpd_t:unix_stream_socket rw_stream_socket_perms;
 allow courier_authdaemon_t courier_tcpd_t:process sigchld;
 allow courier_authdaemon_t courier_tcpd_t:fd use;
+allow courier_authdaemon_t courier_tcpd_t:fifo_file rw_fifo_file_perms;
 allow courier_authdaemon_t courier_tcpd_t:tcp_socket rw_stream_socket_perms;
-allow courier_authdaemon_t courier_tcpd_t:fifo_file rw_file_perms;
+allow courier_authdaemon_t courier_tcpd_t:unix_stream_socket rw_stream_socket_perms;
 
-create_dirs_pattern(courier_authdaemon_t, courier_var_lib_t, courier_var_lib_t)
-manage_sock_files_pattern(courier_authdaemon_t, courier_spool_t, courier_spool_t)
-manage_sock_files_pattern(courier_authdaemon_t, courier_var_lib_t, courier_var_lib_t)
-files_search_spool(courier_authdaemon_t)
+can_exec(courier_authdaemon_t, courier_exec_t)
 
-corecmd_search_bin(courier_authdaemon_t)
+domtrans_pattern(courier_authdaemon_t, courier_pop_exec_t, courier_pop_t)
 
-# for SSP
 dev_read_urand(courier_authdaemon_t)
 
 files_getattr_tmp_dirs(courier_authdaemon_t)
+files_search_spool(courier_authdaemon_t)
 
 auth_domtrans_chk_passwd(courier_authdaemon_t)
 
@@ -70,10 +114,11 @@
 
 miscfiles_read_localization(courier_authdaemon_t)
 
-# should not be needed!
-userdom_search_user_home_dirs(courier_authdaemon_t)
+userdom_dontaudit_search_user_home_dirs(courier_authdaemon_t)
 
-courier_domtrans_pop(courier_authdaemon_t)
+ifdef(`distro_gentoo',`
+	read_lnk_files_pattern(courier_authdaemon_t, courier_var_lib_t, courier_var_lib_t)
+')
 
 ########################################
 #
@@ -94,21 +139,23 @@
 
 allow courier_pop_t courier_tcpd_t:{ unix_stream_socket tcp_socket } rw_stream_socket_perms;
 
-# inherits file handle - should it?
 allow courier_pop_t courier_var_lib_t:file { read write };
 
-miscfiles_read_localization(courier_pop_t)
+domtrans_pattern(courier_pop_t, courier_authdaemon_exec_t, courier_authdaemon_t)
 
-courier_domtrans_authdaemon(courier_pop_t)
+miscfiles_read_localization(courier_pop_t)
 
-# do the actual work (read the Maildir)
 userdom_manage_user_home_content_files(courier_pop_t)
-# cjp: the fact that this is different for pop vs imap means that
-# there should probably be a courier_pop_t and courier_imap_t
-# this should also probably be a separate type too instead of
-# the regular home dir
 userdom_manage_user_home_content_dirs(courier_pop_t)
 
+ifdef(`distro_gentoo',`
+	files_search_var_lib(courier_pop_t)
+	search_dirs_pattern(courier_pop_t, courier_var_lib_t, courier_var_lib_t)
+	read_lnk_files_pattern(courier_pop_t, courier_var_lib_t, courier_var_lib_t)
+
+	courier_authdaemon_rw_inherited_stream_sockets(courier_pop_t)
+')
+
 ########################################
 #
 # TCPd local policy
@@ -116,25 +163,33 @@
 
 allow courier_tcpd_t self:capability kill;
 
-can_exec(courier_tcpd_t, courier_exec_t)
-
 manage_files_pattern(courier_tcpd_t, courier_var_lib_t, courier_var_lib_t)
 manage_lnk_files_pattern(courier_tcpd_t, courier_var_lib_t, courier_var_lib_t)
 files_search_var_lib(courier_tcpd_t)
 
-corecmd_search_bin(courier_tcpd_t)
+can_exec(courier_tcpd_t, courier_exec_t)
+
+domtrans_pattern(courier_tcpd_t, courier_pop_exec_t, courier_pop_t)
 
+corenet_all_recvfrom_unlabeled(courier_tcpd_t)
+corenet_all_recvfrom_netlabel(courier_tcpd_t)
+corenet_tcp_sendrecv_generic_if(courier_tcpd_t)
+corenet_tcp_sendrecv_generic_node(courier_tcpd_t)
 corenet_tcp_bind_generic_node(courier_tcpd_t)
-corenet_tcp_bind_pop_port(courier_tcpd_t)
+
 corenet_sendrecv_pop_server_packets(courier_tcpd_t)
+corenet_tcp_bind_pop_port(courier_tcpd_t)
+corenet_tcp_sendrecv_pop_port(courier_tcpd_t)
 
-# for TLS
 dev_read_rand(courier_tcpd_t)
 dev_read_urand(courier_tcpd_t)
 
 miscfiles_read_localization(courier_tcpd_t)
 
-courier_domtrans_pop(courier_tcpd_t)
+ifdef(`distro_gentoo',`
+	courier_authdaemon_stream_connect(courier_tcpd_t)
+	courier_domtrans_authdaemon(courier_tcpd_t)
+')
 
 ########################################
 #
@@ -143,6 +198,12 @@
 
 kernel_read_kernel_sysctls(courier_sqwebmail_t)
 
+ifdef(`distro_gentoo',`
+	optional_policy(`
+		mysql_stream_connect(courier_authdaemon_t)
+	')
+')
+
 optional_policy(`
 	cron_system_entry(courier_sqwebmail_t, courier_sqwebmail_exec_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/cpucontrol.fc refpolicy/policy/modules/contrib/cpucontrol.fc
--- refpolicy/policy/modules/contrib/cpucontrol.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/cpucontrol.fc	2012-09-27 20:03:30.744126498 +0200
@@ -1,10 +1,10 @@
-
 /etc/firmware/.*	--	gen_context(system_u:object_r:cpucontrol_conf_t,s0)
 
 /sbin/microcode_ctl	--	gen_context(system_u:object_r:cpucontrol_exec_t,s0)
 
 /usr/sbin/cpufreqd	--	gen_context(system_u:object_r:cpuspeed_exec_t,s0)
 /usr/sbin/cpuspeed	--	gen_context(system_u:object_r:cpuspeed_exec_t,s0)
+/usr/sbin/microcode_ctl	--	gen_context(system_u:object_r:cpucontrol_exec_t,s0)
 /usr/sbin/powernowd	--	gen_context(system_u:object_r:cpuspeed_exec_t,s0)
 
 /var/run/cpufreqd\.pid	--	gen_context(system_u:object_r:cpuspeed_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/cpucontrol.te refpolicy/policy/modules/contrib/cpucontrol.te
--- refpolicy/policy/modules/contrib/cpucontrol.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/cpucontrol.te	2012-09-27 20:03:30.744126498 +0200
@@ -1,18 +1,20 @@
-policy_module(cpucontrol, 1.3.0)
+policy_module(cpucontrol, 1.3.1)
 
 ########################################
 #
 # Declarations
 #
 
-type cpucontrol_t;
+attribute cpucontrol_domain;
+
+type cpucontrol_t, cpucontrol_domain;
 type cpucontrol_exec_t;
 init_system_domain(cpucontrol_t, cpucontrol_exec_t)
 
 type cpucontrol_conf_t;
-files_type(cpucontrol_conf_t)
+files_config_file(cpucontrol_conf_t)
 
-type cpuspeed_t;
+type cpuspeed_t, cpucontrol_domain;
 type cpuspeed_exec_t;
 init_system_domain(cpuspeed_t, cpuspeed_exec_t)
 
@@ -21,102 +23,82 @@
 
 ########################################
 #
-# CPU microcode loader local policy
+# Common local policy
 #
 
-allow cpucontrol_t self:capability { ipc_lock sys_rawio };
-dontaudit cpucontrol_t self:capability sys_tty_config;
-allow cpucontrol_t self:process signal_perms;
-
-allow cpucontrol_t cpucontrol_conf_t:dir list_dir_perms;
-read_files_pattern(cpucontrol_t, cpucontrol_conf_t, cpucontrol_conf_t)
-read_lnk_files_pattern(cpucontrol_t, cpucontrol_conf_t, cpucontrol_conf_t)
+dontaudit cpucontrol_domain self:capability sys_tty_config;
+allow cpucontrol_domain self:process signal_perms;
 
-kernel_list_proc(cpucontrol_t)
-kernel_read_proc_symlinks(cpucontrol_t)
-kernel_read_kernel_sysctls(cpucontrol_t)
-
-dev_read_sysfs(cpucontrol_t)
-dev_rw_cpu_microcode(cpucontrol_t)
+kernel_read_kernel_sysctls(cpucontrol_domain)
 
-fs_search_auto_mountpoints(cpucontrol_t)
+domain_use_interactive_fds(cpucontrol_domain)
 
-term_dontaudit_use_console(cpucontrol_t)
+files_list_usr(cpucontrol_domain)
 
-domain_use_interactive_fds(cpucontrol_t)
+fs_search_auto_mountpoints(cpucontrol_domain)
 
-files_list_usr(cpucontrol_t)
+term_dontaudit_use_console(cpucontrol_domain)
 
-init_use_fds(cpucontrol_t)
-init_use_script_ptys(cpucontrol_t)
+init_use_fds(cpucontrol_domain)
+init_use_script_ptys(cpucontrol_domain)
 
-logging_send_syslog_msg(cpucontrol_t)
+logging_send_syslog_msg(cpucontrol_domain)
 
-userdom_dontaudit_use_unpriv_user_fds(cpucontrol_t)
+userdom_dontaudit_use_unpriv_user_fds(cpucontrol_domain)
 
 optional_policy(`
-	nscd_socket_use(cpucontrol_t)
+	nscd_socket_use(cpucontrol_domain)
 ')
 
 optional_policy(`
-	rhgb_use_ptys(cpucontrol_t)
+	seutil_sigchld_newrole(cpucontrol_domain)
 ')
 
 optional_policy(`
-	seutil_sigchld_newrole(cpucontrol_t)
+	udev_read_db(cpucontrol_domain)
 ')
 
+########################################
+#
+# Loader local policy
+#
+
+allow cpucontrol_t self:capability { ipc_lock sys_rawio };
+
+allow cpucontrol_t cpucontrol_conf_t:dir list_dir_perms;
+read_files_pattern(cpucontrol_t, cpucontrol_conf_t, cpucontrol_conf_t)
+read_lnk_files_pattern(cpucontrol_t, cpucontrol_conf_t, cpucontrol_conf_t)
+
+kernel_list_proc(cpucontrol_t)
+kernel_read_proc_symlinks(cpucontrol_t)
+
+dev_read_sysfs(cpucontrol_t)
+dev_rw_cpu_microcode(cpucontrol_t)
+
 optional_policy(`
-	udev_read_db(cpucontrol_t)
+	rhgb_use_ptys(cpucontrol_t)
 ')
 
 ########################################
 #
-# CPU frequency scaling daemons
+# Scaling local policy
 #
 
-dontaudit cpuspeed_t self:capability sys_tty_config;
-allow cpuspeed_t self:process { signal_perms setsched };
+allow cpuspeed_t self:process setsched;
 allow cpuspeed_t self:unix_dgram_socket create_socket_perms;
 
 allow cpuspeed_t cpuspeed_var_run_t:file manage_file_perms;
 files_pid_filetrans(cpuspeed_t, cpuspeed_var_run_t, file)
 
 kernel_read_system_state(cpuspeed_t)
-kernel_read_kernel_sysctls(cpuspeed_t)
 
+# This doesnt make sense
 dev_write_sysfs_dirs(cpuspeed_t)
 dev_rw_sysfs(cpuspeed_t)
 
-domain_use_interactive_fds(cpuspeed_t)
-# for demand/load-based scaling:
 domain_read_all_domains_state(cpuspeed_t)
 
 files_read_etc_files(cpuspeed_t)
 files_read_etc_runtime_files(cpuspeed_t)
-files_list_usr(cpuspeed_t)
-
-fs_search_auto_mountpoints(cpuspeed_t)
-
-term_dontaudit_use_console(cpuspeed_t)
-
-init_use_fds(cpuspeed_t)
-init_use_script_ptys(cpuspeed_t)
-
-logging_send_syslog_msg(cpuspeed_t)
 
 miscfiles_read_localization(cpuspeed_t)
-
-userdom_dontaudit_use_unpriv_user_fds(cpuspeed_t)
-
-optional_policy(`
-	nscd_socket_use(cpuspeed_t)
-')
-
-optional_policy(`
-	seutil_sigchld_newrole(cpuspeed_t)
-')
-
-optional_policy(`
-	udev_read_db(cpuspeed_t)
-')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/cpufreqselector.te refpolicy/policy/modules/contrib/cpufreqselector.te
--- refpolicy/policy/modules/contrib/cpufreqselector.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/cpufreqselector.te	2012-09-27 20:03:30.744126498 +0200
@@ -1,4 +1,4 @@
-policy_module(cpufreqselector, 1.3.0)
+policy_module(cpufreqselector, 1.3.1)
 
 ########################################
 #
@@ -7,11 +7,11 @@
 
 type cpufreqselector_t;
 type cpufreqselector_exec_t;
-application_domain(cpufreqselector_t, cpufreqselector_exec_t)
+init_daemon_domain(cpufreqselector_t, cpufreqselector_exec_t)
 
 ########################################
 #
-# cpufreq-selector local policy
+# Local policy
 #
 
 allow cpufreqselector_t self:capability { sys_nice sys_ptrace };
@@ -23,8 +23,6 @@
 files_read_etc_files(cpufreqselector_t)
 files_read_usr_files(cpufreqselector_t)
 
-corecmd_search_bin(cpufreqselector_t)
-
 dev_rw_sysfs(cpufreqselector_t)
 
 miscfiles_read_localization(cpufreqselector_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/cron.fc refpolicy/policy/modules/contrib/cron.fc
--- refpolicy/policy/modules/contrib/cron.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/cron.fc	2012-11-12 22:42:32.117146439 +0100
@@ -1,56 +1,61 @@
-/etc/rc\.d/init\.d/atd		--	gen_context(system_u:object_r:crond_initrc_exec_t,s0)
+/etc/rc\.d/init\.d/atd	--	gen_context(system_u:object_r:crond_initrc_exec_t,s0)
 
-/etc/cron\.d(/.*)?			gen_context(system_u:object_r:system_cron_spool_t,s0)
-/etc/crontab			--	gen_context(system_u:object_r:system_cron_spool_t,s0)
+/etc/cron\.d(/.*)?	gen_context(system_u:object_r:system_cron_spool_t,s0)
+/etc/crontab	--	gen_context(system_u:object_r:system_cron_spool_t,s0)
 
-/usr/bin/at			--	gen_context(system_u:object_r:crontab_exec_t,s0)
-/usr/bin/(f)?crontab		--	gen_context(system_u:object_r:crontab_exec_t,s0)
+/usr/bin/at	--	gen_context(system_u:object_r:crontab_exec_t,s0)
+/usr/bin/(f)?crontab	--	gen_context(system_u:object_r:crontab_exec_t,s0)
 
-/usr/sbin/anacron		--	gen_context(system_u:object_r:anacron_exec_t,s0)
-/usr/sbin/atd			--	gen_context(system_u:object_r:crond_exec_t,s0)
-/usr/sbin/cron(d)?		--	gen_context(system_u:object_r:crond_exec_t,s0)
-/usr/sbin/fcron			--	gen_context(system_u:object_r:crond_exec_t,s0)
-/usr/sbin/fcronsighup		--	gen_context(system_u:object_r:crontab_exec_t,s0)
-
-/var/run/anacron\.pid		--	gen_context(system_u:object_r:crond_var_run_t,s0)
-/var/run/atd\.pid		--	gen_context(system_u:object_r:crond_var_run_t,s0)
-/var/run/crond?\.pid		--	gen_context(system_u:object_r:crond_var_run_t,s0)
-/var/run/crond\.reboot		--	gen_context(system_u:object_r:crond_var_run_t,s0)
-/var/run/fcron\.fifo		-s	gen_context(system_u:object_r:crond_var_run_t,s0)
-/var/run/fcron\.pid		--	gen_context(system_u:object_r:crond_var_run_t,s0)
-
-/var/spool/anacron(/.*)?		gen_context(system_u:object_r:system_cron_spool_t,s0)
-/var/spool/at(/.*)?			gen_context(system_u:object_r:user_cron_spool_t,s0)
-
-/var/spool/cron			-d	gen_context(system_u:object_r:cron_spool_t,s0)
-#/var/spool/cron/root		--	gen_context(system_u:object_r:sysadm_cron_spool_t,s0)
-/var/spool/cron/[^/]*		--	<<none>>
+/usr/sbin/anacron	--	gen_context(system_u:object_r:anacron_exec_t,s0)
+/usr/sbin/atd	--	gen_context(system_u:object_r:crond_exec_t,s0)
+/usr/sbin/cron(d)?	--	gen_context(system_u:object_r:crond_exec_t,s0)
+/usr/sbin/fcron	--	gen_context(system_u:object_r:crond_exec_t,s0)
+/usr/sbin/fcronsighup	--	gen_context(system_u:object_r:crontab_exec_t,s0)
 
-/var/spool/cron/crontabs 	-d	gen_context(system_u:object_r:cron_spool_t,s0)
+/var/lib/glpi/files(/.*)?	gen_context(system_u:object_r:cron_var_lib_t,s0)
+
+/var/log/cron.*	gen_context(system_u:object_r:cron_log_t,s0)
+/var/log/rpmpkgs.*	--	gen_context(system_u:object_r:cron_log_t,s0)
+
+/var/run/anacron\.pid	--	gen_context(system_u:object_r:crond_var_run_t,s0)
+/var/run/atd\.pid	--	gen_context(system_u:object_r:crond_var_run_t,s0)
+/var/run/crond?\.pid	--	gen_context(system_u:object_r:crond_var_run_t,s0)
+/var/run/crond?\.reboot	--	gen_context(system_u:object_r:crond_var_run_t,s0)
+/var/run/fcron\.fifo	-s	gen_context(system_u:object_r:crond_var_run_t,s0)
+/var/run/fcron\.pid	--	gen_context(system_u:object_r:crond_var_run_t,s0)
+/var/run/.*cron.*	--	gen_context(system_u:object_r:crond_var_run_t,s0)
+
+/var/spool/anacron(/.*)?	gen_context(system_u:object_r:system_cron_spool_t,s0)
+/var/spool/at(/.*)?	gen_context(system_u:object_r:user_cron_spool_t,s0)
+
+/var/spool/cron	-d	gen_context(system_u:object_r:cron_spool_t,s0)
+#/var/spool/cron/root	--	gen_context(system_u:object_r:sysadm_cron_spool_t,s0)
+/var/spool/cron/[^/]*	--	<<none>>
+
+/var/spool/cron/crontabs	-d	gen_context(system_u:object_r:cron_spool_t,s0)
 /var/spool/cron/crontabs/.*	--	<<none>>
 #/var/spool/cron/crontabs/root	--	gen_context(system_u:object_r:sysadm_cron_spool_t,s0)
 
-/var/spool/fcron		-d	gen_context(system_u:object_r:cron_spool_t,s0)
-/var/spool/fcron/.*			<<none>>
+/var/spool/fcron	-d	gen_context(system_u:object_r:cron_spool_t,s0)
+/var/spool/fcron/.*	<<none>>
 /var/spool/fcron/systab\.orig	--	gen_context(system_u:object_r:system_cron_spool_t,s0)
-/var/spool/fcron/systab		--	gen_context(system_u:object_r:system_cron_spool_t,s0)
+/var/spool/fcron/systab	--	gen_context(system_u:object_r:system_cron_spool_t,s0)
 /var/spool/fcron/new\.systab	--	gen_context(system_u:object_r:system_cron_spool_t,s0)
 
 ifdef(`distro_debian',`
-/var/log/prelink.log		--	gen_context(system_u:object_r:cron_log_t,s0)
-
-/var/spool/cron/atjobs		-d	gen_context(system_u:object_r:cron_spool_t,s0)
+/var/spool/cron/atjobs	-d	gen_context(system_u:object_r:cron_spool_t,s0)
 /var/spool/cron/atjobs/[^/]*	--	<<none>>
-/var/spool/cron/atspool		-d	gen_context(system_u:object_r:cron_spool_t,s0)
+/var/spool/cron/atspool	-d	gen_context(system_u:object_r:cron_spool_t,s0)
 ')
 
 ifdef(`distro_gentoo',`
-/var/spool/cron/lastrun		-d	gen_context(system_u:object_r:crond_tmp_t,s0)
+/var/spool/at/atspool(/.*)?	gen_context(system_u:object_r:user_cron_spool_log_t,s0)
+/var/spool/cron/lastrun	-d	gen_context(system_u:object_r:crond_tmp_t,s0)
 /var/spool/cron/lastrun/[^/]*	--	<<none>>
 ')
 
-ifdef(`distro_suse', `
-/var/spool/cron/lastrun		-d	gen_context(system_u:object_r:crond_tmp_t,s0)
+ifdef(`distro_suse',`
+/var/spool/cron/lastrun	-d	gen_context(system_u:object_r:crond_tmp_t,s0)
 /var/spool/cron/lastrun/[^/]*	--	<<none>>
-/var/spool/cron/tabs		-d	gen_context(system_u:object_r:cron_spool_t,s0)
+/var/spool/cron/tabs	-d	gen_context(system_u:object_r:cron_spool_t,s0)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/cron.if refpolicy/policy/modules/contrib/cron.if
--- refpolicy/policy/modules/contrib/cron.if	2012-05-04 15:16:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/cron.if	2012-11-12 22:42:02.850146374 +0100
@@ -2,22 +2,26 @@
 
 #######################################
 ## <summary>
-##	The common rules for a crontab domain.
+##	The template to define a crontab domain.
 ## </summary>
-## <param name="userdomain_prefix">
+## <param name="domain_prefix">
 ##	<summary>
-##	The prefix of the user domain (e.g., user
-##	is the prefix for user_t).
+##	Domain prefix to be used.
 ##	</summary>
 ## </param>
 #
 template(`cron_common_crontab_template',`
+	gen_require(`
+		attribute crontab_domain;
+		type crontab_exec_t;
+	')
+
 	##############################
 	#
 	# Declarations
 	#
 
-	type $1_t;
+	type $1_t, crontab_domain;
 	userdom_user_application_domain($1_t, crontab_exec_t)
 
 	type $1_tmp_t;
@@ -28,103 +32,85 @@
 	# Local policy
 	#
 
-	# dac_override is to create the file in the directory under /tmp
-	allow $1_t self:capability { fowner setuid setgid chown dac_override };
-	allow $1_t self:process { setsched signal_perms };
-	allow $1_t self:fifo_file rw_fifo_file_perms;
-
-	allow $1_t $1_tmp_t:file manage_file_perms;
-	files_tmp_filetrans($1_t, $1_tmp_t, file)
-
-	# create files in /var/spool/cron
-	manage_files_pattern($1_t, { cron_spool_t user_cron_spool_t }, user_cron_spool_t)
-	filetrans_pattern($1_t, cron_spool_t, user_cron_spool_t, file)
-	files_list_spool($1_t)
-
-	# crontab signals crond by updating the mtime on the spooldir
-	allow $1_t cron_spool_t:dir setattr;
-
-	kernel_read_system_state($1_t)
-
-	# for the checks used by crontab -u
-	selinux_dontaudit_search_fs($1_t)
-
-	fs_getattr_xattr_fs($1_t)
-
-	domain_use_interactive_fds($1_t)
-
-	files_read_etc_files($1_t)
-	files_read_usr_files($1_t)
-	files_dontaudit_search_pids($1_t)
+	manage_dirs_pattern($1_t, $1_tmp_t, $1_tmp_t)
+	manage_files_pattern($1_t, $1_tmp_t, $1_tmp_t)
+	files_tmp_filetrans($1_t, $1_tmp_t, { dir file })
 
 	auth_domtrans_chk_passwd($1_t)
-
-	logging_send_syslog_msg($1_t)
-	logging_send_audit_msgs($1_t)
-
-	init_dontaudit_write_utmp($1_t)
-	init_read_utmp($1_t)
-
-	miscfiles_read_localization($1_t)
-
-	seutil_read_config($1_t)
-
-	userdom_manage_user_tmp_dirs($1_t)
-	userdom_manage_user_tmp_files($1_t)
-	# Access terminals.
-	userdom_use_user_terminals($1_t)
-	# Read user crontabs
-	userdom_read_user_home_content_files($1_t)
-
-	tunable_policy(`fcron_crond',`
-		# fcron wants an instant update of a crontab change for the administrator
-		# also crontab does a security check for crontab -u
-		dontaudit $1_t crond_t:process signal;
-	')
-
-	optional_policy(`
-		nscd_socket_use($1_t)
-	')
+	auth_use_nsswitch($1_t)
 ')
 
 ########################################
 ## <summary>
-##	Role access for cron
+##	Role access for cron.
 ## </summary>
 ## <param name="role">
 ##	<summary>
-##	Role allowed access
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <param name="domain">
 ##	<summary>
-##	User domain for the role
+##	User domain for the role.
 ##	</summary>
 ## </param>
+## <rolecap/>
 #
 interface(`cron_role',`
 	gen_require(`
 		type cronjob_t, crontab_t, crontab_exec_t;
+		type user_cron_spool_t, crond_t;
+		bool cron_userdomain_transition;
 	')
 
+	##############################
+	#
+	# Declarations
+	#
+
 	role $1 types { cronjob_t crontab_t };
 
-	# cronjob shows up in user ps
-	ps_process_pattern($2, cronjob_t)
+	##############################
+	#
+	# Local policy
+	#
 
-	# Transition from the user domain to the derived domain.
 	domtrans_pattern($2, crontab_exec_t, crontab_t)
 
-	# crontab shows up in user ps
+	dontaudit crond_t $2:process { noatsecure siginh rlimitinh };
+	allow $2 crond_t:process sigchld;
+
+	allow $2 user_cron_spool_t:file { getattr read write ioctl };
+
+	allow $2 crontab_t:process { ptrace signal_perms };
 	ps_process_pattern($2, crontab_t)
-	allow $2 crontab_t:process signal;
 
-	# Run helper programs as the user domain
-	#corecmd_bin_domtrans(crontab_t, $2)
-	#corecmd_shell_domtrans(crontab_t, $2)
 	corecmd_exec_bin(crontab_t)
 	corecmd_exec_shell(crontab_t)
 
+	tunable_policy(`cron_userdomain_transition',`
+		allow crond_t $2:process transition;
+		allow crond_t $2:fd use;
+		allow crond_t $2:key manage_key_perms;
+
+		allow $2 user_cron_spool_t:file entrypoint;
+
+		allow $2 crond_t:fifo_file rw_fifo_file_perms;
+
+		allow $2 cronjob_t:process { ptrace signal_perms };
+		ps_process_pattern($2, cronjob_t)
+	',`
+		dontaudit crond_t $2:process transition;
+		dontaudit crond_t $2:fd use;
+		dontaudit crond_t $2:key manage_key_perms;
+
+		dontaudit $2 user_cron_spool_t:file entrypoint;
+
+		dontaudit $2 crond_t:fifo_file rw_fifo_file_perms;
+
+		dontaudit $2 cronjob_t:process { ptrace signal_perms };
+	')
+
 	optional_policy(`
 		gen_require(`
 			class dbus send_msg;
@@ -133,47 +119,79 @@
 		dbus_stub(cronjob_t)
 
 		allow cronjob_t $2:dbus send_msg;
-	')		
+	')
 ')
 
 ########################################
 ## <summary>
-##	Role access for unconfined cronjobs
+##	Role access for unconfined cron.
 ## </summary>
 ## <param name="role">
 ##	<summary>
-##	Role allowed access
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <param name="domain">
 ##	<summary>
-##	User domain for the role
+##	User domain for the role.
 ##	</summary>
 ## </param>
 #
 interface(`cron_unconfined_role',`
 	gen_require(`
-		type unconfined_cronjob_t, crontab_t, crontab_tmp_t, crontab_exec_t;
+		type unconfined_cronjob_t, crontab_t, crontab_exec_t;
+		type crond_t, user_cron_spool_t;
+		bool cron_userdomain_transition;
 	')
 
+	##############################
+	#
+	# Declarations
+	#
+
 	role $1 types { unconfined_cronjob_t crontab_t };
 
-	# cronjob shows up in user ps
-	ps_process_pattern($2, unconfined_cronjob_t)
+	##############################
+	#
+	# Local policy
+	#
 
-	# Transition from the user domain to the derived domain.
 	domtrans_pattern($2, crontab_exec_t, crontab_t)
 
-	# crontab shows up in user ps
+	dontaudit crond_t $2:process { noatsecure siginh rlimitinh };
+	allow $2 crond_t:process sigchld;
+
+	allow $2 user_cron_spool_t:file { getattr read write ioctl };
+
+	allow $2 crontab_t:process { ptrace signal_perms };
 	ps_process_pattern($2, crontab_t)
-	allow $2 crontab_t:process signal;
 
-	# Run helper programs as the user domain
-	#corecmd_bin_domtrans(crontab_t, $2)
-	#corecmd_shell_domtrans(crontab_t, $2)
 	corecmd_exec_bin(crontab_t)
 	corecmd_exec_shell(crontab_t)
 
+	tunable_policy(`cron_userdomain_transition',`
+		allow crond_t $2:process transition;
+		allow crond_t $2:fd use;
+		allow crond_t $2:key manage_key_perms;
+
+		allow $2 user_cron_spool_t:file entrypoint;
+
+		allow $2 crond_t:fifo_file rw_fifo_file_perms;
+
+		allow $2 unconfined_cronjob_t:process { ptrace signal_perms };
+		ps_process_pattern($2, unconfined_cronjob_t)
+	',`
+		dontaudit crond_t $2:process transition;
+		dontaudit crond_t $2:fd use;
+		dontaudit crond_t $2:key manage_key_perms;
+
+		dontaudit $2 user_cron_spool_t:file entrypoint;
+
+		dontaudit $2 crond_t:fifo_file rw_fifo_file_perms;
+
+		dontaudit $2 unconfined_cronjob_t:process { ptrace signal_perms };
+')
+
 	optional_policy(`
 		gen_require(`
 			class dbus send_msg;
@@ -182,51 +200,83 @@
 		dbus_stub(unconfined_cronjob_t)
 
 		allow unconfined_cronjob_t $2:dbus send_msg;
-	')		
+	')
 ')
 
 ########################################
 ## <summary>
-##	Role access for cron
+##	Role access for admin cron.
 ## </summary>
 ## <param name="role">
 ##	<summary>
-##	Role allowed access
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <param name="domain">
 ##	<summary>
-##	User domain for the role
+##	User domain for the role.
 ##	</summary>
 ## </param>
 #
 interface(`cron_admin_role',`
 	gen_require(`
-		type cronjob_t, crontab_exec_t, admin_crontab_t, admin_crontab_tmp_t;
+		type cronjob_t, crontab_exec_t, admin_crontab_t;
 		class passwd crontab;
+		type crond_t, user_cron_spool_t;
+		bool cron_userdomain_transition;
 	')
 
-	role $1 types { cronjob_t admin_crontab_t admin_crontab_tmp_t };
+	##############################
+	#
+	# Declarations
+	#
 
-	# cronjob shows up in user ps
-	ps_process_pattern($2, cronjob_t)
+	role $1 types { cronjob_t admin_crontab_t };
 
-	# Manipulate other users crontab.
-	allow $2 self:passwd crontab;
+	##############################
+	#
+	# Local policy
+	#
 
-	# Transition from the user domain to the derived domain.
 	domtrans_pattern($2, crontab_exec_t, admin_crontab_t)
 
-	# crontab shows up in user ps
+	dontaudit crond_t $2:process { noatsecure siginh rlimitinh };
+	allow $2 crond_t:process sigchld;
+
+	allow $2 user_cron_spool_t:file { getattr read write ioctl };
+
+	allow $2 admin_crontab_t:process { ptrace signal_perms };
 	ps_process_pattern($2, admin_crontab_t)
-	allow $2 admin_crontab_t:process signal;
 
-	# Run helper programs as the user domain
-	#corecmd_bin_domtrans(admin_crontab_t, $2)
-	#corecmd_shell_domtrans(admin_crontab_t, $2)
+	# Manipulate other users crontab.
+	allow $2 self:passwd crontab;
+
 	corecmd_exec_bin(admin_crontab_t)
 	corecmd_exec_shell(admin_crontab_t)
 
+	tunable_policy(`cron_userdomain_transition',`
+		allow crond_t $2:process transition;
+		allow crond_t $2:fd use;
+		allow crond_t $2:key manage_key_perms;
+
+		allow $2 user_cron_spool_t:file entrypoint;
+
+		allow $2 crond_t:fifo_file rw_fifo_file_perms;
+
+		allow $2 cronjob_t:process { ptrace signal_perms };
+		ps_process_pattern($2, cronjob_t)
+	',`
+		dontaudit crond_t $2:process transition;
+		dontaudit crond_t $2:fd use;
+		dontaudit crond_t $2:key manage_key_perms;
+
+		dontaudit $2 user_cron_spool_t:file entrypoint;
+
+		dontaudit $2 crond_t:fifo_file rw_fifo_file_perms;
+
+		dontaudit $2 cronjob_t:process { ptrace signal_perms };
+	')
+
 	optional_policy(`
 		gen_require(`
 			class dbus send_msg;
@@ -235,13 +285,13 @@
 		dbus_stub(admin_cronjob_t)
 
 		allow cronjob_t $2:dbus send_msg;
-	')		
+	')
 ')
 
 ########################################
 ## <summary>
-##	Make the specified program domain accessable
-##	from the system cron jobs.
+##	Make the specified program domain
+##	accessable from the system cron jobs.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -263,6 +313,14 @@
 	domtrans_pattern(crond_t, $2, $1)
 
 	role system_r types $1;
+
+	ifdef(`distro_gentoo',`
+		gen_require(`
+			type user_cron_spool_log_t;
+		')
+
+		rw_files_pattern($1, user_cron_spool_log_t, user_cron_spool_log_t)
+	')
 ')
 
 ########################################
@@ -280,12 +338,13 @@
 		type system_cronjob_t, crond_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, crond_exec_t, system_cronjob_t)
 ')
 
 ########################################
 ## <summary>
-##	Execute crond_exec_t 
+##	Execute crond in the caller domain. 
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -298,12 +357,13 @@
 		type crond_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	can_exec($1, crond_exec_t)
 ')
 
 ########################################
 ## <summary>
-##	Execute crond server in the nscd domain.
+##	Execute crond server in the crond domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -321,8 +381,7 @@
 
 ########################################
 ## <summary>
-##	Inherit and use a file descriptor
-##	from the cron daemon.
+##	Use crond file descriptors.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -340,7 +399,7 @@
 
 ########################################
 ## <summary>
-##	Send a SIGCHLD signal to the cron daemon.
+##	Send child terminated signals to crond.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -358,7 +417,90 @@
 
 ########################################
 ## <summary>
-##	Read a cron daemon unnamed pipe.
+##	Set the attributes of cron log files.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`cron_setattr_log_files',`
+	gen_require(`
+		type cron_log_t;
+	')
+
+	allow $1 cron_log_t:file setattr_file_perms;
+')
+
+########################################
+## <summary>
+##	Create cron log files.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`cron_create_log_files',`
+	gen_require(`
+		type cron_log_t;
+	')
+
+	create_files_pattern($1, cron_log_t, cron_log_t)
+')
+
+########################################
+## <summary>
+##	Write to cron log files.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`cron_write_log_files',`
+	gen_require(`
+		type cron_log_t;
+	')
+
+	allow $1 cron_log_t:file write_file_perms;
+')
+
+########################################
+## <summary>
+##	Create specified objects in generic
+##	log directories with the cron log file type.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="object_class">
+##	<summary>
+##	Class of the object being created.
+##	</summary>
+## </param>
+## <param name="name" optional="true">
+##	<summary>
+##	The name of the object being created.
+##	</summary>
+## </param>
+#
+interface(`cron_generic_log_filetrans_log',`
+	gen_require(`
+		type cron_log_t;
+	')
+
+	logging_log_filetrans($1, cron_log_t, $2, $3)
+')
+
+########################################
+## <summary>
+##	Read cron daemon unnamed pipes.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -376,7 +518,8 @@
 
 ########################################
 ## <summary>
-##	Do not audit attempts to write cron daemon unnamed pipes.
+##	Do not audit attempts to write
+##	cron daemon unnamed pipes.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -394,7 +537,7 @@
 
 ########################################
 ## <summary>
-##	Read and write a cron daemon unnamed pipe.
+##	Read and write crond unnamed pipes.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -412,7 +555,7 @@
 
 ########################################
 ## <summary>
-##	Read, and write cron daemon TCP sockets.
+##	Read and write crond TCP sockets.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -430,7 +573,8 @@
 
 ########################################
 ## <summary>
-##	Dontaudit Read, and write cron daemon TCP sockets.
+##	Do not audit attempts to read and
+##	write cron daemon TCP sockets.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -448,7 +592,7 @@
 
 ########################################
 ## <summary>
-##	Search the directory containing user cron tables.
+##	Search cron spool directories.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -467,7 +611,8 @@
 
 ########################################
 ## <summary>
-##	Manage pid files used by cron
+##	Create, read, write, and delete
+##	crond pid files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -485,7 +630,8 @@
 
 ########################################
 ## <summary>
-##	Execute anacron in the cron system domain.
+##	Execute anacron in the cron
+##	system domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -498,13 +644,13 @@
 		type system_cronjob_t, anacron_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, anacron_exec_t, system_cronjob_t)
 ')
 
 ########################################
 ## <summary>
-##	Inherit and use a file descriptor
-##	from system cron jobs.
+##	Use system cron job file descriptors.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -522,7 +668,46 @@
 
 ########################################
 ## <summary>
-##	Write a system cron job unnamed pipe.
+##	Read system cron job lib files.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`cron_read_system_job_lib_files',`
+	gen_require(`
+		type system_cronjob_var_lib_t;
+	')
+
+	files_search_var_lib($1)
+	read_files_pattern($1, system_cronjob_var_lib_t, system_cronjob_var_lib_t)
+')
+
+########################################
+## <summary>
+##	Create, read, write, and delete
+##	system cron job lib files.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`cron_manage_system_job_lib_files',`
+	gen_require(`
+		type system_cronjob_var_lib_t;
+	')
+
+	files_search_var_lib($1)
+	manage_files_pattern($1, system_cronjob_var_lib_t, system_cronjob_var_lib_t)
+')
+
+########################################
+## <summary>
+##	Write system cron job unnamed pipes.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -540,7 +725,8 @@
 
 ########################################
 ## <summary>
-##	Read and write a system cron job unnamed pipe.
+##	Read and write system cron job
+##	unnamed pipes.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -558,7 +744,8 @@
 
 ########################################
 ## <summary>
-##	Allow read/write unix stream sockets from the system cron jobs.
+##	Read and write inherited system cron
+##	job unix domain stream sockets.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -576,7 +763,7 @@
 
 ########################################
 ## <summary>
-##	Read temporary files from the system cron jobs.
+##	Read system cron job temporary files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -596,7 +783,7 @@
 ########################################
 ## <summary>
 ##	Do not audit attempts to append temporary
-##	files from the system cron jobs.
+##	system cron job files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -615,7 +802,7 @@
 ########################################
 ## <summary>
 ##	Do not audit attempts to write temporary
-##	files from the system cron jobs.
+##	system cron job files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/cron.te refpolicy/policy/modules/contrib/cron.te
--- refpolicy/policy/modules/contrib/cron.te	2012-05-04 15:16:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/cron.te	2012-11-12 22:45:49.145146859 +0100
@@ -1,4 +1,4 @@
-policy_module(cron, 2.4.0)
+policy_module(cron, 2.5.8)
 
 gen_require(`
 	class passwd rootok;
@@ -10,37 +10,47 @@
 #
 
 ## <desc>
-## <p>
-## Allow system cron jobs to relabel filesystem
-## for restoring file contexts.
-## </p>
+##	<p>
+##	Determine whether system cron jobs
+##	can relabel filesystem for
+##	restoring file contexts.
+##	</p>
 ## </desc>
 gen_tunable(cron_can_relabel, false)
 
 ## <desc>
-## <p>
-## Enable extra rules in the cron domain
-## to support fcron.
-## </p>
+##	<p>
+##	Determine whether crond can execute jobs
+##	in the user domain as opposed to the
+##	the generic cronjob domain.
+##	</p>
+## </desc>
+gen_tunable(cron_userdomain_transition, false)
+
+## <desc>
+##	<p>
+##	Determine whether extra rules
+##	should beenabled to support fcron.
+##	</p>
 ## </desc>
 gen_tunable(fcron_crond, false)
 
 attribute cron_spool_type;
+attribute crontab_domain;
 
 type anacron_exec_t;
 application_executable_file(anacron_exec_t)
 
 type cron_spool_t;
 files_type(cron_spool_t)
+mta_system_content(cron_spool_t)
 
-# var/lib files
 type cron_var_lib_t;
 files_type(cron_var_lib_t)
 
 type cron_var_run_t;
-files_type(cron_var_run_t)
+files_pid_file(cron_var_run_t)
 
-# var/log files
 type cron_log_t;
 logging_log_file(cron_log_t)
 
@@ -63,9 +73,12 @@
 
 type crond_tmp_t;
 files_tmp_file(crond_tmp_t)
+files_poly_parent(crond_tmp_t)
+mta_system_content(crond_tmp_t)
 
 type crond_var_run_t;
 files_pid_file(crond_var_run_t)
+mta_system_content(crond_var_run_t)
 
 type crontab_exec_t;
 application_executable_file(crontab_exec_t)
@@ -82,11 +95,12 @@
 
 type system_cron_spool_t, cron_spool_type;
 files_type(system_cron_spool_t)
+mta_system_content(system_cron_spool_t)
 
 type system_cronjob_t alias system_crond_t;
 init_daemon_domain(system_cronjob_t, anacron_exec_t)
 corecmd_shell_entry_type(system_cronjob_t)
-role system_r types system_cronjob_t;
+domain_entry_file(system_cronjob_t, system_cron_spool_t)
 
 type system_cronjob_lock_t alias system_crond_lock_t;
 files_lock_file(system_cronjob_lock_t)
@@ -94,30 +108,101 @@
 type system_cronjob_tmp_t alias system_crond_tmp_t;
 files_tmp_file(system_cronjob_tmp_t)
 
-ifdef(`enable_mcs',`
-	init_ranged_daemon_domain(crond_t, crond_exec_t, s0 - mcs_systemhigh)
-')
+type system_cronjob_var_lib_t;
+files_type(system_cronjob_var_lib_t)
 
-type unconfined_cronjob_t;
-domain_type(unconfined_cronjob_t)
-domain_cron_exemption_target(unconfined_cronjob_t)
+type system_cronjob_var_run_t;
+files_pid_file(system_cronjob_var_run_t)
 
-# Type of user crontabs once moved to cron spool.
 type user_cron_spool_t, cron_spool_type;
 typealias user_cron_spool_t alias { staff_cron_spool_t sysadm_cron_spool_t unconfined_cron_spool_t };
 typealias user_cron_spool_t alias { auditadm_cron_spool_t secadm_cron_spool_t };
 files_type(user_cron_spool_t)
 ubac_constrained(user_cron_spool_t)
+mta_system_content(user_cron_spool_t)
+
+ifdef(`distro_gentoo',`
+	# Logging for atd jobs
+	type user_cron_spool_log_t;
+	logging_log_file(user_cron_spool_log_t)
+	ubac_constrained(user_cron_spool_log_t)
+	mta_system_content(user_cron_spool_log_t)
+
+	domain_interactive_fd(cronjob_t)
+	domain_interactive_fd(system_cronjob_t)
+
+	logging_syslog_managed_log_file(cron_log_t, "cron.log")
+')
+
+ifdef(`enable_mcs',`
+	init_ranged_daemon_domain(crond_t, crond_exec_t, s0 - mcs_systemhigh)
+')
+
+##############################
+#
+# Common crontab local policy
+#
+
+allow crontab_domain self:capability { fowner setuid setgid chown dac_override };
+allow crontab_domain self:process { getcap setsched signal_perms };
+allow crontab_domain self:fifo_file rw_fifo_file_perms;
+
+manage_files_pattern(crontab_domain, { cron_spool_t user_cron_spool_t }, user_cron_spool_t)
+filetrans_pattern(crontab_domain, cron_spool_t, user_cron_spool_t, file)
+
+allow crontab_domain cron_spool_t:dir setattr_dir_perms;
+
+allow crontab_domain crond_t:process signal;
+allow crontab_domain crond_var_run_t:file read_file_perms;
+
+kernel_read_system_state(crontab_domain)
+
+selinux_dontaudit_search_fs(crontab_domain)
+
+files_list_spool(crontab_domain)
+files_read_etc_files(crontab_domain)
+files_read_usr_files(crontab_domain)
+files_search_pids(crontab_domain)
+
+fs_getattr_xattr_fs(crontab_domain)
+fs_manage_cgroup_dirs(crontab_domain)
+fs_rw_cgroup_files(crontab_domain)
+
+domain_use_interactive_fds(crontab_domain)
+
+fs_dontaudit_rw_anon_inodefs_files(crontab_domain)
+
+auth_rw_var_auth(crontab_domain)
+
+logging_send_syslog_msg(crontab_domain)
+logging_send_audit_msgs(crontab_domain)
+logging_set_loginuid(crontab_domain)
+
+init_dontaudit_write_utmp(crontab_domain)
+init_read_utmp(crontab_domain)
+init_read_state(crontab_domain)
+
+miscfiles_read_localization(crontab_domain)
+
+seutil_read_config(crontab_domain)
+
+userdom_manage_user_tmp_dirs(crontab_domain)
+userdom_manage_user_tmp_files(crontab_domain)
+userdom_use_user_terminals(crontab_domain)
+userdom_read_user_home_content_files(crontab_domain)
+userdom_read_user_home_content_symlinks(crontab_domain)
+
+tunable_policy(`fcron_crond',`
+	dontaudit crontab_domain crond_t:process signal;
+')
 
 ########################################
 #
-# Admin crontab local policy
+# Admin local policy
 #
 
-# Allow our crontab domain to unlink a user cron spool file.
-allow admin_crontab_t user_cron_spool_t:file { getattr read unlink };
+allow admin_crontab_t crond_t:process signal;
 
-# Manipulate other users crontab.
 selinux_get_fs_mount(admin_crontab_t)
 selinux_validate_context(admin_crontab_t)
 selinux_compute_access_vector(admin_crontab_t)
@@ -125,34 +210,35 @@
 selinux_compute_relabel_context(admin_crontab_t)
 selinux_compute_user_contexts(admin_crontab_t)
 
-tunable_policy(`fcron_crond', `
-	# fcron wants an instant update of a crontab change for the administrator
-	# also crontab does a security check for crontab -u
+ifdef(`distro_gentoo',`
+	allow admin_crontab_t self:capability fsetid;
+')
+
+tunable_policy(`fcron_crond',`
 	allow admin_crontab_t self:process setfscreate;
 ')
 
 ########################################
 #
-# Cron daemon local policy
+# Daemon local policy
 #
 
-allow crond_t self:capability { dac_override setgid setuid sys_nice dac_read_search };
+allow crond_t self:capability { dac_override chown fowner setgid setuid sys_nice dac_read_search };
 dontaudit crond_t self:capability { sys_resource sys_tty_config };
-allow crond_t self:process ~{ ptrace setcurrent setexec setfscreate setrlimit execmem execstack execheap };
+allow crond_t self:process ~{ ptrace setcurrent setexec setfscreate execmem execstack execheap };
 allow crond_t self:process { setexec setfscreate };
 allow crond_t self:fd use;
 allow crond_t self:fifo_file rw_fifo_file_perms;
-allow crond_t self:unix_dgram_socket create_socket_perms;
-allow crond_t self:unix_stream_socket create_stream_socket_perms;
 allow crond_t self:unix_dgram_socket sendto;
-allow crond_t self:unix_stream_socket connectto;
+allow crond_t self:unix_stream_socket { accept connectto listen };
 allow crond_t self:shm create_shm_perms;
 allow crond_t self:sem create_sem_perms;
 allow crond_t self:msgq create_msgq_perms;
 allow crond_t self:msg { send receive };
 allow crond_t self:key { search write link };
+dontaudit crond_t self:netlink_audit_socket nlmsg_tty_audit;
 
-manage_files_pattern(crond_t, cron_log_t, cron_log_t)
+allow crond_t cron_log_t:file { append_file_perms create_file_perms setattr_file_perms };
 logging_log_filetrans(crond_t, cron_log_t, file)
 
 manage_files_pattern(crond_t, crond_var_run_t, crond_var_run_t)
@@ -162,80 +248,107 @@
 
 manage_dirs_pattern(crond_t, crond_tmp_t, crond_tmp_t)
 manage_files_pattern(crond_t, crond_tmp_t, crond_tmp_t)
-files_tmp_filetrans(crond_t, crond_tmp_t, { file dir })
+files_tmp_filetrans(crond_t, crond_tmp_t, { dir file })
 
 list_dirs_pattern(crond_t, system_cron_spool_t, system_cron_spool_t)
 read_files_pattern(crond_t, system_cron_spool_t, system_cron_spool_t)
 
-kernel_read_kernel_sysctls(crond_t)
-kernel_read_fs_sysctls(crond_t)
-kernel_search_key(crond_t)
+rw_dirs_pattern(crond_t, user_cron_spool_t, user_cron_spool_t)
+read_files_pattern(crond_t, user_cron_spool_t, user_cron_spool_t)
+manage_lnk_files_pattern(crond_t, user_cron_spool_t, user_cron_spool_t)
 
-dev_read_sysfs(crond_t)
-selinux_get_fs_mount(crond_t)
-selinux_validate_context(crond_t)
-selinux_compute_access_vector(crond_t)
-selinux_compute_create_context(crond_t)
-selinux_compute_relabel_context(crond_t)
-selinux_compute_user_contexts(crond_t)
+allow crond_t system_cronjob_t:process transition;
+allow crond_t system_cronjob_t:fd use;
+allow crond_t system_cronjob_t:key manage_key_perms;
 
-dev_read_urand(crond_t)
+dontaudit crond_t { cronjob_t system_cronjob_t }:process { noatsecure siginh rlimitinh };
 
-fs_getattr_all_fs(crond_t)
-fs_search_auto_mountpoints(crond_t)
-fs_list_inotifyfs(crond_t)
+domtrans_pattern(crond_t, anacron_exec_t, system_cronjob_t)
 
-# need auth_chkpwd to check for locked accounts.
-auth_domtrans_chk_passwd(crond_t)
+kernel_read_kernel_sysctls(crond_t)
+kernel_read_fs_sysctls(crond_t)
+kernel_search_key(crond_t)
 
 corecmd_exec_shell(crond_t)
+corecmd_exec_bin(crond_t)
 corecmd_list_bin(crond_t)
-corecmd_read_bin_symlinks(crond_t)
+
+dev_read_sysfs(crond_t)
+dev_read_urand(crond_t)
 
 domain_use_interactive_fds(crond_t)
+domain_subj_id_change_exemption(crond_t)
+domain_role_change_exemption(crond_t)
+
+fs_getattr_all_fs(crond_t)
+fs_list_inotifyfs(crond_t)
+fs_manage_cgroup_dirs(crond_t)
+fs_rw_cgroup_files(crond_t)
+fs_search_auto_mountpoints(crond_t)
 
 files_read_usr_files(crond_t)
 files_read_etc_runtime_files(crond_t)
-files_read_etc_files(crond_t)
 files_read_generic_spool(crond_t)
 files_list_usr(crond_t)
-# Read from /var/spool/cron.
 files_search_var_lib(crond_t)
 files_search_default(crond_t)
 
+mls_fd_share_all_levels(crond_t)
+mls_file_read_all_levels(crond_t)
+mls_file_write_all_levels(crond_t)
+mls_process_set_level(crond_t)
+mls_trusted_object(crond_t)
+
+selinux_get_fs_mount(crond_t)
+selinux_validate_context(crond_t)
+selinux_compute_access_vector(crond_t)
+selinux_compute_create_context(crond_t)
+selinux_compute_relabel_context(crond_t)
+selinux_compute_user_contexts(crond_t)
+
+init_read_state(crond_t)
 init_rw_utmp(crond_t)
 init_spec_domtrans_script(crond_t)
 
+auth_domtrans_chk_passwd(crond_t)
+auth_manage_var_auth(crond_t)
 auth_use_nsswitch(crond_t)
 
+logging_send_audit_msgs(crond_t)
 logging_send_syslog_msg(crond_t)
 logging_set_loginuid(crond_t)
 
 seutil_read_config(crond_t)
 seutil_read_default_contexts(crond_t)
-seutil_sigchld_newrole(crond_t)
 
 miscfiles_read_localization(crond_t)
 
-userdom_use_unpriv_users_fds(crond_t)
-# Not sure why this is needed
 userdom_list_user_home_dirs(crond_t)
 
-mta_send_mail(crond_t)
+tunable_policy(`cron_userdomain_transition',`
+	dontaudit crond_t cronjob_t:process transition;
+	dontaudit crond_t cronjob_t:fd use;
+	dontaudit crond_t cronjob_t:key manage_key_perms;
+',`
+	allow crond_t cronjob_t:process transition;
+	allow crond_t cronjob_t:fd use;
+	allow crond_t cronjob_t:key manage_key_perms;
+')
 
 ifdef(`distro_debian',`
-	# pam_limits is used
 	allow crond_t self:process setrlimit;
 
 	optional_policy(`
-		# Debian logcheck has the home dir set to its cache
 		logwatch_search_cache_dir(crond_t)
 	')
 ')
 
-ifdef(`distro_redhat', `
-	# Run the rpm program in the rpm_t domain. Allow creation of RPM log files
-	# via redirection of standard out.
+ifdef(`distro_gentoo',`
+	manage_files_pattern(crond_t, user_cron_spool_t, user_cron_spool_t)
+	manage_files_pattern(crond_t, user_cron_spool_log_t, user_cron_spool_log_t)
+')
+
+ifdef(`distro_redhat',`
 	optional_policy(`
 		rpm_manage_log(crond_t)
 	')
@@ -245,13 +358,24 @@
 	files_polyinstantiate_all(crond_t)
 ')
 
-tunable_policy(`fcron_crond', `
-	allow crond_t system_cron_spool_t:file manage_file_perms;
+tunable_policy(`fcron_crond',`
+	allow crond_t { system_cron_spool_t user_cron_spool_t }:file manage_file_perms;
 ')
 
 optional_policy(`
-	locallogin_search_keys(crond_t)
-	locallogin_link_keys(crond_t)
+	apache_search_sys_content(crond_t)
+')
+
+optional_policy(`
+	dbus_system_bus_client(crond_t)
+
+	optional_policy(`
+		hal_dbus_chat(crond_t)
+	')
+
+	optional_policy(`
+		unconfined_dbus_send(crond_t)
+	')
 ')
 
 optional_policy(`
@@ -263,26 +387,41 @@
 ')
 
 optional_policy(`
-	hal_dbus_chat(crond_t)
+	djbdns_search_tinydns_keys(crond_t)
+	djbdns_link_tinydns_keys(crond_t)
+')
+
+optional_policy(`
+	hal_write_log(crond_t)
+')
+
+optional_policy(`
+	locallogin_search_keys(crond_t)
+	locallogin_link_keys(crond_t)
+')
+
+optional_policy(`
+	mta_send_mail(crond_t)
 ')
 
 optional_policy(`
-	# cjp: why?
 	munin_search_lib(crond_t)
 ')
 
 optional_policy(`
+	postgresql_search_db(crond_t)
+')
+
+optional_policy(`
 	rpc_search_nfs_state_data(crond_t)
 ')
 
 optional_policy(`
-	# Commonly used from postinst scripts
 	rpm_read_pipes(crond_t)
 ')
 
 optional_policy(`
-	# allow crond to find /usr/lib/postgresql/bin/do.maintenance
-	postgresql_search_db(crond_t)
+	seutil_sigchld_newrole(crond_t)
 ')
 
 optional_policy(`
@@ -291,7 +430,7 @@
 
 ########################################
 #
-# System cron process domain
+# System local policy
 #
 
 allow system_cronjob_t self:capability { dac_override dac_read_search chown setgid setuid fowner net_bind_service fsetid sys_nice };
@@ -299,56 +438,39 @@
 allow system_cronjob_t self:fifo_file rw_fifo_file_perms;
 allow system_cronjob_t self:passwd rootok;
 
-# This is to handle creation of files in /var/log directory.
-#  Used currently by rpm script log files
-allow system_cronjob_t cron_log_t:file manage_file_perms;
+allow system_cronjob_t cron_log_t:file { append_file_perms create_file_perms setattr_file_perms };
 logging_log_filetrans(system_cronjob_t, cron_log_t, file)
 
-# This is to handle /var/lib/misc directory.  Used currently
-# by prelink var/lib files for cron 
-allow system_cronjob_t cron_var_lib_t:file manage_file_perms;
+allow system_cronjob_t cron_var_lib_t:file { manage_file_perms relabel_file_perms };
 files_var_lib_filetrans(system_cronjob_t, cron_var_lib_t, file)
 
-allow system_cronjob_t system_cron_spool_t:file read_file_perms;
-# The entrypoint interface is not used as this is not
-# a regular entrypoint.  Since crontab files are
-# not directly executed, crond must ensure that
-# the crontab file has a type that is appropriate
-# for the domain of the user cron job.  It
-# performs an entrypoint permission check
-# for this purpose.
-allow system_cronjob_t system_cron_spool_t:file entrypoint;
-
-# Permit a transition from the crond_t domain to this domain.
-# The transition is requested explicitly by the modified crond 
-# via setexeccon.  There is no way to set up an automatic
-# transition, since crontabs are configuration files, not executables.
-allow crond_t system_cronjob_t:process transition;
-dontaudit crond_t system_cronjob_t:process { noatsecure siginh rlimitinh };
-allow crond_t system_cronjob_t:fd use;
-allow system_cronjob_t crond_t:fd use;
-allow system_cronjob_t crond_t:fifo_file rw_file_perms;
-allow system_cronjob_t crond_t:process sigchld;
+allow system_cronjob_t cron_var_run_t:file manage_file_perms;
+files_pid_filetrans(system_cronjob_t, cron_var_run_t, file)
+
+manage_files_pattern(system_cronjob_t, system_cron_spool_t, system_cron_spool_t)
 
-# Write /var/lock/makewhatis.lock.
 allow system_cronjob_t system_cronjob_lock_t:file manage_file_perms;
 files_lock_filetrans(system_cronjob_t, system_cronjob_lock_t, file)
 
-# write temporary files
 manage_files_pattern(system_cronjob_t, crond_tmp_t, system_cronjob_tmp_t)
 manage_lnk_files_pattern(system_cronjob_t, crond_tmp_t, system_cronjob_tmp_t)
 filetrans_pattern(system_cronjob_t, crond_tmp_t, system_cronjob_tmp_t, { file lnk_file })
 files_tmp_filetrans(system_cronjob_t, system_cronjob_tmp_t, file)
 
-# Read from /var/spool/cron.
+manage_files_pattern(system_cronjob_t, system_cronjob_var_lib_t, system_cronjob_var_lib_t)
+
+allow system_cronjob_t crond_t:fd use;
+allow system_cronjob_t crond_t:fifo_file rw_fifo_file_perms;
+allow system_cronjob_t crond_t:process sigchld;
+
 allow system_cronjob_t cron_spool_t:dir list_dir_perms;
-allow system_cronjob_t cron_spool_t:file read_file_perms;
+allow system_cronjob_t cron_spool_t:file rw_file_perms;
 
 kernel_read_kernel_sysctls(system_cronjob_t)
+kernel_read_network_state(system_cronjob_t)
 kernel_read_system_state(system_cronjob_t)
 kernel_read_software_raid_state(system_cronjob_t)
 
-# ps does not need to access /boot when run from cron
 files_dontaudit_search_boot(system_cronjob_t)
 
 corecmd_exec_all_executables(system_cronjob_t)
@@ -365,6 +487,7 @@
 dev_getattr_all_blk_files(system_cronjob_t)
 dev_getattr_all_chr_files(system_cronjob_t)
 dev_read_urand(system_cronjob_t)
+dev_read_sysfs(system_cronjob_t)
 
 fs_getattr_all_fs(system_cronjob_t)
 fs_getattr_all_files(system_cronjob_t)
@@ -372,11 +495,9 @@
 fs_getattr_all_pipes(system_cronjob_t)
 fs_getattr_all_sockets(system_cronjob_t)
 
-# quiet other ps operations
 domain_dontaudit_read_all_domains_state(system_cronjob_t)
 
 files_exec_etc_files(system_cronjob_t)
-files_read_etc_files(system_cronjob_t)
 files_read_etc_runtime_files(system_cronjob_t)
 files_list_all(system_cronjob_t)
 files_getattr_all_dirs(system_cronjob_t)
@@ -386,17 +507,13 @@
 files_getattr_all_sockets(system_cronjob_t)
 files_read_usr_files(system_cronjob_t)
 files_read_var_files(system_cronjob_t)
-# for nscd:
 files_dontaudit_search_pids(system_cronjob_t)
-# Access other spool directories like
-# /var/spool/anacron and /var/spool/slrnpull.
 files_manage_generic_spool(system_cronjob_t)
+files_create_boot_flag(system_cronjob_t)
+
+mls_file_read_to_clearance(system_cronjob_t)
 
 init_use_script_fds(system_cronjob_t)
-init_read_utmp(system_cronjob_t)
-init_dontaudit_rw_utmp(system_cronjob_t)
-# prelink tells init to restart it self, we either need to allow or dontaudit
-init_telinit(system_cronjob_t)
 init_domtrans_script(system_cronjob_t)
 
 auth_use_nsswitch(system_cronjob_t)
@@ -409,13 +526,10 @@
 logging_send_syslog_msg(system_cronjob_t)
 
 miscfiles_read_localization(system_cronjob_t)
-miscfiles_manage_man_pages(system_cronjob_t)
 
 seutil_read_config(system_cronjob_t)
 
-ifdef(`distro_redhat', `
-	# Run the rpm program in the rpm_t domain. Allow creation of RPM log files
-	# via redirection of standard out.
+ifdef(`distro_redhat',`
 	optional_policy(`
 		rpm_manage_log(system_cronjob_t)
 	')
@@ -434,7 +548,6 @@
 ')
 
 optional_policy(`
-	# Needed for certwatch
 	apache_exec_modules(system_cronjob_t)
 	apache_read_config(system_cronjob_t)
 	apache_read_log(system_cronjob_t)
@@ -446,6 +559,18 @@
 ')
 
 optional_policy(`
+	dbus_system_bus_client(system_cronjob_t)
+
+	optional_policy(`
+		networkmanager_dbus_chat(system_cronjob_t)
+	')
+')
+
+optional_policy(`
+	exim_read_spool_files(system_cronjob_t)
+')
+
+optional_policy(`
 	ftp_read_log(system_cronjob_t)
 ')
 
@@ -456,6 +581,10 @@
 ')
 
 optional_policy(`
+	livecd_read_tmp_files(system_cronjob_t)
+')
+
+optional_policy(`
 	lpd_list_spool(system_cronjob_t)
 ')
 
@@ -464,6 +593,7 @@
 ')
 
 optional_policy(`
+	mta_read_config(system_cronjob_t)
 	mta_send_mail(system_cronjob_t)
 ')
 
@@ -473,7 +603,7 @@
 
 optional_policy(`
 	postfix_read_config(system_cronjob_t)
-')	
+')
 
 optional_policy(`
 	prelink_delete_cache(system_cronjob_t)
@@ -486,11 +616,6 @@
 optional_policy(`
 	samba_read_config(system_cronjob_t)
 	samba_read_log(system_cronjob_t)
-	#samba_read_secrets(system_cronjob_t)
-')
-
-optional_policy(`
-	slocate_create_append_log(system_cronjob_t)
 ')
 
 optional_policy(`
@@ -502,13 +627,12 @@
 ')
 
 optional_policy(`
-	unconfined_domain(system_cronjob_t)
 	userdom_user_home_dir_filetrans_user_home_content(system_cronjob_t, { dir file lnk_file fifo_file sock_file })
 ')
 
 ########################################
 #
-# User cronjobs local policy
+# Cronjob local policy
 #
 
 allow cronjob_t self:process { signal_perms setsched };
@@ -516,30 +640,9 @@
 allow cronjob_t self:unix_stream_socket create_stream_socket_perms;
 allow cronjob_t self:unix_dgram_socket create_socket_perms;
 
-# The entrypoint interface is not used as this is not
-# a regular entrypoint.  Since crontab files are
-# not directly executed, crond must ensure that
-# the crontab file has a type that is appropriate
-# for the domain of the user cron job.  It
-# performs an entrypoint permission check
-# for this purpose.
-allow cronjob_t user_cron_spool_t:file entrypoint;
-
-# Permit a transition from the crond_t domain to this domain.
-# The transition is requested explicitly by the modified crond 
-# via setexeccon.  There is no way to set up an automatic
-# transition, since crontabs are configuration files, not executables.
-allow crond_t cronjob_t:process transition;
-dontaudit crond_t cronjob_t:process { noatsecure siginh rlimitinh };
-allow crond_t cronjob_t:fd use;
-allow cronjob_t crond_t:fd use;
-allow cronjob_t crond_t:fifo_file rw_file_perms;
-allow cronjob_t crond_t:process sigchld;
-
 kernel_read_system_state(cronjob_t)
 kernel_read_kernel_sysctls(cronjob_t)
 
-# ps does not need to access /boot when run from cron
 files_dontaudit_search_boot(cronjob_t)
 
 corenet_all_recvfrom_unlabeled(cronjob_t)
@@ -550,31 +653,29 @@
 corenet_udp_sendrecv_generic_node(cronjob_t)
 corenet_tcp_sendrecv_all_ports(cronjob_t)
 corenet_udp_sendrecv_all_ports(cronjob_t)
-corenet_tcp_connect_all_ports(cronjob_t)
+
 corenet_sendrecv_all_client_packets(cronjob_t)
+corenet_tcp_connect_all_ports(cronjob_t)
+
+corecmd_exec_all_executables(cronjob_t)
 
 dev_read_urand(cronjob_t)
 
 fs_getattr_all_fs(cronjob_t)
 
-corecmd_exec_all_executables(cronjob_t)
-
-# quiet other ps operations
 domain_dontaudit_read_all_domains_state(cronjob_t)
 domain_dontaudit_getattr_all_domains(cronjob_t)
 
-files_read_usr_files(cronjob_t)
 files_exec_etc_files(cronjob_t)
-# for nscd:
+files_read_etc_runtime_files(cronjob_t)
+files_read_var_files(cronjob_t)
+files_read_usr_files(cronjob_t)
+files_search_spool(cronjob_t)
 files_dontaudit_search_pids(cronjob_t)
 
 libs_exec_lib_files(cronjob_t)
 libs_exec_ld_so(cronjob_t)
 
-files_read_etc_runtime_files(cronjob_t)
-files_read_var_files(cronjob_t)
-files_search_spool(cronjob_t)
-
 logging_search_logs(cronjob_t)
 
 seutil_read_config(cronjob_t)
@@ -585,26 +686,25 @@
 userdom_manage_user_tmp_symlinks(cronjob_t)
 userdom_manage_user_tmp_pipes(cronjob_t)
 userdom_manage_user_tmp_sockets(cronjob_t)
-# Run scripts in user home directory and access shared libs.
 userdom_exec_user_home_content_files(cronjob_t)
-# Access user files and dirs.
 userdom_manage_user_home_content_files(cronjob_t)
 userdom_manage_user_home_content_symlinks(cronjob_t)
 userdom_manage_user_home_content_pipes(cronjob_t)
 userdom_manage_user_home_content_sockets(cronjob_t)
-#userdom_user_home_dir_filetrans_user_home_content(cronjob_t, notdevfile_class_set)
 
-list_dirs_pattern(crond_t, user_cron_spool_t, user_cron_spool_t)
-read_files_pattern(crond_t, user_cron_spool_t, user_cron_spool_t)
+tunable_policy(`cron_userdomain_transition',`
+	dontaudit cronjob_t crond_t:fd use;
+	dontaudit cronjob_t crond_t:fifo_file rw_fifo_file_perms;
+	dontaudit cronjob_t crond_t:process sigchld;
 
-tunable_policy(`fcron_crond', `
-	allow crond_t user_cron_spool_t:file manage_file_perms;
-')
+	dontaudit cronjob_t user_cron_spool_t:file entrypoint;
+',`
+	allow cronjob_t crond_t:fd use;
+	allow cronjob_t crond_t:fifo_file rw_fifo_file_perms;
+	allow cronjob_t crond_t:process sigchld;
 
-# need a per-role version of this:
-#optional_policy(`
-#	mono_domtrans(cronjob_t)
-#')
+	allow cronjob_t user_cron_spool_t:file entrypoint;
+')
 
 optional_policy(`
 	nis_use_ypbind(cronjob_t)
@@ -612,17 +712,25 @@
 
 ########################################
 #
-# Unconfined cronjobs local policy
+# Unconfined local policy
 #
 
 optional_policy(`
-	# Permit a transition from the crond_t domain to this domain.
-	# The transition is requested explicitly by the modified crond 
-	# via setexeccon.  There is no way to set up an automatic
-	# transition, since crontabs are configuration files, not executables.
-	allow crond_t unconfined_cronjob_t:process transition;
+	type unconfined_cronjob_t;
+	domain_type(unconfined_cronjob_t)
+	domain_cron_exemption_target(unconfined_cronjob_t)
+
 	dontaudit crond_t unconfined_cronjob_t:process { noatsecure siginh rlimitinh };
-	allow crond_t unconfined_cronjob_t:fd use;
 
 	unconfined_domain(unconfined_cronjob_t)
+
+	tunable_policy(`cron_userdomain_transition',`
+		dontaudit crond_t unconfined_cronjob_t:process transition;
+		dontaudit crond_t unconfined_cronjob_t:fd use;
+		dontaudit crond_t unconfined_cronjob_t:key manage_key_perms;
+	',`
+		allow crond_t unconfined_cronjob_t:process transition;
+		allow crond_t unconfined_cronjob_t:fd use;
+		allow crond_t unconfined_cronjob_t:key manage_key_perms;
+	')
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/ctdb.fc refpolicy/policy/modules/contrib/ctdb.fc
--- refpolicy/policy/modules/contrib/ctdb.fc	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/ctdb.fc	2012-09-27 20:03:30.384126498 +0200
@@ -0,0 +1,11 @@
+/etc/rc\.d/init\.d/ctdb	--	gen_context(system_u:object_r:ctdbd_initrc_exec_t,s0)
+
+/usr/sbin/ctdbd	--	gen_context(system_u:object_r:ctdbd_exec_t,s0)
+
+/var/lib/ctdbd(/.*)?	gen_context(system_u:object_r:ctdbd_var_lib_t,s0)
+
+/var/log/log\.ctdb.*	--	gen_context(system_u:object_r:ctdbd_log_t,s0)
+
+/var/run/ctdbd(/.*)?	gen_context(system_u:object_r:ctdbd_var_run_t,s0)
+
+/var/spool/ctdb(/.*)?	gen_context(system_u:object_r:ctdbd_spool_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/ctdb.if refpolicy/policy/modules/contrib/ctdb.if
--- refpolicy/policy/modules/contrib/ctdb.if	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/ctdb.if	2012-10-27 13:03:09.490002162 +0200
@@ -0,0 +1,85 @@
+## <summary>Clustered Database based on Samba Trivial Database.</summary>
+
+########################################
+## <summary>
+##	Create, read, write, and delete
+##	ctdbd lib files.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`ctdbd_manage_lib_files',`
+	gen_require(`
+		type ctdbd_var_lib_t;
+	')
+
+	files_search_var_lib($1)
+	manage_files_pattern($1, ctdbd_var_lib_t, ctdbd_var_lib_t)
+')
+
+#######################################
+## <summary>
+##	Connect to ctdbd with a unix
+##	domain stream socket.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`ctdbd_stream_connect',`
+	gen_require(`
+		type ctdbd_t, ctdbd_var_run_t, ctdbd_tmp_t;
+	')
+
+	files_search_pids($1)
+	stream_connect_pattern($1, { ctdbd_tmp_t ctdbd_var_run_t }, { ctdbd_tmp_t ctdbd_var_run_t }, ctdbd_t)
+')
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an ctdb environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`ctdb_admin',`
+	gen_require(`
+		type ctdbd_t, ctdbd_initrc_exec_t, ctdbd_tmp_t;
+		type ctdbd_log_t, ctdbd_var_lib_t, ctdbd_var_run_t;
+	')
+
+	allow $1 ctdbd_t:process { ptrace signal_perms };
+	ps_process_pattern($1, ctdbd_t)
+
+	init_labeled_script_domtrans($1, ctdbd_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 ctdbd_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	logging_search_logs($1)
+	admin_pattern($1, ctdbd_log_t)
+
+	files_search_tmp($1)
+	admin_pattern($1, ctdbd_tmp_t)
+
+	files_search_var_lib($1)
+	admin_pattern($1, ctdbd_var_lib_t)
+
+	files_search_pids($1)
+	admin_pattern($1, ctdbd_var_run_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/ctdb.te refpolicy/policy/modules/contrib/ctdb.te
--- refpolicy/policy/modules/contrib/ctdb.te	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/ctdb.te	2012-10-27 13:03:09.490002162 +0200
@@ -0,0 +1,116 @@
+policy_module(ctdb, 1.0.2)
+
+########################################
+#
+# Declarations
+#
+
+type ctdbd_t;
+type ctdbd_exec_t;
+init_daemon_domain(ctdbd_t, ctdbd_exec_t)
+
+type ctdbd_initrc_exec_t;
+init_script_file(ctdbd_initrc_exec_t)
+
+type ctdbd_log_t;
+logging_log_file(ctdbd_log_t)
+
+type ctdbd_spool_t;
+files_type(ctdbd_spool_t)
+
+type ctdbd_tmp_t;
+files_tmp_file(ctdbd_tmp_t)
+
+type ctdbd_var_lib_t;
+files_type(ctdbd_var_lib_t)
+
+type ctdbd_var_run_t;
+files_pid_file(ctdbd_var_run_t)
+
+########################################
+#
+# Local policy
+#
+
+allow ctdbd_t self:capability { chown ipc_lock net_admin net_raw sys_nice };
+allow ctdbd_t self:process { setpgid signal_perms setsched };
+allow ctdbd_t self:fifo_file rw_fifo_file_perms;
+allow ctdbd_t self:unix_stream_socket { accept connectto listen };
+allow ctdbd_t self:netlink_route_socket r_netlink_socket_perms;
+allow ctdbd_t self:packet_socket create_socket_perms;
+allow ctdbd_t self:tcp_socket create_stream_socket_perms;
+
+append_files_pattern(ctdbd_t, ctdbd_log_t, ctdbd_log_t)
+create_files_pattern(ctdbd_t, ctdbd_log_t, ctdbd_log_t)
+setattr_files_pattern(ctdbd_t, ctdbd_log_t, ctdbd_log_t)
+logging_log_filetrans(ctdbd_t, ctdbd_log_t, file)
+
+manage_files_pattern(ctdbd_t, ctdbd_tmp_t, ctdbd_tmp_t)
+manage_sock_files_pattern(ctdbd_t, ctdbd_tmp_t, ctdbd_tmp_t)
+files_tmp_filetrans(ctdbd_t, ctdbd_tmp_t, { file sock_file })
+
+manage_dirs_pattern(ctdbd_t, ctdbd_spool_t, ctdbd_spool_t)
+manage_files_pattern(ctdbd_t, ctdbd_spool_t, ctdbd_spool_t)
+manage_lnk_files_pattern(ctdbd_t, ctdbd_spool_t, ctdbd_spool_t)
+files_spool_filetrans(ctdbd_t, ctdbd_spool_t, dir)
+
+exec_files_pattern(ctdbd_t, ctdbd_var_lib_t, ctdbd_var_lib_t)
+manage_dirs_pattern(ctdbd_t, ctdbd_var_lib_t, ctdbd_var_lib_t)
+manage_files_pattern(ctdbd_t, ctdbd_var_lib_t, ctdbd_var_lib_t)
+files_var_lib_filetrans(ctdbd_t, ctdbd_var_lib_t, dir)
+
+manage_dirs_pattern(ctdbd_t, ctdbd_var_run_t, ctdbd_var_run_t)
+manage_files_pattern(ctdbd_t, ctdbd_var_run_t, ctdbd_var_run_t)
+files_pid_filetrans(ctdbd_t, ctdbd_var_run_t, dir)
+
+kernel_read_network_state(ctdbd_t)
+kernel_read_system_state(ctdbd_t)
+kernel_rw_net_sysctls(ctdbd_t)
+
+corenet_all_recvfrom_unlabeled(ctdbd_t)
+corenet_all_recvfrom_netlabel(ctdbd_t)
+corenet_tcp_sendrecv_generic_if(ctdbd_t)
+corenet_tcp_sendrecv_generic_node(ctdbd_t)
+corenet_tcp_bind_generic_node(ctdbd_t)
+
+corenet_sendrecv_ctdb_server_packets(ctdbd_t)
+corenet_tcp_bind_ctdb_port(ctdbd_t)
+corenet_tcp_sendrecv_ctdb_port(ctdbd_t)
+
+corecmd_exec_bin(ctdbd_t)
+corecmd_exec_shell(ctdbd_t)
+
+dev_read_sysfs(ctdbd_t)
+dev_read_urand(ctdbd_t)
+
+domain_dontaudit_read_all_domains_state(ctdbd_t)
+
+files_read_etc_files(ctdbd_t)
+files_search_all_mountpoints(ctdbd_t)
+
+logging_send_syslog_msg(ctdbd_t)
+
+miscfiles_read_localization(ctdbd_t)
+miscfiles_read_public_files(ctdbd_t)
+
+optional_policy(`
+	consoletype_exec(ctdbd_t)
+')
+
+optional_policy(`
+	hostname_exec(ctdbd_t)
+')
+
+optional_policy(`
+	iptables_domtrans(ctdbd_t)
+')
+
+optional_policy(`
+	samba_initrc_domtrans(ctdbd_t)
+	samba_domtrans_net(ctdbd_t)
+	samba_rw_var_files(ctdbd_t)
+')
+
+optional_policy(`
+	sysnet_domtrans_ifconfig(ctdbd_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/cups.fc refpolicy/policy/modules/contrib/cups.fc
--- refpolicy/policy/modules/contrib/cups.fc	2012-05-04 16:10:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/cups.fc	2012-09-27 20:03:30.745126498 +0200
@@ -1,69 +1,76 @@
+/etc/alchemist/namespace/printconf(/.*)?	gen_context(system_u:object_r:cupsd_rw_etc_t,s0)
 
-/etc/alchemist/namespace/printconf(/.*)? gen_context(system_u:object_r:cupsd_rw_etc_t,s0)
-
-/etc/cups(/.*)?			gen_context(system_u:object_r:cupsd_etc_t,s0)
-/etc/cups/classes\.conf.* --	gen_context(system_u:object_r:cupsd_rw_etc_t,s0)
-/etc/cups/cupsd\.conf.* --	gen_context(system_u:object_r:cupsd_rw_etc_t,s0)
-/etc/cups/lpoptions.* 	--	gen_context(system_u:object_r:cupsd_rw_etc_t,s0)
-/etc/cups/ppd(/.*)?		gen_context(system_u:object_r:cupsd_rw_etc_t,s0)
+/etc/cups(/.*)?	gen_context(system_u:object_r:cupsd_etc_t,s0)
+/etc/cups/classes\.conf.*	--	gen_context(system_u:object_r:cupsd_rw_etc_t,s0)
+/etc/cups/cupsd\.conf.*	--	gen_context(system_u:object_r:cupsd_rw_etc_t,s0)
+/etc/cups/lpoptions.*	--	gen_context(system_u:object_r:cupsd_rw_etc_t,s0)
+/etc/cups/ppd(/.*)?	gen_context(system_u:object_r:cupsd_rw_etc_t,s0)
 /etc/cups/ppds\.dat	--	gen_context(system_u:object_r:cupsd_rw_etc_t,s0)
-/etc/cups/printers\.conf.* --	gen_context(system_u:object_r:cupsd_rw_etc_t,s0)
-/etc/cups/subscriptions.* --	gen_context(system_u:object_r:cupsd_rw_etc_t,s0)
-/etc/cups/certs		-d	gen_context(system_u:object_r:cupsd_rw_etc_t,s0)
+/etc/cups/printers\.conf.*	--	gen_context(system_u:object_r:cupsd_rw_etc_t,s0)
+/etc/cups/subscriptions.*	--	gen_context(system_u:object_r:cupsd_rw_etc_t,s0)
+/etc/cups/certs	-d	gen_context(system_u:object_r:cupsd_rw_etc_t,s0)
 /etc/cups/certs/.*	--	gen_context(system_u:object_r:cupsd_rw_etc_t,s0)
 /etc/rc\.d/init\.d/cups	--	gen_context(system_u:object_r:cupsd_initrc_exec_t,s0)
 
 /etc/cups/interfaces(/.*)?	gen_context(system_u:object_r:cupsd_interface_t,s0)
 
-/etc/hp(/.*)?			gen_context(system_u:object_r:hplip_etc_t,s0)
+/etc/hp(/.*)?	gen_context(system_u:object_r:hplip_etc_t,s0)
+
+/etc/printcap.*	--	gen_context(system_u:object_r:cupsd_rw_etc_t,s0)
+
+/lib/udev/udev-configure-printer	--	gen_context(system_u:object_r:cupsd_config_exec_t,s0)
+/usr/lib/udev/udev-configure-printer	--	gen_context(system_u:object_r:cupsd_config_exec_t,s0)
 
-/etc/printcap.* 	--	gen_context(system_u:object_r:cupsd_rw_etc_t,s0)
+/opt/brother/Printers(.*/)?inf(/.*)?	gen_context(system_u:object_r:cupsd_rw_etc_t,s0)
+/opt/gutenprint/ppds(/.*)?	gen_context(system_u:object_r:cupsd_rw_etc_t,s0)
 
-/lib/udev/udev-configure-printer -- gen_context(system_u:object_r:cupsd_config_exec_t,s0)
+/usr/bin/cups-config-daemon	--	gen_context(system_u:object_r:cupsd_config_exec_t,s0)
+/usr/bin/hpijs	--	gen_context(system_u:object_r:hplip_exec_t,s0)
 
-/opt/gutenprint/ppds(/.*)? 	gen_context(system_u:object_r:cupsd_rw_etc_t,s0)
+/usr/Brother/fax/.*\.log.*	gen_context(system_u:object_r:cupsd_log_t,s0)
+/usr/Brother/(.*/)?inf(/.*)?	gen_context(system_u:object_r:cupsd_rw_etc_t,s0)
+/usr/Printer/(.*/)?inf(/.*)?	gen_context(system_u:object_r:cupsd_rw_etc_t,s0)
 
-/usr/bin/cups-config-daemon --	gen_context(system_u:object_r:cupsd_config_exec_t,s0)
-/usr/bin/hpijs		--	gen_context(system_u:object_r:hplip_exec_t,s0)
+/usr/lib/cups/daemon/cups-lpd	--	gen_context(system_u:object_r:cupsd_lpd_exec_t,s0)
+/usr/lib/cups/backend/cups-pdf	--	gen_context(system_u:object_r:cups_pdf_exec_t,s0)
+/usr/lib/cups/backend/hp.*	--	gen_context(system_u:object_r:hplip_exec_t,s0)
 
-/usr/lib/cups/daemon/cups-lpd -- gen_context(system_u:object_r:cupsd_lpd_exec_t,s0)
-/usr/lib/cups/backend/cups-pdf -- gen_context(system_u:object_r:cups_pdf_exec_t,s0)
-/usr/lib/cups/backend/hp.* --	gen_context(system_u:object_r:hplip_exec_t,s0)
+/usr/libexec/cups-pk-helper-mechanism	--	gen_context(system_u:object_r:cupsd_config_exec_t,s0)
+/usr/libexec/hal_lpadmin	--	gen_context(system_u:object_r:cupsd_config_exec_t,s0)
 
-/usr/libexec/cups-pk-helper-mechanism -- gen_context(system_u:object_r:cupsd_config_exec_t,s0)
-/usr/libexec/hal_lpadmin --	gen_context(system_u:object_r:cupsd_config_exec_t,s0)
+/usr/local/linuxprinter/ppd(/.*)?	gen_context(system_u:object_r:cupsd_rw_etc_t,s0)
 
 /usr/sbin/hp-[^/]+	--	gen_context(system_u:object_r:hplip_exec_t,s0)
-/usr/sbin/cupsd		--	gen_context(system_u:object_r:cupsd_exec_t,s0)
-/usr/sbin/hal_lpadmin --	gen_context(system_u:object_r:cupsd_config_exec_t,s0)
-/usr/sbin/hpiod		--	gen_context(system_u:object_r:hplip_exec_t,s0)
-/usr/sbin/printconf-backend --	gen_context(system_u:object_r:cupsd_config_exec_t,s0)
+/usr/sbin/cupsd	--	gen_context(system_u:object_r:cupsd_exec_t,s0)
+/usr/sbin/hal_lpadmin	--	gen_context(system_u:object_r:cupsd_config_exec_t,s0)
+/usr/sbin/hpiod	--	gen_context(system_u:object_r:hplip_exec_t,s0)
+/usr/sbin/printconf-backend	--	gen_context(system_u:object_r:cupsd_config_exec_t,s0)
 /usr/sbin/ptal-printd	--	gen_context(system_u:object_r:ptal_exec_t,s0)
 /usr/sbin/ptal-mlcd	--	gen_context(system_u:object_r:ptal_exec_t,s0)
 /usr/sbin/ptal-photod	--	gen_context(system_u:object_r:ptal_exec_t,s0)
 
-/usr/share/cups(/.*)?		gen_context(system_u:object_r:cupsd_etc_t,s0)
-/usr/share/foomatic/db/oldprinterids --	gen_context(system_u:object_r:cupsd_rw_etc_t,s0)
-/usr/share/hplip/.*\.py --	gen_context(system_u:object_r:hplip_exec_t,s0)
-
-/var/cache/alchemist/printconf.* gen_context(system_u:object_r:cupsd_rw_etc_t,s0)
-/var/cache/foomatic(/.*)? 	gen_context(system_u:object_r:cupsd_rw_etc_t,s0)
-/var/cache/cups(/.*)? 		gen_context(system_u:object_r:cupsd_rw_etc_t,mls_systemhigh)
+/usr/share/cups(/.*)?	gen_context(system_u:object_r:cupsd_etc_t,s0)
+/usr/share/foomatic/db/oldprinterids	--	gen_context(system_u:object_r:cupsd_rw_etc_t,s0)
+/usr/share/hplip/.*\.py	--	gen_context(system_u:object_r:hplip_exec_t,s0)
+
+/var/cache/alchemist/printconf.*	gen_context(system_u:object_r:cupsd_rw_etc_t,s0)
+/var/cache/foomatic(/.*)?	gen_context(system_u:object_r:cupsd_rw_etc_t,s0)
+/var/cache/cups(/.*)?	gen_context(system_u:object_r:cupsd_rw_etc_t,mls_systemhigh)
 
 /var/lib/cups/certs	-d	gen_context(system_u:object_r:cupsd_rw_etc_t,s0)
 /var/lib/cups/certs/.*	--	gen_context(system_u:object_r:cupsd_rw_etc_t,s0)
 
-/var/lib/hp(/.*)?		gen_context(system_u:object_r:hplip_var_lib_t,s0)
+/var/lib/hp(/.*)?	gen_context(system_u:object_r:hplip_var_lib_t,s0)
 
-/var/log/cups(/.*)?		gen_context(system_u:object_r:cupsd_log_t,s0)
-/var/log/turboprint.*		gen_context(system_u:object_r:cupsd_log_t,s0)
+/var/log/cups(/.*)?	gen_context(system_u:object_r:cupsd_log_t,s0)
+/var/log/turboprint.*	gen_context(system_u:object_r:cupsd_log_t,s0)
 
-/var/ccpd(/.*)?			gen_context(system_u:object_r:cupsd_var_run_t,s0)
-/var/ekpd(/.*)?			gen_context(system_u:object_r:cupsd_var_run_t,s0)
-/var/run/cups(/.*)?		gen_context(system_u:object_r:cupsd_var_run_t,s0)
+/var/ccpd(/.*)?	gen_context(system_u:object_r:cupsd_var_run_t,s0)
+/var/ekpd(/.*)?	gen_context(system_u:object_r:cupsd_var_run_t,s0)
+/var/run/cups(/.*)?	gen_context(system_u:object_r:cupsd_var_run_t,s0)
 /var/run/hp.*\.pid	--	gen_context(system_u:object_r:hplip_var_run_t,s0)
 /var/run/hp.*\.port	--	gen_context(system_u:object_r:hplip_var_run_t,s0)
 /var/run/ptal-printd(/.*)?	gen_context(system_u:object_r:ptal_var_run_t,s0)
 /var/run/ptal-mlcd(/.*)?	gen_context(system_u:object_r:ptal_var_run_t,s0)
-/var/run/udev-configure-printer(/.*)? 	gen_context(system_u:object_r:cupsd_config_var_run_t,s0)
-/var/turboprint(/.*)?		gen_context(system_u:object_r:cupsd_var_run_t,s0)
+/var/run/udev-configure-printer(/.*)?	gen_context(system_u:object_r:cupsd_config_var_run_t,s0)
+/var/turboprint(/.*)?	gen_context(system_u:object_r:cupsd_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/cups.if refpolicy/policy/modules/contrib/cups.if
--- refpolicy/policy/modules/contrib/cups.if	2012-05-04 15:16:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/cups.if	2012-09-27 20:03:30.745126498 +0200
@@ -1,12 +1,18 @@
-## <summary>Common UNIX printing system</summary>
+## <summary>Common UNIX printing system.</summary>
 
 ########################################
 ## <summary>
-##	Setup cups to transtion to the cups backend domain
+##	Create a domain which can be
+##	started by cupsd.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
-##	Domain allowed access.
+##	Domain allowed to transition.
+##	</summary>
+## </param>
+## <param name="entry_point">
+##	<summary>
+##	Type of the program to be used as an entry point to this domain.
 ##	</summary>
 ## </param>
 #
@@ -42,12 +48,14 @@
 		type cupsd_t, cupsd_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, cupsd_exec_t, cupsd_t)
 ')
 
 ########################################
 ## <summary>
-##	Connect to cupsd over an unix domain stream socket.
+##	Connect to cupsd over an unix
+##	domain stream socket.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -120,7 +128,8 @@
 
 ########################################
 ## <summary>
-##	Execute cups_config in the cups_config domain.
+##	Execute cups_config in the
+##	cups config domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -133,6 +142,7 @@
 		type cupsd_config_t, cupsd_config_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, cupsd_config_exec_t, cupsd_config_t)
 ')
 
@@ -193,8 +203,7 @@
 	')
 
 	files_search_etc($1)
-	read_files_pattern($1, cupsd_etc_t, cupsd_etc_t)
-	read_files_pattern($1, cupsd_etc_t, cupsd_rw_etc_t)
+	read_files_pattern($1, cupsd_etc_t, { cupsd_etc_t cupsd_rw_etc_t })
 ')
 
 ########################################
@@ -277,7 +286,8 @@
 
 ########################################
 ## <summary>
-##	Connect to ptal over an unix domain stream socket.
+##	Connect to ptal over an unix
+##	domain stream socket.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -296,8 +306,8 @@
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate 
-##	an cups environment
+##	All of the rules required to
+##	administrate an cups environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -306,7 +316,7 @@
 ## </param>
 ## <param name="role">
 ##	<summary>
-##	The role to be allowed to manage the cups domain.
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <rolecap/>
@@ -316,43 +326,35 @@
 		type cupsd_t, cupsd_tmp_t, cupsd_lpd_tmp_t;
 		type cupsd_etc_t, cupsd_log_t, cupsd_spool_t;
 		type cupsd_config_var_run_t, cupsd_lpd_var_run_t;
-		type cupsd_var_run_t, ptal_etc_t;
-		type ptal_var_run_t, hplip_var_run_t;
-		type cupsd_initrc_exec_t;
+		type cupsd_var_run_t, ptal_etc_t, cupsd_rw_etc_t;
+		type ptal_var_run_t, hplip_var_run_t, cupsd_initrc_exec_t;
+		type cupsd_config_t, cupsd_lpd_t, cups_pdf_t;
+		type hplip_t, ptal_t;
 	')
 
-	allow $1 cupsd_t:process { ptrace signal_perms };
-	ps_process_pattern($1, cupsd_t)
+	allow $1 { cupsd_t cupsd_config_t cupsd_lpd_t }:process { ptrace signal_perms };
+	allow $1 { cups_pdf_t hplip_t ptal_t }:process { ptrace signal_perms };
+	ps_process_pattern($1, { cupsd_t cupsd_config_t cupsd_lpd_t })
+	ps_process_pattern($1, { cups_pdf_t hplip_t ptal_t })
 
 	init_labeled_script_domtrans($1, cupsd_initrc_exec_t)
 	domain_system_change_exemption($1)
 	role_transition $2 cupsd_initrc_exec_t system_r;
 	allow $2 system_r;
 
-	admin_pattern($1, cupsd_etc_t)
 	files_list_etc($1)
+	admin_pattern($1, { cupsd_etc_t cupsd_rw_etc_t ptal_etc_t })
 
-	admin_pattern($1, cupsd_config_var_run_t)
-
-	admin_pattern($1, cupsd_log_t)
 	logging_list_logs($1)
+	admin_pattern($1, cupsd_log_t)
 
-	admin_pattern($1, cupsd_lpd_tmp_t)
-
-	admin_pattern($1, cupsd_lpd_var_run_t)
-
-	admin_pattern($1, cupsd_spool_t)
 	files_list_spool($1)
+	admin_pattern($1, cupsd_spool_t)
 
-	admin_pattern($1, cupsd_tmp_t)
 	files_list_tmp($1)
+	admin_pattern($1, { cupsd_tmp_t  cupsd_lpd_tmp_t })
 
-	admin_pattern($1, cupsd_var_run_t)
 	files_list_pids($1)
-
-	admin_pattern($1, hplip_var_run_t)
-
-	admin_pattern($1, ptal_etc_t)
-
-	admin_pattern($1, ptal_var_run_t)
+	admin_pattern($1, { cupsd_config_var_run_t cupsd_var_run_t hplip_var_run_t })
+	admin_pattern($1, { ptal_var_run_t cupsd_lpd_var_run_t })
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/cups.te refpolicy/policy/modules/contrib/cups.te
--- refpolicy/policy/modules/contrib/cups.te	2012-07-25 20:33:04.000000000 +0200
+++ refpolicy/policy/modules/contrib/cups.te	2012-10-30 19:31:33.176399443 +0100
@@ -1,4 +1,4 @@
-policy_module(cups, 1.15.0)
+policy_module(cups, 1.15.5)
 
 ########################################
 #
@@ -15,6 +15,7 @@
 type cupsd_t;
 type cupsd_exec_t;
 init_daemon_domain(cupsd_t, cupsd_exec_t)
+mls_trusted_object(cupsd_t)
 
 type cupsd_etc_t;
 files_config_file(cupsd_etc_t)
@@ -63,7 +64,6 @@
 type hplip_t;
 type hplip_exec_t;
 init_daemon_domain(hplip_t, hplip_exec_t)
-# For CUPS to run as a backend
 cups_backend(hplip_t, hplip_exec_t)
 
 type hplip_etc_t;
@@ -101,26 +101,22 @@
 # Cups local policy
 #
 
-# /usr/lib/cups/backend/serial needs sys_admin(?!)
 allow cupsd_t self:capability { ipc_lock sys_admin dac_override dac_read_search kill setgid setuid fsetid net_bind_service fowner chown dac_override sys_rawio sys_resource sys_tty_config };
 dontaudit cupsd_t self:capability { sys_tty_config net_admin };
+allow cupsd_t self:capability2 block_suspend;
 allow cupsd_t self:process { getpgid setpgid setsched signal_perms };
 allow cupsd_t self:fifo_file rw_fifo_file_perms;
-allow cupsd_t self:unix_stream_socket { create_stream_socket_perms connectto };
-allow cupsd_t self:unix_dgram_socket create_socket_perms;
+allow cupsd_t self:unix_stream_socket { accept connectto listen };
 allow cupsd_t self:netlink_selinux_socket create_socket_perms;
 allow cupsd_t self:shm create_shm_perms;
 allow cupsd_t self:sem create_sem_perms;
-allow cupsd_t self:tcp_socket create_stream_socket_perms;
-allow cupsd_t self:udp_socket create_socket_perms;
+allow cupsd_t self:tcp_socket { accept listen };
 allow cupsd_t self:appletalk_socket create_socket_perms;
-# generic socket here until appletalk socket is available in kernels
-allow cupsd_t self:socket create_socket_perms;
 
-allow cupsd_t cupsd_etc_t:{ dir file } setattr;
+allow cupsd_t cupsd_etc_t:dir setattr_dir_perms;
+allow cupsd_t cupsd_etc_t:file setattr_file_perms;
 read_files_pattern(cupsd_t, cupsd_etc_t, cupsd_etc_t)
 read_lnk_files_pattern(cupsd_t, cupsd_etc_t, cupsd_etc_t)
-files_search_etc(cupsd_t)
 
 manage_files_pattern(cupsd_t, cupsd_interface_t, cupsd_interface_t)
 
@@ -129,28 +125,28 @@
 filetrans_pattern(cupsd_t, cupsd_etc_t, cupsd_rw_etc_t, file)
 files_var_filetrans(cupsd_t, cupsd_rw_etc_t, { dir file })
 
-# allow cups to execute its backend scripts
-can_exec(cupsd_t, cupsd_exec_t)
 allow cupsd_t cupsd_exec_t:dir search_dir_perms;
 allow cupsd_t cupsd_exec_t:lnk_file read_lnk_file_perms;
 
 allow cupsd_t cupsd_lock_t:file manage_file_perms;
 files_lock_filetrans(cupsd_t, cupsd_lock_t, file)
 
-manage_files_pattern(cupsd_t, cupsd_log_t, cupsd_log_t)
-allow cupsd_t cupsd_log_t:dir setattr;
+manage_dirs_pattern(cupsd_t, cupsd_log_t, cupsd_log_t)
+append_files_pattern(cupsd_t, cupsd_log_t, cupsd_log_t)
+create_files_pattern(cupsd_t, cupsd_log_t, cupsd_log_t)
+setattr_files_pattern(cupsd_t, cupsd_log_t, cupsd_log_t)
 logging_log_filetrans(cupsd_t, cupsd_log_t, { file dir })
 
 manage_dirs_pattern(cupsd_t, cupsd_tmp_t, cupsd_tmp_t)
 manage_files_pattern(cupsd_t, cupsd_tmp_t, cupsd_tmp_t)
 manage_fifo_files_pattern(cupsd_t, cupsd_tmp_t, cupsd_tmp_t)
-files_tmp_filetrans(cupsd_t, cupsd_tmp_t, { file dir fifo_file })
+files_tmp_filetrans(cupsd_t, cupsd_tmp_t, { dir fifo_file file })
 
-allow cupsd_t cupsd_var_run_t:dir setattr;
+manage_dirs_pattern(cupsd_t, cupsd_var_run_t, cupsd_var_run_t)
 manage_files_pattern(cupsd_t, cupsd_var_run_t, cupsd_var_run_t)
 manage_sock_files_pattern(cupsd_t, cupsd_var_run_t, cupsd_var_run_t)
 manage_fifo_files_pattern(cupsd_t, cupsd_var_run_t, cupsd_var_run_t)
-files_pid_filetrans(cupsd_t, cupsd_var_run_t, { file fifo_file })
+files_pid_filetrans(cupsd_t, cupsd_var_run_t, { dir fifo_file file })
 
 allow cupsd_t hplip_t:process { signal sigkill };
 
@@ -159,7 +155,9 @@
 allow cupsd_t hplip_var_run_t:file read_file_perms;
 
 stream_connect_pattern(cupsd_t, ptal_var_run_t, ptal_var_run_t, ptal_t)
-allow cupsd_t ptal_var_run_t : sock_file setattr;
+allow cupsd_t ptal_var_run_t:sock_file setattr_sock_file_perms;
+
+can_exec(cupsd_t, { cupsd_exec_t cupsd_interface_t })
 
 kernel_read_system_state(cupsd_t)
 kernel_read_network_state(cupsd_t)
@@ -178,6 +176,9 @@
 corenet_udp_sendrecv_all_ports(cupsd_t)
 corenet_tcp_bind_generic_node(cupsd_t)
 corenet_udp_bind_generic_node(cupsd_t)
+
+corenet_sendrecv_all_server_packets(cupsd_t)
+corenet_sendrecv_all_client_packets(cupsd_t)
 corenet_tcp_bind_ipp_port(cupsd_t)
 corenet_udp_bind_ipp_port(cupsd_t)
 corenet_udp_bind_howl_port(cupsd_t)
@@ -185,60 +186,53 @@
 corenet_dontaudit_tcp_bind_all_reserved_ports(cupsd_t)
 corenet_tcp_bind_all_rpc_ports(cupsd_t)
 corenet_tcp_connect_all_ports(cupsd_t)
-corenet_sendrecv_hplip_client_packets(cupsd_t)
-corenet_sendrecv_ipp_client_packets(cupsd_t)
-corenet_sendrecv_ipp_server_packets(cupsd_t)
+
+corecmd_exec_bin(cupsd_t)
+corecmd_exec_shell(cupsd_t)
 
 dev_rw_printer(cupsd_t)
 dev_read_urand(cupsd_t)
 dev_read_sysfs(cupsd_t)
-dev_rw_input_dev(cupsd_t)	#447878
+dev_rw_input_dev(cupsd_t)
 dev_rw_generic_usb_dev(cupsd_t)
 dev_rw_usbfs(cupsd_t)
 dev_getattr_printer_dev(cupsd_t)
 
 domain_read_all_domains_state(cupsd_t)
-
-fs_getattr_all_fs(cupsd_t)
-fs_search_auto_mountpoints(cupsd_t)
-fs_search_fusefs(cupsd_t)
-fs_read_anon_inodefs_files(cupsd_t)
-
-mls_file_downgrade(cupsd_t)
-mls_file_write_all_levels(cupsd_t)
-mls_file_read_all_levels(cupsd_t)
-mls_rangetrans_target(cupsd_t)
-mls_socket_write_all_levels(cupsd_t)
-mls_fd_use_all_levels(cupsd_t)
-
-term_use_unallocated_ttys(cupsd_t)
-term_search_ptys(cupsd_t)
-
-# Filter scripts may be shell scripts, and may invoke progs like /bin/mktemp
-corecmd_exec_shell(cupsd_t)
-corecmd_exec_bin(cupsd_t)
-
 domain_use_interactive_fds(cupsd_t)
 
+files_getattr_boot_dirs(cupsd_t)
 files_list_spool(cupsd_t)
-files_read_etc_files(cupsd_t)
 files_read_etc_runtime_files(cupsd_t)
-# read python modules
 files_read_usr_files(cupsd_t)
+files_exec_usr_files(cupsd_t)
 # for /var/lib/defoma
 files_read_var_lib_files(cupsd_t)
 files_list_world_readable(cupsd_t)
 files_read_world_readable_files(cupsd_t)
 files_read_world_readable_symlinks(cupsd_t)
-# Satisfy readahead
 files_read_var_files(cupsd_t)
 files_read_var_symlinks(cupsd_t)
+files_write_generic_pid_pipes(cupsd_t)
+files_dontaudit_getattr_all_tmp_files(cupsd_t)
+files_dontaudit_list_home(cupsd_t)
 # for /etc/printcap
 files_dontaudit_write_etc_files(cupsd_t)
-# smbspool seems to be iterating through all existing tmp files.
-# redhat bug #214953
-# cjp: this might be a broken behavior
-files_dontaudit_getattr_all_tmp_files(cupsd_t)
+
+fs_getattr_all_fs(cupsd_t)
+fs_search_auto_mountpoints(cupsd_t)
+fs_search_fusefs(cupsd_t)
+fs_read_anon_inodefs_files(cupsd_t)
+
+mls_fd_use_all_levels(cupsd_t)
+mls_file_downgrade(cupsd_t)
+mls_file_write_all_levels(cupsd_t)
+mls_file_read_all_levels(cupsd_t)
+mls_rangetrans_target(cupsd_t)
+mls_socket_write_all_levels(cupsd_t)
+
+term_search_ptys(cupsd_t)
+term_use_unallocated_ttys(cupsd_t)
 
 selinux_compute_access_vector(cupsd_t)
 selinux_validate_context(cupsd_t)
@@ -251,7 +245,6 @@
 auth_rw_faillog(cupsd_t)
 auth_use_nsswitch(cupsd_t)
 
-# Read /usr/lib/gconv/gconv-modules.* and /usr/lib/python2.2/.*
 libs_read_lib_files(cupsd_t)
 libs_exec_lib_files(cupsd_t)
 
@@ -259,23 +252,16 @@
 logging_send_syslog_msg(cupsd_t)
 
 miscfiles_read_localization(cupsd_t)
-# invoking ghostscript needs to read fonts
 miscfiles_read_fonts(cupsd_t)
 miscfiles_setattr_fonts_cache_dirs(cupsd_t)
 
 seutil_read_config(cupsd_t)
+
 sysnet_exec_ifconfig(cupsd_t)
 
-files_dontaudit_list_home(cupsd_t)
 userdom_dontaudit_use_unpriv_user_fds(cupsd_t)
 userdom_dontaudit_search_user_home_content(cupsd_t)
 
-# Write to /var/spool/cups.
-lpd_manage_spool(cupsd_t)
-lpd_read_config(cupsd_t)
-lpd_exec_lpr(cupsd_t)
-lpd_relabel_spool(cupsd_t)
-
 optional_policy(`
 	apm_domtrans_client(cupsd_t)
 ')
@@ -311,17 +297,29 @@
 ')
 
 optional_policy(`
+	kerberos_manage_host_rcache(cupsd_t)
+	kerberos_tmp_filetrans_host_rcache(cupsd_t, file, "host_0")
+')
+
+optional_policy(`
 	logrotate_domtrans(cupsd_t)
 ')
 
 optional_policy(`
+	lpd_exec_lpr(cupsd_t)
+	lpd_manage_spool(cupsd_t)
+	lpd_read_config(cupsd_t)
+	lpd_relabel_spool(cupsd_t)
+')
+
+optional_policy(`
 	mta_send_mail(cupsd_t)
 ')
 
 optional_policy(`
-	# cups execs smbtool which reads samba_etc_t files
 	samba_read_config(cupsd_t)
 	samba_rw_var_files(cupsd_t)
+	samba_stream_connect_nmbd(cupsd_t)
 ')
 
 optional_policy(`
@@ -338,16 +336,14 @@
 
 ########################################
 #
-# Cups configuration daemon local policy
+# Configuration daemon local policy
 #
 
-allow cupsd_config_t self:capability { chown dac_override sys_tty_config };
+allow cupsd_config_t self:capability { chown dac_override sys_tty_config setuid setgid sys_nice };
 dontaudit cupsd_config_t self:capability sys_tty_config;
-allow cupsd_config_t self:process { getsched signal_perms };
+allow cupsd_config_t self:process { getsched setsched signal_perms };
 allow cupsd_config_t self:fifo_file rw_fifo_file_perms;
-allow cupsd_config_t self:unix_stream_socket create_socket_perms;
-allow cupsd_config_t self:unix_dgram_socket create_socket_perms;
-allow cupsd_config_t self:tcp_socket create_stream_socket_perms;
+allow cupsd_config_t self:tcp_socket { accept listen };
 
 allow cupsd_config_t cupsd_t:process signal;
 ps_process_pattern(cupsd_config_t, cupsd_t)
@@ -360,9 +356,7 @@
 manage_lnk_files_pattern(cupsd_config_t, cupsd_rw_etc_t, cupsd_rw_etc_t)
 files_var_filetrans(cupsd_config_t, cupsd_rw_etc_t, file)
 
-can_exec(cupsd_config_t, cupsd_config_exec_t)
-
-allow cupsd_config_t cupsd_log_t:file rw_file_perms;
+allow cupsd_config_t cupsd_log_t:file { append_file_perms read_file_perms };
 
 manage_lnk_files_pattern(cupsd_config_t, cupsd_tmp_t, cupsd_tmp_t)
 manage_files_pattern(cupsd_config_t, cupsd_tmp_t, cupsd_tmp_t)
@@ -371,13 +365,18 @@
 
 allow cupsd_config_t cupsd_var_run_t:file read_file_perms;
 
+manage_dirs_pattern(cupsd_config_t, cupsd_config_var_run_t, cupsd_config_var_run_t)
 manage_files_pattern(cupsd_config_t, cupsd_config_var_run_t, cupsd_config_var_run_t)
-files_pid_filetrans(cupsd_config_t, cupsd_config_var_run_t, file)
-
-domtrans_pattern(cupsd_config_t, hplip_exec_t, hplip_t)
+files_pid_filetrans(cupsd_config_t, cupsd_config_var_run_t, { dir file })
 
 read_files_pattern(cupsd_config_t, hplip_etc_t, hplip_etc_t)
 
+stream_connect_pattern(cupsd_config_t, cupsd_var_run_t, cupsd_var_run_t, cupsd_t)
+
+can_exec(cupsd_config_t, cupsd_config_exec_t)
+
+domtrans_pattern(cupsd_config_t, hplip_exec_t, hplip_t)
+
 kernel_read_system_state(cupsd_config_t)
 kernel_read_all_sysctls(cupsd_config_t)
 
@@ -386,32 +385,30 @@
 corenet_tcp_sendrecv_generic_if(cupsd_config_t)
 corenet_tcp_sendrecv_generic_node(cupsd_config_t)
 corenet_tcp_sendrecv_all_ports(cupsd_config_t)
-corenet_tcp_connect_all_ports(cupsd_config_t)
+
 corenet_sendrecv_all_client_packets(cupsd_config_t)
+corenet_tcp_connect_all_ports(cupsd_config_t)
+
+corecmd_exec_bin(cupsd_config_t)
+corecmd_exec_shell(cupsd_config_t)
 
 dev_read_sysfs(cupsd_config_t)
 dev_read_urand(cupsd_config_t)
 dev_read_rand(cupsd_config_t)
 dev_rw_generic_usb_dev(cupsd_config_t)
 
+files_read_etc_runtime_files(cupsd_config_t)
+files_read_usr_files(cupsd_config_t)
+files_read_var_symlinks(cupsd_config_t)
 files_search_all_mountpoints(cupsd_config_t)
+files_dontaudit_list_tmp(cupsd_config_t)
 
 fs_getattr_all_fs(cupsd_config_t)
 fs_search_auto_mountpoints(cupsd_config_t)
 
-corecmd_exec_bin(cupsd_config_t)
-corecmd_exec_shell(cupsd_config_t)
-
 domain_use_interactive_fds(cupsd_config_t)
-# killall causes the following
 domain_dontaudit_search_all_domains_state(cupsd_config_t)
 
-files_read_usr_files(cupsd_config_t)
-files_read_etc_files(cupsd_config_t)
-files_read_etc_runtime_files(cupsd_config_t)
-files_read_var_symlinks(cupsd_config_t)
-
-# Alternatives asks for this
 init_getattr_all_script_files(cupsd_config_t)
 
 auth_use_nsswitch(cupsd_config_t)
@@ -425,16 +422,9 @@
 
 userdom_dontaudit_use_unpriv_user_fds(cupsd_config_t)
 userdom_dontaudit_search_user_home_dirs(cupsd_config_t)
-
-cups_stream_connect(cupsd_config_t)
-
-lpd_read_config(cupsd_config_t)
-
-ifdef(`distro_redhat',`
-	optional_policy(`
-		rpm_read_db(cupsd_config_t)
-	')
-')
+userdom_read_all_users_state(cupsd_config_t)
+userdom_read_user_tmp_symlinks(cupsd_config_t)
+userdom_rw_user_tmp_files(cupsd_config_t)
 
 optional_policy(`
 	term_use_generic_ptys(cupsd_config_t)
@@ -450,6 +440,10 @@
 	optional_policy(`
 		hal_dbus_chat(cupsd_config_t)
 	')
+
+	optional_policy(`
+		policykit_dbus_chat(cupsd_config_t)
+	')
 ')
 
 optional_policy(`
@@ -467,8 +461,7 @@
 ')
 
 optional_policy(`
-	policykit_dbus_chat(cupsd_config_t)
-	userdom_read_all_users_state(cupsd_config_t)
+	lpd_read_config(cupsd_config_t)
 ')
 
 optional_policy(`
@@ -489,39 +482,28 @@
 
 ########################################
 #
-# Cups lpd support
+# Lpd local policy
 #
 
+allow cupsd_lpd_t self:capability { setuid setgid };
 allow cupsd_lpd_t self:process signal_perms;
 allow cupsd_lpd_t self:fifo_file rw_fifo_file_perms;
-allow cupsd_lpd_t self:tcp_socket connected_stream_socket_perms;
-allow cupsd_lpd_t self:udp_socket create_socket_perms;
-
-# for identd
-# cjp: this should probably only be inetd_child rules?
+allow cupsd_lpd_t self:tcp_socket { accept listen };
 allow cupsd_lpd_t self:netlink_tcpdiag_socket r_netlink_socket_perms;
-allow cupsd_lpd_t self:capability { setuid setgid };
-files_search_home(cupsd_lpd_t)
-optional_policy(`
-	kerberos_use(cupsd_lpd_t)
-')
-#end for identd
-
-allow cupsd_lpd_t cupsd_etc_t:dir list_dir_perms;
-read_files_pattern(cupsd_lpd_t, cupsd_etc_t, cupsd_etc_t)
-read_lnk_files_pattern(cupsd_lpd_t, cupsd_etc_t, cupsd_etc_t)
 
-allow cupsd_lpd_t cupsd_rw_etc_t:dir list_dir_perms;
-read_files_pattern(cupsd_lpd_t, cupsd_rw_etc_t, cupsd_rw_etc_t)
-read_lnk_files_pattern(cupsd_lpd_t, cupsd_rw_etc_t, cupsd_rw_etc_t)
+allow cupsd_lpd_t { cupsd_etc_t cupsd_rw_etc_t }:dir list_dir_perms;
+allow cupsd_lpd_t { cupsd_etc_t cupsd_rw_etc_t }:file read_file_perms;
+allow cupsd_lpd_t { cupsd_etc_t cupsd_rw_etc_t }:lnk_file read_lnk_file_perms;
 
 manage_dirs_pattern(cupsd_lpd_t, cupsd_lpd_tmp_t, cupsd_lpd_tmp_t)
 manage_files_pattern(cupsd_lpd_t, cupsd_lpd_tmp_t, cupsd_lpd_tmp_t)
-files_tmp_filetrans(cupsd_lpd_t, cupsd_lpd_tmp_t, { file dir })
+files_tmp_filetrans(cupsd_lpd_t, cupsd_lpd_tmp_t, { dir file })
 
 manage_files_pattern(cupsd_lpd_t, cupsd_lpd_var_run_t, cupsd_lpd_var_run_t)
 files_pid_filetrans(cupsd_lpd_t, cupsd_lpd_var_run_t, file)
 
+stream_connect_pattern(cupsd_lpd_t, cupsd_var_run_t, cupsd_var_run_t, cupsd_t)
+
 kernel_read_kernel_sysctls(cupsd_lpd_t)
 kernel_read_system_state(cupsd_lpd_t)
 kernel_read_network_state(cupsd_lpd_t)
@@ -529,21 +511,18 @@
 corenet_all_recvfrom_unlabeled(cupsd_lpd_t)
 corenet_all_recvfrom_netlabel(cupsd_lpd_t)
 corenet_tcp_sendrecv_generic_if(cupsd_lpd_t)
-corenet_udp_sendrecv_generic_if(cupsd_lpd_t)
 corenet_tcp_sendrecv_generic_node(cupsd_lpd_t)
-corenet_udp_sendrecv_generic_node(cupsd_lpd_t)
-corenet_tcp_sendrecv_all_ports(cupsd_lpd_t)
-corenet_udp_sendrecv_all_ports(cupsd_lpd_t)
-corenet_tcp_bind_generic_node(cupsd_lpd_t)
-corenet_udp_bind_generic_node(cupsd_lpd_t)
+
+corenet_sendrecv_ipp_client_packets(cupsd_lpd_t)
 corenet_tcp_connect_ipp_port(cupsd_lpd_t)
+corenet_tcp_sendrecv_ipp_port(cupsd_lpd_t)
 
 dev_read_urand(cupsd_lpd_t)
 dev_read_rand(cupsd_lpd_t)
 
 fs_getattr_xattr_fs(cupsd_lpd_t)
 
-files_read_etc_files(cupsd_lpd_t)
+files_search_home(cupsd_lpd_t)
 
 auth_use_nsswitch(cupsd_lpd_t)
 
@@ -552,51 +531,48 @@
 miscfiles_read_localization(cupsd_lpd_t)
 miscfiles_setattr_fonts_cache_dirs(cupsd_lpd_t)
 
-cups_stream_connect(cupsd_lpd_t)
-
 optional_policy(`
 	inetd_service_domain(cupsd_lpd_t, cupsd_lpd_exec_t)
 ')
 
 ########################################
 #
-# cups_pdf local policy
+# Pdf local policy
 #
 
 allow cups_pdf_t self:capability { chown fowner fsetid setuid setgid dac_override };
-allow cups_pdf_t self:fifo_file rw_file_perms;
+allow cups_pdf_t self:fifo_file rw_fifo_file_perms;
 allow cups_pdf_t self:unix_stream_socket create_stream_socket_perms;
 
-manage_files_pattern(cups_pdf_t, cupsd_log_t, cupsd_log_t)
+append_files_pattern(cups_pdf_t, cupsd_log_t, cupsd_log_t)
+create_files_pattern(cups_pdf_t, cupsd_log_t, cupsd_log_t)
+setattr_files_pattern(cups_pdf_t, cupsd_log_t, cupsd_log_t)
 
 manage_files_pattern(cups_pdf_t, cups_pdf_tmp_t, cups_pdf_tmp_t)
 manage_dirs_pattern(cups_pdf_t, cups_pdf_tmp_t, cups_pdf_tmp_t)
-files_tmp_filetrans(cups_pdf_t, cups_pdf_tmp_t, { file dir })
+files_tmp_filetrans(cups_pdf_t, cups_pdf_tmp_t, { dir file })
 
 fs_rw_anon_inodefs_files(cups_pdf_t)
+fs_search_auto_mountpoints(cups_pdf_t)
 
 kernel_read_system_state(cups_pdf_t)
 
-files_read_etc_files(cups_pdf_t)
 files_read_usr_files(cups_pdf_t)
 
-corecmd_exec_shell(cups_pdf_t)
 corecmd_exec_bin(cups_pdf_t)
+corecmd_exec_shell(cups_pdf_t)
 
 auth_use_nsswitch(cups_pdf_t)
 
 miscfiles_read_localization(cups_pdf_t)
 miscfiles_read_fonts(cups_pdf_t)
+miscfiles_setattr_fonts_cache_dirs(cups_pdf_t)
 
-userdom_home_filetrans_user_home_dir(cups_pdf_t)
 userdom_manage_user_home_content_dirs(cups_pdf_t)
 userdom_manage_user_home_content_files(cups_pdf_t)
-
-lpd_manage_spool(cups_pdf_t)
-
+userdom_home_filetrans_user_home_dir(cups_pdf_t)
 
 tunable_policy(`use_nfs_home_dirs',`
-	fs_search_auto_mountpoints(cups_pdf_t)
 	fs_manage_nfs_dirs(cups_pdf_t)
 	fs_manage_nfs_files(cups_pdf_t)
 ')
@@ -606,44 +582,43 @@
 	fs_manage_cifs_files(cups_pdf_t)
 ')
 
+optional_policy(`
+	lpd_manage_spool(cups_pdf_t)
+')
+
 ########################################
 #
 # HPLIP local policy
 #
 
-# Needed for USB Scanneer and xsane
-allow hplip_t self:capability { dac_override dac_read_search net_raw };
+allow hplip_t self:capability { dac_override dac_read_search net_raw sys_nice };
 dontaudit hplip_t self:capability sys_tty_config;
 allow hplip_t self:fifo_file rw_fifo_file_perms;
-allow hplip_t self:process signal_perms;
-allow hplip_t self:unix_dgram_socket create_socket_perms;
-allow hplip_t self:unix_stream_socket create_socket_perms;
-allow hplip_t self:netlink_route_socket r_netlink_socket_perms;
-allow hplip_t self:tcp_socket create_stream_socket_perms;
-allow hplip_t self:udp_socket create_socket_perms;
+allow hplip_t self:process { setsched signal_perms };
+allow hplip_t self:tcp_socket { accept listen };
 allow hplip_t self:rawip_socket create_socket_perms;
 
 allow hplip_t cupsd_etc_t:dir search_dir_perms;
+
 manage_dirs_pattern(hplip_t, cupsd_tmp_t, cupsd_tmp_t)
 manage_files_pattern(hplip_t, cupsd_tmp_t, cupsd_tmp_t)
-files_tmp_filetrans(hplip_t, cupsd_tmp_t, { file dir })
-
-cups_stream_connect(hplip_t)
+files_tmp_filetrans(hplip_t, cupsd_tmp_t, { dir file })
 
 allow hplip_t hplip_etc_t:dir list_dir_perms;
-read_files_pattern(hplip_t, hplip_etc_t, hplip_etc_t)
-read_lnk_files_pattern(hplip_t, hplip_etc_t, hplip_etc_t)
-files_search_etc(hplip_t)
+allow hplip_t hplip_etc_t:file read_file_perms;
+allow hplip_t hplip_etc_t:lnk_file read_lnk_file_perms;
 
 manage_files_pattern(hplip_t, hplip_var_lib_t, hplip_var_lib_t)
 manage_lnk_files_pattern(hplip_t, hplip_var_lib_t, hplip_var_lib_t)
 
 manage_fifo_files_pattern(hplip_t, hplip_tmp_t, hplip_tmp_t)
-files_tmp_filetrans(hplip_t, hplip_tmp_t, fifo_file )
+files_tmp_filetrans(hplip_t, hplip_tmp_t, fifo_file)
 
 manage_files_pattern(hplip_t, hplip_var_run_t, hplip_var_run_t)
 files_pid_filetrans(hplip_t, hplip_var_run_t, file)
 
+stream_connect_pattern(hplip_t, cupsd_var_run_t, cupsd_var_run_t, cupsd_t)
+
 kernel_read_system_state(hplip_t)
 kernel_read_kernel_sysctls(hplip_t)
 
@@ -659,13 +634,20 @@
 corenet_udp_sendrecv_all_ports(hplip_t)
 corenet_tcp_bind_generic_node(hplip_t)
 corenet_udp_bind_generic_node(hplip_t)
+
+corenet_sendrecv_hplip_client_packets(hplip_t)
+corenet_receive_hplip_server_packets(hplip_t)
 corenet_tcp_bind_hplip_port(hplip_t)
 corenet_tcp_connect_hplip_port(hplip_t)
+
+corenet_sendrecv_ipp_client_packets(hplip_t)
 corenet_tcp_connect_ipp_port(hplip_t)
-corenet_sendrecv_hplip_client_packets(hplip_t)
-corenet_receive_hplip_server_packets(hplip_t)
+
+corenet_sendrecv_howl_server_packets(hplip_t)
 corenet_udp_bind_howl_port(hplip_t)
 
+corecmd_exec_bin(hplip_t)
+
 dev_read_sysfs(hplip_t)
 dev_rw_printer(hplip_t)
 dev_read_urand(hplip_t)
@@ -673,34 +655,37 @@
 dev_rw_generic_usb_dev(hplip_t)
 dev_rw_usbfs(hplip_t)
 
-fs_getattr_all_fs(hplip_t)
-fs_search_auto_mountpoints(hplip_t)
-fs_rw_anon_inodefs_files(hplip_t)
-
-# for python
-corecmd_exec_bin(hplip_t)
-
 domain_use_interactive_fds(hplip_t)
 
 files_read_etc_files(hplip_t)
 files_read_etc_runtime_files(hplip_t)
 files_read_usr_files(hplip_t)
 
+fs_getattr_all_fs(hplip_t)
+fs_search_auto_mountpoints(hplip_t)
+fs_rw_anon_inodefs_files(hplip_t)
+
 logging_send_syslog_msg(hplip_t)
 
 miscfiles_read_localization(hplip_t)
 
-sysnet_read_config(hplip_t)
+sysnet_dns_name_resolve(hplip_t)
 
 userdom_dontaudit_use_unpriv_user_fds(hplip_t)
 userdom_dontaudit_search_user_home_dirs(hplip_t)
 userdom_dontaudit_search_user_home_content(hplip_t)
 
-lpd_read_config(hplip_t)
-lpd_manage_spool(hplip_t)
-
 optional_policy(`
 	dbus_system_bus_client(hplip_t)
+
+	optional_policy(`
+		userdom_dbus_send_all_users(hplip_t)
+	')
+')
+
+optional_policy(`
+	lpd_read_config(hplip_t)
+	lpd_manage_spool(hplip_t)
 ')
 
 optional_policy(`
@@ -723,14 +708,12 @@
 allow ptal_t self:capability { chown sys_rawio };
 dontaudit ptal_t self:capability sys_tty_config;
 allow ptal_t self:fifo_file rw_fifo_file_perms;
-allow ptal_t self:unix_dgram_socket create_socket_perms;
-allow ptal_t self:unix_stream_socket create_stream_socket_perms;
+allow ptal_t self:unix_stream_socket { accept listen };
 allow ptal_t self:tcp_socket create_stream_socket_perms;
 
 allow ptal_t ptal_etc_t:dir list_dir_perms;
 read_files_pattern(ptal_t, ptal_etc_t, ptal_etc_t)
 read_lnk_files_pattern(ptal_t, ptal_etc_t, ptal_etc_t)
-files_search_etc(ptal_t)
 
 manage_dirs_pattern(ptal_t, ptal_var_run_t, ptal_var_run_t)
 manage_files_pattern(ptal_t, ptal_var_run_t, ptal_var_run_t)
@@ -747,22 +730,24 @@
 corenet_all_recvfrom_netlabel(ptal_t)
 corenet_tcp_sendrecv_generic_if(ptal_t)
 corenet_tcp_sendrecv_generic_node(ptal_t)
-corenet_tcp_sendrecv_all_ports(ptal_t)
 corenet_tcp_bind_generic_node(ptal_t)
+
+corenet_sendrecv_ptal_server_packets(ptal_t)
 corenet_tcp_bind_ptal_port(ptal_t)
+corenet_tcp_sendrecv_ptal_port(ptal_t)
 
 dev_read_sysfs(ptal_t)
 dev_read_usbfs(ptal_t)
 dev_rw_printer(ptal_t)
 
-fs_getattr_all_fs(ptal_t)
-fs_search_auto_mountpoints(ptal_t)
-
 domain_use_interactive_fds(ptal_t)
 
 files_read_etc_files(ptal_t)
 files_read_etc_runtime_files(ptal_t)
 
+fs_getattr_all_fs(ptal_t)
+fs_search_auto_mountpoints(ptal_t)
+
 logging_send_syslog_msg(ptal_t)
 
 miscfiles_read_localization(ptal_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/cvs.fc refpolicy/policy/modules/contrib/cvs.fc
--- refpolicy/policy/modules/contrib/cvs.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/cvs.fc	2012-09-27 20:03:30.745126498 +0200
@@ -1,10 +1,13 @@
+/etc/rc\.d/init\.d/cvs	--	gen_context(system_u:object_r:cvs_initrc_exec_t,s0)
 
-/opt/cvs(/.*)?		gen_context(system_u:object_r:cvs_data_t,s0)
+/opt/cvs(/.*)?	gen_context(system_u:object_r:cvs_data_t,s0)
 
 /usr/bin/cvs	--	gen_context(system_u:object_r:cvs_exec_t,s0)
 
-/var/cvs(/.*)?		gen_context(system_u:object_r:cvs_data_t,s0)
-
-#CVSWeb file context
 /usr/share/cvsweb/cvsweb\.cgi	--	gen_context(system_u:object_r:httpd_cvs_script_exec_t,s0)
+
+/var/cvs(/.*)?	gen_context(system_u:object_r:cvs_data_t,s0)
+
+/var/run/cvs\.pid	--	gen_context(system_u:object_r:cvs_var_run_t,s0)
+
 /var/www/cgi-bin/cvsweb\.cgi	--	gen_context(system_u:object_r:httpd_cvs_script_exec_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/cvs.if refpolicy/policy/modules/contrib/cvs.if
--- refpolicy/policy/modules/contrib/cvs.if	2012-05-04 15:16:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/cvs.if	2012-09-27 20:03:30.746126498 +0200
@@ -1,8 +1,8 @@
-## <summary>Concurrent versions system</summary>
+## <summary>Concurrent versions system.</summary>
 
 ########################################
 ## <summary>
-##	Read the CVS data and metadata.
+##	Read CVS data and metadata content.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -22,8 +22,7 @@
 
 ########################################
 ## <summary>
-##	Allow the specified domain to execute cvs
-##	in the caller domain.
+##	Execute cvs in the caller domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -36,13 +35,14 @@
 		type cvs_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	can_exec($1, cvs_exec_t)
 ')
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate 
-##	an cvs environment
+##	All of the rules required to
+##	administrate an cvs environment
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -51,22 +51,20 @@
 ## </param>
 ## <param name="role">
 ##	<summary>
-##	The role to be allowed to manage the cvs domain.
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <rolecap/>
 #
 interface(`cvs_admin',`
 	gen_require(`
-		type cvs_t, cvs_tmp_t;
+		type cvs_t, cvs_tmp_t, cvs_initrc_exec_t;
 		type cvs_data_t, cvs_var_run_t;
-		type cvs_initrc_exec_t;
 	')
 
 	allow $1 cvs_t:process { ptrace signal_perms };
 	ps_process_pattern($1, cvs_t)
 
-	# Allow cvs_t to restart the apache service
 	init_labeled_script_domtrans($1, cvs_initrc_exec_t)
 	domain_system_change_exemption($1)
 	role_transition $2 cvs_initrc_exec_t system_r;
@@ -75,6 +73,7 @@
 	files_list_tmp($1)
 	admin_pattern($1, cvs_tmp_t)
 
+	files_search_usr($1)
 	admin_pattern($1, cvs_data_t)
 
 	files_list_pids($1)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/cvs.te refpolicy/policy/modules/contrib/cvs.te
--- refpolicy/policy/modules/contrib/cvs.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/cvs.te	2012-10-06 20:38:43.630753749 +0200
@@ -1,4 +1,4 @@
-policy_module(cvs, 1.9.0)
+policy_module(cvs, 1.9.1)
 
 ########################################
 #
@@ -6,9 +6,10 @@
 #
 
 ## <desc>
-## <p>
-## Allow cvs daemon to read shadow
-## </p>
+##	<p>
+##	Determine whether cvs can read shadow
+##	password files.
+##	</p>
 ## </desc>
 gen_tunable(allow_cvs_read_shadow, false)
 
@@ -16,7 +17,6 @@
 type cvs_exec_t;
 inetd_tcp_service_domain(cvs_t, cvs_exec_t)
 application_executable_file(cvs_exec_t)
-role system_r types cvs_t;
 
 type cvs_data_t; # customizable
 files_type(cvs_data_t)
@@ -35,12 +35,10 @@
 # Local policy
 #
 
+allow cvs_t self:capability { setuid setgid };
 allow cvs_t self:process signal_perms;
 allow cvs_t self:fifo_file rw_fifo_file_perms;
-allow cvs_t self:tcp_socket connected_stream_socket_perms;
-# for identd; cjp: this should probably only be inetd_child rules?
 allow cvs_t self:netlink_tcpdiag_socket r_netlink_socket_perms;
-allow cvs_t self:capability { setuid setgid };
 
 manage_dirs_pattern(cvs_t, cvs_data_t, cvs_data_t)
 manage_files_pattern(cvs_t, cvs_data_t, cvs_data_t)
@@ -48,7 +46,7 @@
 
 manage_dirs_pattern(cvs_t, cvs_tmp_t, cvs_tmp_t)
 manage_files_pattern(cvs_t, cvs_tmp_t, cvs_tmp_t)
-files_tmp_filetrans(cvs_t, cvs_tmp_t, { file dir })
+files_tmp_filetrans(cvs_t, cvs_tmp_t, { dir file })
 
 manage_files_pattern(cvs_t, cvs_var_run_t, cvs_var_run_t)
 files_pid_filetrans(cvs_t, cvs_var_run_t, file)
@@ -57,29 +55,20 @@
 kernel_read_system_state(cvs_t)
 kernel_read_network_state(cvs_t)
 
-corenet_all_recvfrom_unlabeled(cvs_t)
-corenet_all_recvfrom_netlabel(cvs_t)
-corenet_tcp_sendrecv_generic_if(cvs_t)
-corenet_udp_sendrecv_generic_if(cvs_t)
-corenet_tcp_sendrecv_generic_node(cvs_t)
-corenet_udp_sendrecv_generic_node(cvs_t)
-corenet_tcp_sendrecv_all_ports(cvs_t)
-corenet_udp_sendrecv_all_ports(cvs_t)
+corecmd_exec_bin(cvs_t)
+corecmd_exec_shell(cvs_t)
 
 dev_read_urand(cvs_t)
 
+files_read_etc_runtime_files(cvs_t)
+files_search_home(cvs_t)
+
 fs_getattr_xattr_fs(cvs_t)
 
 auth_domtrans_chk_passwd(cvs_t)
 auth_use_nsswitch(cvs_t)
 
-corecmd_exec_bin(cvs_t)
-corecmd_exec_shell(cvs_t)
-
-files_read_etc_files(cvs_t)
-files_read_etc_runtime_files(cvs_t)
-# for identd; cjp: this should probably only be inetd_child rules?
-files_search_home(cvs_t)
+init_read_utmp(cvs_t)
 
 logging_send_syslog_msg(cvs_t)
 logging_send_audit_msgs(cvs_t)
@@ -88,6 +77,8 @@
 
 mta_send_mail(cvs_t)
 
+userdom_dontaudit_search_user_home_dirs(cvs_t)
+
 # cjp: typeattribute doesnt work in conditionals yet
 auth_can_read_shadow_passwords(cvs_t)
 tunable_policy(`allow_cvs_read_shadow',`
@@ -103,7 +94,7 @@
 
 ########################################
 #
-# CVSWeb policy
+# CVSWeb local policy
 #
 
 optional_policy(`
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/cyphesis.fc refpolicy/policy/modules/contrib/cyphesis.fc
--- refpolicy/policy/modules/contrib/cyphesis.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/cyphesis.fc	2012-09-27 20:03:30.746126498 +0200
@@ -1,5 +1,7 @@
+/etc/rc\.d/init\.d/cyphesis	--	gen_context(system_u:object_r:cyphesis_initrc_exec_t,s0)
+
 /usr/bin/cyphesis	--	gen_context(system_u:object_r:cyphesis_exec_t,s0)
 
-/var/log/cyphesis(/.*)?		gen_context(system_u:object_r:cyphesis_log_t,s0)
+/var/log/cyphesis(/.*)?	gen_context(system_u:object_r:cyphesis_log_t,s0)
 
-/var/run/cyphesis(/.*)?		gen_context(system_u:object_r:cyphesis_var_run_t,s0)
+/var/run/cyphesis(/.*)?	gen_context(system_u:object_r:cyphesis_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/cyphesis.if refpolicy/policy/modules/contrib/cyphesis.if
--- refpolicy/policy/modules/contrib/cyphesis.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/cyphesis.if	2012-09-27 20:03:30.746126498 +0200
@@ -1,4 +1,4 @@
-## <summary>Cyphesis WorldForge game server</summary>
+## <summary>Cyphesis WorldForge game server.</summary>
 
 ########################################
 ## <summary>
@@ -15,5 +15,47 @@
 		type cyphesis_t, cyphesis_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, cyphesis_exec_t, cyphesis_t)
 ')
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an cyphesis environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`cyphesis_admin',`
+	gen_require(`
+		type cyphesis_t, cyphesis_initrc_exec_t, cyphesis_log_t;
+		type cyphesis_var_run_t, cyphesis_tmp_t;
+	')
+
+	allow $1 cyphesis_t:process { ptrace signal_perms };
+	ps_process_pattern($1, cyphesis_t)
+
+	init_labeled_script_domtrans($1, cyphesis_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 cyphesis_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	logging_search_logs($1)
+	admin_pattern($1, cyphesis_log_t)
+
+	files_search_pids($1)
+	admin_pattern($1, cyphesis_var_run_t)
+
+	files_search_tmp($1)
+	admin_pattern($1, cyphesis_tmp_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/cyphesis.te refpolicy/policy/modules/contrib/cyphesis.te
--- refpolicy/policy/modules/contrib/cyphesis.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/cyphesis.te	2012-10-06 19:01:57.329741355 +0200
@@ -1,4 +1,4 @@
-policy_module(cyphesis, 1.2.0)
+policy_module(cyphesis, 1.2.2)
 
 ########################################
 #
@@ -8,6 +8,10 @@
 type cyphesis_t;
 type cyphesis_exec_t;
 init_daemon_domain(cyphesis_t, cyphesis_exec_t)
+application_executable_file(cyphesis_exec_t)
+
+type cyphesis_initrc_exec_t;
+init_script_file(cyphesis_initrc_exec_t)
 
 type cyphesis_log_t;
 logging_log_file(cyphesis_log_t)
@@ -20,45 +24,41 @@
 
 ########################################
 #
-# cyphesis local policy
+# Local policy
 #
 
 allow cyphesis_t self:process { setfscreate setsched signal };
 allow cyphesis_t self:fifo_file rw_fifo_file_perms;
-allow cyphesis_t self:tcp_socket create_stream_socket_perms;
-allow cyphesis_t self:unix_stream_socket create_stream_socket_perms;
-allow cyphesis_t self:unix_dgram_socket create_socket_perms;
+allow cyphesis_t self:tcp_socket { accept listen };
+allow cyphesis_t self:unix_stream_socket { accept listen };
 
-manage_files_pattern(cyphesis_t, cyphesis_log_t, cyphesis_log_t)
+append_files_pattern(cyphesis_t, cyphesis_log_t, cyphesis_log_t)
+create_files_pattern(cyphesis_t, cyphesis_log_t, cyphesis_log_t)
+setattr_files_pattern(cyphesis_t, cyphesis_log_t, cyphesis_log_t)
 logging_log_filetrans(cyphesis_t, cyphesis_log_t, file)
 
-# DAN > Does cyphesis really create a sock_file in /tmp? Why?
-allow cyphesis_t cyphesis_tmp_t:sock_file manage_sock_file_perms;
-files_tmp_filetrans(cyphesis_t, cyphesis_tmp_t, file)
-
 manage_dirs_pattern(cyphesis_t, cyphesis_var_run_t, cyphesis_var_run_t)
 manage_files_pattern(cyphesis_t, cyphesis_var_run_t, cyphesis_var_run_t)
 manage_sock_files_pattern(cyphesis_t, cyphesis_var_run_t, cyphesis_var_run_t)
-files_pid_filetrans(cyphesis_t, cyphesis_var_run_t, { dir file sock_file })
+files_pid_filetrans(cyphesis_t, cyphesis_var_run_t, dir)
 
 kernel_read_system_state(cyphesis_t)
 kernel_read_kernel_sysctls(cyphesis_t)
 
-# DAN> What is cyphesis looking for in /bin?
 corecmd_search_bin(cyphesis_t)
 corecmd_getattr_bin_files(cyphesis_t)
 
 corenet_all_recvfrom_unlabeled(cyphesis_t)
 corenet_tcp_sendrecv_generic_if(cyphesis_t)
 corenet_tcp_sendrecv_generic_node(cyphesis_t)
-corenet_tcp_sendrecv_all_ports(cyphesis_t)
 corenet_tcp_bind_generic_node(cyphesis_t)
-corenet_tcp_bind_cyphesis_port(cyphesis_t)
+
 corenet_sendrecv_cyphesis_server_packets(cyphesis_t)
+corenet_tcp_bind_cyphesis_port(cyphesis_t)
+corenet_tcp_sendrecv_cyphesis_port(cyphesis_t)
 
 dev_read_urand(cyphesis_t)
 
-# Init script handling
 domain_use_interactive_fds(cyphesis_t)
 
 files_read_etc_files(cyphesis_t)
@@ -70,10 +70,12 @@
 
 sysnet_dns_name_resolve(cyphesis_t)
 
-# cyphesis wants to talk to avahi via dbus
 optional_policy(`
-	avahi_dbus_chat(cyphesis_t)
 	dbus_system_bus_client(cyphesis_t)
+
+	optional_policy(`
+		avahi_dbus_chat(cyphesis_t)
+	')
 ')
 
 optional_policy(`
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/cyrus.fc refpolicy/policy/modules/contrib/cyrus.fc
--- refpolicy/policy/modules/contrib/cyrus.fc	2012-05-04 16:15:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/cyrus.fc	2012-09-27 20:03:30.746126498 +0200
@@ -1,7 +1,10 @@
-/etc/rc\.d/init\.d/cyrus		--	gen_context(system_u:object_r:cyrus_initrc_exec_t,s0)
+/etc/rc\.d/init\.d/cyrus.*	--	gen_context(system_u:object_r:cyrus_initrc_exec_t,s0)
 
-/usr/lib/cyrus/master			--	gen_context(system_u:object_r:cyrus_exec_t,s0)
+/usr/lib/cyrus/master	--	gen_context(system_u:object_r:cyrus_exec_t,s0)
 /usr/lib/cyrus-imapd/cyrus-master	--	gen_context(system_u:object_r:cyrus_exec_t,s0)
 
-/var/imap(/.*)?					gen_context(system_u:object_r:cyrus_var_lib_t,s0)
-/var/lib/imap(/.*)?				gen_context(system_u:object_r:cyrus_var_lib_t,s0)
+/var/imap(/.*)?	gen_context(system_u:object_r:cyrus_var_lib_t,s0)
+
+/var/lib/imap(/.*)?	gen_context(system_u:object_r:cyrus_var_lib_t,s0)
+
+/var/run/cyrus.*	gen_context(system_u:object_r:cyrus_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/cyrus.if refpolicy/policy/modules/contrib/cyrus.if
--- refpolicy/policy/modules/contrib/cyrus.if	2012-05-04 15:16:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/cyrus.if	2012-09-27 20:03:30.746126498 +0200
@@ -1,9 +1,9 @@
-## <summary>Cyrus is an IMAP service intended to be run on sealed servers</summary>
+## <summary>Cyrus is an IMAP service intended to be run on sealed servers.</summary>
 
 ########################################
 ## <summary>
-##	Allow caller to create, read, write,
-##	and delete cyrus data files.
+##	Create, read, write, and delete
+##	cyrus data files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -22,7 +22,8 @@
 
 ########################################
 ## <summary>
-##	Connect to Cyrus using a unix domain stream socket.
+##	Connect to Cyrus using a unix
+##	domain stream socket.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -41,8 +42,8 @@
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate 
-##	an cyrus environment
+##	All of the rules required to
+##	administrate an cyrus environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -51,7 +52,7 @@
 ## </param>
 ## <param name="role">
 ##	<summary>
-##	The role to be allowed to manage the cyrus domain.
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <rolecap/>
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/cyrus.te refpolicy/policy/modules/contrib/cyrus.te
--- refpolicy/policy/modules/contrib/cyrus.te	2012-07-25 20:33:04.000000000 +0200
+++ refpolicy/policy/modules/contrib/cyrus.te	2012-09-27 20:03:30.747126498 +0200
@@ -1,4 +1,4 @@
-policy_module(cyrus, 1.12.0)
+policy_module(cyrus, 1.12.1)
 
 ########################################
 #
@@ -37,22 +37,18 @@
 allow cyrus_t self:sem create_sem_perms;
 allow cyrus_t self:msgq create_msgq_perms;
 allow cyrus_t self:msg { send receive };
-allow cyrus_t self:unix_dgram_socket create_socket_perms;
-allow cyrus_t self:unix_stream_socket create_stream_socket_perms;
 allow cyrus_t self:unix_dgram_socket sendto;
-allow cyrus_t self:unix_stream_socket connectto;
-allow cyrus_t self:tcp_socket create_stream_socket_perms;
-allow cyrus_t self:udp_socket create_socket_perms;
+allow cyrus_t self:unix_stream_socket { accept connectto listen };
+allow cyrus_t self:tcp_socket { accept listen };
 
 manage_dirs_pattern(cyrus_t, cyrus_tmp_t, cyrus_tmp_t)
 manage_files_pattern(cyrus_t, cyrus_tmp_t, cyrus_tmp_t)
-files_tmp_filetrans(cyrus_t, cyrus_tmp_t, { file dir })
+files_tmp_filetrans(cyrus_t, cyrus_tmp_t, { dir file })
 
 manage_dirs_pattern(cyrus_t, cyrus_var_lib_t, cyrus_var_lib_t)
 manage_files_pattern(cyrus_t, cyrus_var_lib_t, cyrus_var_lib_t)
 manage_lnk_files_pattern(cyrus_t, cyrus_var_lib_t, cyrus_var_lib_t)
 manage_sock_files_pattern(cyrus_t, cyrus_var_lib_t, cyrus_var_lib_t)
-files_pid_filetrans(cyrus_t, cyrus_var_run_t, file)
 
 manage_files_pattern(cyrus_t, cyrus_var_run_t, cyrus_var_run_t)
 manage_sock_files_pattern(cyrus_t, cyrus_var_run_t, cyrus_var_run_t)
@@ -65,37 +61,40 @@
 corenet_all_recvfrom_unlabeled(cyrus_t)
 corenet_all_recvfrom_netlabel(cyrus_t)
 corenet_tcp_sendrecv_generic_if(cyrus_t)
-corenet_udp_sendrecv_generic_if(cyrus_t)
 corenet_tcp_sendrecv_generic_node(cyrus_t)
-corenet_udp_sendrecv_generic_node(cyrus_t)
 corenet_tcp_sendrecv_all_ports(cyrus_t)
-corenet_udp_sendrecv_all_ports(cyrus_t)
 corenet_tcp_bind_generic_node(cyrus_t)
+
+corenet_sendrecv_mail_server_packets(cyrus_t)
 corenet_tcp_bind_mail_port(cyrus_t)
+
+corenet_sendrecv_lmtp_server_packets(cyrus_t)
 corenet_tcp_bind_lmtp_port(cyrus_t)
+
+corenet_sendrecv_pop_server_packets(cyrus_t)
 corenet_tcp_bind_pop_port(cyrus_t)
+
+corenet_sendrecv_sieve_server_packets(cyrus_t)
 corenet_tcp_bind_sieve_port(cyrus_t)
-corenet_tcp_connect_all_ports(cyrus_t)
-corenet_sendrecv_mail_server_packets(cyrus_t)
-corenet_sendrecv_pop_server_packets(cyrus_t)
-corenet_sendrecv_lmtp_server_packets(cyrus_t)
+
 corenet_sendrecv_all_client_packets(cyrus_t)
+corenet_tcp_connect_all_ports(cyrus_t)
+
+corecmd_exec_bin(cyrus_t)
 
 dev_read_rand(cyrus_t)
 dev_read_urand(cyrus_t)
 dev_read_sysfs(cyrus_t)
 
-fs_getattr_all_fs(cyrus_t)
-fs_search_auto_mountpoints(cyrus_t)
-
-corecmd_exec_bin(cyrus_t)
-
 domain_use_interactive_fds(cyrus_t)
 
 files_list_var_lib(cyrus_t)
-files_read_etc_files(cyrus_t)
 files_read_etc_runtime_files(cyrus_t)
 files_read_usr_files(cyrus_t)
+files_dontaudit_write_usr_dirs(cyrus_t)
+
+fs_getattr_all_fs(cyrus_t)
+fs_search_auto_mountpoints(cyrus_t)
 
 auth_use_nsswitch(cyrus_t)
 
@@ -106,8 +105,6 @@
 miscfiles_read_localization(cyrus_t)
 miscfiles_read_generic_certs(cyrus_t)
 
-sysnet_read_config(cyrus_t)
-
 userdom_use_unpriv_users_fds(cyrus_t)
 userdom_dontaudit_search_user_home_dirs(cyrus_t)
 
@@ -123,10 +120,6 @@
 ')
 
 optional_policy(`
-	ldap_stream_connect(cyrus_t)
-')
-
-optional_policy(`
 	sasl_connect(cyrus_t)
 ')
 
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/daemontools.fc refpolicy/policy/modules/contrib/daemontools.fc
--- refpolicy/policy/modules/contrib/daemontools.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/daemontools.fc	2012-09-27 20:03:30.747126498 +0200
@@ -1,53 +1,41 @@
-#
-# /service
-#
-
-/service		-d	gen_context(system_u:object_r:svc_svc_t,s0)
-/service/.*			gen_context(system_u:object_r:svc_svc_t,s0)
-
-#
-# /usr
-#
+/service	-d	gen_context(system_u:object_r:svc_svc_t,s0)
+/service/.*	gen_context(system_u:object_r:svc_svc_t,s0)
 
-/usr/bin/envdir		--	gen_context(system_u:object_r:svc_run_exec_t,s0)
+/usr/bin/envdir	--	gen_context(system_u:object_r:svc_run_exec_t,s0)
 /usr/bin/envuidgid	--	gen_context(system_u:object_r:svc_run_exec_t,s0)
-/usr/bin/fghack		--	gen_context(system_u:object_r:svc_run_exec_t,s0)
+/usr/bin/fghack	--	gen_context(system_u:object_r:svc_run_exec_t,s0)
 /usr/bin/multilog	--	gen_context(system_u:object_r:svc_multilog_exec_t,s0)
 /usr/bin/pgrphack	--	gen_context(system_u:object_r:svc_run_exec_t,s0)
-/usr/bin/setlock		--	gen_context(system_u:object_r:svc_run_exec_t,s0)
+/usr/bin/setlock	--	gen_context(system_u:object_r:svc_run_exec_t,s0)
 /usr/bin/setuidgid	--	gen_context(system_u:object_r:svc_run_exec_t,s0)
 /usr/bin/softlimit	--	gen_context(system_u:object_r:svc_run_exec_t,s0)
-/usr/bin/svc		--	gen_context(system_u:object_r:svc_start_exec_t,s0)
-/usr/bin/svok		--	gen_context(system_u:object_r:svc_start_exec_t,s0)
-/usr/bin/svscan		--	gen_context(system_u:object_r:svc_start_exec_t,s0)
+/usr/bin/svc	--	gen_context(system_u:object_r:svc_start_exec_t,s0)
+/usr/bin/svok	--	gen_context(system_u:object_r:svc_start_exec_t,s0)
+/usr/bin/svscan	--	gen_context(system_u:object_r:svc_start_exec_t,s0)
 /usr/bin/svscanboot	--	gen_context(system_u:object_r:svc_start_exec_t,s0)
 /usr/bin/supervise	--	gen_context(system_u:object_r:svc_start_exec_t,s0)
 
-#
-# /var
-#
-
-/var/axfrdns(/.*)?		gen_context(system_u:object_r:svc_svc_t,s0)
-/var/axfrdns/run		--	gen_context(system_u:object_r:svc_run_exec_t,s0)
+/var/axfrdns(/.*)?	gen_context(system_u:object_r:svc_svc_t,s0)
+/var/axfrdns/run	--	gen_context(system_u:object_r:svc_run_exec_t,s0)
 /var/axfrdns/log/run	--	gen_context(system_u:object_r:svc_run_exec_t,s0)
-/var/axfrdns/env(/.*)?		gen_context(system_u:object_r:svc_conf_t,s0)
+/var/axfrdns/env(/.*)?	gen_context(system_u:object_r:svc_conf_t,s0)
 
-/var/dnscache(/.*)?		gen_context(system_u:object_r:svc_svc_t,s0)
-/var/dnscache/env(/.*)?		gen_context(system_u:object_r:svc_conf_t,s0)
+/var/dnscache(/.*)?	gen_context(system_u:object_r:svc_svc_t,s0)
+/var/dnscache/env(/.*)?	gen_context(system_u:object_r:svc_conf_t,s0)
 /var/dnscache/run	--	gen_context(system_u:object_r:svc_run_exec_t,s0)
 /var/dnscache/log/run	--	gen_context(system_u:object_r:svc_run_exec_t,s0)
 
 /var/qmail/supervise(/.*)?	gen_context(system_u:object_r:svc_svc_t,s0)
-/var/qmail/supervise/.*/run --	gen_context(system_u:object_r:svc_run_exec_t,s0)
-/var/qmail/supervise/.*/log/run -- gen_context(system_u:object_r:svc_run_exec_t,s0)
+/var/qmail/supervise/.*/run	--	gen_context(system_u:object_r:svc_run_exec_t,s0)
+/var/qmail/supervise/.*/log/run	--	gen_context(system_u:object_r:svc_run_exec_t,s0)
 
-/var/service/.*			gen_context(system_u:object_r:svc_svc_t,s0)
+/var/service/.*	gen_context(system_u:object_r:svc_svc_t,s0)
 /var/service/.*/env(/.*)?	gen_context(system_u:object_r:svc_conf_t,s0)
 /var/service/.*/log/main(/.*)?	gen_context(system_u:object_r:svc_log_t,s0)
-/var/service/.*/log/run		gen_context(system_u:object_r:svc_run_exec_t,s0)
-/var/service/.*/run.*		gen_context(system_u:object_r:svc_run_exec_t,s0)
+/var/service/.*/log/run	gen_context(system_u:object_r:svc_run_exec_t,s0)
+/var/service/.*/run.*	gen_context(system_u:object_r:svc_run_exec_t,s0)
 
-/var/tinydns(/.*)?		gen_context(system_u:object_r:svc_svc_t,s0)
-/var/tinydns/run		--	gen_context(system_u:object_r:svc_run_exec_t,s0)
+/var/tinydns(/.*)?	gen_context(system_u:object_r:svc_svc_t,s0)
+/var/tinydns/run	--	gen_context(system_u:object_r:svc_run_exec_t,s0)
 /var/tinydns/log/run	--	gen_context(system_u:object_r:svc_run_exec_t,s0)
-/var/tinydns/env(/.*)?		gen_context(system_u:object_r:svc_conf_t,s0)
+/var/tinydns/env(/.*)?	gen_context(system_u:object_r:svc_conf_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/daemontools.if refpolicy/policy/modules/contrib/daemontools.if
--- refpolicy/policy/modules/contrib/daemontools.if	2012-05-04 15:16:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/daemontools.if	2012-09-27 20:03:30.747126498 +0200
@@ -1,13 +1,9 @@
-## <summary>Collection of tools for managing UNIX services</summary>
-## <desc>
-##	<p>
-##		Policy for DJB's daemontools
-##	</p>
-## </desc>
+## <summary>Collection of tools for managing UNIX services.</summary>
 
 ########################################
 ## <summary>
-##	An ipc channel between the supervised domain and svc_start_t
+##	An ipc channel between the
+##	supervised domain and svc_start_t.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -22,22 +18,23 @@
 
 	allow $1 svc_start_t:process sigchld;
 	allow $1 svc_start_t:fd use;
-	allow $1 svc_start_t:fifo_file { read write getattr };
+	allow $1 svc_start_t:fifo_file rw_fifo_file_perms;
 	allow svc_start_t $1:process signal;
 ')
 
 ########################################
 ## <summary>
-##	Define a specified domain as a supervised service.
+##	Create a domain which can be
+##	started by daemontools.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
-##	Domain allowed access.
+##	Type to be used as a domain.
 ##	</summary>
 ## </param>
 ## <param name="entrypoint">
 ##	<summary>
-##	The type associated with the process program.
+##	Type of the program to be used as an entry point to this domain.
 ##	</summary>
 ## </param>
 #
@@ -55,7 +52,8 @@
 
 ########################################
 ## <summary>
-##	Execute in the svc_start_t domain.
+##	Execute svc start in the svc
+##	start domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -68,38 +66,40 @@
 		type svc_start_t, svc_start_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, svc_start_exec_t, svc_start_t)
 ')
 
 ######################################
 ## <summary>
-##  Execute svc_start in the svc_start domain, and
-##  allow the specified role the svc_start domain.
+##	Execute svc start in the svc
+##	start domain, and allow the
+##	specified role the svc start domain.
 ## </summary>
 ## <param name="domain">
-##  <summary>
-##  Domain allowed access.
-##  </summary>
+##	<summary>
+##	Domain allowed to transition.
+##	</summary>
 ## </param>
 ## <param name="role">
-##  <summary>
-##  The role to be allowed the svc_start domain.
-##  </summary>
+##	<summary>
+##	Role allowed access.
+##	</summary>
 ## </param>
 ## <rolecap/>
 #
 interface(`daemonstools_run_start',`
-    gen_require(`
-		type svc_start_t;
-    ')
+	gen_require(`
+		attribute_role svc_start_roles;
+	')
 
-    daemontools_domtrans_start($1)
-    role $2 types svc_start_t;
+	daemontools_domtrans_start($1)
+	roleattribute $2 svc_start_roles;
 ')
 
 ########################################
 ## <summary>
-##	Execute in the svc_run_t domain.
+##	Execute avc run in the svc run domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -112,30 +112,33 @@
 		type svc_run_t, svc_run_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, svc_run_exec_t, svc_run_t)
 ')
 
 ######################################
 ## <summary>
-##  Send a SIGCHLD signal to svc_run domain.
+##	Send child terminated signals
+##	to svc run.
 ## </summary>
 ## <param name="domain">
-##  <summary>
-##  Domain allowed access.
-##  </summary>
+##	<summary>
+##	Domain allowed access.
+##	</summary>
 ## </param>
 #
 interface(`daemontools_sigchld_run',`
-    gen_require(`
+	gen_require(`
 		type svc_run_t;
-    ')
+	')
 
-    allow $1 svc_run_t:process sigchld;
+	allow $1 svc_run_t:process sigchld;
 ')
 
 ########################################
 ## <summary>
-##	Execute in the svc_multilog_t domain.
+##	Execute avc multilog in the svc
+##	multilog domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -148,30 +151,32 @@
 		type svc_multilog_t, svc_multilog_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, svc_multilog_exec_t, svc_multilog_t)
 ')
 
 ######################################
 ## <summary>
-##  Search svc_svc_t  directory.
+##	Search svc svc directories.
 ## </summary>
 ## <param name="domain">
-##  <summary>
-##  Domain allowed access.
-##  </summary>
+##	<summary>
+##	Domain allowed access.
+##	</summary>
 ## </param>
 #
 interface(`daemontools_search_svc_dir',`
-    gen_require(`
+	gen_require(`
 		type svc_svc_t;
-    ')
+	')
 
-    allow $1 svc_svc_t:dir search_dir_perms;
+	files_search_var($1)
+	allow $1 svc_svc_t:dir search_dir_perms;
 ')
 
 ########################################
 ## <summary>
-##	Allow a domain to read svc_svc_t files.
+##	Read svc avc files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -185,13 +190,15 @@
 		type svc_svc_t;
 	')
 
+	files_search_var($1)
 	allow $1 svc_svc_t:dir list_dir_perms;
 	allow $1 svc_svc_t:file read_file_perms;
 ')
 
 ########################################
 ## <summary>
-##	Allow a domain to create svc_svc_t files.
+##	Create, read, write and delete
+##	svc svc content.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -205,8 +212,9 @@
 		type svc_svc_t;
 	')
 
+	files_search_var($1)
 	allow $1 svc_svc_t:dir manage_dir_perms;
 	allow $1 svc_svc_t:fifo_file manage_fifo_file_perms;
 	allow $1 svc_svc_t:file manage_file_perms;
-	allow $1 svc_svc_t:lnk_file { read create };
+	allow $1 svc_svc_t:lnk_file manage_lnk_file_perms;
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/daemontools.te refpolicy/policy/modules/contrib/daemontools.te
--- refpolicy/policy/modules/contrib/daemontools.te	2012-05-04 15:16:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/daemontools.te	2012-09-27 20:03:30.747126498 +0200
@@ -1,10 +1,13 @@
-policy_module(daemontools, 1.2.0)
+policy_module(daemontools, 1.2.1)
 
 ########################################
 #
 # Declarations
 #
 
+attribute_role svc_start_roles;
+roleattribute system_r svc_start_roles;
+
 type svc_conf_t;
 files_config_file(svc_conf_t)
 
@@ -25,26 +28,26 @@
 type svc_start_exec_t;
 init_domain(svc_start_t, svc_start_exec_t)
 init_system_domain(svc_start_t, svc_start_exec_t)
-role system_r types svc_start_t;
+role svc_start_roles types svc_start_t;
 
 type svc_svc_t;
 files_type(svc_svc_t)
 
 ########################################
 #
-# multilog local policy
+# Multilog local policy
 #
 
-# multilog creates /service/*/log/status
 manage_files_pattern(svc_multilog_t, svc_svc_t, svc_svc_t)
 
+allow svc_multilog_t svc_start_t:process sigchld;
+allow svc_multilog_t svc_start_t:fd use;
+allow svc_multilog_t svc_start_t:fifo_file rw_fifo_file_perms;
+
 init_use_fds(svc_multilog_t)
 
-# writes to /var/log/*/*
 logging_manage_generic_logs(svc_multilog_t)
 
-daemontools_ipc_domain(svc_multilog_t)
-
 ########################################
 #
 # local policy for binaries that impose 
@@ -60,8 +63,13 @@
 allow svc_run_t svc_conf_t:dir list_dir_perms;
 allow svc_run_t svc_conf_t:file read_file_perms;
 
+allow svc_run_t svc_svc_t:dir list_dir_perms;
+allow svc_run_t svc_svc_t:file read_file_perms;
+
 can_exec(svc_run_t, svc_run_exec_t)
 
+domtrans_pattern(svc_run_t, svc_multilog_exec_t, svc_multilog_t)
+
 kernel_read_system_state(svc_run_t)
 
 dev_read_urand(svc_run_t)
@@ -77,9 +85,6 @@
 init_use_script_fds(svc_run_t)
 init_use_fds(svc_run_t)
 
-daemontools_domtrans_multilog(svc_run_t)
-daemontools_read_svc(svc_run_t)
-
 optional_policy(`
 	qmail_read_config(svc_run_t)
 ')
@@ -90,15 +95,22 @@
 # ie svc, svscan, supervise ...
 #
 
-allow svc_start_t svc_run_t:process { signal setrlimit };
-
-allow svc_start_t self:fifo_file rw_fifo_file_perms;
 allow svc_start_t self:capability kill;
+allow svc_start_t self:fifo_file rw_fifo_file_perms;
 allow svc_start_t self:tcp_socket create_stream_socket_perms;
-allow svc_start_t self:unix_stream_socket create_socket_perms;
+
+allow svc_start_t svc_svc_t:dir manage_dir_perms;
+allow svc_start_t svc_svc_t:fifo_file manage_fifo_file_perms;
+allow svc_start_t svc_svc_t:file manage_file_perms;
+allow svc_start_t svc_svc_t:lnk_file manage_lnk_file_perms;
+
+allow svc_start_t svc_multilog_t:process signal;
+allow svc_start_t svc_run_t:process { signal setrlimit };
 
 can_exec(svc_start_t, svc_start_exec_t)
 
+domtrans_pattern(svc_start_t, svc_run_exec_t, svc_run_t)
+
 kernel_read_kernel_sysctls(svc_start_t)
 kernel_read_system_state(svc_start_t)
 
@@ -110,9 +122,6 @@
 files_search_var(svc_start_t)
 files_search_pids(svc_start_t)
 
-daemontools_domtrans_run(svc_start_t)
-daemontools_manage_svc(svc_start_t)
-
 logging_send_syslog_msg(svc_start_t)
 
 miscfiles_read_localization(svc_start_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/dante.fc refpolicy/policy/modules/contrib/dante.fc
--- refpolicy/policy/modules/contrib/dante.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/dante.fc	2012-09-27 20:03:30.747126498 +0200
@@ -1,6 +1,10 @@
+/etc/rc\.d/init\.d/danted	--	gen_context(system_u:object_r:dante_initrc_exec_t,s0)
 
-/etc/socks(/.*)?		gen_context(system_u:object_r:dante_conf_t,s0)
+/etc/danted\.conf	--	gen_context(system_u:object_r:dante_conf_t,s0)
+/etc/socks(/.*)?	gen_context(system_u:object_r:dante_conf_t,s0)
 
-/usr/sbin/sockd		--	gen_context(system_u:object_r:dante_exec_t,s0)
+/usr/sbin/danted	--	gen_context(system_u:object_r:dante_exec_t,s0)
+/usr/sbin/sockd	--	gen_context(system_u:object_r:dante_exec_t,s0)
 
+/var/run/danted\.pid	--	gen_context(system_u:object_r:dante_var_run_t,s0)
 /var/run/sockd\.pid	--	gen_context(system_u:object_r:dante_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/dante.if refpolicy/policy/modules/contrib/dante.if
--- refpolicy/policy/modules/contrib/dante.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/dante.if	2012-09-27 20:03:30.747126498 +0200
@@ -1 +1,39 @@
-## <summary>Dante msproxy and socks4/5 proxy server</summary>
+## <summary>Dante msproxy and socks4/5 proxy server.</summary>
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an dante environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`dante_admin',`
+	gen_require(`
+		type dante_t, dante_conf_t, dante_var_run_t;
+		type dante_initrc_exec_t;
+	')
+
+	allow $1 dante_t:process { ptrace signal_perms };
+	ps_process_pattern($1, dante_t)
+
+	init_labeled_script_domtrans($1, dante_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 dante_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	files_search_etc($1)
+	admin_pattern($1, dante_conf_t)
+
+	files_search_pids($1)
+	admin_pattern($1, dante_var_run_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/dante.te refpolicy/policy/modules/contrib/dante.te
--- refpolicy/policy/modules/contrib/dante.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/dante.te	2012-10-06 19:02:14.370741391 +0200
@@ -1,4 +1,4 @@
-policy_module(dante, 1.8.0)
+policy_module(dante, 1.8.2)
 
 ########################################
 #
@@ -9,8 +9,11 @@
 type dante_exec_t;
 init_daemon_domain(dante_t, dante_exec_t)
 
+type dante_initrc_exec_t;
+init_script_file(dante_initrc_exec_t)
+
 type dante_conf_t;
-files_type(dante_conf_t)
+files_config_file(dante_conf_t)
 
 type dante_var_run_t;
 files_pid_file(dante_var_run_t)
@@ -24,8 +27,7 @@
 dontaudit dante_t self:capability sys_tty_config;
 allow dante_t self:process signal_perms;
 allow dante_t self:fifo_file rw_fifo_file_perms;
-allow dante_t self:tcp_socket create_stream_socket_perms;
-allow dante_t self:udp_socket create_socket_perms;
+allow dante_t self:tcp_socket { accept listen };
 
 allow dante_t dante_conf_t:dir list_dir_perms;
 allow dante_t dante_conf_t:file read_file_perms;
@@ -40,13 +42,12 @@
 corenet_all_recvfrom_unlabeled(dante_t)
 corenet_all_recvfrom_netlabel(dante_t)
 corenet_tcp_sendrecv_generic_if(dante_t)
-corenet_udp_sendrecv_generic_if(dante_t)
 corenet_tcp_sendrecv_generic_node(dante_t)
-corenet_udp_sendrecv_generic_node(dante_t)
-corenet_tcp_sendrecv_all_ports(dante_t)
-corenet_udp_sendrecv_all_ports(dante_t)
 corenet_tcp_bind_generic_node(dante_t)
+
+corenet_sendrecv_socks_server_packets(dante_t)
 corenet_tcp_bind_socks_port(dante_t)
+corenet_tcp_sendrecv_socks_port(dante_t)
 
 dev_read_sysfs(dante_t)
 
@@ -64,7 +65,7 @@
 
 miscfiles_read_localization(dante_t)
 
-sysnet_read_config(dante_t)
+sysnet_dns_name_resolve(dante_t)
 
 userdom_dontaudit_use_unpriv_user_fds(dante_t)
 userdom_dontaudit_search_user_home_dirs(dante_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/dbadm.if refpolicy/policy/modules/contrib/dbadm.if
--- refpolicy/policy/modules/contrib/dbadm.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/dbadm.if	2012-09-27 20:03:30.748126498 +0200
@@ -1,4 +1,4 @@
-## <summary>Database administrator role</summary>
+## <summary>Database administrator role.</summary>
 
 ########################################
 ## <summary>
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/dbadm.te refpolicy/policy/modules/contrib/dbadm.te
--- refpolicy/policy/modules/contrib/dbadm.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/dbadm.te	2012-11-02 20:07:59.388957357 +0100
@@ -1,4 +1,4 @@
-policy_module(dbadm, 1.0.0)
+policy_module(dbadm, 1.0.1)
 
 ########################################
 #
@@ -6,16 +6,18 @@
 #
 
 ## <desc>
-## <p>
-## Allow dbadm to manage files in users home directories
-## </p>
+##	<p>
+##	Determine whether dbadm can manage
+##	generic user files.
+##	</p>
 ## </desc>
 gen_tunable(dbadm_manage_user_files, false)
 
 ## <desc>
-## <p>
-## Allow dbadm to read files in users home directories
-## </p>
+##	<p>
+##	Determine whether dbadm can read
+##	generic user files.
+##	</p>
 ## </desc>
 gen_tunable(dbadm_read_user_files, false)
 
@@ -25,7 +27,7 @@
 
 ########################################
 #
-# database admin local policy
+# Local policy
 #
 
 allow dbadm_t self:capability { dac_override dac_read_search sys_ptrace };
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/dbskk.te refpolicy/policy/modules/contrib/dbskk.te
--- refpolicy/policy/modules/contrib/dbskk.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/dbskk.te	2012-10-06 19:02:19.649741402 +0200
@@ -1,4 +1,4 @@
-policy_module(dbskk, 1.5.0)
+policy_module(dbskk, 1.5.1)
 
 ########################################
 #
@@ -23,18 +23,7 @@
 
 allow dbskkd_t self:process signal_perms;
 allow dbskkd_t self:fifo_file rw_fifo_file_perms;
-allow dbskkd_t self:tcp_socket connected_stream_socket_perms;
-allow dbskkd_t self:udp_socket create_socket_perms;
-
-# for identd
-# cjp: this should probably only be inetd_child rules?
-allow dbskkd_t self:netlink_tcpdiag_socket r_netlink_socket_perms;
-allow dbskkd_t self:capability { setuid setgid };
-files_search_home(dbskkd_t)
-optional_policy(`
-	kerberos_use(dbskkd_t)
-')
-#end for identd
+allow dbskkd_t self:tcp_socket { accept listen };
 
 manage_dirs_pattern(dbskkd_t, dbskkd_tmp_t, dbskkd_tmp_t)
 manage_files_pattern(dbskkd_t, dbskkd_tmp_t, dbskkd_tmp_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/dbus.fc refpolicy/policy/modules/contrib/dbus.fc
--- refpolicy/policy/modules/contrib/dbus.fc	2012-05-04 16:10:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/dbus.fc	2012-10-06 17:53:00.776732525 +0200
@@ -1,25 +1,20 @@
-/etc/dbus-1(/.*)?		gen_context(system_u:object_r:dbusd_etc_t,s0)
+HOME_DIR/\.dbus(/.*)?	gen_context(system_u:object_r:session_dbusd_home_t,s0)
 
-/bin/dbus-daemon 	--	gen_context(system_u:object_r:dbusd_exec_t,s0)
+/etc/dbus-.*(/.*)?	gen_context(system_u:object_r:dbusd_etc_t,s0)
 
-ifdef(`distro_redhat',`
-/lib/dbus-1/dbus-daemon-launch-helper -- gen_context(system_u:object_r:dbusd_exec_t,s0)
-')
+/bin/dbus-daemon	--	gen_context(system_u:object_r:dbusd_exec_t,s0)
 
-/usr/bin/dbus-daemon(-1)? --	gen_context(system_u:object_r:dbusd_exec_t,s0)
+/lib/dbus-.*/dbus-daemon-launch-helper -- gen_context(system_u:object_r:dbusd_exec_t,s0)
 
-ifdef(`distro_debian',`
-/usr/lib/dbus-1.0/dbus-daemon-launch-helper -- gen_context(system_u:object_r:dbusd_exec_t,s0)
-')
+/usr/bin/dbus-daemon(-1)?	--	gen_context(system_u:object_r:dbusd_exec_t,s0)
 
-ifdef(`distro_gentoo',`
-/usr/libexec/dbus-daemon-launch-helper -- gen_context(system_u:object_r:dbusd_exec_t,s0)
-')
+/usr/lib/dbus-.*/dbus-daemon-launch-helper	--	gen_context(system_u:object_r:dbusd_exec_t,s0)
 
-/var/lib/dbus(/.*)?		gen_context(system_u:object_r:system_dbusd_var_lib_t,s0)
+/usr/libexec/dbus-daemon-launch-helper	--	gen_context(system_u:object_r:dbusd_exec_t,s0)
 
-/var/run/dbus(/.*)?		gen_context(system_u:object_r:system_dbusd_var_run_t,s0)
+/var/lib/dbus(/.*)?	gen_context(system_u:object_r:system_dbusd_var_lib_t,s0)
+
+/var/run/dbus(/.*)?	gen_context(system_u:object_r:system_dbusd_var_run_t,s0)
+/var/run/messagebus\.pid	--	gen_context(system_u:object_r:system_dbusd_var_run_t,s0)
 
-ifdef(`distro_redhat',`
 /var/named/chroot/var/run/dbus(/.*)?	gen_context(system_u:object_r:system_dbusd_var_run_t,s0)
-')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/dbus.if refpolicy/policy/modules/contrib/dbus.if
--- refpolicy/policy/modules/contrib/dbus.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/dbus.if	2012-11-01 21:47:05.348785631 +0100
@@ -1,4 +1,4 @@
-## <summary>Desktop messaging bus</summary>
+## <summary>Desktop messaging bus.</summary>
 
 ########################################
 ## <summary>
@@ -19,7 +19,7 @@
 
 ########################################
 ## <summary>
-##	Role access for dbus
+##	Role access for dbus.
 ## </summary>
 ## <param name="role_prefix">
 ##	<summary>
@@ -41,20 +41,21 @@
 template(`dbus_role_template',`
 	gen_require(`
 		class dbus { send_msg acquire_svc };
-
 		attribute session_bus_type;
-		type system_dbusd_t, session_dbusd_tmp_t, dbusd_exec_t, dbusd_etc_t;
+		type system_dbusd_t, dbusd_exec_t;
+		type session_dbusd_tmp_t, session_dbusd_home_t;
 	')
 
 	##############################
 	#
-	# Delcarations
+	# Declarations
 	#
 
 	type $1_dbusd_t, session_bus_type;
 	domain_type($1_dbusd_t)
 	domain_entry_file($1_dbusd_t, dbusd_exec_t)
 	ubac_constrained($1_dbusd_t)
+
 	role $2 types $1_dbusd_t;
 
 	##############################
@@ -62,113 +63,43 @@
 	# Local policy
 	#
 
-	allow $1_dbusd_t self:process { getattr sigkill signal };
-	dontaudit $1_dbusd_t self:process ptrace;
-	allow $1_dbusd_t self:file { getattr read write };
-	allow $1_dbusd_t self:fifo_file rw_fifo_file_perms;
-	allow $1_dbusd_t self:dbus { send_msg acquire_svc };
-	allow $1_dbusd_t self:unix_stream_socket create_stream_socket_perms;
-	allow $1_dbusd_t self:unix_dgram_socket create_socket_perms;
-	allow $1_dbusd_t self:tcp_socket create_stream_socket_perms;
-	allow $1_dbusd_t self:netlink_selinux_socket create_socket_perms;
-
-	# For connecting to the bus
 	allow $3 $1_dbusd_t:unix_stream_socket connectto;
-
-	# SE-DBus specific permissions
 	allow $3 $1_dbusd_t:dbus { send_msg acquire_svc };
+	allow $3 $1_dbusd_t:fd use;
+	
 	allow $3 system_dbusd_t:dbus { send_msg acquire_svc };
 
-	allow $1_dbusd_t dbusd_etc_t:dir list_dir_perms;
-	read_files_pattern($1_dbusd_t, dbusd_etc_t, dbusd_etc_t)
-	read_lnk_files_pattern($1_dbusd_t, dbusd_etc_t, dbusd_etc_t)
-
-	manage_dirs_pattern($1_dbusd_t, session_dbusd_tmp_t, session_dbusd_tmp_t)
-	manage_files_pattern($1_dbusd_t, session_dbusd_tmp_t, session_dbusd_tmp_t)
-	files_tmp_filetrans($1_dbusd_t, session_dbusd_tmp_t, { file dir })
+	allow $3 { session_dbusd_home_t session_dbusd_tmp_t }:dir { manage_dir_perms relabel_dir_perms };
+	allow $3 { session_dbusd_home_t session_dbusd_tmp_t }:file { manage_file_perms relabel_file_perms };
+	userdom_user_home_dir_filetrans($3, session_dbusd_home_t, dir, ".dbus")
 
 	domtrans_pattern($3, dbusd_exec_t, $1_dbusd_t)
-	allow $3 $1_dbusd_t:process { signull sigkill signal };
 
-	# cjp: this seems very broken
-	corecmd_bin_domtrans($1_dbusd_t, $3)
-	allow $1_dbusd_t $3:process sigkill;
-	allow $3 $1_dbusd_t:fd use;
-	allow $3 $1_dbusd_t:fifo_file rw_fifo_file_perms;
-	allow $3 $1_dbusd_t:process sigchld;
+	ps_process_pattern($3, $1_dbusd_t)
+	allow $3 $1_dbusd_t:process { ptrace signal_perms };
 
-	kernel_read_system_state($1_dbusd_t)
-	kernel_read_kernel_sysctls($1_dbusd_t)
+	allow $1_dbusd_t $3:process sigkill;
 
-	corecmd_list_bin($1_dbusd_t)
-	corecmd_read_bin_symlinks($1_dbusd_t)
-	corecmd_read_bin_files($1_dbusd_t)
-	corecmd_read_bin_pipes($1_dbusd_t)
-	corecmd_read_bin_sockets($1_dbusd_t)
-
-	corenet_all_recvfrom_unlabeled($1_dbusd_t)
-	corenet_all_recvfrom_netlabel($1_dbusd_t)
-	corenet_tcp_sendrecv_generic_if($1_dbusd_t)
-	corenet_tcp_sendrecv_generic_node($1_dbusd_t)
-	corenet_tcp_sendrecv_all_ports($1_dbusd_t)
-	corenet_tcp_bind_generic_node($1_dbusd_t)
-	corenet_tcp_bind_reserved_port($1_dbusd_t)
-
-	dev_read_urand($1_dbusd_t)
-
- 	domain_use_interactive_fds($1_dbusd_t)
-	domain_read_all_domains_state($1_dbusd_t)
-
-	files_read_etc_files($1_dbusd_t)
-	files_list_home($1_dbusd_t)
-	files_read_usr_files($1_dbusd_t)
-	files_dontaudit_search_var($1_dbusd_t)
-
-	fs_getattr_romfs($1_dbusd_t)
-	fs_getattr_xattr_fs($1_dbusd_t)
-	fs_list_inotifyfs($1_dbusd_t)
-	fs_dontaudit_list_nfs($1_dbusd_t)
-
-	selinux_get_fs_mount($1_dbusd_t)
-	selinux_validate_context($1_dbusd_t)
-	selinux_compute_access_vector($1_dbusd_t)
-	selinux_compute_create_context($1_dbusd_t)
-	selinux_compute_relabel_context($1_dbusd_t)
-	selinux_compute_user_contexts($1_dbusd_t)
+	corecmd_bin_domtrans($1_dbusd_t, $3)
+	corecmd_shell_domtrans($1_dbusd_t, $3)
 
-	auth_read_pam_console_data($1_dbusd_t)
 	auth_use_nsswitch($1_dbusd_t)
 
-	logging_send_audit_msgs($1_dbusd_t)
-	logging_send_syslog_msg($1_dbusd_t)
-
-	miscfiles_read_localization($1_dbusd_t)
-
-	seutil_read_config($1_dbusd_t)
-	seutil_read_default_contexts($1_dbusd_t)
-
-	term_use_all_terms($1_dbusd_t)
-
-	userdom_read_user_home_content_files($1_dbusd_t)
-
-	ifdef(`hide_broken_symptoms', `
+	ifdef(`hide_broken_symptoms',`
 		dontaudit $3 $1_dbusd_t:netlink_selinux_socket { read write };
 	')
 
-	optional_policy(`
-		hal_dbus_chat($1_dbusd_t)
-	')
-
-	optional_policy(`
-		xserver_use_xdm_fds($1_dbusd_t)
-		xserver_rw_xdm_pipes($1_dbusd_t)
+	ifdef(`distro_gentoo',`
+		optional_policy(`
+			xdg_read_generic_data_home_files($1_dbusd_t)
+		')
 	')
 ')
 
 #######################################
 ## <summary>
 ##	Template for creating connections to
-##	the system DBUS.
+##	the system bus.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -178,28 +109,29 @@
 #
 interface(`dbus_system_bus_client',`
 	gen_require(`
-		type system_dbusd_t, system_dbusd_t;
-		type system_dbusd_var_run_t, system_dbusd_var_lib_t;
+		attribute dbusd_system_bus_client;
+		type system_dbusd_t, system_dbusd_var_run_t, system_dbusd_var_lib_t;
 		class dbus send_msg;
 	')
 
-	# SE-DBus specific permissions
+	typeattribute $1 dbusd_system_bus_client;
+
 	allow $1 { system_dbusd_t self }:dbus send_msg;
 	allow system_dbusd_t $1:dbus send_msg;
 
-	read_files_pattern($1, system_dbusd_var_lib_t, system_dbusd_var_lib_t)
 	files_search_var_lib($1)
+	read_files_pattern($1, system_dbusd_var_lib_t, system_dbusd_var_lib_t)
 
-	# For connecting to the bus
 	files_search_pids($1)
 	stream_connect_pattern($1, system_dbusd_var_run_t, system_dbusd_var_run_t, system_dbusd_t)
+
 	dbus_read_config($1)
 ')
 
 #######################################
 ## <summary>
-##	Template for creating connections to
-##	a user DBUS.
+##	Acquire service on DBUS
+##	session bus.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -207,24 +139,135 @@
 ##	</summary>
 ## </param>
 #
-interface(`dbus_session_bus_client',`
+interface(`dbus_connect_session_bus',`
+	refpolicywarn(`$0($*) has been deprecated, use dbus_connect_all_session_bus() instead.')
+	dbus_connect_all_session_bus($1)
+')
+
+#######################################
+## <summary>
+##	Acquire service on all DBUS
+##	session busses.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`dbus_connect_all_session_bus',`
 	gen_require(`
 		attribute session_bus_type;
+		class dbus acquire_svc;
+	')
+
+	allow $1 session_bus_type:dbus acquire_svc;
+')
+
+#######################################
+## <summary>
+##	Acquire service on specified
+##	DBUS session bus.
+## </summary>
+## <param name="role_prefix">
+##	<summary>
+##	The prefix of the user role (e.g., user
+##	is the prefix for user_r).
+##	</summary>
+## </param>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`dbus_connect_spec_session_bus',`
+	gen_require(`
+		type $1_dbusd_t;
+		class dbus acquire_svc;
+	')
+
+	allow $2 $1_dbusd_t:dbus acquire_svc;
+')
+
+#######################################
+## <summary>
+##	Creating connections to DBUS
+##	session bus.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`dbus_session_bus_client',`
+	refpolicywarn(`$0($*) has been deprecated, use dbus_all_session_bus_client() instead.')
+	dbus_all_session_bus_client($1)
+')
+
+#######################################
+## <summary>
+##	Creating connections to all
+##	DBUS session busses.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`dbus_all_session_bus_client',`
+	gen_require(`
+		attribute session_bus_type, dbusd_session_bus_client;
 		class dbus send_msg;
 	')
 
-	# SE-DBus specific permissions
-	allow $1 { session_bus_type self }:dbus send_msg;
+	typeattribute $1 dbusd_session_bus_client;
 
-	# For connecting to the bus
+	allow $1 { session_bus_type self }:dbus send_msg;
+	allow session_bus_type $1:dbus send_msg;
+	
 	allow $1 session_bus_type:unix_stream_socket connectto;
+	allow $1 session_bus_type:fd use;
+')
+
+#######################################
+## <summary>
+##	Creating connections to specified
+##	DBUS session bus.
+## </summary>
+## <param name="role_prefix">
+##	<summary>
+##	The prefix of the user role (e.g., user
+##	is the prefix for user_r).
+##	</summary>
+## </param>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`dbus_spec_session_bus_client',`
+	gen_require(`
+		attribute dbusd_session_bus_client;
+		type $1_dbusd_t;
+		class dbus send_msg;
+	')
+
+	typeattribute $2 dbusd_session_bus_client;
 
-	dontaudit $1 session_bus_type:fd use;
+	allow $2 { $1_dbusd_t self }:dbus send_msg;
+	allow $1_dbusd_t $2:dbus send_msg;
+
+	allow $2 $1_dbusd_t:unix_stream_socket connectto;
+	allow $2 $1_dbusd_t:fd use;
 ')
 
-########################################
+#######################################
 ## <summary>
-##	Send a message the session DBUS.
+##	Send messages to DBUS session bus.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -233,17 +276,59 @@
 ## </param>
 #
 interface(`dbus_send_session_bus',`
+	refpolicywarn(`$0($*) has been deprecated, use dbus_send_all_session_bus() instead.')
+	dbus_send_all_session_bus($1)
+')
+
+#######################################
+## <summary>
+##	Send messages to all DBUS
+##	session busses.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`dbus_send_all_session_bus',`
 	gen_require(`
 		attribute session_bus_type;
 		class dbus send_msg;
 	')
 
-	allow $1 session_bus_type:dbus send_msg;
+	allow $1 dbus_session_bus_type:dbus send_msg;
+')
+
+#######################################
+## <summary>
+##	Send messages to specified
+##	DBUS session busses.
+## </summary>
+## <param name="role_prefix">
+##	<summary>
+##	The prefix of the user role (e.g., user
+##	is the prefix for user_r).
+##	</summary>
+## </param>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`dbus_send_spec_session_bus',`
+	gen_require(`
+		type $1_dbusd_t;
+		class dbus send_msg;
+	')
+
+	allow $2 $1_dbusd_t:dbus send_msg;
 ')
 
 ########################################
 ## <summary>
-##	Read dbus configuration.
+##	Read dbus configuration content.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -277,6 +362,10 @@
 
 	files_search_var_lib($1)
 	read_files_pattern($1, system_dbusd_var_lib_t, system_dbusd_var_lib_t)
+
+	ifdef(`distro_gentoo',`
+		read_lnk_files_pattern($1, system_dbusd_var_lib_t, system_dbusd_var_lib_t)
+	')
 ')
 
 ########################################
@@ -301,29 +390,71 @@
 
 ########################################
 ## <summary>
-##	Connect to the system DBUS
-##	for service (acquire_svc).
+##	Allow a application domain to be
+##	started by the specified session bus.
 ## </summary>
+## <param name="role_prefix">
+##	<summary>
+##	The prefix of the user role (e.g., user
+##	is the prefix for user_r).
+##	</summary>
+## </param>
 ## <param name="domain">
 ##	<summary>
-##	Domain allowed access.
+##	Type to be used as a domain.
+##	</summary>
+## </param>
+## <param name="entry_point">
+##	<summary>
+##	Type of the program to be used as an
+##	entry point to this domain.
 ##	</summary>
 ## </param>
 #
-interface(`dbus_connect_session_bus',`
+interface(`dbus_session_domain',`
+	refpolicywarn(`$0($*) has been deprecated, use dbus_all_session_domain() instead.')
+	dbus_all_session_domain($1, $2)
+')
+
+########################################
+## <summary>
+##	Allow a application domain to be
+##	started by the specified session bus.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Type to be used as a domain.
+##	</summary>
+## </param>
+## <param name="entry_point">
+##	<summary>
+##	Type of the program to be used as an
+##	entry point to this domain.
+##	</summary>
+## </param>
+#
+interface(`dbus_all_session_domain',`
 	gen_require(`
-		attribute session_bus_type;
-		class dbus acquire_svc;
+		type session_bus_type;
 	')
 
-	allow $1 session_bus_type:dbus acquire_svc;
+	domtrans_pattern(session_bus_type, $2, $1)
+
+	dbus_all_session_bus_client($1)
+	dbus_connect_all_session_bus($1)
 ')
 
 ########################################
 ## <summary>
-##	Allow a application domain to be started
-##	by the session dbus.
+##	Allow a application domain to be
+##	started by the specified session bus.
 ## </summary>
+## <param name="role_prefix">
+##	<summary>
+##	The prefix of the user role (e.g., user
+##	is the prefix for user_r).
+##	</summary>
+## </param>
 ## <param name="domain">
 ##	<summary>
 ##	Type to be used as a domain.
@@ -336,21 +467,20 @@
 ##	</summary>
 ## </param>
 #
-interface(`dbus_session_domain',`
+interface(`dbus_spec_session_domain',`
 	gen_require(`
-		attribute session_bus_type;
+		type $1_dbusd_t;
 	')
 
-	domtrans_pattern(session_bus_type, $2, $1)
+	domtrans_pattern($1_dbusd_t, $2, $3)
 
-	dbus_session_bus_client($1)
-	dbus_connect_session_bus($1)
+	dbus_spec_session_bus_client($1, $2)
+	dbus_connect_spec_session_bus($1, $2)
 ')
 
 ########################################
 ## <summary>
-##	Connect to the system DBUS
-##	for service (acquire_svc).
+##	Acquire service on the DBUS system bus.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -369,7 +499,7 @@
 
 ########################################
 ## <summary>
-##	Send a message on the system DBUS.
+##	Send messages to the DBUS system bus.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -388,7 +518,7 @@
 
 ########################################
 ## <summary>
-##	Allow unconfined access to the system DBUS.
+##	Unconfined access to DBUS system bus.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -407,8 +537,8 @@
 
 ########################################
 ## <summary>
-##	Create a domain for processes
-##	which can be started by the system dbus
+##	Create a domain for processes which
+##	can be started by the DBUS system bus.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -448,7 +578,8 @@
 
 ########################################
 ## <summary>
-##	Use and inherit system DBUS file descriptors.
+##	Use and inherit DBUS system bus
+##	file descriptors.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -466,7 +597,8 @@
 
 ########################################
 ## <summary>
-##	Dontaudit Read, and write system dbus TCP sockets.
+##	Do not audit attempts to read and
+##	write DBUS system bus TCP sockets.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -479,13 +611,12 @@
 		type system_dbusd_t;
 	')
 
-	allow $1 system_dbusd_t:tcp_socket { read write };
-	allow $1 system_dbusd_t:fd use;
+	dontaudit $1 system_dbusd_t:tcp_socket { read write };
 ')
 
 ########################################
 ## <summary>
-##	Allow unconfined access to the system DBUS.
+##	Unconfined access to DBUS.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -500,3 +631,49 @@
 
 	typeattribute $1 dbusd_unconfined;
 ')
+
+########################################
+## <summary>
+##	Create resources in /run or /var/run with the system_dbusd_var_run_t
+##	label. This method is deprecated in favor of the init_daemon_run_dir
+##	call.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access
+##	</summary>
+## </param>
+## <param name="class">
+##	<summary>
+##	Classes supported for the created resources
+##	</summary>
+## </param>
+## <param name="filename" optional="true">
+##	<summary>
+##	Optional file name used for the resource
+##	</summary>
+## </param>
+#
+interface(`dbus_generic_pid_filetrans_system_dbusd_var_run',`
+	refpolicywarn(`$0($*) has been deprecated.')
+')
+
+########################################
+## <summary>
+##	Create directories with the system_dbusd_var_run_t label
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access
+##	</summary>
+## </param>
+#
+interface(`dbus_create_system_dbusd_var_run_dirs',`
+	gen_require(`
+		type system_dbusd_var_run_t;
+	')
+
+	create_dirs_pattern($1, system_dbusd_var_run_t, system_dbusd_var_run_t)
+')
+
+
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/dbus.te refpolicy/policy/modules/contrib/dbus.te
--- refpolicy/policy/modules/contrib/dbus.te	2012-07-25 20:33:04.000000000 +0200
+++ refpolicy/policy/modules/contrib/dbus.te	2012-11-01 21:43:27.338785166 +0100
@@ -1,17 +1,20 @@
-policy_module(dbus, 1.17.0)
+policy_module(dbus, 1.18.5)
 
 gen_require(`
 	class dbus all_dbus_perms;
 ')
 
-##############################
+########################################
 #
-# Delcarations
+# Declarations
 #
 
 attribute dbusd_unconfined;
 attribute session_bus_type;
 
+attribute dbusd_system_bus_client;
+attribute dbusd_session_bus_client;
+
 type dbusd_etc_t;
 files_config_file(dbusd_etc_t)
 
@@ -19,6 +22,9 @@
 corecmd_executable_file(dbusd_exec_t)
 typealias dbusd_exec_t alias system_dbusd_exec_t;
 
+type session_dbusd_home_t;
+userdom_user_home_content(session_dbusd_home_t)
+
 type session_dbusd_tmp_t;
 typealias session_dbusd_tmp_t alias { user_dbusd_tmp_t staff_dbusd_tmp_t sysadm_dbusd_tmp_t };
 typealias session_dbusd_tmp_t alias { auditadm_dbusd_tmp_t secadm_dbusd_tmp_t };
@@ -35,6 +41,7 @@
 
 type system_dbusd_var_run_t;
 files_pid_file(system_dbusd_var_run_t)
+init_daemon_run_dir(system_dbusd_var_run_t, "dbus")
 
 ifdef(`enable_mcs',`
 	init_ranged_system_domain(system_dbusd_t, dbusd_exec_t, s0 - mcs_systemhigh)
@@ -44,45 +51,53 @@
 	init_ranged_system_domain(system_dbusd_t, dbusd_exec_t, s0 - mls_systemhigh)
 ')
 
-##############################
+########################################
 #
-# System bus local policy
+# Local policy
 #
 
-# dac_override: /var/run/dbus is owned by messagebus on Debian
-# cjp: dac_override should probably go in a distro_debian
-allow system_dbusd_t self:capability { dac_override setgid setpcap setuid };
+allow system_dbusd_t self:capability { sys_resource dac_override setgid setpcap setuid };
 dontaudit system_dbusd_t self:capability sys_tty_config;
-allow system_dbusd_t self:process { getattr getsched signal_perms setpgid getcap setcap };
+allow system_dbusd_t self:process { getattr getsched signal_perms setpgid getcap setcap setrlimit };
 allow system_dbusd_t self:fifo_file rw_fifo_file_perms;
 allow system_dbusd_t self:dbus { send_msg acquire_svc };
-allow system_dbusd_t self:unix_stream_socket { connectto create_stream_socket_perms connectto };
-allow system_dbusd_t self:unix_dgram_socket create_socket_perms;
-# Receive notifications of policy reloads and enforcing status changes.
+allow system_dbusd_t self:unix_stream_socket { accept connectto listen };
 allow system_dbusd_t self:netlink_selinux_socket { create bind read };
 
-can_exec(system_dbusd_t, dbusd_exec_t)
-
 allow system_dbusd_t dbusd_etc_t:dir list_dir_perms;
 read_files_pattern(system_dbusd_t, dbusd_etc_t, dbusd_etc_t)
 read_lnk_files_pattern(system_dbusd_t, dbusd_etc_t, dbusd_etc_t)
 
 manage_dirs_pattern(system_dbusd_t, system_dbusd_tmp_t, system_dbusd_tmp_t)
 manage_files_pattern(system_dbusd_t, system_dbusd_tmp_t, system_dbusd_tmp_t)
-files_tmp_filetrans(system_dbusd_t, system_dbusd_tmp_t, { file dir })
+files_tmp_filetrans(system_dbusd_t, system_dbusd_tmp_t, { dir file })
 
 read_files_pattern(system_dbusd_t, system_dbusd_var_lib_t, system_dbusd_var_lib_t)
 
+manage_dirs_pattern(system_dbusd_t, system_dbusd_var_run_t, system_dbusd_var_run_t)
 manage_files_pattern(system_dbusd_t, system_dbusd_var_run_t, system_dbusd_var_run_t)
 manage_sock_files_pattern(system_dbusd_t, system_dbusd_var_run_t, system_dbusd_var_run_t)
-files_pid_filetrans(system_dbusd_t, system_dbusd_var_run_t, file)
+files_pid_filetrans(system_dbusd_t, system_dbusd_var_run_t, { dir file })
+
+can_exec(system_dbusd_t, dbusd_exec_t)
 
 kernel_read_system_state(system_dbusd_t)
 kernel_read_kernel_sysctls(system_dbusd_t)
 
+corecmd_list_bin(system_dbusd_t)
+corecmd_read_bin_pipes(system_dbusd_t)
+corecmd_read_bin_sockets(system_dbusd_t)
+corecmd_exec_shell(system_dbusd_t)
+
 dev_read_urand(system_dbusd_t)
 dev_read_sysfs(system_dbusd_t)
 
+domain_use_interactive_fds(system_dbusd_t)
+domain_read_all_domains_state(system_dbusd_t)
+
+files_list_home(system_dbusd_t)
+files_read_usr_files(system_dbusd_t)
+
 fs_getattr_all_fs(system_dbusd_t)
 fs_list_inotifyfs(system_dbusd_t)
 fs_search_auto_mountpoints(system_dbusd_t)
@@ -107,16 +122,9 @@
 auth_use_nsswitch(system_dbusd_t)
 auth_read_pam_console_data(system_dbusd_t)
 
-corecmd_list_bin(system_dbusd_t)
-corecmd_read_bin_pipes(system_dbusd_t)
-corecmd_read_bin_sockets(system_dbusd_t)
-
-domain_use_interactive_fds(system_dbusd_t)
-domain_read_all_domains_state(system_dbusd_t)
-
-files_read_etc_files(system_dbusd_t)
-files_list_home(system_dbusd_t)
-files_read_usr_files(system_dbusd_t)
+init_use_fds(system_dbusd_t)
+init_use_script_ptys(system_dbusd_t)
+init_domtrans_script(system_dbusd_t)
 
 init_use_fds(system_dbusd_t)
 init_use_script_ptys(system_dbusd_t)
@@ -130,23 +138,26 @@
 
 seutil_read_config(system_dbusd_t)
 seutil_read_default_contexts(system_dbusd_t)
-seutil_sigchld_newrole(system_dbusd_t)
 
 userdom_dontaudit_use_unpriv_user_fds(system_dbusd_t)
 userdom_dontaudit_search_user_home_dirs(system_dbusd_t)
 
+ifdef(`distro_gentoo',`
+	optional_policy(`
+		cpufreqselector_dbus_chat(system_dbusd_t)
+	')
+')
+
 optional_policy(`
-	bind_domtrans(system_dbusd_t)
+	bluetooth_stream_connect(system_dbusd_t)
 ')
 
 optional_policy(`
-	policykit_dbus_chat(system_dbusd_t)
-	policykit_domtrans_auth(system_dbusd_t)
-	policykit_search_lib(system_dbusd_t)
+	policykit_read_lib(system_dbusd_t)
 ')
 
 optional_policy(`
-	sysnet_domtrans_dhcpc(system_dbusd_t)
+	seutil_sigchld_newrole(system_dbusd_t)
 ')
 
 optional_policy(`
@@ -155,7 +166,99 @@
 
 ########################################
 #
+# Common session bus local policy
+#
+
+allow session_bus_type self:capability2 block_suspend;
+dontaudit session_bus_type self:capability sys_resource;
+allow session_bus_type self:process { getattr sigkill signal };
+dontaudit session_bus_type self:process { ptrace setrlimit };
+allow session_bus_type self:file { getattr read write };
+allow session_bus_type self:fifo_file rw_fifo_file_perms;
+allow session_bus_type self:dbus { send_msg acquire_svc };
+allow session_bus_type self:unix_stream_socket { accept listen };
+allow session_bus_type self:tcp_socket { accept listen };
+allow session_bus_type self:netlink_selinux_socket create_socket_perms;
+
+allow session_bus_type dbusd_etc_t:dir list_dir_perms;
+read_files_pattern(session_bus_type, dbusd_etc_t, dbusd_etc_t)
+read_lnk_files_pattern(session_bus_type, dbusd_etc_t, dbusd_etc_t)
+
+manage_dirs_pattern(session_bus_type, session_dbusd_home_t, session_dbusd_home_t)
+manage_files_pattern(session_bus_type, session_dbusd_home_t, session_dbusd_home_t)
+userdom_user_home_dir_filetrans(session_bus_type, session_dbusd_home_t, dir, ".dbus")
+
+manage_dirs_pattern(session_bus_type, session_dbusd_tmp_t, session_dbusd_tmp_t)
+manage_files_pattern(session_bus_type, session_dbusd_tmp_t, session_dbusd_tmp_t)
+files_tmp_filetrans(session_bus_type, session_dbusd_tmp_t, { dir file })
+
+kernel_read_system_state(session_bus_type)
+kernel_read_kernel_sysctls(session_bus_type)
+
+corecmd_list_bin(session_bus_type)
+corecmd_read_bin_symlinks(session_bus_type)
+corecmd_read_bin_files(session_bus_type)
+corecmd_read_bin_pipes(session_bus_type)
+corecmd_read_bin_sockets(session_bus_type)
+
+corenet_all_recvfrom_unlabeled(session_bus_type)
+corenet_all_recvfrom_netlabel(session_bus_type)
+corenet_tcp_sendrecv_generic_if(session_bus_type)
+corenet_tcp_sendrecv_generic_node(session_bus_type)
+corenet_tcp_sendrecv_all_ports(session_bus_type)
+corenet_tcp_bind_generic_node(session_bus_type)
+
+corenet_sendrecv_all_server_packets(session_bus_type)
+corenet_tcp_bind_reserved_port(session_bus_type)
+
+dev_read_urand(session_bus_type)
+
+domain_read_all_domains_state(session_bus_type)
+domain_use_interactive_fds(session_bus_type)
+
+files_list_home(session_bus_type)
+files_read_usr_files(session_bus_type)
+files_dontaudit_search_var(session_bus_type)
+
+fs_getattr_romfs(session_bus_type)
+fs_getattr_xattr_fs(session_bus_type)
+fs_list_inotifyfs(session_bus_type)
+fs_dontaudit_list_nfs(session_bus_type)
+
+selinux_get_fs_mount(session_bus_type)
+selinux_validate_context(session_bus_type)
+selinux_compute_access_vector(session_bus_type)
+selinux_compute_create_context(session_bus_type)
+selinux_compute_relabel_context(session_bus_type)
+selinux_compute_user_contexts(session_bus_type)
+
+auth_read_pam_console_data(session_bus_type)
+
+logging_send_audit_msgs(session_bus_type)
+logging_send_syslog_msg(session_bus_type)
+
+miscfiles_read_localization(session_bus_type)
+
+seutil_read_config(session_bus_type)
+seutil_read_default_contexts(session_bus_type)
+
+term_use_all_terms(session_bus_type)
+
+ifdef(`distro_gentoo',`
+	optional_policy(`
+		hal_dbus_chat(session_bus_type)
+	')
+')
+
+optional_policy(`
+	xserver_use_xdm_fds(session_bus_type)
+	xserver_rw_xdm_pipes(session_bus_type)
+')
+
+########################################
+#
 # Unconfined access to this module
 #
 
-allow dbusd_unconfined session_bus_type:dbus all_dbus_perms;
+allow dbusd_unconfined { dbusd_session_bus_client dbusd_system_bus_client }:dbus send_msg;
+allow dbusd_unconfined { system_dbusd_t session_bus_type }:dbus all_dbus_perms;
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/dcc.fc refpolicy/policy/modules/contrib/dcc.fc
--- refpolicy/policy/modules/contrib/dcc.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/dcc.fc	2012-09-27 20:03:30.748126498 +0200
@@ -1,30 +1,26 @@
-/etc/dcc(/.*)?				gen_context(system_u:object_r:dcc_var_t,s0)
-/etc/dcc/dccifd			-s	gen_context(system_u:object_r:dccifd_var_run_t,s0)
-/etc/dcc/map			--	gen_context(system_u:object_r:dcc_client_map_t,s0)
+/etc/dcc(/.*)?	gen_context(system_u:object_r:dcc_var_t,s0)
+/etc/dcc/dccifd	-s	gen_context(system_u:object_r:dccifd_var_run_t,s0)
+/etc/dcc/map	--	gen_context(system_u:object_r:dcc_client_map_t,s0)
 
-/usr/bin/cdcc			--	gen_context(system_u:object_r:cdcc_exec_t,s0)
-/usr/bin/dccproc		--	gen_context(system_u:object_r:dcc_client_exec_t,s0)
+/usr/bin/cdcc	--	gen_context(system_u:object_r:cdcc_exec_t,s0)
+/usr/bin/dccproc	--	gen_context(system_u:object_r:dcc_client_exec_t,s0)
 
 /usr/libexec/dcc/dbclean	--	gen_context(system_u:object_r:dcc_dbclean_exec_t,s0)
-/usr/libexec/dcc/dccd		--	gen_context(system_u:object_r:dccd_exec_t,s0)
-/usr/libexec/dcc/dccifd		--	gen_context(system_u:object_r:dccifd_exec_t,s0)
-/usr/libexec/dcc/dccm		--	gen_context(system_u:object_r:dccm_exec_t,s0)
-
-ifdef(`distro_debian',`
-/usr/sbin/dbclean		--	gen_context(system_u:object_r:dcc_dbclean_exec_t,s0)
-/usr/sbin/dccd			--	gen_context(system_u:object_r:dccd_exec_t,s0)
-/usr/sbin/dccifd		--	gen_context(system_u:object_r:dccifd_exec_t,s0)
-/usr/sbin/dccm			--	gen_context(system_u:object_r:dccm_exec_t,s0)
-')
-
-/var/lib/dcc(/.*)?			gen_context(system_u:object_r:dcc_var_t,s0)
-/var/lib/dcc/map		--	gen_context(system_u:object_r:dcc_client_map_t,s0)
-
-/var/run/dcc(/.*)?			gen_context(system_u:object_r:dcc_var_run_t,s0)
-/var/run/dcc/map		--	gen_context(system_u:object_r:dcc_client_map_t,s0)
-/var/run/dcc/dccifd		-s	gen_context(system_u:object_r:dccifd_var_run_t,s0)
-
-ifdef(`distro_redhat',`
-/var/dcc(/.*)?				gen_context(system_u:object_r:dcc_var_t,s0)
-/var/dcc/map			--	gen_context(system_u:object_r:dcc_client_map_t,s0)
-')
+/usr/libexec/dcc/dccd	--	gen_context(system_u:object_r:dccd_exec_t,s0)
+/usr/libexec/dcc/dccifd	--	gen_context(system_u:object_r:dccifd_exec_t,s0)
+/usr/libexec/dcc/dccm	--	gen_context(system_u:object_r:dccm_exec_t,s0)
+
+/usr/sbin/dbclean	--	gen_context(system_u:object_r:dcc_dbclean_exec_t,s0)
+/usr/sbin/dccd	--	gen_context(system_u:object_r:dccd_exec_t,s0)
+/usr/sbin/dccifd	--	gen_context(system_u:object_r:dccifd_exec_t,s0)
+/usr/sbin/dccm	--	gen_context(system_u:object_r:dccm_exec_t,s0)
+
+/var/dcc(/.*)?	gen_context(system_u:object_r:dcc_var_t,s0)
+/var/dcc/map	--	gen_context(system_u:object_r:dcc_client_map_t,s0)
+
+/var/lib/dcc(/.*)?	gen_context(system_u:object_r:dcc_var_t,s0)
+/var/lib/dcc/map	--	gen_context(system_u:object_r:dcc_client_map_t,s0)
+
+/var/run/dcc(/.*)?	gen_context(system_u:object_r:dcc_var_run_t,s0)
+/var/run/dcc/map	--	gen_context(system_u:object_r:dcc_client_map_t,s0)
+/var/run/dcc/dccifd	-s	gen_context(system_u:object_r:dccifd_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/dcc.if refpolicy/policy/modules/contrib/dcc.if
--- refpolicy/policy/modules/contrib/dcc.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/dcc.if	2012-09-27 20:03:30.749126498 +0200
@@ -1,4 +1,4 @@
-## <summary>Distributed checksum clearinghouse spam filtering</summary>
+## <summary>Distributed checksum clearinghouse spam filtering.</summary>
 
 ########################################
 ## <summary>
@@ -22,7 +22,8 @@
 ########################################
 ## <summary>
 ##	Execute cdcc in the cdcc domain, and
-##	allow the specified role the cdcc domain.
+##	allow the specified role the
+##	cdcc domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -38,16 +39,17 @@
 #
 interface(`dcc_run_cdcc',`
 	gen_require(`
-		type cdcc_t;
+		attribute_role cdcc_roles;
 	')
 
 	dcc_domtrans_cdcc($1)
-	role $2 types cdcc_t;
+	roleattribute $2 cdcc_roles;
 ')
 
 ########################################
 ## <summary>
-##	Execute dcc_client in the dcc_client domain.
+##	Execute dcc client in the dcc
+##	client domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -66,7 +68,7 @@
 
 ########################################
 ## <summary>
-##	Send a signal to the dcc_client.
+##	Send generic signals to dcc client.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -84,8 +86,9 @@
 
 ########################################
 ## <summary>
-##	Execute dcc_client in the dcc_client domain, and
-##	allow the specified role the dcc_client domain.
+##	Execute dcc client in the dcc
+##	client domain, and allow the
+##	specified role the dcc client domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -101,16 +104,16 @@
 #
 interface(`dcc_run_client',`
 	gen_require(`
-		type dcc_client_t;
+		attribute_role dcc_client_roles;
 	')
 
 	dcc_domtrans_client($1)
-	role $2 types dcc_client_t;
+	roleattribute $2 dcc_client_roles;
 ')
 
 ########################################
 ## <summary>
-##	Execute dbclean in the dcc_dbclean domain.
+##	Execute dbclean in the dcc dbclean domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -129,8 +132,9 @@
 
 ########################################
 ## <summary>
-##	Execute dbclean in the dcc_dbclean domain, and
-##	allow the specified role the dcc_dbclean domain.
+##	Execute dbclean in the dcc dbclean
+##	domain, and allow the specified
+##	role the dcc dbclean domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -146,16 +150,17 @@
 #
 interface(`dcc_run_dbclean',`
 	gen_require(`
-		type dcc_dbclean_t;
+		attribute_role dcc_dbclean_roles;
 	')
 
 	dcc_domtrans_dbclean($1)
-	role $2 types dcc_dbclean_t;
+	roleattribute $2 dcc_dbclean_roles;
 ')
 
 ########################################
 ## <summary>
-##	Connect to dccifd over a unix domain stream socket.
+##	Connect to dccifd over a unix
+##	domain stream socket.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/dcc.te refpolicy/policy/modules/contrib/dcc.te
--- refpolicy/policy/modules/contrib/dcc.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/dcc.te	2012-09-27 20:03:30.749126498 +0200
@@ -1,14 +1,23 @@
-policy_module(dcc, 1.11.0)
+policy_module(dcc, 1.11.1)
 
 ########################################
 #
 # Declarations
 #
 
+attribute_role cdcc_roles;
+roleattribute system_r cdcc_roles;
+
+attribute_role dcc_client_roles;
+roleattribute system_r dcc_client_roles;
+
+attribute_role dcc_dbclean_roles;
+roleattribute system_r dcc_dbclean_roles;
+
 type cdcc_t;
 type cdcc_exec_t;
 application_domain(cdcc_t, cdcc_exec_t)
-role system_r types cdcc_t;
+role cdcc_roles types cdcc_t;
 
 type cdcc_tmp_t;
 files_tmp_file(cdcc_tmp_t)
@@ -16,7 +25,7 @@
 type dcc_client_t;
 type dcc_client_exec_t;
 application_domain(dcc_client_t, dcc_client_exec_t)
-role system_r types dcc_client_t;
+role dcc_client_roles types dcc_client_t;
 
 type dcc_client_map_t;
 files_type(dcc_client_map_t)
@@ -27,7 +36,7 @@
 type dcc_dbclean_t;
 type dcc_dbclean_exec_t;
 application_domain(dcc_dbclean_t, dcc_dbclean_exec_t)
-role system_r types dcc_dbclean_t;
+role dcc_dbclean_roles types dcc_dbclean_t;
 
 type dcc_dbclean_tmp_t;
 files_tmp_file(dcc_dbclean_tmp_t)
@@ -68,21 +77,12 @@
 type dccm_var_run_t;
 files_pid_file(dccm_var_run_t)
 
-# NOTE: DCC has writeable files in /etc/dcc that should probably be in
-# /var/lib/dcc.  For now this policy supports both directories being
-# writable.
-
-# cjp: dccifd and dccm should be merged, as
-# they have the same rules.
-
 ########################################
 #
-# dcc daemon controller local policy
+# Daemon controller local policy
 #
 
 allow cdcc_t self:capability { setuid setgid };
-allow cdcc_t self:unix_dgram_socket create_socket_perms;
-allow cdcc_t self:udp_socket create_socket_perms;
 
 manage_dirs_pattern(cdcc_t, cdcc_tmp_t, cdcc_tmp_t)
 manage_files_pattern(cdcc_t, cdcc_tmp_t, cdcc_tmp_t)
@@ -90,18 +90,10 @@
 
 allow cdcc_t dcc_client_map_t:file rw_file_perms;
 
-# Access files in /var/dcc. The map file can be updated
 allow cdcc_t dcc_var_t:dir list_dir_perms;
 read_files_pattern(cdcc_t, dcc_var_t, dcc_var_t)
 read_lnk_files_pattern(cdcc_t, dcc_var_t, dcc_var_t)
 
-corenet_all_recvfrom_unlabeled(cdcc_t)
-corenet_all_recvfrom_netlabel(cdcc_t)
-corenet_udp_sendrecv_generic_if(cdcc_t)
-corenet_udp_sendrecv_generic_node(cdcc_t)
-corenet_udp_sendrecv_all_ports(cdcc_t)
-
-files_read_etc_files(cdcc_t)
 files_read_etc_runtime_files(cdcc_t)
 
 auth_use_nsswitch(cdcc_t)
@@ -114,12 +106,10 @@
 
 ########################################
 #
-# dcc procmail interface local policy
+# Procmail interface local policy
 #
 
 allow dcc_client_t self:capability { setuid setgid };
-allow dcc_client_t self:unix_dgram_socket create_socket_perms;
-allow dcc_client_t self:udp_socket create_socket_perms;
 
 allow dcc_client_t dcc_client_map_t:file rw_file_perms;
 
@@ -127,21 +117,12 @@
 manage_files_pattern(dcc_client_t, dcc_client_tmp_t, dcc_client_tmp_t)
 files_tmp_filetrans(dcc_client_t, dcc_client_tmp_t, { file dir })
 
-# Access files in /var/dcc. The map file can be updated
 allow dcc_client_t dcc_var_t:dir list_dir_perms;
 manage_files_pattern(dcc_client_t, dcc_var_t, dcc_var_t)
 read_lnk_files_pattern(dcc_client_t, dcc_var_t, dcc_var_t)
 
 kernel_read_system_state(dcc_client_t)
 
-corenet_all_recvfrom_unlabeled(dcc_client_t)
-corenet_all_recvfrom_netlabel(dcc_client_t)
-corenet_udp_sendrecv_generic_if(dcc_client_t)
-corenet_udp_sendrecv_generic_node(dcc_client_t)
-corenet_udp_sendrecv_all_ports(dcc_client_t)
-corenet_udp_bind_generic_node(dcc_client_t)
-
-files_read_etc_files(dcc_client_t)
 files_read_etc_runtime_files(dcc_client_t)
 
 fs_getattr_all_fs(dcc_client_t)
@@ -164,12 +145,9 @@
 
 ########################################
 #
-# Database cleanup tool local policy
+# Database cleanup local policy
 #
 
-allow dcc_dbclean_t self:unix_dgram_socket create_socket_perms;
-allow dcc_dbclean_t self:udp_socket create_socket_perms;
-
 allow dcc_dbclean_t dcc_client_map_t:file rw_file_perms;
 
 manage_dirs_pattern(dcc_dbclean_t, dcc_dbclean_tmp_t, dcc_dbclean_tmp_t)
@@ -182,13 +160,6 @@
 
 kernel_read_system_state(dcc_dbclean_t)
 
-corenet_all_recvfrom_unlabeled(dcc_dbclean_t)
-corenet_all_recvfrom_netlabel(dcc_dbclean_t)
-corenet_udp_sendrecv_generic_if(dcc_dbclean_t)
-corenet_udp_sendrecv_generic_node(dcc_dbclean_t)
-corenet_udp_sendrecv_all_ports(dcc_dbclean_t)
-
-files_read_etc_files(dcc_dbclean_t)
 files_read_etc_runtime_files(dcc_dbclean_t)
 
 auth_use_nsswitch(dcc_dbclean_t)
@@ -201,28 +172,21 @@
 
 ########################################
 #
-# Server daemon local policy
+# Server local policy
 #
 
 allow dccd_t self:capability net_admin;
 dontaudit dccd_t self:capability sys_tty_config;
 allow dccd_t self:process signal_perms;
-allow dccd_t self:unix_stream_socket create_socket_perms;
-allow dccd_t self:netlink_route_socket { bind create getattr nlmsg_read read write };
-allow dccd_t self:udp_socket create_socket_perms;
 
 allow dccd_t dcc_client_map_t:file rw_file_perms;
 
-# Access files in /var/dcc. The map file can be updated
 allow dccd_t dcc_var_t:dir list_dir_perms;
 read_files_pattern(dccd_t, dcc_var_t, dcc_var_t)
 read_lnk_files_pattern(dccd_t, dcc_var_t, dcc_var_t)
 
-# Runs the dbclean program
 domtrans_pattern(dccd_t, dcc_dbclean_exec_t, dcc_dbclean_t)
-corecmd_search_bin(dccd_t)
 
-# Updating dcc_db, flod, ...
 manage_dirs_pattern(dccd_t, dcc_var_t, dcc_var_t)
 manage_files_pattern(dccd_t, dcc_var_t, dcc_var_t)
 manage_lnk_files_pattern(dccd_t, dcc_var_t, dcc_var_t)
@@ -244,14 +208,16 @@
 corenet_udp_sendrecv_generic_node(dccd_t)
 corenet_udp_sendrecv_all_ports(dccd_t)
 corenet_udp_bind_generic_node(dccd_t)
+
 corenet_udp_bind_dcc_port(dccd_t)
 corenet_sendrecv_dcc_server_packets(dccd_t)
 
+corecmd_search_bin(dccd_t)
+
 dev_read_sysfs(dccd_t)
 
 domain_use_interactive_fds(dccd_t)
 
-files_read_etc_files(dccd_t)
 files_read_etc_runtime_files(dccd_t)
 
 fs_getattr_all_fs(dccd_t)
@@ -281,13 +247,10 @@
 
 dontaudit dccifd_t self:capability sys_tty_config;
 allow dccifd_t self:process signal_perms;
-allow dccifd_t self:unix_stream_socket create_stream_socket_perms;
-allow dccifd_t self:unix_dgram_socket create_socket_perms;
-allow dccifd_t self:udp_socket create_socket_perms;
+allow dccifd_t self:unix_stream_socket { accept listen };
 
 allow dccifd_t dcc_client_map_t:file rw_file_perms;
 
-# Updating dcc_db, flod, ...
 manage_dirs_pattern(dccifd_t, dcc_var_t, dcc_var_t)
 manage_files_pattern(dccifd_t, dcc_var_t, dcc_var_t)
 manage_lnk_files_pattern(dccifd_t, dcc_var_t, dcc_var_t)
@@ -306,17 +269,10 @@
 kernel_read_system_state(dccifd_t)
 kernel_read_kernel_sysctls(dccifd_t)
 
-corenet_all_recvfrom_unlabeled(dccifd_t)
-corenet_all_recvfrom_netlabel(dccifd_t)
-corenet_udp_sendrecv_generic_if(dccifd_t)
-corenet_udp_sendrecv_generic_node(dccifd_t)
-corenet_udp_sendrecv_all_ports(dccifd_t)
-
 dev_read_sysfs(dccifd_t)
 
 domain_use_interactive_fds(dccifd_t)
 
-files_read_etc_files(dccifd_t)
 files_read_etc_runtime_files(dccifd_t)
 
 fs_getattr_all_fs(dccifd_t)
@@ -341,14 +297,12 @@
 
 ########################################
 #
-# sendmail milter client local policy
+# Sendmail milter client local policy
 #
 
 dontaudit dccm_t self:capability sys_tty_config;
 allow dccm_t self:process signal_perms;
-allow dccm_t self:unix_stream_socket create_stream_socket_perms;
-allow dccm_t self:unix_dgram_socket create_socket_perms;
-allow dccm_t self:udp_socket create_socket_perms;
+allow dccm_t self:unix_stream_socket { accept listen };
 
 allow dccm_t dcc_client_map_t:file rw_file_perms;
 
@@ -370,17 +324,10 @@
 kernel_read_system_state(dccm_t)
 kernel_read_kernel_sysctls(dccm_t)
 
-corenet_all_recvfrom_unlabeled(dccm_t)
-corenet_all_recvfrom_netlabel(dccm_t)
-corenet_udp_sendrecv_generic_if(dccm_t)
-corenet_udp_sendrecv_generic_node(dccm_t)
-corenet_udp_sendrecv_all_ports(dccm_t)
-
 dev_read_sysfs(dccm_t)
 
 domain_use_interactive_fds(dccm_t)
 
-files_read_etc_files(dccm_t)
 files_read_etc_runtime_files(dccm_t)
 
 fs_getattr_all_fs(dccm_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/ddclient.fc refpolicy/policy/modules/contrib/ddclient.fc
--- refpolicy/policy/modules/contrib/ddclient.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/ddclient.fc	2012-09-28 19:39:36.193016281 +0200
@@ -1,12 +1,16 @@
 /etc/ddclient\.conf	--	gen_context(system_u:object_r:ddclient_etc_t,s0)
 /etc/ddtcd\.conf	--	gen_context(system_u:object_r:ddclient_etc_t,s0)
-/etc/rc\.d/init\.d/ddclient --	gen_context(system_u:object_r:ddclient_initrc_exec_t,s0)
+
+/etc/rc\.d/init\.d/ddclient	--	gen_context(system_u:object_r:ddclient_initrc_exec_t,s0)
 
 /usr/sbin/ddclient	--	gen_context(system_u:object_r:ddclient_exec_t,s0)
-/usr/sbin/ddtcd		--	gen_context(system_u:object_r:ddclient_exec_t,s0)
+/usr/sbin/ddtcd	--	gen_context(system_u:object_r:ddclient_exec_t,s0)
 
 /var/cache/ddclient(/.*)?	gen_context(system_u:object_r:ddclient_var_t,s0)
+
 /var/lib/ddt-client(/.*)?	gen_context(system_u:object_r:ddclient_var_lib_t,s0)
+
 /var/log/ddtcd\.log.*	--	gen_context(system_u:object_r:ddclient_log_t,s0)
+
 /var/run/ddclient\.pid	--	gen_context(system_u:object_r:ddclient_var_run_t,s0)
 /var/run/ddtcd\.pid	--	gen_context(system_u:object_r:ddclient_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/ddclient.if refpolicy/policy/modules/contrib/ddclient.if
--- refpolicy/policy/modules/contrib/ddclient.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/ddclient.if	2012-09-28 19:39:36.193016281 +0200
@@ -1,4 +1,4 @@
-## <summary>Update dynamic IP address at DynDNS.org</summary>
+## <summary>Update dynamic IP address at DynDNS.org.</summary>
 
 #######################################
 ## <summary>
@@ -21,7 +21,9 @@
 
 ########################################
 ## <summary>
-##	 Execute ddclient daemon on behalf of a user or staff type.
+##	Execute ddclient in the ddclient
+##	domain, and allow the specified
+##	role the ddclient domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -37,17 +39,17 @@
 #
 interface(`ddclient_run',`
 	gen_require(`
-		type ddclient_t;
+		attribute_role ddclient_roles;
 	')
 
 	ddclient_domtrans($1)
-	role $2 types ddclient_t;
+	roleattribute $2 ddclient_roles;
 ')
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate
-##	an ddclient environment
+##	All of the rules required to
+##	administrate an ddclient environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -56,7 +58,7 @@
 ## </param>
 ## <param name="role">
 ##	<summary>
-##	The role to be allowed to manage the ddclient domain.
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <rolecap/>
@@ -64,7 +66,7 @@
 interface(`ddclient_admin',`
 	gen_require(`
 		type ddclient_t, ddclient_etc_t, ddclient_log_t;
-		type ddclient_var_t, ddclient_var_lib_t;
+		type ddclient_var_t, ddclient_var_lib_t, ddclient_tmp_t;
 		type ddclient_var_run_t, ddclient_initrc_exec_t;
 	')
 
@@ -90,4 +92,7 @@
 
 	files_list_pids($1)
 	admin_pattern($1, ddclient_var_run_t)
+
+	files_list_tmp($1)
+	admin_pattern($1, ddclient_tmp_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/ddclient.te refpolicy/policy/modules/contrib/ddclient.te
--- refpolicy/policy/modules/contrib/ddclient.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/ddclient.te	2012-10-06 19:02:30.945741426 +0200
@@ -1,13 +1,16 @@
-policy_module(ddclient, 1.9.0)
+policy_module(ddclient, 1.9.2)
 
 ########################################
 #
 # Declarations
 #
 
+attribute_role ddclient_roles;
+
 type ddclient_t;
 type ddclient_exec_t;
 init_daemon_domain(ddclient_t, ddclient_exec_t)
+role ddclient_roles types ddclient_t;
 
 type ddclient_etc_t;
 files_config_file(ddclient_etc_t)
@@ -18,6 +21,9 @@
 type ddclient_log_t;
 logging_log_file(ddclient_log_t)
 
+type ddclient_tmp_t;
+files_tmp_file(ddclient_tmp_t)
+
 type ddclient_var_t;
 files_type(ddclient_var_t)
 
@@ -35,33 +41,36 @@
 dontaudit ddclient_t self:capability sys_tty_config;
 allow ddclient_t self:process signal_perms;
 allow ddclient_t self:fifo_file rw_fifo_file_perms;
-allow ddclient_t self:tcp_socket create_socket_perms;
-allow ddclient_t self:udp_socket create_socket_perms;
 
-allow ddclient_t ddclient_etc_t:file read_file_perms;
+read_files_pattern(ddclient_t, ddclient_etc_t, ddclient_etc_t)
+setattr_files_pattern(ddclient_t, ddclient_etc_t, ddclient_etc_t)
 
-allow ddclient_t ddclient_log_t:file manage_file_perms;
+allow ddclient_t ddclient_log_t:file append_file_perms;
+allow ddclient_t ddclient_log_t:file create_file_perms;
+allow ddclient_t ddclient_log_t:file setattr_file_perms;
 logging_log_filetrans(ddclient_t, ddclient_log_t, file)
 
+manage_files_pattern(ddclient_t, ddclient_tmp_t, ddclient_tmp_t)
+files_tmp_filetrans(ddclient_t, ddclient_tmp_t, file)
+
 manage_dirs_pattern(ddclient_t, ddclient_var_t, ddclient_var_t)
 manage_files_pattern(ddclient_t, ddclient_var_t, ddclient_var_t)
 manage_lnk_files_pattern(ddclient_t, ddclient_var_t, ddclient_var_t)
 manage_fifo_files_pattern(ddclient_t, ddclient_var_t, ddclient_var_t)
 manage_sock_files_pattern(ddclient_t, ddclient_var_t, ddclient_var_t)
-files_var_filetrans(ddclient_t, ddclient_var_t, { file lnk_file sock_file fifo_file })
 
 manage_files_pattern(ddclient_t, ddclient_var_lib_t, ddclient_var_lib_t)
-files_var_lib_filetrans(ddclient_t, ddclient_var_lib_t, file)
 
 manage_files_pattern(ddclient_t, ddclient_var_run_t, ddclient_var_run_t)
 files_pid_filetrans(ddclient_t, ddclient_var_run_t, file)
 
-kernel_read_system_state(ddclient_t)
-kernel_read_network_state(ddclient_t)
-kernel_read_software_raid_state(ddclient_t)
 kernel_getattr_core_if(ddclient_t)
 kernel_getattr_message_if(ddclient_t)
 kernel_read_kernel_sysctls(ddclient_t)
+kernel_read_network_state(ddclient_t)
+kernel_read_software_raid_state(ddclient_t)
+kernel_read_system_state(ddclient_t)
+kernel_search_network_sysctl(ddclient_t)
 
 corecmd_exec_shell(ddclient_t)
 corecmd_exec_bin(ddclient_t)
@@ -74,8 +83,9 @@
 corenet_udp_sendrecv_generic_node(ddclient_t)
 corenet_tcp_sendrecv_all_ports(ddclient_t)
 corenet_udp_sendrecv_all_ports(ddclient_t)
-corenet_tcp_connect_all_ports(ddclient_t)
+
 corenet_sendrecv_all_client_packets(ddclient_t)
+corenet_tcp_connect_all_ports(ddclient_t)
 
 dev_read_sysfs(ddclient_t)
 dev_read_urand(ddclient_t)
@@ -94,7 +104,7 @@
 miscfiles_read_localization(ddclient_t)
 
 sysnet_exec_ifconfig(ddclient_t)
-sysnet_read_config(ddclient_t)
+sysnet_dns_name_resolve(ddclient_t)
 
 userdom_dontaudit_use_unpriv_user_fds(ddclient_t)
 userdom_dontaudit_search_user_home_dirs(ddclient_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/ddcprobe.fc refpolicy/policy/modules/contrib/ddcprobe.fc
--- refpolicy/policy/modules/contrib/ddcprobe.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/ddcprobe.fc	2012-09-28 19:40:06.157016964 +0200
@@ -1,4 +1 @@
-#
-# /usr
-#
 /usr/sbin/ddcprobe	--	gen_context(system_u:object_r:ddcprobe_exec_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/ddcprobe.if refpolicy/policy/modules/contrib/ddcprobe.if
--- refpolicy/policy/modules/contrib/ddcprobe.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/ddcprobe.if	2012-09-28 19:40:06.170016965 +0200
@@ -1,4 +1,4 @@
-## <summary>ddcprobe retrieves monitor and graphics card information</summary>
+## <summary>ddcprobe retrieves monitor and graphics card information.</summary>
 
 ########################################
 ## <summary>
@@ -15,13 +15,15 @@
 		type ddcprobe_t, ddcprobe_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, ddcprobe_exec_t, ddcprobe_t)
 ')
 
 ########################################
 ## <summary>
-##	Execute ddcprobe in the ddcprobe domain, and
-##	allow the specified role the ddcprobe domain.
+##	Execute ddcprobe in the ddcprobe
+##	domain, and allow the specified
+##	role the ddcprobe domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -30,16 +32,16 @@
 ## </param>
 ## <param name="role">
 ##	<summary>
-##	Role to be authenticated for ddcprobe domain.
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <rolecap/>
 #
 interface(`ddcprobe_run',`
 	gen_require(`
-		type ddcprobe_t;
+		attribute_role ddcprobe_roles;
 	')
 
 	ddcprobe_domtrans($1)
-	role $2 types ddcprobe_t;
+	roleattribute $2 ddcprobe_roles;
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/ddcprobe.te refpolicy/policy/modules/contrib/ddcprobe.te
--- refpolicy/policy/modules/contrib/ddcprobe.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/ddcprobe.te	2012-09-28 19:40:27.631017476 +0200
@@ -1,14 +1,17 @@
-policy_module(ddcprobe, 1.2.0)
+policy_module(ddcprobe, 1.2.1)
 
 ########################################
 #
 # Declarations
 #
 
+attribute_role ddcprobe_roles;
+roleattribute system_r ddcprobe_roles;
+
 type ddcprobe_t;
 type ddcprobe_exec_t;
 application_domain(ddcprobe_t, ddcprobe_exec_t)
-role system_r types ddcprobe_t;
+role ddcprobe_roles types ddcprobe_t;
 
 ########################################
 #
@@ -47,5 +50,6 @@
 userdom_use_user_terminals(ddcprobe_t)
 userdom_use_all_users_fds(ddcprobe_t)
 
-#reh why? this does not seem even necessary to function properly
-kudzu_getattr_exec_files(ddcprobe_t)
+optional_policy(`
+	kudzu_getattr_exec_files(ddcprobe_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/denyhosts.fc refpolicy/policy/modules/contrib/denyhosts.fc
--- refpolicy/policy/modules/contrib/denyhosts.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/denyhosts.fc	2012-09-28 19:41:06.358018362 +0200
@@ -1,7 +1,9 @@
 /etc/rc\.d/init\.d/denyhosts	--	gen_context(system_u:object_r:denyhosts_initrc_exec_t,s0)
 
-/usr/bin/denyhosts\.py		--	gen_context(system_u:object_r:denyhosts_exec_t,s0)
+/usr/bin/denyhosts\.py	--	gen_context(system_u:object_r:denyhosts_exec_t,s0)
+
+/var/lib/denyhosts(/.*)?	gen_context(system_u:object_r:denyhosts_var_lib_t,s0)
 
-/var/lib/denyhosts(/.*)?		gen_context(system_u:object_r:denyhosts_var_lib_t,s0)
 /var/lock/subsys/denyhosts	--	gen_context(system_u:object_r:denyhosts_var_lock_t,s0)
-/var/log/denyhosts(/.*)?		gen_context(system_u:object_r:denyhosts_var_log_t,s0)
+
+/var/log/denyhosts(/.*)?	gen_context(system_u:object_r:denyhosts_var_log_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/denyhosts.if refpolicy/policy/modules/contrib/denyhosts.if
--- refpolicy/policy/modules/contrib/denyhosts.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/denyhosts.if	2012-09-28 19:41:06.359018362 +0200
@@ -1,12 +1,4 @@
-## <summary>DenyHosts SSH dictionary attack mitigation</summary>
-## <desc>
-##	<p>
-##	DenyHosts is a script intended to be run by Linux
-##	system administrators to help thwart SSH server attacks
-##	(also known as dictionary based attacks and brute force
-##	attacks).
-##	</p>
-## </desc>
+## <summary>SSH dictionary attack mitigation.</summary>
 
 ########################################
 ## <summary>
@@ -18,17 +10,19 @@
 ## </summary>
 ## </param>
 #
-interface(`denyhosts_domtrans', `
+interface(`denyhosts_domtrans',`
 	gen_require(`
 		type denyhosts_t, denyhosts_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, denyhosts_exec_t, denyhosts_t)
 ')
 
 ########################################
 ## <summary>
-##	Execute denyhost server in the denyhost domain.
+##	Execute denyhost server in the
+##	denyhost domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -36,7 +30,7 @@
 ##	</summary>
 ## </param>
 #
-interface(`denyhosts_initrc_domtrans', `
+interface(`denyhosts_initrc_domtrans',`
 	gen_require(`
 		type denyhosts_initrc_exec_t;
 	')
@@ -46,8 +40,8 @@
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate
-##	an denyhosts environment.
+##	All of the rules required to
+##	administrate an denyhosts environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -60,7 +54,7 @@
 ##	</summary>
 ## </param>
 #
-interface(`denyhosts_admin', `
+interface(`denyhosts_admin',`
 	gen_require(`
 		type denyhosts_t, denyhosts_var_lib_t, denyhosts_var_lock_t;
 		type denyhosts_var_log_t, denyhosts_initrc_exec_t;
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/denyhosts.te refpolicy/policy/modules/contrib/denyhosts.te
--- refpolicy/policy/modules/contrib/denyhosts.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/denyhosts.te	2012-10-06 19:02:40.254741446 +0200
@@ -1,8 +1,8 @@
-policy_module(denyhosts, 1.0.0)
+policy_module(denyhosts, 1.0.2)
 
 ########################################
 #
-# DenyHosts personal declarations.
+# Declarations
 #
 
 type denyhosts_t;
@@ -23,15 +23,14 @@
 
 ########################################
 #
-# DenyHosts personal policy.
+# Local policy
 #
 
-allow denyhosts_t self:netlink_route_socket create_netlink_socket_perms;
-allow denyhosts_t self:tcp_socket create_socket_perms;
-allow denyhosts_t self:udp_socket create_socket_perms;
+allow denyhosts_t self:capability sys_tty_config;
+allow denyhosts_t self:fifo_file rw_fifo_file_perms;
+allow denyhosts_t self:netlink_route_socket nlmsg_write;
 
 manage_files_pattern(denyhosts_t, denyhosts_var_lib_t, denyhosts_var_lib_t)
-files_var_lib_filetrans(denyhosts_t, denyhosts_var_lib_t, file)
 
 manage_dirs_pattern(denyhosts_t, denyhosts_var_lock_t, denyhosts_var_lock_t)
 manage_files_pattern(denyhosts_t, denyhosts_var_lock_t, denyhosts_var_lock_t)
@@ -43,27 +42,29 @@
 setattr_files_pattern(denyhosts_t, denyhosts_var_log_t, denyhosts_var_log_t)
 logging_log_filetrans(denyhosts_t, denyhosts_var_log_t, file)
 
+kernel_read_network_state(denyhosts_t)
 kernel_read_system_state(denyhosts_t)
 
 corecmd_exec_bin(denyhosts_t)
+corecmd_exec_shell(denyhosts_t)
 
 corenet_all_recvfrom_unlabeled(denyhosts_t)
 corenet_all_recvfrom_netlabel(denyhosts_t)
 corenet_tcp_sendrecv_generic_if(denyhosts_t)
 corenet_tcp_sendrecv_generic_node(denyhosts_t)
-corenet_tcp_bind_generic_node(denyhosts_t)
-corenet_tcp_connect_smtp_port(denyhosts_t)
+
 corenet_sendrecv_smtp_client_packets(denyhosts_t)
+corenet_tcp_connect_smtp_port(denyhosts_t)
+corenet_tcp_sendrecv_smtp_port(denyhosts_t)
 
 dev_read_urand(denyhosts_t)
 
-files_read_etc_files(denyhosts_t)
-
-# /var/log/secure
 logging_read_generic_logs(denyhosts_t)
+logging_send_syslog_msg(denyhosts_t)
 
 miscfiles_read_localization(denyhosts_t)
 
+sysnet_dns_name_resolve(denyhosts_t)
 sysnet_manage_config(denyhosts_t)
 sysnet_etc_filetrans_config(denyhosts_t)
 
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/devicekit.fc refpolicy/policy/modules/contrib/devicekit.fc
--- refpolicy/policy/modules/contrib/devicekit.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/devicekit.fc	2012-09-28 19:41:35.369019031 +0200
@@ -1,20 +1,26 @@
+/lib/udev/udisks-part-id	--	gen_context(system_u:object_r:devicekit_disk_exec_t,s0)
+/lib/udisks2/udisksd	--	gen_context(system_u:object_r:devicekit_disk_exec_t,s0)
+
+/usr/lib/udev/udisks-part-id	--	gen_context(system_u:object_r:devicekit_disk_exec_t,s0)
+/usr/lib/udisks2/udisksd	--	gen_context(system_u:object_r:devicekit_disk_exec_t,s0)
 /usr/lib/udisks/udisks-daemon	--	gen_context(system_u:object_r:devicekit_disk_exec_t,s0)
+/usr/lib/upower/upowerd	--	gen_context(system_u:object_r:devicekit_power_exec_t,s0)
 
 /usr/libexec/devkit-daemon	--	gen_context(system_u:object_r:devicekit_exec_t,s0)
-/usr/libexec/devkit-disks-daemon --	gen_context(system_u:object_r:devicekit_disk_exec_t,s0)
-/usr/libexec/devkit-power-daemon --	gen_context(system_u:object_r:devicekit_power_exec_t,s0)
+/usr/libexec/devkit-disks-daemon	--	gen_context(system_u:object_r:devicekit_disk_exec_t,s0)
+/usr/libexec/devkit-power-daemon	--	gen_context(system_u:object_r:devicekit_power_exec_t,s0)
 /usr/libexec/udisks-daemon	--	gen_context(system_u:object_r:devicekit_disk_exec_t,s0)
-/usr/libexec/upowerd		--	gen_context(system_u:object_r:devicekit_power_exec_t,s0)
+/usr/libexec/upowerd	--	gen_context(system_u:object_r:devicekit_power_exec_t,s0)
 
-ifdef(`distro_debian',`
-/usr/lib/upower/upowerd		--	gen_context(system_u:object_r:devicekit_power_exec_t,s0)
-')
+/var/lib/DeviceKit-.*	gen_context(system_u:object_r:devicekit_var_lib_t,s0)
+/var/lib/upower(/.*)?	gen_context(system_u:object_r:devicekit_var_lib_t,s0)
+/var/lib/udisks.*	gen_context(system_u:object_r:devicekit_var_lib_t,s0)
 
-/var/lib/DeviceKit-.*			gen_context(system_u:object_r:devicekit_var_lib_t,s0)
-/var/lib/upower(/.*)?			gen_context(system_u:object_r:devicekit_var_lib_t,s0)
-/var/lib/udisks(/.*)?			gen_context(system_u:object_r:devicekit_var_lib_t,s0)
+/var/log/pm-powersave\.log.*	--	gen_context(system_u:object_r:devicekit_var_log_t,s0)
+/var/log/pm-suspend\.log.*	--	gen_context(system_u:object_r:devicekit_var_log_t,s0)
 
-/var/run/devkit(/.*)?			gen_context(system_u:object_r:devicekit_var_run_t,s0)
-/var/run/DeviceKit-disks(/.*)?		gen_context(system_u:object_r:devicekit_var_run_t,s0)
-/var/run/udisks(/.*)?			gen_context(system_u:object_r:devicekit_var_run_t,s0)
-/var/run/upower(/.*)?			gen_context(system_u:object_r:devicekit_var_run_t,s0)
+/var/run/devkit(/.*)?	gen_context(system_u:object_r:devicekit_var_run_t,s0)
+/var/run/DeviceKit-disks(/.*)?	gen_context(system_u:object_r:devicekit_var_run_t,s0)
+/var/run/pm-utils(/.*)?	gen_context(system_u:object_r:devicekit_var_run_t,s0)
+/var/run/udisks.*	gen_context(system_u:object_r:devicekit_var_run_t,s0)
+/var/run/upower(/.*)?	gen_context(system_u:object_r:devicekit_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/devicekit.if refpolicy/policy/modules/contrib/devicekit.if
--- refpolicy/policy/modules/contrib/devicekit.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/devicekit.if	2012-09-28 19:41:35.388019029 +0200
@@ -1,4 +1,4 @@
-## <summary>Devicekit modular hardware abstraction layer</summary>
+## <summary>Devicekit modular hardware abstraction layer.</summary>
 
 ########################################
 ## <summary>
@@ -15,6 +15,7 @@
 		type devicekit_t, devicekit_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, devicekit_exec_t, devicekit_t)
 ')
 
@@ -31,10 +32,11 @@
 #
 interface(`devicekit_dgram_send',`
 	gen_require(`
-		type devicekit_t;
+		type devicekit_t, devicekit_var_run_t;
 	')
 
-	allow $1 devicekit_t:unix_dgram_socket sendto;
+	files_search_pids($1)
+	dgram_send_pattern($1, devicekit_var_run_t, devicekit_var_run_t, devicekit_t)
 ')
 
 ########################################
@@ -81,7 +83,7 @@
 
 ########################################
 ## <summary>
-##	Send signal devicekit power
+##	Send generic signals to devicekit power.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -120,6 +122,45 @@
 
 ########################################
 ## <summary>
+##	Create, read, write, and delete
+##	devicekit log files.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`devicekit_manage_log_files',`
+	gen_require(`
+		type devicekit_var_log_t;
+	')
+
+	logging_search_logs($1)
+	manage_files_pattern($1, devicekit_var_log_t, devicekit_var_log_t)
+')
+
+########################################
+## <summary>
+##	Relabel devicekit log files.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`devicekit_relabel_log_files',`
+	gen_require(`
+		type devicekit_var_log_t;
+	')
+
+	logging_search_logs($1)
+	relabel_files_pattern($1, devicekit_var_log_t, devicekit_var_log_t)
+')
+
+########################################
+## <summary>
 ##	Read devicekit PID files.
 ## </summary>
 ## <param name="domain">
@@ -139,22 +180,37 @@
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate
-##	an devicekit environment
+##	Create, read, write, and delete
+##	devicekit PID files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
 ##	Domain allowed access.
 ##	</summary>
 ## </param>
-## <param name="role">
+#
+interface(`devicekit_manage_pid_files',`
+	gen_require(`
+		type devicekit_var_run_t;
+	')
+
+	files_search_pids($1)
+	manage_files_pattern($1, devicekit_var_run_t, devicekit_var_run_t)
+')
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an devicekit environment.
+## </summary>
+## <param name="domain">
 ##	<summary>
-##	The role to be allowed to manage the devicekit domain.
+##	Domain allowed access.
 ##	</summary>
 ## </param>
-## <param name="terminal">
+## <param name="role">
 ##	<summary>
-##	The type of the user terminal.
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <rolecap/>
@@ -163,23 +219,21 @@
 	gen_require(`
 		type devicekit_t, devicekit_disk_t, devicekit_power_t;
 		type devicekit_var_lib_t, devicekit_var_run_t, devicekit_tmp_t;
+		type devicekit_var_log_t;
 	')
 
-	allow $1 devicekit_t:process { ptrace signal_perms getattr };
-	ps_process_pattern($1, devicekit_t)
+	allow $1 { devicekit_t devicekit_disk_t devicekit_power_t }:process { ptrace signal_perms };
+	ps_process_pattern($1, { devicekit_t devicekit_disk_t devicekit_power_t })
 
-	allow $1 devicekit_disk_t:process { ptrace signal_perms getattr };
-	ps_process_pattern($1, devicekit_disk_t)
-
-	allow $1 devicekit_power_t:process { ptrace signal_perms getattr };
-	ps_process_pattern($1, devicekit_power_t)
-
-	admin_pattern($1, devicekit_tmp_t)
 	files_search_tmp($1)
+	admin_pattern($1, devicekit_tmp_t)
 
-	admin_pattern($1, devicekit_var_lib_t)
 	files_search_var_lib($1)
+	admin_pattern($1, devicekit_var_lib_t)
+
+	logging_search_logs($1)
+	admin_pattern($1, devicekit_var_log_t)
 
-	admin_pattern($1, devicekit_var_run_t)
 	files_search_pids($1)
+	admin_pattern($1, devicekit_var_run_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/devicekit.te refpolicy/policy/modules/contrib/devicekit.te
--- refpolicy/policy/modules/contrib/devicekit.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/devicekit.te	2012-09-28 19:41:35.396019031 +0200
@@ -1,4 +1,4 @@
-policy_module(devicekit, 1.2.0)
+policy_module(devicekit, 1.2.1)
 
 ########################################
 #
@@ -26,16 +26,19 @@
 type devicekit_var_lib_t;
 files_type(devicekit_var_lib_t)
 
+type devicekit_var_log_t;
+logging_log_file(devicekit_var_log_t)
+
 ########################################
 #
-# DeviceKit local policy
+# Local policy
 #
 
 allow devicekit_t self:unix_dgram_socket create_socket_perms;
 
 manage_dirs_pattern(devicekit_t, devicekit_var_run_t, devicekit_var_run_t)
 manage_files_pattern(devicekit_t, devicekit_var_run_t, devicekit_var_run_t)
-files_pid_filetrans(devicekit_t, devicekit_var_run_t, { file dir })
+files_pid_filetrans(devicekit_t, devicekit_var_run_t, { dir file })
 
 kernel_read_system_state(devicekit_t)
 
@@ -49,8 +52,7 @@
 optional_policy(`
 	dbus_system_bus_client(devicekit_t)
 
-	allow devicekit_t devicekit_disk_t:dbus send_msg;
-	allow devicekit_t devicekit_power_t:dbus send_msg;
+	allow devicekit_t { devicekit_disk_t devicekit_power_t }:dbus send_msg;
 ')
 
 optional_policy(`
@@ -59,7 +61,7 @@
 
 ########################################
 #
-# DeviceKit disk local policy
+# Disk local policy
 #
 
 allow devicekit_disk_t self:capability { chown setuid setgid dac_override fowner fsetid net_admin sys_admin sys_nice sys_ptrace sys_rawio };
@@ -69,17 +71,20 @@
 
 manage_dirs_pattern(devicekit_disk_t, devicekit_tmp_t, devicekit_tmp_t)
 manage_files_pattern(devicekit_disk_t, devicekit_tmp_t, devicekit_tmp_t)
-files_tmp_filetrans(devicekit_disk_t, devicekit_tmp_t, { file dir })
+files_tmp_filetrans(devicekit_disk_t, devicekit_tmp_t, { dir file })
 
 manage_dirs_pattern(devicekit_disk_t, devicekit_var_lib_t, devicekit_var_lib_t)
 manage_files_pattern(devicekit_disk_t, devicekit_var_lib_t, devicekit_var_lib_t)
 files_var_lib_filetrans(devicekit_disk_t, devicekit_var_lib_t, dir)
 
+allow devicekit_disk_t devicekit_var_run_t:dir mounton;
 manage_dirs_pattern(devicekit_disk_t, devicekit_var_run_t, devicekit_var_run_t)
 manage_files_pattern(devicekit_disk_t, devicekit_var_run_t, devicekit_var_run_t)
-files_pid_filetrans(devicekit_disk_t, devicekit_var_run_t, { file dir })
+files_pid_filetrans(devicekit_disk_t, devicekit_var_run_t, { dir file })
 
 kernel_getattr_message_if(devicekit_disk_t)
+kernel_list_unlabeled(devicekit_disk_t)
+kernel_dontaudit_getattr_unlabeled_files(devicekit_disk_t)
 kernel_read_fs_sysctls(devicekit_disk_t)
 kernel_read_network_state(devicekit_disk_t)
 kernel_read_software_raid_state(devicekit_disk_t)
@@ -91,12 +96,12 @@
 corecmd_exec_shell(devicekit_disk_t)
 corecmd_getattr_all_executables(devicekit_disk_t)
 
-dev_rw_sysfs(devicekit_disk_t)
-dev_read_urand(devicekit_disk_t)
-dev_getattr_usbfs_dirs(devicekit_disk_t)
-dev_manage_generic_files(devicekit_disk_t)
 dev_getattr_all_chr_files(devicekit_disk_t)
 dev_getattr_mtrr_dev(devicekit_disk_t)
+dev_getattr_usbfs_dirs(devicekit_disk_t)
+dev_manage_generic_files(devicekit_disk_t)
+dev_read_urand(devicekit_disk_t)
+dev_rw_sysfs(devicekit_disk_t)
 
 domain_getattr_all_pipes(devicekit_disk_t)
 domain_getattr_all_sockets(devicekit_disk_t)
@@ -105,14 +110,16 @@
 
 files_dontaudit_read_all_symlinks(devicekit_disk_t)
 files_getattr_all_sockets(devicekit_disk_t)
-files_getattr_all_mountpoints(devicekit_disk_t)
+files_getattr_all_dirs(devicekit_disk_t)
 files_getattr_all_files(devicekit_disk_t)
+files_getattr_all_pipes(devicekit_disk_t)
+files_manage_boot_dirs(devicekit_disk_t)
 files_manage_isid_type_dirs(devicekit_disk_t)
 files_manage_mnt_dirs(devicekit_disk_t)
-files_read_etc_files(devicekit_disk_t)
 files_read_etc_runtime_files(devicekit_disk_t)
 files_read_usr_files(devicekit_disk_t)
 
+fs_getattr_all_fs(devicekit_disk_t)
 fs_list_inotifyfs(devicekit_disk_t)
 fs_manage_fusefs_dirs(devicekit_disk_t)
 fs_mount_all_fs(devicekit_disk_t)
@@ -144,6 +151,10 @@
 	optional_policy(`
 		consolekit_dbus_chat(devicekit_disk_t)
 	')
+
+	optional_policy(`
+		policykit_dbus_chat(devicekit_disk_t)
+	')
 ')
 
 optional_policy(`
@@ -159,7 +170,6 @@
 ')
 
 optional_policy(`
-	policykit_dbus_chat(devicekit_disk_t)
 	policykit_domtrans_auth(devicekit_disk_t)
 	policykit_read_lib(devicekit_disk_t)
 	policykit_read_reload(devicekit_disk_t)
@@ -180,43 +190,62 @@
 
 ########################################
 #
-# DeviceKit-Power local policy
+# Power local policy
 #
 
 allow devicekit_power_t self:capability { dac_override net_admin sys_admin sys_tty_config sys_nice sys_ptrace };
-allow devicekit_power_t self:process getsched;
+allow devicekit_power_t self:process { getsched signal_perms };
 allow devicekit_power_t self:fifo_file rw_fifo_file_perms;
 allow devicekit_power_t self:unix_dgram_socket create_socket_perms;
 allow devicekit_power_t self:netlink_kobject_uevent_socket create_socket_perms;
 
+manage_dirs_pattern(devicekit_power_t, devicekit_tmp_t, devicekit_tmp_t)
+manage_files_pattern(devicekit_power_t, devicekit_tmp_t, devicekit_tmp_t)
+files_tmp_filetrans(devicekit_power_t, devicekit_tmp_t, { file dir })
+
 manage_dirs_pattern(devicekit_power_t, devicekit_var_lib_t, devicekit_var_lib_t)
 manage_files_pattern(devicekit_power_t, devicekit_var_lib_t, devicekit_var_lib_t)
 files_var_lib_filetrans(devicekit_power_t, devicekit_var_lib_t, dir)
 
+allow devicekit_power_t devicekit_var_log_t:file append_file_perms;
+allow devicekit_power_t devicekit_var_log_t:file create_file_perms;
+allow devicekit_power_t devicekit_var_log_t:file setattr_file_perms;
+logging_log_filetrans(devicekit_power_t, devicekit_var_log_t, file)
+
+manage_dirs_pattern(devicekit_power_t, devicekit_var_run_t, devicekit_var_run_t)
+manage_files_pattern(devicekit_power_t, devicekit_var_run_t, devicekit_var_run_t)
+files_pid_filetrans(devicekit_power_t, devicekit_var_run_t, { dir file })
+
+kernel_read_fs_sysctls(devicekit_power_t)
 kernel_read_network_state(devicekit_power_t)
 kernel_read_system_state(devicekit_power_t)
 kernel_rw_hotplug_sysctls(devicekit_power_t)
 kernel_rw_kernel_sysctl(devicekit_power_t)
+kernel_rw_vm_sysctls(devicekit_power_t)
 kernel_search_debugfs(devicekit_power_t)
 kernel_write_proc_files(devicekit_power_t)
+kernel_setsched(devicekit_power_t)
 
 corecmd_exec_bin(devicekit_power_t)
 corecmd_exec_shell(devicekit_power_t)
 
-consoletype_exec(devicekit_power_t)
-
-domain_read_all_domains_state(devicekit_power_t)
-
 dev_read_input(devicekit_power_t)
+dev_read_urand(devicekit_power_t)
 dev_rw_generic_usb_dev(devicekit_power_t)
 dev_rw_generic_chr_files(devicekit_power_t)
 dev_rw_netcontrol(devicekit_power_t)
 dev_rw_sysfs(devicekit_power_t)
+dev_read_rand(devicekit_power_t)
+dev_getattr_all_chr_files(devicekit_power_t)
+
+domain_read_all_domains_state(devicekit_power_t)
 
 files_read_kernel_img(devicekit_power_t)
-files_read_etc_files(devicekit_power_t)
+files_read_etc_runtime_files(devicekit_power_t)
 files_read_usr_files(devicekit_power_t)
+files_dontaudit_list_mnt(devicekit_power_t)
 
+fs_getattr_all_fs(devicekit_power_t)
 fs_list_inotifyfs(devicekit_power_t)
 
 term_use_all_terms(devicekit_power_t)
@@ -225,8 +254,8 @@
 
 miscfiles_read_localization(devicekit_power_t)
 
-sysnet_read_config(devicekit_power_t)
 sysnet_domtrans_ifconfig(devicekit_power_t)
+sysnet_domtrans_dhcpc(devicekit_power_t)
 
 userdom_read_all_users_state(devicekit_power_t)
 
@@ -235,6 +264,10 @@
 ')
 
 optional_policy(`
+	consoletype_exec(devicekit_power_t)
+')
+
+optional_policy(`
 	cron_initrc_domtrans(devicekit_power_t)
 ')
 
@@ -248,10 +281,18 @@
 	')
 
 	optional_policy(`
+		hal_dbus_chat(devicekit_power_t)
+	')
+
+	optional_policy(`
 		networkmanager_dbus_chat(devicekit_power_t)
 	')
 
 	optional_policy(`
+		policykit_dbus_chat(devicekit_power_t)
+	')
+
+	optional_policy(`
 		rpm_dbus_chat(devicekit_power_t)
 	')
 ')
@@ -265,20 +306,38 @@
 	hal_manage_log(devicekit_power_t)
 	hal_manage_pid_dirs(devicekit_power_t)
 	hal_manage_pid_files(devicekit_power_t)
-	hal_dbus_chat(devicekit_power_t)
 ')
 
 optional_policy(`
-	policykit_dbus_chat(devicekit_power_t)
+	modutils_domtrans_insmod(devicekit_power_t)
+')
+
+optional_policy(`
+	mount_domtrans(devicekit_power_t)
+')
+
+optional_policy(`
+	networkmanager_domtrans(devicekit_power_t)
+')
+
+optional_policy(`
 	policykit_domtrans_auth(devicekit_power_t)
 	policykit_read_lib(devicekit_power_t)
 	policykit_read_reload(devicekit_power_t)
 ')
 
 optional_policy(`
+	readahead_domtrans(devicekit_power_t)
+')
+
+optional_policy(`
 	udev_read_db(devicekit_power_t)
 ')
 
 optional_policy(`
+	usbmuxd_stream_connect(devicekit_power_t)
+')
+
+optional_policy(`
 	vbetool_domtrans(devicekit_power_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/dhcp.fc refpolicy/policy/modules/contrib/dhcp.fc
--- refpolicy/policy/modules/contrib/dhcp.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/dhcp.fc	2012-09-28 19:41:58.847019583 +0200
@@ -1,8 +1,8 @@
-/etc/rc\.d/init\.d/dhcpd	--	gen_context(system_u:object_r:dhcpd_initrc_exec_t,s0)
+/etc/rc\.d/init\.d/dhcpd(6)?	--	gen_context(system_u:object_r:dhcpd_initrc_exec_t,s0)
 
 /usr/sbin/dhcpd.*		--	gen_context(system_u:object_r:dhcpd_exec_t,s0)
 
 /var/lib/dhcpd(/.*)?			gen_context(system_u:object_r:dhcpd_state_t,s0)
 /var/lib/dhcp(3)?/dhcpd\.leases.* --	gen_context(system_u:object_r:dhcpd_state_t,s0)
 
-/var/run/dhcpd\.pid		--	gen_context(system_u:object_r:dhcpd_var_run_t,s0)
+/var/run/dhcpd(6)?\.pid		--	gen_context(system_u:object_r:dhcpd_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/dhcp.if refpolicy/policy/modules/contrib/dhcp.if
--- refpolicy/policy/modules/contrib/dhcp.if	2012-05-04 15:16:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/dhcp.if	2012-09-28 19:41:58.866019574 +0200
@@ -1,8 +1,8 @@
-## <summary>Dynamic host configuration protocol (DHCP) server</summary>
+## <summary>Dynamic host configuration protocol server.</summary>
 
 ########################################
 ## <summary>
-##	Transition to dhcpd.
+##	Execute a domain transition to run dhcpd.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -21,8 +21,8 @@
 
 ########################################
 ## <summary>
-##	Set the attributes of the DCHP
-##	server state files.
+##	Set attributes of dhcpd server
+##	state files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -60,8 +60,8 @@
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate 
-##	an dhcp environment
+##	All of the rules required to
+##	administrate an dhcpd environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -70,14 +70,14 @@
 ## </param>
 ## <param name="role">
 ##	<summary>
-##	The role to be allowed to manage the dhcp domain.
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <rolecap/>
 #
 interface(`dhcpd_admin',`
 	gen_require(`
-		type dhcpd_t; type dhcpd_tmp_t;	type dhcpd_state_t;
+		type dhcpd_t, dhcpd_tmp_t, dhcpd_state_t;
 		type dhcpd_var_run_t, dhcpd_initrc_exec_t;
 	')
 
@@ -92,6 +92,7 @@
 	files_list_tmp($1)
 	admin_pattern($1, dhcpd_tmp_t)
 
+	files_list_var_lib($1)
 	admin_pattern($1, dhcpd_state_t)
 
 	files_list_pids($1)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/dhcp.te refpolicy/policy/modules/contrib/dhcp.te
--- refpolicy/policy/modules/contrib/dhcp.te	2012-07-25 20:33:04.000000000 +0200
+++ refpolicy/policy/modules/contrib/dhcp.te	2012-09-28 19:41:58.880019571 +0200
@@ -1,4 +1,4 @@
-policy_module(dhcp, 1.10.0)
+policy_module(dhcp, 1.10.1)
 
 ########################################
 #
@@ -6,9 +6,10 @@
 #
 
 ## <desc>
-## <p>
-## Allow DHCP daemon to use LDAP backends
-## </p>
+##	<p>
+##	Determine whether DHCP daemon
+##	can use LDAP backends.
+##	</p>
 ## </desc>
 gen_tunable(dhcpd_use_ldap, false)
 
@@ -33,30 +34,26 @@
 # Local policy
 #
 
-allow dhcpd_t self:capability { net_raw sys_resource };
+allow dhcpd_t self:capability { chown dac_override sys_chroot net_raw setgid setuid sys_resource };
 dontaudit dhcpd_t self:capability { net_admin sys_tty_config };
-allow dhcpd_t self:process signal_perms;
+allow dhcpd_t self:process { getcap setcap signal_perms };
 allow dhcpd_t self:fifo_file rw_fifo_file_perms;
-allow dhcpd_t self:unix_dgram_socket create_socket_perms;
-allow dhcpd_t self:unix_stream_socket create_socket_perms;
-allow dhcpd_t self:tcp_socket create_stream_socket_perms;
-allow dhcpd_t self:udp_socket create_socket_perms;
-# Allow dhcpd_t to use packet sockets
+allow dhcpd_t self:tcp_socket { accept listen };
 allow dhcpd_t self:packet_socket create_socket_perms;
 allow dhcpd_t self:rawip_socket create_socket_perms;
 
-can_exec(dhcpd_t, dhcpd_exec_t)
-
 manage_files_pattern(dhcpd_t, dhcpd_state_t, dhcpd_state_t)
 sysnet_dhcp_state_filetrans(dhcpd_t, dhcpd_state_t, file)
 
 manage_dirs_pattern(dhcpd_t, dhcpd_tmp_t, dhcpd_tmp_t)
 manage_files_pattern(dhcpd_t, dhcpd_tmp_t, dhcpd_tmp_t)
-files_tmp_filetrans(dhcpd_t, dhcpd_tmp_t, { file dir })
+files_tmp_filetrans(dhcpd_t, dhcpd_tmp_t, { dir file })
 
 manage_files_pattern(dhcpd_t, dhcpd_var_run_t, dhcpd_var_run_t)
 files_pid_filetrans(dhcpd_t, dhcpd_var_run_t, file)
 
+can_exec(dhcpd_t, dhcpd_exec_t)
+
 kernel_read_system_state(dhcpd_t)
 kernel_read_kernel_sysctls(dhcpd_t)
 kernel_read_network_state(dhcpd_t)
@@ -73,16 +70,21 @@
 corenet_udp_sendrecv_all_ports(dhcpd_t)
 corenet_tcp_bind_generic_node(dhcpd_t)
 corenet_udp_bind_generic_node(dhcpd_t)
+
+corenet_sendrecv_dhcpd_server_packets(dhcpd_t)
 corenet_tcp_bind_dhcpd_port(dhcpd_t)
 corenet_udp_bind_dhcpd_port(dhcpd_t)
-corenet_udp_bind_pxe_port(dhcpd_t)
-corenet_tcp_connect_all_ports(dhcpd_t)
-corenet_sendrecv_dhcpd_server_packets(dhcpd_t)
+
 corenet_sendrecv_pxe_server_packets(dhcpd_t)
+corenet_udp_bind_pxe_port(dhcpd_t)
+
 corenet_sendrecv_all_client_packets(dhcpd_t)
-# Needed to detect open number of interfaces (common/discover.c::begin_iface_scan)
+corenet_tcp_connect_all_ports(dhcpd_t)
+
 corenet_udp_bind_all_unreserved_ports(dhcpd_t)
 
+corecmd_exec_bin(dhcpd_t)
+
 dev_read_sysfs(dhcpd_t)
 dev_read_rand(dhcpd_t)
 dev_read_urand(dhcpd_t)
@@ -90,11 +92,8 @@
 fs_getattr_all_fs(dhcpd_t)
 fs_search_auto_mountpoints(dhcpd_t)
 
-corecmd_exec_bin(dhcpd_t)
-
 domain_use_interactive_fds(dhcpd_t)
 
-files_read_etc_files(dhcpd_t)
 files_read_usr_files(dhcpd_t)
 files_read_etc_runtime_files(dhcpd_t)
 files_search_var_lib(dhcpd_t)
@@ -110,16 +109,11 @@
 userdom_dontaudit_use_unpriv_user_fds(dhcpd_t)
 userdom_dontaudit_search_user_home_dirs(dhcpd_t)
 
-ifdef(`distro_gentoo',`
-	allow dhcpd_t self:capability { chown dac_override setgid setuid sys_chroot };
-')
-
 tunable_policy(`dhcpd_use_ldap',`
 	sysnet_use_ldap(dhcpd_t)
 ')
 
 optional_policy(`
-	# used for dynamic DNS
 	bind_read_dnssec_keys(dhcpd_t)
 ')
 
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/dictd.fc refpolicy/policy/modules/contrib/dictd.fc
--- refpolicy/policy/modules/contrib/dictd.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/dictd.fc	2012-09-28 19:42:23.325020141 +0200
@@ -1,9 +1,9 @@
-/etc/rc\.d/init\.d/dictd --	gen_context(system_u:object_r:dictd_initrc_exec_t,s0)
+/etc/rc\.d/init\.d/dictd	--	gen_context(system_u:object_r:dictd_initrc_exec_t,s0)
 
 /etc/dictd\.conf	--	gen_context(system_u:object_r:dictd_etc_t,s0)
 
-/usr/sbin/dictd		--	gen_context(system_u:object_r:dictd_exec_t,s0)
+/usr/sbin/dictd	--	gen_context(system_u:object_r:dictd_exec_t,s0)
 
-/var/lib/dictd(/.*)?		gen_context(system_u:object_r:dictd_var_lib_t,s0)
+/var/lib/dictd(/.*)?	gen_context(system_u:object_r:dictd_var_lib_t,s0)
 
 /var/run/dictd\.pid	--	gen_context(system_u:object_r:dictd_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/dictd.if refpolicy/policy/modules/contrib/dictd.if
--- refpolicy/policy/modules/contrib/dictd.if	2012-05-04 15:16:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/dictd.if	2012-09-28 19:42:23.325020142 +0200
@@ -1,4 +1,4 @@
-## <summary>Dictionary daemon</summary>
+## <summary>Dictionary daemon.</summary>
 
 ########################################
 ## <summary>
@@ -17,8 +17,8 @@
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate 
-##	an dictd environment
+##	All of the rules required to
+##	administrate an dictd environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -27,7 +27,7 @@
 ## </param>
 ## <param name="role">
 ##	<summary>
-##	The role to be allowed to manage the dictd domain.
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <rolecap/>
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/dictd.te refpolicy/policy/modules/contrib/dictd.te
--- refpolicy/policy/modules/contrib/dictd.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/dictd.te	2012-09-28 19:42:23.325020142 +0200
@@ -1,4 +1,4 @@
-policy_module(dictd, 1.7.0)
+policy_module(dictd, 1.7.1)
 
 ########################################
 #
@@ -29,12 +29,10 @@
 allow dictd_t self:capability { setuid setgid };
 dontaudit dictd_t self:capability sys_tty_config;
 allow dictd_t self:process { signal_perms setpgid };
-allow dictd_t self:unix_stream_socket create_stream_socket_perms;
-allow dictd_t self:tcp_socket create_stream_socket_perms;
-allow dictd_t self:udp_socket create_socket_perms;
+allow dictd_t self:unix_stream_socket { accept listen };
+allow dictd_t self:tcp_socket { accept listen };
 
 allow dictd_t dictd_etc_t:file read_file_perms;
-files_search_etc(dictd_t)
 
 allow dictd_t dictd_var_lib_t:dir list_dir_perms;
 allow dictd_t dictd_var_lib_t:file read_file_perms;
@@ -48,48 +46,33 @@
 corenet_all_recvfrom_unlabeled(dictd_t)
 corenet_all_recvfrom_netlabel(dictd_t)
 corenet_tcp_sendrecv_generic_if(dictd_t)
-corenet_raw_sendrecv_generic_if(dictd_t)
-corenet_udp_sendrecv_generic_if(dictd_t)
 corenet_tcp_sendrecv_generic_node(dictd_t)
-corenet_udp_sendrecv_generic_node(dictd_t)
-corenet_raw_sendrecv_generic_node(dictd_t)
-corenet_tcp_sendrecv_all_ports(dictd_t)
-corenet_udp_sendrecv_all_ports(dictd_t)
 corenet_tcp_bind_generic_node(dictd_t)
-corenet_tcp_bind_dict_port(dictd_t)
+
 corenet_sendrecv_dict_server_packets(dictd_t)
+corenet_tcp_bind_dict_port(dictd_t)
+corenet_tcp_sendrecv_dict_port(dictd_t)
 
 dev_read_sysfs(dictd_t)
 
-fs_getattr_xattr_fs(dictd_t)
-fs_search_auto_mountpoints(dictd_t)
-
 domain_use_interactive_fds(dictd_t)
 
-files_read_etc_files(dictd_t)
 files_read_etc_runtime_files(dictd_t)
 files_read_usr_files(dictd_t)
 files_search_var_lib(dictd_t)
-# for checking for nscd
-files_dontaudit_search_pids(dictd_t)
+
+fs_getattr_xattr_fs(dictd_t)
+fs_search_auto_mountpoints(dictd_t)
+
+auth_use_nsswitch(dictd_t)
 
 logging_send_syslog_msg(dictd_t)
 
 miscfiles_read_localization(dictd_t)
 
-sysnet_read_config(dictd_t)
-
 userdom_dontaudit_use_unpriv_user_fds(dictd_t)
 
 optional_policy(`
-	nis_use_ypbind(dictd_t)
-')
-
-optional_policy(`
-	nscd_socket_use(dictd_t)
-')
-
-optional_policy(`
 	seutil_sigchld_newrole(dictd_t)
 ')
 
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/dirmngr.fc refpolicy/policy/modules/contrib/dirmngr.fc
--- refpolicy/policy/modules/contrib/dirmngr.fc	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/dirmngr.fc	2012-10-10 21:36:12.865026448 +0200
@@ -0,0 +1,13 @@
+/etc/dirmngr(/.*)?	gen_context(system_u:object_r:dirmngr_conf_t,s0)
+
+/etc/rc\.d/init\.d/dirmngr	--	gen_context(system_u:object_r:dirmngr_initrc_exec_t,s0)
+
+/usr/bin/dirmngr	--	gen_context(system_u:object_r:dirmngr_exec_t,s0)
+
+/var/log/dirmngr(/.*)?	gen_context(system_u:object_r:dirmngr_log_t,s0)
+
+/var/lib/dirmngr(/.*)?	gen_context(system_u:object_r:dirmngr_var_lib_t,s0)
+
+/var/run/dirmngr\.pid	--	gen_context(system_u:object_r:dirmngr_var_run_t,s0)
+
+/var/run/dirmngr(/.*)?	gen_context(system_u:object_r:dirmngr_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/dirmngr.if refpolicy/policy/modules/contrib/dirmngr.if
--- refpolicy/policy/modules/contrib/dirmngr.if	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/dirmngr.if	2012-10-10 21:36:12.865026448 +0200
@@ -0,0 +1,45 @@
+## <summary>Server for managing and downloading certificate revocation lists.</summary>
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an dirmngr environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`dirmngr_admin',`
+	gen_require(`
+		type dirmngr_t, dirmngr_initrc_exec_t, dirmngr_var_run_t;
+		type dirmngr_conf_t, dirmngr_var_lib_t, dirmngr_log_t;
+	')
+
+	allow $1 dirmngr_t:process { ptrace signal_perms };
+	ps_process_pattern($1, dirmngr_t)
+
+	init_labeled_script_domtrans($1, dirmngr_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 dirmngr_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	files_search_etc($1)
+	admin_pattern($1, dirmngr_conf_t)
+
+	logging_search_logs($1)
+	admin_pattern($1, dirmngr_log_t)
+
+	files_search_pids($1)
+	admin_pattern($1, dirmngr_var_run_t)
+
+	files_search_var_lib($1)
+	admin_pattern($1, dirmngr_var_lib_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/dirmngr.te refpolicy/policy/modules/contrib/dirmngr.te
--- refpolicy/policy/modules/contrib/dirmngr.te	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/dirmngr.te	2012-10-10 21:36:12.865026448 +0200
@@ -0,0 +1,58 @@
+policy_module(dirmngr, 1.0.0)
+
+########################################
+#
+# Declarations
+#
+
+type dirmngr_t;
+type dirmngr_exec_t;
+init_daemon_domain(dirmngr_t, dirmngr_exec_t)
+
+type dirmngr_conf_t;
+files_config_file(dirmngr_conf_t)
+
+type dirmngr_initrc_exec_t;
+init_script_file(dirmngr_initrc_exec_t)
+
+type dirmngr_log_t;
+logging_log_file(dirmngr_log_t)
+
+type dirmngr_var_lib_t;
+files_type(dirmngr_var_lib_t)
+
+type dirmngr_var_run_t;
+files_pid_file(dirmngr_var_run_t)
+
+########################################
+#
+# Local policy
+#
+
+allow dirmngr_t self:fifo_file rw_file_perms;
+
+allow dirmngr_t dirmngr_conf_t:dir list_dir_perms;
+allow dirmngr_t dirmngr_conf_t:file read_file_perms;
+allow dirmngr_t dirmngr_conf_t:lnk_file read_lnk_file_perms;
+
+manage_dirs_pattern(dirmngr_t, dirmngr_log_t, dirmngr_log_t)
+append_files_pattern(dirmngr_t, dirmngr_log_t, dirmngr_log_t)
+create_files_pattern(dirmngr_t, dirmngr_log_t, dirmngr_log_t)
+setattr_files_pattern(dirmngr_t, dirmngr_log_t, dirmngr_log_t)
+logging_log_filetrans(dirmngr_t, dirmngr_log_t, dir)
+
+manage_dirs_pattern(dirmngr_t, dirmngr_var_lib_t, dirmngr_var_lib_t)
+manage_files_pattern(dirmngr_t, dirmngr_var_lib_t, dirmngr_var_lib_t)
+manage_lnk_files_pattern(dirmngr_t, dirmngr_var_lib_t, dirmngr_var_lib_t)
+files_var_lib_filetrans(dirmngr_t, dirmngr_var_lib_t, dir)
+
+manage_dirs_pattern(dirmngr_t, dirmngr_var_run_t, dirmngr_var_run_t)
+manage_files_pattern(dirmngr_t, dirmngr_var_run_t, dirmngr_var_run_t)
+manage_sock_files_pattern(dirmngr_t, dirmngr_var_run_t, dirmngr_var_run_t)
+files_pid_filetrans(dirmngr_t, dirmngr_var_run_t, { dir file })
+
+kernel_read_crypto_sysctls(dirmngr_t)
+
+files_read_etc_files(dirmngr_t)
+
+miscfiles_read_localization(dirmngr_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/distcc.fc refpolicy/policy/modules/contrib/distcc.fc
--- refpolicy/policy/modules/contrib/distcc.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/distcc.fc	2012-09-28 19:42:41.553020562 +0200
@@ -1,2 +1,7 @@
+/etc/rc\.d/init\.d/distccd	--	gen_context(system_u:object_r:distccd_initrc_exec_t,s0)
 
 /usr/bin/distccd	--	gen_context(system_u:object_r:distccd_exec_t,s0)
+
+/var/log/distccd.*	--	gen_context(system_u:object_r:distccd_log_t,s0)
+
+/var/run/distccd\.pid	--	gen_context(system_u:object_r:distccd_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/distcc.if refpolicy/policy/modules/contrib/distcc.if
--- refpolicy/policy/modules/contrib/distcc.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/distcc.if	2012-09-28 19:42:41.553020562 +0200
@@ -1 +1,42 @@
-## <summary>Distributed compiler daemon</summary>
+## <summary>Distributed compiler daemon.</summary>
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an distcc environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`distcc_admin',`
+	gen_require(`
+		type distccd_t, distccd_t, distccd_log_t;
+		type disccd_var_run_t, distccd_tmp_t, distccd_initrc_exec_t;
+	')
+
+	allow $1 distccd_t:process { ptrace signal_perms };
+	ps_process_pattern($1, distccd_t)
+
+	init_labeled_script_domtrans($1, distccd_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 distccd_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	logging_search_logs($1)
+	admin_pattern($1, distccd_log_t)
+
+	files_search_tmp($1)
+	admin_pattern($1, distccd_tmp_t)
+
+	files_search_pids($1)
+	admin_pattern($1, distccd_var_run_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/distcc.te refpolicy/policy/modules/contrib/distcc.te
--- refpolicy/policy/modules/contrib/distcc.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/distcc.te	2012-09-28 19:42:41.554020563 +0200
@@ -1,4 +1,4 @@
-policy_module(distcc, 1.8.0)
+policy_module(distcc, 1.8.2)
 
 ########################################
 #
@@ -9,6 +9,9 @@
 type distccd_exec_t;
 init_daemon_domain(distccd_t, distccd_exec_t)
 
+type distccd_initrc_exec_t;
+init_script_file(distccd_initrc_exec_t)
+
 type distccd_log_t;
 logging_log_file(distccd_log_t)
 
@@ -27,11 +30,11 @@
 dontaudit distccd_t self:capability sys_tty_config;
 allow distccd_t self:process { signal_perms setsched };
 allow distccd_t self:fifo_file rw_fifo_file_perms;
-allow distccd_t self:netlink_route_socket r_netlink_socket_perms;
-allow distccd_t self:tcp_socket create_stream_socket_perms;
-allow distccd_t self:udp_socket create_socket_perms;
+allow distccd_t self:tcp_socket { accept listen };
 
-allow distccd_t distccd_log_t:file manage_file_perms;
+allow distccd_t distccd_log_t:file append_file_perms;
+allow distccd_t distccd_log_t:file create_file_perms;
+allow distccd_t distccd_log_t:file setattr_file_perms;
 logging_log_filetrans(distccd_t, distccd_log_t, file)
 
 manage_dirs_pattern(distccd_t, distccd_tmp_t, distccd_tmp_t)
@@ -47,14 +50,12 @@
 corenet_all_recvfrom_unlabeled(distccd_t)
 corenet_all_recvfrom_netlabel(distccd_t)
 corenet_tcp_sendrecv_generic_if(distccd_t)
-corenet_udp_sendrecv_generic_if(distccd_t)
 corenet_tcp_sendrecv_generic_node(distccd_t)
-corenet_udp_sendrecv_generic_node(distccd_t)
-corenet_tcp_sendrecv_all_ports(distccd_t)
-corenet_udp_sendrecv_all_ports(distccd_t)
 corenet_tcp_bind_generic_node(distccd_t)
-corenet_tcp_bind_distccd_port(distccd_t)
+
 corenet_sendrecv_distccd_server_packets(distccd_t)
+corenet_tcp_bind_distccd_port(distccd_t)
+corenet_tcp_sendrecv_distccd_port(distccd_t)
 
 dev_read_sysfs(distccd_t)
 
@@ -62,29 +63,23 @@
 fs_search_auto_mountpoints(distccd_t)
 
 corecmd_exec_bin(distccd_t)
-corecmd_read_bin_symlinks(distccd_t)
 
 domain_use_interactive_fds(distccd_t)
 
-files_read_etc_files(distccd_t)
 files_read_etc_runtime_files(distccd_t)
 
+auth_use_nsswitch(distccd_t)
+
 libs_exec_lib_files(distccd_t)
 
 logging_send_syslog_msg(distccd_t)
 
 miscfiles_read_localization(distccd_t)
 
-sysnet_read_config(distccd_t)
-
 userdom_dontaudit_use_unpriv_user_fds(distccd_t)
 userdom_dontaudit_search_user_home_dirs(distccd_t)
 
 optional_policy(`
-	nis_use_ypbind(distccd_t)
-')
-
-optional_policy(`
 	seutil_sigchld_newrole(distccd_t)
 ')
 
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/djbdns.fc refpolicy/policy/modules/contrib/djbdns.fc
--- refpolicy/policy/modules/contrib/djbdns.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/djbdns.fc	2012-09-28 19:43:04.223021089 +0200
@@ -1,9 +1,7 @@
-
-/usr/bin/axfrdns		--	gen_context(system_u:object_r:djbdns_axfrdns_exec_t,s0)
+/usr/bin/axfrdns	--	gen_context(system_u:object_r:djbdns_axfrdns_exec_t,s0)
 /usr/bin/dnscache	--	gen_context(system_u:object_r:djbdns_dnscache_exec_t,s0)
-/usr/bin/tinydns		--	gen_context(system_u:object_r:djbdns_tinydns_exec_t,s0)
-
-/var/axfrdns/root(/.*)?		gen_context(system_u:object_r:djbdns_axfrdns_conf_t,s0)
-/var/dnscache/root(/.*)?		gen_context(system_u:object_r:djbdns_dnscache_conf_t,s0)
-/var/tinydns/root(/.*)?		gen_context(system_u:object_r:djbdns_tinydns_conf_t,s0)
+/usr/bin/tinydns	--	gen_context(system_u:object_r:djbdns_tinydns_exec_t,s0)
 
+/var/axfrdns/root(/.*)?	gen_context(system_u:object_r:djbdns_axfrdns_conf_t,s0)
+/var/dnscache/root(/.*)?	gen_context(system_u:object_r:djbdns_dnscache_conf_t,s0)
+/var/tinydns/root(/.*)?	gen_context(system_u:object_r:djbdns_tinydns_conf_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/djbdns.if refpolicy/policy/modules/contrib/djbdns.if
--- refpolicy/policy/modules/contrib/djbdns.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/djbdns.if	2012-09-28 19:43:04.242021088 +0200
@@ -1,61 +1,49 @@
-## <summary>small and secure DNS daemon</summary>
+## <summary>Small and secure DNS daemon.</summary>
 
-########################################
+#######################################
 ## <summary>
-##	Create a set of derived types for djbdns
-##	components that are directly supervised by daemontools.
+##	The template to define a djbdns domain.
 ## </summary>
-## <param name="prefix">
+## <param name="domain_prefix">
 ##	<summary>
-##	The prefix to be used for deriving type names.
+##	Domain prefix to be used.
 ##	</summary>
 ## </param>
 #
 template(`djbdns_daemontools_domain_template',`
+	gen_require(`
+		attribute djbdns_domain;
+	')
 
-	type djbdns_$1_t;
-	type djbdns_$1_exec_t;
-	type djbdns_$1_conf_t;
-	files_config_file(djbdns_$1_conf_t)
+	########################################
+	#
+	# Declarations
+	#
 
+	type djbdns_$1_t, djbdns_domain;
+	type djbdns_$1_exec_t;
 	domain_type(djbdns_$1_t)
 	domain_entry_file(djbdns_$1_t, djbdns_$1_exec_t)
 	role system_r types djbdns_$1_t;
 
+	type djbdns_$1_conf_t;
+	files_config_file(djbdns_$1_conf_t)
+
+	########################################
+	#
+	# Local policy
+	#
+
 	daemontools_service_domain(djbdns_$1_t, djbdns_$1_exec_t)
 	daemontools_read_svc(djbdns_$1_t)
 
-	allow djbdns_$1_t self:capability { net_bind_service setgid setuid sys_chroot };
-	allow djbdns_$1_t self:process signal;
-	allow djbdns_$1_t self:fifo_file rw_fifo_file_perms;
-	allow djbdns_$1_t self:tcp_socket create_stream_socket_perms;
-	allow djbdns_$1_t self:udp_socket create_socket_perms;
-
 	allow djbdns_$1_t djbdns_$1_conf_t:dir list_dir_perms;
 	allow djbdns_$1_t djbdns_$1_conf_t:file read_file_perms;
-
-	corenet_all_recvfrom_unlabeled(djbdns_$1_t)
-	corenet_all_recvfrom_netlabel(djbdns_$1_t)
-	corenet_tcp_sendrecv_generic_if(djbdns_$1_t)
-	corenet_udp_sendrecv_generic_if(djbdns_$1_t)
-	corenet_tcp_sendrecv_generic_node(djbdns_$1_t)
-	corenet_udp_sendrecv_generic_node(djbdns_$1_t)
-	corenet_tcp_sendrecv_all_ports(djbdns_$1_t)
-	corenet_udp_sendrecv_all_ports(djbdns_$1_t)
-	corenet_tcp_bind_generic_node(djbdns_$1_t)
-	corenet_udp_bind_generic_node(djbdns_$1_t)
-	corenet_tcp_bind_dns_port(djbdns_$1_t)
-	corenet_udp_bind_dns_port(djbdns_$1_t)
-	corenet_udp_bind_generic_port(djbdns_$1_t)
-	corenet_sendrecv_dns_server_packets(djbdns_$1_t)
-	corenet_sendrecv_generic_server_packets(djbdns_$1_t)
-
-	files_search_var(djbdns_$1_t)
 ')
 
 #####################################
 ## <summary>
-##	Allow search the djbdns-tinydns key ring.
+##	Search djbdns-tinydns key ring.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -73,7 +61,7 @@
 
 #####################################
 ## <summary>
-##	Allow link to the djbdns-tinydns key ring.
+##	Link djbdns-tinydns key ring.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/djbdns.te refpolicy/policy/modules/contrib/djbdns.te
--- refpolicy/policy/modules/contrib/djbdns.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/djbdns.te	2012-09-28 19:47:20.900027018 +0200
@@ -1,49 +1,64 @@
-policy_module(djbdns, 1.5.0)
+policy_module(djbdns, 1.5.2)
 
 ########################################
 #
 # Declarations
 #
 
-type djbdns_axfrdns_t;
-type djbdns_axfrdns_exec_t;
-domain_type(djbdns_axfrdns_t)
-domain_entry_file(djbdns_axfrdns_t, djbdns_axfrdns_exec_t)
-role system_r types djbdns_axfrdns_t;
+attribute djbdns_domain;
 
-type djbdns_axfrdns_conf_t;
-files_config_file(djbdns_axfrdns_conf_t)
+djbdns_daemontools_domain_template(axfrdns)
+ucspitcp_service_domain(djbdns_axfrdns_t, djbdns_axfrdns_exec_t)
 
 djbdns_daemontools_domain_template(dnscache)
-
 djbdns_daemontools_domain_template(tinydns)
 
 ########################################
 #
-# Local policy for axfrdns component
+# Common local policy
 #
 
-daemontools_ipc_domain(djbdns_axfrdns_t)
-daemontools_read_svc(djbdns_axfrdns_t)
-
-allow djbdns_axfrdns_t self:capability { setuid setgid sys_chroot };
-
-allow djbdns_axfrdns_t djbdns_axfrdns_conf_t:dir list_dir_perms;
-allow djbdns_axfrdns_t djbdns_axfrdns_conf_t:file read_file_perms;
-
-allow djbdns_axfrdns_t djbdns_tinydns_t:dir list_dir_perms;
-allow djbdns_axfrdns_t djbdns_tinydns_t:file read_file_perms;
+allow djbdns_domain self:capability { net_bind_service setgid setuid sys_chroot };
+allow djbdns_domain self:process signal;
+allow djbdns_domain self:fifo_file rw_fifo_file_perms;
+allow djbdns_domain self:tcp_socket create_stream_socket_perms;
+allow djbdns_domain self:udp_socket create_socket_perms;
+
+corenet_all_recvfrom_unlabeled(djbdns_domain)
+corenet_all_recvfrom_netlabel(djbdns_domain)
+corenet_tcp_sendrecv_generic_if(djbdns_domain)
+corenet_udp_sendrecv_generic_if(djbdns_domain)
+corenet_tcp_sendrecv_generic_node(djbdns_domain)
+corenet_udp_sendrecv_generic_node(djbdns_domain)
+corenet_tcp_sendrecv_all_ports(djbdns_domain)
+corenet_udp_sendrecv_all_ports(djbdns_domain)
+corenet_tcp_bind_generic_node(djbdns_domain)
+corenet_udp_bind_generic_node(djbdns_domain)
+
+corenet_sendrecv_dns_server_packets(djbdns_domain)
+corenet_tcp_bind_dns_port(djbdns_domain)
+corenet_udp_bind_dns_port(djbdns_domain)
+
+corenet_sendrecv_dns_client_packets(djbdns_domain)
+corenet_tcp_connect_dns_port(djbdns_domain)
+
+corenet_sendrecv_generic_server_packets(djbdns_domain)
+corenet_tcp_bind_generic_port(djbdns_domain)
+corenet_udp_bind_generic_port(djbdns_domain)
 
-allow djbdns_axfrdns_t djbdns_tinydns_conf_t:dir list_dir_perms;
-allow djbdns_axfrdns_t djbdns_tinydns_conf_t:file read_file_perms;
+files_search_var(djbdns_domain)
 
-files_search_var(djbdns_axfrdns_t)
+########################################
+#
+# axfrdns local policy
+#
 
-ucspitcp_service_domain(djbdns_axfrdns_t, djbdns_axfrdns_exec_t)
+allow djbdns_axfrdns_t { djbdns_tinydns_t djbdns_tinydns_conf_t }:dir list_dir_perms;
+allow djbdns_axfrdns_t { djbdns_tinydns_t djbdns_tinydns_conf_t }:file read_file_perms;
 
 ########################################
 #
-# Local policy for tinydns
+# tinydns local policy
 #
 
 init_dontaudit_use_script_fds(djbdns_tinydns_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/dkim.fc refpolicy/policy/modules/contrib/dkim.fc
--- refpolicy/policy/modules/contrib/dkim.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/dkim.fc	2012-10-11 18:03:58.677183683 +0200
@@ -1,14 +1,18 @@
-/etc/mail/dkim-milter/keys(/.*)?	gen_context(system_u:object_r:dkim_milter_private_key_t,s0)
-/etc/opendkim/keys(/.*)?		gen_context(system_u:object_r:dkim_milter_private_key_t,s0)
+/etc/opendkim/keys(/.*)?	gen_context(system_u:object_r:dkim_milter_private_key_t,s0)
 
-/usr/sbin/dkim-filter		--	gen_context(system_u:object_r:dkim_milter_exec_t,s0)
-/usr/sbin/opendkim		--	gen_context(system_u:object_r:dkim_milter_exec_t,s0)
+/etc/rc\.d/init\.d/((opendkim)|(dkim-milter))	--	gen_context(system_u:object_r:dkim_milter_initrc_exec_t,s0)
 
-/var/db/dkim(/.*)?			gen_context(system_u:object_r:dkim_milter_private_key_t,s0)
+/usr/sbin/dkim-filter	--	gen_context(system_u:object_r:dkim_milter_exec_t,s0)
+/usr/sbin/opendkim	--	gen_context(system_u:object_r:dkim_milter_exec_t,s0)
 
-/var/run/dkim-filter(/.*)?		gen_context(system_u:object_r:dkim_milter_data_t,s0)
-/var/run/dkim-milter(/.*)?		gen_context(system_u:object_r:dkim_milter_data_t,s0)
+/var/db/dkim(/.*)?	gen_context(system_u:object_r:dkim_milter_private_key_t,s0)
+
+/var/lib/dkim-milter(/.*)?	gen_context(system_u:object_r:dkim_milter_data_t,s0)
+
+/var/run/dkim-filter(/.*)?	gen_context(system_u:object_r:dkim_milter_data_t,s0)
+/var/run/dkim-milter(/.*)?	gen_context(system_u:object_r:dkim_milter_data_t,s0)
 /var/run/dkim-milter\.pid	--	gen_context(system_u:object_r:dkim_milter_data_t,s0)
-/var/run/opendkim(/.*)?			gen_context(system_u:object_r:dkim_milter_data_t,s0)
 
-/var/spool/opendkim(/.*)?		gen_context(system_u:object_r:dkim_milter_data_t,s0)
+/var/run/opendkim(/.*)?	gen_context(system_u:object_r:dkim_milter_data_t,s0)
+
+/var/spool/opendkim(/.*)?	gen_context(system_u:object_r:dkim_milter_data_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/dkim.if refpolicy/policy/modules/contrib/dkim.if
--- refpolicy/policy/modules/contrib/dkim.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/dkim.if	2012-09-28 19:47:52.184027736 +0200
@@ -1 +1,39 @@
 ## <summary>DomainKeys Identified Mail milter.</summary>
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an dkim environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`dkim_admin',`
+	gen_require(`
+		type dkim_milter_t, dkim_milter_initrc_exec_t, dkim_milter_private_key_t;
+		type dkim_milter_data_t;
+	')
+
+	allow $1 dkim_milter_t:process { ptrace signal_perms };
+	ps_process_pattern($1, dkim_milter_t)
+
+	init_labeled_script_domtrans($1, dkim_milter_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 dkim_milter_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	files_search_etc($1)
+	admin_pattern($1, dkim_milter_private_key_t)
+
+	files_search_pids($1)
+	admin_pattern($1, dkim_milter_data_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/dkim.te refpolicy/policy/modules/contrib/dkim.te
--- refpolicy/policy/modules/contrib/dkim.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/dkim.te	2012-10-11 18:03:58.677183683 +0200
@@ -1,4 +1,4 @@
-policy_module(dkim, 1.1.0)
+policy_module(dkim, 1.1.2)
 
 ########################################
 #
@@ -7,7 +7,9 @@
 
 milter_template(dkim)
 
-# Type for the private key of dkim-filter
+type dkim_milter_initrc_exec_t;
+init_script_file(dkim_milter_initrc_exec_t)
+
 type dkim_milter_private_key_t;
 files_type(dkim_milter_private_key_t)
 
@@ -18,6 +20,7 @@
 
 allow dkim_milter_t self:capability { setgid setuid };
 allow dkim_milter_t self:process signal;
+allow dkim_milter_t self:unix_stream_socket create_stream_socket_perms;
 
 read_files_pattern(dkim_milter_t, dkim_milter_private_key_t, dkim_milter_private_key_t)
 
@@ -25,9 +28,6 @@
 
 dev_read_urand(dkim_milter_t)
 
-files_read_etc_files(dkim_milter_t)
 files_search_spool(dkim_milter_t)
 
-sysnet_dns_name_resolve(dkim_milter_t)
-
 mta_read_config(dkim_milter_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/dmidecode.fc refpolicy/policy/modules/contrib/dmidecode.fc
--- refpolicy/policy/modules/contrib/dmidecode.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/dmidecode.fc	2012-09-28 19:48:09.257028131 +0200
@@ -1,4 +1,4 @@
-
+/usr/sbin/biosdecode	--	gen_context(system_u:object_r:dmidecode_exec_t,s0)
 /usr/sbin/dmidecode	--	gen_context(system_u:object_r:dmidecode_exec_t,s0)
 /usr/sbin/ownership	--	gen_context(system_u:object_r:dmidecode_exec_t,s0)
 /usr/sbin/vpddecode	--	gen_context(system_u:object_r:dmidecode_exec_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/dmidecode.if refpolicy/policy/modules/contrib/dmidecode.if
--- refpolicy/policy/modules/contrib/dmidecode.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/dmidecode.if	2012-09-28 19:48:09.257028131 +0200
@@ -15,18 +15,15 @@
 		type dmidecode_t, dmidecode_exec_t;
 	')
 
-	domain_auto_trans($1, dmidecode_exec_t, dmidecode_t)
-
-	allow $1 dmidecode_t:fd use;
-	allow dmidecode_t $1:fd use;
-	allow dmidecode_t $1:fifo_file rw_file_perms;
-	allow dmidecode_t $1:process sigchld;
+	corecmd_search_bin($1)
+	domtrans_pattern($1, dmidecode_exec_t, dmidecode_t)
 ')
 
 ########################################
 ## <summary>
-##	Execute dmidecode in the dmidecode domain, and
-##	allow the specified role the dmidecode domain.
+##	Execute dmidecode in the dmidecode
+##	domain, and allow the specified
+##	role the dmidecode domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -42,9 +39,9 @@
 #
 interface(`dmidecode_run',`
 	gen_require(`
-		type dmidecode_t;
+		attribute_role dmidecode_roles;
 	')
 
 	dmidecode_domtrans($1)
-	role $2 types dmidecode_t;
+	roleattribute $2 dmidecode_roles;
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/dmidecode.te refpolicy/policy/modules/contrib/dmidecode.te
--- refpolicy/policy/modules/contrib/dmidecode.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/dmidecode.te	2012-09-28 19:48:09.257028131 +0200
@@ -1,14 +1,17 @@
-policy_module(dmidecode, 1.4.0)
+policy_module(dmidecode, 1.4.1)
 
 ########################################
 #
 # Declarations
 #
 
+attribute_role dmidecode_roles;
+roleattribute system_r dmidecode_roles;
+
 type dmidecode_t;
 type dmidecode_exec_t;
 application_domain(dmidecode_t, dmidecode_exec_t)
-role system_r types dmidecode_t;
+role dmidecode_roles types dmidecode_t;
 
 ########################################
 #
@@ -18,7 +21,6 @@
 allow dmidecode_t self:capability sys_rawio;
 
 dev_read_sysfs(dmidecode_t)
-# Allow dmidecode to read /dev/mem
 dev_read_raw_memory(dmidecode_t)
 
 mls_file_read_all_levels(dmidecode_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/dnsmasq.fc refpolicy/policy/modules/contrib/dnsmasq.fc
--- refpolicy/policy/modules/contrib/dnsmasq.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/dnsmasq.fc	2012-10-02 20:02:47.235011232 +0200
@@ -1,12 +1,13 @@
-/etc/dnsmasq\.conf		--	gen_context(system_u:object_r:dnsmasq_etc_t, s0)
+/etc/dnsmasq\.conf	--	gen_context(system_u:object_r:dnsmasq_etc_t,s0)
+
 /etc/rc\.d/init\.d/dnsmasq	--	gen_context(system_u:object_r:dnsmasq_initrc_exec_t,s0)
 
-/usr/sbin/dnsmasq		--	gen_context(system_u:object_r:dnsmasq_exec_t,s0)
+/usr/sbin/dnsmasq	--	gen_context(system_u:object_r:dnsmasq_exec_t,s0)
 
 /var/lib/misc/dnsmasq\.leases	--	gen_context(system_u:object_r:dnsmasq_lease_t,s0)
-/var/lib/dnsmasq(/.*)?			gen_context(system_u:object_r:dnsmasq_lease_t,s0)
+/var/lib/dnsmasq(/.*)?	gen_context(system_u:object_r:dnsmasq_lease_t,s0)
 
-/var/log/dnsmasq\.log			gen_context(system_u:object_r:dnsmasq_var_log_t,s0)
+/var/log/dnsmasq.*	--	gen_context(system_u:object_r:dnsmasq_var_log_t,s0)
 
-/var/run/dnsmasq\.pid		--	gen_context(system_u:object_r:dnsmasq_var_run_t,s0)
-/var/run/libvirt/network(/.*)?		gen_context(system_u:object_r:dnsmasq_var_run_t,s0)
+/var/run/dnsmasq\.pid	--	gen_context(system_u:object_r:dnsmasq_var_run_t,s0)
+/var/run/libvirt/network(/.*)?	gen_context(system_u:object_r:dnsmasq_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/dnsmasq.if refpolicy/policy/modules/contrib/dnsmasq.if
--- refpolicy/policy/modules/contrib/dnsmasq.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/dnsmasq.if	2012-10-22 20:10:27.514015413 +0200
@@ -1,4 +1,4 @@
-## <summary>dnsmasq DNS forwarder and DHCP server</summary>
+## <summary>DNS forwarder and DHCP server.</summary>
 
 ########################################
 ## <summary>
@@ -22,7 +22,8 @@
 
 ########################################
 ## <summary>
-##	Execute the dnsmasq init script in the init script domain.
+##	Execute the dnsmasq init script in
+##	the init script domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -41,7 +42,7 @@
 
 ########################################
 ## <summary>
-##	Send dnsmasq a signal
+##	Send generic signals to dnsmasq.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -60,7 +61,7 @@
 
 ########################################
 ## <summary>
-##	Send dnsmasq a signull
+##	Send null signals to dnsmasq.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -79,7 +80,7 @@
 
 ########################################
 ## <summary>
-##	Send dnsmasq a kill signal.
+##	Send kill signals to dnsmasq.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -117,7 +118,7 @@
 
 ########################################
 ## <summary>
-##	Write to dnsmasq config files.
+##	Write dnsmasq config files.
 ## </summary>
 ## <param name="domain">
 ## <summary>
@@ -136,7 +137,7 @@
 
 ########################################
 ## <summary>
-##	Delete dnsmasq pid files
+##	Delete dnsmasq pid files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -155,7 +156,27 @@
 
 ########################################
 ## <summary>
-##	Read dnsmasq pid files
+##	Create, read, write, and delete
+##	dnsmasq pid files
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`dnsmasq_manage_pid_files',`
+	gen_require(`
+		type dnsmasq_var_run_t;
+	')
+
+	files_search_pids($1)
+	manage_files_pattern($1, dnsmasq_var_run_t, dnsmasq_var_run_t)
+')
+
+########################################
+## <summary>
+##	Read dnsmasq pid files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -174,8 +195,62 @@
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate
-##	an dnsmasq environment
+##	Create dnsmasq pid directories.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`dnsmasq_create_pid_dirs',`
+	gen_require(`
+		type dnsmasq_var_run_t;
+	')
+
+	files_search_pids($1)
+	allow $1 dnsmasq_var_run_t:dir create_dir_perms;
+')
+
+########################################
+## <summary>
+##	Create specified objects in specified
+##	directories with a type transition to
+##	the dnsmasq pid file type.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="file_type">
+##	<summary>
+##	Directory to transition on.
+##	</summary>
+## </param>
+## <param name="object">
+##	<summary>
+##	The object class of the object being created.
+##	</summary>
+## </param>
+## <param name="name" optional="true">
+##	<summary>
+##	The name of the object being created.
+##	</summary>
+## </param>
+#
+interface(`dnsmasq_spec_filetrans_pid',`
+	gen_require(`
+		type dnsmasq_var_run_t;
+	')
+
+	filetrans_pattern($1, $2, dnsmasq_var_run_t, $3, $4)
+')
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an dnsmasq environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -184,7 +259,7 @@
 ## </param>
 ## <param name="role">
 ##	<summary>
-##	The role to be allowed to manage the dnsmasq domain.
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <rolecap/>
@@ -192,7 +267,7 @@
 interface(`dnsmasq_admin',`
 	gen_require(`
 		type dnsmasq_t, dnsmasq_lease_t, dnsmasq_var_run_t;
-		type dnsmasq_initrc_exec_t;
+		type dnsmasq_initrc_exec_t, dnsmasq_var_log_t;
 	')
 
 	allow $1 dnsmasq_t:process { ptrace signal_perms };
@@ -206,6 +281,9 @@
 	files_list_var_lib($1)
 	admin_pattern($1, dnsmasq_lease_t)
 
+	logging_seearch_logs($1)
+	admin_pattern($1, dnsmasq_var_log_t)
+
 	files_list_pids($1)
 	admin_pattern($1, dnsmasq_var_run_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/dnsmasq.te refpolicy/policy/modules/contrib/dnsmasq.te
--- refpolicy/policy/modules/contrib/dnsmasq.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/dnsmasq.te	2012-10-22 20:10:27.515015413 +0200
@@ -1,4 +1,4 @@
-policy_module(dnsmasq, 1.9.0)
+policy_module(dnsmasq, 1.9.2)
 
 ########################################
 #
@@ -33,26 +33,28 @@
 dontaudit dnsmasq_t self:capability sys_tty_config;
 allow dnsmasq_t self:process { getcap setcap signal_perms };
 allow dnsmasq_t self:fifo_file rw_fifo_file_perms;
-allow dnsmasq_t self:netlink_route_socket { bind create nlmsg_read read write };
-allow dnsmasq_t self:tcp_socket create_stream_socket_perms;
-allow dnsmasq_t self:udp_socket create_socket_perms;
+allow dnsmasq_t self:tcp_socket { accept listen };
 allow dnsmasq_t self:packet_socket create_socket_perms;
 allow dnsmasq_t self:rawip_socket create_socket_perms;
 
 read_files_pattern(dnsmasq_t, dnsmasq_etc_t, dnsmasq_etc_t)
 
-# dhcp leases
 manage_files_pattern(dnsmasq_t, dnsmasq_lease_t, dnsmasq_lease_t)
 files_var_lib_filetrans(dnsmasq_t, dnsmasq_lease_t, file)
 
-manage_files_pattern(dnsmasq_t, dnsmasq_var_log_t, dnsmasq_var_log_t)
+allow dnsmasq_t dnsmasq_var_log_t:file append_file_perms;
+allow dnsmasq_t dnsmasq_var_log_t:file create_file_perms;
+allow dnsmasq_t dnsmasq_var_log_t:file setattr_file_perms;
 logging_log_filetrans(dnsmasq_t, dnsmasq_var_log_t, file)
 
+manage_dirs_pattern(dnsmasq_t, dnsmasq_var_run_t, dnsmasq_var_run_t)
 manage_files_pattern(dnsmasq_t, dnsmasq_var_run_t, dnsmasq_var_run_t)
-files_pid_filetrans(dnsmasq_t, dnsmasq_var_run_t, file)
+files_pid_filetrans(dnsmasq_t, dnsmasq_var_run_t, { dir file })
 
 kernel_read_kernel_sysctls(dnsmasq_t)
+kernel_read_network_state(dnsmasq_t)
 kernel_read_system_state(dnsmasq_t)
+kernel_request_load_module(dnsmasq_t)
 
 corenet_all_recvfrom_unlabeled(dnsmasq_t)
 corenet_all_recvfrom_netlabel(dnsmasq_t)
@@ -66,17 +68,17 @@
 corenet_udp_sendrecv_all_ports(dnsmasq_t)
 corenet_tcp_bind_generic_node(dnsmasq_t)
 corenet_udp_bind_generic_node(dnsmasq_t)
-corenet_tcp_bind_dns_port(dnsmasq_t)
-corenet_udp_bind_all_ports(dnsmasq_t)
+
 corenet_sendrecv_dns_server_packets(dnsmasq_t)
+corenet_tcp_bind_dns_port(dnsmasq_t)
 corenet_sendrecv_dhcpd_server_packets(dnsmasq_t)
+corenet_udp_bind_all_ports(dnsmasq_t)
 
 dev_read_sysfs(dnsmasq_t)
 dev_read_urand(dnsmasq_t)
 
 domain_use_interactive_fds(dnsmasq_t)
 
-files_read_etc_files(dnsmasq_t)
 files_read_etc_runtime_files(dnsmasq_t)
 
 fs_getattr_all_fs(dnsmasq_t)
@@ -96,10 +98,19 @@
 ')
 
 optional_policy(`
+	dbus_connect_system_bus(dnsmasq_t)
 	dbus_system_bus_client(dnsmasq_t)
 ')
 
 optional_policy(`
+	networkmanager_read_pid_files(dnsmasq_t)
+')
+
+optional_policy(`
+	ppp_read_pid_files(dnsmasq_t)
+')
+
+optional_policy(`
 	seutil_sigchld_newrole(dnsmasq_t)
 ')
 
@@ -114,4 +125,5 @@
 optional_policy(`
 	virt_manage_lib_files(dnsmasq_t)
 	virt_read_pid_files(dnsmasq_t)
+	virt_pid_filetrans(dnsmasq_t, dnsmasq_var_run_t, { dir file })
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/dnssectrigger.fc refpolicy/policy/modules/contrib/dnssectrigger.fc
--- refpolicy/policy/modules/contrib/dnssectrigger.fc	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/dnssectrigger.fc	2012-09-27 20:03:30.385126498 +0200
@@ -0,0 +1,9 @@
+/etc/dnssec-trigger/dnssec-trigger\.conf	--	gen_context(system_u:object_r:dnssec_trigger_conf_t,s0)
+
+/etc/rc\.d/init\.d/dnssec-triggerd	--	gen_context(system_u:object_r:dnssec_triggerd_initrc_exec_t,s0)
+
+/usr/sbin/dnssec-triggerd	--	gen_context(system_u:object_r:dnssec_triggerd_exec_t,s0)
+
+/var/log/dnssec-trigger\.log.*	--	gen_context(system_u:object_r:dnssec_trigger_log_t,s0)
+
+/var/run/dnssec-triggerd\.pid	--	gen_context(system_u:object_r:dnssec_triggerd_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/dnssectrigger.if refpolicy/policy/modules/contrib/dnssectrigger.if
--- refpolicy/policy/modules/contrib/dnssectrigger.if	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/dnssectrigger.if	2012-09-27 20:03:30.385126498 +0200
@@ -0,0 +1,42 @@
+## <summary>Enables DNSSEC protection for DNS traffic.</summary>
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an dnssec environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`dnssectrigger_admin',`
+	gen_require(`
+		type dnssec_triggerd_t, dnssec_triggerd_initrc_exec_t, dnssec_trigger_conf_t;
+		type dnssec_trigger_log_t, dnssec_triggerd_var_run_t;
+	')
+
+	allow $1 dnssec_triggerd_t:process { ptrace signal_perms };
+	ps_process_pattern($1, dnssec_triggerd_t)
+
+	init_labeled_script_domtrans($1, dnssec_triggerd_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 dnssec_triggerd_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	files_search_etc($1)
+	admin_pattern($1, dnssec_trigger_conf_t)
+
+	logging_search_logs($1)
+	admin_pattern($1, dnssec_trigger_log_t)
+
+	files_search_pids($1)
+	admin_pattern($1, dnssec_triggerd_var_run_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/dnssectrigger.te refpolicy/policy/modules/contrib/dnssectrigger.te
--- refpolicy/policy/modules/contrib/dnssectrigger.te	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/dnssectrigger.te	2012-10-06 19:02:45.593741458 +0200
@@ -0,0 +1,79 @@
+policy_module(dnssectrigger, 1.0.1)
+
+########################################
+#
+# Declarations
+#
+
+type dnssec_triggerd_t;
+type dnssec_triggerd_exec_t;
+init_daemon_domain(dnssec_triggerd_t, dnssec_triggerd_exec_t)
+
+type dnssec_triggerd_initrc_exec_t;
+init_script_file(dnssec_triggerd_initrc_exec_t)
+
+type dnssec_trigger_conf_t;
+files_config_file(dnssec_trigger_conf_t)
+
+type dnssec_trigger_log_t;
+logging_log_file(dnssec_trigger_log_t)
+
+type dnssec_triggerd_var_run_t;
+files_pid_file(dnssec_triggerd_var_run_t)
+
+########################################
+#
+# Local policy
+#
+
+allow dnssec_triggerd_t self:capability linux_immutable;
+allow dnssec_triggerd_t self:process signal;
+allow dnssec_triggerd_t self:fifo_file rw_fifo_file_perms;
+allow dnssec_triggerd_t self:unix_stream_socket { accept listen };
+allow dnssec_triggerd_t self:tcp_socket { accept listen };
+
+allow dnssec_triggerd_t dnssec_trigger_conf_t:file read_file_perms;
+
+append_files_pattern(dnssec_triggerd_t, dnssec_trigger_log_t, dnssec_trigger_log_t)
+create_files_pattern(dnssec_triggerd_t, dnssec_trigger_log_t, dnssec_trigger_log_t)
+setattr_files_pattern(dnssec_triggerd_t, dnssec_trigger_log_t, dnssec_trigger_log_t)
+logging_log_filetrans(dnssec_triggerd_t, dnssec_trigger_log_t, file)
+
+manage_files_pattern(dnssec_triggerd_t, dnssec_triggerd_var_run_t, dnssec_triggerd_var_run_t)
+files_pid_filetrans(dnssec_triggerd_t, dnssec_triggerd_var_run_t, file)
+
+kernel_read_system_state(dnssec_triggerd_t)
+
+corecmd_exec_bin(dnssec_triggerd_t)
+corecmd_exec_shell(dnssec_triggerd_t)
+
+corenet_all_recvfrom_unlabeled(dnssec_triggerd_t)
+corenet_all_recvfrom_netlabel(dnssec_triggerd_t)
+corenet_tcp_sendrecv_generic_if(dnssec_triggerd_t)
+corenet_tcp_sendrecv_generic_node(dnssec_triggerd_t)
+corenet_tcp_bind_generic_node(dnssec_triggerd_t)
+
+corenet_sendrecv_rndc_client_packets(dnssec_triggerd_t)
+corenet_tcp_connect_rndc_port(dnssec_triggerd_t)
+corenet_tcp_sendrecv_rndc_port(dnssec_triggerd_t)
+
+corenet_sendrecv_http_client_packets(dnssec_triggerd_t)
+corenet_tcp_connect_http_port(dnssec_triggerd_t)
+corenet_tcp_sendrecv_http_port(dnssec_triggerd_t)
+
+dev_read_urand(dnssec_triggerd_t)
+
+files_read_etc_runtime_files(dnssec_triggerd_t)
+
+logging_send_syslog_msg(dnssec_triggerd_t)
+
+miscfiles_read_localization(dnssec_triggerd_t)
+
+sysnet_dns_name_resolve(dnssec_triggerd_t)
+sysnet_manage_config(dnssec_triggerd_t)
+sysnet_etc_filetrans_config(dnssec_triggerd_t)
+
+optional_policy(`
+	bind_read_config(dnssec_triggerd_t)
+	bind_read_dnssec_keys(dnssec_triggerd_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/dovecot.fc refpolicy/policy/modules/contrib/dovecot.fc
--- refpolicy/policy/modules/contrib/dovecot.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/dovecot.fc	2012-10-22 20:10:35.342015444 +0200
@@ -1,46 +1,34 @@
+/etc/dovecot(/.*)?	gen_context(system_u:object_r:dovecot_etc_t,s0)
+/etc/dovecot/passwd.*	gen_context(system_u:object_r:dovecot_passwd_t,s0)
 
-#
-# /etc
-#
-/etc/dovecot(/.*)?*			gen_context(system_u:object_r:dovecot_etc_t,s0)
-/etc/dovecot\.conf.*			gen_context(system_u:object_r:dovecot_etc_t,s0)
-/etc/dovecot\.passwd.*			gen_context(system_u:object_r:dovecot_passwd_t,s0)
+/etc/dovecot\.conf.*	gen_context(system_u:object_r:dovecot_etc_t,s0)
+/etc/dovecot\.passwd.*	gen_context(system_u:object_r:dovecot_passwd_t,s0)
+
+/etc/pki/dovecot(/.*)?	gen_context(system_u:object_r:dovecot_cert_t,s0)
 
-/etc/pki/dovecot(/.*)?			gen_context(system_u:object_r:dovecot_cert_t,s0)
 /etc/rc\.d/init\.d/dovecot	--	gen_context(system_u:object_r:dovecot_initrc_exec_t,s0)
 
-# Debian uses /etc/dovecot/
-ifdef(`distro_debian',`
-/etc/dovecot/passwd.*			gen_context(system_u:object_r:dovecot_passwd_t,s0)
-')
-
-#
-# /usr
-#
-/usr/sbin/dovecot		--	gen_context(system_u:object_r:dovecot_exec_t,s0)
+/usr/sbin/dovecot	--	gen_context(system_u:object_r:dovecot_exec_t,s0)
 
-/usr/share/ssl/certs/dovecot\.pem --	gen_context(system_u:object_r:dovecot_cert_t,s0)
-/usr/share/ssl/private/dovecot\.pem --	gen_context(system_u:object_r:dovecot_cert_t,s0)
+/usr/share/ssl/certs/dovecot\.pem	--	gen_context(system_u:object_r:dovecot_cert_t,s0)
+/usr/share/ssl/private/dovecot\.pem	--	gen_context(system_u:object_r:dovecot_cert_t,s0)
 
-ifdef(`distro_debian', `
+/usr/lib/dovecot/auth	--	gen_context(system_u:object_r:dovecot_auth_exec_t,s0)
+/usr/lib/dovecot/deliver	--	gen_context(system_u:object_r:dovecot_deliver_exec_t,s0)
 /usr/lib/dovecot/dovecot-auth	--	gen_context(system_u:object_r:dovecot_auth_exec_t,s0)
-')
+/usr/lib/dovecot/dovecot-lda	--	gen_context(system_u:object_r:dovecot_deliver_exec_t,s0)
 
-ifdef(`distro_redhat', `
-/usr/libexec/dovecot/auth 	--	gen_context(system_u:object_r:dovecot_auth_exec_t,s0)
+/usr/libexec/dovecot/auth	--	gen_context(system_u:object_r:dovecot_auth_exec_t,s0)
 /usr/libexec/dovecot/deliver	--	gen_context(system_u:object_r:dovecot_deliver_exec_t,s0)
-/usr/libexec/dovecot/deliver-lda --	gen_context(system_u:object_r:dovecot_deliver_exec_t,s0)
-/usr/libexec/dovecot/dovecot-auth --	gen_context(system_u:object_r:dovecot_auth_exec_t,s0)
-')
+/usr/libexec/dovecot/deliver-lda	--	gen_context(system_u:object_r:dovecot_deliver_exec_t,s0)
+/usr/libexec/dovecot/dovecot-auth	--	gen_context(system_u:object_r:dovecot_auth_exec_t,s0)
 
-#
-# /var
-#
-/var/run/dovecot(-login)?(/.*)?		gen_context(system_u:object_r:dovecot_var_run_t,s0)
+/var/run/dovecot(-login)?(/.*)?	gen_context(system_u:object_r:dovecot_var_run_t,s0)
+/var/run/dovecot/login/ssl-parameters.dat	--	gen_context(system_u:object_r:dovecot_var_lib_t,s0)
 
-/var/lib/dovecot(/.*)?			gen_context(system_u:object_r:dovecot_var_lib_t,s0)
+/var/lib/dovecot(/.*)?	gen_context(system_u:object_r:dovecot_var_lib_t,s0)
 
-/var/log/dovecot(/.*)?			gen_context(system_u:object_r:dovecot_var_log_t,s0)
-/var/log/dovecot\.log.*			gen_context(system_u:object_r:dovecot_var_log_t,s0)
+/var/log/dovecot(/.*)?	gen_context(system_u:object_r:dovecot_var_log_t,s0)
+/var/log/dovecot\.log.*	gen_context(system_u:object_r:dovecot_var_log_t,s0)
 
-/var/spool/dovecot(/.*)?		gen_context(system_u:object_r:dovecot_spool_t,s0)
+/var/spool/dovecot(/.*)?	gen_context(system_u:object_r:dovecot_spool_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/dovecot.if refpolicy/policy/modules/contrib/dovecot.if
--- refpolicy/policy/modules/contrib/dovecot.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/dovecot.if	2012-10-27 13:42:48.604007240 +0200
@@ -1,8 +1,29 @@
-## <summary>Dovecot POP and IMAP mail server</summary>
+## <summary>POP and IMAP mail server.</summary>
+
+#######################################
+## <summary>
+##	Connect to dovecot using a unix
+##	domain stream socket.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`dovecot_stream_connect',`
+	gen_require(`
+		type dovecot_t, dovecot_var_run_t;
+	')
+
+	files_search_pids($1)
+	stream_connect_pattern($1, dovecot_var_run_t, dovecot_var_run_t, dovecot_t)
+')
 
 ########################################
 ## <summary>
-##	Connect to dovecot auth unix domain stream socket.
+##	Connect to dovecot using a unix
+##	domain stream socket.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -16,12 +37,14 @@
 		type dovecot_auth_t, dovecot_var_run_t;
 	')
 
+	files_search_pids($1)
 	stream_connect_pattern($1, dovecot_var_run_t, dovecot_var_run_t, dovecot_auth_t)
 ')
 
 ########################################
 ## <summary>
-##	Execute dovecot_deliver in the dovecot_deliver domain.
+##	Execute dovecot_deliver in the
+##	dovecot_deliver domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -34,12 +57,14 @@
 		type dovecot_deliver_t, dovecot_deliver_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, dovecot_deliver_exec_t, dovecot_deliver_t)
 ')
 
 ########################################
 ## <summary>
-##	Create, read, write, and delete the dovecot spool files.
+##	Create, read, write, and delete
+##	dovecot spool files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -52,13 +77,16 @@
 		type dovecot_spool_t;
 	')
 
-	manage_files_pattern($1, dovecot_spool_t, dovecot_spool_t)
-	manage_lnk_files_pattern($1, dovecot_spool_t, dovecot_spool_t)
+	files_search_spool($1)
+	allow $1 dovecot_spool_t:dir manage_dir_perms;
+	allow $1 dovecot_spool_t:file manage_file_perms;
+	allow $1 dovecot_spool_t:lnk_file manage_lnk_file_perms;
 ')
 
 ########################################
 ## <summary>
-##	Do not audit attempts to delete dovecot lib files.
+##	Do not audit attempts to delete
+##	dovecot lib files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -71,13 +99,31 @@
 		type dovecot_var_lib_t;
 	')
 
-	dontaudit $1 dovecot_var_lib_t:file unlink;
+	dontaudit $1 dovecot_var_lib_t:file delete_file_perms;
+')
+
+######################################
+## <summary>
+##	Write inherited dovecot tmp files.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain to not audit.
+##	</summary>
+## </param>
+#
+interface(`dovecot_write_inherited_tmp_files',`
+	gen_require(`
+		type dovecot_tmp_t;
+	')
+
+	allow $1 dovecot_tmp_t:file write;
 ')
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate
-##	an dovecot environment
+##	All of the rules required to
+##	administrate an dovecot environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -86,19 +132,17 @@
 ## </param>
 ## <param name="role">
 ##	<summary>
-##	The role to be allowed to manage the dovecot domain.
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <rolecap/>
 #
 interface(`dovecot_admin',`
 	gen_require(`
-		type dovecot_t, dovecot_etc_t, dovecot_log_t;
-		type dovecot_spool_t, dovecot_var_lib_t;
-		type dovecot_var_run_t;
-
-		type dovecot_cert_t, dovecot_passwd_t;
-		type dovecot_initrc_exec_t;
+		type dovecot_t, dovecot_etc_t, dovecot_var_log_t;
+		type dovecot_spool_t, dovecot_var_lib_t, dovecot_initrc_exec_t;
+		type dovecot_var_run_t, dovecot_cert_t, dovecot_passwd_t;
+		type dovecot_tmp_t, dovecot_auth_tmp_t, dovecot_deliver_tmp_t;
 	')
 
 	allow $1 dovecot_t:process { ptrace signal_perms };
@@ -113,18 +157,19 @@
 	admin_pattern($1, dovecot_etc_t)
 
 	logging_list_logs($1)
-	admin_pattern($1, dovecot_log_t)
+	admin_pattern($1, dovecot_var_log_t)
 
 	files_list_spool($1)
 	admin_pattern($1, dovecot_spool_t)
 
+	files_search_tmp($1)
+	admin_pattern($1, { dovecot_tmp_t dovecot_auth_tmp_t dovecot_deliver_tmp_t })
+
 	files_list_var_lib($1)
 	admin_pattern($1, dovecot_var_lib_t)
 
 	files_list_pids($1)
 	admin_pattern($1, dovecot_var_run_t)
 
-	admin_pattern($1, dovecot_cert_t)
-
-	admin_pattern($1, dovecot_passwd_t)
+	admin_pattern($1, { dovecot_cert_t dovecot_passwd_t })
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/dovecot.te refpolicy/policy/modules/contrib/dovecot.te
--- refpolicy/policy/modules/contrib/dovecot.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/dovecot.te	2012-10-30 19:30:44.492399339 +0100
@@ -1,9 +1,10 @@
-policy_module(dovecot, 1.14.0)
+policy_module(dovecot, 1.15.2)
 
 ########################################
 #
 # Declarations
 #
+
 type dovecot_t;
 type dovecot_exec_t;
 init_daemon_domain(dovecot_t, dovecot_exec_t)
@@ -18,7 +19,7 @@
 files_tmp_file(dovecot_auth_tmp_t)
 
 type dovecot_cert_t;
-files_type(dovecot_cert_t)
+miscfiles_cert_type(dovecot_cert_t)
 
 type dovecot_deliver_t;
 type dovecot_deliver_exec_t;
@@ -26,6 +27,9 @@
 domain_entry_file(dovecot_deliver_t, dovecot_deliver_exec_t)
 role system_r types dovecot_deliver_t;
 
+type dovecot_deliver_tmp_t;
+files_tmp_file(dovecot_deliver_tmp_t)
+
 type dovecot_etc_t;
 files_config_file(dovecot_etc_t)
 
@@ -41,7 +45,6 @@
 type dovecot_tmp_t;
 files_tmp_file(dovecot_tmp_t)
 
-# /var/lib/dovecot holds SSL parameters file
 type dovecot_var_lib_t;
 files_type(dovecot_var_lib_t)
 
@@ -53,51 +56,49 @@
 
 ########################################
 #
-# dovecot local policy
+# Local policy
 #
 
-allow dovecot_t self:capability { dac_override dac_read_search chown kill net_bind_service setgid setuid sys_chroot };
+allow dovecot_t self:capability { dac_override dac_read_search chown fsetid kill net_bind_service setgid setuid sys_chroot };
 dontaudit dovecot_t self:capability sys_tty_config;
-allow dovecot_t self:process { setrlimit signal_perms getcap setcap };
+allow dovecot_t self:capability2 block_suspend;
+allow dovecot_t self:process { setrlimit signal_perms getcap setcap setsched };
 allow dovecot_t self:fifo_file rw_fifo_file_perms;
-allow dovecot_t self:tcp_socket create_stream_socket_perms;
-allow dovecot_t self:unix_dgram_socket create_socket_perms;
-allow dovecot_t self:unix_stream_socket { create_stream_socket_perms connectto };
-
-domtrans_pattern(dovecot_t, dovecot_auth_exec_t, dovecot_auth_t)
-
-allow dovecot_t dovecot_auth_t:process signal;
-
-allow dovecot_t dovecot_cert_t:dir list_dir_perms;
-read_files_pattern(dovecot_t, dovecot_cert_t, dovecot_cert_t)
-read_lnk_files_pattern(dovecot_t, dovecot_cert_t, dovecot_cert_t)
+allow dovecot_t self:tcp_socket { accept listen };
+allow dovecot_t self:unix_stream_socket { accept connectto listen };
 
-allow dovecot_t dovecot_etc_t:file read_file_perms;
-files_search_etc(dovecot_t)
-
-can_exec(dovecot_t, dovecot_exec_t)
+allow dovecot_t { dovecot_etc_t dovecot_cert_t }:dir list_dir_perms;
+read_files_pattern(dovecot_t, { dovecot_etc_t dovecot_cert_t }, { dovecot_etc_t dovecot_cert_t })
+read_lnk_files_pattern(dovecot_t, { dovecot_etc_t dovecot_cert_t }, { dovecot_etc_t dovecot_cert_t })
 
 manage_dirs_pattern(dovecot_t, dovecot_tmp_t, dovecot_tmp_t)
 manage_files_pattern(dovecot_t, dovecot_tmp_t, dovecot_tmp_t)
 files_tmp_filetrans(dovecot_t, dovecot_tmp_t, { file dir })
 
-# Allow dovecot to create and read SSL parameters file
 manage_files_pattern(dovecot_t, dovecot_var_lib_t, dovecot_var_lib_t)
-files_search_var_lib(dovecot_t)
-files_read_var_symlinks(dovecot_t)
 
 manage_dirs_pattern(dovecot_t, dovecot_var_log_t, dovecot_var_log_t)
-manage_files_pattern(dovecot_t, dovecot_var_log_t, dovecot_var_log_t)
+append_files_pattern(dovecot_t, dovecot_var_log_t, dovecot_var_log_t)
+create_files_pattern(dovecot_t, dovecot_var_log_t, dovecot_var_log_t)
+setattr_files_pattern(dovecot_t, dovecot_var_log_t, dovecot_var_log_t)
 logging_log_filetrans(dovecot_t, dovecot_var_log_t, { file dir })
 
 manage_dirs_pattern(dovecot_t, dovecot_spool_t, dovecot_spool_t)
 manage_files_pattern(dovecot_t, dovecot_spool_t, dovecot_spool_t)
 manage_lnk_files_pattern(dovecot_t, dovecot_spool_t, dovecot_spool_t)
 
+manage_dirs_pattern(dovecot_t, dovecot_var_run_t, dovecot_var_run_t)
 manage_files_pattern(dovecot_t, dovecot_var_run_t, dovecot_var_run_t)
 manage_lnk_files_pattern(dovecot_t, dovecot_var_run_t, dovecot_var_run_t)
 manage_sock_files_pattern(dovecot_t, dovecot_var_run_t, dovecot_var_run_t)
-files_pid_filetrans(dovecot_t, dovecot_var_run_t, file)
+manage_fifo_files_pattern(dovecot_t, dovecot_var_run_t, dovecot_var_run_t)
+files_pid_filetrans(dovecot_t, dovecot_var_run_t, { dir file fifo_file })
+
+can_exec(dovecot_t, dovecot_exec_t)
+
+allow dovecot_t dovecot_auth_t:process signal;
+
+domtrans_pattern(dovecot_t, dovecot_auth_exec_t, dovecot_auth_t)
 
 kernel_read_kernel_sysctls(dovecot_t)
 kernel_read_system_state(dovecot_t)
@@ -108,34 +109,39 @@
 corenet_tcp_sendrecv_generic_node(dovecot_t)
 corenet_tcp_sendrecv_all_ports(dovecot_t)
 corenet_tcp_bind_generic_node(dovecot_t)
+
+corenet_sendrecv_mail_server_packets(dovecot_t)
 corenet_tcp_bind_mail_port(dovecot_t)
+corenet_sendrecv_pop_server_packets(dovecot_t)
 corenet_tcp_bind_pop_port(dovecot_t)
+corenet_sendrecv_sieve_server_packets(dovecot_t)
 corenet_tcp_bind_sieve_port(dovecot_t)
+
+corenet_sendrecv_all_client_packets(dovecot_t)
 corenet_tcp_connect_all_ports(dovecot_t)
 corenet_tcp_connect_postgresql_port(dovecot_t)
-corenet_sendrecv_pop_server_packets(dovecot_t)
-corenet_sendrecv_all_client_packets(dovecot_t)
+
+corecmd_exec_bin(dovecot_t)
 
 dev_read_sysfs(dovecot_t)
+dev_read_rand(dovecot_t)
 dev_read_urand(dovecot_t)
 
-fs_getattr_all_fs(dovecot_t)
-fs_getattr_all_dirs(dovecot_t)
-fs_search_auto_mountpoints(dovecot_t)
-fs_list_inotifyfs(dovecot_t)
-
-corecmd_exec_bin(dovecot_t)
-
 domain_use_interactive_fds(dovecot_t)
 
-files_read_etc_files(dovecot_t)
+files_read_etc_runtime_files(dovecot_t)
+files_read_var_lib_files(dovecot_t)
+files_read_var_symlinks(dovecot_t)
 files_search_spool(dovecot_t)
-files_search_tmp(dovecot_t)
 files_dontaudit_list_default(dovecot_t)
-# Dovecot now has quota support and it uses getmntent() to find the mountpoints.
-files_read_etc_runtime_files(dovecot_t)
+files_dontaudit_search_all_dirs(dovecot_t)
 files_search_all_mountpoints(dovecot_t)
 
+fs_getattr_all_fs(dovecot_t)
+fs_getattr_all_dirs(dovecot_t)
+fs_search_auto_mountpoints(dovecot_t)
+fs_list_inotifyfs(dovecot_t)
+
 init_getattr_utmp(dovecot_t)
 
 auth_use_nsswitch(dovecot_t)
@@ -146,17 +152,30 @@
 miscfiles_read_localization(dovecot_t)
 
 userdom_dontaudit_use_unpriv_user_fds(dovecot_t)
-userdom_manage_user_home_content_dirs(dovecot_t)
-userdom_manage_user_home_content_files(dovecot_t)
-userdom_manage_user_home_content_symlinks(dovecot_t)
-userdom_manage_user_home_content_pipes(dovecot_t)
-userdom_manage_user_home_content_sockets(dovecot_t)
-userdom_user_home_dir_filetrans_user_home_content(dovecot_t, { dir file lnk_file fifo_file sock_file })
+userdom_use_user_terminals(dovecot_t)
 
-mta_manage_spool(dovecot_t)
+tunable_policy(`use_nfs_home_dirs',`
+	fs_manage_nfs_dirs(dovecot_t)
+	fs_manage_nfs_files(dovecot_t)
+	fs_manage_nfs_symlinks(dovecot_t)
+')
+
+tunable_policy(`use_samba_home_dirs',`
+	fs_manage_cifs_dirs(dovecot_t)
+	fs_manage_cifs_files(dovecot_t)
+	fs_manage_cifs_symlinks(dovecot_t)
+')
 
 optional_policy(`
 	kerberos_keytab_template(dovecot, dovecot_t)
+	kerberos_manage_host_rcache(dovecot_t)
+	kerberos_tmp_filetrans_host_rcache(dovecot_t, file, "imap_0")
+')
+
+optional_policy(`
+	mta_manage_spool(dovecot_t)
+	mta_manage_mail_home_rw_content(dovecot_t)
+	mta_home_filetrans_mail_home_rw(dovecot_t, dir, "Maildir")
 ')
 
 optional_policy(`
@@ -164,6 +183,15 @@
 ')
 
 optional_policy(`
+	postfix_manage_private_sockets(dovecot_t)
+	postfix_search_spool(dovecot_t)
+')
+
+optional_policy(`
+	sendmail_domtrans(dovecot_t)
+')
+
+optional_policy(`
 	seutil_sigchld_newrole(dovecot_t)
 ')
 
@@ -177,65 +205,67 @@
 
 ########################################
 #
-# dovecot auth local policy
+# Auth local policy
 #
 
-allow dovecot_auth_t self:capability { chown dac_override setgid setuid };
-allow dovecot_auth_t self:process { signal_perms getcap setcap };
+allow dovecot_auth_t self:capability { chown dac_override ipc_lock setgid setuid sys_nice };
+allow dovecot_auth_t self:capability2 block_suspend;
+allow dovecot_auth_t self:process { getsched setsched signal_perms getcap setcap };
 allow dovecot_auth_t self:fifo_file rw_fifo_file_perms;
-allow dovecot_auth_t self:unix_dgram_socket create_socket_perms;
-allow dovecot_auth_t self:unix_stream_socket create_stream_socket_perms;
-
-allow dovecot_auth_t dovecot_t:unix_stream_socket { connectto rw_stream_socket_perms };
+allow dovecot_auth_t self:unix_stream_socket { accept connectto listen };
 
 read_files_pattern(dovecot_auth_t, dovecot_passwd_t, dovecot_passwd_t)
 
+read_files_pattern(dovecot_auth_t, dovecot_etc_t, dovecot_etc_t)
+read_lnk_files_pattern(dovecot_auth_t, dovecot_etc_t, dovecot_etc_t)
+
 manage_dirs_pattern(dovecot_auth_t, dovecot_auth_tmp_t, dovecot_auth_tmp_t)
 manage_files_pattern(dovecot_auth_t, dovecot_auth_tmp_t, dovecot_auth_tmp_t)
 files_tmp_filetrans(dovecot_auth_t, dovecot_auth_tmp_t, { file dir })
 
 allow dovecot_auth_t dovecot_var_run_t:dir list_dir_perms;
 manage_sock_files_pattern(dovecot_auth_t, dovecot_var_run_t, dovecot_var_run_t)
-dovecot_stream_connect_auth(dovecot_auth_t)
+
+allow dovecot_auth_t dovecot_t:unix_stream_socket { connectto rw_stream_socket_perms };
 
 kernel_read_all_sysctls(dovecot_auth_t)
 kernel_read_system_state(dovecot_auth_t)
 
-logging_send_audit_msgs(dovecot_auth_t)
-logging_send_syslog_msg(dovecot_auth_t)
+corecmd_exec_bin(dovecot_auth_t)
 
+dev_read_sysfs(dovecot_auth_t)
+dev_read_rand(dovecot_auth_t)
 dev_read_urand(dovecot_auth_t)
 
-auth_domtrans_chk_passwd(dovecot_auth_t)
-auth_use_nsswitch(dovecot_auth_t)
-
-files_read_etc_files(dovecot_auth_t)
 files_read_etc_runtime_files(dovecot_auth_t)
 files_search_pids(dovecot_auth_t)
 files_read_usr_files(dovecot_auth_t)
-files_read_usr_symlinks(dovecot_auth_t)
 files_read_var_lib_files(dovecot_auth_t)
-files_search_tmp(dovecot_auth_t)
-files_read_var_lib_files(dovecot_t)
+
+auth_domtrans_chk_passwd(dovecot_auth_t)
+auth_use_nsswitch(dovecot_auth_t)
 
 init_rw_utmp(dovecot_auth_t)
 
+logging_send_audit_msgs(dovecot_auth_t)
+logging_send_syslog_msg(dovecot_auth_t)
+
 miscfiles_read_localization(dovecot_auth_t)
 
 seutil_dontaudit_search_config(dovecot_auth_t)
 
-optional_policy(`
-	kerberos_use(dovecot_auth_t)
+sysnet_use_ldap(dovecot_auth_t)
 
-	# for gssapi (kerberos)
+optional_policy(`
 	userdom_list_user_tmp(dovecot_auth_t)
 	userdom_read_user_tmp_files(dovecot_auth_t)
 	userdom_read_user_tmp_symlinks(dovecot_auth_t)
 ')
 
 optional_policy(`
-	mysql_search_db(dovecot_auth_t)
 	mysql_stream_connect(dovecot_auth_t)
+	mysql_read_config(dovecot_auth_t)
+	mysql_tcp_connect(dovecot_auth_t)
 ')
 
 optional_policy(`
@@ -243,64 +273,81 @@
 ')
 
 optional_policy(`
+	postfix_manage_private_sockets(dovecot_auth_t)
 	postfix_search_spool(dovecot_auth_t)
 ')
 
 ########################################
 #
-# dovecot deliver local policy
+# Deliver local policy
 #
-allow dovecot_deliver_t self:unix_dgram_socket create_socket_perms;
 
-allow dovecot_deliver_t dovecot_t:process signull;
+allow dovecot_deliver_t self:capability2 block_suspend;
+allow dovecot_deliver_t self:fifo_file rw_fifo_file_perms;
+
+allow dovecot_deliver_t dovecot_etc_t:dir list_dir_perms;
+read_files_pattern(dovecot_deliver_t, dovecot_etc_t, dovecot_etc_t)
+read_lnk_files_pattern(dovecot_deliver_t, dovecot_etc_t, dovecot_etc_t)
+
+allow dovecot_deliver_t dovecot_cert_t:dir search_dir_perms;
+
+append_files_pattern(dovecot_deliver_t, dovecot_var_log_t, dovecot_var_log_t)
+
+manage_dirs_pattern(dovecot_deliver_t, dovecot_deliver_tmp_t, dovecot_deliver_tmp_t)
+manage_files_pattern(dovecot_deliver_t, dovecot_deliver_tmp_t, dovecot_deliver_tmp_t)
+files_tmp_filetrans(dovecot_deliver_t, dovecot_deliver_tmp_t, { file dir })
 
-allow dovecot_deliver_t dovecot_etc_t:file read_file_perms;
 allow dovecot_deliver_t dovecot_var_run_t:dir list_dir_perms;
+read_files_pattern(dovecot_deliver_t, dovecot_var_run_t, dovecot_var_run_t)
+read_sock_files_pattern(dovecot_deliver_t, dovecot_var_run_t, dovecot_var_run_t)
+
+stream_connect_pattern(dovecot_deliver_t, dovecot_var_run_t, dovecot_var_run_t, { dovecot_t dovecot_auth_t })
+
+can_exec(dovecot_deliver_t, dovecot_deliver_exec_t)
+
+allow dovecot_deliver_t dovecot_t:process signull;
 
 kernel_read_all_sysctls(dovecot_deliver_t)
 kernel_read_system_state(dovecot_deliver_t)
 
-files_read_etc_files(dovecot_deliver_t)
+corecmd_exec_bin(dovecot_deliver_t)
+
+dev_read_sysfs(dovecot_deliver_t)
+dev_read_rand(dovecot_deliver_t)
+dev_read_urand(dovecot_deliver_t)
+
 files_read_etc_runtime_files(dovecot_deliver_t)
 
+fs_getattr_all_fs(dovecot_deliver_t)
+
 auth_use_nsswitch(dovecot_deliver_t)
 
+logging_search_logs(dovecot_deliver_t)
 logging_send_syslog_msg(dovecot_deliver_t)
-logging_search_logs(dovecot_auth_t)
 
 miscfiles_read_localization(dovecot_deliver_t)
 
-dovecot_stream_connect_auth(dovecot_deliver_t)
-
-files_search_tmp(dovecot_deliver_t)
-
-fs_getattr_all_fs(dovecot_deliver_t)
-
-userdom_manage_user_home_content_dirs(dovecot_deliver_t)
-userdom_manage_user_home_content_files(dovecot_deliver_t)
-userdom_manage_user_home_content_symlinks(dovecot_deliver_t)
-userdom_manage_user_home_content_pipes(dovecot_deliver_t)
-userdom_manage_user_home_content_sockets(dovecot_deliver_t)
-userdom_user_home_dir_filetrans_user_home_content(dovecot_deliver_t, { dir file lnk_file fifo_file sock_file })
-
 tunable_policy(`use_nfs_home_dirs',`
 	fs_manage_nfs_dirs(dovecot_deliver_t)
 	fs_manage_nfs_files(dovecot_deliver_t)
 	fs_manage_nfs_symlinks(dovecot_deliver_t)
-	fs_manage_nfs_dirs(dovecot_t)
-	fs_manage_nfs_files(dovecot_t)
-	fs_manage_nfs_symlinks(dovecot_t)
 ')
 
 tunable_policy(`use_samba_home_dirs',`
 	fs_manage_cifs_dirs(dovecot_deliver_t)
 	fs_manage_cifs_files(dovecot_deliver_t)
 	fs_manage_cifs_symlinks(dovecot_deliver_t)
-	fs_manage_cifs_dirs(dovecot_t)
-	fs_manage_cifs_files(dovecot_t)
-	fs_manage_cifs_symlinks(dovecot_t)
 ')
 
 optional_policy(`
-	mta_manage_spool(dovecot_deliver_t)
+	mta_mailserver_delivery(dovecot_deliver_t)
+	mta_read_queue(dovecot_deliver_t)
+')
+
+optional_policy(`
+	postfix_use_fds_master(dovecot_deliver_t)
+')
+
+optional_policy(`
+	sendmail_domtrans(dovecot_deliver_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/dpkg.fc refpolicy/policy/modules/contrib/dpkg.fc
--- refpolicy/policy/modules/contrib/dpkg.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/dpkg.fc	2012-10-02 20:04:07.707011653 +0200
@@ -1,11 +1,8 @@
-# Debian package manager
-/usr/bin/debsums		--	gen_context(system_u:object_r:dpkg_exec_t,s0)
-/usr/bin/dpkg			--	gen_context(system_u:object_r:dpkg_exec_t,s0)
-# not sure if dselect should be in apt instead?
-/usr/bin/dselect		--	gen_context(system_u:object_r:dpkg_exec_t,s0)
+/usr/bin/debsums	--	gen_context(system_u:object_r:dpkg_exec_t,s0)
+/usr/bin/dpkg	--	gen_context(system_u:object_r:dpkg_exec_t,s0)
+/usr/bin/dselect	--	gen_context(system_u:object_r:dpkg_exec_t,s0)
 
-/var/lib/dpkg(/.*)?			gen_context(system_u:object_r:dpkg_var_lib_t,s0)
-# lockfile is treated specially, since used by apt, too
+/var/lib/dpkg(/.*)?	gen_context(system_u:object_r:dpkg_var_lib_t,s0)
 /var/lib/dpkg/(meth)?lock	--	gen_context(system_u:object_r:dpkg_lock_t,s0)
 
 /usr/sbin/dpkg-preconfigure	--	gen_context(system_u:object_r:dpkg_exec_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/dpkg.if refpolicy/policy/modules/contrib/dpkg.if
--- refpolicy/policy/modules/contrib/dpkg.if	2012-05-04 15:16:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/dpkg.if	2012-10-02 20:04:07.708011653 +0200
@@ -1,6 +1,4 @@
-## <summary>Policy for the Debian package manager.</summary>
-# TODO: need debconf policy
-# TODO: need install-menu policy
+## <summary>Debian package manager.</summary>
 
 ########################################
 ## <summary>
@@ -17,14 +15,14 @@
 		type dpkg_t, dpkg_exec_t;
 	')
 
-	files_search_usr($1)
 	corecmd_search_bin($1)
 	domtrans_pattern($1, dpkg_exec_t, dpkg_t)
 ')
 
 ########################################
 ## <summary>
-##	Execute dpkg_script programs in the dpkg_script domain.
+##	Execute dpkg_script programs in
+##	the dpkg_script domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -37,7 +35,6 @@
 		type dpkg_script_t;
 	')
 
-	# transition to dpkg script:
 	corecmd_shell_domtrans($1, dpkg_script_t)
 	allow dpkg_script_t $1:fd use;
 	allow dpkg_script_t $1:fifo_file rw_file_perms;
@@ -55,7 +52,7 @@
 ## </param>
 ## <param name="role">
 ##	<summary>
-##	The role to allow the dpkg domain.
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <rolecap/>
@@ -89,7 +86,7 @@
 
 ########################################
 ## <summary>
-##	Read from an unnamed dpkg pipe.
+##	Read from unnamed dpkg pipes.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -107,7 +104,7 @@
 
 ########################################
 ## <summary>
-##	Read and write an unnamed dpkg pipe.
+##	Read and write unnamed dpkg pipes.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -125,7 +122,8 @@
 
 ########################################
 ## <summary>
-##	Inherit and use file descriptors from dpkg scripts.
+##	Inherit and use file descriptors
+##	from dpkg scripts.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -143,7 +141,7 @@
 
 ########################################
 ## <summary>
-##	Read the dpkg package database.
+##	Read dpkg package database content.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -164,7 +162,8 @@
 
 ########################################
 ## <summary>
-##	Create, read, write, and delete the dpkg package database.
+##	Create, read, write, and delete
+##	dpkg package database content.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -184,8 +183,9 @@
 
 ########################################
 ## <summary>
-##	Do not audit attempts to create, read, 
-##	write, and delete the dpkg package database.
+##	Do not audit attempts to create,
+##	read, write, and delete dpkg
+##	package database content.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -205,7 +205,8 @@
 
 ########################################
 ## <summary>
-##	Lock the dpkg package database.
+##	Create, read, write, and delete
+##	dpkg lock files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/dpkg.te refpolicy/policy/modules/contrib/dpkg.te
--- refpolicy/policy/modules/contrib/dpkg.te	2012-07-25 20:33:04.000000000 +0200
+++ refpolicy/policy/modules/contrib/dpkg.te	2012-10-02 20:04:08.021011597 +0200
@@ -10,18 +10,15 @@
 
 type dpkg_t;
 type dpkg_exec_t;
-# dpkg can start/stop services
 init_system_domain(dpkg_t, dpkg_exec_t)
-# dpkg can change file labels, roles, IO
 domain_obj_id_change_exemption(dpkg_t)
 domain_role_change_exemption(dpkg_t)
 domain_system_change_exemption(dpkg_t)
 domain_interactive_fd(dpkg_t)
 role dpkg_roles types dpkg_t;
 
-# lockfile
 type dpkg_lock_t;
-files_type(dpkg_lock_t)
+files_lock_file(dpkg_lock_t)
 
 type dpkg_tmp_t;
 files_tmp_file(dpkg_tmp_t)
@@ -29,11 +26,9 @@
 type dpkg_tmpfs_t;
 files_tmpfs_file(dpkg_tmpfs_t)
 
-# status files
 type dpkg_var_lib_t alias var_lib_dpkg_t;
 files_type(dpkg_var_lib_t)
 
-# package scripts
 type dpkg_script_t;
 domain_type(dpkg_script_t)
 domain_entry_file(dpkg_t, dpkg_var_lib_t)
@@ -51,7 +46,7 @@
 
 ########################################
 #
-# dpkg Local policy
+# Local policy
 #
 
 allow dpkg_t self:capability { chown dac_override fowner fsetid setgid setuid kill sys_tty_config sys_nice sys_resource mknod linux_immutable };
@@ -82,7 +77,7 @@
 manage_fifo_files_pattern(dpkg_t, dpkg_tmpfs_t, dpkg_tmpfs_t)
 fs_tmpfs_filetrans(dpkg_t, dpkg_tmpfs_t, { dir file lnk_file sock_file fifo_file })
 
-# Access /var/lib/dpkg files
+allow dpkg_t dpkg_var_lib_t:file mmap_file_perms;
 manage_files_pattern(dpkg_t, dpkg_var_lib_t, dpkg_var_lib_t)
 files_var_lib_filetrans(dpkg_t, dpkg_var_lib_t, dir)
 
@@ -91,24 +86,18 @@
 
 corecmd_exec_all_executables(dpkg_t)
 
-# TODO: do we really need all networking?
 corenet_all_recvfrom_unlabeled(dpkg_t)
 corenet_all_recvfrom_netlabel(dpkg_t)
 corenet_tcp_sendrecv_generic_if(dpkg_t)
-corenet_raw_sendrecv_generic_if(dpkg_t)
-corenet_udp_sendrecv_generic_if(dpkg_t)
 corenet_tcp_sendrecv_generic_node(dpkg_t)
-corenet_raw_sendrecv_generic_node(dpkg_t)
-corenet_udp_sendrecv_generic_node(dpkg_t)
 corenet_tcp_sendrecv_all_ports(dpkg_t)
-corenet_udp_sendrecv_all_ports(dpkg_t)
-corenet_tcp_connect_all_ports(dpkg_t)
+
 corenet_sendrecv_all_client_packets(dpkg_t)
+corenet_tcp_connect_all_ports(dpkg_t)
 
 dev_list_sysfs(dpkg_t)
 dev_list_usbfs(dpkg_t)
 dev_read_urand(dpkg_t)
-#devices_manage_all_device_types(dpkg_t)
 
 domain_read_all_domains_state(dpkg_t)
 domain_getattr_all_domains(dpkg_t)
@@ -122,6 +111,10 @@
 domain_dontaudit_getattr_all_stream_sockets(dpkg_t)
 domain_dontaudit_getattr_all_dgram_sockets(dpkg_t)
 
+files_exec_etc_files(dpkg_t)
+files_relabel_non_auth_files(dpkg_t)
+files_manage_non_auth_files(dpkg_t)
+
 fs_manage_nfs_dirs(dpkg_t)
 fs_manage_nfs_files(dpkg_t)
 fs_manage_nfs_symlinks(dpkg_t)
@@ -140,15 +133,10 @@
 selinux_compute_user_contexts(dpkg_t)
 
 storage_raw_write_fixed_disk(dpkg_t)
-# for installing kernel packages
 storage_raw_read_fixed_disk(dpkg_t)
 
-files_relabel_non_auth_files(dpkg_t)
-files_manage_non_auth_files(dpkg_t)
 auth_dontaudit_read_shadow(dpkg_t)
 
-files_exec_etc_files(dpkg_t)
-
 init_domtrans_script(dpkg_t)
 init_use_script_ptys(dpkg_t)
 
@@ -158,7 +146,6 @@
 
 logging_send_syslog_msg(dpkg_t)
 
-# allow compiling and loading new policy
 seutil_manage_src_policy(dpkg_t)
 seutil_manage_bin_policy(dpkg_t)
 
@@ -167,19 +154,15 @@
 userdom_use_user_terminals(dpkg_t)
 userdom_use_unpriv_users_fds(dpkg_t)
 
-# transition to dpkg script:
 dpkg_domtrans_script(dpkg_t)
-# since the scripts aren't labeled correctly yet...
-allow dpkg_t dpkg_var_lib_t:file mmap_file_perms;
 
 optional_policy(`
 	apt_use_ptys(dpkg_t)
 ')
 
-# TODO: allow?
-#optional_policy(`
-#	cron_system_entry(dpkg_t,dpkg_exec_t)
-#')
+optional_policy(`
+	cron_system_entry(dpkg_t, dpkg_exec_t)
+')
 
 optional_policy(`
 	nis_use_ypbind(dpkg_t)
@@ -201,6 +184,7 @@
 seutil_run_loadpolicy(dpkg_t, dpkg_roles)
 seutil_run_setfiles(dpkg_t, dpkg_roles)
 userdom_use_all_users_fds(dpkg_t)
+
 optional_policy(`
 	mta_send_mail(dpkg_t)
 ')
@@ -211,9 +195,8 @@
 
 ########################################
 #
-# dpkg-script Local policy
+# Script Local policy
 #
-# TODO: actually use dpkg_script_t
 
 allow dpkg_script_t self:capability { chown dac_override dac_read_search fowner fsetid setgid setuid ipc_lock sys_chroot sys_nice mknod kill };
 allow dpkg_script_t self:process ~{ ptrace setcurrent setexec setfscreate setrlimit execmem execstack execheap };
@@ -247,9 +230,9 @@
 corecmd_exec_all_executables(dpkg_script_t)
 
 dev_list_sysfs(dpkg_script_t)
-# ideally we would not need this
-dev_manage_generic_blk_files(dpkg_script_t)
-dev_manage_generic_chr_files(dpkg_script_t)
+# Use named file transition to fix this
+# dev_manage_generic_blk_files(dpkg_script_t)
+# dev_manage_generic_chr_files(dpkg_script_t)
 dev_manage_all_blk_files(dpkg_script_t)
 dev_manage_all_chr_files(dpkg_script_t)
 
@@ -266,7 +249,6 @@
 
 fs_manage_nfs_files(dpkg_script_t)
 fs_getattr_nfs(dpkg_script_t)
-# why is this not using mount?
 fs_getattr_xattr_fs(dpkg_script_t)
 fs_mount_xattr_fs(dpkg_script_t)
 fs_unmount_xattr_fs(dpkg_script_t)
@@ -288,7 +270,6 @@
 term_use_all_terms(dpkg_script_t)
 
 auth_dontaudit_getattr_shadow(dpkg_script_t)
-# ideally we would not need this
 files_manage_non_auth_files(dpkg_script_t)
 
 init_domtrans_script(dpkg_script_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/dracut.fc refpolicy/policy/modules/contrib/dracut.fc
--- refpolicy/policy/modules/contrib/dracut.fc	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/dracut.fc	2012-07-17 17:30:26.058244645 +0200
@@ -0,0 +1,5 @@
+#
+# /usr
+#
+/usr/sbin/dracut	--	gen_context(system_u:object_r:dracut_exec_t,s0)
+/usr/bin/dracut	--	gen_context(system_u:object_r:dracut_exec_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/dracut.if refpolicy/policy/modules/contrib/dracut.if
--- refpolicy/policy/modules/contrib/dracut.if	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/dracut.if	2012-07-17 17:30:26.058244645 +0200
@@ -0,0 +1,67 @@
+## <summary>Dracut initramfs creation tool</summary>
+
+########################################
+## <summary>
+##	Execute the dracut program in the dracut domain.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed to transition.
+##	</summary>
+## </param>
+#
+interface(`dracut_domtrans',`
+	gen_require(`
+		type dracut_t, dracut_exec_t;
+	')
+
+	corecmd_search_bin($1)
+	domtrans_pattern($1, dracut_exec_t, dracut_t)
+')
+
+########################################
+## <summary>
+##	Execute dracut in the dracut domain, and
+##	allow the specified role the dracut domain.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed to transition.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+#
+interface(`dracut_run',`
+	gen_require(`
+		type dracut_t;
+	')
+
+	dracut_domtrans($1)
+	role $2 types dracut_t;
+')
+
+########################################
+## <summary>
+## 	Read/write dracut temporary files
+## </summary>
+## <param name="domain">
+##	<summary>
+##		Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`dracut_rw_tmp_files',`
+	gen_require(`
+		type dracut_tmp_t;
+	')
+
+	files_search_var($1)
+	files_search_tmp($1)
+
+	rw_files_pattern($1, dracut_tmp_t, dracut_tmp_t)
+')
+
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/dracut.te refpolicy/policy/modules/contrib/dracut.te
--- refpolicy/policy/modules/contrib/dracut.te	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/dracut.te	2012-07-17 17:30:26.058244645 +0200
@@ -0,0 +1,67 @@
+policy_module(dracut, 1.0)
+
+type dracut_t;
+type dracut_exec_t;
+application_domain(dracut_t, dracut_exec_t)
+
+type dracut_var_log_t;
+logging_log_file(dracut_var_log_t)
+
+type dracut_tmp_t;
+files_tmp_file(dracut_tmp_t)
+
+########################################
+#
+# Local policy
+#
+allow dracut_t self:process setfscreate;
+allow dracut_t self:capability dac_override;
+allow dracut_t self:fifo_file rw_fifo_file_perms;
+allow dracut_t self:unix_stream_socket create_stream_socket_perms;
+
+manage_files_pattern(dracut_t, dracut_tmp_t, dracut_tmp_t)
+manage_dirs_pattern(dracut_t, dracut_tmp_t, dracut_tmp_t)
+manage_lnk_files_pattern(dracut_t, dracut_tmp_t, dracut_tmp_t)
+manage_chr_files_pattern(dracut_t, dracut_tmp_t, dracut_tmp_t)
+files_tmp_filetrans(dracut_t, dracut_tmp_t, dir)
+
+manage_files_pattern(dracut_t, dracut_var_log_t, dracut_var_log_t)
+logging_log_filetrans(dracut_t, dracut_var_log_t, file)
+
+kernel_read_messages(dracut_t)
+kernel_read_system_state(dracut_t)
+
+corecmd_exec_bin(dracut_t)
+corecmd_exec_shell(dracut_t)
+corecmd_mmap_all_executables(dracut_t)
+
+dev_read_kmsg(dracut_t)
+dev_read_sysfs(dracut_t)
+
+domain_use_interactive_fds(dracut_t)
+
+files_create_kernel_img(dracut_t)
+files_read_etc_files(dracut_t)
+files_read_kernel_modules(dracut_t)
+files_read_usr_files(dracut_t)
+files_search_pids(dracut_t)
+
+libs_exec_ldconfig(dracut_t)
+libs_exec_ld_so(dracut_t)
+libs_exec_lib_files(dracut_t)
+
+miscfiles_read_localization(dracut_t)
+
+modutils_list_module_config(dracut_t) #find /etc/modprobe.d
+modutils_read_module_config(dracut_t)
+modutils_read_module_deps(dracut_t)
+
+udev_read_rules_files(dracut_t)
+
+userdom_search_user_home_dirs(dracut_t)
+userdom_use_user_terminals(dracut_t)
+
+optional_policy(`
+	lvm_read_config(dracut_t)
+')
+
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/drbd.fc refpolicy/policy/modules/contrib/drbd.fc
--- refpolicy/policy/modules/contrib/drbd.fc	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/drbd.fc	2012-09-27 20:03:30.749126498 +0200
@@ -0,0 +1,13 @@
+/etc/rc\.d/init\.d/drbd	--	gen_context(system_u:object_r:drbd_initrc_exec_t,s0)
+
+/sbin/drbdadm	--	gen_context(system_u:object_r:drbd_exec_t,s0)
+/sbin/drbdsetup	--	gen_context(system_u:object_r:drbd_exec_t,s0)
+
+/usr/lib/ocf/resource.\d/linbit/drbd	--	gen_context(system_u:object_r:drbd_exec_t,s0)
+
+/usr/sbin/drbdadm	--	gen_context(system_u:object_r:drbd_exec_t,s0)
+/usr/sbin/drbdsetup	--	gen_context(system_u:object_r:drbd_exec_t,s0)
+
+/var/lib/drbd(/.*)?	gen_context(system_u:object_r:drbd_var_lib_t,s0)
+
+/var/lock/subsys/drbd	--	gen_context(system_u:object_r:drbd_lock_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/drbd.if refpolicy/policy/modules/contrib/drbd.if
--- refpolicy/policy/modules/contrib/drbd.if	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/drbd.if	2012-09-27 20:03:30.749126498 +0200
@@ -0,0 +1,59 @@
+## <summary>Mirrors a block device over the network to another machine.</summary>
+
+########################################
+## <summary>
+##	Execute a domain transition to
+##	run drbd.
+## </summary>
+## <param name="domain">
+## <summary>
+##	Domain allowed to transition.
+## </summary>
+## </param>
+#
+interface(`drbd_domtrans',`
+	gen_require(`
+		type drbd_t, drbd_exec_t;
+	')
+
+	corecmd_search_bin($1)
+	domtrans_pattern($1, drbd_exec_t, drbd_t)
+')
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an drbd environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`drbd_admin',`
+	gen_require(`
+		type drbd_t, drbd_initrc_exec_t, drbd_lock_t;
+		type drbd_var_lib_t;
+	')
+
+	allow $1 drbd_t:process { ptrace signal_perms };
+	ps_process_pattern($1, drbd_t)
+
+	init_labeled_script_domtrans($1, drbd_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 drbd_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	files_search_locks($1)
+	admin_pattern($1, drbd_lock_t)
+
+	files_search_var_lib($1)
+	admin_pattern($1, drbd_var_lib_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/drbd.te refpolicy/policy/modules/contrib/drbd.te
--- refpolicy/policy/modules/contrib/drbd.te	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/drbd.te	2012-10-06 19:02:55.647741480 +0200
@@ -0,0 +1,55 @@
+policy_module(drbd, 1.0.1)
+
+########################################
+#
+# Declarations
+#
+
+type drbd_t;
+type drbd_exec_t;
+init_daemon_domain(drbd_t, drbd_exec_t)
+
+type drbd_initrc_exec_t;
+init_script_file(drbd_initrc_exec_t)
+
+type drbd_var_lib_t;
+files_type(drbd_var_lib_t)
+
+type drbd_lock_t;
+files_lock_file(drbd_lock_t)
+
+########################################
+#
+# Local policy
+#
+
+allow drbd_t self:capability { kill net_admin };
+dontaudit drbd_t self:capability sys_tty_config;
+allow drbd_t self:fifo_file rw_fifo_file_perms;
+allow drbd_t self:unix_stream_socket create_stream_socket_perms;
+allow drbd_t self:netlink_socket create_socket_perms;
+allow drbd_t self:netlink_route_socket nlmsg_write;
+
+manage_dirs_pattern(drbd_t, drbd_var_lib_t, drbd_var_lib_t)
+manage_files_pattern(drbd_t, drbd_var_lib_t, drbd_var_lib_t)
+manage_lnk_files_pattern(drbd_t, drbd_var_lib_t, drbd_var_lib_t)
+files_var_lib_filetrans(drbd_t, drbd_var_lib_t, dir)
+
+manage_files_pattern(drbd_t, drbd_lock_t, drbd_lock_t)
+files_lock_filetrans(drbd_t, drbd_lock_t, file)
+
+can_exec(drbd_t, drbd_exec_t)
+
+kernel_read_system_state(drbd_t)
+
+dev_read_rand(drbd_t)
+dev_read_sysfs(drbd_t)
+dev_read_urand(drbd_t)
+
+files_read_etc_files(drbd_t)
+
+storage_raw_read_fixed_disk(drbd_t)
+
+miscfiles_read_localization(drbd_t)
+
+sysnet_dns_name_resolve(drbd_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/dspam.fc refpolicy/policy/modules/contrib/dspam.fc
--- refpolicy/policy/modules/contrib/dspam.fc	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/dspam.fc	2012-09-24 21:19:41.307583015 +0200
@@ -0,0 +1,12 @@
+/etc/rc\.d/init\.d/dspam	--	gen_context(system_u:object_r:dspam_initrc_exec_t,s0)
+
+/usr/bin/dspam	--	gen_context(system_u:object_r:dspam_exec_t,s0)
+
+/usr/share/dspam-web/dspam\.cgi	--	gen_context(system_u:object_r:httpd_dspam_script_exec_t,s0)
+
+/var/lib/dspam(/.*)?	gen_context(system_u:object_r:dspam_var_lib_t,s0)
+/var/lib/dspam/data(/.*)?	gen_context(system_u:object_r:httpd_dspam_rw_content_t,s0)
+
+/var/log/dspam(/.*)?	gen_context(system_u:object_r:dspam_log_t,s0)
+
+/var/run/dspam(/.*)?	gen_context(system_u:object_r:dspam_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/dspam.if refpolicy/policy/modules/contrib/dspam.if
--- refpolicy/policy/modules/contrib/dspam.if	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/dspam.if	2012-10-19 09:47:23.211491876 +0200
@@ -0,0 +1,82 @@
+## <summary>Content-based spam filter designed for multi-user enterprise systems.</summary>
+
+########################################
+## <summary>
+##	Execute a domain transition to run dspam.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`dspam_domtrans',`
+	gen_require(`
+		type dspam_t, dspam_exec_t;
+	')
+
+	corecmd_search_bin($1)
+	domtrans_pattern($1, dspam_exec_t, dspam_t)
+')
+
+#######################################
+## <summary>
+##	Connect to dspam using a unix
+##	domain stream socket.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`dspam_stream_connect',`
+	gen_require(`
+		type dspam_t, dspam_var_run_t, dspam_tmp_t;
+	')
+
+	files_search_pids($1)
+	files_search_tmp($1)
+	stream_connect_pattern($1, { dspam_tmp_t dspam_var_run_t }, { dspam_tmp_t dspam_var_run_t }, dspam_t)
+')
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an dspam environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`dspam_admin',`
+	gen_require(`
+		type dspam_t, dspam_initrc_exec_t, dspam_log_t;
+		type dspam_var_lib_t, dspam_var_run_t;
+	')
+
+	allow $1 dspam_t:process { ptrace signal_perms };
+	ps_process_pattern($1, dspam_t)
+
+	init_labeled_script_domtrans($1, dspam_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 dspam_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	logging_search_logs($1)
+	admin_pattern($1, dspam_log_t)
+
+	files_search_var_lib($1)
+	admin_pattern($1, dspam_var_lib_t)
+
+	files_search_pids($1)
+	admin_pattern($1, dspam_var_run_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/dspam.te refpolicy/policy/modules/contrib/dspam.te
--- refpolicy/policy/modules/contrib/dspam.te	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/dspam.te	2012-10-19 09:47:23.212491876 +0200
@@ -0,0 +1,84 @@
+policy_module(dspam, 1.0.3)
+
+########################################
+#
+# Declarations
+#
+
+type dspam_t;
+type dspam_exec_t;
+init_daemon_domain(dspam_t, dspam_exec_t)
+
+type dspam_initrc_exec_t;
+init_script_file(dspam_initrc_exec_t)
+
+type dspam_log_t;
+logging_log_file(dspam_log_t)
+
+type dspam_var_lib_t;
+files_type(dspam_var_lib_t)
+
+type dspam_var_run_t;
+files_pid_file(dspam_var_run_t)
+
+########################################
+#
+# Local policy
+#
+
+allow dspam_t self:capability net_admin;
+allow dspam_t self:process signal;
+allow dspam_t self:fifo_file rw_fifo_file_perms;
+allow dspam_t self:unix_stream_socket { accept listen };
+
+manage_dirs_pattern(dspam_t, dspam_log_t, dspam_log_t)
+append_files_pattern(dspam_t, dspam_log_t, dspam_log_t)
+create_files_pattern(dspam_t, dspam_log_t, dspam_log_t)
+setattr_files_pattern(dspam_t, dspam_log_t, dspam_log_t)
+logging_log_filetrans(dspam_t, dspam_log_t, dir)
+
+manage_dirs_pattern(dspam_t, dspam_var_lib_t, dspam_var_lib_t)
+manage_files_pattern(dspam_t, dspam_var_lib_t, dspam_var_lib_t)
+files_var_lib_filetrans(dspam_t, dspam_var_lib_t, dir)
+
+manage_dirs_pattern(dspam_t, dspam_var_run_t, dspam_var_run_t)
+manage_files_pattern(dspam_t, dspam_var_run_t, dspam_var_run_t)
+files_pid_filetrans(dspam_t, dspam_var_run_t, dir)
+
+corenet_all_recvfrom_unlabeled(dspam_t)
+corenet_all_recvfrom_netlabel(dspam_t)
+corenet_tcp_sendrecv_generic_if(dspam_t)
+corenet_tcp_sendrecv_generic_node(dspam_t)
+corenet_tcp_bind_generic_node(dspam_t)
+
+corenet_sendrecv_spamd_client_packets(dspam_t)
+corenet_tcp_connect_spamd_port(dspam_t)
+corenet_tcp_sendrecv_spamd_port(dspam_t)
+
+auth_use_nsswitch(dspam_t)
+
+logging_send_syslog_msg(dspam_t)
+
+miscfiles_read_localization(dspam_t)
+
+optional_policy(`
+	apache_content_template(dspam)
+
+	list_dirs_pattern(dspam_t, httpd_dspam_content_t, httpd_dspam_content_t)
+	manage_dirs_pattern(dspam_t, httpd_dspam_rw_content_t, httpd_dspam_rw_content_t)
+	manage_files_pattern(dspam_t, httpd_dspam_rw_content_t, httpd_dspam_rw_content_t)
+')
+
+optional_policy(`
+	mysql_stream_connect(dspam_t)
+	mysql_read_config(dspam_t)
+
+	mysql_tcp_connect(dspam_t)
+')
+
+optional_policy(`
+	postgresql_stream_connect(dspam_t)
+	postgresql_unpriv_client(dspam_t)
+
+	postgresql_tcp_connect(dspam_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/entropyd.fc refpolicy/policy/modules/contrib/entropyd.fc
--- refpolicy/policy/modules/contrib/entropyd.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/entropyd.fc	2012-10-02 20:04:15.059012006 +0200
@@ -1,8 +1,7 @@
-#
-# /usr
-#
+/etc/rc\.d/init\.d/((audio-entropyd)|(haveged))	--	gen_context(system_u:object_r:entropyd_initrc_exec_t,s0)
+
 /usr/sbin/audio-entropyd	--	gen_context(system_u:object_r:entropyd_exec_t,s0)
-/usr/sbin/haveged		--	gen_context(system_u:object_r:entropyd_exec_t,s0)
+/usr/sbin/haveged	--	gen_context(system_u:object_r:entropyd_exec_t,s0)
 
 /var/run/audio-entropyd\.pid	--	gen_context(system_u:object_r:entropyd_var_run_t,s0)
 /var/run/haveged\.pid		--	gen_context(system_u:object_r:entropyd_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/entropyd.if refpolicy/policy/modules/contrib/entropyd.if
--- refpolicy/policy/modules/contrib/entropyd.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/entropyd.if	2012-10-02 20:04:15.060011995 +0200
@@ -1 +1,35 @@
-## <summary>Generate entropy from audio input</summary>
+## <summary>Generate entropy from audio input.</summary>
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an entropyd environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`entropyd_admin',`
+	gen_require(`
+		type entropyd_t, entropyd_initrc_exec_t, entropyd_var_run_t;
+	')
+
+	allow $1 entropyd_t:process { ptrace signal_perms };
+	ps_process_pattern($1, entropyd_t)
+
+	init_labeled_script_domtrans($1, entropyd_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 entropyd_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	files_search_pids($1)
+	admin_pattern($1, entropyd_var_run_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/entropyd.te refpolicy/policy/modules/contrib/entropyd.te
--- refpolicy/policy/modules/contrib/entropyd.te	2012-05-04 15:16:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/entropyd.te	2012-10-30 19:31:30.251399437 +0100
@@ -1,4 +1,4 @@
-policy_module(entropyd, 1.7.0)
+policy_module(entropyd, 1.7.2)
 
 ########################################
 #
@@ -6,9 +6,11 @@
 #
 
 ## <desc>
-## <p>
-##   Allow the use of the audio devices as the source for the entropy feeds
-## </p>
+##	<p>
+##	Determine whether entropyd can use
+##	audio devices as the source for
+##	the entropy feeds.
+##	</p>
 ## </desc>
 gen_tunable(entropyd_use_audio, false)
 
@@ -16,6 +18,9 @@
 type entropyd_exec_t;
 init_daemon_domain(entropyd_t, entropyd_exec_t)
 
+type entropyd_initrc_exec_t;
+init_script_file(entropyd_initrc_exec_t)
+
 type entropyd_var_run_t;
 files_pid_file(entropyd_var_run_t)
 
@@ -27,14 +32,12 @@
 allow entropyd_t self:capability { dac_override ipc_lock sys_admin };
 dontaudit entropyd_t self:capability sys_tty_config;
 allow entropyd_t self:process signal_perms;
-allow entropyd_t self:unix_dgram_socket create_socket_perms;
 
 manage_files_pattern(entropyd_t, entropyd_var_run_t, entropyd_var_run_t)
 files_pid_filetrans(entropyd_t, entropyd_var_run_t, file)
 
+kernel_read_system_state(entropyd_t)
 kernel_rw_kernel_sysctl(entropyd_t)
-kernel_list_proc(entropyd_t)
-kernel_read_proc_symlinks(entropyd_t)
 
 dev_read_sysfs(entropyd_t)
 dev_read_urand(entropyd_t)
@@ -59,8 +62,6 @@
 
 tunable_policy(`entropyd_use_audio',`
 	dev_read_sound(entropyd_t)
-	# set sound card parameters such as sample format, number of channels
-	# and sample rate.
 	dev_write_sound(entropyd_t)
 ')
 
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/evolution.fc refpolicy/policy/modules/contrib/evolution.fc
--- refpolicy/policy/modules/contrib/evolution.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/evolution.fc	2012-10-10 21:34:06.791026179 +0200
@@ -1,21 +1,14 @@
-#
-# HOME_DIR/
-#
+HOME_DIR/\.camel_certs(/.*)?	gen_context(system_u:object_r:evolution_home_t,s0)
+HOME_DIR/\.evolution(/.*)?	gen_context(system_u:object_r:evolution_home_t,s0)
 
-HOME_DIR/\.camel_certs(/.*)?					gen_context(system_u:object_r:evolution_home_t,s0)
-HOME_DIR/\.evolution(/.*)?					gen_context(system_u:object_r:evolution_home_t,s0)
+/tmp/\.exchange-USER(/.*)?	gen_context(system_u:object_r:evolution_exchange_tmp_t,s0)
 
-#
-# /tmp
-#
-/tmp/\.exchange-USER(/.*)?					gen_context(system_u:object_r:evolution_exchange_tmp_t,s0)
+/usr/bin/evolution.*	--	gen_context(system_u:object_r:evolution_exec_t,s0)
 
-#
-# /usr
-#
-/usr/bin/evolution.*					--	gen_context(system_u:object_r:evolution_exec_t,s0)
+/usr/lib/evolution/[^/]*/evolution-alarm-notify	--	gen_context(system_u:object_r:evolution_alarm_exec_t,s0)
+/usr/lib/evolution-webcal/evolution-webcal	--	gen_context(system_u:object_r:evolution_webcal_exec_t,s0)
 
 /usr/libexec/evolution/.*evolution-alarm-notify.*	--	gen_context(system_u:object_r:evolution_alarm_exec_t,s0)
 /usr/libexec/evolution/.*evolution-exchange-storage.*	--	gen_context(system_u:object_r:evolution_exchange_exec_t,s0)
-/usr/libexec/evolution-data-server.*			--	gen_context(system_u:object_r:evolution_server_exec_t,s0)
-/usr/libexec/evolution-webcal.*				--	gen_context(system_u:object_r:evolution_webcal_exec_t,s0)
+/usr/libexec/evolution-data-server.*	--	gen_context(system_u:object_r:evolution_server_exec_t,s0)
+/usr/libexec/evolution-webcal.*	--	gen_context(system_u:object_r:evolution_webcal_exec_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/evolution.if refpolicy/policy/modules/contrib/evolution.if
--- refpolicy/policy/modules/contrib/evolution.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/evolution.if	2012-10-08 20:15:43.630034128 +0200
@@ -1,32 +1,33 @@
-## <summary>Evolution email client</summary>
+## <summary>Evolution email client.</summary>
 
 ########################################
 ## <summary>
-##	Role access for evolution
+##	Role access for evolution.
 ## </summary>
 ## <param name="role">
 ##	<summary>
-##	Role allowed access
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <param name="domain">
 ##	<summary>
-##	User domain for the role
+##	User domain for the role.
 ##	</summary>
 ## </param>
 #
 interface(`evolution_role',`
 	gen_require(`
+		attribute_role evolution_roles;
 		type evolution_t, evolution_exec_t, evolution_home_t;
-		type evolution_alarm_t, evolution_alarm_exec_t;
-		type evolution_exchange_t, evolution_exchange_exec_t;
-		type evolution_exchange_orbit_tmp_t;
-		type evolution_server_t, evolution_server_exec_t;
-		type evolution_webcal_t, evolution_webcal_exec_t;
+		type evolution_alarm_t, evolution_alarm_exec_t, evolution_alarm_orbit_tmp_t;
+		type evolution_exchange_t, evolution_exchange_exec_t, evolution_exchange_tmp_t;
+		type evolution_exchange_orbit_tmp_t, evolution_orbit_tmp_t, evolution_server_orbit_tmp_t;
+		type evolution_server_t, evolution_server_exec_t, evolution_webcal_t;
+		type evolution_webcal_exec_t, evolution_alarm_tmpfs_t, evolution_exchange_tmpfs_t;
+		type evolution_tmpfs_t, evolution_webcal_tmpfs_t;
 	')
 
-	role $1 types { evolution_t evolution_alarm_t evolution_exchange_t };
-	role $1 types { evolution_server_t evolution_webcal_t };
+	roleattribute $1 evolution_roles;
 
 	domtrans_pattern($2, evolution_exec_t, evolution_t)
 	domtrans_pattern($2, evolution_alarm_exec_t, evolution_alarm_t)
@@ -34,51 +35,64 @@
 	domtrans_pattern($2, evolution_server_exec_t, evolution_server_t)
 	domtrans_pattern($2, evolution_webcal_exec_t, evolution_webcal_t)
 
-	ps_process_pattern($2, evolution_t)
-	ps_process_pattern($2, evolution_alarm_t)
-	ps_process_pattern($2, evolution_exchange_t)
-	ps_process_pattern($2, evolution_server_t)
-	ps_process_pattern($2, evolution_webcal_t)
-
-	allow evolution_t $2:dir search;
-	allow evolution_t $2:file read;
-	allow evolution_t $2:lnk_file read;
-	allow evolution_t $2:unix_stream_socket connectto;
-
-	allow $2 evolution_t:unix_stream_socket connectto;
-	allow $2 evolution_t:process noatsecure;
-	allow $2 evolution_t:process signal_perms;
-
-	# Access .evolution
-	allow $2 evolution_home_t:dir manage_dir_perms;
-	allow $2 evolution_home_t:file manage_file_perms;
-	allow $2 evolution_home_t:lnk_file manage_lnk_file_perms;
-	allow $2 evolution_home_t:{ dir file lnk_file } { relabelfrom relabelto };
-
-	allow evolution_exchange_t $2:unix_stream_socket connectto;
-
-	# Clock applet talks to exchange (FIXME: Needs policy)
-	allow $2 evolution_exchange_t:unix_stream_socket connectto;
-	allow $2 evolution_exchange_orbit_tmp_t:sock_file write;
+	allow $2 { evolution_t evolution_alarm_t evolution_exchange_t evolution_server_t evolution_webcal_t }:process { noatsecure ptrace signal_perms };
+	ps_process_pattern($2, { evolution_t evolution_alarm_t evolution_exchange_t })
+	ps_process_pattern($2, { evolution_server_t evolution_webcal_t })
+
+	allow evolution_t $2:dir search_dir_perms;
+	allow evolution_t $2:file read_file_perms;
+	allow evolution_t $2:lnk_file read_lnk_file_perms;
+
+	allow $2 evolution_home_t:dir { relabel_dir_perms manage_dir_perms };
+	allow $2 evolution_home_t:file { relabel_file_perms manage_file_perms };
+	allow $2 evolution_home_t:lnk_file { relabel_lnk_file_perms manage_lnk_file_perms };
+
+	userdom_user_home_dir_filetrans($2, evolution_home_t, dir, ".camel_certs")
+	userdom_user_home_dir_filetrans($2, evolution_home_t, dir, ".evolution")
+
+	allow $2 evolution_exchange_tmp_t:dir { manage_dir_perms relabel_dir_perms };
+	allow $2 { evolution_alarm_orbit_tmp_t evolution_exchange_orbit_tmp_t evolution_orbit_tmp_t evolution_server_orbit_tmp_t }:sock_file { manage_sock_file_perms relabel_sock_file_perms };
+
+	allow $2 { evolution_alarm_tmpfs_t evolution_exchange_tmpfs_t evolution_tmpfs_t evolution_webcal_tmpfs_t }:dir { manage_dir_perms relabel_dir_perms };
+	allow $2 { evolution_alarm_tmpfs_t evolution_exchange_tmpfs_t evolution_tmpfs_t evolution_webcal_tmpfs_t }:file { manage_file_perms relabel_file_perms };
+	allow $2 { evolution_alarm_tmpfs_t evolution_exchange_tmpfs_t evolution_tmpfs_t evolution_webcal_tmpfs_t }:lnk_file { manage_lnk_file_perms relabel_lnk_file_perms };
+	allow $2 { evolution_alarm_tmpfs_t evolution_exchange_tmpfs_t evolution_tmpfs_t evolution_webcal_tmpfs_t }:sock_file { manage_sock_file_perms relabel_sock_file_perms };
+	allow $2 { evolution_alarm_tmpfs_t evolution_exchange_tmpfs_t evolution_tmpfs_t evolution_webcal_tmpfs_t }:fifo_file { manage_fifo_file_perms relabel_fifo_file_perms };
+
+	allow { evolution_t evolution_exchange_t } $2:unix_stream_socket connectto;
+
+	stream_connect_pattern($2, evolution_orbit_tmp_t, evolution_orbit_tmp_t, evolution_t)
+	stream_connect_pattern($2, evolution_exchange_orbit_tmp_t, evolution_exchange_orbit_tmp_t, evolution_exchange_t)
+
+	optional_policy(`
+		evolution_dbus_chat($2)
+		evolution_alarm_dbus_chat($2)
+	')
 ')
 
 ########################################
 ## <summary>
-##	Create objects in users evolution home folders.
+##	Create objects in the evolution home
+##	directories with a private type.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
 ##	Domain allowed access.
 ##	</summary>
 ## </param>
-## <param name="file_type">
+## <param name="private_type">
 ##	<summary>
 ##	Private file type.
 ##	</summary>
 ## </param>
-## <param name="class">
+## <param name="object_class">
 ##	<summary>
-##	The object class of the object being created.
+##	Class of the object being created.
+##	</summary>
+## </param>
+## <param name="name" optional="true">
+##	<summary>
+##	The name of the object being created.
 ##	</summary>
 ## </param>
 #
@@ -87,13 +101,14 @@
 		type evolution_home_t;
 	')
 
-	allow $1 evolution_home_t:dir rw_dir_perms;
-	type_transition $1 evolution_home_t:$3 $2;
+	userdom_search_user_home_dirs($1)
+	filetrans_pattern($1, evolution_home_t, $2, $3, $4)
 ')
 
 ########################################
 ## <summary>
-##	Connect to evolution unix stream socket.
+##	Connect to evolution using a unix
+##	domain stream socket.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -103,11 +118,12 @@
 #
 interface(`evolution_stream_connect',`
 	gen_require(`
-		type evolution_t, evolution_home_t;
+		type evolution_t, evolution_orbit_tmp_t;
 	')
 
-	allow $1 evolution_t:unix_stream_socket connectto;
-	allow $1 evolution_home_t:dir search;
+
+	files_search_tmp($1)
+	stream_connect_pattern($1, evolution_orbit_tmp_t, evolution_orbit_tmp_t, evolution_t)
 ')
 
 ########################################
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/evolution.te refpolicy/policy/modules/contrib/evolution.te
--- refpolicy/policy/modules/contrib/evolution.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/evolution.te	2012-10-13 21:33:18.439579251 +0200
@@ -1,21 +1,25 @@
-policy_module(evolution, 2.3.0)
+policy_module(evolution, 2.3.7)
 
 ########################################
 #
 # Declarations
 #
 
+attribute_role evolution_roles;
+
 type evolution_t;
 type evolution_exec_t;
 typealias evolution_t alias { user_evolution_t staff_evolution_t sysadm_evolution_t };
 typealias evolution_t alias { auditadm_evolution_t secadm_evolution_t };
 userdom_user_application_domain(evolution_t, evolution_exec_t)
+role evolution_roles types evolution_t;
 
 type evolution_alarm_t;
 type evolution_alarm_exec_t;
 typealias evolution_alarm_t alias { user_evolution_alarm_t staff_evolution_alarm_t sysadm_evolution_alarm_t };
 typealias evolution_alarm_t alias { auditadm_evolution_alarm_t secadm_evolution_alarm_t };
 userdom_user_application_domain(evolution_alarm_t, evolution_alarm_exec_t)
+role evolution_roles types evolution_alarm_t;
 
 type evolution_alarm_tmpfs_t;
 typealias evolution_alarm_tmpfs_t alias { user_evolution_alarm_tmpfs_t staff_evolution_alarm_tmpfs_t sysadm_evolution_alarm_tmpfs_t };
@@ -32,6 +36,7 @@
 typealias evolution_exchange_t alias { user_evolution_exchange_t staff_evolution_exchange_t sysadm_evolution_exchange_t };
 typealias evolution_exchange_t alias { auditadm_evolution_exchange_t secadm_evolution_exchange_t };
 userdom_user_application_domain(evolution_exchange_t, evolution_exchange_exec_t)
+role evolution_roles types evolution_exchange_t;
 
 type evolution_exchange_tmpfs_t;
 typealias evolution_exchange_tmpfs_t alias { user_evolution_exchange_tmpfs_t staff_evolution_exchange_tmpfs_t sysadm_evolution_exchange_tmpfs_t };
@@ -63,6 +68,7 @@
 typealias evolution_server_t alias { user_evolution_server_t staff_evolution_server_t sysadm_evolution_server_t };
 typealias evolution_server_t alias { auditadm_evolution_server_t secadm_evolution_server_t };
 userdom_user_application_domain(evolution_server_t, evolution_server_exec_t)
+role evolution_roles types evolution_server_t;
 
 type evolution_server_orbit_tmp_t;
 typealias evolution_server_orbit_tmp_t alias { user_evolution_server_orbit_tmp_t staff_evolution_server_orbit_tmp_t sysadm_evolution_server_orbit_tmp_t };
@@ -79,6 +85,7 @@
 typealias evolution_webcal_t alias { user_evolution_webcal_t staff_evolution_webcal_t sysadm_evolution_webcal_t };
 typealias evolution_webcal_t alias { auditadm_evolution_webcal_t secadm_evolution_webcal_t };
 userdom_user_application_domain(evolution_webcal_t, evolution_webcal_exec_t)
+role evolution_roles types evolution_webcal_t;
 
 type evolution_webcal_tmpfs_t;
 typealias evolution_webcal_tmpfs_t alias { user_evolution_webcal_tmpfs_t staff_evolution_webcal_tmpfs_t sysadm_evolution_webcal_tmpfs_t };
@@ -87,30 +94,18 @@
 
 ########################################
 #
-# Evolution local policy
+# Local policy
 #
 
 allow evolution_t self:capability { setuid setgid sys_nice };
 allow evolution_t self:process { signal getsched setsched };
 allow evolution_t self:fifo_file rw_file_perms;
-allow evolution_t self:tcp_socket create_socket_perms;
-allow evolution_t self:udp_socket create_socket_perms;
-
-allow evolution_t evolution_alarm_t:dir search_dir_perms;
-allow evolution_t evolution_alarm_t:file read;
-
-allow evolution_t evolution_alarm_t:unix_stream_socket connectto;
-allow evolution_t evolution_alarm_orbit_tmp_t:sock_file write;
-
-can_exec(evolution_t, evolution_alarm_exec_t)
-
-allow evolution_t evolution_exchange_t:unix_stream_socket connectto;
-allow evolution_t evolution_exchange_orbit_tmp_t:sock_file write;
 
 allow evolution_t evolution_home_t:dir manage_dir_perms;
 allow evolution_t evolution_home_t:file manage_file_perms;
 allow evolution_t evolution_home_t:lnk_file manage_lnk_file_perms;
-userdom_search_user_home_dirs(evolution_t)
+userdom_user_home_dir_filetrans(evolution_t, evolution_home_t, dir, ".evolution")
+userdom_user_home_dir_filetrans(evolution_t, evolution_home_t, dir, ".camel_certs")
 
 allow evolution_t evolution_orbit_tmp_t:dir manage_dir_perms;
 allow evolution_t evolution_orbit_tmp_t:file manage_file_perms;
@@ -120,14 +115,6 @@
 allow evolution_server_t evolution_orbit_tmp_t:file manage_file_perms;
 files_tmp_filetrans(evolution_server_t, evolution_orbit_tmp_t, { dir file })
 
-allow evolution_t evolution_server_t:dir search_dir_perms;
-allow evolution_t evolution_server_t:file read;
-
-allow evolution_t evolution_server_t:unix_stream_socket connectto;
-allow evolution_t evolution_server_orbit_tmp_t:sock_file write;
-
-can_exec(evolution_t, evolution_server_exec_t)
-
 allow evolution_t evolution_tmpfs_t:dir rw_dir_perms;
 allow evolution_t evolution_tmpfs_t:file manage_file_perms;
 allow evolution_t evolution_tmpfs_t:lnk_file manage_lnk_file_perms;
@@ -135,16 +122,22 @@
 allow evolution_t evolution_tmpfs_t:fifo_file manage_fifo_file_perms;
 fs_tmpfs_filetrans(evolution_t, evolution_tmpfs_t, { dir file lnk_file sock_file fifo_file })
 
-#FIXME check to see if really needed
+allow evolution_t { evolution_alarm_t evolution_server_t }:dir search_dir_perms;
+allow evolution_t { evolution_alarm_t evolution_server_t }:file read_file_perms;
+
+stream_connect_pattern(evolution_t, evolution_alarm_orbit_tmp_t, evolution_alarm_orbit_tmp_t, evolution_alarm_t)
+stream_connect_pattern(evolution_t, evolution_exchange_orbit_tmp_t, evolution_exchange_orbit_tmp_t, evolution_exchange_t)
+stream_connect_pattern(evolution_t, evolution_server_orbit_tmp_t, evolution_server_orbit_tmp_t, evolution_server_t)
+
+can_exec(evolution_t, { evolution_alarm_exec_t evolution_server_exec_t })
+
 kernel_read_kernel_sysctls(evolution_t)
 kernel_read_system_state(evolution_t)
-# Allow netstat
 kernel_read_network_state(evolution_t)
 kernel_read_net_sysctls(evolution_t)
 
-corecmd_exec_shell(evolution_t)
-# Run various programs
 corecmd_exec_bin(evolution_t)
+corecmd_exec_shell(evolution_t)
 
 corenet_all_recvfrom_unlabeled(evolution_t)
 corenet_all_recvfrom_netlabel(evolution_t)
@@ -153,65 +146,67 @@
 corenet_raw_sendrecv_generic_if(evolution_t)
 corenet_tcp_sendrecv_generic_node(evolution_t)
 corenet_udp_sendrecv_generic_node(evolution_t)
-corenet_tcp_sendrecv_pop_port(evolution_t)
-corenet_udp_sendrecv_pop_port(evolution_t)
-corenet_tcp_sendrecv_smtp_port(evolution_t)
-corenet_udp_sendrecv_smtp_port(evolution_t)
-corenet_tcp_sendrecv_innd_port(evolution_t)
-corenet_udp_sendrecv_innd_port(evolution_t)
-corenet_tcp_sendrecv_ldap_port(evolution_t)
-corenet_udp_sendrecv_ldap_port(evolution_t)
-corenet_tcp_sendrecv_ipp_port(evolution_t)
-corenet_udp_sendrecv_ipp_port(evolution_t)
-corenet_tcp_connect_pop_port(evolution_t)
-corenet_tcp_connect_smtp_port(evolution_t)
-corenet_tcp_connect_innd_port(evolution_t)
-corenet_tcp_connect_ldap_port(evolution_t)
-corenet_tcp_connect_ipp_port(evolution_t)
+corenet_tcp_sendrecv_all_ports(evolution_t)
+corenet_udp_sendrecv_all_ports(evolution_t)
+
 corenet_sendrecv_pop_client_packets(evolution_t)
+corenet_tcp_connect_pop_port(evolution_t)
+
 corenet_sendrecv_smtp_client_packets(evolution_t)
+corenet_tcp_connect_smtp_port(evolution_t)
+
 corenet_sendrecv_innd_client_packets(evolution_t)
+corenet_tcp_connect_innd_port(evolution_t)
+
 corenet_sendrecv_ldap_client_packets(evolution_t)
+corenet_tcp_connect_ldap_port(evolution_t)
+
 corenet_sendrecv_ipp_client_packets(evolution_t)
-# not sure about this bind
-corenet_udp_bind_generic_node(evolution_t)
-corenet_udp_bind_generic_port(evolution_t)
+corenet_tcp_connect_ipp_port(evolution_t)
 
 dev_read_urand(evolution_t)
 
 domain_dontaudit_read_all_domains_state(evolution_t)
 
-files_read_etc_files(evolution_t)
 files_read_usr_files(evolution_t)
-files_read_usr_symlinks(evolution_t)
-files_read_var_files(evolution_t)
 
 fs_search_auto_mountpoints(evolution_t)
 
+auth_use_nsswitch(evolution_t)
+
 logging_send_syslog_msg(evolution_t)
 
 miscfiles_read_localization(evolution_t)
 
-sysnet_read_config(evolution_t)
-sysnet_dns_name_resolve(evolution_t)
-
 udev_read_state(evolution_t)
 
-userdom_rw_user_tmp_files(evolution_t)
+userdom_use_user_terminals(evolution_t)
+
 userdom_manage_user_tmp_dirs(evolution_t)
-userdom_manage_user_tmp_sockets(evolution_t)
 userdom_manage_user_tmp_files(evolution_t)
-userdom_use_user_terminals(evolution_t)
-# FIXME: suppress access to .local/.icons/.themes until properly implemented
-# FIXME: suppress access to .gaim/blist.xml (buddy list synchronization)
-# until properly implemented
-userdom_dontaudit_read_user_home_content_files(evolution_t)
+
+userdom_manage_user_home_content_dirs(evolution_t)
+userdom_manage_user_home_content_files(evolution_t)
+userdom_user_home_dir_filetrans_user_home_content(evolution_t, { dir file })
+
+userdom_write_user_tmp_sockets(evolution_t)
 
 mta_read_config(evolution_t)
 
 xserver_user_x_domain_template(evolution, evolution_t, evolution_tmpfs_t)
 xserver_read_xdm_tmp_files(evolution_t)
 
+ifndef(`enable_mls',`
+	fs_list_dos(evolution_t)
+	fs_read_dos_files(evolution_t)
+
+	fs_search_removable(evolution_t)
+	fs_read_removable_files(evolution_t)
+	fs_read_removable_symlinks(evolution_t)
+
+	fs_read_iso9660_files(evolution_t)
+')
+
 tunable_policy(`use_nfs_home_dirs',`
 	fs_manage_nfs_dirs(evolution_t)
 	fs_manage_nfs_files(evolution_t)
@@ -224,80 +219,30 @@
 	fs_manage_cifs_symlinks(evolution_t)
 ')
 
-tunable_policy(`mail_read_content && use_nfs_home_dirs',`
-	fs_list_auto_mountpoints(evolution_t)
-	files_list_home(evolution_t)
-	fs_read_nfs_files(evolution_t)
-	fs_read_nfs_symlinks(evolution_t)
-
-',`
-	files_dontaudit_list_home(evolution_t)
-	fs_dontaudit_list_auto_mountpoints(evolution_t)
-	fs_dontaudit_read_nfs_files(evolution_t)
-	fs_dontaudit_list_nfs(evolution_t)
-')
-
-tunable_policy(`mail_read_content && use_samba_home_dirs',`
-	fs_list_auto_mountpoints(evolution_t)
-	files_list_home(evolution_t)
-	fs_read_cifs_files(evolution_t)
-	fs_read_cifs_symlinks(evolution_t)
-',`
-	files_dontaudit_list_home(evolution_t)
-	fs_dontaudit_list_auto_mountpoints(evolution_t)
-	fs_dontaudit_read_cifs_files(evolution_t)
-	fs_dontaudit_list_cifs(evolution_t)
-')
-
-tunable_policy(`mail_read_content',`
-	userdom_list_user_tmp(evolution_t)
-	userdom_read_user_tmp_files(evolution_t)
-	userdom_read_user_tmp_symlinks(evolution_t)
-	userdom_read_user_home_content_files(evolution_t)
-	userdom_read_user_home_content_symlinks(evolution_t)
-
-	ifndef(`enable_mls',`
-		fs_search_removable(evolution_t)
-		fs_read_removable_files(evolution_t)
-		fs_read_removable_symlinks(evolution_t)
-	')
-',`
-	files_dontaudit_list_tmp(evolution_t)
-	files_dontaudit_list_home(evolution_t)
-	fs_dontaudit_list_removable(evolution_t)
-	fs_dontaudit_read_removable_files(evolution_t)
-	userdom_dontaudit_list_user_tmp(evolution_t)
-	userdom_dontaudit_read_user_tmp_files(evolution_t)
-	userdom_dontaudit_list_user_home_dirs(evolution_t)
-	userdom_dontaudit_read_user_home_content_files(evolution_t)
-')
-
 optional_policy(`
 	automount_read_state(evolution_t)
 ')
 
-# Allow printing the mail
 optional_policy(`
 	cups_read_rw_config(evolution_t)
 ')
 
 optional_policy(`
 	dbus_system_bus_client(evolution_t)
-	dbus_session_bus_client(evolution_t)
+	dbus_all_session_bus_client(evolution_t)
 ')
 
 optional_policy(`
 	gnome_stream_connect_gconf(evolution_t)
 ')
 
-# Encrypt mail
 optional_policy(`
 	gpg_domtrans(evolution_t)
 	gpg_signal(evolution_t)
 ')
 
 optional_policy(`
-	lpd_domtrans_lpr(evolution_t)
+	lpd_run_lpr(evolution_t, evolution_roles)
 ')
 
 optional_policy(`
@@ -305,22 +250,10 @@
 	mozilla_domtrans(evolution_t)
 ')
 
-# Allow POP/IMAP/SMTP/NNTP/LDAP/IPP(printing)
-optional_policy(`
-	nis_use_ypbind(evolution_t)
-')
-
-optional_policy(`
-	nscd_socket_use(evolution_t)
-')
-
-### Junk mail filtering (start spamd)
 optional_policy(`
 	spamassassin_exec_spamd(evolution_t)
 	spamassassin_domtrans_client(evolution_t)
 	spamassassin_domtrans_local_client(evolution_t)
-	# Allow evolution to signal the daemon
-	# FIXME: Now evolution can read spamd temp files
 	spamassassin_read_spamd_tmp_files(evolution_t)
 	spamassassin_signal_spamd(evolution_t)
 	spamassassin_dontaudit_getattr_spamd_tmp_sockets(evolution_t)
@@ -328,15 +261,12 @@
 
 ########################################
 #
-# Evolution alarm local policy
+# Alarm local policy
 #
 
 allow evolution_alarm_t self:process { signal getsched };
 allow evolution_alarm_t self:fifo_file rw_fifo_file_perms;
 
-allow evolution_alarm_t evolution_t:unix_stream_socket connectto;
-allow evolution_alarm_t evolution_orbit_tmp_t:sock_file write;
-
 allow evolution_alarm_t evolution_alarm_tmpfs_t:dir rw_dir_perms;
 allow evolution_alarm_t evolution_alarm_tmpfs_t:file manage_file_perms;
 allow evolution_alarm_t evolution_alarm_tmpfs_t:lnk_file manage_lnk_file_perms;
@@ -344,82 +274,64 @@
 allow evolution_alarm_t evolution_alarm_tmpfs_t:fifo_file manage_fifo_file_perms;
 fs_tmpfs_filetrans(evolution_alarm_t, evolution_alarm_tmpfs_t, { dir file lnk_file sock_file fifo_file })
 
-allow evolution_alarm_t evolution_exchange_t:unix_stream_socket connectto;
-allow evolution_alarm_t evolution_exchange_orbit_tmp_t:sock_file write;
-
-# Access evolution home
 allow evolution_alarm_t evolution_home_t:dir manage_dir_perms;
 allow evolution_alarm_t evolution_home_t:file manage_file_perms;
 allow evolution_alarm_t evolution_home_t:lnk_file manage_lnk_file_perms;
+userdom_user_home_dir_filetrans(evolution_alarm_t, evolution_home_t, dir, ".evolution")
+userdom_user_home_dir_filetrans(evolution_alarm_t, evolution_home_t, dir, ".camel_certs")
 
-allow evolution_alarm_t evolution_server_t:unix_stream_socket connectto;
-allow evolution_alarm_t evolution_server_orbit_tmp_t:sock_file write;
+stream_connect_pattern(evolution_alarm_t, evolution_orbit_tmp_t, evolution_orbit_tmp_t, evolution_t)
+stream_connect_pattern(evolution_alarm_t, evolution_exchange_orbit_tmp_t, evolution_exchange_orbit_tmp_t, evolution_exchange_t)
+stream_connect_pattern(evolution_alarm_t, evolution_server_orbit_tmp_t, evolution_server_orbit_tmp_t, evolution_server_t)
 
 dev_read_urand(evolution_alarm_t)
 
-files_read_etc_files(evolution_alarm_t)
 files_read_usr_files(evolution_alarm_t)
 
 fs_search_auto_mountpoints(evolution_alarm_t)
 
+auth_use_nsswitch(evolution_alarm_t)
+
 miscfiles_read_localization(evolution_alarm_t)
 
-# Access evolution home
-userdom_search_user_home_dirs(evolution_alarm_t)
-# FIXME: suppress access to .local/.icons/.themes until properly implemented
-# FIXME: suppress access to .gaim/blist.xml (buddy list synchronization)
-# until properly implemented
 userdom_dontaudit_read_user_home_content_files(evolution_alarm_t)
 
 xserver_user_x_domain_template(evolution_alarm, evolution_alarm_t, evolution_alarm_tmpfs_t)
 
-# Access evolution home
 tunable_policy(`use_nfs_home_dirs',`
+	fs_manage_nfs_dirs(evolution_alarm_t)
 	fs_manage_nfs_files(evolution_alarm_t)
+	fs_manage_nfs_symlinks(evolution_alarm_t)
 ')
 
 tunable_policy(`use_samba_home_dirs',`
+	fs_manage_cifs_dirs(evolution_alarm_t)
 	fs_manage_cifs_files(evolution_alarm_t)
+	fs_manage_cifs_symlinks(evolution_alarm_t)
 ')
 
 optional_policy(`
-	dbus_session_bus_client(evolution_alarm_t)
+	dbus_all_session_bus_client(evolution_alarm_t)
 ')
 
 optional_policy(`
 	gnome_stream_connect_gconf(evolution_alarm_t)
 ')
 
-optional_policy(`
-	nscd_socket_use(evolution_alarm_t)
-')
-
 ########################################
 #
-# Evolution exchange connector local policy
+# Exchange local policy
 #
 
 allow evolution_exchange_t self:process getsched;
 allow evolution_exchange_t self:fifo_file rw_fifo_file_perms;
 
-allow evolution_exchange_t self:tcp_socket create_socket_perms;
-allow evolution_exchange_t self:udp_socket create_socket_perms;
-
-allow evolution_exchange_t evolution_t:unix_stream_socket connectto;
-allow evolution_exchange_t evolution_orbit_tmp_t:sock_file write;
-
-allow evolution_exchange_t evolution_alarm_t:unix_stream_socket connectto;
-allow evolution_exchange_t evolution_alarm_orbit_tmp_t:sock_file write;
-
-# Access evolution home
 allow evolution_exchange_t evolution_home_t:dir manage_dir_perms;
 allow evolution_exchange_t evolution_home_t:file manage_file_perms;
 allow evolution_exchange_t evolution_home_t:lnk_file manage_lnk_file_perms;
+userdom_user_home_dir_filetrans(evolution_exchange_t, evolution_home_t, dir, ".evolution")
+userdom_user_home_dir_filetrans(evolution_exchange_t, evolution_home_t, dir, ".camel_certs")
 
-allow evolution_exchange_t evolution_server_t:unix_stream_socket connectto;
-allow evolution_exchange_t evolution_server_orbit_tmp_t:sock_file write;
-
-# /tmp/.exchange-$USER
 allow evolution_exchange_t evolution_exchange_tmp_t:dir manage_dir_perms;
 allow evolution_exchange_t evolution_exchange_tmp_t:file manage_file_perms;
 files_tmp_filetrans(evolution_exchange_t, evolution_exchange_tmp_t, { file dir })
@@ -431,141 +343,118 @@
 allow evolution_exchange_t evolution_exchange_tmpfs_t:fifo_file manage_fifo_file_perms;
 fs_tmpfs_filetrans(evolution_exchange_t, evolution_exchange_tmpfs_t, { dir file lnk_file sock_file fifo_file })
 
+stream_connect_pattern(evolution_exchange_t, evolution_orbit_tmp_t, evolution_orbit_tmp_t, evolution_t)
+stream_connect_pattern(evolution_exchange_t, evolution_server_orbit_tmp_t, evolution_server_orbit_tmp_t, evolution_server_t)
+stream_connect_pattern(evolution_exchange_t, evolution_alarm_orbit_tmp_t, evolution_alarm_orbit_tmp_t, evolution_alarm_t)
+
 kernel_read_network_state(evolution_exchange_t)
 kernel_read_net_sysctls(evolution_exchange_t)
 
-# Allow netstat
 corecmd_exec_bin(evolution_exchange_t)
 
 dev_read_urand(evolution_exchange_t)
 
-files_read_etc_files(evolution_exchange_t)
 files_read_usr_files(evolution_exchange_t)
 
-# Access evolution home
 fs_search_auto_mountpoints(evolution_exchange_t)
 
+auth_use_nsswitch(evolution_exchange_t)
+
 miscfiles_read_localization(evolution_exchange_t)
 
-userdom_write_user_tmp_sockets(evolution_exchange_t)
-# Access evolution home
-userdom_search_user_home_dirs(evolution_exchange_t)
-# FIXME: suppress access to .local/.icons/.themes until properly implemented
-# FIXME: suppress access to .gaim/blist.xml (buddy list synchronization)
-# until properly implemented
 userdom_dontaudit_read_user_home_content_files(evolution_exchange_t)
 
+userdom_write_user_tmp_sockets(evolution_exchange_t)
+
 xserver_user_x_domain_template(evolution_exchange, evolution_exchange_t, evolution_exchange_tmpfs_t)
 
-# Access evolution home
 tunable_policy(`use_nfs_home_dirs',`
+	fs_manage_nfs_dirs(evolution_exchange_t)
 	fs_manage_nfs_files(evolution_exchange_t)
+	fs_manage_nfs_symlinks(evolution_exchange_t)
 ')
 
 tunable_policy(`use_samba_home_dirs',`
+	fs_manage_cifs_dirs(evolution_exchange_t)
 	fs_manage_cifs_files(evolution_exchange_t)
+	fs_manage_cifs_symlinks(evolution_exchange_t)
 ')
 
 optional_policy(`
 	gnome_stream_connect_gconf(evolution_exchange_t)
 ')
 
-optional_policy(`
-	nscd_socket_use(evolution_exchange_t)
-')
-
 ########################################
 #
-# Evolution data server local policy
+# Server local policy
 #
 
 allow evolution_server_t self:process { getsched signal };
 
 allow evolution_server_t self:fifo_file { read write };
-allow evolution_server_t self:unix_stream_socket { accept connectto };
-# Talk to ldap (address book),
-# Obtain weather data via http (read server name from xml file in /usr)
-allow evolution_server_t self:tcp_socket create_socket_perms;
-
-allow evolution_server_t evolution_t:unix_stream_socket connectto;
-allow evolution_server_t evolution_orbit_tmp_t:sock_file write;
-
-allow evolution_server_t evolution_exchange_t:unix_stream_socket connectto;
-allow evolution_server_t evolution_exchange_orbit_tmp_t:sock_file write;
+allow evolution_server_t self:unix_stream_socket { accept connectto listen };
 
-# Access evolution home
 allow evolution_server_t evolution_home_t:dir manage_dir_perms;
 allow evolution_server_t evolution_home_t:file manage_file_perms;
 allow evolution_server_t evolution_home_t:lnk_file manage_lnk_file_perms;
+userdom_user_home_dir_filetrans(evolution_server_t, evolution_home_t, dir, ".evolution")
+userdom_user_home_dir_filetrans(evolution_server_t, evolution_home_t, dir, ".camel_certs")
 
-allow evolution_server_t evolution_alarm_t:unix_stream_socket connectto;
-allow evolution_server_t evolution_alarm_orbit_tmp_t:sock_file write;
+stream_connect_pattern(evolution_server_t, evolution_orbit_tmp_t, evolution_orbit_tmp_t, evolution_t)
+stream_connect_pattern(evolution_server_t, evolution_exchange_orbit_tmp_t, evolution_exchange_orbit_tmp_t, evolution_exchange_t)
+stream_connect_pattern(evolution_server_t, evolution_alarm_orbit_tmp_t, evolution_alarm_orbit_tmp_t, evolution_alarm_t)
 
 kernel_read_system_state(evolution_server_t)
 
 corecmd_exec_shell(evolution_server_t)
 
-# Obtain weather data via http (read server name from xml file in /usr)
 corenet_all_recvfrom_unlabeled(evolution_server_t)
 corenet_all_recvfrom_netlabel(evolution_server_t)
 corenet_tcp_sendrecv_generic_if(evolution_server_t)
 corenet_tcp_sendrecv_generic_node(evolution_server_t)
-corenet_tcp_sendrecv_http_port(evolution_server_t)
+
+corenet_sendrecv_http_cache_client_packets(evolution_server_t)
 corenet_tcp_sendrecv_http_cache_port(evolution_server_t)
 corenet_tcp_connect_http_cache_port(evolution_server_t)
-corenet_tcp_connect_http_port(evolution_server_t)
+
 corenet_sendrecv_http_client_packets(evolution_server_t)
-corenet_sendrecv_http_cache_client_packets(evolution_server_t)
+corenet_tcp_sendrecv_http_port(evolution_server_t)
+corenet_tcp_connect_http_port(evolution_server_t)
 
 dev_read_urand(evolution_server_t)
 
-files_read_etc_files(evolution_server_t)
-# Obtain weather data via http (read server name from xml file in /usr)
 files_read_usr_files(evolution_server_t)
 
 fs_search_auto_mountpoints(evolution_server_t)
 
+auth_use_nsswitch(evolution_server_t)
+
 miscfiles_read_localization(evolution_server_t)
-# Look in /etc/pki
 miscfiles_read_generic_certs(evolution_server_t)
 
-# Talk to ldap (address book)
-sysnet_read_config(evolution_server_t)
-sysnet_dns_name_resolve(evolution_server_t)
-sysnet_use_ldap(evolution_server_t)
-
-# Access evolution home
-userdom_search_user_home_dirs(evolution_server_t)
-# FIXME: suppress access to .local/.icons/.themes until properly implemented
-# FIXME: suppress access to .gaim/blist.xml (buddy list synchronization)
-# until properly implemented
 userdom_dontaudit_read_user_home_content_files(evolution_server_t)
 
-# Access evolution home
 tunable_policy(`use_nfs_home_dirs',`
+	fs_manage_nfs_dirs(evolution_server_t)
 	fs_manage_nfs_files(evolution_server_t)
+	fs_manage_nfs_symlinks(evolution_server_t)
 ')
 
 tunable_policy(`use_samba_home_dirs',`
+	fs_manage_cifs_dirs(evolution_server_t)
 	fs_manage_cifs_files(evolution_server_t)
+	fs_manage_cifs_symlinks(evolution_server_t)
 ')
 
 optional_policy(`
 	gnome_stream_connect_gconf(evolution_server_t)
 ')
 
-optional_policy(`
-	nscd_socket_use(evolution_server_t)
-')
-
 ########################################
 #
-# Evolution webcal local policy
+# Webcal local policy
 #
 
-allow evolution_webcal_t self:tcp_socket create_socket_perms;
-
-# X/evolution common stuff
 allow evolution_webcal_t evolution_webcal_tmpfs_t:dir rw_dir_perms;
 allow evolution_webcal_t evolution_webcal_tmpfs_t:file manage_file_perms;
 allow evolution_webcal_t evolution_webcal_tmpfs_t:lnk_file manage_lnk_file_perms;
@@ -576,29 +465,19 @@
 corenet_all_recvfrom_unlabeled(evolution_webcal_t)
 corenet_all_recvfrom_netlabel(evolution_webcal_t)
 corenet_tcp_sendrecv_generic_if(evolution_webcal_t)
-corenet_raw_sendrecv_generic_if(evolution_webcal_t)
 corenet_tcp_sendrecv_generic_node(evolution_webcal_t)
-corenet_raw_sendrecv_generic_node(evolution_webcal_t)
+
 corenet_tcp_sendrecv_http_port(evolution_webcal_t)
-corenet_tcp_sendrecv_http_cache_port(evolution_webcal_t)
-corenet_tcp_connect_http_cache_port(evolution_webcal_t)
 corenet_tcp_connect_http_port(evolution_webcal_t)
 corenet_sendrecv_http_client_packets(evolution_webcal_t)
+
+corenet_tcp_sendrecv_http_cache_port(evolution_webcal_t)
+corenet_tcp_connect_http_cache_port(evolution_webcal_t)
 corenet_sendrecv_http_cache_client_packets(evolution_webcal_t)
 
-# Networking capability - connect to website and handle ics link
-sysnet_read_config(evolution_webcal_t)
-sysnet_dns_name_resolve(evolution_webcal_t)
+auth_use_nsswitch(evolution_webcal_t)
 
-# Search home directory (?)
 userdom_search_user_home_dirs(evolution_webcal_t)
-# FIXME: suppress access to .local/.icons/.themes until properly implemented
-# FIXME: suppress access to .gaim/blist.xml (buddy list synchronization)
-# until properly implemented
 userdom_dontaudit_read_user_home_content_files(evolution_webcal_t)
 
 xserver_user_x_domain_template(evolution_webcal, evolution_webcal_t, evolution_webcal_tmpfs_t)
-
-optional_policy(`
-	nscd_socket_use(evolution_webcal_t)
-')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/exim.fc refpolicy/policy/modules/contrib/exim.fc
--- refpolicy/policy/modules/contrib/exim.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/exim.fc	2012-10-30 19:31:28.693399431 +0100
@@ -1,8 +1,11 @@
-/usr/sbin/exim[0-9]?		--	gen_context(system_u:object_r:exim_exec_t,s0)
-/var/log/exim[0-9]?(/.*)?		gen_context(system_u:object_r:exim_log_t,s0)
+/etc/rc\.d/init\.d/exim	--	gen_context(system_u:object_r:exim_initrc_exec_t,s0)
+
+/usr/sbin/exim[0-9]?	--	gen_context(system_u:object_r:exim_exec_t,s0)
+/usr/sbin/exim_tidydb	--	gen_context(system_u:object_r:exim_exec_t,s0)
+
+/var/log/exim[0-9]?(/.*)?	gen_context(system_u:object_r:exim_log_t,s0)
+
+/var/run/exim[0-9]?(/.*)?	gen_context(system_u:object_r:exim_var_run_t,s0)
 /var/run/exim[0-9]?\.pid	--	gen_context(system_u:object_r:exim_var_run_t,s0)
-/var/spool/exim[0-9]?(/.*)?		gen_context(system_u:object_r:exim_spool_t,s0)
 
-ifdef(`distro_debian',`
-/var/run/exim[0-9]?(/.*)?		gen_context(system_u:object_r:exim_var_run_t,s0)
-')
+/var/spool/exim[0-9]?(/.*)?	gen_context(system_u:object_r:exim_spool_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/exim.if refpolicy/policy/modules/contrib/exim.if
--- refpolicy/policy/modules/contrib/exim.if	2012-05-04 15:16:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/exim.if	2012-10-13 21:41:29.074578795 +0200
@@ -1,4 +1,4 @@
-## <summary>Exim mail transfer agent</summary>
+## <summary>Mail transfer agent.</summary>
 
 ########################################
 ## <summary>
@@ -15,13 +15,41 @@
 		type exim_t, exim_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, exim_exec_t, exim_t)
 ')
 
 ########################################
 ## <summary>
-##	Do not audit attempts to read, 
-##	exim tmp files
+##	Execute exim in the exim domain,
+##	and allow the specified role
+##	the exim domain.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed to transition.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`exim_run',`
+	gen_require(`
+		attribute_role exim_roles;
+	')
+
+	exim_domtrans($1)
+	roleattribute $2 exim_roles;
+')
+
+########################################
+## <summary>
+##	Do not audit attempts to read exim
+##	temporary tmp files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -39,7 +67,7 @@
 
 ########################################
 ## <summary>
-##	Allow domain to read, exim tmp files
+##	Read exim temporary files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -58,7 +86,7 @@
 
 ########################################
 ## <summary>
-##	Read exim PID files.
+##	Read exim pid files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -77,7 +105,7 @@
 
 ########################################
 ## <summary>
-##	Allow the specified domain to read exim's log files.
+##	Read exim log files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -97,8 +125,7 @@
 
 ########################################
 ## <summary>
-##	Allow the specified domain to append
-##	exim log files.
+##	Append exim log files.
 ## </summary>
 ## <param name="domain">
 ## 	<summary>
@@ -117,7 +144,8 @@
 
 ########################################
 ## <summary>
-##	Allow the specified domain to manage exim's log files.
+##	Create, read, write, and delete
+##	exim log files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -138,7 +166,7 @@
 ########################################
 ## <summary>
 ##	Create, read, write, and delete
-##	exim spool dirs.
+##	exim spool directories.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -194,3 +222,47 @@
 	manage_files_pattern($1, exim_spool_t, exim_spool_t)
 	files_search_spool($1)
 ')
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an exim environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`exim_admin',`
+	gen_require(`
+		type exim_t, exim_spool_t, exim_log_t;
+		type exim_var_run_t, exim_initrc_exec_t, exim_tmp_t;
+	')
+
+	allow $1 exim_t:process { ptrace signal_perms };
+	ps_process_pattern($1, exim_t)
+
+	init_labeled_script_domtrans($1, exim_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 exim_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	files_search_spool($1)
+	admin_pattern($1, exim_spool_t)
+
+	logging_search_logs($1)
+	admin_pattern($1, exim_log_t)
+
+	files_search_pids($1)
+	admin_pattern($1, exim_var_run_t)
+
+	files_search_tmp($1)
+	admin_pattern($1, exim_tmp_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/exim.te refpolicy/policy/modules/contrib/exim.te
--- refpolicy/policy/modules/contrib/exim.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/exim.te	2012-10-30 19:31:28.706399431 +0100
@@ -1,4 +1,4 @@
-policy_module(exim, 1.5.0)
+policy_module(exim, 1.5.4)
 
 ########################################
 #
@@ -6,35 +6,45 @@
 #
 
 ## <desc>
-## <p>
-## Allow exim to connect to databases (postgres, mysql)
-## </p>
+##	<p>
+##	Determine whether exim can connect to
+##	databases.
+##	</p>
 ## </desc>
 gen_tunable(exim_can_connect_db, false)
 
 ## <desc>
-## <p>
-## Allow exim to read unprivileged user files.
-## </p>
+##	<p>
+##	Determine whether exim can read generic
+##	user content files.
+##	</p>
 ## </desc>
 gen_tunable(exim_read_user_files, false)
 
 ## <desc>
-## <p>
-## Allow exim to create, read, write, and delete
-## unprivileged user files.
+##	<p>
+##	Determine whether exim can create,
+##	read, write, and delete generic user
+##	content files.
 ## </p>
 ## </desc>
 gen_tunable(exim_manage_user_files, false)
 
+attribute_role exim_roles;
+
 type exim_t;
 type exim_exec_t;
 init_daemon_domain(exim_t, exim_exec_t)
+role exim_roles types exim_t;
+
 mta_mailserver(exim_t, exim_exec_t)
+mta_mailserver_delivery(exim_t)
 mta_mailserver_user_agent(exim_t)
-application_executable_file(exim_exec_t)
 mta_agent_executable(exim_exec_t)
 
+type exim_initrc_exec_t;
+init_script_file(exim_initrc_exec_t)
+
 type exim_log_t;
 logging_log_file(exim_log_t)
 
@@ -49,33 +59,34 @@
 
 ########################################
 #
-# exim local policy
+# Local policy
 #
 
 allow exim_t self:capability { chown dac_override dac_read_search fowner setuid setgid sys_resource };
 allow exim_t self:process { setrlimit setpgid };
 allow exim_t self:fifo_file rw_fifo_file_perms;
-allow exim_t self:unix_stream_socket create_stream_socket_perms;
-allow exim_t self:tcp_socket create_stream_socket_perms;
-allow exim_t self:udp_socket create_socket_perms;
+allow exim_t self:unix_stream_socket { accept listen };
+allow exim_t self:tcp_socket { accept listen };
 
-can_exec(exim_t, exim_exec_t)
-
-manage_files_pattern(exim_t, exim_log_t, exim_log_t)
-logging_log_filetrans(exim_t, exim_log_t, { file dir })
+append_files_pattern(exim_t, exim_log_t, exim_log_t)
+create_files_pattern(exim_t, exim_log_t, exim_log_t)
+setattr_files_pattern(exim_t, exim_log_t, exim_log_t)
+logging_log_filetrans(exim_t, exim_log_t, file)
 
 manage_dirs_pattern(exim_t, exim_spool_t, exim_spool_t)
 manage_files_pattern(exim_t, exim_spool_t, exim_spool_t)
 manage_sock_files_pattern(exim_t, exim_spool_t, exim_spool_t)
-files_spool_filetrans(exim_t, exim_spool_t, { file dir sock_file })
+files_spool_filetrans(exim_t, exim_spool_t, { dir file sock_file })
 
 manage_dirs_pattern(exim_t, exim_tmp_t, exim_tmp_t)
 manage_files_pattern(exim_t, exim_tmp_t, exim_tmp_t)
-files_tmp_filetrans(exim_t, exim_tmp_t, { file dir })
+files_tmp_filetrans(exim_t, exim_tmp_t, { dir file })
 
 manage_dirs_pattern(exim_t, exim_var_run_t, exim_var_run_t)
 manage_files_pattern(exim_t, exim_var_run_t, exim_var_run_t)
-files_pid_filetrans(exim_t, exim_var_run_t, { file dir })
+files_pid_filetrans(exim_t, exim_var_run_t, { dir file })
+
+can_exec(exim_t, exim_exec_t)
 
 kernel_read_kernel_sysctls(exim_t)
 kernel_read_network_state(exim_t)
@@ -91,24 +102,32 @@
 corenet_udp_sendrecv_generic_node(exim_t)
 corenet_tcp_sendrecv_all_ports(exim_t)
 corenet_tcp_bind_generic_node(exim_t)
+
+corenet_sendrecv_smtp_server_packets(exim_t)
 corenet_tcp_bind_smtp_port(exim_t)
+
+corenet_sendrecv_amavisd_send_server_packets(exim_t)
 corenet_tcp_bind_amavisd_send_port(exim_t)
+
+corenet_sendrecv_auth_client_packets(exim_t)
 corenet_tcp_connect_auth_port(exim_t)
+
+corenet_sendrecv_smtp_client_packets(exim_t)
 corenet_tcp_connect_smtp_port(exim_t)
-corenet_tcp_connect_ldap_port(exim_t)
+
+corenet_sendrecv_inetd_child_client_packets(exim_t)
 corenet_tcp_connect_inetd_child_port(exim_t)
-# connect to spamassassin
+
+corenet_sendrecv_spamd_client_packets(exim_t)
 corenet_tcp_connect_spamd_port(exim_t)
 
 dev_read_rand(exim_t)
 dev_read_urand(exim_t)
 
-# Init script handling
 domain_use_interactive_fds(exim_t)
 
 files_search_usr(exim_t)
 files_search_var(exim_t)
-files_read_etc_files(exim_t)
 files_read_etc_runtime_files(exim_t)
 files_getattr_all_mountpoints(exim_t)
 
@@ -127,13 +146,17 @@
 mta_read_aliases(exim_t)
 mta_read_config(exim_t)
 mta_manage_spool(exim_t)
-mta_mailserver_delivery(exim_t)
 
 tunable_policy(`exim_can_connect_db',`
-	corenet_tcp_connect_mysqld_port(exim_t)
-	corenet_sendrecv_mysqld_client_packets(exim_t)
-	corenet_tcp_connect_postgresql_port(exim_t)
-	corenet_sendrecv_postgresql_client_packets(exim_t)
+	corenet_sendrecv_gds_db_client_packets(exim_t)
+	corenet_tcp_connect_gds_db_port(exim_t)
+	corenet_tcp_sendrecv_gds_db_port(exim_t)
+	corenet_sendrecv_mssql_client_packets(exim_t)
+	corenet_tcp_connect_mssql_port(exim_t)
+	corenet_tcp_sendrecv_mssql_port(exim_t)
+	corenet_sendrecv_oracledb_client_packets(exim_t)
+	corenet_tcp_connect_oracledb_port(exim_t)
+	corenet_tcp_sendrecv_oracledb_port(exim_t)
 ')
 
 tunable_policy(`exim_read_user_files',`
@@ -143,8 +166,7 @@
 
 tunable_policy(`exim_manage_user_files',`
 	userdom_manage_user_home_content_dirs(exim_t)
-	userdom_read_user_tmp_files(exim_t)
-	userdom_write_user_tmp_files(exim_t)
+	userdom_manage_user_tmp_files(exim_t)
 ')
 
 optional_policy(`
@@ -162,6 +184,10 @@
 ')
 
 optional_policy(`
+	dovecot_stream_connect(exim_t)
+')
+
+optional_policy(`
 	kerberos_keytab_template(exim, exim_t)
 ')
 
@@ -171,14 +197,22 @@
 ')
 
 optional_policy(`
+	nagios_search_spool(exim_t)
+')
+
+optional_policy(`
 	tunable_policy(`exim_can_connect_db',`
 		mysql_stream_connect(exim_t)
+		mysql_tcp_connect(exim_t)
 	')
 ')
 
 optional_policy(`
+	postgresql_unpriv_client(exim_t)
+
 	tunable_policy(`exim_can_connect_db',`
 		postgresql_stream_connect(exim_t)
+		postgresql_tcp_connect(exim_t)
 	')
 ')
 
@@ -191,9 +225,6 @@
 ')
 
 optional_policy(`
-	# https://bugzilla.redhat.com/show_bug.cgi?id=512710
-	# uses sendmail for outgoing mail and exim
-	# for incoming mail
 	sendmail_manage_tmp_files(exim_t)
 ')
 
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/fail2ban.fc refpolicy/policy/modules/contrib/fail2ban.fc
--- refpolicy/policy/modules/contrib/fail2ban.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/fail2ban.fc	2012-10-02 20:05:32.756011135 +0200
@@ -1,8 +1,9 @@
-/etc/rc\.d/init\.d/fail2ban --	gen_context(system_u:object_r:fail2ban_initrc_exec_t,s0)
+/etc/rc\.d/init\.d/fail2ban	--	gen_context(system_u:object_r:fail2ban_initrc_exec_t,s0)
 
 /usr/bin/fail2ban	--	gen_context(system_u:object_r:fail2ban_exec_t,s0)
-/usr/bin/fail2ban-server --	gen_context(system_u:object_r:fail2ban_exec_t,s0)
+/usr/bin/fail2ban-client	--	gen_context(system_u:object_r:fail2ban_client_exec_t,s0)
+/usr/bin/fail2ban-server	--	gen_context(system_u:object_r:fail2ban_exec_t,s0)
 
-/var/lib/fail2ban(/.*)?		gen_context(system_u:object_r:fail2ban_var_lib_t,s0)
-/var/log/fail2ban\.log	--	gen_context(system_u:object_r:fail2ban_log_t,s0)
-/var/run/fail2ban.*		gen_context(system_u:object_r:fail2ban_var_run_t,s0)
+/var/lib/fail2ban(/.*)?	gen_context(system_u:object_r:fail2ban_var_lib_t,s0)
+/var/log/fail2ban\.log.*	--	gen_context(system_u:object_r:fail2ban_log_t,s0)
+/var/run/fail2ban.*	gen_context(system_u:object_r:fail2ban_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/fail2ban.if refpolicy/policy/modules/contrib/fail2ban.if
--- refpolicy/policy/modules/contrib/fail2ban.if	2012-05-04 15:16:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/fail2ban.if	2012-10-13 21:41:29.085579279 +0200
@@ -15,13 +15,61 @@
 		type fail2ban_t, fail2ban_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, fail2ban_exec_t, fail2ban_t)
 ')
 
+########################################
+## <summary>
+##	Execute the fail2ban client in
+##	the fail2ban client domain.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed to transition.
+##	</summary>
+## </param>
+#
+interface(`fail2ban_domtrans_client',`
+	gen_require(`
+		type fail2ban_client_t, fail2ban_client_exec_t;
+	')
+
+	corecmd_search_bin($1)
+	domtrans_pattern($1, fail2ban_client_exec_t, fail2ban_client_t)
+')
+
+########################################
+## <summary>
+##	Execute fail2ban client in the
+##	fail2ban client domain, and allow
+##	the specified role the fail2ban
+##	client domain.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed to transition.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+#
+interface(`fail2ban_run_client',`
+	gen_require(`
+		attribute_role fail2ban_client_roles;
+	')
+
+	fail2ban_domtrans_client($1)
+	roleattribute $2 fail2ban_client_roles;
+')
+
 #####################################
 ## <summary>
-##	Connect to fail2ban over a unix domain
-##	stream socket.
+##	Connect to fail2ban over a
+##	unix domain stream socket.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -40,7 +88,27 @@
 
 ########################################
 ## <summary>
-##	Read and write to an fail2ban unix stream socket.
+##	Read and write inherited temporary files.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`fail2ban_rw_inherited_tmp_files',`
+	gen_require(`
+		type fail2ban_tmp_t;
+	')
+
+	files_search_tmp($1)
+	allow $1 fail2ban_tmp_t:file { read write };
+')
+
+########################################
+## <summary>
+##	Read and write fail2ban unix
+##	stream sockets.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -77,7 +145,7 @@
 
 ########################################
 ## <summary>
-##	Allow the specified domain to read fail2ban's log files.
+##	Read fail2ban log files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -92,14 +160,12 @@
 	')
 
 	logging_search_logs($1)
-	allow $1 fail2ban_log_t:dir list_dir_perms;
 	allow $1 fail2ban_log_t:file read_file_perms;
 ')
 
 ########################################
 ## <summary>
-##	Allow the specified domain to append
-##	fail2ban log files.
+##	Append fail2ban log files.
 ## </summary>
 ## <param name="domain">
 ## 	<summary>
@@ -113,13 +179,12 @@
 	')
 
 	logging_search_logs($1)
-	allow $1 fail2ban_log_t:dir list_dir_perms;
 	allow $1 fail2ban_log_t:file append_file_perms;
 ')
 
 ########################################
 ## <summary>
-##	Read fail2ban PID files.
+##	Read fail2ban pid files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -138,8 +203,8 @@
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate 
-##	an fail2ban environment
+##	All of the rules required to
+##	administrate an fail2ban environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -148,19 +213,20 @@
 ## </param>
 ## <param name="role">
 ##	<summary>
-##	The role to be allowed to manage the fail2ban domain.
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <rolecap/>
 #
 interface(`fail2ban_admin',`
 	gen_require(`
-		type fail2ban_t, fail2ban_log_t;
+		type fail2ban_t, fail2ban_log_t, fail2ban_tmp_t;
 		type fail2ban_var_run_t, fail2ban_initrc_exec_t;
+		type fail2ban_var_lib_t, fail2ban_client_t;
 	')
 
-	allow $1 fail2ban_t:process { ptrace signal_perms };
-	ps_process_pattern($1, fail2ban_t)
+	allow $1 { fail2ban_t fail2ban_client_t }:process { ptrace signal_perms };
+	ps_process_pattern($1, { fail2ban_t fail2ban_client_t })
 
 	init_labeled_script_domtrans($1, fail2ban_initrc_exec_t)
 	domain_system_change_exemption($1)
@@ -172,4 +238,12 @@
 
 	files_list_pids($1)
 	admin_pattern($1, fail2ban_var_run_t)
+
+	files_search_var_lib($1)
+	admin_pattern($1, fail2ban_var_lib_t)
+
+	files_search_tmp($1)
+	admin_pattern($1, fail2ban_tmp_t)
+
+	fail2ban_run_client($1, $2)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/fail2ban.te refpolicy/policy/modules/contrib/fail2ban.te
--- refpolicy/policy/modules/contrib/fail2ban.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/fail2ban.te	2012-11-01 21:39:10.843784618 +0100
@@ -1,10 +1,12 @@
-policy_module(fail2ban, 1.4.0)
+policy_module(fail2ban, 1.4.7)
 
 ########################################
 #
 # Declarations
 #
 
+attribute_role fail2ban_client_roles;
+
 type fail2ban_t;
 type fail2ban_exec_t;
 init_daemon_domain(fail2ban_t, fail2ban_exec_t)
@@ -12,43 +14,51 @@
 type fail2ban_initrc_exec_t;
 init_script_file(fail2ban_initrc_exec_t)
 
-# log files
 type fail2ban_log_t;
 logging_log_file(fail2ban_log_t)
 
 type fail2ban_var_lib_t;
 files_type(fail2ban_var_lib_t)
 
-# pid files
 type fail2ban_var_run_t;
 files_pid_file(fail2ban_var_run_t)
 
+type fail2ban_tmp_t;
+files_tmp_file(fail2ban_tmp_t)
+
+type fail2ban_client_t;
+type fail2ban_client_exec_t;
+init_system_domain(fail2ban_client_t, fail2ban_client_exec_t)
+role fail2ban_client_roles types fail2ban_client_t;
+
 ########################################
 #
-# fail2ban local policy
+# Server Local policy
 #
 
-allow fail2ban_t self:capability { sys_tty_config };
-allow fail2ban_t self:process signal;
+allow fail2ban_t self:capability { dac_read_search dac_override sys_tty_config sys_nice };
+allow fail2ban_t self:process { setsched signal };
 allow fail2ban_t self:fifo_file rw_fifo_file_perms;
-allow fail2ban_t self:unix_stream_socket { connectto create_stream_socket_perms };
-allow fail2ban_t self:unix_dgram_socket create_socket_perms;
-allow fail2ban_t self:tcp_socket create_stream_socket_perms;
-
-# log files
-allow fail2ban_t fail2ban_log_t:dir setattr;
-manage_files_pattern(fail2ban_t, fail2ban_log_t, fail2ban_log_t)
+allow fail2ban_t self:unix_stream_socket { accept connectto listen };
+allow fail2ban_t self:tcp_socket { accept listen };
+
+append_files_pattern(fail2ban_t, fail2ban_log_t, fail2ban_log_t)
+create_files_pattern(fail2ban_t, fail2ban_log_t, fail2ban_log_t)
+setattr_files_pattern(fail2ban_t, fail2ban_log_t, fail2ban_log_t)
 logging_log_filetrans(fail2ban_t, fail2ban_log_t, file)
 
+manage_dirs_pattern(fail2ban_t, fail2ban_tmp_t, fail2ban_tmp_t)
+manage_files_pattern(fail2ban_t, fail2ban_tmp_t, fail2ban_tmp_t)
+exec_files_pattern(fail2ban_t, fail2ban_tmp_t, fail2ban_tmp_t)
+files_tmp_filetrans(fail2ban_t, fail2ban_tmp_t, { dir file })
+
 manage_dirs_pattern(fail2ban_t, fail2ban_var_lib_t, fail2ban_var_lib_t)
 manage_files_pattern(fail2ban_t, fail2ban_var_lib_t, fail2ban_var_lib_t)
-files_var_lib_filetrans(fail2ban_t, fail2ban_var_lib_t, { dir file })
 
-# pid file
 manage_dirs_pattern(fail2ban_t, fail2ban_var_run_t, fail2ban_var_run_t)
 manage_sock_files_pattern(fail2ban_t, fail2ban_var_run_t, fail2ban_var_run_t)
 manage_files_pattern(fail2ban_t, fail2ban_var_run_t, fail2ban_var_run_t)
-files_pid_filetrans(fail2ban_t, fail2ban_var_run_t, { dir file sock_file })
+files_pid_filetrans(fail2ban_t, fail2ban_var_run_t, file)
 
 kernel_read_system_state(fail2ban_t)
 
@@ -59,19 +69,20 @@
 corenet_all_recvfrom_netlabel(fail2ban_t)
 corenet_tcp_sendrecv_generic_if(fail2ban_t)
 corenet_tcp_sendrecv_generic_node(fail2ban_t)
-corenet_tcp_sendrecv_all_ports(fail2ban_t)
-corenet_tcp_connect_whois_port(fail2ban_t)
+
 corenet_sendrecv_whois_client_packets(fail2ban_t)
+corenet_tcp_connect_whois_port(fail2ban_t)
+corenet_tcp_sendrecv_whois_port(fail2ban_t)
 
 dev_read_urand(fail2ban_t)
 
 domain_use_interactive_fds(fail2ban_t)
+domain_dontaudit_read_all_domains_state(fail2ban_t)
 
-files_read_etc_files(fail2ban_t)
 files_read_etc_runtime_files(fail2ban_t)
 files_read_usr_files(fail2ban_t)
 files_list_var(fail2ban_t)
-files_search_var_lib(fail2ban_t)
+files_dontaudit_list_tmp(fail2ban_t)
 
 fs_list_inotifyfs(fail2ban_t)
 fs_getattr_all_fs(fail2ban_t)
@@ -83,8 +94,18 @@
 
 miscfiles_read_localization(fail2ban_t)
 
+sysnet_manage_config(fail2ban_t)
+sysnet_etc_filetrans_config(fail2ban_t)
+
 mta_send_mail(fail2ban_t)
 
+ifdef(`distro_gentoo',`
+	# FAM support needs this (/proc/self and parent stuff)
+	read_files_pattern(fail2ban_t, fail2ban_t, fail2ban_t)
+	# Python compilation	
+	files_dontaudit_write_usr_dirs(fail2ban_t)
+')
+
 optional_policy(`
 	apache_read_log(fail2ban_t)
 ')
@@ -96,3 +117,41 @@
 optional_policy(`
 	iptables_domtrans(fail2ban_t)
 ')
+
+optional_policy(`
+	libs_exec_ldconfig(fail2ban_t)
+')
+
+optional_policy(`
+	shorewall_domtrans(fail2ban_t)
+')
+
+########################################
+#
+# Client Local policy
+#
+
+allow fail2ban_client_t self:capability dac_read_search;
+allow fail2ban_client_t self:unix_stream_socket { create connect write read };
+
+domtrans_pattern(fail2ban_client_t, fail2ban_exec_t, fail2ban_t)
+
+stream_connect_pattern(fail2ban_client_t, fail2ban_var_run_t, fail2ban_var_run_t, fail2ban_t)
+
+kernel_read_system_state(fail2ban_client_t)
+
+corecmd_exec_bin(fail2ban_client_t)
+
+domain_use_interactive_fds(fail2ban_client_t)
+
+files_read_etc_files(fail2ban_client_t)
+files_read_usr_files(fail2ban_client_t)
+files_search_pids(fail2ban_client_t)
+
+logging_getattr_all_logs(fail2ban_client_t)
+logging_search_all_logs(fail2ban_client_t)
+
+miscfiles_read_localization(fail2ban_client_t)
+
+userdom_dontaudit_search_user_home_dirs(fail2ban_client_t)
+userdom_use_user_terminals(fail2ban_client_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/fcoe.fc refpolicy/policy/modules/contrib/fcoe.fc
--- refpolicy/policy/modules/contrib/fcoe.fc	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/fcoe.fc	2012-09-24 21:20:43.449583138 +0200
@@ -0,0 +1,6 @@
+/etc/rc\.d/init\.d/fcoe	--	gen_context(system_u:object_r:fcoemon_initrc_exec_t,s0)
+
+/usr/sbin/fcoemon	--	gen_context(system_u:object_r:fcoemon_exec_t,s0)
+
+/var/run/fcm(/.*)?	gen_context(system_u:object_r:fcoemon_var_run_t,s0)
+/var/run/fcoemon\.pid	--	gen_context(system_u:object_r:fcoemon_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/fcoe.if refpolicy/policy/modules/contrib/fcoe.if
--- refpolicy/policy/modules/contrib/fcoe.if	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/fcoe.if	2012-09-24 21:20:43.449583138 +0200
@@ -0,0 +1,54 @@
+## <summary>Fibre Channel over Ethernet utilities.</summary>
+
+#######################################
+## <summary>
+##	Send to fcoemon with a unix dgram socket.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`fcoe_dgram_send_fcoemon',`
+	gen_require(`
+		type fcoemon_t, fcoemon_var_run_t;
+	')
+
+	files_search_pids($1)
+	dgram_send_pattern($1, fcoemon_var_run_t, fcoemon_var_run_t, fcoemon_t)
+')
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an fcoemon environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`fcoe_admin',`
+	gen_require(`
+		type fcoemon_t, fcoemon_initrc_exec_t, fcoemon_var_run_t;
+	')
+
+	allow $1 fcoemon_t:process { ptrace signal_perms };
+	ps_process_pattern($1, fcoemon_t)
+
+	init_labeled_script_domtrans($1, fcoemon_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 fcoemon_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	files_search_pids($1)
+	admin_pattern($1, fcoemon_var_run_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/fcoe.te refpolicy/policy/modules/contrib/fcoe.te
--- refpolicy/policy/modules/contrib/fcoe.te	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/fcoe.te	2012-10-02 20:05:42.033011855 +0200
@@ -0,0 +1,44 @@
+policy_module(fcoe, 1.0.1)
+
+########################################
+#
+# Declarations
+#
+
+type fcoemon_t;
+type fcoemon_exec_t;
+init_daemon_domain(fcoemon_t, fcoemon_exec_t)
+
+type fcoemon_initrc_exec_t;
+init_script_file(fcoemon_initrc_exec_t)
+
+type fcoemon_var_run_t;
+files_pid_file(fcoemon_var_run_t)
+
+########################################
+#
+# Local policy
+#
+
+allow fcoemon_t self:capability { dac_override kill net_admin };
+allow fcoemon_t self:fifo_file rw_fifo_file_perms;
+allow fcoemon_t self:unix_stream_socket { accept listen };
+allow fcoemon_t self:netlink_socket create_socket_perms;
+allow fcoemon_t self:netlink_route_socket create_netlink_socket_perms;
+
+manage_dirs_pattern(fcoemon_t, fcoemon_var_run_t, fcoemon_var_run_t)
+manage_files_pattern(fcoemon_t, fcoemon_var_run_t, fcoemon_var_run_t)
+manage_sock_files_pattern(fcoemon_t, fcoemon_var_run_t, fcoemon_var_run_t)
+files_pid_filetrans(fcoemon_t, fcoemon_var_run_t, { dir file })
+
+files_read_etc_files(fcoemon_t)
+
+dev_read_sysfs(fcoemon_t)
+
+logging_send_syslog_msg(fcoemon_t)
+
+miscfiles_read_localization(fcoemon_t)
+
+optional_policy(`
+	lldpad_dgram_send(fcoemon_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/fetchmail.fc refpolicy/policy/modules/contrib/fetchmail.fc
--- refpolicy/policy/modules/contrib/fetchmail.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/fetchmail.fc	2012-10-02 20:05:49.040011870 +0200
@@ -1,19 +1,13 @@
+HOME_DIR/\.fetchmailrc	--	gen_context(system_u:object_r:fetchmail_home_t,s0)
 
-#
-# /etc
-#
-
-/etc/fetchmailrc		--	gen_context(system_u:object_r:fetchmail_etc_t,s0)
-
-#
-# /usr
-#
-
-/usr/bin/fetchmail		--	gen_context(system_u:object_r:fetchmail_exec_t,s0)
-
-#
-# /var
-#
-/var/lib/fetchmail(/.*)?		gen_context(system_u:object_r:fetchmail_uidl_cache_t,s0)
-/var/mail/\.fetchmail-UIDL-cache --	gen_context(system_u:object_r:fetchmail_uidl_cache_t,s0)
-/var/run/fetchmail/.*		--	gen_context(system_u:object_r:fetchmail_var_run_t,s0)
+/etc/fetchmailrc	--	gen_context(system_u:object_r:fetchmail_etc_t,s0)
+
+/etc/rc\.d/init\.d/fetchmail	--	gen_context(system_u:object_r:fetchmail_initrc_exec_t,s0)
+
+/usr/bin/fetchmail	--	gen_context(system_u:object_r:fetchmail_exec_t,s0)
+
+/var/lib/fetchmail(/.*)?	gen_context(system_u:object_r:fetchmail_uidl_cache_t,s0)
+
+/var/mail/\.fetchmail-UIDL-cache	--	gen_context(system_u:object_r:fetchmail_uidl_cache_t,s0)
+
+/var/run/fetchmail/.*	--	gen_context(system_u:object_r:fetchmail_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/fetchmail.if refpolicy/policy/modules/contrib/fetchmail.if
--- refpolicy/policy/modules/contrib/fetchmail.if	2012-05-04 15:16:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/fetchmail.if	2012-10-02 20:05:49.041011870 +0200
@@ -1,28 +1,40 @@
-## <summary>Remote-mail retrieval and forwarding utility</summary>
+## <summary>Remote-mail retrieval and forwarding utility.</summary>
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate 
-##	an fetchmail environment
+##	All of the rules required to
+##	administrate an fetchmail environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
 ##	Domain allowed access.
 ##	</summary>
 ## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
 ## <rolecap/>
 #
 interface(`fetchmail_admin',`
 	gen_require(`
 		type fetchmail_t, fetchmail_etc_t, fetchmail_uidl_cache_t;
-		type fetchmail_var_run_t;
+		type fetchmail_var_run_t, fetchmail_initrc_exec_t;
 	')
 
+	init_labeled_script_domtrans($1, fetchmail_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 fetchmail_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	allow $1 fetchmail_t:process { ptrace signal_perms };
 	ps_process_pattern($1, fetchmail_t)
 
 	files_list_etc($1)
 	admin_pattern($1, fetchmail_etc_t)
 
+	files_search_var_lib($1)
 	admin_pattern($1, fetchmail_uidl_cache_t)
 
 	files_list_pids($1)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/fetchmail.te refpolicy/policy/modules/contrib/fetchmail.te
--- refpolicy/policy/modules/contrib/fetchmail.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/fetchmail.te	2012-10-02 20:05:49.355012388 +0200
@@ -1,4 +1,4 @@
-policy_module(fetchmail, 1.12.0)
+policy_module(fetchmail, 1.12.1)
 
 ########################################
 #
@@ -10,12 +10,18 @@
 init_daemon_domain(fetchmail_t, fetchmail_exec_t)
 application_executable_file(fetchmail_exec_t)
 
-type fetchmail_var_run_t;
-files_pid_file(fetchmail_var_run_t)
+type fetchmail_initrc_exec_t;
+init_script_file(fetchmail_initrc_exec_t)
 
 type fetchmail_etc_t;
 files_config_file(fetchmail_etc_t)
 
+type fetchmail_home_t;
+userdom_user_home_content(fetchmail_home_t)
+
+type fetchmail_var_run_t;
+files_pid_file(fetchmail_var_run_t)
+
 type fetchmail_uidl_cache_t;
 files_type(fetchmail_uidl_cache_t)
 
@@ -26,20 +32,18 @@
 
 dontaudit fetchmail_t self:capability sys_tty_config;
 allow fetchmail_t self:process { signal_perms setrlimit };
-allow fetchmail_t self:unix_dgram_socket create_socket_perms;
-allow fetchmail_t self:unix_stream_socket create_stream_socket_perms;
-allow fetchmail_t self:netlink_route_socket r_netlink_socket_perms;
-allow fetchmail_t self:tcp_socket create_socket_perms;
-allow fetchmail_t self:udp_socket create_socket_perms;
+allow fetchmail_t self:unix_stream_socket { accept listen };
 
 allow fetchmail_t fetchmail_etc_t:file read_file_perms;
 
+read_files_pattern(fetchmail_t, fetchmail_home_t, fetchmail_home_t)
+
 allow fetchmail_t fetchmail_uidl_cache_t:file manage_file_perms;
 mta_spool_filetrans(fetchmail_t, fetchmail_uidl_cache_t, file)
 
 manage_dirs_pattern(fetchmail_t, fetchmail_var_run_t, fetchmail_var_run_t)
 manage_files_pattern(fetchmail_t, fetchmail_var_run_t, fetchmail_var_run_t)
-files_pid_filetrans(fetchmail_t, fetchmail_var_run_t, { dir file })
+files_pid_filetrans(fetchmail_t, fetchmail_var_run_t, dir)
 
 kernel_read_kernel_sysctls(fetchmail_t)
 kernel_list_proc(fetchmail_t)
@@ -47,28 +51,22 @@
 kernel_read_proc_symlinks(fetchmail_t)
 kernel_dontaudit_read_system_state(fetchmail_t)
 
-#looks like it uses system command - calls uname
 corecmd_exec_bin(fetchmail_t)
 corecmd_exec_shell(fetchmail_t)
 
 corenet_all_recvfrom_unlabeled(fetchmail_t)
 corenet_all_recvfrom_netlabel(fetchmail_t)
 corenet_tcp_sendrecv_generic_if(fetchmail_t)
-corenet_udp_sendrecv_generic_if(fetchmail_t)
 corenet_tcp_sendrecv_generic_node(fetchmail_t)
-corenet_udp_sendrecv_generic_node(fetchmail_t)
-corenet_tcp_sendrecv_dns_port(fetchmail_t)
-corenet_udp_sendrecv_dns_port(fetchmail_t)
-corenet_tcp_sendrecv_pop_port(fetchmail_t)
-corenet_tcp_sendrecv_smtp_port(fetchmail_t)
-corenet_tcp_connect_all_ports(fetchmail_t)
+corenet_tcp_sendrecv_all_ports(fetchmail_t)
+
 corenet_sendrecv_all_client_packets(fetchmail_t)
+corenet_tcp_connect_all_ports(fetchmail_t)
 
 dev_read_sysfs(fetchmail_t)
 dev_read_rand(fetchmail_t)
 dev_read_urand(fetchmail_t)
 
-files_read_etc_files(fetchmail_t)
 files_read_etc_runtime_files(fetchmail_t)
 files_dontaudit_search_home(fetchmail_t)
 
@@ -77,15 +75,15 @@
 
 domain_use_interactive_fds(fetchmail_t)
 
+auth_use_nsswitch(fetchmail_t)
+
 logging_send_syslog_msg(fetchmail_t)
 
 miscfiles_read_localization(fetchmail_t)
 miscfiles_read_generic_certs(fetchmail_t)
 
-sysnet_read_config(fetchmail_t)
-
 userdom_dontaudit_use_unpriv_user_fds(fetchmail_t)
-userdom_dontaudit_search_user_home_dirs(fetchmail_t)
+userdom_search_user_home_dirs(fetchmail_t)
 
 optional_policy(`
 	procmail_domtrans(fetchmail_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/finger.fc refpolicy/policy/modules/contrib/finger.fc
--- refpolicy/policy/modules/contrib/finger.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/finger.fc	2012-10-02 20:05:55.086011883 +0200
@@ -1,19 +1,10 @@
-# fingerd
+/etc/cfingerd(/.*)?	gen_context(system_u:object_r:fingerd_etc_t,s0)
 
-#
-# /etc
-#
-/etc/cfingerd(/.*)?		gen_context(system_u:object_r:fingerd_etc_t,s0)
+/etc/cron\.weekly/(c)?fingerd	--	gen_context(system_u:object_r:fingerd_exec_t,s0)
 
-/etc/cron\.weekly/(c)?fingerd -- gen_context(system_u:object_r:fingerd_exec_t,s0)
-
-#
-# /usr
-#
-/usr/sbin/in\.fingerd	--	gen_context(system_u:object_r:fingerd_exec_t,s0)
+/usr/sbin/in\.(x)?fingerd	--	gen_context(system_u:object_r:fingerd_exec_t,s0)
 /usr/sbin/[cef]fingerd	--	gen_context(system_u:object_r:fingerd_exec_t,s0)
 
-#
-# /var
-#
-/var/log/cfingerd\.log.* --	gen_context(system_u:object_r:fingerd_log_t,s0)
+/var/log/cfingerd\.log.*	--	gen_context(system_u:object_r:fingerd_log_t,s0)
+
+/var/run/*.fingerd\.pid	--	gen_context(system_u:object_r:fingerd_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/finger.if refpolicy/policy/modules/contrib/finger.if
--- refpolicy/policy/modules/contrib/finger.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/finger.if	2012-10-02 20:05:55.086011883 +0200
@@ -15,12 +15,13 @@
 		type fingerd_t, fingerd_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, fingerd_exec_t, fingerd_t)
 ')
 
 ########################################
 ## <summary>
-##	Allow the specified domain to connect to fingerd with a tcp socket.  (Deprecated)
+##	Connect to fingerd with a tcp socket.  (Deprecated)
 ## </summary>
 ## <param name="domain">
 ##	<summary>
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/finger.te refpolicy/policy/modules/contrib/finger.te
--- refpolicy/policy/modules/contrib/finger.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/finger.te	2012-10-06 20:40:43.092754003 +0200
@@ -1,4 +1,4 @@
-policy_module(finger, 1.9.0)
+policy_module(finger, 1.9.1)
 
 ########################################
 #
@@ -29,9 +29,6 @@
 allow fingerd_t self:process signal_perms;
 allow fingerd_t self:fifo_file rw_fifo_file_perms;
 allow fingerd_t self:tcp_socket connected_stream_socket_perms;
-allow fingerd_t self:udp_socket create_socket_perms;
-allow fingerd_t self:unix_dgram_socket create_socket_perms;
-allow fingerd_t self:unix_stream_socket create_socket_perms;
 
 manage_files_pattern(fingerd_t, fingerd_var_run_t, fingerd_var_run_t)
 files_pid_filetrans(fingerd_t, fingerd_var_run_t, file)
@@ -40,7 +37,9 @@
 read_files_pattern(fingerd_t, fingerd_etc_t, fingerd_etc_t)
 read_lnk_files_pattern(fingerd_t, fingerd_etc_t, fingerd_etc_t)
 
-allow fingerd_t fingerd_log_t:file manage_file_perms;
+allow fingerd_t fingerd_log_t:file append_file_perms;
+allow fingerd_t fingerd_log_t:file create_file_perms;
+allow fingerd_t fingerd_log_t:file setattr_file_perms;
 logging_log_filetrans(fingerd_t, fingerd_log_t, file)
 
 kernel_read_kernel_sysctls(fingerd_t)
@@ -49,16 +48,22 @@
 corenet_all_recvfrom_unlabeled(fingerd_t)
 corenet_all_recvfrom_netlabel(fingerd_t)
 corenet_tcp_sendrecv_generic_if(fingerd_t)
-corenet_udp_sendrecv_generic_if(fingerd_t)
 corenet_tcp_sendrecv_generic_node(fingerd_t)
-corenet_udp_sendrecv_generic_node(fingerd_t)
-corenet_tcp_sendrecv_all_ports(fingerd_t)
-corenet_udp_sendrecv_all_ports(fingerd_t)
 corenet_tcp_bind_generic_node(fingerd_t)
+
+corenet_sendrecv_fingerd_server_packets(fingerd_t)
 corenet_tcp_bind_fingerd_port(fingerd_t)
+corenet_tcp_sendrecv_fingerd_port(fingerd_t)
+
+corecmd_exec_bin(fingerd_t)
+corecmd_exec_shell(fingerd_t)
 
 dev_read_sysfs(fingerd_t)
 
+domain_use_interactive_fds(fingerd_t)
+
+files_read_etc_runtime_files(fingerd_t)
+
 fs_getattr_all_fs(fingerd_t)
 fs_search_auto_mountpoints(fingerd_t)
 
@@ -67,15 +72,6 @@
 
 auth_read_lastlog(fingerd_t)
 
-corecmd_exec_bin(fingerd_t)
-corecmd_exec_shell(fingerd_t)
-
-domain_use_interactive_fds(fingerd_t)
-
-files_search_home(fingerd_t)
-files_read_etc_files(fingerd_t)
-files_read_etc_runtime_files(fingerd_t)
-
 init_read_utmp(fingerd_t)
 init_dontaudit_write_utmp(fingerd_t)
 
@@ -83,13 +79,8 @@
 
 mta_getattr_spool(fingerd_t)
 
-sysnet_read_config(fingerd_t)
-
 miscfiles_read_localization(fingerd_t)
 
-# stop it accessing sub-directories, prevents checking a Maildir for new mail,
-# have to change this when we create a type for Maildir
-userdom_read_user_home_content_files(fingerd_t)
 userdom_dontaudit_use_unpriv_user_fds(fingerd_t)
 
 optional_policy(`
@@ -101,14 +92,6 @@
 ')
 
 optional_policy(`
-	nis_use_ypbind(fingerd_t)
-')
-
-optional_policy(`
-	nscd_socket_use(fingerd_t)
-')
-
-optional_policy(`
 	seutil_sigchld_newrole(fingerd_t)
 ')
 
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/firewalld.fc refpolicy/policy/modules/contrib/firewalld.fc
--- refpolicy/policy/modules/contrib/firewalld.fc	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/firewalld.fc	2012-10-02 20:06:03.806011902 +0200
@@ -0,0 +1,10 @@
+/etc/rc\.d/init\.d/firewalld	--	gen_context(system_u:object_r:firewalld_initrc_exec_t,s0)
+
+/etc/firewalld(/.*)?	gen_context(system_u:object_r:firewalld_etc_rw_t,s0)
+
+/usr/sbin/firewalld	--	gen_context(system_u:object_r:firewalld_exec_t,s0)
+
+/var/log/firewalld.*	--	gen_context(system_u:object_r:firewalld_var_log_t,s0)
+
+/var/run/firewalld(/.*)?	gen_context(system_u:object_r:firewalld_var_run_t,s0)
+/var/run/firewalld\.pid	--	gen_context(system_u:object_r:firewalld_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/firewalld.if refpolicy/policy/modules/contrib/firewalld.if
--- refpolicy/policy/modules/contrib/firewalld.if	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/firewalld.if	2012-10-22 20:10:27.527015427 +0200
@@ -0,0 +1,64 @@
+## <summary>Service daemon with a D-BUS interface that provides a dynamic managed firewall.</summary>
+
+########################################
+## <summary>
+##	Send and receive messages from
+##	firewalld over dbus.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`firewalld_dbus_chat',`
+	gen_require(`
+		type firewalld_t;
+		class dbus send_msg;
+	')
+
+	allow $1 firewalld_t:dbus send_msg;
+	allow firewalld_t $1:dbus send_msg;
+')
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an firewalld environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`firewalld_admin',`
+	gen_require(`
+		type firewalld_t, firewalld_initrc_exec_t;
+		type firewall_etc_rw_t, firewalld_var_run_t;
+		type firewalld_var_log_t;
+	')
+
+	allow $1 firewalld_t:process { ptrace signal_perms };
+	ps_process_pattern($1, firewalld_t)
+
+	init_labeled_script_domtrans($1, firewalld_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 firewalld_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	files_search_pids($1)
+	admin_pattern($1, firewalld_var_run_t)
+	
+	logging_search_logs($1)
+	admin_pattern($1, firewalld_var_log_t)
+
+	files_search_etc($1)
+	admin_pattern($1, firewall_etc_rw_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/firewalld.te refpolicy/policy/modules/contrib/firewalld.te
--- refpolicy/policy/modules/contrib/firewalld.te	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/firewalld.te	2012-10-30 19:32:26.490399556 +0100
@@ -0,0 +1,92 @@
+policy_module(firewalld, 1.0.4)
+
+########################################
+#
+# Declarations
+#
+
+type firewalld_t;
+type firewalld_exec_t;
+init_daemon_domain(firewalld_t, firewalld_exec_t)
+
+type firewalld_initrc_exec_t;
+init_script_file(firewalld_initrc_exec_t)
+
+type firewalld_etc_rw_t;
+files_config_file(firewalld_etc_rw_t)
+
+type firewalld_var_log_t;
+logging_log_file(firewalld_var_log_t)
+
+type firewalld_var_run_t;
+files_pid_file(firewalld_var_run_t)
+
+########################################
+#
+# Local policy
+#
+
+allow firewalld_t self:capability sys_nice;
+dontaudit firewalld_t self:capability sys_tty_config;
+allow firewalld_t self:process setsched;
+allow firewalld_t self:fifo_file rw_fifo_file_perms;
+allow firewalld_t self:unix_stream_socket { accept listen };
+allow firewalld_t self:udp_socket create_socket_perms;
+
+manage_dirs_pattern(firewalld_t, firewalld_etc_rw_t, firewalld_etc_rw_t)
+manage_files_pattern(firewalld_t, firewalld_etc_rw_t, firewalld_etc_rw_t)
+
+allow firewalld_t firewalld_var_log_t:file append_file_perms;
+allow firewalld_t firewalld_var_log_t:file create_file_perms;
+allow firewalld_t firewalld_var_log_t:file read_file_perms;
+allow firewalld_t firewalld_var_log_t:file setattr_file_perms;
+logging_log_filetrans(firewalld_t, firewalld_var_log_t, file)
+
+manage_files_pattern(firewalld_t, firewalld_var_run_t, firewalld_var_run_t)
+files_pid_filetrans(firewalld_t, firewalld_var_run_t, file)
+
+kernel_read_network_state(firewalld_t)
+kernel_read_system_state(firewalld_t)
+
+corecmd_exec_bin(firewalld_t)
+corecmd_exec_shell(firewalld_t)
+
+dev_read_urand(firewalld_t)
+
+domain_use_interactive_fds(firewalld_t)
+
+files_list_tmp(firewalld_t)
+files_read_etc_files(firewalld_t)
+files_read_usr_files(firewalld_t)
+files_dontaudit_list_tmp(firewalld_t)
+
+fs_getattr_xattr_fs(firewalld_t)
+
+logging_send_syslog_msg(firewalld_t)
+
+miscfiles_read_localization(firewalld_t)
+
+seutil_exec_setfiles(firewalld_t)
+seutil_read_file_contexts(firewalld_t)
+
+sysnet_read_config(firewalld_t)
+
+optional_policy(`
+	dbus_system_domain(firewalld_t, firewalld_exec_t)
+
+	optional_policy(`
+		policykit_dbus_chat(firewalld_t)
+	')
+
+	optional_policy(`
+		networkmanager_dbus_chat(firewalld_t)
+	')
+')
+
+optional_policy(`
+	iptables_domtrans(firewalld_t)
+')
+
+optional_policy(`
+	modutils_domtrans_insmod(firewalld_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/firewallgui.fc refpolicy/policy/modules/contrib/firewallgui.fc
--- refpolicy/policy/modules/contrib/firewallgui.fc	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/firewallgui.fc	2012-10-27 13:03:12.557002169 +0200
@@ -0,0 +1 @@
+/usr/share/system-config-firewall/system-config-firewall-mechanism.py	--	gen_context(system_u:object_r:firewallgui_exec_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/firewallgui.if refpolicy/policy/modules/contrib/firewallgui.if
--- refpolicy/policy/modules/contrib/firewallgui.if	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/firewallgui.if	2012-10-27 13:03:12.558002169 +0200
@@ -0,0 +1,41 @@
+## <summary>system-config-firewall dbus system service.</summary>
+
+########################################
+## <summary>
+##	Send and receive messages from
+##	firewallgui over dbus.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`firewallgui_dbus_chat',`
+	gen_require(`
+		type firewallgui_t;
+		class dbus send_msg;
+	')
+
+	allow $1 firewallgui_t:dbus send_msg;
+	allow firewallgui_t $1:dbus send_msg;
+')
+
+########################################
+## <summary>
+##	Do not audit attempts to read and
+##	write firewallgui unnamed pipes.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain to not audit.
+##	</summary>
+## </param>
+#
+interface(`firewallgui_dontaudit_rw_pipes',`
+	gen_require(`
+		type firewallgui_t;
+	')
+
+	dontaudit $1 firewallgui_t:fifo_file rw_fifo_file_perms;
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/firewallgui.te refpolicy/policy/modules/contrib/firewallgui.te
--- refpolicy/policy/modules/contrib/firewallgui.te	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/firewallgui.te	2012-10-27 13:42:42.565007227 +0200
@@ -0,0 +1,73 @@
+policy_module(firewallgui, 1.0.1)
+
+########################################
+#
+# Declarations
+#
+
+type firewallgui_t;
+type firewallgui_exec_t;
+init_system_domain(firewallgui_t, firewallgui_exec_t)
+
+type firewallgui_tmp_t;
+files_tmp_file(firewallgui_tmp_t)
+
+########################################
+#
+# Local policy
+#
+
+allow firewallgui_t self:capability { net_admin sys_rawio } ;
+allow firewallgui_t self:fifo_file rw_fifo_file_perms;
+
+manage_files_pattern(firewallgui_t,firewallgui_tmp_t,firewallgui_tmp_t)
+manage_dirs_pattern(firewallgui_t,firewallgui_tmp_t,firewallgui_tmp_t)
+files_tmp_filetrans(firewallgui_t,firewallgui_tmp_t, { file dir })
+
+kernel_read_system_state(firewallgui_t)
+kernel_read_network_state(firewallgui_t)
+kernel_rw_net_sysctls(firewallgui_t)
+kernel_rw_kernel_sysctl(firewallgui_t)
+kernel_rw_vm_sysctls(firewallgui_t)
+
+corecmd_exec_bin(firewallgui_t)
+corecmd_exec_shell(firewallgui_t)
+
+dev_read_sysfs(firewallgui_t)
+dev_read_urand(firewallgui_t)
+
+files_list_kernel_modules(firewallgui_t)
+files_read_usr_files(firewallgui_t)
+
+auth_use_nsswitch(firewallgui_t)
+
+miscfiles_read_localization(firewallgui_t)
+
+seutil_read_config(firewallgui_t)
+
+userdom_dontaudit_search_user_home_dirs(firewallgui_t)
+
+optional_policy(`
+	consoletype_exec(firewallgui_t)
+')
+
+optional_policy(`
+	dbus_system_domain(firewallgui_t, firewallgui_exec_t)
+
+	optional_policy(`
+		policykit_dbus_chat(firewallgui_t)
+	')
+')
+
+optional_policy(`
+	gnome_read_generic_gconf_home_content(firewallgui_t)
+')
+
+optional_policy(`
+	iptables_domtrans(firewallgui_t)
+	iptables_initrc_domtrans(firewallgui_t)
+')
+
+optional_policy(`
+	modutils_getattr_module_deps(firewallgui_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/firstboot.fc refpolicy/policy/modules/contrib/firstboot.fc
--- refpolicy/policy/modules/contrib/firstboot.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/firstboot.fc	2012-10-02 20:07:04.518015103 +0200
@@ -1,3 +1,5 @@
-/usr/sbin/firstboot		--	gen_context(system_u:object_r:firstboot_exec_t,s0)
+/etc/rc\.d/init\.d/firstboot.*	--	gen_context(system_u:object_r:firstboot_initrc_exec_t,s0)
 
-/usr/share/firstboot/firstboot\.py --	gen_context(system_u:object_r:firstboot_exec_t,s0)
+/usr/sbin/firstboot	--	gen_context(system_u:object_r:firstboot_exec_t,s0)
+
+/usr/share/firstboot/firstboot\.py	--	gen_context(system_u:object_r:firstboot_exec_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/firstboot.if refpolicy/policy/modules/contrib/firstboot.if
--- refpolicy/policy/modules/contrib/firstboot.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/firstboot.if	2012-10-02 20:07:04.528014258 +0200
@@ -1,7 +1,4 @@
-## <summary>
-##	Final system configuration run during the first boot
-##	after installation of Red Hat/Fedora systems.
-## </summary>
+## <summary>Initial system configuration utility.</summary>
 
 ########################################
 ## <summary>
@@ -18,13 +15,15 @@
 		type firstboot_t, firstboot_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, firstboot_exec_t, firstboot_t)
 ')
 
 ########################################
 ## <summary>
-##	Execute firstboot in the firstboot domain, and
-##	allow the specified role the firstboot domain.
+##	Execute firstboot in the firstboot
+##	domain, and allow the specified role
+##	the firstboot domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -39,16 +38,16 @@
 #
 interface(`firstboot_run',`
 	gen_require(`
-		type firstboot_t;
+		attribute_role firstboot_roles;
 	')
 
 	firstboot_domtrans($1)
-	role $2 types firstboot_t;
+	roleattribute $2 firstboot_roles;
 ')
 
 ########################################
 ## <summary>
-##	Inherit and use a file descriptor from firstboot.
+##	Inherit and use firstboot file descriptors.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -66,8 +65,8 @@
 
 ########################################
 ## <summary>
-##	Do not audit attempts to inherit a
-##	file descriptor from firstboot.
+##	Do not audit attempts to inherit
+##	firstboot file descriptors.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -85,7 +84,7 @@
 
 ########################################
 ## <summary>
-##	Write to a firstboot unnamed pipe.
+##	Write firstboot unnamed pipes.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -103,7 +102,7 @@
 
 ########################################
 ## <summary>
-##	Read and Write to a firstboot unnamed pipe.
+##	Read and Write firstboot unnamed pipes.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -121,7 +120,8 @@
 
 ########################################
 ## <summary>
-## 	Do not audit attemps to read and write to a firstboot unnamed pipe.
+## 	Do not audit attemps to read and
+##	write firstboot unnamed pipes.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -139,8 +139,9 @@
 
 ########################################
 ## <summary>
-## 	Do not audit attemps to read and write to a firstboot
-##	unix domain stream socket.
+## 	Do not audit attemps to read and
+##	write firstboot unix domain
+##	stream sockets.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/firstboot.te refpolicy/policy/modules/contrib/firstboot.te
--- refpolicy/policy/modules/contrib/firstboot.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/firstboot.te	2012-10-10 21:38:35.065026249 +0200
@@ -1,7 +1,7 @@
-policy_module(firstboot, 1.12.0)
+policy_module(firstboot, 1.12.3)
 
 gen_require(`
-	class passwd rootok;
+	class passwd { passwd chfn chsh rootok };
 ')
 
 ########################################
@@ -9,12 +9,17 @@
 # Declarations
 #
 
+attribute_role firstboot_roles;
+
 type firstboot_t;
 type firstboot_exec_t;
 init_system_domain(firstboot_t, firstboot_exec_t)
 domain_obj_id_change_exemption(firstboot_t)
 domain_subj_id_change_exemption(firstboot_t)
-role system_r types firstboot_t;
+role firstboot_roles types firstboot_t;
+
+type firstboot_initrc_exec_t;
+init_script_file(firstboot_initrc_exec_t)
 
 type firstboot_etc_t;
 files_config_file(firstboot_etc_t)
@@ -27,23 +32,28 @@
 allow firstboot_t self:capability { dac_override setgid };
 allow firstboot_t self:process setfscreate;
 allow firstboot_t self:fifo_file rw_fifo_file_perms;
-allow firstboot_t self:tcp_socket create_stream_socket_perms;
-allow firstboot_t self:unix_stream_socket { connect create };
-allow firstboot_t self:passwd rootok;
+allow firstboot_t self:tcp_socket { accept listen };
+allow firstboot_t self:passwd { rootok passwd chfn chsh };
 
 allow firstboot_t firstboot_etc_t:file read_file_perms;
 
 kernel_read_system_state(firstboot_t)
 kernel_read_kernel_sysctls(firstboot_t)
 
-corenet_all_recvfrom_unlabeled(firstboot_t)
-corenet_all_recvfrom_netlabel(firstboot_t)
-corenet_tcp_sendrecv_generic_if(firstboot_t)
-corenet_tcp_sendrecv_generic_node(firstboot_t)
-corenet_tcp_sendrecv_all_ports(firstboot_t)
+corecmd_exec_all_executables(firstboot_t)
 
 dev_read_urand(firstboot_t)
 
+files_exec_etc_files(firstboot_t)
+files_manage_etc_files(firstboot_t)
+files_manage_etc_runtime_files(firstboot_t)
+files_read_usr_files(firstboot_t)
+files_manage_var_dirs(firstboot_t)
+files_manage_var_files(firstboot_t)
+files_manage_var_symlinks(firstboot_t)
+files_create_boot_flag(firstboot_t)
+files_delete_boot_flag(firstboot_t)
+
 selinux_get_fs_mount(firstboot_t)
 selinux_validate_context(firstboot_t)
 selinux_compute_access_vector(firstboot_t)
@@ -53,16 +63,6 @@
 
 auth_dontaudit_getattr_shadow(firstboot_t)
 
-corecmd_exec_all_executables(firstboot_t)
-
-files_exec_etc_files(firstboot_t)
-files_manage_etc_files(firstboot_t)
-files_manage_etc_runtime_files(firstboot_t)
-files_read_usr_files(firstboot_t)
-files_manage_var_dirs(firstboot_t)
-files_manage_var_files(firstboot_t)
-files_manage_var_symlinks(firstboot_t)
-
 init_domtrans_script(firstboot_t)
 init_rw_utmp(firstboot_t)
 
@@ -75,13 +75,9 @@
 
 miscfiles_read_localization(firstboot_t)
 
-modutils_domtrans_insmod(firstboot_t)
-modutils_domtrans_depmod(firstboot_t)
-modutils_read_module_config(firstboot_t)
-modutils_read_module_deps(firstboot_t)
+sysnet_dns_name_resolve(firstboot_t)
 
 userdom_use_user_terminals(firstboot_t)
-# Add/remove user home directories
 userdom_manage_user_home_content_dirs(firstboot_t)
 userdom_manage_user_home_content_files(firstboot_t)
 userdom_manage_user_home_content_symlinks(firstboot_t)
@@ -91,10 +87,6 @@
 userdom_user_home_dir_filetrans_user_home_content(firstboot_t, { dir file lnk_file fifo_file sock_file })
 
 optional_policy(`
-	consoletype_domtrans(firstboot_t)
-')
-
-optional_policy(`
 	dbus_system_bus_client(firstboot_t)
 
 	optional_policy(`
@@ -103,6 +95,13 @@
 ')
 
 optional_policy(`
+	modutils_domtrans_insmod(firstboot_t)
+	modutils_domtrans_depmod(firstboot_t)
+	modutils_read_module_config(firstboot_t)
+	modutils_read_module_deps(firstboot_t)
+')
+
+optional_policy(`
 	nis_use_ypbind(firstboot_t)
 ')
 
@@ -112,24 +111,16 @@
 
 optional_policy(`
 	unconfined_domtrans(firstboot_t)
-	# The big hammer
 	unconfined_domain(firstboot_t)
 ')
 
 optional_policy(`
-	usermanage_domtrans_chfn(firstboot_t)
-	usermanage_domtrans_groupadd(firstboot_t)
-	usermanage_domtrans_passwd(firstboot_t)
-	usermanage_domtrans_useradd(firstboot_t)
-	usermanage_domtrans_admin_passwd(firstboot_t)
-')
-
-optional_policy(`
-	gnome_manage_config(firstboot_t)
+	gnome_manage_generic_home_content(firstboot_t)
 ')
 
 optional_policy(`
 	xserver_domtrans(firstboot_t)
 	xserver_rw_shm(firstboot_t)
 	xserver_unconfined(firstboot_t)
+	xserver_stream_connect(firstboot_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/flash.fc refpolicy/policy/modules/contrib/flash.fc
--- refpolicy/policy/modules/contrib/flash.fc	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/flash.fc	2012-07-27 15:56:29.471108033 +0200
@@ -0,0 +1,2 @@
+HOME_DIR/\.adobe/Flash_Player(/.*)?	gen_context(system_u:object_r:flash_home_t,s0)
+HOME_DIR/\.macromedia(/.*)?		gen_context(system_u:object_r:flash_home_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/flash.if refpolicy/policy/modules/contrib/flash.if
--- refpolicy/policy/modules/contrib/flash.if	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/flash.if	2012-07-27 15:26:19.255104170 +0200
@@ -0,0 +1,40 @@
+## <summary>
+##	Flash player
+## </summary>
+
+#####################################
+## <summary>
+##	Manage the Flash player home files
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access
+##	</summary>
+## </param>
+#
+interface(`flash_manage_home',`
+	gen_require(`
+		type flash_home_t;
+	')
+
+	manage_files_pattern($1, flash_home_t, flash_home_t)
+	manage_dirs_pattern($1, flash_home_t, flash_home_t)
+')
+####################################
+## <summary>
+##	Relabel the flash home resources
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access
+##	</summary>
+## </param>
+#
+interface(`flash_relabel_home',`
+	gen_require(`
+		type flash_home_t;
+	')
+
+	relabel_files_pattern($1, flash_home_t, flash_home_t)
+	relabel_dirs_pattern($1, flash_home_t, flash_home_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/flash.te refpolicy/policy/modules/contrib/flash.te
--- refpolicy/policy/modules/contrib/flash.te	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/flash.te	2012-07-27 15:17:21.186103015 +0200
@@ -0,0 +1,9 @@
+policy_module(flash, 1.0.0)
+
+########################################
+#
+# Declarations
+#
+
+type flash_home_t;
+userdom_user_home_content(flash_home_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/fprintd.fc refpolicy/policy/modules/contrib/fprintd.fc
--- refpolicy/policy/modules/contrib/fprintd.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/fprintd.fc	2012-10-02 20:07:12.050011618 +0200
@@ -1,2 +1,3 @@
 /usr/libexec/fprintd	--	gen_context(system_u:object_r:fprintd_exec_t,s0)
-/var/lib/fprint(/.*)?		gen_context(system_u:object_r:fprintd_var_lib_t,s0)
+
+/var/lib/fprint(/.*)?	gen_context(system_u:object_r:fprintd_var_lib_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/fprintd.if refpolicy/policy/modules/contrib/fprintd.if
--- refpolicy/policy/modules/contrib/fprintd.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/fprintd.if	2012-10-02 20:07:12.050011618 +0200
@@ -1,4 +1,4 @@
-## <summary>DBus fingerprint reader service</summary>
+## <summary>DBus fingerprint reader service.</summary>
 
 ########################################
 ## <summary>
@@ -15,6 +15,7 @@
 		type fprintd_t, fprintd_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, fprintd_exec_t, fprintd_t)
 ')
 
@@ -38,4 +39,3 @@
 	allow $1 fprintd_t:dbus send_msg;
 	allow fprintd_t $1:dbus send_msg;
 ')
-
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/fprintd.te refpolicy/policy/modules/contrib/fprintd.te
--- refpolicy/policy/modules/contrib/fprintd.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/fprintd.te	2012-10-02 20:07:12.060011865 +0200
@@ -1,4 +1,4 @@
-policy_module(fprintd, 1.1.0)
+policy_module(fprintd, 1.1.1)
 
 ########################################
 #
@@ -7,7 +7,7 @@
 
 type fprintd_t;
 type fprintd_exec_t;
-dbus_system_domain(fprintd_t, fprintd_exec_t)
+init_daemon_domain(fprintd_t, fprintd_exec_t)
 
 type fprintd_var_lib_t;
 files_type(fprintd_var_lib_t)
@@ -17,23 +17,19 @@
 # Local policy
 #
 
-allow fprintd_t self:capability sys_ptrace;
+allow fprintd_t self:capability sys_nice;
+allow fprintd_t self:process { getsched setsched signal sigkill };
 allow fprintd_t self:fifo_file rw_fifo_file_perms;
-allow fprintd_t self:process { getsched signal };
 
 manage_dirs_pattern(fprintd_t, fprintd_var_lib_t, fprintd_var_lib_t)
 manage_files_pattern(fprintd_t, fprintd_var_lib_t, fprintd_var_lib_t)
-files_var_lib_filetrans(fprintd_t, fprintd_var_lib_t, { dir file })
 
 kernel_read_system_state(fprintd_t)
 
-corecmd_search_bin(fprintd_t)
-
 dev_list_usbfs(fprintd_t)
-dev_rw_generic_usb_dev(fprintd_t)
 dev_read_sysfs(fprintd_t)
+dev_rw_generic_usb_dev(fprintd_t)
 
-files_read_etc_files(fprintd_t)
 files_read_usr_files(fprintd_t)
 
 fs_getattr_all_fs(fprintd_t)
@@ -46,12 +42,20 @@
 userdom_read_all_users_state(fprintd_t)
 
 optional_policy(`
-	consolekit_dbus_chat(fprintd_t)
+	dbus_system_domain(fprintd_t, fprintd_exec_t)
+
+	optional_policy(`
+		consolekit_dbus_chat(fprintd_t)
+	')
+
+	optional_policy(`
+		policykit_dbus_chat(fprintd_t)
+		policykit_dbus_chat_auth(fprintd_t)
+	')
 ')
 
 optional_policy(`
+	policykit_domtrans_auth(fprintd_t)
 	policykit_read_reload(fprintd_t)
 	policykit_read_lib(fprintd_t)
-	policykit_dbus_chat(fprintd_t)
-	policykit_domtrans_auth(fprintd_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/ftp.fc refpolicy/policy/modules/contrib/ftp.fc
--- refpolicy/policy/modules/contrib/ftp.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/ftp.fc	2012-10-02 20:07:17.382012058 +0200
@@ -1,14 +1,10 @@
-#
-# /etc
-#
 /etc/proftpd\.conf	--	gen_context(system_u:object_r:ftpd_etc_t,s0)
-/etc/cron\.monthly/proftpd --	gen_context(system_u:object_r:ftpd_exec_t,s0)
-/etc/rc\.d/init\.d/vsftpd --	gen_context(system_u:object_r:ftpd_initrc_exec_t,s0)
-/etc/rc\.d/init\.d/proftpd --	gen_context(system_u:object_r:ftpd_initrc_exec_t,s0)
-
-#
-# /usr
-#
+
+/etc/cron\.monthly/proftpd	--	gen_context(system_u:object_r:ftpd_exec_t,s0)
+
+/etc/rc\.d/init\.d/vsftpd	--	gen_context(system_u:object_r:ftpd_initrc_exec_t,s0)
+/etc/rc\.d/init\.d/proftpd	--	gen_context(system_u:object_r:ftpd_initrc_exec_t,s0)
+
 /usr/bin/ftpdctl	--	gen_context(system_u:object_r:ftpdctl_exec_t,s0)
 
 /usr/kerberos/sbin/ftpd	--	gen_context(system_u:object_r:ftpd_exec_t,s0)
@@ -19,13 +15,14 @@
 /usr/sbin/proftpd	--	gen_context(system_u:object_r:ftpd_exec_t,s0)
 /usr/sbin/vsftpd	--	gen_context(system_u:object_r:ftpd_exec_t,s0)
 
-#
-# /var
-#
-/var/run/proftpd.* 		gen_context(system_u:object_r:ftpd_var_run_t,s0)
+/var/run/proftpd.*	gen_context(system_u:object_r:ftpd_var_run_t,s0)
+
+/usr/libexec/webmin/vsftpd/webalizer/xfer_log	--	gen_context(system_u:object_r:xferlog_t,s0)
+
+/var/lock/subsys/*.ftpd	--	gen_context(system_u:object_r:ftpd_lock_t,s0)
 
-/var/log/muddleftpd\.log.* --	gen_context(system_u:object_r:xferlog_t,s0)
-/var/log/proftpd(/.*)?		gen_context(system_u:object_r:xferlog_t,s0)
+/var/log/muddleftpd\.log.*	--	gen_context(system_u:object_r:xferlog_t,s0)
+/var/log/proftpd(/.*)?	gen_context(system_u:object_r:xferlog_t,s0)
 /var/log/vsftpd.*	--	gen_context(system_u:object_r:xferlog_t,s0)
 /var/log/xferlog.*	--	gen_context(system_u:object_r:xferlog_t,s0)
 /var/log/xferreport.*	--	gen_context(system_u:object_r:xferlog_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/ftp.if refpolicy/policy/modules/contrib/ftp.if
--- refpolicy/policy/modules/contrib/ftp.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/ftp.if	2012-10-02 20:07:17.383012058 +0200
@@ -1,8 +1,8 @@
-## <summary>File transfer protocol service</summary>
+## <summary>File transfer protocol service.</summary>
 
 #######################################
 ## <summary>
-##	Allow domain dyntransition to sftpd_anon domain.
+##	Execute a dyntransition to run anon sftpd.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -20,7 +20,7 @@
 
 ########################################
 ## <summary>
-##	Use ftp by connecting over TCP.  (Deprecated)
+##	Connect to over ftpd over TCP.  (Deprecated)
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -34,7 +34,7 @@
 
 ########################################
 ## <summary>
-##	Read ftpd etc files
+##	Read ftpd configuration files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -67,12 +67,12 @@
 	')
 
 	corecmd_search_bin($1)
-	allow $1 ftpd_exec_t:file { getattr execute };
+	allow $1 ftpd_exec_t:file mmap_file_perms;
 ')
 
 ########################################
 ## <summary>
-##	Read FTP transfer logs
+##	Read ftpd log files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -91,7 +91,7 @@
 
 ########################################
 ## <summary>
-##	Execute the ftpdctl program in the ftpdctl domain.
+##	Execute the ftpdctl in the ftpdctl domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -110,7 +110,9 @@
 
 ########################################
 ## <summary>
-##	Execute the ftpdctl program in the ftpdctl domain.
+##	Execute the ftpdctl in the ftpdctl
+##	domain, and allow the specified
+##	role the ftpctl domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -119,23 +121,23 @@
 ## </param>
 ## <param name="role">
 ##	<summary>
-##	The role to allow the ftpdctl domain.
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <rolecap/>
 #
 interface(`ftp_run_ftpdctl',`
 	gen_require(`
-		type ftpdctl_t;
+		attribute_role ftpdctl_roles;
 	')
 
 	ftp_domtrans_ftpdctl($1)
-	role $2 types ftpdctl_t;
+	roleattribute $2 ftpdctl_roles;
 ')
 
 #######################################
 ## <summary>
-##	Allow domain dyntransition to sftpd domain.
+##	Execute a dyntransition to run sftpd.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -153,8 +155,8 @@
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate
-##	an ftp environment
+##	All of the rules required to
+##	administrate an ftp environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -163,7 +165,7 @@
 ## </param>
 ## <param name="role">
 ##	<summary>
-##	The role to be allowed to manage the ftp domain.
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <rolecap/>
@@ -171,26 +173,23 @@
 interface(`ftp_admin',`
 	gen_require(`
 		type ftpd_t, ftpdctl_t, ftpd_tmp_t;
-		type ftpd_etc_t, ftpd_lock_t;
-		type ftpd_var_run_t, xferlog_t;
-		type ftpd_initrc_exec_t;
+		type ftpd_etc_t, ftpd_lock_t, sftpd_t;
+		type ftpd_var_run_t, xferlog_t, anon_sftpd_t;
+		type ftpd_initrc_exec_t, ftpdctl_tmp_t;
 	')
 
-	allow $1 ftpd_t:process { ptrace signal_perms };
-	ps_process_pattern($1, ftpd_t)
+	allow $1 { ftpd_t ftpdctl_t sftpd_t anon_sftpd }:process { ptrace signal_perms };
+	ps_process_pattern($1, { ftpd_t ftpdctl_t sftpd_t anon_sftpd_t })
 
 	init_labeled_script_domtrans($1, ftpd_initrc_exec_t)
 	domain_system_change_exemption($1)
 	role_transition $2 ftpd_initrc_exec_t system_r;
 	allow $2 system_r;
 
-	ps_process_pattern($1, ftpdctl_t)
-	ftp_run_ftpdctl($1, $2)
-
 	miscfiles_manage_public_files($1)
 
 	files_list_tmp($1)
-	admin_pattern($1, ftpd_tmp_t)
+	admin_pattern($1, { ftpd_tmp_t ftpdctl_tmp_t })
 
 	files_list_etc($1)
 	admin_pattern($1, ftpd_etc_t)
@@ -203,4 +202,6 @@
 
 	logging_list_logs($1)
 	admin_pattern($1, xferlog_t)
+
+	ftp_run_ftpdctl($1, $2)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/ftp.te refpolicy/policy/modules/contrib/ftp.te
--- refpolicy/policy/modules/contrib/ftp.te	2012-07-25 20:33:04.000000000 +0200
+++ refpolicy/policy/modules/contrib/ftp.te	2012-10-02 20:07:17.401012056 +0200
@@ -1,4 +1,4 @@
-policy_module(ftp, 1.14.0)
+policy_module(ftp, 1.14.1)
 
 ########################################
 #
@@ -6,70 +6,109 @@
 #
 
 ## <desc>
-## <p>
-## Allow ftp servers to upload files,  used for public file
-## transfer services. Directories must be labeled
-## public_content_rw_t.
-## </p>
+##	<p>
+##	Determine whether ftpd can modify
+##	public files used for public file
+##	transfer services. Directories/Files must
+##	be labeled public_content_rw_t.
+##	</p>
 ## </desc>
 gen_tunable(allow_ftpd_anon_write, false)
 
 ## <desc>
-## <p>
-## Allow ftp servers to login to local users and
-## read/write all files on the system, governed by DAC.
-## </p>
+##	<p>
+##	Determine whether ftpd can login to
+##	local users and can read and write
+##	all files on the system, governed by DAC.
+##	</p>
 ## </desc>
 gen_tunable(allow_ftpd_full_access, false)
 
 ## <desc>
-## <p>
-## Allow ftp servers to use cifs
-## used for public file transfer services.
-## </p>
+##	<p>
+##	Determine whether ftpd can use CIFS
+##	used for public file transfer services.
+##	</p>
 ## </desc>
 gen_tunable(allow_ftpd_use_cifs, false)
 
 ## <desc>
-## <p>
-## Allow ftp servers to use nfs
-## used for public file transfer services.
-## </p>
+##	<p>
+##	Determine whether ftpd can use NFS
+##	used for public file transfer services.
+##	</p>
 ## </desc>
 gen_tunable(allow_ftpd_use_nfs, false)
 
 ## <desc>
-## <p>
-## Allow ftp to read and write files in the user home directories
-## </p>
+##	<p>
+##	Determine whether ftpd can connect to
+##	databases over the TCP network.
+##	</p>
+## </desc>
+gen_tunable(ftpd_connect_db, false)
+
+## <desc>
+##	<p>
+##	Determine whether ftpd can bind to all
+##	unreserved ports for passive mode.
+##	</p>
+##	</desc>
+gen_tunable(ftpd_use_passive_mode, false)
+
+## <desc>
+##	<p>
+##	Determine whether ftpd can connect to
+##	all unreserved ports.
+##	</p>
+## </desc>
+gen_tunable(ftpd_connect_all_unreserved, false)
+
+## <desc>
+##	<p>
+##	Determine whether ftpd can read and write
+##	files in user home directories.
+##	</p>
 ## </desc>
 gen_tunable(ftp_home_dir, false)
 
 ## <desc>
-## <p>
-## Allow anon internal-sftp to upload files, used for
-## public file transfer services. Directories must be labeled
-## public_content_rw_t.
-## </p>
+##	<p>
+##	Determine whether sftpd can modify
+##	public files used for public file
+##	transfer services. Directories/Files must
+##	be labeled public_content_rw_t.
+##	</p>
 ## </desc>
 gen_tunable(sftpd_anon_write, false)
 
 ## <desc>
-## <p>
-## Allow sftp-internal to read and write files
-## in the user home directories
-## </p>
+##	<p>
+##	Determine whether sftpd-can read and write
+##	files in user home directories.
+##	</p>
 ## </desc>
 gen_tunable(sftpd_enable_homedirs, false)
 
 ## <desc>
-## <p>
-## Allow sftp-internal to login to local users and
-## read/write all files on the system, governed by DAC.
-## </p>
+##	<p>
+##	Determine whether sftpd-can login to
+##	local users and read and write all
+##	files on the system, governed by DAC.
+##	</p>
 ## </desc>
 gen_tunable(sftpd_full_access, false)
 
+## <desc>
+##	<p>
+##	Determine whether sftpd can read and write
+##	files in user ssh home directories.
+##	</p>
+## </desc>
+gen_tunable(sftpd_write_ssh_home, false)
+
+attribute_role ftpdctl_roles;
+
 type anon_sftpd_t;
 typealias anon_sftpd_t alias sftpd_anon_t;
 domain_type(anon_sftpd_t)
@@ -100,6 +139,7 @@
 type ftpdctl_t;
 type ftpdctl_exec_t;
 init_system_domain(ftpdctl_t, ftpdctl_exec_t)
+role ftpdctl_roles types ftpdctl_t;
 
 type ftpdctl_tmp_t;
 files_tmp_file(ftpdctl_tmp_t)
@@ -115,32 +155,22 @@
 	init_ranged_daemon_domain(ftpd_t, ftpd_exec_t, s0 - mcs_systemhigh)
 ')
 
-########################################
-#
-# anon-sftp local policy
-#
-
-files_read_etc_files(anon_sftpd_t)
-
-miscfiles_read_public_files(anon_sftpd_t)
-
-tunable_policy(`sftpd_anon_write',`
-	miscfiles_manage_public_files(anon_sftpd_t)
+ifdef(`enable_mls',`
+	init_ranged_daemon_domain(ftpd_t, ftpd_exec_t, mls_systemhigh)
 ')
 
 ########################################
 #
-# ftpd local policy
+# Local policy
 #
 
-allow ftpd_t self:capability { chown fowner fsetid setgid setuid sys_chroot sys_nice sys_resource };
+allow ftpd_t self:capability { chown fowner fsetid ipc_lock kill setgid setuid sys_chroot sys_admin sys_nice sys_resource };
 dontaudit ftpd_t self:capability sys_tty_config;
 allow ftpd_t self:process { getcap getpgid setcap setsched setrlimit signal_perms };
 allow ftpd_t self:fifo_file rw_fifo_file_perms;
-allow ftpd_t self:unix_dgram_socket { sendto create_socket_perms };
-allow ftpd_t self:unix_stream_socket create_stream_socket_perms;
-allow ftpd_t self:tcp_socket create_stream_socket_perms;
-allow ftpd_t self:udp_socket create_socket_perms;
+allow ftpd_t self:unix_dgram_socket sendto;
+allow ftpd_t self:unix_stream_socket { accept listen };
+allow ftpd_t self:tcp_socket { accept listen };
 allow ftpd_t self:shm create_shm_perms;
 allow ftpd_t self:key manage_key_perms;
 
@@ -149,10 +179,6 @@
 allow ftpd_t ftpd_lock_t:file manage_file_perms;
 files_lock_filetrans(ftpd_t, ftpd_lock_t, file)
 
-manage_dirs_pattern(ftpd_t, ftpd_tmp_t, ftpd_tmp_t)
-manage_files_pattern(ftpd_t, ftpd_tmp_t, ftpd_tmp_t)
-files_tmp_filetrans(ftpd_t, ftpd_tmp_t, { file dir })
-
 manage_dirs_pattern(ftpd_t, ftpd_tmpfs_t, ftpd_tmpfs_t)
 manage_files_pattern(ftpd_t, ftpd_tmpfs_t, ftpd_tmpfs_t)
 manage_lnk_files_pattern(ftpd_t, ftpd_tmpfs_t, ftpd_tmpfs_t)
@@ -163,16 +189,14 @@
 manage_dirs_pattern(ftpd_t, ftpd_var_run_t, ftpd_var_run_t)
 manage_files_pattern(ftpd_t, ftpd_var_run_t, ftpd_var_run_t)
 manage_sock_files_pattern(ftpd_t, ftpd_var_run_t, ftpd_var_run_t)
-files_pid_filetrans(ftpd_t, ftpd_var_run_t, { file dir} )
+files_pid_filetrans(ftpd_t, ftpd_var_run_t, { file dir })
 
-# proftpd requires the client side to bind a socket so that
-# it can stat the socket to perform access control decisions,
-# since getsockopt with SO_PEERCRED is not available on all
-# proftpd-supported OSs
-allow ftpd_t ftpdctl_tmp_t:sock_file { getattr unlink };
+allow ftpd_t ftpdctl_tmp_t:sock_file delete_sock_file_perms;
 
-# Create and modify /var/log/xferlog.
-manage_files_pattern(ftpd_t, xferlog_t, xferlog_t)
+allow ftpd_t xferlog_t:dir setattr_dir_perms;
+append_files_pattern(ftpd_t, xferlog_t, xferlog_t)
+create_files_pattern(ftpd_t, xferlog_t, xferlog_t)
+setattr_files_pattern(ftpd_t, xferlog_t, xferlog_t)
 logging_log_filetrans(ftpd_t, xferlog_t, file)
 
 kernel_read_kernel_sysctls(ftpd_t)
@@ -193,17 +217,15 @@
 corenet_tcp_sendrecv_all_ports(ftpd_t)
 corenet_udp_sendrecv_all_ports(ftpd_t)
 corenet_tcp_bind_generic_node(ftpd_t)
+
+corenet_sendrecv_ftp_server_packets(ftpd_t)
 corenet_tcp_bind_ftp_port(ftpd_t)
+
+corenet_sendrecv_ftp_data_server_packets(ftpd_t)
 corenet_tcp_bind_ftp_data_port(ftpd_t)
-corenet_tcp_bind_generic_port(ftpd_t)
-corenet_tcp_bind_all_unreserved_ports(ftpd_t)
-corenet_dontaudit_tcp_bind_all_ports(ftpd_t)
-corenet_tcp_connect_all_ports(ftpd_t)
-corenet_sendrecv_ftp_server_packets(ftpd_t)
 
 domain_use_interactive_fds(ftpd_t)
 
-files_search_etc(ftpd_t)
 files_read_etc_files(ftpd_t)
 files_read_etc_runtime_files(ftpd_t)
 files_search_var_lib(ftpd_t)
@@ -212,13 +234,10 @@
 fs_getattr_all_fs(ftpd_t)
 fs_search_fusefs(ftpd_t)
 
-auth_use_nsswitch(ftpd_t)
-auth_domtrans_chk_passwd(ftpd_t)
-# Append to /var/log/wtmp.
-auth_append_login_records(ftpd_t)
-#kerberized ftp requires the following
+auth_use_pam(ftpd_t)
 auth_write_login_records(ftpd_t)
 auth_rw_faillog(ftpd_t)
+auth_manage_var_auth(ftpd_t)
 
 init_rw_utmp(ftpd_t)
 
@@ -231,7 +250,6 @@
 
 seutil_dontaudit_search_config(ftpd_t)
 
-sysnet_read_config(ftpd_t)
 sysnet_use_ldap(ftpd_t)
 
 userdom_dontaudit_use_unpriv_user_fds(ftpd_t)
@@ -264,26 +282,52 @@
 	files_manage_non_auth_files(ftpd_t)
 ')
 
+tunable_policy(`ftpd_use_passive_mode',`
+	corenet_sendrecv_all_server_packets(ftpd_t)
+	corenet_tcp_bind_all_unreserved_ports(ftpd_t)
+')
+
+tunable_policy(`ftpd_connect_all_unreserved',`
+	corenet_sendrecv_all_client_packets(ftpd_t)
+	corenet_tcp_connect_all_unreserved_ports(ftpd_t)
+')
+
+tunable_policy(`ftpd_connect_db',`
+	corenet_sendrecv_gds_db_client_packets(ftpd_t)
+	corenet_tcp_connect_gds_db_port(ftpd_t)
+	corenet_tcp_sendrecv_gds_db_port(ftpd_t)
+	corenet_sendrecv_mssql_client_packets(ftpd_t)
+	corenet_tcp_connect_mssql_port(ftpd_t)
+	corenet_tcp_sendrecv_mssql_port(ftpd_t)
+	corenet_sendrecv_oracledb_client_packets(ftpd_t)
+	corenet_tcp_connect_oracledb_port(ftpd_t)
+	corenet_tcp_sendrecv_oracledb_port(ftpd_t)
+')
+
 tunable_policy(`ftp_home_dir',`
 	allow ftpd_t self:capability { dac_override dac_read_search };
 
-	# allow access to /home
-	files_list_home(ftpd_t)
-	userdom_read_user_home_content_files(ftpd_t)
 	userdom_manage_user_home_content_dirs(ftpd_t)
 	userdom_manage_user_home_content_files(ftpd_t)
-	userdom_manage_user_home_content_symlinks(ftpd_t)
-	userdom_user_home_dir_filetrans_user_home_content(ftpd_t, { dir file lnk_file })
+	userdom_user_home_dir_filetrans_user_home_content(ftpd_t, { dir file })
+	userdom_manage_user_tmp_dirs(ftpd_t)
+	userdom_manage_user_tmp_files(ftpd_t)
+	userdom_tmp_filetrans_user_tmp(ftpd_t, { dir file })
+',`
+	userdom_user_home_dir_filetrans_user_home_content(ftpd_t, { dir file })
+	userdom_tmp_filetrans_user_tmp(ftpd_t, { dir file })
 ')
 
 tunable_policy(`ftp_home_dir && use_nfs_home_dirs',`
+	fs_manage_nfs_dirs(ftpd_t)
 	fs_manage_nfs_files(ftpd_t)
-	fs_read_nfs_symlinks(ftpd_t)
+	fs_manage_nfs_symlinks(ftpd_t)
 ')
 
 tunable_policy(`ftp_home_dir && use_samba_home_dirs',`
+	fs_manage_cifs_dirs(ftpd_t)
 	fs_manage_cifs_files(ftpd_t)
-	fs_read_cifs_symlinks(ftpd_t)
+	fs_manage_cifs_symlinks(ftpd_t)
 ')
 
 optional_policy(`
@@ -309,10 +353,30 @@
 ')
 
 optional_policy(`
+	fail2ban_read_lib_files(ftpd_t)
+')
+
+optional_policy(`
 	selinux_validate_context(ftpd_t)
 
 	kerberos_keytab_template(ftpd, ftpd_t)
-	kerberos_manage_host_rcache(ftpd_t)
+	kerberos_tmp_filetrans_host_rcache(ftpd_t, file, "host_0")
+')
+
+optional_policy(`
+	mysql_stream_connect(ftpd_t)
+
+	tunable_policy(`ftpd_connect_db',`
+		mysql_tcp_connect(ftpd_t)
+	')
+')
+
+optional_policy(`
+	postgresql_stream_connect(ftpd_t)
+
+	tunable_policy(`ftpd_connect_db',`
+		postgresql_tcp_connect(ftpd_t)
+	')
 ')
 
 optional_policy(`
@@ -342,41 +406,54 @@
 
 ########################################
 #
-# ftpdctl local policy
+# Ctl local policy
 #
 
-# Allow ftpdctl to talk to ftpd over a socket connection
 stream_connect_pattern(ftpdctl_t, ftpd_var_run_t, ftpd_var_run_t, ftpd_t)
 
-# ftpdctl creates a socket so that the daemon can perform
-# access control decisions (see comments in ftpd_t rules above)
-allow ftpdctl_t ftpdctl_tmp_t:sock_file { create setattr };
+allow ftpdctl_t ftpdctl_tmp_t:sock_file manage_sock_file_perms;
 files_tmp_filetrans(ftpdctl_t, ftpdctl_tmp_t, sock_file)
 
-# Allow ftpdctl to read config files
 files_read_etc_files(ftpdctl_t)
+files_search_pids(ftpdctl_t)
 
 userdom_use_user_terminals(ftpdctl_t)
 
 ########################################
 #
-# sftpd local policy
+# Anon sftpd local policy
+#
+
+files_read_etc_files(anon_sftpd_t)
+
+miscfiles_read_public_files(anon_sftpd_t)
+
+tunable_policy(`sftpd_anon_write',`
+	miscfiles_manage_public_files(anon_sftpd_t)
+')
+
+########################################
+#
+# Sftpd local policy
 #
 
 files_read_etc_files(sftpd_t)
 
-# allow read access to /home by default
 userdom_read_user_home_content_files(sftpd_t)
 userdom_read_user_home_content_symlinks(sftpd_t)
 
 tunable_policy(`sftpd_enable_homedirs',`
 	allow sftpd_t self:capability { dac_override dac_read_search };
 
-	# allow access to /home
-	files_list_home(sftpd_t)
-	userdom_manage_user_home_content_files(sftpd_t)
 	userdom_manage_user_home_content_dirs(sftpd_t)
+	userdom_manage_user_home_content_files(sftpd_t)
 	userdom_user_home_dir_filetrans_user_home_content(sftpd_t, { dir file })
+	userdom_manage_user_tmp_dirs(sftpd_t)
+	userdom_manage_user_tmp_files(sftpd_t)
+	userdom_tmp_filetrans_user_tmp(sftpd_t, { dir file })
+',`
+	userdom_user_home_dir_filetrans_user_home_content(sftpd_t, { dir file })
+	userdom_tmp_filetrans_user_tmp(sftpd_t, { dir file })
 ')
 
 tunable_policy(`sftpd_enable_homedirs && use_nfs_home_dirs',`
@@ -391,21 +468,27 @@
 	fs_manage_cifs_symlinks(sftpd_t)
 ')
 
+tunable_policy(`sftpd_anon_write',`
+	miscfiles_manage_public_files(sftpd_t)
+')
+
 tunable_policy(`sftpd_full_access',`
 	allow sftpd_t self:capability { dac_override dac_read_search };
 	fs_read_noxattr_fs_files(sftpd_t)
 	files_manage_non_auth_files(sftpd_t)
 ')
 
+tunable_policy(`sftpd_write_ssh_home',`
+	ssh_manage_home_files(sftpd_t)
+')
+
 tunable_policy(`use_samba_home_dirs',`
-	# allow read access to /home by default
 	fs_list_cifs(sftpd_t)
 	fs_read_cifs_files(sftpd_t)
 	fs_read_cifs_symlinks(sftpd_t)
 ')
 
 tunable_policy(`use_nfs_home_dirs',`
-	# allow read access to /home by default
 	fs_list_nfs(sftpd_t)
 	fs_read_nfs_files(sftpd_t)
 	fs_read_nfs_symlinks(ftpd_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/games.fc refpolicy/policy/modules/contrib/games.fc
--- refpolicy/policy/modules/contrib/games.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/games.fc	2012-10-02 20:07:23.497012072 +0200
@@ -1,33 +1,18 @@
-#
-# /usr
-#
-/usr/lib/games(/.*)? 		gen_context(system_u:object_r:games_exec_t,s0)
-/usr/games/.*		--	gen_context(system_u:object_r:games_exec_t,s0)
-
-#
-# /var
-#
-/var/lib/games(/.*)? 		gen_context(system_u:object_r:games_data_t,s0)
-/var/games(/.*)?		gen_context(system_u:object_r:games_data_t,s0)
-
-ifndef(`distro_debian',`
-/usr/bin/micq		--	gen_context(system_u:object_r:games_exec_t,s0)
+/usr/bin/atlantik	--	gen_context(system_u:object_r:games_exec_t,s0)
 /usr/bin/blackjack	--	gen_context(system_u:object_r:games_exec_t,s0)
-/usr/bin/gataxx		--	gen_context(system_u:object_r:games_exec_t,s0)
-/usr/bin/glines		--	gen_context(system_u:object_r:games_exec_t,s0)
-/usr/bin/gnect		--	gen_context(system_u:object_r:games_exec_t,s0)
+/usr/bin/civclient.*	--	gen_context(system_u:object_r:games_exec_t,s0)
+/usr/bin/civserver.*	--	gen_context(system_u:object_r:games_exec_t,s0)
+/usr/bin/gataxx	--	gen_context(system_u:object_r:games_exec_t,s0)
+/usr/bin/glines	--	gen_context(system_u:object_r:games_exec_t,s0)
+/usr/bin/gnect	--	gen_context(system_u:object_r:games_exec_t,s0)
 /usr/bin/gnibbles	--	gen_context(system_u:object_r:games_exec_t,s0)
 /usr/bin/gnobots2	--	gen_context(system_u:object_r:games_exec_t,s0)
 /usr/bin/gnome-stones	--	gen_context(system_u:object_r:games_exec_t,s0)
 /usr/bin/gnomine	--	gen_context(system_u:object_r:games_exec_t,s0)
 /usr/bin/gnotravex	--	gen_context(system_u:object_r:games_exec_t,s0)
 /usr/bin/gnotski	--	gen_context(system_u:object_r:games_exec_t,s0)
-/usr/bin/gtali		--	gen_context(system_u:object_r:games_exec_t,s0)
-/usr/bin/iagno		--	gen_context(system_u:object_r:games_exec_t,s0)
-/usr/bin/mahjongg	--	gen_context(system_u:object_r:games_exec_t,s0)
-/usr/bin/same-gnome	--	gen_context(system_u:object_r:games_exec_t,s0)
-/usr/bin/sol		--	gen_context(system_u:object_r:games_exec_t,s0)
-/usr/bin/atlantik	--	gen_context(system_u:object_r:games_exec_t,s0)
+/usr/bin/gtali	--	gen_context(system_u:object_r:games_exec_t,s0)
+/usr/bin/iagno	--	gen_context(system_u:object_r:games_exec_t,s0)
 /usr/bin/kasteroids	--	gen_context(system_u:object_r:games_exec_t,s0)
 /usr/bin/katomic	--	gen_context(system_u:object_r:games_exec_t,s0)
 /usr/bin/kbackgammon	--	gen_context(system_u:object_r:games_exec_t,s0)
@@ -39,28 +24,37 @@
 /usr/bin/kgoldrunner	--	gen_context(system_u:object_r:games_exec_t,s0)
 /usr/bin/kjumpingcube	--	gen_context(system_u:object_r:games_exec_t,s0)
 /usr/bin/klickety	--	gen_context(system_u:object_r:games_exec_t,s0)
-/usr/bin/klines		--	gen_context(system_u:object_r:games_exec_t,s0)
+/usr/bin/klines	--	gen_context(system_u:object_r:games_exec_t,s0)
 /usr/bin/kmahjongg	--	gen_context(system_u:object_r:games_exec_t,s0)
-/usr/bin/kmines		--	gen_context(system_u:object_r:games_exec_t,s0)
-/usr/bin/kolf		--	gen_context(system_u:object_r:games_exec_t,s0)
+/usr/bin/kmines	--	gen_context(system_u:object_r:games_exec_t,s0)
+/usr/bin/kolf	--	gen_context(system_u:object_r:games_exec_t,s0)
 /usr/bin/konquest	--	gen_context(system_u:object_r:games_exec_t,s0)
-/usr/bin/kpat		--	gen_context(system_u:object_r:games_exec_t,s0)
-/usr/bin/kpoker		--	gen_context(system_u:object_r:games_exec_t,s0)
+/usr/bin/kpat	--	gen_context(system_u:object_r:games_exec_t,s0)
+/usr/bin/kpoker	--	gen_context(system_u:object_r:games_exec_t,s0)
 /usr/bin/kreversi	--	gen_context(system_u:object_r:games_exec_t,s0)
-/usr/bin/ksame		--	gen_context(system_u:object_r:games_exec_t,s0)
+/usr/bin/ksame	--	gen_context(system_u:object_r:games_exec_t,s0)
 /usr/bin/kshisen	--	gen_context(system_u:object_r:games_exec_t,s0)
 /usr/bin/ksirtet	--	gen_context(system_u:object_r:games_exec_t,s0)
 /usr/bin/ksmiletris	--	gen_context(system_u:object_r:games_exec_t,s0)
-/usr/bin/ksnake		--	gen_context(system_u:object_r:games_exec_t,s0)
+/usr/bin/ksnake	--	gen_context(system_u:object_r:games_exec_t,s0)
 /usr/bin/ksokoban	--	gen_context(system_u:object_r:games_exec_t,s0)
 /usr/bin/kspaceduel	--	gen_context(system_u:object_r:games_exec_t,s0)
-/usr/bin/ktron		--	gen_context(system_u:object_r:games_exec_t,s0)
+/usr/bin/ktron	--	gen_context(system_u:object_r:games_exec_t,s0)
 /usr/bin/ktuberling	--	gen_context(system_u:object_r:games_exec_t,s0)
-/usr/bin/kwin4		--	gen_context(system_u:object_r:games_exec_t,s0)
+/usr/bin/kwin4	--	gen_context(system_u:object_r:games_exec_t,s0)
 /usr/bin/kwin4proc	--	gen_context(system_u:object_r:games_exec_t,s0)
-/usr/bin/lskat		--	gen_context(system_u:object_r:games_exec_t,s0)
+/usr/bin/lskat	--	gen_context(system_u:object_r:games_exec_t,s0)
 /usr/bin/lskatproc	--	gen_context(system_u:object_r:games_exec_t,s0)
 /usr/bin/Maelstrom	--	gen_context(system_u:object_r:games_exec_t,s0)
-/usr/bin/civclient.*	--	gen_context(system_u:object_r:games_exec_t,s0)
-/usr/bin/civserver.*	--	gen_context(system_u:object_r:games_exec_t,s0)
-')dnl end non-Debian section
+/usr/bin/mahjongg	--	gen_context(system_u:object_r:games_exec_t,s0)
+/usr/bin/micq	--	gen_context(system_u:object_r:games_exec_t,s0)
+/usr/bin/same-gnome	--	gen_context(system_u:object_r:games_exec_t,s0)
+/usr/bin/sol	--	gen_context(system_u:object_r:games_exec_t,s0)
+
+/usr/games/.*	--	gen_context(system_u:object_r:games_exec_t,s0)
+
+/usr/lib/games(/.*)?	gen_context(system_u:object_r:games_exec_t,s0)
+
+/var/games(/.*)?	gen_context(system_u:object_r:games_data_t,s0)
+
+/var/lib/games(/.*)?	gen_context(system_u:object_r:games_data_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/games.if refpolicy/policy/modules/contrib/games.if
--- refpolicy/policy/modules/contrib/games.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/games.if	2012-10-08 20:11:37.814033606 +0200
@@ -1,39 +1,47 @@
-## <summary>Games</summary>
+## <summary>Various games.</summary>
 
-############################################################
+########################################
 ## <summary>
-##	Role access for games
+##	Role access for games.
 ## </summary>
 ## <param name="role">
 ##	<summary>
-##	Role allowed access
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <param name="domain">
 ##	<summary>
-##	User domain for the role
+##	User domain for the role.
 ##	</summary>
 ## </param>
 #
 interface(`games_role',`
 	gen_require(`
-		type games_t, games_exec_t;
+		attribute_role games_roles;
+		type games_t, games_exec_t, games_tmp_t;
+		type games_tmpfs_t;
 	')
 
-	role $1 types games_t;
+	roleattribute $1 games_roles;
 
 	domtrans_pattern($2, games_exec_t, games_t)
-	allow $2 games_t:unix_stream_socket connectto;
-	allow games_t $2:unix_stream_socket connectto;
 
-	# Allow the user domain to signal/ps.
+	allow $2 games_tmp_t:dir { manage_dir_perms relabel_dir_perms };
+	allow $2 { games_tmp_t games_tmpfs_t }:file { manage_file_perms relabel_file_perms };
+	allow $2 games_tmpfs_t:fifo_file { manage_fifo_file_perms relabel_fifo_file_perms };
+	allow $2 games_tmpfs_t:sock_file { manage_sock_file_perms relabel_sock_file_perms };
+
+	allow $2 games_t:process { ptrace signal_perms };
 	ps_process_pattern($2, games_t)
-	allow $2 games_t:process signal_perms;
+
+	stream_connect_pattern($2, games_tmpfs_t, games_tmpfs_t, games_t)
+
+	allow games_t $2:unix_stream_socket connectto;
 ')
 
 ########################################
 ## <summary>
-##	Allow the specified domain to read/write
+##	Read and write games data files.
 ##	games data.
 ## </summary>
 ## <param name="domain">
@@ -47,5 +55,6 @@
 		type games_data_t;
 	')
 
+	files_search_var_lib($1)
 	rw_files_pattern($1, games_data_t, games_data_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/games.te refpolicy/policy/modules/contrib/games.te
--- refpolicy/policy/modules/contrib/games.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/games.te	2012-10-08 20:11:38.135033618 +0200
@@ -1,15 +1,18 @@
-policy_module(games, 2.2.0)
+policy_module(games, 2.2.3)
 
 ########################################
 #
 # Declarations
 #
 
+attribute_role games_roles;
+
 type games_t;
 type games_exec_t;
 typealias games_t alias { user_games_t staff_games_t sysadm_games_t };
 typealias games_t alias { auditadm_games_t secadm_games_t };
 userdom_user_application_domain(games_t, games_exec_t)
+role games_roles types games_t;
 
 type games_data_t;
 typealias games_data_t alias { user_games_data_t staff_games_data_t sysadm_games_data_t };
@@ -23,8 +26,6 @@
 term_pty(games_devpts_t)
 ubac_constrained(games_devpts_t)
 
-# games_srv_t is for system operation of games, generic games daemons and
-# games recovery scripts
 type games_srv_t;
 init_system_domain(games_srv_t, games_exec_t)
 
@@ -91,17 +92,16 @@
 
 ########################################
 #
-# Local policy
+# Client local policy
 #
 
 allow games_t self:sem create_sem_perms;
-allow games_t self:tcp_socket create_stream_socket_perms;
-allow games_t self:udp_socket create_socket_perms;
+allow games_t self:tcp_socket { accept listen };
 
 manage_files_pattern(games_t, games_data_t, games_data_t)
 manage_lnk_files_pattern(games_t, games_data_t, games_data_t)
 
-allow games_t games_devpts_t:chr_file { rw_chr_file_perms setattr };
+allow games_t games_devpts_t:chr_file { rw_chr_file_perms setattr_chr_file_perms };
 term_create_pty(games_t, games_devpts_t)
 
 manage_dirs_pattern(games_t, games_tmp_t, games_tmp_t)
@@ -123,22 +123,21 @@
 corenet_all_recvfrom_unlabeled(games_t)
 corenet_all_recvfrom_netlabel(games_t)
 corenet_tcp_sendrecv_generic_if(games_t)
-corenet_udp_sendrecv_generic_if(games_t)
 corenet_tcp_sendrecv_generic_node(games_t)
-corenet_udp_sendrecv_generic_node(games_t)
 corenet_tcp_sendrecv_all_ports(games_t)
-corenet_udp_sendrecv_all_ports(games_t)
 corenet_tcp_bind_generic_node(games_t)
+
+corenet_sendrecv_generic_server_packets(games_t)
 corenet_tcp_bind_generic_port(games_t)
-corenet_tcp_connect_generic_port(games_t)
+
 corenet_sendrecv_generic_client_packets(games_t)
-corenet_sendrecv_generic_server_packets(games_t)
+corenet_tcp_connect_generic_port(games_t)
 
 dev_read_sound(games_t)
-dev_write_sound(games_t)
 dev_read_input(games_t)
 dev_read_mouse(games_t)
 dev_read_urand(games_t)
+dev_write_sound(games_t)
 
 files_list_var(games_t)
 files_search_var_lib(games_t)
@@ -154,13 +153,12 @@
 miscfiles_read_man_pages(games_t)
 miscfiles_read_localization(games_t)
 
-sysnet_read_config(games_t)
+sysnet_dns_name_resolve(games_t)
 
 userdom_manage_user_tmp_dirs(games_t)
 userdom_manage_user_tmp_files(games_t)
 userdom_manage_user_tmp_symlinks(games_t)
 userdom_manage_user_tmp_sockets(games_t)
-# Suppress .icons denial until properly implemented
 userdom_dontaudit_read_user_home_content_files(games_t)
 
 tunable_policy(`allow_execmem',`
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/gatekeeper.fc refpolicy/policy/modules/contrib/gatekeeper.fc
--- refpolicy/policy/modules/contrib/gatekeeper.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/gatekeeper.fc	2012-10-02 20:07:36.525012099 +0200
@@ -1,8 +1,11 @@
 /etc/gatekeeper\.ini	--	gen_context(system_u:object_r:gatekeeper_etc_t,s0)
 
-/usr/sbin/gk		--	gen_context(system_u:object_r:gatekeeper_exec_t,s0)
-/usr/sbin/gnugk		--	gen_context(system_u:object_r:gatekeeper_exec_t,s0)
+/etc/rc\.d/init\.d/gnugk	--	gen_context(system_u:object_r:gatekeeper_initrc_exec_t,s0)
+
+/usr/sbin/gk	--	gen_context(system_u:object_r:gatekeeper_exec_t,s0)
+/usr/sbin/gnugk	--	gen_context(system_u:object_r:gatekeeper_exec_t,s0)
+
+/var/log/gnugk(/.*)?	gen_context(system_u:object_r:gatekeeper_log_t,s0)
 
-/var/log/gnugk(/.*)?		gen_context(system_u:object_r:gatekeeper_log_t,s0)
 /var/run/gk\.pid	--	gen_context(system_u:object_r:gatekeeper_var_run_t,s0)
-/var/run/gnugk(/.*)?		gen_context(system_u:object_r:gatekeeper_var_run_t,s0)
+/var/run/gnugk(/.*)?	gen_context(system_u:object_r:gatekeeper_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/gatekeeper.if refpolicy/policy/modules/contrib/gatekeeper.if
--- refpolicy/policy/modules/contrib/gatekeeper.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/gatekeeper.if	2012-10-04 19:30:14.506376145 +0200
@@ -1 +1,45 @@
-## <summary>OpenH.323 Voice-Over-IP Gatekeeper</summary>
+## <summary>OpenH.323 Voice-Over-IP Gatekeeper.</summary>
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an gatekeeper environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`gatekeeper_admin',`
+	gen_require(`
+		type gatekeeper_t, gatekeeper_etc_t, gatekeeper_log_t;
+		type gatekeeper_var_run_t, gatekeeper_tmp_t, gatekeeper_initrc_exec_t;
+	')
+
+	allow $1 gatekeeper_t:process { ptrace signal_perms };
+	ps_process_pattern($1, gatekeeper_t)
+
+	init_labeled_script_domtrans($1, gatekeeper_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 gatekeeper_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	files_search_etc($1)
+	admin_pattern($1, gatekeeper_etc_t)
+
+	logging_search_logs($1)
+	admin_pattern($1, gatekeeper_log_t)
+
+	files_search_tmp($1)
+	admin_pattern($1, gatekeeper_tmp_t)
+
+	files_search_var_lib($1)
+	admin_pattern($1, gatekeeper_var_run_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/gatekeeper.te refpolicy/policy/modules/contrib/gatekeeper.te
--- refpolicy/policy/modules/contrib/gatekeeper.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/gatekeeper.te	2012-10-02 20:07:36.526012099 +0200
@@ -1,4 +1,4 @@
-policy_module(gatekeeper, 1.7.0)
+policy_module(gatekeeper, 1.7.1)
 
 ########################################
 #
@@ -9,13 +9,15 @@
 type gatekeeper_exec_t;
 init_daemon_domain(gatekeeper_t, gatekeeper_exec_t)
 
+type gatekeeper_initrc_exec_t;
+init_script_file(gatekeeper_initrc_exec_t)
+
 type gatekeeper_etc_t;
 files_config_file(gatekeeper_etc_t)
 
 type gatekeeper_log_t;
 logging_log_file(gatekeeper_log_t)
 
-# for stupid symlinks
 type gatekeeper_tmp_t;
 files_tmp_file(gatekeeper_tmp_t)
 
@@ -33,19 +35,22 @@
 allow gatekeeper_t self:tcp_socket create_stream_socket_perms;
 allow gatekeeper_t self:udp_socket create_socket_perms;
 
-allow gatekeeper_t gatekeeper_etc_t:lnk_file { getattr read };
+allow gatekeeper_t gatekeeper_etc_t:lnk_file read_lnk_file_perms;
 allow gatekeeper_t gatekeeper_etc_t:file read_file_perms;
-files_search_etc(gatekeeper_t)
 
-manage_files_pattern(gatekeeper_t, gatekeeper_log_t, gatekeeper_log_t)
+manage_dirs_pattern(gatekeeper_t, gatekeeper_log_t, gatekeeper_log_t)
+append_files_pattern(gatekeeper_t, gatekeeper_log_t, gatekeeper_log_t)
+create_files_pattern(gatekeeper_t, gatekeeper_log_t, gatekeeper_log_t)
+setattr_files_pattern(gatekeeper_t, gatekeeper_log_t, gatekeeper_log_t)
 logging_log_filetrans(gatekeeper_t, gatekeeper_log_t, { file dir })
 
 manage_dirs_pattern(gatekeeper_t, gatekeeper_tmp_t, gatekeeper_tmp_t)
 manage_files_pattern(gatekeeper_t, gatekeeper_tmp_t, gatekeeper_tmp_t)
 files_tmp_filetrans(gatekeeper_t, gatekeeper_tmp_t, { file dir })
 
+manage_dirs_pattern(gatekeeper_t, gatekeeper_var_run_t, gatekeeper_var_run_t)
 manage_files_pattern(gatekeeper_t, gatekeeper_var_run_t, gatekeeper_var_run_t)
-files_pid_filetrans(gatekeeper_t, gatekeeper_var_run_t, file)
+files_pid_filetrans(gatekeeper_t, gatekeeper_var_run_t, { dir file })
 
 kernel_read_system_state(gatekeeper_t)
 kernel_read_kernel_sysctls(gatekeeper_t)
@@ -62,12 +67,12 @@
 corenet_udp_sendrecv_all_ports(gatekeeper_t)
 corenet_tcp_bind_generic_node(gatekeeper_t)
 corenet_udp_bind_generic_node(gatekeeper_t)
+
+corenet_sendrecv_gatekeeper_server_packets(gatekeeper_t)
 corenet_tcp_bind_gatekeeper_port(gatekeeper_t)
 corenet_udp_bind_gatekeeper_port(gatekeeper_t)
-corenet_sendrecv_gatekeeper_server_packets(gatekeeper_t)
 
 dev_read_sysfs(gatekeeper_t)
-# for SSP
 dev_read_urand(gatekeeper_t)
 
 domain_use_interactive_fds(gatekeeper_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/gift.fc refpolicy/policy/modules/contrib/gift.fc
--- refpolicy/policy/modules/contrib/gift.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/gift.fc	2012-10-02 20:07:42.680012317 +0200
@@ -1,6 +1,6 @@
-HOME_DIR/\.giFT(/.*)?			gen_context(system_u:object_r:gift_home_t,s0)
+HOME_DIR/\.giFT(/.*)?	gen_context(system_u:object_r:gift_home_t,s0)
 
-/usr/(local/)?bin/apollon	-- 	gen_context(system_u:object_r:gift_exec_t,s0)
-/usr/(local/)?bin/giftd		--	gen_context(system_u:object_r:giftd_exec_t,s0)
-/usr/(local/)?bin/giftui	-- 	gen_context(system_u:object_r:gift_exec_t,s0)
-/usr/(local/)?bin/giFToxic	--	gen_context(system_u:object_r:gift_exec_t,s0)
+/usr/bin/apollon	-- 	gen_context(system_u:object_r:gift_exec_t,s0)
+/usr/bin/giftd	--	gen_context(system_u:object_r:giftd_exec_t,s0)
+/usr/bin/giftui	--	gen_context(system_u:object_r:gift_exec_t,s0)
+/usr/bin/giFToxic	--	gen_context(system_u:object_r:gift_exec_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/gift.if refpolicy/policy/modules/contrib/gift.if
--- refpolicy/policy/modules/contrib/gift.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/gift.if	2012-10-19 09:47:30.272491891 +0200
@@ -1,42 +1,40 @@
-## <summary>giFT peer to peer file sharing tool</summary>
+## <summary>Peer to peer file sharing tool.</summary>
 
-############################################################
+########################################
 ## <summary>
-##	Role access for gift
+##	Role access for gift.
 ## </summary>
 ## <param name="role">
 ##	<summary>
-##	Role allowed access
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <param name="domain">
 ##	<summary>
-##	User domain for the role
+##	User domain for the role.
 ##	</summary>
 ## </param>
 #
 interface(`gift_role',`
 	gen_require(`
-		type gift_t, gift_exec_t;
-		type giftd_t, giftd_exec_t;
-		type gift_home_t;
+		attribute_role gift_roles, giftd_roles;
+		type gift_t, gift_exec_t, gift_home_t;
+		type giftd_t, giftd_exec_t, gift_tmpfs_t;
 	')
 
-	role $1 types { gift_t giftd_t };
+	roleattribute $1 gift_roles;
+	roleattribute $1 giftd_roles;
 
-	# transition from user domain
 	domtrans_pattern($2, gift_exec_t, gift_t)
 	domtrans_pattern($2, giftd_exec_t, giftd_t)
 
-	# user managed content
-	manage_dirs_pattern($2, gift_home_t, gift_home_t)
-	manage_files_pattern($2, gift_home_t, gift_home_t)
-	manage_lnk_files_pattern($2, gift_home_t, gift_home_t)
-	relabel_dirs_pattern($2, gift_home_t, gift_home_t)
-	relabel_files_pattern($2, gift_home_t, gift_home_t)
-	relabel_lnk_files_pattern($2, gift_home_t, gift_home_t)
+	allow $2 gift_home_t:dir { manage_dir_perms relabel_dir_perms };
+	allow $2 { gift_home_t gift_tmpfs_t }:file { manage_file_perms relabel_file_perms };
+	allow $2 { gift_home_t gift_tmpfs_t }:lnk_file { manage_lnk_file_perms relabel_lnk_file_perms };
+	allow $2 gift_tmpfs_t:fifo_file { manage_fifo_file_perms relabel_fifo_file_perms };
+	allow $2 gift_tmpfs_t:sock_file { manage_sock_file_perms relabel_sock_file_perms };
+	userdom_user_home_dir_filetrans($2, gift_home_t, dir, ".giFT")
 
-	# Allow the user domain to signal/ps.
 	ps_process_pattern($2, { gift_t giftd_t })
-	allow $2 { gift_t giftd_t }:process signal_perms;
+	allow $2 { gift_t giftd_t }:process { ptrace signal_perms };
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/gift.te refpolicy/policy/modules/contrib/gift.te
--- refpolicy/policy/modules/contrib/gift.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/gift.te	2012-10-19 09:47:30.272491891 +0200
@@ -1,15 +1,19 @@
-policy_module(gift, 2.3.0)
+policy_module(gift, 2.3.4)
 
 ########################################
 #
 # Declarations
 #
 
+attribute_role gift_roles;
+attribute_role giftd_roles;
+
 type gift_t;
 type gift_exec_t;
 typealias gift_t alias { user_gift_t staff_gift_t sysadm_gift_t };
 typealias gift_t alias { auditadm_gift_t secadm_gift_t };
 userdom_user_application_domain(gift_t, gift_exec_t)
+role gift_roles types gift_t;
 
 type gift_home_t;
 typealias gift_home_t alias { user_gift_home_t staff_gift_home_t sysadm_gift_home_t };
@@ -26,14 +30,13 @@
 typealias giftd_t alias { user_giftd_t staff_giftd_t sysadm_giftd_t };
 typealias giftd_t alias { auditadm_giftd_t secadm_giftd_t };
 userdom_user_application_domain(giftd_t, giftd_exec_t)
+role giftd_roles types giftd_t;
 
 ##############################
 #
-# giFT user interface local policy
+# Client local policy
 #
 
-allow gift_t self:tcp_socket create_socket_perms;
-
 manage_files_pattern(gift_t, gift_tmpfs_t, gift_tmpfs_t)
 manage_lnk_files_pattern(gift_t, gift_tmpfs_t, gift_tmpfs_t)
 manage_fifo_files_pattern(gift_t, gift_tmpfs_t, gift_tmpfs_t)
@@ -45,26 +48,23 @@
 manage_lnk_files_pattern(gift_t, gift_home_t, gift_home_t)
 userdom_user_home_dir_filetrans(gift_t, gift_home_t, dir)
 
-# Launch gift daemon
 domtrans_pattern(gift_t, giftd_exec_t, giftd_t)
 
-# Read /proc/meminfo
 kernel_read_system_state(gift_t)
 
-# Connect to gift daemon
 corenet_all_recvfrom_unlabeled(gift_t)
 corenet_all_recvfrom_netlabel(gift_t)
 corenet_tcp_sendrecv_generic_if(gift_t)
 corenet_tcp_sendrecv_generic_node(gift_t)
-corenet_tcp_sendrecv_giftd_port(gift_t)
-corenet_tcp_connect_giftd_port(gift_t)
+
 corenet_sendrecv_giftd_client_packets(gift_t)
+corenet_tcp_connect_giftd_port(gift_t)
+corenet_tcp_sendrecv_giftd_port(gift_t)
 
 fs_search_auto_mountpoints(gift_t)
 
-sysnet_read_config(gift_t)
+auth_use_nsswitch(gift_t)
 
-# giftui looks in .icons, .themes.
 userdom_dontaudit_read_user_home_content_files(gift_t)
 
 tunable_policy(`use_nfs_home_dirs',`
@@ -80,22 +80,17 @@
 ')
 
 optional_policy(`
-	nscd_socket_use(gift_t)
-')
-
-optional_policy(`
 	xserver_user_x_domain_template(gift, gift_t, gift_tmpfs_t)
 ')
 
 ##############################
 #
-# giFT server local policy
+# Server local policy
 #
 
 allow giftd_t self:process { signal setsched };
 allow giftd_t self:unix_stream_socket create_socket_perms;
-allow giftd_t self:tcp_socket create_stream_socket_perms;
-allow giftd_t self:udp_socket create_socket_perms;
+allow giftd_t self:tcp_socket { accept listen };
 
 manage_dirs_pattern(giftd_t, gift_home_t, gift_home_t)
 manage_files_pattern(giftd_t, gift_home_t, gift_home_t)
@@ -105,7 +100,6 @@
 kernel_read_system_state(giftd_t)
 kernel_read_kernel_sysctls(giftd_t)
 
-# Serve content on various p2p networks. Ports can be random.
 corenet_all_recvfrom_unlabeled(giftd_t)
 corenet_all_recvfrom_netlabel(giftd_t)
 corenet_tcp_sendrecv_generic_if(giftd_t)
@@ -116,18 +110,20 @@
 corenet_udp_sendrecv_all_ports(giftd_t)
 corenet_tcp_bind_generic_node(giftd_t)
 corenet_udp_bind_generic_node(giftd_t)
+
+corenet_sendrecv_all_server_packets(giftd_t)
 corenet_tcp_bind_all_ports(giftd_t)
 corenet_udp_bind_all_ports(giftd_t)
-corenet_tcp_connect_all_ports(giftd_t)
+
 corenet_sendrecv_all_client_packets(giftd_t)
+corenet_tcp_connect_all_ports(giftd_t)
 
-files_read_usr_files(giftd_t)
-# Read /etc/mtab
 files_read_etc_runtime_files(giftd_t)
+files_read_usr_files(giftd_t)
 
 miscfiles_read_localization(giftd_t)
 
-sysnet_read_config(giftd_t)
+sysnet_dns_name_resolve(giftd_t)
 
 userdom_use_user_terminals(giftd_t)
 
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/git.fc refpolicy/policy/modules/contrib/git.fc
--- refpolicy/policy/modules/contrib/git.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/git.fc	2012-10-02 20:07:50.717012129 +0200
@@ -1,11 +1,13 @@
-HOME_DIR/public_git(/.*)?			gen_context(system_u:object_r:git_user_content_t,s0)
+HOME_DIR/public_git(/.*)?	gen_context(system_u:object_r:git_user_content_t,s0)
 
 /usr/libexec/git-core/git-daemon	--	gen_context(system_u:object_r:gitd_exec_t,s0)
 
-/var/cache/cgit(/.*)?				gen_context(system_u:object_r:httpd_git_rw_content_t,s0)
+/var/cache/cgit(/.*)?	gen_context(system_u:object_r:httpd_git_rw_content_t,s0)
+/var/cache/gitweb-caching(/.*)?	gen_context(system_u:object_r:httpd_git_rw_content_t,s0)
 
-/var/lib/git(/.*)?				gen_context(system_u:object_r:git_sys_content_t,s0)
+/var/lib/git(/.*)?	gen_context(system_u:object_r:git_sys_content_t,s0)
 
-/var/www/cgi-bin/cgit			--	gen_context(system_u:object_r:httpd_git_script_exec_t,s0)
-/var/www/git(/.*)?				gen_context(system_u:object_r:httpd_git_content_t,s0)
-/var/www/git/gitweb\.cgi		--	gen_context(system_u:object_r:httpd_git_script_exec_t,s0)
+/var/www/cgi-bin/cgit	--	gen_context(system_u:object_r:httpd_git_script_exec_t,s0)
+/var/www/git(/.*)?	gen_context(system_u:object_r:httpd_git_content_t,s0)
+/var/www/git/gitweb\.cgi	--	gen_context(system_u:object_r:httpd_git_script_exec_t,s0)
+/var/www/gitweb-caching/gitweb\.cgi	--	gen_context(system_u:object_r:httpd_git_script_exec_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/git.if refpolicy/policy/modules/contrib/git.if
--- refpolicy/policy/modules/contrib/git.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/git.if	2012-10-08 10:24:30.287043920 +0200
@@ -17,6 +17,7 @@
 #
 template(`git_role',`
 	gen_require(`
+		attribute_role git_session_roles;
 		type git_session_t, gitd_exec_t, git_user_content_t;
 	')
 
@@ -25,19 +26,16 @@
 	# Declarations
 	#
 
-	role $1 types git_session_t;
+	roleattribute $1 git_session_roles;
 
 	########################################
 	#
 	# Policy
 	#
 
-	manage_dirs_pattern($2, git_user_content_t, git_user_content_t)
-	relabel_dirs_pattern($2, git_user_content_t, git_user_content_t)
-
-	exec_files_pattern($2, git_user_content_t, git_user_content_t)
-	manage_files_pattern($2, git_user_content_t, git_user_content_t)
-	relabel_files_pattern($2, git_user_content_t, git_user_content_t)
+	allow $2 git_user_content_t:dir { manage_dir_perms relabel_dir_perms };
+	allow $2 git_user_content_t:file { exec_file_perms manage_file_perms relabel_file_perms };
+	userdom_user_home_dir_filetrans($2, git_user_content_t, dir, "public_git")
 
 	allow $2 git_session_t:process { ptrace signal_perms };
 	ps_process_pattern($2, git_session_t)
@@ -48,3 +46,36 @@
 		can_exec($2, gitd_exec_t)
 	')
 ')
+
+########################################
+## <summary>
+##	Read generic system content files.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`git_read_generic_sys_content_files',`
+	gen_require(`
+		type git_sys_content_t;
+	')
+
+	list_dirs_pattern($1, git_sys_content_t, git_sys_content_t)
+	read_files_pattern($1, git_sys_content_t, git_sys_content_t)
+
+	files_search_var_lib($1)
+
+	tunable_policy(`git_system_use_cifs',`
+		fs_getattr_cifs($1)
+		fs_list_cifs($1)
+		fs_read_cifs_files($1)
+	')
+
+	tunable_policy(`git_system_use_nfs',`
+		fs_getattr_nfs($1)
+		fs_list_nfs($1)
+		fs_read_nfs_files($1)
+	')
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/git.te refpolicy/policy/modules/contrib/git.te
--- refpolicy/policy/modules/contrib/git.te	2012-07-25 20:33:04.000000000 +0200
+++ refpolicy/policy/modules/contrib/git.te	2012-10-08 10:24:30.303043917 +0200
@@ -1,4 +1,4 @@
-policy_module(git, 1.2.0)
+policy_module(git, 1.2.3)
 
 ########################################
 #
@@ -31,6 +31,15 @@
 
 ## <desc>
 ##	<p>
+##	Determine whether Git session daemon
+##	can bind TCP sockets to all
+##	unreserved ports.
+##	</p>
+## </desc>
+gen_tunable(git_session_bind_all_unreserved_ports, false)
+
+## <desc>
+##	<p>
 ##	Determine whether calling user domains
 ##	can execute Git daemon in the
 ##	git_session_t domain.
@@ -71,6 +80,7 @@
 gen_tunable(git_system_use_nfs, false)
 
 attribute git_daemon;
+attribute_role git_session_roles;
 
 apache_content_template(git)
 
@@ -80,6 +90,7 @@
 
 type git_session_t, git_daemon;
 userdom_user_application_domain(git_session_t, gitd_exec_t)
+role git_session_roles types git_session_t;
 
 type git_sys_content_t;
 files_type(git_sys_content_t)
@@ -89,7 +100,7 @@
 
 ########################################
 #
-# Git session policy
+# Session policy
 #
 
 allow git_session_t self:tcp_socket { accept listen };
@@ -103,26 +114,36 @@
 corenet_tcp_bind_generic_node(git_session_t)
 corenet_tcp_sendrecv_generic_if(git_session_t)
 corenet_tcp_sendrecv_generic_node(git_session_t)
-corenet_tcp_sendrecv_generic_port(git_session_t)
+
+corenet_sendrecv_git_server_packets(git_session_t)
 corenet_tcp_bind_git_port(git_session_t)
 corenet_tcp_sendrecv_git_port(git_session_t)
-corenet_sendrecv_git_server_packets(git_session_t)
 
 auth_use_nsswitch(git_session_t)
 
 userdom_use_user_terminals(git_session_t)
 
+tunable_policy(`git_session_bind_all_unreserved_ports',`
+	corenet_sendrecv_all_server_packets(git_session_t)
+	corenet_tcp_bind_all_unreserved_ports(git_session_t)
+	corenet_tcp_sendrecv_all_ports(git_session_t)
+')
+
 tunable_policy(`git_session_send_syslog_msg',`
 	logging_send_syslog_msg(git_session_t)
 ')
 
 tunable_policy(`use_nfs_home_dirs',`
+	fs_getattr_nfs(git_session_t)
+	fs_list_nfs(git_session_t)
 	fs_read_nfs_files(git_session_t)
 ',`
 	fs_dontaudit_read_nfs_files(git_session_t)
 ')
 
 tunable_policy(`use_samba_home_dirs',`
+	fs_getattr_cifs(git_session_t)
+	fs_list_cifs(git_session_t)
 	fs_read_cifs_files(git_session_t)
 ',`
 	fs_dontaudit_read_cifs_files(git_session_t)
@@ -130,11 +151,12 @@
 
 ########################################
 #
-# Git system policy
+# System policy
 #
 
 list_dirs_pattern(git_system_t, git_sys_content_t, git_sys_content_t)
 read_files_pattern(git_system_t, git_sys_content_t, git_sys_content_t)
+
 files_search_var_lib(git_system_t)
 
 auth_use_nsswitch(git_system_t)
@@ -146,24 +168,32 @@
 ')
 
 tunable_policy(`git_system_enable_homedirs && use_nfs_home_dirs',`
+	fs_getattr_nfs(git_system_t)
+	fs_list_nfs(git_system_t)
 	fs_read_nfs_files(git_system_t)
 ',`
 	fs_dontaudit_read_nfs_files(git_system_t)
 ')
 
 tunable_policy(`git_system_enable_homedirs && use_samba_home_dirs',`
+	fs_getattr_cifs(git_system_t)
+	fs_list_cifs(git_system_t)
 	fs_read_cifs_files(git_system_t)
 ',`
 	fs_dontaudit_read_cifs_files(git_system_t)
 ')
 
 tunable_policy(`git_system_use_cifs',`
+	fs_getattr_cifs(git_system_t)
+	fs_list_cifs(git_system_t)
 	fs_read_cifs_files(git_system_t)
 ',`
 	fs_dontaudit_read_cifs_files(git_system_t)
 ')
 
 tunable_policy(`git_system_use_nfs',`
+	fs_getattr_nfs(git_system_t)
+	fs_list_nfs(git_system_t)
 	fs_read_nfs_files(git_system_t)
 ',`
 	fs_dontaudit_read_nfs_files(git_system_t)
@@ -171,7 +201,7 @@
 
 ########################################
 #
-# Git CGI policy
+# CGI policy
 #
 
 list_dirs_pattern(httpd_git_script_t, { git_sys_content_t git_user_content_t }, { git_sys_content_t git_user_content_t })
@@ -187,24 +217,32 @@
 ')
 
 tunable_policy(`git_cgi_enable_homedirs && use_nfs_home_dirs',`
+	fs_getattr_nfs(httpd_git_script_t)
+	fs_list_nfs(httpd_git_script_t)
 	fs_read_nfs_files(httpd_git_script_t)
 ',`
 	fs_dontaudit_read_nfs_files(httpd_git_script_t)
 ')
 
 tunable_policy(`git_cgi_enable_homedirs && use_samba_home_dirs',`
+	fs_getattr_cifs(httpd_git_script_t)
+	fs_list_cifs(httpd_git_script_t)
 	fs_read_cifs_files(httpd_git_script_t)
 ',`
 	fs_dontaudit_read_cifs_files(httpd_git_script_t)
 ')
 
 tunable_policy(`git_cgi_use_cifs',`
+	fs_getattr_cifs(httpd_git_script_t)
+	fs_list_cifs(httpd_git_script_t)
 	fs_read_cifs_files(httpd_git_script_t)
 ',`
 	fs_dontaudit_read_cifs_files(httpd_git_script_t)
 ')
 
 tunable_policy(`git_cgi_use_nfs',`
+	fs_getattr_nfs(httpd_git_script_t)
+	fs_list_nfs(httpd_git_script_t)
 	fs_read_nfs_files(httpd_git_script_t)
 ',`
 	fs_dontaudit_read_nfs_files(httpd_git_script_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/gitosis.fc refpolicy/policy/modules/contrib/gitosis.fc
--- refpolicy/policy/modules/contrib/gitosis.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/gitosis.fc	2012-10-06 20:48:51.821755046 +0200
@@ -1,9 +1,7 @@
-ifdef(`distro_debian',`
-/srv/lib/gitosis(/.*)?				gen_context(system_u:object_r:gitosis_var_lib_t,s0)
-')
+/srv/lib/gitosis(/.*)?	gen_context(system_u:object_r:gitosis_var_lib_t,s0)
 
-/usr/bin/gitosis-serve			--	gen_context(system_u:object_r:gitosis_exec_t,s0)
-/usr/bin/gl-auth-command		--	gen_context(system_u:object_r:gitosis_exec_t,s0)
+/usr/bin/gitosis-serve	--	gen_context(system_u:object_r:gitosis_exec_t,s0)
+/usr/bin/gl-auth-command	--	gen_context(system_u:object_r:gitosis_exec_t,s0)
 
-/var/lib/gitosis(/.*)?				gen_context(system_u:object_r:gitosis_var_lib_t,s0)
-/var/lib/gitolite(/.*)?				gen_context(system_u:object_r:gitosis_var_lib_t,s0)
+/var/lib/gitosis(/.*)?	gen_context(system_u:object_r:gitosis_var_lib_t,s0)
+/var/lib/gitolite(3)?(/.*)?	gen_context(system_u:object_r:gitosis_var_lib_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/gitosis.if refpolicy/policy/modules/contrib/gitosis.if
--- refpolicy/policy/modules/contrib/gitosis.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/gitosis.if	2012-10-02 20:07:56.386012139 +0200
@@ -15,17 +15,19 @@
 		type gitosis_t, gitosis_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, gitosis_exec_t, gitosis_t)
 ')
 
 #######################################
 ## <summary>
-##	Execute gitosis-serve in the gitosis domain, and
-##	allow the specified role the gitosis domain.
+##	Execute gitosis-serve in the
+##	gitosis domain, and allow the
+##	specified role the gitosis domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
-##	Domain allowed access
+##	Domain allowed to transition.
 ##	</summary>
 ## </param>
 ## <param name="role">
@@ -36,17 +38,16 @@
 #
 interface(`gitosis_run',`
 	gen_require(`
-		type gitosis_t;
+		attribute_role gitosis_roles;
 	')
 
 	gitosis_domtrans($1)
-	role $2 types gitosis_t;
+	roleattribute $2 gitosis_roles;
 ')
 
 #######################################
 ## <summary>
-##	Allow the specified domain to read
-##	gitosis lib files.
+##	Read gitosis lib files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -67,7 +68,7 @@
 
 ######################################
 ## <summary>
-##	Allow the specified domain to manage
+##	Create, read, write, and delete
 ##	gitosis lib files.
 ## </summary>
 ## <param name="domain">
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/gitosis.te refpolicy/policy/modules/contrib/gitosis.te
--- refpolicy/policy/modules/contrib/gitosis.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/gitosis.te	2012-10-02 20:07:56.387012141 +0200
@@ -1,21 +1,31 @@
-policy_module(gitosis, 1.3.0)
+policy_module(gitosis, 1.3.2)
 
 ########################################
 #
 # Declarations
 #
 
+## <desc>
+##	<p>
+##	Determine whether Gitosis can send mail.
+##	</p>
+## </desc>
+gen_tunable(gitosis_can_sendmail, false)
+
+attribute_role gitosis_roles;
+roleattribute system_r gitosis_roles;
+
 type gitosis_t;
 type gitosis_exec_t;
 application_domain(gitosis_t, gitosis_exec_t)
-role system_r types gitosis_t;
+role gitosis_roles types gitosis_t;
 
 type gitosis_var_lib_t;
 files_type(gitosis_var_lib_t)
 
 ########################################
 #
-# gitosis local policy
+# Local policy
 #
 
 allow gitosis_t self:fifo_file rw_fifo_file_perms;
@@ -27,6 +37,16 @@
 
 kernel_read_system_state(gitosis_t)
 
+corenet_all_recvfrom_unlabeled(gitosis_t)
+corenet_all_recvfrom_netlabel(gitosis_t)
+corenet_tcp_sendrecv_generic_if(gitosis_t)
+corenet_tcp_sendrecv_generic_node(gitosis_t)
+corenet_tcp_bind_generic_node(gitosis_t)
+
+corenet_sendrecv_ssh_server_packets(gitosis_t)
+corenet_tcp_bind_ssh_port(gitosis_t)
+corenet_tcp_sendrecv_ssh_port(gitosis_t)
+
 corecmd_exec_bin(gitosis_t)
 corecmd_exec_shell(gitosis_t)
 
@@ -39,3 +59,7 @@
 miscfiles_read_localization(gitosis_t)
 
 sysnet_read_config(gitosis_t)
+
+tunable_policy(`gitosis_can_sendmail',`
+	mta_send_mail(gitosis_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/glance.fc refpolicy/policy/modules/contrib/glance.fc
--- refpolicy/policy/modules/contrib/glance.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/glance.fc	2012-10-02 20:08:07.190012165 +0200
@@ -1,12 +1,11 @@
-/etc/rc\.d/init\.d/openstack-glance-api --	gen_context(system_u:object_r:glance_api_initrc_exec_t,s0)
+/etc/rc\.d/init\.d/openstack-glance-api	--	gen_context(system_u:object_r:glance_api_initrc_exec_t,s0)
+/etc/rc\.d/init\.d/openstack-glance-registry	--	gen_context(system_u:object_r:glance_registry_initrc_exec_t,s0)
 
-/etc/rc\.d/init\.d/openstack-glance-registry --	gen_context(system_u:object_r:glance_registry_initrc_exec_t,s0)
+/usr/bin/glance-api	--	gen_context(system_u:object_r:glance_api_exec_t,s0)
+/usr/bin/glance-registry	--	gen_context(system_u:object_r:glance_registry_exec_t,s0)
 
-/usr/bin/glance-api			--	gen_context(system_u:object_r:glance_api_exec_t,s0)
-/usr/bin/glance-registry		--	gen_context(system_u:object_r:glance_registry_exec_t,s0)
+/var/lib/glance(/.*)?	gen_context(system_u:object_r:glance_var_lib_t,s0)
 
-/var/lib/glance(/.*)?				gen_context(system_u:object_r:glance_var_lib_t,s0)
+/var/log/glance(/.*)?	gen_context(system_u:object_r:glance_log_t,s0)
 
-/var/log/glance(/.*)?				gen_context(system_u:object_r:glance_log_t,s0)
-
-/var/run/glance(/.*)?				gen_context(system_u:object_r:glance_var_run_t,s0)
+/var/run/glance(/.*)?	gen_context(system_u:object_r:glance_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/glance.if refpolicy/policy/modules/contrib/glance.if
--- refpolicy/policy/modules/contrib/glance.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/glance.if	2012-10-02 20:08:07.196012165 +0200
@@ -1,8 +1,9 @@
-## <summary>policy for glance</summary>
+## <summary>OpenStack image registry and delivery service.</summary>
 
 ########################################
 ## <summary>
-##	Transition to glance registry.
+##	Execute a domain transition to
+##	run glance registry.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -21,7 +22,8 @@
 
 ########################################
 ## <summary>
-##	Transition to glance api.
+##	Execute a domain transition to
+##	run glance api.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -40,7 +42,7 @@
 
 ########################################
 ## <summary>
-##	Read glance's log files.
+##	Read glance log files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -60,7 +62,7 @@
 
 ########################################
 ## <summary>
-##	Append to glance log files.
+##	Append glance log files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -79,7 +81,8 @@
 
 ########################################
 ## <summary>
-##	Manage glance log files
+##	Create, read, write, and delete
+##	glance log files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -138,7 +141,8 @@
 
 ########################################
 ## <summary>
-##	Manage glance lib files.
+##	Create, read, write, and delete
+##	glance lib files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -157,7 +161,8 @@
 
 ########################################
 ## <summary>
-##	Manage glance lib directories.
+##	Create, read, write, and delete
+##	glance lib directories.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -176,7 +181,7 @@
 
 ########################################
 ## <summary>
-##	Read glance PID files.
+##	Read glance pid files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -195,7 +200,8 @@
 
 ########################################
 ## <summary>
-##	Manage glance PID files.
+##	Create, read, write, and delete
+##	glance pid files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -214,8 +220,8 @@
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate
-##	an glance environment
+##	All of the rules required to
+##	administrate an glance environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -236,20 +242,14 @@
 		type glance_registry_initrc_exec_t, glance_api_initrc_exec_t;
 	')
 
-	allow $1 glance_registry_t:process signal_perms;
-	ps_process_pattern($1, glance_registry_t)
+	allow $1 { glance_api_t glance_registry_t }:process signal_perms;
+	ps_process_pattern($1, { glance_api_t glance_registry_t })
 
-	allow $1 glance_api_t:process signal_perms;
-	ps_process_pattern($1, glance_api_t)
-
-	init_labeled_script_domtrans($1, glance_registry_initrc_exec_t)
+	init_labeled_script_domtrans($1, { glance_api_initrc_exec_t glance_registry_initrc_exec_t })
 	domain_system_change_exemption($1)
-	role_transition $2 glance_registry_initrc_exec_t system_r;
+	role_transition $2 { glance_api_initrc_exec_t glance_registry_initrc_exec_t } system_r;
 	allow $2 system_r;
 
-	init_labeled_script_domtrans($1, glance_api_initrc_exec_t)
-	role_transition $2 glance_api_initrc_exec_t system_r;
-
 	logging_search_logs($1)
 	admin_pattern($1, glance_log_t)
 
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/glance.te refpolicy/policy/modules/contrib/glance.te
--- refpolicy/policy/modules/contrib/glance.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/glance.te	2012-10-06 19:03:41.213741576 +0200
@@ -1,4 +1,4 @@
-policy_module(glance, 1.0.0)
+policy_module(glance, 1.0.2)
 
 ########################################
 #
@@ -38,15 +38,17 @@
 
 #######################################
 #
-# glance general domain local policy
+# Common local policy
 #
 
 allow glance_domain self:fifo_file rw_fifo_file_perms;
 allow glance_domain self:unix_stream_socket create_stream_socket_perms;
-allow glance_domain self:tcp_socket create_stream_socket_perms;
+allow glance_domain self:tcp_socket { accept listen };
 
 manage_dirs_pattern(glance_domain, glance_log_t, glance_log_t)
-manage_files_pattern(glance_domain, glance_log_t, glance_log_t)
+append_files_pattern(glance_domain, glance_log_t, glance_log_t)
+create_files_pattern(glance_domain, glance_log_t, glance_log_t)
+setattr_files_pattern(glance_domain, glance_log_t, glance_log_t)
 
 manage_dirs_pattern(glance_domain, glance_var_lib_t, glance_var_lib_t)
 manage_files_pattern(glance_domain, glance_var_lib_t, glance_var_lib_t)
@@ -56,34 +58,49 @@
 
 kernel_read_system_state(glance_domain)
 
+corenet_all_recvfrom_unlabeled(glance_domain)
+corenet_all_recvfrom_netlabel(glance_domain)
+corenet_tcp_sendrecv_generic_if(glance_domain)
+corenet_tcp_sendrecv_generic_node(glance_domain)
+corenet_tcp_sendrecv_all_ports(glance_domain)
+corenet_tcp_bind_generic_node(glance_domain)
+
 corecmd_exec_bin(glance_domain)
+corecmd_exec_shell(glance_domain)
 
 dev_read_urand(glance_domain)
 
 files_read_etc_files(glance_domain)
 files_read_usr_files(glance_domain)
 
+libs_exec_ldconfig(glance_domain)
+
 miscfiles_read_localization(glance_domain)
 
-optional_policy(`
-	sysnet_dns_name_resolve(glance_domain)
-')
+sysnet_dns_name_resolve(glance_domain)
 
 ########################################
 #
-# glance-registry local policy
+# Registry local policy
 #
 
 manage_dirs_pattern(glance_registry_t, glance_registry_tmp_t, glance_registry_tmp_t)
 manage_files_pattern(glance_registry_t, glance_registry_tmp_t, glance_registry_tmp_t)
-files_tmp_filetrans(glance_registry_t, glance_registry_tmp_t, { file dir })
+files_tmp_filetrans(glance_registry_t, glance_registry_tmp_t, { dir file })
 
-corenet_tcp_bind_generic_node(glance_registry_t)
+corenet_sendrecv_glance_registry_server_packets(glance_registry_t)
 corenet_tcp_bind_glance_registry_port(glance_registry_t)
 
+logging_send_syslog_msg(glance_registry_t)
+
+optional_policy(`
+	mysql_stream_connect(glance_registry_t)
+	mysql_tcp_connect(glance_registry_t)
+')
+
 ########################################
 #
-# glance-api local policy
+# Api local policy
 #
 
 manage_dirs_pattern(glance_api_t, glance_tmp_t, glance_tmp_t)
@@ -91,14 +108,13 @@
 files_tmp_filetrans(glance_api_t, glance_tmp_t, { dir file })
 can_exec(glance_api_t, glance_tmp_t)
 
-corecmd_exec_shell(glance_api_t)
+corenet_sendrecv_armtechdaemon_server_packets(glance_api_t)
+corenet_tcp_bind_armtechdaemon_port(glance_api_t)
 
-corenet_tcp_bind_generic_node(glance_api_t)
+corenet_sendrecv_hplip_server_packets(glance_api_t)
 corenet_tcp_bind_hplip_port(glance_api_t)
-corenet_tcp_connect_glance_registry_port(glance_api_t)
 
-dev_read_urand(glance_api_t)
+corenet_sendrecv_glance_registry_client_packets(glance_api_t)
+corenet_tcp_connect_glance_registry_port(glance_api_t)
 
 fs_getattr_xattr_fs(glance_api_t)
-
-libs_exec_ldconfig(glance_api_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/glusterfs.fc refpolicy/policy/modules/contrib/glusterfs.fc
--- refpolicy/policy/modules/contrib/glusterfs.fc	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/glusterfs.fc	2012-10-02 20:09:11.104012301 +0200
@@ -0,0 +1,16 @@
+/etc/rc\.d/init\.d/gluster.*	--	gen_context(system_u:object_r:glusterd_initrc_exec_t,s0)
+
+/etc/glusterfs(/.*)?	gen_context(system_u:object_r:glusterd_conf_t,s0)
+/etc/glusterd(/.*)?	gen_context(system_u:object_r:glusterd_conf_t,s0)
+
+/usr/sbin/glusterd	--	gen_context(system_u:object_r:glusterd_initrc_exec_t,s0)
+/usr/sbin/glusterfsd	--	gen_context(system_u:object_r:glusterd_exec_t,s0)
+
+/opt/glusterfs/[^/]+/sbin/glusterfsd	--	gen_context(system_u:object_r:glusterd_exec_t,s0)
+
+/var/lib/gluster.*	gen_context(system_u:object_r:glusterd_var_lib_t,s0)
+
+/var/log/glusterfs(/.*)?	gen_context(system_u:object_r:glusterd_log_t,s0)
+
+/var/run/glusterd(/.*)?	gen_context(system_u:object_r:glusterd_var_run_t,s0)
+/var/run/glusterd\.pid	--	gen_context(system_u:object_r:glusterd_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/glusterfs.if refpolicy/policy/modules/contrib/glusterfs.if
--- refpolicy/policy/modules/contrib/glusterfs.if	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/glusterfs.if	2012-10-04 19:30:25.346376168 +0200
@@ -0,0 +1,71 @@
+## <summary>Cluster File System binary, daemon and command line.</summary>
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an glusterfs environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`glusterd_admin',`
+	refpolicywarn(`$0($*) has been deprecated, use glusterfs_admin() instead.')
+	glusterfs_admin($1, $2)
+')
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an glusterfs environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`glusterfs_admin',`
+	gen_require(`
+		type glusterd_t, glusterd_initrc_exec_t, glusterd_log_t;
+		type glusterd_tmp_t, glusterd_conf_t, glusterd_var_lib_t;
+		type glusterd_var_run_t;
+	')
+
+	init_labeled_script_domtrans($1, glusterd_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 glusterd_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	allow $1 glusterd_t:process { ptrace signal_perms };
+	ps_process_pattern($1, glusterd_t)
+
+	files_search_etc($1)
+	admin_pattern($1, glusterd_conf_t)
+
+	logging_search_logs($1)
+	admin_pattern($1, glusterd_log_t)
+
+	files_search_tmp($1)
+	admin_pattern($1, glusterd_tmp_t)
+
+	files_search_var_lib($1)
+	admin_pattern($1, glusterd_var_lib_t)
+
+	files_search_pids($1)
+	admin_pattern($1, glusterd_var_run_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/glusterfs.te refpolicy/policy/modules/contrib/glusterfs.te
--- refpolicy/policy/modules/contrib/glusterfs.te	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/glusterfs.te	2012-10-02 20:09:11.105012301 +0200
@@ -0,0 +1,102 @@
+policy_module(glusterfs, 1.0.0)
+
+########################################
+#
+# Declarations
+#
+
+type glusterd_t;
+type glusterd_exec_t;
+init_daemon_domain(glusterd_t, glusterd_exec_t)
+
+type glusterd_conf_t;
+files_type(glusterd_conf_t)
+
+type glusterd_initrc_exec_t;
+init_script_file(glusterd_initrc_exec_t)
+
+type glusterd_tmp_t;
+files_tmp_file(glusterd_tmp_t)
+
+type glusterd_log_t;
+logging_log_file(glusterd_log_t)
+
+type glusterd_var_run_t;
+files_pid_file(glusterd_var_run_t)
+
+type glusterd_var_lib_t;
+files_type(glusterd_var_lib_t);
+
+########################################
+#
+# Local policy
+#
+
+allow glusterd_t self:capability { net_bind_service sys_admin sys_resource dac_override chown dac_read_search fowner };
+allow glusterd_t self:process { setrlimit signal };
+allow glusterd_t self:fifo_file rw_fifo_file_perms;
+allow glusterd_t self:tcp_socket { accept listen };
+allow glusterd_t self:unix_stream_socket { accept listen };
+
+manage_dirs_pattern(glusterd_t, glusterd_conf_t, glusterd_conf_t)
+manage_files_pattern(glusterd_t, glusterd_conf_t, glusterd_conf_t)
+files_etc_filetrans(glusterd_t, glusterd_conf_t, dir)
+
+manage_dirs_pattern(glusterd_t, glusterd_tmp_t, glusterd_tmp_t)
+manage_files_pattern(glusterd_t, glusterd_tmp_t, glusterd_tmp_t)
+manage_sock_files_pattern(glusterd_t, glusterd_tmp_t, glusterd_tmp_t)
+files_tmp_filetrans(glusterd_t, glusterd_tmp_t, { dir file sock_file })
+
+manage_dirs_pattern(glusterd_t, glusterd_log_t, glusterd_log_t)
+append_files_pattern(glusterd_t, glusterd_log_t, glusterd_log_t)
+create_files_pattern(glusterd_t, glusterd_log_t, glusterd_log_t)
+setattr_files_pattern(glusterd_t, glusterd_log_t, glusterd_log_t)
+logging_log_filetrans(glusterd_t, glusterd_log_t, dir)
+
+manage_dirs_pattern(glusterd_t, glusterd_var_run_t, glusterd_var_run_t)
+manage_files_pattern(glusterd_t, glusterd_var_run_t, glusterd_var_run_t)
+files_pid_filetrans(glusterd_t, glusterd_var_run_t, { dir file })
+
+manage_dirs_pattern(glusterd_t, glusterd_var_lib_t, glusterd_var_lib_t)
+manage_files_pattern(glusterd_t, glusterd_var_lib_t, glusterd_var_lib_t)
+files_var_lib_filetrans(glusterd_t, glusterd_var_lib_t, dir)
+
+can_exec(glusterd_t, glusterd_exec_t)
+
+kernel_read_system_state(glusterd_t)
+
+corecmd_exec_bin(glusterd_t)
+corecmd_exec_shell(glusterd_t)
+
+corenet_all_recvfrom_unlabeled(glusterd_t)
+corenet_all_recvfrom_netlabel(glusterd_t)
+corenet_tcp_sendrecv_generic_if(glusterd_t)
+corenet_udp_sendrecv_generic_if(glusterd_t)
+corenet_tcp_sendrecv_generic_node(glusterd_t)
+corenet_udp_sendrecv_generic_node(glusterd_t)
+corenet_tcp_sendrecv_all_ports(glusterd_t)
+corenet_udp_sendrecv_all_ports(glusterd_t)
+corenet_tcp_bind_generic_node(glusterd_t)
+corenet_udp_bind_generic_node(glusterd_t)
+
+# Too coarse?
+corenet_sendrecv_all_server_packets(glusterd_t)
+corenet_tcp_bind_all_reserved_ports(glusterd_t)
+corenet_udp_bind_all_rpc_ports(glusterd_t)
+corenet_udp_bind_ipp_port(glusterd_t)
+
+corenet_sendrecv_all_client_packets(glusterd_t)
+corenet_tcp_connect_all_unreserved_ports(glusterd_t)
+
+dev_read_sysfs(glusterd_t)
+dev_read_urand(glusterd_t)
+
+domain_use_interactive_fds(glusterd_t)
+
+files_read_usr_files(glusterd_t)
+
+auth_use_nsswitch(glusterd_t)
+
+logging_send_syslog_msg(glusterd_t)
+
+miscfiles_read_localization(glusterd_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/gnome.fc refpolicy/policy/modules/contrib/gnome.fc
--- refpolicy/policy/modules/contrib/gnome.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/gnome.fc	2012-10-08 19:56:28.484031646 +0200
@@ -1,9 +1,15 @@
-HOME_DIR/\.config/gtk-.*	gen_context(system_u:object_r:gnome_home_t,s0)
-HOME_DIR/\.gconf(d)?(/.*)?	gen_context(system_u:object_r:gconf_home_t,s0)
-HOME_DIR/\.gnome2(/.*)?		gen_context(system_u:object_r:gnome_home_t,s0)
+HOME_DIR/\.config/gtk-.*	gen_context(system_u:object_r:gnome_xdg_config_t,s0)
 
-/etc/gconf(/.*)?		gen_context(system_u:object_r:gconf_etc_t,s0)
+HOME_DIR/\.gconf(/.*)?	gen_context(system_u:object_r:gconf_home_t,s0)
+HOME_DIR/\.gconfd(/.*)?	gen_context(system_u:object_r:gconf_home_t,s0)
+HOME_DIR/\.gnome(/.*)?	gen_context(system_u:object_r:gnome_home_t,s0)
+HOME_DIR/\.gnome2(/.*)?	gen_context(system_u:object_r:gnome_home_t,s0)
+HOME_DIR/\.gnome2/keyrings(/.*)?	gen_context(system_u:object_r:gnome_keyring_home_t,s0)
+HOME_DIR/\.gnome2_private(/.*)?	gen_context(system_u:object_r:gnome_home_t,s0)
+
+/etc/gconf(/.*)?	gen_context(system_u:object_r:gconf_etc_t,s0)
 
 /tmp/gconfd-USER/.*	--	gen_context(system_u:object_r:gconf_tmp_t,s0)
 
+/usr/bin/gnome-keyring-daemon	--	gen_context(system_u:object_r:gkeyringd_exec_t,s0)
 /usr/libexec/gconfd-2 	--	gen_context(system_u:object_r:gconfd_exec_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/gnome.if refpolicy/policy/modules/contrib/gnome.if
--- refpolicy/policy/modules/contrib/gnome.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/gnome.if	2012-11-01 22:03:11.277787693 +0100
@@ -1,44 +1,123 @@
-## <summary>GNU network object model environment (GNOME)</summary>
+## <summary>GNU network object model environment.</summary>
 
-############################################################
+########################################
 ## <summary>
-##	Role access for gnome
+##	Role access for gnome.  (Deprecated)
 ## </summary>
 ## <param name="role">
 ##	<summary>
-##	Role allowed access
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <param name="domain">
 ##	<summary>
-##	User domain for the role
+##	User domain for the role.
 ##	</summary>
 ## </param>
 #
 interface(`gnome_role',`
+	refpolicywarn(`$0($*) has been deprecated')
+')
+
+#######################################
+## <summary>
+##	The role template for gnome.
+## </summary>
+## <param name="role_prefix">
+##	<summary>
+##	The prefix of the user domain (e.g., user
+##	is the prefix for user_t).
+##	</summary>
+## </param>
+## <param name="user_role">
+##	<summary>
+##	The role associated with the user domain.
+##	</summary>
+## </param>
+## <param name="user_domain">
+##	<summary>
+##	The type of the user domain.
+##	</summary>
+## </param>
+#
+template(`gnome_role_template',`
 	gen_require(`
-		type gconfd_t, gconfd_exec_t;
-		type gconf_tmp_t;
+		attribute gnomedomain, gkeyringd_domain;
+		attribute_role gconfd_roles;
+		type gkeyringd_exec_t, gnome_keyring_home_t, gnome_keyring_tmp_t;
+		type gconfd_t, gconfd_exec_t, gconf_tmp_t;
+		type gconf_home_t;
 	')
 
-	role $1 types gconfd_t;
+	########################################
+	#
+	# Gconf declarations
+	#
+
+	roleattribute $2 gconfd_roles;
+
+	########################################
+	#
+	# Gkeyringd declarations
+	#
+
+	type $1_gkeyringd_t, gnomedomain, gkeyringd_domain;
+	userdom_user_application_domain($1_gkeyringd_t, gkeyringd_exec_t)
+	domain_user_exemption_target($1_gkeyringd_t)
+
+	role $2 types $1_gkeyringd_t;
 
-	domain_auto_trans($2, gconfd_exec_t, gconfd_t)
-	allow gconfd_t $2:fd use;
-	allow gconfd_t $2:fifo_file write;
-	allow gconfd_t $2:unix_stream_socket connectto;
+	########################################
+	#
+	# Gconf policy
+	#
 
-	ps_process_pattern($2, gconfd_t)
+	domtrans_pattern($3, gconfd_exec_t, gconfd_t)
 
-	#gnome_stream_connect_gconf_template($1, $2)
-	read_files_pattern($2, gconf_tmp_t, gconf_tmp_t)
-	allow $2 gconfd_t:unix_stream_socket connectto;
+	allow $3 { gconf_home_t gconf_tmp_t }:dir { manage_dir_perms relabel_dir_perms };
+	allow $3 { gconf_home_t gconf_tmp_t }:file { manage_file_perms relabel_file_perms };
+	userdom_user_home_dir_filetrans($3, gconf_home_t, dir, ".gconf")
+	userdom_user_home_dir_filetrans($3, gconf_home_t, dir, ".gconfd")
+
+	allow $3 gconfd_t:process { ptrace signal_perms };
+	ps_process_pattern($3, gconfd_t)
+
+	########################################
+	#
+	# Gkeyringd policy
+	#
+
+	domtrans_pattern($3, gkeyringd_exec_t, $1_gkeyringd_t)
+
+	allow $3 { gnome_home_t gnome_keyring_home_t gnome_keyring_tmp_t }:dir { relabel_dir_perms manage_dir_perms };
+	allow $3 { gnome_home_t gnome_keyring_home_t }:file { relabel_file_perms manage_file_perms };
+
+	userdom_user_home_dir_filetrans($3, gnome_home_t, dir, ".gnome")
+	userdom_user_home_dir_filetrans($3, gnome_home_t, dir, ".gnome2")
+	userdom_user_home_dir_filetrans($3, gnome_home_t, dir, ".gnome2_private")
+	
+	gnome_home_filetrans($3, gnome_keyring_home_t, dir, "keyrings")
+
+	allow $3 gnome_keyring_tmp_t:sock_file { relabel_sock_file_perms manage_sock_file_perms };
+
+	ps_process_pattern($3, $1_gkeyringd_t)
+	allow $3 $1_gkeyringd_t:process { ptrace signal_perms };
+
+	corecmd_bin_domtrans($1_gkeyringd_t, $3)
+	corecmd_shell_domtrans($1_gkeyringd_t, $3)
+
+	gnome_stream_connect_gkeyringd($1, $3)
+
+	optional_policy(`
+		dbus_spec_session_domain($1, gkeyringd_exec_t, $1_gkeyringd_t)
+
+		gnome_dbus_chat_gkeyringd($1, $3)
+	')
 ')
 
 ########################################
 ## <summary>
-##	Execute gconf programs in
-##	in the caller domain.
+##	Execute gconf in the caller domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -51,32 +130,54 @@
 		type gconfd_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	can_exec($1, gconfd_exec_t)
 ')
 
 ########################################
 ## <summary>
-##	Read gconf config files.
+##	Read gconf configuration content.
 ## </summary>
-## <param name="user_domain">
+## <param name="domain">
 ##	<summary>
 ##	Domain allowed access.
 ##	</summary>
 ## </param>
 #
-template(`gnome_read_gconf_config',`
+interface(`gnome_read_gconf_config',`
 	gen_require(`
 		type gconf_etc_t;
 	')
 
-	allow $1 gconf_etc_t:dir list_dir_perms;
-	read_files_pattern($1, gconf_etc_t, gconf_etc_t)
 	files_search_etc($1)
+	allow $1 gconf_etc_t:dir list_dir_perms;
+	allow $1 gconf_etc_t:file read_file_perms;
+	allow $1 gconf_etc_t:lnk_file read_lnk_file_perms;
+')
+
+########################################
+## <summary>
+##	Do not audit attempts to read
+##	inherited gconf configuration files.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain to not audit.
+##	</summary>
+## </param>
+#
+interface(`gnome_dontaudit_read_inherited_gconf_config_files',`
+	gen_require(`
+		type gconf_etc_t;
+	')
+
+	dontaudit $1 gconf_etc_t:file read;
 ')
 
 #######################################
 ## <summary>
-##	Create, read, write, and delete gconf config files.
+##	Create, read, write, and delete
+##	gconf configuration content.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -89,15 +190,18 @@
 		type gconf_etc_t;
 	')
 
-	manage_files_pattern($1, gconf_etc_t, gconf_etc_t)
 	files_search_etc($1)
+	allow $1 gconf_etc_t:dir manage_dir_perms;
+	allow $1 gconf_etc_t:file manage_file_perms;
+	allow $1 gconf_etc_t:lnk_file manage_lnk_file_perms;
 ')
 
 ########################################
 ## <summary>
-##	gconf connection template.
+##	Connect to gconf using a unix
+##	domain stream socket.
 ## </summary>
-## <param name="user_domain">
+## <param name="domain">
 ##	<summary>
 ##	Domain allowed access.
 ##	</summary>
@@ -108,8 +212,8 @@
 		type gconfd_t, gconf_tmp_t;
 	')
 
-	read_files_pattern($1, gconf_tmp_t, gconf_tmp_t)
-	allow $1 gconfd_t:unix_stream_socket connectto;
+	files_search_tmp($1)
+	stream_connect_pattern($1, gconf_tmp_t, gconf_tmp_t, gconfd_t)
 ')
 
 ########################################
@@ -118,7 +222,7 @@
 ## </summary>
 ## <param name="domain">
 ##	<summary>
-##	Domain allowed access.
+##	Domain allowed to transition.
 ##	</summary>
 ## </param>
 #
@@ -127,12 +231,32 @@
 		type gconfd_t, gconfd_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, gconfd_exec_t, gconfd_t)
 ')
 
 ########################################
 ## <summary>
-##	Set attributes of Gnome config dirs.
+##	Create generic gnome home directories.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`gnome_create_generic_home_dirs',`
+	gen_require(`
+		type gnome_home_t;
+	')
+
+	allow $1 gnome_home_t:dir create_dir_perms;
+')
+
+########################################
+## <summary>
+##	Set attributes of generic gnome
+##	user home directories.  (Deprecated)
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -141,50 +265,451 @@
 ## </param>
 #
 interface(`gnome_setattr_config_dirs',`
+	refpolicywarn(`$0($*) has been deprecated, use gnome_setattr_generic_home_dirs() instead.')
+	gnome_setattr_generic_home_dirs($1)
+')
+
+########################################
+## <summary>
+##	Set attributes of generic gnome
+##	user home directories.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`gnome_setattr_generic_home_dirs',`
 	gen_require(`
 		type gnome_home_t;
 	')
 
+	userdom_search_user_home_dirs($1)
 	setattr_dirs_pattern($1, gnome_home_t, gnome_home_t)
-	files_search_home($1)
 ')
 
 ########################################
 ## <summary>
-##	Read gnome homedir content (.config)
+##	Read generic gnome user home content.  (Deprecated)
 ## </summary>
-## <param name="user_domain">
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`gnome_read_config',`
+	refpolicywarn(`$0($*) has been deprecated, use gnome_read_generic_home_content() instead.')
+	gnome_read_generic_home_content($1)
+')
+
+########################################
+## <summary>
+##	Read generic gnome home content.
+## </summary>
+## <param name="domain">
 ##	<summary>
 ##	Domain allowed access.
 ##	</summary>
 ## </param>
 #
-template(`gnome_read_config',`
+interface(`gnome_read_generic_home_content',`
 	gen_require(`
 		type gnome_home_t;
 	')
 
-	list_dirs_pattern($1, gnome_home_t, gnome_home_t)
-	read_files_pattern($1, gnome_home_t, gnome_home_t)
-	read_lnk_files_pattern($1, gnome_home_t, gnome_home_t)
+	userdom_search_user_home_dirs($1)
+	allow $1 gnome_home_t:dir list_dir_perms;
+	allow $1 gnome_home_t:file read_file_perms;
+	allow $1 gnome_home_t:fifo_file read_fifo_file_perms;
+	allow $1 gnome_home_t:lnk_file read_lnk_file_perms;
+	allow $1 gnome_home_t:sock_file read_sock_file_perms;
 ')
 
 ########################################
 ## <summary>
-##	manage gnome homedir content (.config)
+##	Create, read, write, and delete
+##	generic gnome user home content.  (Deprecated)
 ## </summary>
-## <param name="user_domain">
+## <param name="domain">
 ##	<summary>
 ##	Domain allowed access.
 ##	</summary>
 ## </param>
 #
 interface(`gnome_manage_config',`
+	refpolicywarn(`$0($*) has been deprecated, use gnome_manage_generic_home_content() instead.')
+	gnome_manage_generic_home_content($1)
+')
+
+########################################
+## <summary>
+##	Create, read, write, and delete
+##	generic gnome home content.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`gnome_manage_generic_home_content',`
 	gen_require(`
 		type gnome_home_t;
 	')
 
+	userdom_search_user_home_dirs($1)
 	allow $1 gnome_home_t:dir manage_dir_perms;
 	allow $1 gnome_home_t:file manage_file_perms;
+	allow $1 gnome_home_t:fifo_file manage_fifo_file_perms;
+	allow $1 gnome_home_t:lnk_file manage_lnk_file_perms;
+	allow $1 gnome_home_t:sock_file manage_sock_file_perms;
+')
+
+########################################
+## <summary>
+##	Search generic gnome home directories.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`gnome_search_generic_home',`
+	gen_require(`
+		type gnome_home_t;
+	')
+
+	userdom_search_user_home_dirs($1)
+	allow $1 gnome_home_t:dir search_dir_perms;
+')
+
+########################################
+## <summary>
+##	Create objects in gnome user home
+##	directories with a private type.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="private_type">
+##	<summary>
+##	Private file type.
+##	</summary>
+## </param>
+## <param name="object_class">
+##	<summary>
+##	Class of the object being created.
+##	</summary>
+## </param>
+## <param name="name" optional="true">
+##	<summary>
+##	The name of the object being created.
+##	</summary>
+## </param>
+#
+interface(`gnome_home_filetrans',`
+	gen_require(`
+		type gnome_home_t;
+	')
+
 	userdom_search_user_home_dirs($1)
+	filetrans_pattern($1, gnome_home_t, $2, $3, $4)
+')
+
+########################################
+## <summary>
+##	Create generic gconf home directories.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`gnome_create_generic_gconf_home_dirs',`
+	gen_require(`
+		type gconf_home_t;
+	')
+
+	allow $1 gconf_home_t:dir create_dir_perms;
+')
+
+########################################
+## <summary>
+##	Read generic gconf home content.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`gnome_read_generic_gconf_home_content',`
+	gen_require(`
+		type gconf_home_t;
+	')
+
+	userdom_search_user_home_dirs($1)
+	allow $1 gconf_home_t:dir list_dir_perms;
+	allow $1 gconf_home_t:file read_file_perms;
+	allow $1 gconf_home_t:fifo_file read_fifo_file_perms;
+	allow $1 gconf_home_t:lnk_file read_lnk_file_perms;
+	allow $1 gconf_home_t:sock_file read_sock_file_perms;
+')
+
+########################################
+## <summary>
+##	Create, read, write, and delete
+##	generic gconf home content.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`gnome_manage_generic_gconf_home_content',`
+	gen_require(`
+		type gconf_home_t;
+	')
+
+	userdom_search_user_home_dirs($1)
+	allow $1 gconf_home_t:dir manage_dir_perms;
+	allow $1 gconf_home_t:file manage_file_perms;
+	allow $1 gconf_home_t:fifo_file manage_fifo_file_perms;
+	allow $1 gconf_home_t:lnk_file manage_lnk_file_perms;
+	allow $1 gconf_home_t:sock_file manage_sock_file_perms;
+')
+
+########################################
+## <summary>
+##	Search generic gconf home directories.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`gnome_search_generic_gconf_home',`
+	gen_require(`
+		type gconf_home_t;
+	')
+
+	userdom_search_user_home_dirs($1)
+	allow $1 gconf_home_t:dir search_dir_perms;
+')
+
+########################################
+## <summary>
+##	Create objects in user home
+##	directories with the generic gconf
+##	home type.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="object_class">
+##	<summary>
+##	Class of the object being created.
+##	</summary>
+## </param>
+## <param name="name" optional="true">
+##	<summary>
+##	The name of the object being created.
+##	</summary>
+## </param>
+#
+interface(`gnome_home_filetrans_gconf_home',`
+	gen_require(`
+		type gconf_home_t;
+	')
+
+	userdom_user_home_dir_filetrans($1, gconf_home_t, $2, $3)
+')
+
+########################################
+## <summary>
+##	Create objects in user home
+##	directories with the generic gnome
+##	home type.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="object_class">
+##	<summary>
+##	Class of the object being created.
+##	</summary>
+## </param>
+## <param name="name" optional="true">
+##	<summary>
+##	The name of the object being created.
+##	</summary>
+## </param>
+#
+interface(`gnome_home_filetrans_gnome_home',`
+	gen_require(`
+		type gnome_home_t;
+	')
+
+	userdom_user_home_dir_filetrans($1, gnome_home_t, $2, $3)
+')
+
+########################################
+## <summary>
+##	Create objects in gnome gconf home
+##	directories with a private type.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="private_type">
+##	<summary>
+##	Private file type.
+##	</summary>
+## </param>
+## <param name="object_class">
+##	<summary>
+##	Class of the object being created.
+##	</summary>
+## </param>
+## <param name="name" optional="true">
+##	<summary>
+##	The name of the object being created.
+##	</summary>
+## </param>
+#
+interface(`gnome_gconf_home_filetrans',`
+	gen_require(`
+		type gconf_home_t;
+	')
+
+	userdom_search_user_home_dirs($1)
+	filetrans_pattern($1, gconf_home_t, $2, $3, $4)
+')
+
+########################################
+## <summary>
+##	Read generic gnome keyring home files.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`gnome_read_keyring_home_files',`
+	gen_require(`
+		type gnome_home_t, gnome_keyring_home_t;
+	')
+
+	userdom_search_user_home_dirs($1)
+	read_files_pattern($1, { gnome_home_t gnome_keyring_home_t }, gnome_keyring_home_t)
+')
+
+########################################
+## <summary>
+##	Send and receive messages from
+##	gnome keyring daemon over dbus.
+## </summary>
+## <param name="role_prefix">
+##	<summary>
+##	The prefix of the user domain (e.g., user
+##	is the prefix for user_t).
+##	</summary>
+## </param>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`gnome_dbus_chat_gkeyringd',`
+	gen_require(`
+		type $1_gkeyringd_t;
+		class dbus send_msg;
+	')
+
+	allow $2 $1_gkeyringd_t:dbus send_msg;
+	allow $1_gkeyringd_t $2:dbus send_msg;
+')
+
+########################################
+## <summary>
+##	Send and receive messages from all
+##	gnome keyring daemon over dbus.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`gnome_dbus_chat_all_gkeyringd',`
+	gen_require(`
+		attribute gkeyringd_domain;
+		class dbus send_msg;
+	')
+
+	allow $1 gkeyringd_domain:dbus send_msg;
+	allow gkeyringd_domain $1:dbus send_msg;
+')
+
+########################################
+## <summary>
+##	Connect to gnome keyring daemon
+##	with a unix stream socket.
+## </summary>
+## <param name="role_prefix">
+##	<summary>
+##	The prefix of the user domain (e.g., user
+##	is the prefix for user_t).
+##	</summary>
+## </param>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`gnome_stream_connect_gkeyringd',`
+	gen_require(`
+		type $1_gkeyringd_t, gnome_keyring_tmp_t;
+	')
+
+	files_search_tmp($2)
+	stream_connect_pattern($2, gnome_keyring_tmp_t, gnome_keyring_tmp_t, $1_gkeyringd_t)
+')
+
+########################################
+## <summary>
+##	Connect to all gnome keyring daemon
+##	with a unix stream socket.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`gnome_stream_connect_all_gkeyringd',`
+	gen_require(`
+		attribute gkeyringd_domain;
+		type gnome_keyring_tmp_t;
+	')
+
+	files_search_tmp($1)
+	stream_connect_pattern($1, gnome_keyring_tmp_t, gnome_keyring_tmp_t, gkeyringd_domain)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/gnome.te refpolicy/policy/modules/contrib/gnome.te
--- refpolicy/policy/modules/contrib/gnome.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/gnome.te	2012-11-01 22:02:01.149787543 +0100
@@ -1,11 +1,13 @@
-policy_module(gnome, 2.2.0)
+policy_module(gnome, 2.2.4)
 
 ##############################
 #
 # Declarations
 #
 
+attribute gkeyringd_domain;
 attribute gnomedomain;
+attribute_role gconfd_roles;
 
 type gconf_etc_t;
 files_config_file(gconf_etc_t)
@@ -27,6 +29,7 @@
 typealias gconfd_t alias { user_gconfd_t staff_gconfd_t sysadm_gconfd_t };
 typealias gconfd_t alias { auditadm_gconfd_t secadm_gconfd_t };
 userdom_user_application_domain(gconfd_t, gconfd_exec_t)
+role gconfd_roles types gconfd_t;
 
 type gnome_home_t;
 typealias gnome_home_t alias { user_gnome_home_t staff_gnome_home_t sysadm_gnome_home_t };
@@ -34,13 +37,53 @@
 typealias gnome_home_t alias unconfined_gnome_home_t;
 userdom_user_home_content(gnome_home_t)
 
+type gkeyringd_exec_t;
+application_executable_file(gkeyringd_exec_t)
+
+type gnome_keyring_home_t;
+userdom_user_home_content(gnome_keyring_home_t)
+
+type gnome_keyring_tmp_t;
+userdom_user_tmp_file(gnome_keyring_tmp_t)
+
+ifdef(`distro_gentoo',`
+	type gnome_xdg_config_t;
+
+	xdg_config_home_content(gnome_xdg_config_t)
+')
+
 ##############################
 #
-# Local Policy
+# Common local Policy
 #
 
-allow gconfd_t self:process getsched;
-allow gconfd_t self:fifo_file rw_fifo_file_perms;
+allow gnomedomain self:process { getsched signal };
+allow gnomedomain self:fifo_file rw_fifo_file_perms;
+
+dev_read_urand(gnomedomain)
+
+domain_use_interactive_fds(gnomedomain)
+
+files_read_etc_files(gnomedomain)
+
+miscfiles_read_localization(gnomedomain)
+
+logging_send_syslog_msg(gnomedomain)
+
+userdom_use_user_terminals(gnomedomain)
+
+optional_policy(`
+	xserver_rw_xdm_pipes(gnomedomain)
+	xserver_use_xdm_fds(gnomedomain)
+')
+
+##############################
+#
+# Conf daemon local Policy
+#
+
+allow gconfd_t gconf_etc_t:dir list_dir_perms;
+read_files_pattern(gconfd_t, gconf_etc_t, gconf_etc_t)
 
 manage_dirs_pattern(gconfd_t, gconf_home_t, gconf_home_t)
 manage_files_pattern(gconfd_t, gconf_home_t, gconf_home_t)
@@ -50,26 +93,49 @@
 manage_files_pattern(gconfd_t, gconf_tmp_t, gconf_tmp_t)
 userdom_user_tmp_filetrans(gconfd_t, gconf_tmp_t, { dir file })
 
-allow gconfd_t gconf_etc_t:dir list_dir_perms;
-read_files_pattern(gconfd_t, gconf_etc_t, gconf_etc_t)
+userdom_manage_user_tmp_dirs(gconfd_t)
+userdom_tmp_filetrans_user_tmp(gconfd_t, dir)
+
+optional_policy(`
+	nscd_dontaudit_search_pid(gconfd_t)
+')
+
+##############################
+#
+# Keyring-daemon local policy
+#
 
-dev_read_urand(gconfd_t)
+allow gkeyringd_domain self:capability ipc_lock;
+allow gkeyringd_domain self:process { getcap setcap };
+allow gkeyringd_domain self:unix_stream_socket { connectto accept listen };
 
-files_read_etc_files(gconfd_t)
+allow gkeyringd_domain gnome_home_t:dir create_dir_perms;
+gnome_home_filetrans_gnome_home(gkeyringd_domain, dir, ".gnome2")
 
-miscfiles_read_localization(gconfd_t)
+manage_dirs_pattern(gkeyringd_domain, gnome_keyring_home_t, gnome_keyring_home_t)
+manage_files_pattern(gkeyringd_domain, gnome_keyring_home_t, gnome_keyring_home_t)
+gnome_home_filetrans(gkeyringd_domain, gnome_keyring_home_t, dir, "keyrings")
 
-logging_send_syslog_msg(gconfd_t)
+manage_dirs_pattern(gkeyringd_domain, gnome_keyring_tmp_t, gnome_keyring_tmp_t)
+manage_sock_files_pattern(gkeyringd_domain, gnome_keyring_tmp_t, gnome_keyring_tmp_t)
+files_tmp_filetrans(gkeyringd_domain, gnome_keyring_tmp_t, dir)
 
-userdom_manage_user_tmp_sockets(gconfd_t)
-userdom_manage_user_tmp_dirs(gconfd_t)
-userdom_tmp_filetrans_user_tmp(gconfd_t, dir)
+kernel_read_system_state(gkeyringd_domain)
+kernel_read_crypto_sysctls(gkeyringd_domain)
+
+dev_read_rand(gkeyringd_domain)
+dev_read_sysfs(gkeyringd_domain)
+
+files_read_usr_files(gkeyringd_domain)
+
+fs_getattr_all_fs(gkeyringd_domain)
+
+selinux_getattr_fs(gkeyringd_domain)
 
 optional_policy(`
-	nscd_dontaudit_search_pid(gconfd_t)
+	ssh_read_user_home_files(gkeyringd_domain)
 ')
 
 optional_policy(`
-	xserver_use_xdm_fds(gconfd_t)
-	xserver_rw_xdm_pipes(gconfd_t)
+	telepathy_mission_control_read_state(gkeyringd_domain)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/gnomeclock.fc refpolicy/policy/modules/contrib/gnomeclock.fc
--- refpolicy/policy/modules/contrib/gnomeclock.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/gnomeclock.fc	2012-10-04 19:31:04.031376250 +0200
@@ -1,2 +1,5 @@
 /usr/libexec/gnome-clock-applet-mechanism	--	gen_context(system_u:object_r:gnomeclock_exec_t,s0)
 
+/usr/libexec/gsd-datetime-mechanism	--	gen_context(system_u:object_r:gnomeclock_exec_t,s0)
+
+/usr/libexec/kde(3|4)/kcmdatetimehelper	--	gen_context(system_u:object_r:gnomeclock_exec_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/gnomeclock.if refpolicy/policy/modules/contrib/gnomeclock.if
--- refpolicy/policy/modules/contrib/gnomeclock.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/gnomeclock.if	2012-11-02 20:08:13.378957387 +0100
@@ -2,7 +2,8 @@
 
 ########################################
 ## <summary>
-##	Execute a domain transition to run gnomeclock.
+##	Execute a domain transition to
+##	run gnomeclock.
 ## </summary>
 ## <param name="domain">
 ## <summary>
@@ -15,13 +16,15 @@
 		type gnomeclock_t, gnomeclock_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, gnomeclock_exec_t, gnomeclock_t)
 ')
 
 ########################################
 ## <summary>
-##	Execute gnomeclock in the gnomeclock domain, and
-##	allow the specified role the gnomeclock domain.
+##	Execute gnomeclock in the gnomeclock
+##	domain, and allow the specified
+##	role the gnomeclock domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -36,11 +39,11 @@
 #
 interface(`gnomeclock_run',`
 	gen_require(`
-		type gnomeclock_t;
+		attribute_role gnomeclock_roles;
 	')
 
 	gnomeclock_domtrans($1)
-	role $2 types gnomeclock_t;
+	roleattribute $2 gnomeclock_roles;
 ')
 
 ########################################
@@ -63,3 +66,25 @@
 	allow $1 gnomeclock_t:dbus send_msg;
 	allow gnomeclock_t $1:dbus send_msg;
 ')
+
+########################################
+## <summary>
+##	Do not audit attempts to send and
+##	receive messages from gnomeclock
+##	over dbus.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain to not audit.
+##	</summary>
+## </param>
+#
+interface(`gnomeclock_dontaudit_dbus_chat',`
+	gen_require(`
+		type gnomeclock_t;
+		class dbus send_msg;
+	')
+
+	dontaudit $1 gnomeclock_t:dbus send_msg;
+	dontaudit gnomeclock_t $1:dbus send_msg;
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/gnomeclock.te refpolicy/policy/modules/contrib/gnomeclock.te
--- refpolicy/policy/modules/contrib/gnomeclock.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/gnomeclock.te	2012-11-02 20:08:13.378957387 +0100
@@ -1,45 +1,86 @@
-policy_module(gnomeclock, 1.0.0)
+policy_module(gnomeclock, 1.0.4)
 
 ########################################
 #
 # Declarations
 #
 
+attribute_role gnomeclock_roles;
+
 type gnomeclock_t;
 type gnomeclock_exec_t;
-dbus_system_domain(gnomeclock_t, gnomeclock_exec_t)
+init_system_domain(gnomeclock_t, gnomeclock_exec_t)
+role gnomeclock_roles types gnomeclock_t;
 
 ########################################
 #
-# gnomeclock local policy
+# Local policy
 #
 
-allow gnomeclock_t self:capability { sys_nice sys_time sys_ptrace };
-allow gnomeclock_t self:process { getattr getsched };
+allow gnomeclock_t self:capability { sys_nice sys_time };
+allow gnomeclock_t self:process { getattr getsched signal };
 allow gnomeclock_t self:fifo_file rw_fifo_file_perms;
-allow gnomeclock_t self:unix_stream_socket create_stream_socket_perms;
+allow gnomeclock_t self:unix_stream_socket { accept listen };
+
+kernel_read_system_state(gnomeclock_t)
 
 corecmd_exec_bin(gnomeclock_t)
+corecmd_exec_shell(gnomeclock_t)
+
+corenet_all_recvfrom_unlabeled(gnomeclock_t)
+corenet_all_recvfrom_netlabel(gnomeclock_t)
+corenet_tcp_sendrecv_generic_if(gnomeclock_t)
+corenet_tcp_sendrecv_generic_node(gnomeclock_t)
+
+# tcp:37 (time)
+corenet_sendrecv_inetd_child_client_packets(gnomeclock_t)
+corenet_tcp_connect_inetd_child_port(gnomeclock_t)
+corenet_tcp_sendrecv_inetd_child_port(gnomeclock_t)
+
+dev_read_sysfs(gnomeclock_t)
+dev_read_realtime_clock(gnomeclock_t)
+dev_read_urand(gnomeclock_t)
 
-files_read_etc_files(gnomeclock_t)
 files_read_usr_files(gnomeclock_t)
 
+fs_getattr_xattr_fs(gnomeclock_t)
+
 auth_use_nsswitch(gnomeclock_t)
 
-clock_domtrans(gnomeclock_t)
+logging_send_syslog_msg(gnomeclock_t)
 
-miscfiles_read_localization(gnomeclock_t)
-miscfiles_manage_localization(gnomeclock_t)
 miscfiles_etc_filetrans_localization(gnomeclock_t)
+miscfiles_manage_localization(gnomeclock_t)
+miscfiles_read_localization(gnomeclock_t)
 
 userdom_read_all_users_state(gnomeclock_t)
 
 optional_policy(`
-	consolekit_dbus_chat(gnomeclock_t)
+	chronyd_initrc_domtrans(gnomeclock_t)
+')
+
+optional_policy(`
+	clock_domtrans(gnomeclock_t)
+')
+
+optional_policy(`
+	dbus_system_domain(gnomeclock_t, gnomeclock_exec_t)
+
+	optional_policy(`
+		consolekit_dbus_chat(gnomeclock_t)
+	')
+
+	optional_policy(`
+		policykit_dbus_chat(gnomeclock_t)
+	')
+')
+
+optional_policy(`
+	ntp_domtrans_ntpdate(gnomeclock_t)
+	ntp_initrc_domtrans(gnomeclock_t)
 ')
 
 optional_policy(`
-	policykit_dbus_chat(gnomeclock_t)
 	policykit_domtrans_auth(gnomeclock_t)
 	policykit_read_lib(gnomeclock_t)
 	policykit_read_reload(gnomeclock_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/gorg.fc refpolicy/policy/modules/contrib/gorg.fc
--- refpolicy/policy/modules/contrib/gorg.fc	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/gorg.fc	2012-05-05 16:11:26.748762612 +0200
@@ -0,0 +1,3 @@
+/etc/gorg(/.*)?				gen_context(system_u:object_r:gorg_config_t,s0)
+/var/cache/gorg(/.*)?			gen_context(system_u:object_r:gorg_cache_t,s0)
+/usr/bin/gorg			--	gen_context(system_u:object_r:gorg_exec_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/gorg.if refpolicy/policy/modules/contrib/gorg.if
--- refpolicy/policy/modules/contrib/gorg.if	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/gorg.if	2012-05-05 16:11:26.751762612 +0200
@@ -0,0 +1,34 @@
+## <summary>Policy for gorg</summary>
+
+#######################################
+## <summary>
+##      Role access for gorg
+## </summary>
+## <param name="role">
+##      <summary>
+##      Role allowed access
+##      </summary>
+## </param>
+## <param name="domain">
+##      <summary>
+##      User domain for the role
+##      </summary>
+## </param>
+#
+interface(`gorg_role',`
+	gen_require(`
+		type gorg_t, gorg_exec_t;
+	')
+
+	role $1 types gorg_t;
+
+	domain_auto_trans($2, gorg_exec_t, gorg_t)
+	allow $2 gorg_t:process { noatsecure siginh rlimitinh };
+	allow gorg_t $2:fd use;
+	allow gorg_t $2:process { sigchld signull };
+
+	ps_process_pattern($2, gorg_t)
+	allow $2 gorg_t:process signal_perms;
+	# Needed for command-usage (pipe)
+	allow gorg_t $2:fifo_file write;
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/gorg.te refpolicy/policy/modules/contrib/gorg.te
--- refpolicy/policy/modules/contrib/gorg.te	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/gorg.te	2012-05-05 16:11:26.753762612 +0200
@@ -0,0 +1,63 @@
+policy_module(gorg, 1.0.0)
+
+type gorg_t;
+type gorg_exec_t;
+application_domain(gorg_t, gorg_exec_t)
+
+type gorg_cache_t;
+files_type(gorg_cache_t);
+
+type gorg_config_t;
+files_type(gorg_config_t);
+
+###################################
+#
+# gorg_t local policy
+#
+allow gorg_t self:process signal;
+
+# Allow gorg_t to put files in the gorg_cache_t location(s)
+manage_dirs_pattern(gorg_t, gorg_cache_t, gorg_cache_t)
+manage_files_pattern(gorg_t, gorg_cache_t, gorg_cache_t)
+
+# Allow gorg_t to read configuration file(s)
+allow gorg_t gorg_config_t:dir list_dir_perms;
+read_files_pattern(gorg_t, gorg_config_t, gorg_config_t)
+
+# gorg logs through /dev/log
+logging_send_syslog_msg(gorg_t)
+
+# Allow gorg to bind to port 8080 (http_cache_port_t)
+sysnet_read_config(gorg_t)
+sysnet_dns_name_resolve(gorg_t)
+corenet_all_recvfrom_unlabeled(gorg_t)
+corenet_all_recvfrom_netlabel(gorg_t)
+corenet_tcp_sendrecv_generic_if(gorg_t)
+corenet_tcp_sendrecv_generic_node(gorg_t)
+#corenet_tcp_sendrecv_all_ports(gorg_t)
+corenet_tcp_bind_generic_node(gorg_t)
+corenet_tcp_bind_http_cache_port(gorg_t)
+allow gorg_t self:netlink_route_socket { create_socket_perms nlmsg_read };
+allow gorg_t self:tcp_socket { listen accept };
+
+# Allow gorg read access to user home files (usually where cvs/git pull is stored)
+files_search_home(gorg_t)
+userdom_search_user_home_dirs(gorg_t)
+userdom_user_home_content(gorg_t)
+userdom_list_user_home_content(gorg_t)
+userdom_read_user_home_content_symlinks(gorg_t)
+userdom_read_user_home_content_files(gorg_t)
+
+# Local policy
+allow gorg_t self:fifo_file rw_fifo_file_perms;
+
+# Read /etc files (xml/catalog, hosts.conf, ...)
+files_read_etc_files(gorg_t)
+miscfiles_read_localization(gorg_t)
+
+# Gorg is ruby, so be able to execute ruby
+corecmd_exec_bin(gorg_t)
+
+# Output to screen
+userdom_use_user_terminals(gorg_t)
+domain_use_interactive_fds(gorg_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/gpg.fc refpolicy/policy/modules/contrib/gpg.fc
--- refpolicy/policy/modules/contrib/gpg.fc	2012-05-04 16:15:51.000000000 +0200
+++ refpolicy/policy/modules/contrib/gpg.fc	2012-10-08 10:25:00.616043984 +0200
@@ -1,11 +1,10 @@
-HOME_DIR/\.gnupg(/.+)?		gen_context(system_u:object_r:gpg_secret_t,s0)
-HOME_DIR/\.gnupg/log-socket	gen_context(system_u:object_r:gpg_agent_tmp_t,s0)
+HOME_DIR/\.gnupg(/.+)?	gen_context(system_u:object_r:gpg_secret_t,s0)
+HOME_DIR/\.gnupg/log-socket	-s	gen_context(system_u:object_r:gpg_agent_tmp_t,s0)
 
 /usr/bin/gpg(2)?	--	gen_context(system_u:object_r:gpg_exec_t,s0)
-/usr/bin/gpgsm		--	gen_context(system_u:object_r:gpg_exec_t,s0)
+/usr/bin/gpgsm	--	gen_context(system_u:object_r:gpg_exec_t,s0)
 /usr/bin/gpg-agent	--	gen_context(system_u:object_r:gpg_agent_exec_t,s0)
-/usr/bin/kgpg		--	gen_context(system_u:object_r:gpg_exec_t,s0)
 /usr/bin/pinentry.*	--	gen_context(system_u:object_r:pinentry_exec_t,s0)
 
 /usr/lib/gnupg/.*	--	gen_context(system_u:object_r:gpg_exec_t,s0)
-/usr/lib/gnupg/gpgkeys.* --	gen_context(system_u:object_r:gpg_helper_exec_t,s0)
+/usr/lib/gnupg/gpgkeys.*	--	gen_context(system_u:object_r:gpg_helper_exec_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/gpg.if refpolicy/policy/modules/contrib/gpg.if
--- refpolicy/policy/modules/contrib/gpg.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/gpg.if	2012-10-16 19:36:47.098014111 +0200
@@ -2,74 +2,57 @@
 
 ############################################################
 ## <summary>
-##	Role access for gpg
+##	Role access for gpg.
 ## </summary>
 ## <param name="role">
 ##	<summary>
-##	Role allowed access
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <param name="domain">
 ##	<summary>
-##	User domain for the role
+##	User domain for the role.
 ##	</summary>
 ## </param>
 #
 interface(`gpg_role',`
 	gen_require(`
-		type gpg_t, gpg_exec_t;
-		type gpg_agent_t, gpg_agent_exec_t;
-		type gpg_agent_tmp_t;
-		type gpg_helper_t, gpg_pinentry_t;
-		type gpg_pinentry_tmp_t;
+		attribute_role gpg_roles, gpg_agent_roles, gpg_helper_roles, gpg_pinentry_roles;
+		type gpg_t, gpg_exec_t, gpg_agent_t;
+		type gpg_agent_exec_t, gpg_agent_tmp_t, gpg_helper_t;
+		type gpg_pinentry_t, gpg_pinentry_tmp_t, gpg_secret_t;
 	')
 
-	role $1 types { gpg_t gpg_agent_t gpg_helper_t gpg_pinentry_t };
+	roleattribute $1 gpg_roles;
+	roleattribute $1 gpg_agent_roles;
+	roleattribute $1 gpg_helper_roles;
+	roleattribute $1 gpg_pinentry_roles;
 
-	# transition from the userdomain to the derived domain
 	domtrans_pattern($2, gpg_exec_t, gpg_t)
+	domtrans_pattern($2, gpg_agent_exec_t, gpg_agent_t)
 
-	# allow ps to show gpg
-	ps_process_pattern($2, gpg_t)
-	allow $2 gpg_t:process { signull sigstop signal sigkill };
+	allow $2 { gpg_t gpg_agent_t gpg_helper_t gpg_pinentry_t }:process { ptrace signal_perms };
+	ps_process_pattern($2, { gpg_t gpg_agent_t gpg_helper_t gpg_pinentry_t })
 
-	# communicate with the user
+	allow gpg_pinentry_t $2:process signull;
 	allow gpg_helper_t $2:fd use;
-	allow gpg_helper_t $2:fifo_file write;
-
-	# allow ps to show gpg-agent
-	ps_process_pattern($2, gpg_agent_t)
-
-	# Allow the user shell to signal the gpg-agent program.
-	allow $2 gpg_agent_t:process { signal sigkill };
-
-	manage_dirs_pattern($2, gpg_agent_tmp_t, gpg_agent_tmp_t)
-	manage_files_pattern($2, gpg_agent_tmp_t, gpg_agent_tmp_t)
-	manage_sock_files_pattern($2, gpg_agent_tmp_t, gpg_agent_tmp_t)
-	files_tmp_filetrans(gpg_agent_t, gpg_agent_tmp_t, { file sock_file dir })
-
-	# Transition from the user domain to the agent domain.
-	domtrans_pattern($2, gpg_agent_exec_t, gpg_agent_t)
+	allow { gpg_t gpg_agent_t gpg_helper_t gpg_pinentry_t } $2:fifo_file { read write };
 
-	manage_sock_files_pattern($2, gpg_pinentry_tmp_t, gpg_pinentry_tmp_t)
-	relabel_sock_files_pattern($2, gpg_pinentry_tmp_t, gpg_pinentry_tmp_t)
+	allow $2 { gpg_agent_tmp_t gpg_secret_t }:dir { manage_dir_perms relabel_dir_perms };
+	allow $2 { gpg_agent_tmp_t gpg_secret_t }:file { manage_file_perms relabel_file_perms };
+	allow $2 gpg_secret_t:lnk_file { manage_lnk_file_perms relabel_lnk_file_perms };
+	allow $2 { gpg_agent_tmp_t gpg_pinentry_tmp_t gpg_secret_t }:sock_file { manage_sock_file_perms relabel_sock_file_perms };
+	filetrans_pattern($2, gpg_secret_t, gpg_agent_tmp_t, sock_file, "log-socket")
+	userdom_user_home_dir_filetrans($2, gpg_secret_t, dir, ".gnupg")
 
 	optional_policy(`
 		gpg_pinentry_dbus_chat($2)
 	')
-
-	ifdef(`hide_broken_symptoms',`
-		#Leaked File Descriptors
-		dontaudit gpg_t $2:socket_class_set { getattr read write };
-		dontaudit gpg_t $2:fifo_file rw_fifo_file_perms;
-		dontaudit gpg_agent_t $2:socket_class_set { getattr read write };
-		dontaudit gpg_agent_t $2:fifo_file rw_fifo_file_perms;
-	')
 ')
 
 ########################################
 ## <summary>
-##	Transition to a user gpg domain.
+##	Execute the gpg in the gpg domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -82,16 +65,17 @@
 		type gpg_t, gpg_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, gpg_exec_t, gpg_t)
 ')
 
 ########################################
 ## <summary>
-##	Execute the gpg application without transitioning
+##	Execute the gpg in the caller domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
-##	Domain allowed to execute gpg
+##	Domain allowed access.
 ##	</summary>
 ## </param>
 #
@@ -100,12 +84,80 @@
 		type gpg_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	can_exec($1, gpg_exec_t)
 ')
 
 ########################################
 ## <summary>
-##	Send generic signals to user gpg processes.
+##	Execute gpg in a specified domain.
+## </summary>
+## <desc>
+##	<p>
+##	Execute gpg in a specified domain.
+##	</p>
+##	<p>
+##	No interprocess communication (signals, pipes,
+##	etc.) is provided by this interface since
+##	the domains are not owned by this module.
+##	</p>
+## </desc>
+## <param name="source_domain">
+##	<summary>
+##	Domain allowed to transition.
+##	</summary>
+## </param>
+## <param name="target_domain">
+##	<summary>
+##	Domain to transition to.
+##	</summary>
+## </param>
+#
+interface(`gpg_spec_domtrans',`
+	gen_require(`
+		type gpg_exec_t;
+	')
+
+	corecmd_search_bin($1)
+	domain_auto_trans($1, gpg_exec_t, $2)
+')
+
+######################################
+## <summary>
+##	Execute gpg in the gpg web domain.  (Deprecated)
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed to transition.
+##	</summary>
+## </param>
+#
+interface(`gpg_domtrans_web',`
+	refpolicywarn(`$0($*) has been deprecated.')
+')
+
+######################################
+## <summary>
+##	Make gpg executable files an
+##	entrypoint for the specified domain.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	The domain for which gpg_exec_t is an entrypoint.
+##	</summary>
+## </param>
+#
+interface(`gpg_entry_type',`
+	gen_require(`
+		type gpg_exec_t;
+	')
+
+	domain_entry_file($1, gpg_exec_t)
+')
+
+########################################
+## <summary>
+##	Send generic signals to gpg.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -123,7 +175,7 @@
 
 ########################################
 ## <summary>
-##	Read and write GPG agent pipes.
+##	Read and write gpg agent pipes.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -132,7 +184,6 @@
 ## </param>
 #
 interface(`gpg_rw_agent_pipes',`
-	# Just wants read/write could this be a leak?
 	gen_require(`
 		type gpg_agent_t;
 	')
@@ -142,8 +193,8 @@
 
 ########################################
 ## <summary>
-##	Send messages to and from GPG
-##	Pinentry over DBUS.
+##	Send messages to and from gpg
+##	pinentry over DBUS.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -163,7 +214,7 @@
 
 ########################################
 ## <summary>
-##	List Gnu Privacy Guard user secrets.
+##	List gpg user secrets.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/gpg.te refpolicy/policy/modules/contrib/gpg.te
--- refpolicy/policy/modules/contrib/gpg.te	2012-07-25 20:33:04.000000000 +0200
+++ refpolicy/policy/modules/contrib/gpg.te	2012-11-02 20:08:32.384957427 +0100
@@ -1,4 +1,4 @@
-policy_module(gpg, 2.6.0)
+policy_module(gpg, 2.7.3)
 
 ########################################
 #
@@ -6,25 +6,37 @@
 #
 
 ## <desc>
-## <p>
-## Allow usage of the gpg-agent --write-env-file option.
-## This also allows gpg-agent to manage user files.
-## </p>
+##	<p>
+##	Determine whether GPG agent can manage
+##	generic user home content files. This is
+##	required by the --write-env-file option.
+##	</p>
 ## </desc>
 gen_tunable(gpg_agent_env_file, false)
 
+attribute_role gpg_roles;
+roleattribute system_r gpg_roles;
+
+attribute_role gpg_agent_roles;
+
+attribute_role gpg_helper_roles;
+roleattribute system_r gpg_helper_roles;
+
+attribute_role gpg_pinentry_roles;
+
 type gpg_t;
 type gpg_exec_t;
 typealias gpg_t alias { user_gpg_t staff_gpg_t sysadm_gpg_t };
 typealias gpg_t alias { auditadm_gpg_t secadm_gpg_t };
 userdom_user_application_domain(gpg_t, gpg_exec_t)
-role system_r types gpg_t;
+role gpg_roles types gpg_t;
 
 type gpg_agent_t;
 type gpg_agent_exec_t;
 typealias gpg_agent_t alias { user_gpg_agent_t staff_gpg_agent_t sysadm_gpg_agent_t };
 typealias gpg_agent_t alias { auditadm_gpg_agent_t secadm_gpg_agent_t };
 userdom_user_application_domain(gpg_agent_t, gpg_agent_exec_t)
+role gpg_agent_roles types gpg_agent_t;
 
 type gpg_agent_tmp_t;
 typealias gpg_agent_tmp_t alias { user_gpg_agent_tmp_t staff_gpg_agent_tmp_t sysadm_gpg_agent_tmp_t };
@@ -41,13 +53,14 @@
 typealias gpg_helper_t alias { user_gpg_helper_t staff_gpg_helper_t sysadm_gpg_helper_t };
 typealias gpg_helper_t alias { auditadm_gpg_helper_t secadm_gpg_helper_t };
 userdom_user_application_domain(gpg_helper_t, gpg_helper_exec_t)
-role system_r types gpg_helper_t;
+role gpg_helper_roles types gpg_helper_t;
 
 type gpg_pinentry_t;
 type pinentry_exec_t;
 typealias gpg_pinentry_t alias { user_gpg_pinentry_t staff_gpg_pinentry_t sysadm_gpg_pinentry_t };
 typealias gpg_pinentry_t alias { auditadm_gpg_pinentry_t secadm_gpg_pinentry_t };
 userdom_user_application_domain(gpg_pinentry_t, pinentry_exec_t)
+role gpg_pinentry_roles types gpg_pinentry_t;
 
 type gpg_pinentry_tmp_t;
 userdom_user_tmp_file(gpg_pinentry_tmp_t)
@@ -55,32 +68,36 @@
 type gpg_pinentry_tmpfs_t;
 userdom_user_tmpfs_file(gpg_pinentry_tmpfs_t)
 
+optional_policy(`
+	pulseaudio_tmpfs_content(gpg_pinentry_tmpfs_t)
+')
+
 ########################################
 #
-# GPG local policy
+# Local policy
 #
 
 allow gpg_t self:capability { ipc_lock setuid };
-# setrlimit is for ulimit -c 0
-allow gpg_t self:process { signal signull setrlimit getcap setcap setpgid };
-
+allow gpg_t self:process { signal signull setrlimit getcap setcap getsched setsched setpgid };
+dontaudit gpg_t self:netlink_audit_socket r_netlink_socket_perms;
 allow gpg_t self:fifo_file rw_fifo_file_perms;
-allow gpg_t self:tcp_socket create_stream_socket_perms;
+allow gpg_t self:tcp_socket { accept listen };
 
 manage_dirs_pattern(gpg_t, gpg_agent_tmp_t, gpg_agent_tmp_t)
 manage_files_pattern(gpg_t, gpg_agent_tmp_t, gpg_agent_tmp_t)
 files_tmp_filetrans(gpg_t, gpg_agent_tmp_t, { dir file })
 
-domtrans_pattern(gpg_t, gpg_agent_exec_t, gpg_agent_t)
-
-# transition from the gpg domain to the helper domain
-domtrans_pattern(gpg_t, gpg_helper_exec_t, gpg_helper_t)
-
-allow gpg_t gpg_secret_t:dir create_dir_perms;
+manage_dirs_pattern(gpg_t, gpg_secret_t, gpg_secret_t)
+manage_sock_files_pattern(gpg_t, gpg_secret_t, gpg_secret_t)
 manage_files_pattern(gpg_t, gpg_secret_t, gpg_secret_t)
 manage_lnk_files_pattern(gpg_t, gpg_secret_t, gpg_secret_t)
 userdom_user_home_dir_filetrans(gpg_t, gpg_secret_t, dir)
 
+stream_connect_pattern(gpg_t, gpg_agent_tmp_t, gpg_agent_tmp_t, gpg_agent_t)
+
+domtrans_pattern(gpg_t, gpg_agent_exec_t, gpg_agent_t)
+domtrans_pattern(gpg_t, gpg_helper_exec_t, gpg_helper_t)
+
 kernel_read_sysctl(gpg_t)
 
 corecmd_exec_shell(gpg_t)
@@ -89,27 +106,24 @@
 corenet_all_recvfrom_unlabeled(gpg_t)
 corenet_all_recvfrom_netlabel(gpg_t)
 corenet_tcp_sendrecv_generic_if(gpg_t)
-corenet_udp_sendrecv_generic_if(gpg_t)
 corenet_tcp_sendrecv_generic_node(gpg_t)
-corenet_udp_sendrecv_generic_node(gpg_t)
-corenet_tcp_sendrecv_all_ports(gpg_t)
-corenet_udp_sendrecv_all_ports(gpg_t)
-corenet_tcp_connect_all_ports(gpg_t)
+
 corenet_sendrecv_all_client_packets(gpg_t)
+corenet_tcp_connect_all_ports(gpg_t)
+corenet_tcp_sendrecv_all_ports(gpg_t)
 
+dev_read_generic_usb_dev(gpg_t)
 dev_read_rand(gpg_t)
 dev_read_urand(gpg_t)
-dev_read_generic_usb_dev(gpg_t)
+
+files_read_usr_files(gpg_t)
+files_dontaudit_search_var(gpg_t)
 
 fs_getattr_xattr_fs(gpg_t)
 fs_list_inotifyfs(gpg_t)
 
 domain_use_interactive_fds(gpg_t)
 
-files_read_etc_files(gpg_t)
-files_read_usr_files(gpg_t)
-files_dontaudit_search_var(gpg_t)
-
 auth_use_nsswitch(gpg_t)
 
 logging_send_syslog_msg(gpg_t)
@@ -117,13 +131,11 @@
 miscfiles_read_localization(gpg_t)
 
 userdom_use_user_terminals(gpg_t)
-# sign/encrypt user files
+
 userdom_manage_user_tmp_files(gpg_t)
 userdom_manage_user_home_content_files(gpg_t)
 userdom_user_home_dir_filetrans_user_home_content(gpg_t, file)
 
-mta_write_config(gpg_t)
-
 tunable_policy(`use_nfs_home_dirs',`
 	fs_manage_nfs_dirs(gpg_t)
 	fs_manage_nfs_files(gpg_t)
@@ -135,13 +147,21 @@
 ')
 
 optional_policy(`
-	mozilla_read_user_home_files(gpg_t)
-	mozilla_write_user_home_files(gpg_t)
+	gnome_read_generic_home_content(gpg_t)
+	gnome_stream_connect_all_gkeyringd(gpg_t)
 ')
 
 optional_policy(`
-	xserver_use_xdm_fds(gpg_t)
-	xserver_rw_xdm_pipes(gpg_t)
+	mozilla_dontaudit_rw_user_home_files(gpg_t)
+')
+
+optional_policy(`
+	mta_read_spool_files(gpg_t)
+	mta_write_config(gpg_t)
+')
+
+optional_policy(`
+	spamassassin_read_spamd_tmp_files(gpg_t)
 ')
 
 optional_policy(`
@@ -149,38 +169,29 @@
 	cron_read_system_job_tmp_files(gpg_t)
 ')
 
+optional_policy(`
+	xserver_use_xdm_fds(gpg_t)
+	xserver_rw_xdm_pipes(gpg_t)
+')
+
 ########################################
 #
-# GPG helper local policy
+# Helper local policy
 #
 
 allow gpg_helper_t self:process { getsched setsched };
-
-# for helper programs (which automatically fetch keys)
-# Note: this is only tested with the hkp interface. If you use eg the
-# mail interface you will likely need additional permissions.
-
 allow gpg_helper_t self:unix_stream_socket create_stream_socket_perms;
-allow gpg_helper_t self:tcp_socket { connect connected_socket_perms };
-allow gpg_helper_t self:udp_socket { connect connected_socket_perms };
 
-dontaudit gpg_helper_t gpg_secret_t:file read;
+dontaudit gpg_helper_t gpg_secret_t:file read_file_perms;
 
 corenet_all_recvfrom_unlabeled(gpg_helper_t)
 corenet_all_recvfrom_netlabel(gpg_helper_t)
 corenet_tcp_sendrecv_generic_if(gpg_helper_t)
-corenet_raw_sendrecv_generic_if(gpg_helper_t)
-corenet_udp_sendrecv_generic_if(gpg_helper_t)
 corenet_tcp_sendrecv_generic_node(gpg_helper_t)
-corenet_udp_sendrecv_generic_node(gpg_helper_t)
-corenet_raw_sendrecv_generic_node(gpg_helper_t)
 corenet_tcp_sendrecv_all_ports(gpg_helper_t)
-corenet_udp_sendrecv_all_ports(gpg_helper_t)
-corenet_tcp_bind_generic_node(gpg_helper_t)
-corenet_udp_bind_generic_node(gpg_helper_t)
-corenet_tcp_connect_all_ports(gpg_helper_t)
 
-files_read_etc_files(gpg_helper_t)
+corenet_sendrecv_all_client_packets(gpg_helper_t)
+corenet_tcp_connect_all_ports(gpg_helper_t)
 
 auth_use_nsswitch(gpg_helper_t)
 
@@ -196,33 +207,32 @@
 
 ########################################
 #
-# GPG agent local policy
+# Agent local policy
 #
 
-# rlimit: gpg-agent wants to prevent coredumps
 allow gpg_agent_t self:process setrlimit;
-
-allow gpg_agent_t self:unix_stream_socket create_stream_socket_perms ;
+allow gpg_agent_t self:unix_stream_socket { create_stream_socket_perms connectto };
 allow gpg_agent_t self:fifo_file rw_fifo_file_perms;
 
-# read and write ~/.gnupg (gpg-agent stores secret keys in ~/.gnupg/private-keys-v1.d )
 manage_dirs_pattern(gpg_agent_t, gpg_secret_t, gpg_secret_t)
+manage_sock_files_pattern(gpg_agent_t, gpg_secret_t, gpg_secret_t)
 manage_files_pattern(gpg_agent_t, gpg_secret_t, gpg_secret_t)
 manage_lnk_files_pattern(gpg_agent_t, gpg_secret_t, gpg_secret_t)
 
-# Allow the gpg-agent to manage its tmp files (socket)
 manage_dirs_pattern(gpg_agent_t, gpg_agent_tmp_t, gpg_agent_tmp_t)
 manage_files_pattern(gpg_agent_t, gpg_agent_tmp_t, gpg_agent_tmp_t)
 manage_sock_files_pattern(gpg_agent_t, gpg_agent_tmp_t, gpg_agent_tmp_t)
 files_tmp_filetrans(gpg_agent_t, gpg_agent_tmp_t, { file sock_file dir })
 
-# allow gpg to connect to the gpg agent
-stream_connect_pattern(gpg_t, gpg_agent_tmp_t, gpg_agent_tmp_t, gpg_agent_t)
+filetrans_pattern(gpg_agent_t, gpg_secret_t, gpg_agent_tmp_t, sock_file, "log-socket")
+
+domtrans_pattern(gpg_agent_t, pinentry_exec_t, gpg_pinentry_t)
+
+kernel_dontaudit_search_sysctl(gpg_agent_t)
 
-corecmd_read_bin_symlinks(gpg_agent_t)
-corecmd_search_bin(gpg_agent_t)
 corecmd_exec_shell(gpg_agent_t)
 
+dev_read_rand(gpg_agent_t)
 dev_read_urand(gpg_agent_t)
 
 domain_use_interactive_fds(gpg_agent_t)
@@ -231,9 +241,7 @@
 
 miscfiles_read_localization(gpg_agent_t)
 
-# Write to the user domain tty.
 userdom_use_user_terminals(gpg_agent_t)
-# read and write ~/.gnupg (gpg-agent stores secret keys in ~/.gnupg/private-keys-v1.d )
 userdom_search_user_home_dirs(gpg_agent_t)
 
 ifdef(`hide_broken_symptoms',`
@@ -241,12 +249,9 @@
 ')
 
 tunable_policy(`gpg_agent_env_file',`
-	# write ~/.gpg-agent-info or a similar to the users home dir
-	# or subdir (gpg-agent --write-env-file option)
-	#
-	userdom_user_home_dir_filetrans_user_home_content(gpg_agent_t, file)
 	userdom_manage_user_home_content_dirs(gpg_agent_t)
 	userdom_manage_user_home_content_files(gpg_agent_t)
+	userdom_user_home_dir_filetrans_user_home_content(gpg_agent_t, file)
 ')
 
 tunable_policy(`use_nfs_home_dirs',`
@@ -272,17 +277,8 @@
 
 allow gpg_pinentry_t self:process { getcap getsched setsched signal };
 allow gpg_pinentry_t self:fifo_file rw_fifo_file_perms;
-allow gpg_pinentry_t self:netlink_route_socket create_netlink_socket_perms;
 allow gpg_pinentry_t self:shm create_shm_perms;
-allow gpg_pinentry_t self:tcp_socket create_stream_socket_perms;
-allow gpg_pinentry_t self:unix_dgram_socket sendto;
-allow gpg_pinentry_t self:unix_stream_socket { connect create getattr read shutdown write };
-
-can_exec(gpg_pinentry_t, pinentry_exec_t)
-
-# we need to allow gpg-agent to call pinentry so it can get the passphrase
-# from the user.
-domtrans_pattern(gpg_agent_t, pinentry_exec_t, gpg_pinentry_t)
+allow gpg_pinentry_t self:tcp_socket { accept listen };
 
 manage_sock_files_pattern(gpg_pinentry_t, gpg_pinentry_tmp_t, gpg_pinentry_tmp_t)
 userdom_user_tmp_filetrans(gpg_pinentry_t, gpg_pinentry_tmp_t, sock_file)
@@ -291,29 +287,26 @@
 manage_files_pattern(gpg_pinentry_t, gpg_pinentry_tmpfs_t, gpg_pinentry_tmpfs_t)
 fs_tmpfs_filetrans(gpg_pinentry_t, gpg_pinentry_tmpfs_t, { file dir })
 
-# read /proc/meminfo
+can_exec(gpg_pinentry_t, pinentry_exec_t)
+
 kernel_read_system_state(gpg_pinentry_t)
 
+corecmd_exec_shell(gpg_pinentry_t)
 corecmd_exec_bin(gpg_pinentry_t)
 
 corenet_all_recvfrom_netlabel(gpg_pinentry_t)
 corenet_all_recvfrom_unlabeled(gpg_pinentry_t)
-corenet_sendrecv_pulseaudio_client_packets(gpg_pinentry_t)
-corenet_tcp_bind_generic_node(gpg_pinentry_t)
-corenet_tcp_connect_pulseaudio_port(gpg_pinentry_t)
 corenet_tcp_sendrecv_generic_if(gpg_pinentry_t)
 corenet_tcp_sendrecv_generic_node(gpg_pinentry_t)
-corenet_tcp_sendrecv_generic_port(gpg_pinentry_t)
 
 dev_read_urand(gpg_pinentry_t)
 dev_read_rand(gpg_pinentry_t)
 
+domain_use_interactive_fds(gpg_pinentry_t)
+
 files_read_usr_files(gpg_pinentry_t)
-# read /etc/X11/qtrc
-files_read_etc_files(gpg_pinentry_t)
 
 fs_dontaudit_list_inotifyfs(gpg_pinentry_t)
-fs_getattr_tmpfs(gpg_pinentry_t)
 
 auth_use_nsswitch(gpg_pinentry_t)
 
@@ -322,9 +315,15 @@
 miscfiles_read_fonts(gpg_pinentry_t)
 miscfiles_read_localization(gpg_pinentry_t)
 
-# for .Xauthority
-userdom_read_user_home_content_files(gpg_pinentry_t)
-userdom_read_user_tmpfs_files(gpg_pinentry_t)
+userdom_use_user_terminals(gpg_pinentry_t)
+
+ifdef(`distro_gentoo',`
+	optional_policy(`
+		mutt_read_home_files(gpg_t)
+		mutt_read_tmp_files(gpg_t)
+		mutt_rw_tmp_files(gpg_t)
+	')
+')
 
 tunable_policy(`use_nfs_home_dirs',`
 	fs_read_nfs_files(gpg_pinentry_t)
@@ -335,16 +334,12 @@
 ')
 
 optional_policy(`
-	dbus_session_bus_client(gpg_pinentry_t)
+	dbus_all_session_bus_client(gpg_pinentry_t)
 	dbus_system_bus_client(gpg_pinentry_t)
 ')
 
 optional_policy(`
-	pulseaudio_exec(gpg_pinentry_t)
-	pulseaudio_rw_home_files(gpg_pinentry_t)
-	pulseaudio_setattr_home_dir(gpg_pinentry_t)
-	pulseaudio_stream_connect(gpg_pinentry_t)
-	pulseaudio_signull(gpg_pinentry_t)
+	pulseaudio_run(gpg_pinentry_t, gpg_pinentry_roles)
 ')
 
 optional_policy(`
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/gpm.fc refpolicy/policy/modules/contrib/gpm.fc
--- refpolicy/policy/modules/contrib/gpm.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/gpm.fc	2012-10-04 19:31:58.999376368 +0200
@@ -1,7 +1,11 @@
+/dev/gpmctl	-s	gen_context(system_u:object_r:gpmctl_t,s0)
+/dev/gpmdata	-p	gen_context(system_u:object_r:gpmctl_t,s0)
 
-/dev/gpmctl		-s	gen_context(system_u:object_r:gpmctl_t,s0)
-/dev/gpmdata		-p	gen_context(system_u:object_r:gpmctl_t,s0)
+/etc/gpm(/.*)?	gen_context(system_u:object_r:gpm_conf_t,s0)
+/etc/gpm-.*\.conf	--	gen_context(system_u:object_r:gpm_conf_t,s0)
 
-/etc/gpm(/.*)?			gen_context(system_u:object_r:gpm_conf_t,s0)
+/etc/rc\.d/init\.d/gpm	--	gen_context(system_u:object_r:gpm_initrc_exec_t,s0)
 
-/usr/sbin/gpm		--	gen_context(system_u:object_r:gpm_exec_t,s0)
+/usr/sbin/gpm	--	gen_context(system_u:object_r:gpm_exec_t,s0)
+
+/var/run/gpm\.pid	--	gen_context(system_u:object_r:gpm_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/gpm.if refpolicy/policy/modules/contrib/gpm.if
--- refpolicy/policy/modules/contrib/gpm.if	2012-05-04 15:16:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/gpm.if	2012-10-04 19:31:50.946376351 +0200
@@ -1,4 +1,4 @@
-## <summary>General Purpose Mouse driver</summary>
+## <summary>General Purpose Mouse driver.</summary>
 
 ########################################
 ## <summary>
@@ -16,14 +16,14 @@
 		type gpmctl_t, gpm_t;
 	')
 
-	allow $1 gpmctl_t:sock_file rw_sock_file_perms;
-	allow $1 gpm_t:unix_stream_socket connectto;
+	dev_list_all_dev_nodes($1)
+	stream_connect_pattern($1, gpmctl_t, gpmctl_t, gpm_t)
 ')
 
 ########################################
 ## <summary>
-##	Get the attributes of the GPM
-##	control channel named socket.
+##	Get attributes of gpm control
+##	channel named sock files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -37,14 +37,14 @@
 	')
 
 	dev_list_all_dev_nodes($1)
-	allow $1 gpmctl_t:sock_file getattr;
+	allow $1 gpmctl_t:sock_file getattr_sock_file_perms;
 ')
 
 ########################################
 ## <summary>
-##	Do not audit attempts to get the 
-##	attributes of the GPM control channel
-##	named socket.
+##	Do not audit attempts to get
+##	attributes of gpm control channel
+##	named sock files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -57,13 +57,13 @@
 		type gpmctl_t;
 	')
 
-	dontaudit $1 gpmctl_t:sock_file getattr;
+	dontaudit $1 gpmctl_t:sock_file getattr_sock_file_perms;
 ')
 
 ########################################
 ## <summary>
-##	Set the attributes of the GPM
-##	control channel named socket.
+##	Set attributes of gpm control
+##	channel named sock files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -77,5 +77,46 @@
 	')
 
 	dev_list_all_dev_nodes($1)
-	allow $1 gpmctl_t:sock_file setattr;
+	allow $1 gpmctl_t:sock_file setattr_sock_file_perms;
+')
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an gpm environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`gpm_admin',`
+	gen_require(`
+		type gpm_t, gpm_conf_t, gpm_initrc_exec_t;
+		type gpm_var_run_t, gpmctl_t;
+	')
+
+	allow $1 gpm_t:process { ptrace signal_perms };
+	ps_process_pattern($1, gpm_t)
+
+	init_labeled_script_domtrans($1, gpm_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 gpm_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	files_search_etc($1)
+	admin_pattern($1, gpm_conf_t)
+
+	dev_list_all_dev_nodes($1)
+	admin_pattern($1, gpmctl_t)
+
+	files_search_pids($1)
+	admin_pattern($1, gpm_var_run_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/gpm.te refpolicy/policy/modules/contrib/gpm.te
--- refpolicy/policy/modules/contrib/gpm.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/gpm.te	2012-10-10 21:33:59.918026164 +0200
@@ -1,4 +1,4 @@
-policy_module(gpm, 1.8.0)
+policy_module(gpm, 1.8.2)
 
 ########################################
 #
@@ -9,6 +9,9 @@
 type gpm_exec_t;
 init_daemon_domain(gpm_t, gpm_exec_t)
 
+type gpm_initrc_exec_t;
+init_script_file(gpm_initrc_exec_t)
+
 type gpm_conf_t;
 files_type(gpm_conf_t)
 
@@ -27,8 +30,8 @@
 #
 
 allow gpm_t self:capability { setpcap setuid dac_override sys_admin sys_tty_config };
-allow gpm_t self:process { getcap setcap };
-allow gpm_t self:unix_stream_socket create_stream_socket_perms;
+allow gpm_t self:process { signal signull getcap setcap };
+allow gpm_t self:unix_stream_socket { accept listen };
 
 allow gpm_t gpm_conf_t:dir list_dir_perms;
 read_files_pattern(gpm_t, gpm_conf_t, gpm_conf_t)
@@ -67,6 +70,7 @@
 
 miscfiles_read_localization(gpm_t)
 
+userdom_use_user_terminals(gpm_t)
 userdom_dontaudit_use_unpriv_user_fds(gpm_t)
 userdom_dontaudit_search_user_home_dirs(gpm_t)
 
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/gpsd.fc refpolicy/policy/modules/contrib/gpsd.fc
--- refpolicy/policy/modules/contrib/gpsd.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/gpsd.fc	2012-10-04 19:31:58.999376368 +0200
@@ -1,6 +1,6 @@
 /etc/rc\.d/init\.d/gpsd	--	gen_context(system_u:object_r:gpsd_initrc_exec_t,s0)
 
-/usr/sbin/gpsd		--	gen_context(system_u:object_r:gpsd_exec_t,s0)
+/usr/sbin/gpsd	--	gen_context(system_u:object_r:gpsd_exec_t,s0)
 
 /var/run/gpsd\.pid	--	gen_context(system_u:object_r:gpsd_var_run_t,s0)
 /var/run/gpsd\.sock	-s	gen_context(system_u:object_r:gpsd_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/gpsd.if refpolicy/policy/modules/contrib/gpsd.if
--- refpolicy/policy/modules/contrib/gpsd.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/gpsd.if	2012-10-04 19:31:58.999376368 +0200
@@ -1,4 +1,4 @@
-## <summary>gpsd monitor daemon</summary>
+## <summary>gpsd monitor daemon.</summary>
 
 ########################################
 ## <summary>
@@ -15,6 +15,7 @@
 		type gpsd_t, gpsd_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, gpsd_exec_t, gpsd_t)
 ')
 
@@ -36,11 +37,11 @@
 #
 interface(`gpsd_run',`
 	gen_require(`
-		type gpsd_t;
+		attribute_role gpsd_roles;
 	')
 
 	gpsd_domtrans($1)
-	role $2 types gpsd_t;
+	roleattribute $2 gpsd_roles;
 ')
 
 ########################################
@@ -64,3 +65,39 @@
 	read_lnk_files_pattern($1, gpsd_tmpfs_t, gpsd_tmpfs_t)
 	fs_search_tmpfs($1)
 ')
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an gpsd environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`gpsd_admin',`
+	gen_require(`
+		type gpsd_t, gpsd_initrc_exec_t, gpsd_var_run_t;
+	')
+
+	allow $1 gpsd_t:process { ptrace signal_perms };
+	ps_process_pattern($1, gpsd_t)
+
+	init_labeled_script_domtrans($1, gpsd_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 gpsd_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	files_search_pids($1)
+	admin_pattern($1, gpsd_var_run_t)
+
+	gpsd_run($1, $2)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/gpsd.te refpolicy/policy/modules/contrib/gpsd.te
--- refpolicy/policy/modules/contrib/gpsd.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/gpsd.te	2012-10-04 19:31:59.018376368 +0200
@@ -1,14 +1,17 @@
-policy_module(gpsd, 1.1.0)
+policy_module(gpsd, 1.1.1)
 
 ########################################
 #
 # Declarations
 #
 
+attribute_role gpsd_roles;
+
 type gpsd_t;
 type gpsd_exec_t;
 application_domain(gpsd_t, gpsd_exec_t)
 init_daemon_domain(gpsd_t, gpsd_exec_t)
+role gpsd_roles types gpsd_t;
 
 type gpsd_initrc_exec_t;
 init_script_file(gpsd_initrc_exec_t)
@@ -21,14 +24,15 @@
 
 ########################################
 #
-# gpsd local policy
+# Local policy
 #
 
-allow gpsd_t self:capability { fowner fsetid setuid setgid sys_nice sys_tty_config };
-allow gpsd_t self:process setsched;
+allow gpsd_t self:capability { fowner fsetid setuid setgid sys_nice sys_time sys_tty_config };
+dontaudit gpsd_t self:capability { dac_read_search dac_override };
+allow gpsd_t self:process { setsched signal_perms };
 allow gpsd_t self:shm create_shm_perms;
-allow gpsd_t self:unix_dgram_socket { create_socket_perms sendto };
-allow gpsd_t self:tcp_socket create_stream_socket_perms;
+allow gpsd_t self:unix_dgram_socket sendto;
+allow gpsd_t self:tcp_socket { accept listen };
 
 manage_dirs_pattern(gpsd_t, gpsd_tmpfs_t, gpsd_tmpfs_t)
 manage_files_pattern(gpsd_t, gpsd_tmpfs_t, gpsd_tmpfs_t)
@@ -38,13 +42,23 @@
 manage_sock_files_pattern(gpsd_t, gpsd_var_run_t, gpsd_var_run_t)
 files_pid_filetrans(gpsd_t, gpsd_var_run_t, { file sock_file })
 
+kernel_list_proc(gpsd_t)
+kernel_request_load_module(gpsd_t)
+
 corenet_all_recvfrom_unlabeled(gpsd_t)
 corenet_all_recvfrom_netlabel(gpsd_t)
 corenet_tcp_sendrecv_generic_if(gpsd_t)
 corenet_tcp_sendrecv_generic_node(gpsd_t)
-corenet_tcp_sendrecv_all_ports(gpsd_t)
 corenet_tcp_bind_all_nodes(gpsd_t)
+
+corenet_sendrecv_gpsd_server_packets(gpsd_t)
 corenet_tcp_bind_gpsd_port(gpsd_t)
+corenet_tcp_sendrecv_gpsd_port(gpsd_t)
+
+dev_read_sysfs(gpsd_t)
+dev_rw_realtime_clock(gpsd_t)
+
+domain_dontaudit_read_all_domains_state(gpsd_t)
 
 term_use_unallocated_ttys(gpsd_t)
 term_setattr_unallocated_ttys(gpsd_t)
@@ -56,6 +70,12 @@
 miscfiles_read_localization(gpsd_t)
 
 optional_policy(`
+	chronyd_rw_shm(gpsd_t)
+	chronyd_stream_connect(gpsd_t)
+	chronyd_dgram_send(gpsd_t)
+')
+
+optional_policy(`
 	dbus_system_bus_client(gpsd_t)
 ')
 
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/guest.if refpolicy/policy/modules/contrib/guest.if
--- refpolicy/policy/modules/contrib/guest.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/guest.if	2012-10-04 19:32:05.920376383 +0200
@@ -1,4 +1,4 @@
-## <summary>Least privledge terminal user role</summary>
+## <summary>Least privledge terminal user role.</summary>
 
 ########################################
 ## <summary>
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/guest.te refpolicy/policy/modules/contrib/guest.te
--- refpolicy/policy/modules/contrib/guest.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/guest.te	2012-10-04 19:32:05.920376383 +0200
@@ -1,4 +1,4 @@
-policy_module(guest, 1.2.0)
+policy_module(guest, 1.2.1)
 
 ########################################
 #
@@ -9,9 +9,15 @@
 
 userdom_restricted_user_template(guest)
 
+kernel_read_system_state(guest_t)
+
 ########################################
 #
 # Local policy
 #
 
-#gen_user(guest_u,, guest_r, s0, s0)
+optional_policy(`
+	apache_role(guest_r, guest_t)
+')
+
+#gen_user(guest_u, user, guest_r, s0, s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/hadoop.fc refpolicy/policy/modules/contrib/hadoop.fc
--- refpolicy/policy/modules/contrib/hadoop.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/hadoop.fc	2012-10-06 17:47:58.819731880 +0200
@@ -1,59 +1,53 @@
-/etc/hadoop.*							gen_context(system_u:object_r:hadoop_etc_t,s0)
+/etc/hadoop.*	gen_context(system_u:object_r:hadoop_etc_t,s0)
 
-/etc/init\.d/hadoop-(.*-)?datanode			--	gen_context(system_u:object_r:hadoop_datanode_initrc_exec_t,s0)
-/etc/init\.d/hadoop-(.*-)?jobtracker			--	gen_context(system_u:object_r:hadoop_jobtracker_initrc_exec_t,s0)
-/etc/init\.d/hadoop-(.*-)?namenode			--	gen_context(system_u:object_r:hadoop_namenode_initrc_exec_t,s0)
-/etc/init\.d/hadoop-(.*-)?secondarynamenode		--	gen_context(system_u:object_r:hadoop_secondarynamenode_initrc_exec_t,s0)
-/etc/init\.d/hadoop-(.*-)?tasktracker			--	gen_context(system_u:object_r:hadoop_tasktracker_initrc_exec_t,s0)
-/etc/init\.d/zookeeper					--	gen_context(system_u:object_r:zookeeper_server_initrc_exec_t,s0)
-
-/etc/rc\.d/init\.d/hadoop-(.*-)?datanode		--	gen_context(system_u:object_r:hadoop_datanode_initrc_exec_t,s0)
-/etc/rc\.d/init\.d/hadoop-(.*-)?jobtracker		--	gen_context(system_u:object_r:hadoop_jobtracker_initrc_exec_t,s0)
-/etc/rc\.d/init\.d/hadoop-(.*-)?namenode		--	gen_context(system_u:object_r:hadoop_namenode_initrc_exec_t,s0)
+/etc/rc\.d/init\.d/hadoop-(.*-)?datanode	--	gen_context(system_u:object_r:hadoop_datanode_initrc_exec_t,s0)
+/etc/rc\.d/init\.d/hadoop-(.*-)?jobtracker	--	gen_context(system_u:object_r:hadoop_jobtracker_initrc_exec_t,s0)
+/etc/rc\.d/init\.d/hadoop-(.*-)?namenode	--	gen_context(system_u:object_r:hadoop_namenode_initrc_exec_t,s0)
 /etc/rc\.d/init\.d/hadoop-(.*-)?secondarynamenode	--	gen_context(system_u:object_r:hadoop_secondarynamenode_initrc_exec_t,s0)
-/etc/rc\.d/init\.d/hadoop-(.*-)?tasktracker		--	gen_context(system_u:object_r:hadoop_tasktracker_initrc_exec_t,s0)
-/etc/rc\.d/init\.d/hadoop-zookeeper			--	gen_context(system_u:object_r:zookeeper_server_initrc_exec_t,s0)
-
-/etc/zookeeper(/.*)?						gen_context(system_u:object_r:zookeeper_etc_t,s0)
-/etc/zookeeper\.dist(/.*)?					gen_context(system_u:object_r:zookeeper_etc_t,s0)
-
-/usr/lib/hadoop.*/bin/hadoop				--	gen_context(system_u:object_r:hadoop_exec_t,s0)
-
-/usr/bin/zookeeper-client				--	gen_context(system_u:object_r:zookeeper_exec_t,s0)
-/usr/bin/zookeeper-server				--	gen_context(system_u:object_r:zookeeper_server_exec_t,s0)
-
-/var/lib/hadoop.*						gen_context(system_u:object_r:hadoop_var_lib_t,s0)
-/var/lib/hadoop.*/cache/hadoop/dfs/data(/.*)?			gen_context(system_u:object_r:hadoop_datanode_var_lib_t,s0)
-/var/lib/hadoop.*/cache/hadoop/dfs/name(/.*)?			gen_context(system_u:object_r:hadoop_namenode_var_lib_t,s0)
-/var/lib/hadoop.*/cache/hadoop/dfs/namesecondary(/.*)?		gen_context(system_u:object_r:hadoop_secondarynamenode_var_lib_t,s0)
+/etc/rc\.d/init\.d/hadoop-(.*-)?tasktracker	--	gen_context(system_u:object_r:hadoop_tasktracker_initrc_exec_t,s0)
+/etc/rc\.d/init\.d/hadoop-zookeeper	--	gen_context(system_u:object_r:zookeeper_server_initrc_exec_t,s0)
+/etc/rc\.d/init\.d/zookeeper	--	gen_context(system_u:object_r:zookeeper_server_initrc_exec_t,s0)
+
+/etc/zookeeper(/.*)?	gen_context(system_u:object_r:zookeeper_etc_t,s0)
+/etc/zookeeper\.dist(/.*)?	gen_context(system_u:object_r:zookeeper_etc_t,s0)
+
+/usr/lib/hadoop.*/bin/hadoop	--	gen_context(system_u:object_r:hadoop_exec_t,s0)
+
+/usr/bin/zookeeper-client	--	gen_context(system_u:object_r:zookeeper_exec_t,s0)
+/usr/bin/zookeeper-server	--	gen_context(system_u:object_r:zookeeper_server_exec_t,s0)
+
+/var/lib/hadoop.*	gen_context(system_u:object_r:hadoop_var_lib_t,s0)
+/var/lib/hadoop.*/cache/hadoop/dfs/data(/.*)?	gen_context(system_u:object_r:hadoop_datanode_var_lib_t,s0)
+/var/lib/hadoop.*/cache/hadoop/dfs/name(/.*)?	gen_context(system_u:object_r:hadoop_namenode_var_lib_t,s0)
+/var/lib/hadoop.*/cache/hadoop/dfs/namesecondary(/.*)?	gen_context(system_u:object_r:hadoop_secondarynamenode_var_lib_t,s0)
 /var/lib/hadoop.*/cache/hadoop/mapred/local/jobTracker(/.*)?	gen_context(system_u:object_r:hadoop_jobtracker_var_lib_t,s0)
 /var/lib/hadoop.*/cache/hadoop/mapred/local/taskTracker(/.*)?	gen_context(system_u:object_r:hadoop_tasktracker_var_lib_t,s0)
-/var/lib/hadoop.*/cache/hdfs/dfs/data(/.*)?			gen_context(system_u:object_r:hadoop_datanode_var_lib_t,s0)
-/var/lib/hadoop.*/cache/hdfs/dfs/namesecondary(/.*)?		gen_context(system_u:object_r:hadoop_secondarynamenode_var_lib_t,s0)
+/var/lib/hadoop.*/cache/hdfs/dfs/data(/.*)?	gen_context(system_u:object_r:hadoop_datanode_var_lib_t,s0)
+/var/lib/hadoop.*/cache/hdfs/dfs/namesecondary(/.*)?	gen_context(system_u:object_r:hadoop_secondarynamenode_var_lib_t,s0)
 /var/lib/hadoop.*/cache/mapred/mapred/local/jobTracker(/.*)?	gen_context(system_u:object_r:hadoop_jobtracker_var_lib_t,s0)
 /var/lib/hadoop.*/cache/mapred/mapred/local/taskTracker(/.*)?	gen_context(system_u:object_r:hadoop_tasktracker_var_lib_t,s0)
-/var/lib/zookeeper(/.*)?					gen_context(system_u:object_r:zookeeper_server_var_t,s0)
+/var/lib/zookeeper(/.*)?	gen_context(system_u:object_r:zookeeper_server_var_t,s0)
 
-/var/lock/subsys/hadoop-datanode			--	gen_context(system_u:object_r:hadoop_datanode_lock_t,s0)
-/var/lock/subsys/hadoop-jobtracker			--	gen_context(system_u:object_r:hadoop_jobtracker_lock_t,s0)
-/var/lock/subsys/hadoop-namenode			--	gen_context(system_u:object_r:hadoop_namenode_lock_t,s0)
-/var/lock/subsys/hadoop-secondarynamenode		--	gen_context(system_u:object_r:hadoop_secondarynamenode_lock_t,s0)
-/var/lock/subsys/hadoop-tasktracker			--	gen_context(system_u:object_r:hadoop_tasktracker_lock_t,s0)
-
-/var/log/hadoop.*						gen_context(system_u:object_r:hadoop_log_t,s0)
-/var/log/hadoop.*/hadoop-hadoop-datanode(-.*)?			gen_context(system_u:object_r:hadoop_datanode_log_t,s0)
-/var/log/hadoop.*/hadoop-hadoop-jobtracker(-.*)?		gen_context(system_u:object_r:hadoop_jobtracker_log_t,s0)
-/var/log/hadoop.*/hadoop-hadoop-namenode(-.*)?			gen_context(system_u:object_r:hadoop_namenode_log_t,s0)
-/var/log/hadoop.*/hadoop-hadoop-secondarynamenode(-.*)?		gen_context(system_u:object_r:hadoop_secondarynamenode_log_t,s0)
-/var/log/hadoop.*/hadoop-hadoop-tasktracker(-.*)?		gen_context(system_u:object_r:hadoop_tasktracker_log_t,s0)
-/var/log/hadoop.*/history(/.*)?					gen_context(system_u:object_r:hadoop_jobtracker_log_t,s0)
-/var/log/zookeeper(/.*)?					gen_context(system_u:object_r:zookeeper_log_t,s0)
-
-/var/run/hadoop.*					-d	gen_context(system_u:object_r:hadoop_var_run_t,s0)
-/var/run/hadoop.*/hadoop-hadoop-datanode\.pid		--	gen_context(system_u:object_r:hadoop_datanode_initrc_var_run_t,s0)
-/var/run/hadoop.*/hadoop-hadoop-jobtracker\.pid		--	gen_context(system_u:object_r:hadoop_jobtracker_initrc_var_run_t,s0)
-/var/run/hadoop.*/hadoop-hadoop-namenode\.pid		--	gen_context(system_u:object_r:hadoop_namenode_initrc_var_run_t,s0)
+/var/lock/subsys/hadoop-datanode	--	gen_context(system_u:object_r:hadoop_datanode_lock_t,s0)
+/var/lock/subsys/hadoop-jobtracker	--	gen_context(system_u:object_r:hadoop_jobtracker_lock_t,s0)
+/var/lock/subsys/hadoop-namenode	--	gen_context(system_u:object_r:hadoop_namenode_lock_t,s0)
+/var/lock/subsys/hadoop-secondarynamenode	--	gen_context(system_u:object_r:hadoop_secondarynamenode_lock_t,s0)
+/var/lock/subsys/hadoop-tasktracker	--	gen_context(system_u:object_r:hadoop_tasktracker_lock_t,s0)
+
+/var/log/hadoop.*	gen_context(system_u:object_r:hadoop_log_t,s0)
+/var/log/hadoop.*/hadoop-hadoop-datanode(-.*)?	gen_context(system_u:object_r:hadoop_datanode_log_t,s0)
+/var/log/hadoop.*/hadoop-hadoop-jobtracker(-.*)?	gen_context(system_u:object_r:hadoop_jobtracker_log_t,s0)
+/var/log/hadoop.*/hadoop-hadoop-namenode(-.*)?	gen_context(system_u:object_r:hadoop_namenode_log_t,s0)
+/var/log/hadoop.*/hadoop-hadoop-secondarynamenode(-.*)?	gen_context(system_u:object_r:hadoop_secondarynamenode_log_t,s0)
+/var/log/hadoop.*/hadoop-hadoop-tasktracker(-.*)?	gen_context(system_u:object_r:hadoop_tasktracker_log_t,s0)
+/var/log/hadoop.*/history(/.*)?	gen_context(system_u:object_r:hadoop_jobtracker_log_t,s0)
+/var/log/zookeeper(/.*)?	gen_context(system_u:object_r:zookeeper_log_t,s0)
+
+/var/run/hadoop.*	-d	gen_context(system_u:object_r:hadoop_var_run_t,s0)
+/var/run/hadoop.*/hadoop-hadoop-datanode\.pid	--	gen_context(system_u:object_r:hadoop_datanode_initrc_var_run_t,s0)
+/var/run/hadoop.*/hadoop-hadoop-jobtracker\.pid	--	gen_context(system_u:object_r:hadoop_jobtracker_initrc_var_run_t,s0)
+/var/run/hadoop.*/hadoop-hadoop-namenode\.pid	--	gen_context(system_u:object_r:hadoop_namenode_initrc_var_run_t,s0)
 /var/run/hadoop.*/hadoop-hadoop-secondarynamenode\.pid	--	gen_context(system_u:object_r:hadoop_secondarynamenode_initrc_var_run_t,s0)
 /var/run/hadoop.*/hadoop-hadoop-tasktracker\.pid	--	gen_context(system_u:object_r:hadoop_tasktracker_initrc_var_run_t,s0)
 
-/var/zookeeper(/.*)?						gen_context(system_u:object_r:zookeeper_server_var_t,s0)
+/var/zookeeper(/.*)?	gen_context(system_u:object_r:zookeeper_server_var_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/hadoop.if refpolicy/policy/modules/contrib/hadoop.if
--- refpolicy/policy/modules/contrib/hadoop.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/hadoop.if	2012-10-08 20:11:44.381033617 +0200
@@ -12,14 +12,16 @@
 #
 template(`hadoop_domain_template',`
 	gen_require(`
-		attribute hadoop_domain;
+		attribute hadoop_domain, hadoop_initrc_domain, hadoop_init_script_file;
+		attribute hadoop_pid_file, hadoop_lock_file, hadoop_log_file;
+		attribute hadoop_tmp_file, hadoop_var_lib_file;
 		type hadoop_log_t, hadoop_var_lib_t, hadoop_var_run_t;
 		type hadoop_exec_t, hadoop_hsperfdata_t;
 	')
 
 	########################################
 	#
-	# Shared declarations.
+	# Declarations
 	#
 
 	type hadoop_$1_t, hadoop_domain;
@@ -27,177 +29,63 @@
 	domain_entry_file(hadoop_$1_t, hadoop_exec_t)
 	role system_r types hadoop_$1_t;
 
-	type hadoop_$1_initrc_t;
-	type hadoop_$1_initrc_exec_t;
+	type hadoop_$1_initrc_t, hadoop_initrc_domain;
+	type hadoop_$1_initrc_exec_t, hadoop_init_script_file;
 	init_script_domain(hadoop_$1_initrc_t, hadoop_$1_initrc_exec_t)
 	role system_r types hadoop_$1_initrc_t;
 
-	type hadoop_$1_initrc_var_run_t;
+	type hadoop_$1_initrc_var_run_t, hadoop_pid_file;
 	files_pid_file(hadoop_$1_initrc_var_run_t)
 
-	type hadoop_$1_lock_t;
+	type hadoop_$1_lock_t, hadoop_lock_file;
 	files_lock_file(hadoop_$1_lock_t)
 
-	type hadoop_$1_log_t;
+	type hadoop_$1_log_t, hadoop_log_file;
 	logging_log_file(hadoop_$1_log_t)
 
-	type hadoop_$1_tmp_t;
+	type hadoop_$1_tmp_t, hadoop_tmp_file;
 	files_tmp_file(hadoop_$1_tmp_t)
 
-	type hadoop_$1_var_lib_t;
+	type hadoop_$1_var_lib_t, hadoop_var_lib_file;
 	files_type(hadoop_$1_var_lib_t)
 
 	####################################
 	#
-	# Shared hadoop_$1 policy.
+	# hadoop_domain policy
 	#
 
-	allow hadoop_$1_t self:capability { chown kill setgid setuid };
-	allow hadoop_$1_t self:process { execmem getsched setsched sigkill signal };
-	allow hadoop_$1_t self:key search;
-	allow hadoop_$1_t self:fifo_file rw_fifo_file_perms;
-	allow hadoop_$1_t self:unix_dgram_socket create_socket_perms;
-	allow hadoop_$1_t self:tcp_socket create_stream_socket_perms;
-	allow hadoop_$1_t self:udp_socket create_socket_perms;
-	dontaudit hadoop_$1_t self:netlink_route_socket rw_netlink_socket_perms;
-
-	allow hadoop_$1_t hadoop_domain:process signull;
-
 	manage_files_pattern(hadoop_$1_t, hadoop_$1_log_t, hadoop_$1_log_t)
 	filetrans_pattern(hadoop_$1_t, hadoop_log_t, hadoop_$1_log_t, { dir file })
-	logging_search_logs(hadoop_$1_t)
 
 	manage_dirs_pattern(hadoop_$1_t, hadoop_$1_var_lib_t, hadoop_$1_var_lib_t)
 	manage_files_pattern(hadoop_$1_t, hadoop_$1_var_lib_t, hadoop_$1_var_lib_t)
 	filetrans_pattern(hadoop_$1_t, hadoop_var_lib_t, hadoop_$1_var_lib_t, file)
-	files_search_var_lib(hadoop_$1_t)
 
 	manage_files_pattern(hadoop_$1_t, hadoop_$1_initrc_var_run_t, hadoop_$1_initrc_var_run_t)
 	filetrans_pattern(hadoop_$1_t, hadoop_var_run_t, hadoop_$1_initrc_var_run_t, file)
-	files_search_pids(hadoop_$1_t)
 
-	allow hadoop_$1_t hadoop_hsperfdata_t:dir manage_dir_perms;
 	manage_files_pattern(hadoop_$1_t, hadoop_$1_tmp_t, hadoop_$1_tmp_t)
 	filetrans_pattern(hadoop_$1_t, hadoop_hsperfdata_t, hadoop_$1_tmp_t, file)
-	files_tmp_filetrans(hadoop_$1_t, hadoop_hsperfdata_t, dir)
-
-	kernel_read_kernel_sysctls(hadoop_$1_t)
-	kernel_read_sysctl(hadoop_$1_t)
-	kernel_read_network_state(hadoop_$1_t)
-	kernel_read_system_state(hadoop_$1_t)
-
-	corecmd_exec_bin(hadoop_$1_t)
-	corecmd_exec_shell(hadoop_$1_t)
-
-	corenet_all_recvfrom_unlabeled(hadoop_$1_t)
-	corenet_all_recvfrom_netlabel(hadoop_$1_t)
-	corenet_tcp_bind_all_nodes(hadoop_$1_t)
-	corenet_tcp_sendrecv_generic_if(hadoop_$1_t)
-	corenet_udp_sendrecv_generic_if(hadoop_$1_t)
-	corenet_tcp_sendrecv_generic_node(hadoop_$1_t)
-	corenet_udp_sendrecv_generic_node(hadoop_$1_t)
-	corenet_tcp_sendrecv_all_ports(hadoop_$1_t)
-	corenet_udp_bind_generic_node(hadoop_$1_t)
-	# Hadoop uses high ordered random ports for services
-	# If permanent ports are chosen, remove line below and lock down
-	corenet_tcp_connect_generic_port(hadoop_$1_t)
-
-	dev_read_rand(hadoop_$1_t)
-	dev_read_urand(hadoop_$1_t)
-	dev_read_sysfs(hadoop_$1_t)
-
-	files_read_etc_files(hadoop_$1_t)
-
-	auth_domtrans_chkpwd(hadoop_$1_t)
-
-	hadoop_match_lan_spd(hadoop_$1_t)
 
-	init_read_utmp(hadoop_$1_t)
-	init_use_fds(hadoop_$1_t)
-	init_use_script_fds(hadoop_$1_t)
-	init_use_script_ptys(hadoop_$1_t)
-
-	logging_send_audit_msgs(hadoop_$1_t)
-	logging_send_syslog_msg(hadoop_$1_t)
-
-	miscfiles_read_localization(hadoop_$1_t)
-
-	sysnet_read_config(hadoop_$1_t)
-
-	hadoop_exec_config(hadoop_$1_t)
-
-	java_exec(hadoop_$1_t)
-
-	kerberos_use(hadoop_$1_t)
-
-	su_exec(hadoop_$1_t)
-
-	optional_policy(`
-		nscd_socket_use(hadoop_$1_t)
-	')
+	auth_use_nsswitch(hadoop_$1_t)
 
 	####################################
 	#
-	# Shared hadoop_$1 initrc policy.
+	# hadoop_initrc_domain policy
 	#
 
-	allow hadoop_$1_initrc_t self:capability { setuid setgid };
-	dontaudit hadoop_$1_initrc_t self:capability sys_tty_config;
-	allow hadoop_$1_initrc_t self:process setsched;
-	allow hadoop_$1_initrc_t self:fifo_file rw_fifo_file_perms;
-
 	allow hadoop_$1_initrc_t hadoop_$1_t:process { signal signull };
 
 	domtrans_pattern(hadoop_$1_initrc_t, hadoop_exec_t, hadoop_$1_t)
 
 	manage_files_pattern(hadoop_$1_initrc_t, hadoop_$1_lock_t, hadoop_$1_lock_t)
 	files_lock_filetrans(hadoop_$1_initrc_t, hadoop_$1_lock_t, file)
-	files_search_locks(hadoop_$1_initrc_t)
 
 	manage_files_pattern(hadoop_$1_initrc_t, hadoop_$1_initrc_var_run_t, hadoop_$1_initrc_var_run_t)
 	filetrans_pattern(hadoop_$1_initrc_t, hadoop_var_run_t, hadoop_$1_initrc_var_run_t, file)
-	files_search_pids(hadoop_$1_initrc_t)
 
 	manage_files_pattern(hadoop_$1_initrc_t, hadoop_$1_log_t, hadoop_$1_log_t)
 	filetrans_pattern(hadoop_$1_initrc_t, hadoop_log_t, hadoop_$1_log_t, { dir file })
-	logging_search_logs(hadoop_$1_initrc_t)
-
-	manage_dirs_pattern(hadoop_$1_initrc_t, hadoop_var_run_t, hadoop_var_run_t)
-	manage_files_pattern(hadoop_$1_initrc_t, hadoop_var_run_t, hadoop_var_run_t)
-
-	kernel_read_kernel_sysctls(hadoop_$1_initrc_t)
-	kernel_read_sysctl(hadoop_$1_initrc_t)
-	kernel_read_system_state(hadoop_$1_initrc_t)
-
-	corecmd_exec_bin(hadoop_$1_initrc_t)
-	corecmd_exec_shell(hadoop_$1_initrc_t)
-
-	files_read_etc_files(hadoop_$1_initrc_t)
-	files_read_usr_files(hadoop_$1_initrc_t)
-
-	consoletype_exec(hadoop_$1_initrc_t)
-
-	fs_getattr_xattr_fs(hadoop_$1_initrc_t)
-	fs_search_cgroup_dirs(hadoop_$1_initrc_t)
-
-	term_use_generic_ptys(hadoop_$1_initrc_t)
-
-	hadoop_exec_config(hadoop_$1_initrc_t)
-
-	init_rw_utmp(hadoop_$1_initrc_t)
-	init_use_fds(hadoop_$1_initrc_t)
-	init_use_script_ptys(hadoop_$1_initrc_t)
-
-	logging_send_syslog_msg(hadoop_$1_initrc_t)
-	logging_send_audit_msgs(hadoop_$1_initrc_t)
-
-	miscfiles_read_localization(hadoop_$1_initrc_t)
-
-	userdom_dontaudit_search_user_home_dirs(hadoop_$1_initrc_t)
-
-	optional_policy(`
-		nscd_socket_use(hadoop_$1_initrc_t)
-	')
 ')
 
 ########################################
@@ -218,20 +106,23 @@
 #
 interface(`hadoop_role',`
 	gen_require(`
-		type hadoop_t;
+		attribute_role hadoop_roles, zookeeper_roles;
+		type hadoop_t, zookeeper_t, hadoop_home_t;
+		type hadoop_tmp_t, hadoop_hsperfdata_t, zookeeper_tmp_t;
 	')
 
 	hadoop_domtrans($2)
-	role $1 types hadoop_t;
-
-	allow $2 hadoop_t:process { ptrace signal_perms };
-	ps_process_pattern($2, hadoop_t)
+	roleattribute $1 hadoop_roles;
 
 	hadoop_domtrans_zookeeper_client($2)
-	role $1 types zookeeper_t;
+	roleattribute $1 zookeeper_roles;
+
+	allow $2 { hadoop_t zookeeper_t }:process { ptrace signal_perms };
+	ps_process_pattern($2, { hadoop_t zookeeper_t })
 
-	allow $2 zookeeper_t:process { ptrace signal_perms };
-	ps_process_pattern($2, zookeeper_t)
+	allow $2 { hadoop_home_t hadoop_tmp_t hadoop_hsperfdata_t }:dir { manage_dir_perms relabel_dir_perms };
+	allow $2 { hadoop_home_t hadoop_tmp_t zookeeper_tmp_t }:file { manage_file_perms relabel_file_perms };
+	allow $2 hadoop_home_t:lnk_file { manage_lnk_file_perms relabel_lnk_file_perms };
 ')
 
 ########################################
@@ -250,18 +141,17 @@
 		type hadoop_t, hadoop_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, hadoop_exec_t, hadoop_t)
 ')
 
 ########################################
 ## <summary>
-##	Give permission to a domain to
-##	recvfrom hadoop_t
+##	Receive from hadoop peer.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
-##	Domain needing recvfrom
-##	permission
+##	Domain allowed access.
 ##	</summary>
 ## </param>
 #
@@ -295,13 +185,11 @@
 
 ########################################
 ## <summary>
-##	Give permission to a domain to
-##	recvfrom zookeeper_t
+##	Receive from zookeeper peer.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
-##	Domain needing recvfrom
-##	permission
+##	Domain allowed access.
 ##	</summary>
 ## </param>
 #
@@ -335,13 +223,11 @@
 
 ########################################
 ## <summary>
-##	Give permission to a domain to
-##	recvfrom zookeeper_server_t
+##	Receive from zookeeper server peer.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
-##	Domain needing recvfrom
-##	permission
+##	Domain allowed access.
 ##	</summary>
 ## </param>
 #
@@ -374,13 +260,11 @@
 
 ########################################
 ## <summary>
-##	Give permission to a domain to
-##	recvfrom hadoop_datanode_t
+##	Receive from datanode peer.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
-##	Domain needing recvfrom
-##	permission
+##	Domain allowed access.
 ##	</summary>
 ## </param>
 #
@@ -394,12 +278,11 @@
 
 ########################################
 ## <summary>
-##	Give permission to a domain to read
-##	hadoop_etc_t
+##	Read hadoop configuration files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
-##	Domain needing read permission
+##	Domain allowed access.
 ##	</summary>
 ## </param>
 #
@@ -414,13 +297,11 @@
 
 ########################################
 ## <summary>
-##	Give permission to a domain to
-##	execute hadoop_etc_t
+##	Execute hadoop configuration files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
-##	Domain needing read and execute
-##	permission
+##	Domain allowed access.
 ##	</summary>
 ## </param>
 #
@@ -435,13 +316,11 @@
 
 ########################################
 ## <summary>
-##	Give permission to a domain to
-##	recvfrom hadoop_jobtracker_t
+##	Receive from jobtracker peer.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
-##	Domain needing recvfrom
-##	permission
+##	Domain allowed access.
 ##	</summary>
 ## </param>
 #
@@ -455,13 +334,11 @@
 
 ########################################
 ## <summary>
-##	Give permission to a domain to
-##	polmatch on hadoop_lan_t
+##	Match hadoop lan association.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
-##	Domain needing polmatch
-##	permission
+##	Domain allowed access.
 ##	</summary>
 ## </param>
 #
@@ -475,13 +352,11 @@
 
 ########################################
 ## <summary>
-##	Give permission to a domain to
-##	recvfrom hadoop_namenode_t
+##	Receive from namenode peer.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
-##	Domain needing recvfrom
-##	permission
+##	Domain allowed access.
 ##	</summary>
 ## </param>
 #
@@ -495,13 +370,11 @@
 
 ########################################
 ## <summary>
-##	Give permission to a domain to
-##	recvfrom hadoop_secondarynamenode_t
+##	Receive from secondary namenode peer.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
-##	Domain needing recvfrom
-##	permission
+##	Domain allowed access.
 ##	</summary>
 ## </param>
 #
@@ -515,13 +388,11 @@
 
 ########################################
 ## <summary>
-##	Give permission to a domain to
-##	recvfrom hadoop_tasktracker_t
+##	Receive from tasktracker peer.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
-##	Domain needing recvfrom
-##	permission
+##	Domain allowed access.
 ##	</summary>
 ## </param>
 #
@@ -532,3 +403,66 @@
 
 	allow $1 hadoop_tasktracker_t:peer recv;
 ')
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an hadoop environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`hadoop_admin',`
+	gen_require(`
+		attribute hadoop_domain;
+		attribute hadoop_initrc_domain;
+
+		attribute hadoop_init_script_file;
+		attribute hadoop_pid_file;
+		attribute hadoop_lock_file;
+		attribute hadoop_log_file;
+		attribute hadoop_tmp_file;
+		attribute hadoop_var_lib_file;
+
+		type hadoop_t, hadoop_etc_t, hadoop_hsperfdata_t;
+		type zookeeper_t, zookeeper_etc_t, zookeeper_server_t;
+		type zookeeper_server_var_t;
+	')
+
+	allow $1 { hadoop_domain hadoop_initrc_domain hadoop_t zookeeper_t zookeeper_server_t }:process { ptrace signal_perms };
+	ps_process_pattern($1, { hadoop_domain hadoop_initrc_domain hadoop_t zookeeper_t zookeeper_server_t })
+
+	init_labeled_script_domtrans($1, hadoop_init_script_file)
+	domain_system_change_exemption($1)
+	role_transition $2 hadoop_init_script_file system_r;
+	allow $2 system_r;
+
+	files_search_etc($1)
+	admin_pattern($1, { hadoop_etc_t zookeeper_etc_t })
+
+	logging_search_logs($1)
+	admin_pattern($1, hadoop_log_file)
+
+	files_search_locks($1)
+	admin_pattern($1, hadoop_lock_file)
+
+	files_search_pids($1)
+	admin_pattern($1, hadoop_pid_file)
+
+	files_search_tmp($1)
+	admin_pattern($1, { hadoop_tmp_file hadoop_hsperfdata_t })
+
+	files_search_var_lib($1)
+	admin_pattern($1, { hadoop_var_lib_file zookeeper_server_var_t })
+
+	hadoop_role($2, $1)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/hadoop.te refpolicy/policy/modules/contrib/hadoop.te
--- refpolicy/policy/modules/contrib/hadoop.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/hadoop.te	2012-10-08 20:11:44.391033616 +0200
@@ -1,15 +1,27 @@
-policy_module(hadoop, 1.2.0)
+policy_module(hadoop, 1.2.4)
 
 ########################################
 #
-# Declarations.
+# Declarations
 #
 
 attribute hadoop_domain;
+attribute hadoop_initrc_domain;
+
+attribute hadoop_init_script_file;
+attribute hadoop_pid_file;
+attribute hadoop_lock_file;
+attribute hadoop_log_file;
+attribute hadoop_tmp_file;
+attribute hadoop_var_lib_file;
+
+attribute_role hadoop_roles;
+attribute_role zookeeper_roles;
 
 type hadoop_t;
 type hadoop_exec_t;
 userdom_user_application_domain(hadoop_t, hadoop_exec_t)
+role hadoop_roles types hadoop_t;
 
 type hadoop_etc_t;
 files_config_file(hadoop_etc_t)
@@ -20,16 +32,16 @@
 type hadoop_lan_t;
 corenet_spd_type(hadoop_lan_t)
 
-type hadoop_log_t;
+type hadoop_log_t, hadoop_log_file;
 logging_log_file(hadoop_log_t)
 
-type hadoop_tmp_t;
+type hadoop_tmp_t, hadoop_tmp_file;
 userdom_user_tmp_file(hadoop_tmp_t)
 
-type hadoop_var_lib_t;
+type hadoop_var_lib_t, hadoop_var_lib_file;
 files_type(hadoop_var_lib_t)
 
-type hadoop_var_run_t;
+type hadoop_var_run_t, hadoop_pid_file;
 files_pid_file(hadoop_var_run_t)
 
 type hadoop_hsperfdata_t;
@@ -44,55 +56,47 @@
 type zookeeper_t;
 type zookeeper_exec_t;
 userdom_user_application_domain(zookeeper_t, zookeeper_exec_t)
+role zookeeper_roles types zookeeper_t;
 
 type zookeeper_etc_t;
 files_config_file(zookeeper_etc_t)
 
-type zookeeper_log_t;
+type zookeeper_log_t, hadoop_log_file;
 logging_log_file(zookeeper_log_t)
 
 type zookeeper_server_t;
 type zookeeper_server_exec_t;
 init_daemon_domain(zookeeper_server_t, zookeeper_server_exec_t)
 
-type zookeeper_server_initrc_exec_t;
+type zookeeper_server_initrc_exec_t, hadoop_init_script_file;
 init_script_file(zookeeper_server_initrc_exec_t)
 
-type zookeeper_server_tmp_t;
+type zookeeper_server_tmp_t, hadoop_tmp_file;
 files_tmp_file(zookeeper_server_tmp_t)
 
 type zookeeper_server_var_t;
 files_type(zookeeper_server_var_t)
 
-# This will need a file context specification.
-type zookeeper_server_var_run_t;
+type zookeeper_server_var_run_t, hadoop_pid_file;
 files_pid_file(zookeeper_server_var_run_t)
 
-type zookeeper_tmp_t;
+type zookeeper_tmp_t, hadoop_tmp_file;
 userdom_user_tmp_file(zookeeper_tmp_t)
 
 ########################################
 #
-# Hadoop policy.
+# Local policy
 #
 
 allow hadoop_t self:capability sys_resource;
 allow hadoop_t self:process { getsched setsched signal signull setrlimit execmem };
 allow hadoop_t self:fifo_file rw_fifo_file_perms;
 allow hadoop_t self:key write;
-allow hadoop_t self:tcp_socket create_stream_socket_perms;
-allow hadoop_t self:udp_socket create_socket_perms;
-dontaudit hadoop_t self:netlink_route_socket rw_netlink_socket_perms;
+allow hadoop_t self:peer recv;
+allow hadoop_t self:tcp_socket { accept listen };
 
 allow hadoop_t hadoop_domain:process signull;
 
-hadoop_match_lan_spd(hadoop_t)
-allow hadoop_t self:peer recv;
-hadoop_recvfrom_datanode(hadoop_t)
-hadoop_recvfrom_jobtracker(hadoop_t)
-hadoop_recvfrom_namenode(hadoop_t)
-hadoop_recvfrom_tasktracker(hadoop_t)
-
 read_files_pattern(hadoop_t, hadoop_etc_t, hadoop_etc_t)
 read_lnk_files_pattern(hadoop_t, hadoop_etc_t, hadoop_etc_t)
 can_exec(hadoop_t, hadoop_etc_t)
@@ -126,22 +130,22 @@
 corenet_all_recvfrom_unlabeled(hadoop_t)
 corenet_all_recvfrom_netlabel(hadoop_t)
 corenet_tcp_sendrecv_generic_if(hadoop_t)
-corenet_udp_sendrecv_generic_if(hadoop_t)
 corenet_tcp_sendrecv_generic_node(hadoop_t)
-corenet_udp_sendrecv_generic_node(hadoop_t)
-corenet_tcp_bind_generic_node(hadoop_t)
-corenet_udp_bind_generic_node(hadoop_t)
 corenet_tcp_sendrecv_all_ports(hadoop_t)
-corenet_udp_sendrecv_all_ports(hadoop_t)
+
+corenet_sendrecv_hadoop_namenode_client_packets(hadoop_t)
 corenet_tcp_connect_hadoop_namenode_port(hadoop_t)
+
+corenet_sendrecv_hadoop_datanode_client_packets(hadoop_t)
 corenet_tcp_connect_hadoop_datanode_port(hadoop_t)
-corenet_tcp_connect_portmap_port(hadoop_t)
-corenet_tcp_connect_zope_port(hadoop_t)
-corenet_sendrecv_hadoop_namenode_client_packets(hadoop_t)
+
 corenet_sendrecv_portmap_client_packets(hadoop_t)
+corenet_tcp_connect_portmap_port(hadoop_t)
+
 corenet_sendrecv_zope_client_packets(hadoop_t)
-# Hadoop uses high ordered random ports for services
-# If permanent ports are chosen, remove line below and lock down
+corenet_tcp_connect_zope_port(hadoop_t)
+
+corenet_sendrecv_generic_client_packets(hadoop_t)
 corenet_tcp_connect_generic_port(hadoop_t)
 
 dev_read_rand(hadoop_t)
@@ -151,45 +155,162 @@
 domain_use_interactive_fds(hadoop_t)
 
 files_dontaudit_search_spool(hadoop_t)
-files_read_etc_files(hadoop_t)
 files_read_usr_files(hadoop_t)
 
 fs_getattr_xattr_fs(hadoop_t)
 
-miscfiles_read_localization(hadoop_t)
+auth_use_nsswitch(hadoop_t)
 
-sysnet_read_config(hadoop_t)
+miscfiles_read_localization(hadoop_t)
 
 userdom_use_user_terminals(hadoop_t)
 
-java_exec(hadoop_t)
+hadoop_match_lan_spd(hadoop_t)
+hadoop_recvfrom_datanode(hadoop_t)
+hadoop_recvfrom_jobtracker(hadoop_t)
+hadoop_recvfrom_namenode(hadoop_t)
+hadoop_recvfrom_tasktracker(hadoop_t)
+
+optional_policy(`
+	java_exec(hadoop_t)
+')
+
+########################################
+#
+# Common hadoop_domain local policy
+#
+
+allow hadoop_domain self:capability { chown kill setgid setuid };
+allow hadoop_domain self:process { execmem getsched setsched sigkill signal };
+allow hadoop_domain self:fifo_file rw_fifo_file_perms;
+allow hadoop_domain self:key search;
+allow hadoop_domain self:peer recv;
+allow hadoop_domain self:tcp_socket { accept listen };
+
+allow hadoop_domain hadoop_domain:process signull;
+
+allow hadoop_domain hadoop_hsperfdata_t:dir manage_dir_perms;
+files_tmp_filetrans(hadoop_domain, hadoop_hsperfdata_t, dir)
+
+hadoop_exec_config(hadoop_domain)
+hadoop_match_lan_spd(hadoop_domain)
+
+kernel_read_kernel_sysctls(hadoop_domain)
+kernel_read_network_state(hadoop_domain)
+kernel_read_sysctl(hadoop_domain)
+kernel_read_system_state(hadoop_domain)
+
+corecmd_exec_bin(hadoop_domain)
+corecmd_exec_shell(hadoop_domain)
+
+corenet_all_recvfrom_unlabeled(hadoop_domain)
+corenet_all_recvfrom_netlabel(hadoop_domain)
+corenet_tcp_bind_all_nodes(hadoop_domain)
+corenet_tcp_sendrecv_generic_if(hadoop_domain)
+corenet_tcp_sendrecv_generic_node(hadoop_domain)
+corenet_tcp_sendrecv_all_ports(hadoop_domain)
 
-kerberos_use(hadoop_t)
+corenet_sendrecv_generic_client_packets(hadoop_domain)
+corenet_tcp_connect_generic_port(hadoop_domain)
+
+dev_read_rand(hadoop_domain)
+dev_read_urand(hadoop_domain)
+dev_read_sysfs(hadoop_domain)
+
+files_search_pids(hadoop_domain)
+files_search_var_lib(hadoop_domain)
+
+auth_domtrans_chkpwd(hadoop_domain)
+
+init_read_utmp(hadoop_domain)
+init_use_fds(hadoop_domain)
+init_use_script_fds(hadoop_domain)
+init_use_script_ptys(hadoop_domain)
+
+logging_search_logs(hadoop_domain)
+logging_send_audit_msgs(hadoop_domain)
+logging_send_syslog_msg(hadoop_domain)
+
+miscfiles_read_localization(hadoop_domain)
 
 optional_policy(`
-	nis_use_ypbind(hadoop_t)
+	java_exec(hadoop_domain)
 ')
 
 optional_policy(`
-	nscd_socket_use(hadoop_t)
+	su_exec(hadoop_domain)
 ')
 
 ########################################
 #
-# Hadoop datanode policy.
+# Common hadoop_initrc_domain local policy
 #
 
-allow hadoop_datanode_t self:process signal;
+allow hadoop_initrc_domain self:capability { setuid setgid };
+dontaudit hadoop_initrc_domain self:capability sys_tty_config;
+allow hadoop_initrc_domain self:process setsched;
+allow hadoop_initrc_domain self:fifo_file rw_fifo_file_perms;
+
+manage_dirs_pattern(hadoop_initrc_domain, hadoop_var_run_t, hadoop_var_run_t)
+manage_files_pattern(hadoop_initrc_domain, hadoop_var_run_t, hadoop_var_run_t)
+
+hadoop_exec_config(hadoop_initrc_domain)
+
+kernel_read_kernel_sysctls(hadoop_initrc_domain)
+kernel_read_sysctl(hadoop_initrc_domain)
+kernel_read_system_state(hadoop_initrc_domain)
+
+corecmd_exec_bin(hadoop_initrc_domain)
+corecmd_exec_shell(hadoop_initrc_domain)
+
+files_read_etc_files(hadoop_initrc_domain)
+files_read_usr_files(hadoop_initrc_domain)
+files_search_locks(hadoop_initrc_domain)
+files_search_pids(hadoop_initrc_domain)
+
+fs_getattr_xattr_fs(hadoop_initrc_domain)
+fs_search_cgroup_dirs(hadoop_initrc_domain)
+
+term_use_generic_ptys(hadoop_initrc_domain)
+
+init_rw_utmp(hadoop_initrc_domain)
+init_use_fds(hadoop_initrc_domain)
+init_use_script_ptys(hadoop_initrc_domain)
+
+logging_search_logs(hadoop_initrc_domain)
+logging_send_syslog_msg(hadoop_initrc_domain)
+logging_send_audit_msgs(hadoop_initrc_domain)
+
+miscfiles_read_localization(hadoop_initrc_domain)
+
+userdom_dontaudit_search_user_home_dirs(hadoop_initrc_domain)
+
+optional_policy(`
+	consoletype_exec(hadoop_initrc_domain)
+')
+
+optional_policy(`
+	nscd_socket_use(hadoop_initrc_domain)
+')
+
+########################################
+#
+# Datanode local policy
+#
 
 manage_dirs_pattern(hadoop_datanode_t, hadoop_var_lib_t, hadoop_var_lib_t)
 
+corenet_sendrecv_hadoop_datanode_server_packets(hadoop_datanode_t)
 corenet_tcp_bind_hadoop_datanode_port(hadoop_datanode_t)
+
+corenet_sendrecv_hadoop_datanode_client_packets(hadoop_datanode_t)
 corenet_tcp_connect_hadoop_datanode_port(hadoop_datanode_t)
+
+corenet_sendrecv_hadoop_namenode_client_packets(hadoop_datanode_t)
 corenet_tcp_connect_hadoop_namenode_port(hadoop_datanode_t)
 
 fs_getattr_xattr_fs(hadoop_datanode_t)
 
-allow hadoop_datanode_t self:peer recv;
 hadoop_recvfrom_jobtracker(hadoop_datanode_t)
 hadoop_recvfrom_namenode(hadoop_datanode_t)
 hadoop_recvfrom(hadoop_datanode_t)
@@ -197,7 +318,7 @@
 
 ########################################
 #
-# Hadoop jobtracker policy.
+# Jobtracker local policy
 #
 
 create_dirs_pattern(hadoop_jobtracker_t, hadoop_jobtracker_log_t, hadoop_jobtracker_log_t)
@@ -205,11 +326,15 @@
 
 manage_dirs_pattern(hadoop_jobtracker_t, hadoop_var_lib_t, hadoop_var_lib_t)
 
+corenet_sendrecv_zope_server_packets(hadoop_jobtracker_t)
 corenet_tcp_bind_zope_port(hadoop_jobtracker_t)
+
+corenet_sendrecv_hadoop_datanode_client_packets(hadoop_jobtracker_t)
 corenet_tcp_connect_hadoop_datanode_port(hadoop_jobtracker_t)
+
+corenet_sendrecv_hadoop_namenode_client_packets(hadoop_jobtracker_t)
 corenet_tcp_connect_hadoop_namenode_port(hadoop_jobtracker_t)
 
-allow hadoop_jobtracker_t self:peer recv;
 hadoop_recvfrom_datanode(hadoop_jobtracker_t)
 hadoop_recvfrom_namenode(hadoop_jobtracker_t)
 hadoop_recvfrom(hadoop_jobtracker_t)
@@ -217,16 +342,18 @@
 
 ########################################
 #
-# Hadoop namenode policy.
+# Namenode local policy
 #
 
 manage_dirs_pattern(hadoop_namenode_t, hadoop_var_lib_t, hadoop_var_lib_t)
 manage_files_pattern(hadoop_namenode_t, hadoop_var_lib_t, hadoop_var_lib_t)
 
+corenet_sendrecv_hadoop_namenode_server_packets(hadoop_namenode_t)
 corenet_tcp_bind_hadoop_namenode_port(hadoop_namenode_t)
+
+corenet_sendrecv_hadoop_namenode_client_packets(hadoop_namenode_t)
 corenet_tcp_connect_hadoop_namenode_port(hadoop_namenode_t)
 
-allow hadoop_namenode_t self:peer recv;
 hadoop_recvfrom_datanode(hadoop_namenode_t)
 hadoop_recvfrom_jobtracker(hadoop_namenode_t)
 hadoop_recvfrom(hadoop_namenode_t)
@@ -235,39 +362,41 @@
 
 ########################################
 #
-# Hadoop secondary namenode policy.
+# Secondary namenode local policy
 #
 
 manage_dirs_pattern(hadoop_secondarynamenode_t, hadoop_var_lib_t, hadoop_var_lib_t)
 
+corenet_sendrecv_hadoop_namenode_client_packets(hadoop_secondarynamenode_t)
 corenet_tcp_connect_hadoop_namenode_port(hadoop_secondarynamenode_t)
 
-allow hadoop_secondarynamenode_t self:peer recv;
 hadoop_recvfrom_namenode(hadoop_secondarynamenode_t)
 
 ########################################
 #
-# Hadoop tasktracker policy.
+# Tasktracker local policy
 #
 
-allow hadoop_tasktracker_t self:process signal;
-
 manage_dirs_pattern(hadoop_tasktracker_t, hadoop_tasktracker_log_t, hadoop_tasktracker_log_t)
 setattr_dirs_pattern(hadoop_tasktracker_t, hadoop_log_t, hadoop_log_t)
 filetrans_pattern(hadoop_tasktracker_t, hadoop_log_t, hadoop_tasktracker_log_t, dir)
 
-filetrans_pattern(hadoop_tasktracker_t, hadoop_var_lib_t, hadoop_tasktracker_var_lib_t, lnk_file)
 manage_lnk_files_pattern(hadoop_tasktracker_t, hadoop_tasktracker_var_lib_t, hadoop_tasktracker_var_lib_t)
+filetrans_pattern(hadoop_tasktracker_t, hadoop_var_lib_t, hadoop_tasktracker_var_lib_t, lnk_file)
 
 manage_dirs_pattern(hadoop_tasktracker_t, hadoop_var_lib_t, hadoop_var_lib_t)
 
+corenet_sendrecv_hadoop_datanode_client_packets(hadoop_tasktracker_t)
 corenet_tcp_connect_hadoop_datanode_port(hadoop_tasktracker_t)
+
+corenet_sendrecv_hadoop_namenode_client_packets(hadoop_tasktracker_t)
 corenet_tcp_connect_hadoop_namenode_port(hadoop_tasktracker_t)
+
+corenet_sendrecv_zope_client_packets(hadoop_tasktracker_t)
 corenet_tcp_connect_zope_port(hadoop_tasktracker_t)
 
 fs_getattr_xattr_fs(hadoop_tasktracker_t)
 
-allow hadoop_tasktracker_t self:peer recv;
 hadoop_recvfrom_datanode(hadoop_tasktracker_t)
 hadoop_recvfrom_jobtracker(hadoop_tasktracker_t)
 hadoop_recvfrom(hadoop_tasktracker_t)
@@ -275,17 +404,12 @@
 
 ########################################
 #
-# Hadoop zookeeper client policy.
+# Zookeeper client local policy
 #
 
 allow zookeeper_t self:process { getsched sigkill signal signull execmem };
 allow zookeeper_t self:fifo_file rw_fifo_file_perms;
-allow zookeeper_t self:tcp_socket create_stream_socket_perms;
-allow zookeeper_t self:udp_socket create_socket_perms;
-dontaudit zookeeper_t self:netlink_route_socket rw_netlink_socket_perms;
-
-hadoop_match_lan_spd(zookeeper_t)
-hadoop_recvfrom_zookeeper_server(zookeeper_t)
+allow zookeeper_t self:tcp_socket { accept listen };
 
 read_files_pattern(zookeeper_t, zookeeper_etc_t, zookeeper_etc_t)
 read_lnk_files_pattern(zookeeper_t, zookeeper_etc_t, zookeeper_etc_t)
@@ -314,17 +438,13 @@
 corenet_all_recvfrom_unlabeled(zookeeper_t)
 corenet_all_recvfrom_netlabel(zookeeper_t)
 corenet_tcp_sendrecv_generic_if(zookeeper_t)
-corenet_udp_sendrecv_generic_if(zookeeper_t)
 corenet_tcp_sendrecv_generic_node(zookeeper_t)
-corenet_udp_sendrecv_generic_node(zookeeper_t)
 corenet_tcp_sendrecv_all_ports(zookeeper_t)
-corenet_udp_sendrecv_all_ports(zookeeper_t)
-corenet_tcp_bind_generic_node(zookeeper_t)
-corenet_udp_bind_generic_node(zookeeper_t)
-corenet_tcp_connect_zookeeper_client_port(zookeeper_t)
+
 corenet_sendrecv_zookeeper_client_client_packets(zookeeper_t)
-# Hadoop uses high ordered random ports for services
-# If permanent ports are chosen, remove line below and lock down
+corenet_tcp_connect_zookeeper_client_port(zookeeper_t)
+
+corenet_sendrecv_generic_client_packets(zookeeper_t)
 corenet_tcp_connect_generic_port(zookeeper_t)
 
 dev_read_rand(zookeeper_t)
@@ -333,37 +453,32 @@
 
 domain_use_interactive_fds(zookeeper_t)
 
-files_read_etc_files(zookeeper_t)
 files_read_usr_files(zookeeper_t)
 
-miscfiles_read_localization(zookeeper_t)
+auth_use_nsswitch(zookeeper_t)
 
-sysnet_read_config(zookeeper_t)
+miscfiles_read_localization(zookeeper_t)
 
 userdom_use_user_terminals(zookeeper_t)
 userdom_dontaudit_search_user_home_dirs(zookeeper_t)
 
-java_exec(zookeeper_t)
+hadoop_match_lan_spd(zookeeper_t)
+hadoop_recvfrom_zookeeper_server(zookeeper_t)
 
 optional_policy(`
-	nscd_socket_use(zookeeper_t)
+	java_exec(zookeeper_t)
 ')
 
 ########################################
 #
-# Hadoop zookeeper server policy.
+# Zookeeper server local policy
 #
 
 allow zookeeper_server_t self:capability kill;
 allow zookeeper_server_t self:process { execmem getsched sigkill signal signull };
 allow zookeeper_server_t self:fifo_file rw_fifo_file_perms;
-allow zookeeper_server_t self:netlink_route_socket rw_netlink_socket_perms;
-allow zookeeper_server_t self:tcp_socket create_stream_socket_perms;
-allow zookeeper_server_t self:udp_socket create_socket_perms;
-
-hadoop_match_lan_spd(zookeeper_server_t)
 allow zookeeper_server_t self:peer recv;
-hadoop_recvfrom_zookeeper_client(zookeeper_server_t)
+allow zookeeper_server_t self:tcp_socket { accept listen };
 
 allow zookeeper_server_t hadoop_hsperfdata_t:dir manage_dir_perms;
 files_tmp_filetrans(zookeeper_server_t, hadoop_hsperfdata_t, dir)
@@ -396,32 +511,32 @@
 corenet_all_recvfrom_unlabeled(zookeeper_server_t)
 corenet_all_recvfrom_netlabel(zookeeper_server_t)
 corenet_tcp_sendrecv_generic_if(zookeeper_server_t)
-corenet_udp_sendrecv_generic_if(zookeeper_server_t)
 corenet_tcp_sendrecv_generic_node(zookeeper_server_t)
-corenet_udp_sendrecv_generic_node(zookeeper_server_t)
 corenet_tcp_sendrecv_all_ports(zookeeper_server_t)
-corenet_udp_sendrecv_all_ports(zookeeper_server_t)
 corenet_tcp_bind_generic_node(zookeeper_server_t)
-corenet_udp_bind_generic_node(zookeeper_server_t)
+
+corenet_sendrecv_zookeeper_client_server_packets(zookeeper_server_t)
 corenet_tcp_bind_zookeeper_client_port(zookeeper_server_t)
+
+corenet_sendrecv_zookeeper_election_server_packets(zookeeper_server_t)
 corenet_tcp_bind_zookeeper_election_port(zookeeper_server_t)
+
+corenet_sendrecv_zookeeper_leader_server_packets(zookeeper_server_t)
 corenet_tcp_bind_zookeeper_leader_port(zookeeper_server_t)
+
+corenet_sendrecv_zookeeper_election_client_packets(zookeeper_server_t)
 corenet_tcp_connect_zookeeper_election_port(zookeeper_server_t)
+
 corenet_tcp_connect_zookeeper_leader_port(zookeeper_server_t)
-corenet_sendrecv_zookeeper_election_client_packets(zookeeper_server_t)
 corenet_sendrecv_zookeeper_leader_client_packets(zookeeper_server_t)
-corenet_sendrecv_zookeeper_client_server_packets(zookeeper_server_t)
-corenet_sendrecv_zookeeper_election_server_packets(zookeeper_server_t)
-corenet_sendrecv_zookeeper_leader_server_packets(zookeeper_server_t)
-# Hadoop uses high ordered random ports for services
-# If permanent ports are chosen, remove line below and lock down
+
+corenet_sendrecv_generic_client_packets(zookeeper_server_t)
 corenet_tcp_connect_generic_port(zookeeper_server_t)
 
 dev_read_rand(zookeeper_server_t)
 dev_read_sysfs(zookeeper_server_t)
 dev_read_urand(zookeeper_server_t)
 
-files_read_etc_files(zookeeper_server_t)
 files_read_usr_files(zookeeper_server_t)
 
 fs_getattr_xattr_fs(zookeeper_server_t)
@@ -430,6 +545,9 @@
 
 miscfiles_read_localization(zookeeper_server_t)
 
-sysnet_read_config(zookeeper_server_t)
+hadoop_match_lan_spd(zookeeper_server_t)
+hadoop_recvfrom_zookeeper_client(zookeeper_server_t)
 
-java_exec(zookeeper_server_t)
+optional_policy(`
+	java_exec(zookeeper_server_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/hal.fc refpolicy/policy/modules/contrib/hal.fc
--- refpolicy/policy/modules/contrib/hal.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/hal.fc	2012-10-06 17:52:26.546732451 +0200
@@ -1,33 +1,27 @@
+/etc/hal/device\.d/printer_remove\.hal	-- 	gen_context(system_u:object_r:hald_exec_t,s0)
+/etc/hal/capability\.d/printer_update\.hal	--	gen_context(system_u:object_r:hald_exec_t,s0)
 
-/etc/hal/device\.d/printer_remove\.hal -- 	gen_context(system_u:object_r:hald_exec_t,s0)
-/etc/hal/capability\.d/printer_update\.hal --	gen_context(system_u:object_r:hald_exec_t,s0)
+/usr/bin/hal-setup-keymap	--	gen_context(system_u:object_r:hald_keymap_exec_t,s0)
 
-/usr/bin/hal-setup-keymap		--	gen_context(system_u:object_r:hald_keymap_exec_t,s0)
+/usr/libexec/hal-acl-tool	--	gen_context(system_u:object_r:hald_acl_exec_t,s0)
+/usr/libexec/hal-dccm	--	gen_context(system_u:object_r:hald_dccm_exec_t,s0)
+/usr/libexec/hal-hotplug-map	--	gen_context(system_u:object_r:hald_exec_t,s0)
+/usr/libexec/hal-system-sonypic	--	gen_context(system_u:object_r:hald_sonypic_exec_t,s0)
+/usr/libexec/hald-addon-macbookpro-backlight	--	gen_context(system_u:object_r:hald_mac_exec_t,s0)
+/usr/libexec/hald-addon-macbook-backlight	--	gen_context(system_u:object_r:hald_mac_exec_t,s0)
+/usr/sbin/radeontool	--	gen_context(system_u:object_r:hald_mac_exec_t,s0)
 
-/usr/libexec/hal-acl-tool		--	gen_context(system_u:object_r:hald_acl_exec_t,s0)
-/usr/libexec/hal-dccm			--	gen_context(system_u:object_r:hald_dccm_exec_t,s0)
-/usr/libexec/hal-hotplug-map 		--	gen_context(system_u:object_r:hald_exec_t,s0)
-/usr/libexec/hal-system-sonypic	 	--	gen_context(system_u:object_r:hald_sonypic_exec_t,s0)
-/usr/libexec/hald-addon-macbookpro-backlight --	gen_context(system_u:object_r:hald_mac_exec_t,s0)
-/usr/libexec/hald-addon-macbook-backlight --	gen_context(system_u:object_r:hald_mac_exec_t,s0)
-/usr/sbin/radeontool			--	gen_context(system_u:object_r:hald_mac_exec_t,s0)
-
-/usr/sbin/hald		--			gen_context(system_u:object_r:hald_exec_t,s0)
-
-/var/cache/hald(/.*)?				gen_context(system_u:object_r:hald_cache_t,s0)
-
-/var/lib/hal(/.*)?				gen_context(system_u:object_r:hald_var_lib_t,s0)
-
-/var/log/pm(/.*)?				gen_context(system_u:object_r:hald_log_t,s0)
-/var/log/pm-.*\.log.*				gen_context(system_u:object_r:hald_log_t,s0)
-
-/var/run/hald(/.*)?				gen_context(system_u:object_r:hald_var_run_t,s0)
-/var/run/haldaemon\.pid	--	 		gen_context(system_u:object_r:hald_var_run_t,s0)
-/var/run/pm(/.*)?				gen_context(system_u:object_r:hald_var_run_t,s0)
-/var/run/pm-utils(/.*)?				gen_context(system_u:object_r:hald_var_run_t,s0)
-/var/run/synce.*	 			gen_context(system_u:object_r:hald_var_run_t,s0)
-/var/run/vbe.*	 	--			gen_context(system_u:object_r:hald_var_run_t,s0)
-
-ifdef(`distro_gentoo',`
-/var/lib/cache/hald(/.*)?			gen_context(system_u:object_r:hald_cache_t,s0)
-')
+/usr/sbin/hald	--	gen_context(system_u:object_r:hald_exec_t,s0)
+
+/var/cache/hald(/.*)?	gen_context(system_u:object_r:hald_cache_t,s0)
+
+/var/lib/hal(/.*)?	gen_context(system_u:object_r:hald_var_lib_t,s0)
+/var/lib/cache/hald(/.*)?	gen_context(system_u:object_r:hald_cache_t,s0)
+
+/var/log/pm(/.*)?	gen_context(system_u:object_r:hald_log_t,s0)
+
+/var/run/hald(/.*)?	gen_context(system_u:object_r:hald_var_run_t,s0)
+/var/run/haldaemon\.pid	--	gen_context(system_u:object_r:hald_var_run_t,s0)
+/var/run/pm(/.*)?	gen_context(system_u:object_r:hald_var_run_t,s0)
+/var/run/synce.*	gen_context(system_u:object_r:hald_var_run_t,s0)
+/var/run/vbe.*	--	gen_context(system_u:object_r:hald_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/hal.if refpolicy/policy/modules/contrib/hal.if
--- refpolicy/policy/modules/contrib/hal.if	2012-05-04 15:16:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/hal.if	2012-10-06 17:53:28.409732583 +0200
@@ -1,4 +1,4 @@
-## <summary>Hardware abstraction layer</summary>
+## <summary>Hardware abstraction layer.</summary>
 
 ########################################
 ## <summary>
@@ -15,12 +15,13 @@
 		type hald_t, hald_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, hald_exec_t, hald_t)
 ')
 
 ########################################
 ## <summary>
-##	Get the attributes of a hal process.
+##	Get attributes of hald processes.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -38,7 +39,7 @@
 
 ########################################
 ## <summary>
-##	Read hal system state
+##	Read hal process state files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -56,7 +57,7 @@
 
 ########################################
 ## <summary>
-##	Allow ptrace of hal domain
+##	Trace hald processes.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -74,7 +75,7 @@
 
 ########################################
 ## <summary>
-##	Allow domain to use file descriptors from hal.
+##	Inherit and use hald file descriptors.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -92,7 +93,8 @@
 
 ########################################
 ## <summary>
-##	Do not audit attempts to use file descriptors from hal.
+##	Do not audit attempts to inherited
+##	and use hald file descriptors.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -110,8 +112,7 @@
 
 ########################################
 ## <summary>
-##	Allow attempts to read and write to
-##	hald unnamed pipes.
+##	Read and write hald unnamed pipes.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -129,8 +130,8 @@
 
 ########################################
 ## <summary>
-##	Do not audit attempts to read and write to
-##	hald unnamed pipes.
+##	Do not audit attempts to read and
+##	write hald unnamed pipes.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -148,7 +149,7 @@
 
 ########################################
 ## <summary>
-##	Send to hal over a unix domain
+##	Send to hald over a unix domain
 ##	datagram socket.
 ## </summary>
 ## <param name="domain">
@@ -159,15 +160,16 @@
 #
 interface(`hal_dgram_send',`
 	gen_require(`
-		type hald_t;
+		type hald_t, hald_var_lib_t;
 	')
 
-	allow $1 hald_t:unix_dgram_socket sendto;
+	files_search_var_lib($1)
+	dgram_send_pattern($1, hald_var_lib_t, hald_var_lib_t, hald_t)
 ')
 
 ########################################
 ## <summary>
-##	Send to hal over a unix domain
+##	Send to hald over a unix domain
 ##	stream socket.
 ## </summary>
 ## <param name="domain">
@@ -178,15 +180,17 @@
 #
 interface(`hal_stream_connect',`
 	gen_require(`
-		type hald_t;
+		type hald_t, hald_var_lib_t;
 	')
 
-	allow $1 hald_t:unix_stream_socket connectto;
+	files_search_var_lib($1)
+	stream_connect_pattern($1, hald_var_lib_t, hald_var_lib_t, hald_t)
 ')
 
 ########################################
 ## <summary>
-##	Dontaudit read/write to a hal unix datagram socket.
+##	Do not audit attempts to read and
+##	write hald unix datagram sockets.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -204,7 +208,7 @@
 
 ########################################
 ## <summary>
-##	Send a dbus message to hal.
+##	Send messages to hald over dbus.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -224,7 +228,7 @@
 ########################################
 ## <summary>
 ##	Send and receive messages from
-##	hal over dbus.
+##	hald over dbus.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -257,13 +261,13 @@
 		type hald_mac_t, hald_mac_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, hald_mac_exec_t, hald_mac_t)
 ')
 
 ########################################
 ## <summary>
-##	Allow attempts to write the hal
-##	log files.
+##	Write hald log files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -277,12 +281,12 @@
 	')
 
 	logging_search_logs($1)
-	allow $1 hald_log_t:file write_file_perms;
+	write_files_pattern($1, hald_log_t, hald_log_t)
 ')
 
 ########################################
 ## <summary>
-##	Do not audit attempts to write the hal
+##	Do not audit attempts to write hald
 ##	log files.
 ## </summary>
 ## <param name="domain">
@@ -301,7 +305,8 @@
 
 ########################################
 ## <summary>
-##	Manage hald log files.
+##	Create, read, write, and delete
+##	hald log files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -314,14 +319,13 @@
 		type hald_log_t;
 	')
 
-	# log files for hald
+	logging_search_logs($1)
 	manage_files_pattern($1, hald_log_t, hald_log_t)
-	logging_log_filetrans($1, hald_log_t, file)
 ')
 
 ########################################
 ## <summary>
-##	Read hald tmp files.
+##	Read hald temporary files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -334,13 +338,14 @@
 		type hald_tmp_t;
 	')
 
+	files_search_tmp($1)
 	allow $1 hald_tmp_t:file read_file_perms;
 ')
 
 ########################################
 ## <summary>
-##	Do not audit attempts to read or write
-##	HAL libraries files
+##	Do not audit attempts to append
+##	hald libraries files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -353,12 +358,12 @@
 		type hald_var_lib_t;
 	')
 
-	dontaudit $1 hald_var_lib_t:file { read_file_perms append_file_perms };
+	dontaudit $1 hald_var_lib_t:file append_file_perms;
 ')
 
 ########################################
 ## <summary>
-##	Read hald PID files.
+##	Read hald pid files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -377,7 +382,7 @@
 
 ########################################
 ## <summary>
-##	Read/Write hald PID files.
+##	Read and write hald pid files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -396,7 +401,8 @@
 
 ########################################
 ## <summary>
-##	Manage hald PID dirs.
+##	Create, read, write, and delete
+##	hald pid directories.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -415,7 +421,8 @@
 
 ########################################
 ## <summary>
-##	Manage hald PID files.
+##	Create, read, write, and delete
+##	hald pid files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/hal.te refpolicy/policy/modules/contrib/hal.te
--- refpolicy/policy/modules/contrib/hal.te	2012-05-04 15:16:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/hal.te	2012-10-27 13:44:57.307007515 +0200
@@ -1,15 +1,17 @@
-policy_module(hal, 1.14.0)
+policy_module(hal, 1.14.4)
 
 ########################################
 #
 # Declarations
 #
 
-type hald_t;
+attribute hald_domain;
+
+type hald_t, hald_domain;
 type hald_exec_t;
 init_daemon_domain(hald_t, hald_exec_t)
 
-type hald_acl_t;
+type hald_acl_t, hald_domain;
 type hald_acl_exec_t;
 domain_type(hald_acl_t)
 domain_entry_file(hald_acl_t, hald_acl_exec_t)
@@ -18,13 +20,13 @@
 type hald_cache_t;
 files_pid_file(hald_cache_t)
 
-type hald_dccm_t;
+type hald_dccm_t, hald_domain;
 type hald_dccm_exec_t;
 domain_type(hald_dccm_t)
 domain_entry_file(hald_dccm_t, hald_dccm_exec_t)
 role system_r types hald_dccm_t;
 
-type hald_keymap_t;
+type hald_keymap_t, hald_domain;
 type hald_keymap_exec_t;
 domain_type(hald_keymap_t)
 domain_entry_file(hald_keymap_t, hald_keymap_exec_t)
@@ -33,13 +35,13 @@
 type hald_log_t;
 logging_log_file(hald_log_t)
 
-type hald_mac_t;
+type hald_mac_t, hald_domain;
 type hald_mac_exec_t;
 domain_type(hald_mac_t)
 domain_entry_file(hald_mac_t, hald_mac_exec_t)
 role system_r types hald_mac_t;
 
-type hald_sonypic_t;
+type hald_sonypic_t, hald_domain;
 type hald_sonypic_exec_t;
 domain_type(hald_sonypic_t)
 domain_entry_file(hald_sonypic_t, hald_sonypic_exec_t)
@@ -56,33 +58,39 @@
 
 ########################################
 #
+# Common local policy
+#
+
+files_read_usr_files(hald_domain)
+
+miscfiles_read_localization(hald_domain)
+
+hal_stream_connect(hald_domain)
+
+########################################
+#
 # Local policy
 #
 
-# execute openvt which needs setuid
 allow hald_t self:capability { chown setuid setgid kill net_admin sys_admin sys_nice dac_override dac_read_search mknod sys_rawio sys_tty_config };
-dontaudit hald_t self:capability {sys_ptrace sys_tty_config };
+dontaudit hald_t self:capability { sys_ptrace sys_tty_config };
 allow hald_t self:process { getsched getattr signal_perms };
 allow hald_t self:fifo_file rw_fifo_file_perms;
-allow hald_t self:unix_stream_socket { create_stream_socket_perms connectto };
-allow hald_t self:unix_dgram_socket create_socket_perms;
+allow hald_t self:unix_stream_socket { accept listen };
 allow hald_t self:netlink_kobject_uevent_socket create_socket_perms;
-allow hald_t self:tcp_socket create_stream_socket_perms;
-allow hald_t self:udp_socket create_socket_perms;
-# For backwards compatibility with older kernels
-allow hald_t self:netlink_socket create_socket_perms;
+allow hald_t self:tcp_socket { accept listen };
 
 manage_files_pattern(hald_t, hald_cache_t, hald_cache_t)
 
-# log files for hald
-manage_files_pattern(hald_t, hald_log_t, hald_log_t)
+append_files_pattern(hald_t, hald_log_t, hald_log_t)
+create_files_pattern(hald_t, hald_log_t, hald_log_t)
+setattr_files_pattern(hald_t, hald_log_t, hald_log_t)
 logging_log_filetrans(hald_t, hald_log_t, file)
 
 manage_dirs_pattern(hald_t, hald_tmp_t, hald_tmp_t)
 manage_files_pattern(hald_t, hald_tmp_t, hald_tmp_t)
 files_tmp_filetrans(hald_t, hald_tmp_t, { file dir })
 
-# var/lib files for hald
 manage_dirs_pattern(hald_t, hald_var_lib_t, hald_var_lib_t)
 manage_files_pattern(hald_t, hald_var_lib_t, hald_var_lib_t)
 manage_sock_files_pattern(hald_t, hald_var_lib_t, hald_var_lib_t)
@@ -91,6 +99,14 @@
 manage_files_pattern(hald_t, hald_var_run_t, hald_var_run_t)
 files_pid_filetrans(hald_t, hald_var_run_t, { dir file })
 
+domtrans_pattern(hald_t, hald_acl_exec_t, hald_acl_t)
+domtrans_pattern(hald_t, hald_mac_exec_t, hald_mac_t)
+domtrans_pattern(hald_t, hald_sonypic_exec_t, hald_sonypic_t)
+domtrans_pattern(hald_t, hald_keymap_exec_t, hald_keymap_t)
+domtrans_pattern(hald_t, hald_dccm_exec_t, hald_dccm_t)
+
+allow hald_t hald_domain:process signal;
+
 kernel_read_system_state(hald_t)
 kernel_read_network_state(hald_t)
 kernel_read_software_raid_state(hald_t)
@@ -99,23 +115,12 @@
 kernel_rw_irq_sysctls(hald_t)
 kernel_rw_vm_sysctls(hald_t)
 kernel_write_proc_files(hald_t)
-kernel_search_network_sysctl(hald_t)
+kernel_rw_net_sysctls(hald_t)
 kernel_setsched(hald_t)
 kernel_request_load_module(hald_t)
 
-auth_read_pam_console_data(hald_t)
-
 corecmd_exec_all_executables(hald_t)
 
-corenet_all_recvfrom_unlabeled(hald_t)
-corenet_all_recvfrom_netlabel(hald_t)
-corenet_tcp_sendrecv_generic_if(hald_t)
-corenet_udp_sendrecv_generic_if(hald_t)
-corenet_tcp_sendrecv_generic_node(hald_t)
-corenet_udp_sendrecv_generic_node(hald_t)
-corenet_tcp_sendrecv_all_ports(hald_t)
-corenet_udp_sendrecv_all_ports(hald_t)
-
 dev_rw_usbfs(hald_t)
 dev_read_rand(hald_t)
 dev_read_urand(hald_t)
@@ -124,13 +129,11 @@
 dev_rw_printer(hald_t)
 dev_read_lvm_control(hald_t)
 dev_getattr_all_chr_files(hald_t)
-dev_manage_generic_chr_files(hald_t)
 dev_rw_generic_usb_dev(hald_t)
 dev_setattr_generic_usb_dev(hald_t)
 dev_setattr_usbfs_files(hald_t)
 dev_rw_power_management(hald_t)
 dev_read_raw_memory(hald_t)
-# hal is now execing pm-suspend
 dev_rw_sysfs(hald_t)
 dev_read_video_dev(hald_t)
 
@@ -139,14 +142,11 @@
 domain_dontaudit_ptrace_all_domains(hald_t)
 
 files_exec_etc_files(hald_t)
-files_read_etc_files(hald_t)
+files_getattr_all_mountpoints(hald_t)
 files_rw_etc_runtime_files(hald_t)
 files_manage_mnt_dirs(hald_t)
 files_manage_mnt_files(hald_t)
 files_manage_mnt_symlinks(hald_t)
-files_search_var_lib(hald_t)
-files_read_usr_files(hald_t)
-# hal is now execing pm-suspend
 files_create_boot_flag(hald_t)
 files_getattr_all_dirs(hald_t)
 files_getattr_all_files(hald_t)
@@ -164,8 +164,6 @@
 fs_manage_fusefs_dirs(hald_t)
 fs_rw_removable_blk_files(hald_t)
 
-files_getattr_all_mountpoints(hald_t)
-
 mls_file_read_all_levels(hald_t)
 
 selinux_get_fs_mount(hald_t)
@@ -180,28 +178,23 @@
 storage_raw_read_fixed_disk(hald_t)
 storage_raw_write_fixed_disk(hald_t)
 
-# hal_probe_serial causes these
 term_setattr_unallocated_ttys(hald_t)
 term_use_unallocated_ttys(hald_t)
 
 auth_use_nsswitch(hald_t)
+auth_read_pam_console_data(hald_t)
 
 fstools_getattr_swap_files(hald_t)
 
 init_domtrans_script(hald_t)
 init_read_utmp(hald_t)
-#hal runs shutdown, probably need a shutdown domain
-init_rw_utmp(hald_t)
-init_telinit(hald_t)
 
 libs_exec_ld_so(hald_t)
 libs_exec_lib_files(hald_t)
 
 logging_send_audit_msgs(hald_t)
 logging_send_syslog_msg(hald_t)
-logging_search_logs(hald_t)
 
-miscfiles_read_localization(hald_t)
 miscfiles_read_hwdata(hald_t)
 
 modutils_domtrans_insmod(hald_t)
@@ -211,7 +204,6 @@
 seutil_read_default_contexts(hald_t)
 seutil_read_file_contexts(hald_t)
 
-sysnet_read_config(hald_t)
 sysnet_domtrans_dhcpc(hald_t)
 sysnet_domtrans_ifconfig(hald_t)
 sysnet_read_dhcp_config(hald_t)
@@ -229,8 +221,6 @@
 ')
 
 optional_policy(`
-	# For /usr/libexec/hald-addon-acpi
-	# writes to /var/run/acpid.socket
 	apm_stream_connect(hald_t)
 ')
 
@@ -260,10 +250,13 @@
 	optional_policy(`
 		networkmanager_dbus_chat(hald_t)
 	')
+
+	optional_policy(`
+		policykit_dbus_chat(hald_t)
+	')
 ')
 
 optional_policy(`
-	# For /usr/libexec/hald-probe-smbios
 	dmidecode_domtrans(hald_t)
 ')
 
@@ -302,7 +295,6 @@
 ')
 
 optional_policy(`
-        policykit_dbus_chat(hald_t)
 	policykit_domtrans_auth(hald_t)
 	policykit_domtrans_resolve(hald_t)
 	policykit_read_lib(hald_t)
@@ -318,6 +310,10 @@
 ')
 
 optional_policy(`
+	shutdown_domtrans(hald_t)
+')
+
+optional_policy(`
 	udev_domtrans(hald_t)
 	udev_read_db(hald_t)
 ')
@@ -340,20 +336,15 @@
 
 ########################################
 #
-# Hal acl local policy
+# ACL local policy
 #
 
 allow hald_acl_t self:capability { dac_override fowner sys_resource };
 allow hald_acl_t self:process { getattr signal };
 allow hald_acl_t self:fifo_file rw_fifo_file_perms;
 
-domtrans_pattern(hald_t, hald_acl_exec_t, hald_acl_t)
-allow hald_t hald_acl_t:process signal;
-allow hald_acl_t hald_t:unix_stream_socket connectto;
-
 manage_dirs_pattern(hald_acl_t, hald_var_lib_t, hald_var_lib_t)
 manage_files_pattern(hald_acl_t, hald_var_lib_t, hald_var_lib_t)
-files_search_var_lib(hald_acl_t)
 
 manage_dirs_pattern(hald_acl_t, hald_var_run_t, hald_var_run_t)
 manage_files_pattern(hald_acl_t, hald_var_run_t, hald_var_run_t)
@@ -371,9 +362,6 @@
 dev_setattr_generic_usb_dev(hald_acl_t)
 dev_setattr_usbfs_files(hald_acl_t)
 
-files_read_usr_files(hald_acl_t)
-files_read_etc_files(hald_acl_t)
-
 fs_getattr_all_fs(hald_acl_t)
 
 storage_getattr_removable_dev(hald_acl_t)
@@ -385,10 +373,15 @@
 
 logging_send_syslog_msg(hald_acl_t)
 
-miscfiles_read_localization(hald_acl_t)
+optional_policy(`
+	dbus_system_bus_client(hald_acl_t)
+
+	optional_policy(`
+		policykit_dbus_chat(hald_acl_t)
+	')
+')
 
 optional_policy(`
-        policykit_dbus_chat(hald_acl_t)
 	policykit_domtrans_auth(hald_acl_t)
 	policykit_read_lib(hald_acl_t)
 	policykit_read_reload(hald_acl_t)
@@ -396,20 +389,15 @@
 
 ########################################
 #
-# Local hald mac policy
+# MAC local policy
 #
 
 allow hald_mac_t self:capability { setgid setuid sys_admin };
 
-domtrans_pattern(hald_t, hald_mac_exec_t, hald_mac_t)
-allow hald_t hald_mac_t:process signal;
-allow hald_mac_t hald_t:unix_stream_socket connectto;
-
 manage_dirs_pattern(hald_mac_t, hald_var_lib_t, hald_var_lib_t)
 manage_files_pattern(hald_mac_t, hald_var_lib_t, hald_var_lib_t)
-files_search_var_lib(hald_mac_t)
 
-write_files_pattern(hald_mac_t, hald_log_t, hald_log_t)
+append_files_pattern(hald_mac_t, hald_log_t, hald_log_t)
 
 kernel_read_system_state(hald_mac_t)
 
@@ -417,62 +405,45 @@
 dev_write_raw_memory(hald_mac_t)
 dev_read_sysfs(hald_mac_t)
 
-files_read_usr_files(hald_mac_t)
-files_read_etc_files(hald_mac_t)
-
 auth_use_nsswitch(hald_mac_t)
 
 logging_send_syslog_msg(hald_mac_t)
-
-miscfiles_read_localization(hald_mac_t)
+logging_search_logs(hald_mac_t)
 
 ########################################
 #
-# Local hald sonypic policy
+# Sonypic local policy
 #
 
-domtrans_pattern(hald_t, hald_sonypic_exec_t, hald_sonypic_t)
-allow hald_t hald_sonypic_t:process signal;
-allow hald_sonypic_t hald_t:unix_stream_socket connectto;
-
 dev_read_video_dev(hald_sonypic_t)
 dev_write_video_dev(hald_sonypic_t)
 
 manage_dirs_pattern(hald_sonypic_t, hald_var_lib_t, hald_var_lib_t)
 manage_files_pattern(hald_sonypic_t, hald_var_lib_t, hald_var_lib_t)
-files_search_var_lib(hald_sonypic_t)
 
-write_files_pattern(hald_sonypic_t, hald_log_t, hald_log_t)
+append_files_pattern(hald_sonypic_t, hald_log_t, hald_log_t)
 
-files_read_usr_files(hald_sonypic_t)
-
-miscfiles_read_localization(hald_sonypic_t)
+logging_search_logs(hald_sonypic_t)
 
 ########################################
 #
-# Hal keymap local policy
+# Keymap local policy
 #
 
-domtrans_pattern(hald_t, hald_keymap_exec_t, hald_keymap_t)
-allow hald_t hald_keymap_t:process signal;
-allow hald_keymap_t hald_t:unix_stream_socket connectto;
-
 manage_dirs_pattern(hald_keymap_t, hald_var_lib_t, hald_var_lib_t)
 manage_files_pattern(hald_keymap_t, hald_var_lib_t, hald_var_lib_t)
-files_search_var_lib(hald_keymap_t)
 
 write_files_pattern(hald_keymap_t, hald_log_t, hald_log_t)
 
 dev_rw_input_dev(hald_keymap_t)
 
 files_read_etc_files(hald_keymap_t)
-files_read_usr_files(hald_keymap_t)
 
-miscfiles_read_localization(hald_keymap_t)
+logging_search_logs(hald_keymap_t)
 
 ########################################
 #
-# Local hald dccm policy
+# Dccm local policy
 #
 
 allow hald_dccm_t self:capability { chown net_bind_service };
@@ -482,13 +453,8 @@
 allow hald_dccm_t self:udp_socket create_socket_perms;
 allow hald_dccm_t self:netlink_route_socket rw_netlink_socket_perms;
 
-domtrans_pattern(hald_t, hald_dccm_exec_t, hald_dccm_t)
-allow hald_t hald_dccm_t:process signal;
-allow hald_dccm_t hald_t:unix_stream_socket connectto;
-
 manage_dirs_pattern(hald_dccm_t, hald_var_lib_t, hald_var_lib_t)
 manage_files_pattern(hald_dccm_t, hald_var_lib_t, hald_var_lib_t)
-files_search_var_lib(hald_dccm_t)
 
 manage_dirs_pattern(hald_dccm_t, hald_var_run_t, hald_var_run_t)
 manage_files_pattern(hald_dccm_t, hald_var_run_t, hald_var_run_t)
@@ -498,12 +464,10 @@
 manage_sock_files_pattern(hald_dccm_t, hald_tmp_t, hald_tmp_t)
 files_tmp_filetrans(hald_dccm_t, hald_tmp_t, sock_file)
 
-write_files_pattern(hald_dccm_t, hald_log_t, hald_log_t)
+append_files_pattern(hald_dccm_t, hald_log_t, hald_log_t)
 
 kernel_search_network_sysctl(hald_dccm_t)
 
-dev_read_urand(hald_dccm_t)
-
 corenet_all_recvfrom_unlabeled(hald_dccm_t)
 corenet_all_recvfrom_netlabel(hald_dccm_t)
 corenet_tcp_sendrecv_generic_if(hald_dccm_t)
@@ -514,15 +478,20 @@
 corenet_udp_sendrecv_all_ports(hald_dccm_t)
 corenet_tcp_bind_generic_node(hald_dccm_t)
 corenet_udp_bind_generic_node(hald_dccm_t)
+
+corenet_sendrecv_dhcpc_server_packets(hald_dccm_t)
 corenet_udp_bind_dhcpc_port(hald_dccm_t)
+
+corenet_sendrecv_ftp_server_packets(hald_dccm_t)
 corenet_tcp_bind_ftp_port(hald_dccm_t)
-corenet_tcp_bind_dccm_port(hald_dccm_t)
 
-logging_send_syslog_msg(hald_dccm_t)
+corenet_sendrecv_dccm_server_packets(hald_dccm_t)
+corenet_tcp_bind_dccm_port(hald_dccm_t)
 
-files_read_usr_files(hald_dccm_t)
+dev_read_urand(hald_dccm_t)
 
-miscfiles_read_localization(hald_dccm_t)
+logging_send_syslog_msg(hald_dccm_t)
+logging_search_logs(hald_dccm_t)
 
 hal_dontaudit_rw_dgram_sockets(hald_dccm_t)
 
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/hddtemp.fc refpolicy/policy/modules/contrib/hddtemp.fc
--- refpolicy/policy/modules/contrib/hddtemp.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/hddtemp.fc	2012-10-06 17:52:38.721732477 +0200
@@ -1,5 +1,5 @@
 /etc/rc\.d/init\.d/hddtemp	--	gen_context(system_u:object_r:hddtemp_initrc_exec_t,s0)
 
-/etc/sysconfig/hddtemp		--	gen_context(system_u:object_r:hddtemp_etc_t,s0)
+/etc/sysconfig/hddtemp	--	gen_context(system_u:object_r:hddtemp_etc_t,s0)
 
-/usr/sbin/hddtemp		--	gen_context(system_u:object_r:hddtemp_exec_t,s0)
+/usr/sbin/hddtemp	--	gen_context(system_u:object_r:hddtemp_exec_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/hddtemp.if refpolicy/policy/modules/contrib/hddtemp.if
--- refpolicy/policy/modules/contrib/hddtemp.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/hddtemp.if	2012-10-06 17:52:38.722732477 +0200
@@ -1,4 +1,4 @@
-## <summary>hddtemp hard disk temperature tool running as a daemon.</summary>
+## <summary>Hard disk temperature tool running as a daemon.</summary>
 
 #######################################
 ## <summary>
@@ -15,13 +15,13 @@
 		type hddtemp_t, hddtemp_exec_t;
 	')
 
-	domtrans_pattern($1, hddtemp_exec_t, hddtemp_t)
 	corecmd_search_bin($1)
+	domtrans_pattern($1, hddtemp_exec_t, hddtemp_t)
 ')
 
 ######################################
 ## <summary>
-##	Execute hddtemp.
+##	Execute hddtemp in the caller domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -34,8 +34,8 @@
 		type hddtemp_exec_t;
 	')
 
-	can_exec($1, hddtemp_exec_t)
 	corecmd_search_bin($1)
+	can_exec($1, hddtemp_exec_t)
 ')
 
 ########################################
@@ -70,8 +70,4 @@
 
 	admin_pattern($1, hddtemp_etc_t)
 	files_search_etc($1)
-
-	allow $1 hddtemp_t:dir list_dir_perms;
-	read_lnk_files_pattern($1, hddtemp_t, hddtemp_t)
-	kernel_search_proc($1)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/hddtemp.te refpolicy/policy/modules/contrib/hddtemp.te
--- refpolicy/policy/modules/contrib/hddtemp.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/hddtemp.te	2012-10-06 17:52:38.722732477 +0200
@@ -1,4 +1,4 @@
-policy_module(hddtemp, 1.1.0)
+policy_module(hddtemp, 1.1.1)
 
 ########################################
 #
@@ -17,14 +17,12 @@
 
 ########################################
 #
-# hddtemp local policy
+# Local policy
 #
 
 allow hddtemp_t self:capability sys_rawio;
 dontaudit hddtemp_t self:capability sys_admin;
-allow hddtemp_t self:netlink_route_socket r_netlink_socket_perms;
-allow hddtemp_t self:tcp_socket create_stream_socket_perms;
-allow hddtemp_t self:udp_socket create_socket_perms;
+allow hddtemp_t self:tcp_socket { accept listen };
 
 allow hddtemp_t hddtemp_etc_t:file read_file_perms;
 
@@ -33,7 +31,7 @@
 corenet_tcp_sendrecv_generic_if(hddtemp_t)
 corenet_tcp_sendrecv_generic_node(hddtemp_t)
 corenet_tcp_bind_generic_node(hddtemp_t)
-corenet_tcp_sendrecv_all_ports(hddtemp_t)
+
 corenet_tcp_bind_hddtemp_port(hddtemp_t)
 corenet_sendrecv_hddtemp_server_packets(hddtemp_t)
 corenet_tcp_sendrecv_hddtemp_port(hddtemp_t)
@@ -42,8 +40,10 @@
 files_read_usr_files(hddtemp_t)
 
 storage_raw_read_fixed_disk(hddtemp_t)
+storage_raw_read_removable_device(hddtemp_t)
+
+auth_use_nsswitch(hddtemp_t)
 
 logging_send_syslog_msg(hddtemp_t)
 
 miscfiles_read_localization(hddtemp_t)
-
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/howl.fc refpolicy/policy/modules/contrib/howl.fc
--- refpolicy/policy/modules/contrib/howl.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/howl.fc	2012-10-06 17:52:48.647732499 +0200
@@ -1,5 +1,6 @@
+/etc/rc\.d/init\.d/((nifd)|(mDNSResponder))	--	gen_context(system_u:object_r:howl_initrc_exec_t,s0)
 
 /usr/bin/mDNSResponder	--	gen_context(system_u:object_r:howl_exec_t,s0)
-/usr/bin/nifd		--	gen_context(system_u:object_r:howl_exec_t,s0)
+/usr/bin/nifd	--	gen_context(system_u:object_r:howl_exec_t,s0)
 
 /var/run/nifd\.pid	--	gen_context(system_u:object_r:howl_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/howl.if refpolicy/policy/modules/contrib/howl.if
--- refpolicy/policy/modules/contrib/howl.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/howl.if	2012-10-06 17:52:48.648732499 +0200
@@ -1,4 +1,4 @@
-## <summary>Port of Apple Rendezvous multicast DNS</summary>
+## <summary>Port of Apple Rendezvous multicast DNS.</summary>
 
 ########################################
 ## <summary>
@@ -17,3 +17,37 @@
 
 	allow $1 howl_t:process signal;
 ')
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an howl environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`howl_admin',`
+	gen_require(`
+		type howl_t, howl_initrc_exec_t, howl_var_run_t;
+	')
+
+	allow $1 howl_t:process { ptrace signal_perms };
+	ps_process_pattern($1, howl_t)
+
+	init_labeled_script_domtrans($1, howl_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 howl_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	files_search_pids($1)
+	admin_pattern($1, howl_var_run_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/howl.te refpolicy/policy/modules/contrib/howl.te
--- refpolicy/policy/modules/contrib/howl.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/howl.te	2012-10-06 17:52:48.648732499 +0200
@@ -1,4 +1,4 @@
-policy_module(howl, 1.9.0)
+policy_module(howl, 1.9.1)
 
 ########################################
 #
@@ -7,8 +7,12 @@
 
 type howl_t;
 type howl_exec_t;
+application_executable_file(howl_exec_t)
 init_daemon_domain(howl_t, howl_exec_t)
 
+type howl_initrc_exec_t;
+init_script_file(howl_initrc_exec_t)
+
 type howl_var_run_t;
 files_pid_file(howl_var_run_t)
 
@@ -21,8 +25,7 @@
 dontaudit howl_t self:capability sys_tty_config;
 allow howl_t self:process signal_perms;
 allow howl_t self:fifo_file rw_fifo_file_perms;
-allow howl_t self:tcp_socket create_stream_socket_perms;
-allow howl_t self:udp_socket create_socket_perms;
+allow howl_t self:tcp_socket { accept listen };
 
 manage_files_pattern(howl_t, howl_var_run_t, howl_var_run_t)
 files_pid_filetrans(howl_t, howl_var_run_t, file)
@@ -39,13 +42,14 @@
 corenet_udp_sendrecv_generic_if(howl_t)
 corenet_tcp_sendrecv_generic_node(howl_t)
 corenet_udp_sendrecv_generic_node(howl_t)
-corenet_tcp_sendrecv_all_ports(howl_t)
-corenet_udp_sendrecv_all_ports(howl_t)
 corenet_tcp_bind_generic_node(howl_t)
 corenet_udp_bind_generic_node(howl_t)
+
+corenet_sendrecv_howl_server_packets(howl_t)
 corenet_tcp_bind_howl_port(howl_t)
+corenet_tcp_sendrecv_howl_port(howl_t)
 corenet_udp_bind_howl_port(howl_t)
-corenet_sendrecv_howl_server_packets(howl_t)
+corenet_udp_sendrecv_howl_port(howl_t)
 
 dev_read_sysfs(howl_t)
 
@@ -54,24 +58,19 @@
 
 domain_use_interactive_fds(howl_t)
 
-files_read_etc_files(howl_t)
+auth_use_nsswitch(howl_t)
 
-init_rw_utmp(howl_t)
+init_read_utmp(howl_t)
+init_dontaudit_write_utmp(howl_t)
 
 logging_send_syslog_msg(howl_t)
 
 miscfiles_read_localization(howl_t)
 
-sysnet_read_config(howl_t)
-
 userdom_dontaudit_use_unpriv_user_fds(howl_t)
 userdom_dontaudit_search_user_home_dirs(howl_t)
 
 optional_policy(`
-	nis_use_ypbind(howl_t)
-')
-
-optional_policy(`
 	seutil_sigchld_newrole(howl_t)
 ')
 
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/i18n_input.fc refpolicy/policy/modules/contrib/i18n_input.fc
--- refpolicy/policy/modules/contrib/i18n_input.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/i18n_input.fc	2012-10-06 17:53:21.365732569 +0200
@@ -1,19 +1,16 @@
-#
-# /usr
-#
+/etc/init\.d/((iiimf-htt-server)|(iiimf-server)|(iiim))	--	gen_context(system_u:object_r:i18n_input_initrc_exec_t,s0)
 
-/usr/bin/iiimd\.bin	--	 gen_context(system_u:object_r:i18n_input_exec_t,s0)
-/usr/bin/httx		--	 gen_context(system_u:object_r:i18n_input_exec_t,s0)
-/usr/bin/htt_xbe	--	 gen_context(system_u:object_r:i18n_input_exec_t,s0)
-/usr/bin/iiimx		--	 gen_context(system_u:object_r:i18n_input_exec_t,s0)
+/usr/bin/iiimd	--	gen_context(system_u:object_r:i18n_input_exec_t,s0)
+/usr/bin/iiimd\.bin	--	gen_context(system_u:object_r:i18n_input_exec_t,s0)
+/usr/bin/httx	--	gen_context(system_u:object_r:i18n_input_exec_t,s0)
+/usr/bin/htt_xbe	--	gen_context(system_u:object_r:i18n_input_exec_t,s0)
+/usr/bin/iiimx	--	gen_context(system_u:object_r:i18n_input_exec_t,s0)
 
-/usr/lib/iiim/iiim-xbe	--	 gen_context(system_u:object_r:i18n_input_exec_t,s0)
+/usr/lib/iiim/iiim-xbe	--	gen_context(system_u:object_r:i18n_input_exec_t,s0)
 
-/usr/sbin/htt		--	 gen_context(system_u:object_r:i18n_input_exec_t,s0)
-/usr/sbin/htt_server	--	 gen_context(system_u:object_r:i18n_input_exec_t,s0)
+/usr/sbin/htt	--	gen_context(system_u:object_r:i18n_input_exec_t,s0)
+/usr/sbin/htt_server	--	gen_context(system_u:object_r:i18n_input_exec_t,s0)
 
-#
-# /var
-#
+/var/log/iiim(/.*)?	gen_context(system_u:object_r:i18n_input_log_t,s0)
 
-/var/run/iiim(/.*)?		 gen_context(system_u:object_r:i18n_input_var_run_t,s0)
+/var/run/iiim(/.*)?	gen_context(system_u:object_r:i18n_input_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/i18n_input.if refpolicy/policy/modules/contrib/i18n_input.if
--- refpolicy/policy/modules/contrib/i18n_input.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/i18n_input.if	2012-10-06 17:53:21.366732569 +0200
@@ -1,4 +1,4 @@
-## <summary>IIIMF htt server</summary>
+## <summary>IIIMF htt server.</summary>
 
 ########################################
 ## <summary>
@@ -13,3 +13,41 @@
 interface(`i18n_use',`
 	refpolicywarn(`$0($*) has been deprecated.')
 ')
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an i18n input environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`i18n_input_admin',`
+	gen_require(`
+		type i18n_input_t, i18n_input_initrc_exec_t, i18n_input_var_run_t;
+		type i18n_input_log_t;
+	')
+
+	allow $1 i18n_input_t:process { ptrace signal_perms };
+	ps_process_pattern($1, i18n_input_t)
+
+	init_labeled_script_domtrans($1, i18n_input_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 i18n_input_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	files_search_pids($1)
+	admin_pattern($1, i18n_input_var_run_t)
+
+	logging_search_logs($1)
+	admin_pattern($1, i18n_input_log_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/i18n_input.te refpolicy/policy/modules/contrib/i18n_input.te
--- refpolicy/policy/modules/contrib/i18n_input.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/i18n_input.te	2012-10-06 17:53:21.367732569 +0200
@@ -1,4 +1,4 @@
-policy_module(i18n_input, 1.8.0)
+policy_module(i18n_input, 1.8.1)
 
 ########################################
 #
@@ -9,22 +9,31 @@
 type i18n_input_exec_t;
 init_daemon_domain(i18n_input_t, i18n_input_exec_t)
 
+type i18n_input_initrc_exec_t;
+init_script_file(i18n_input_initrc_exec_t)
+
+type i18n_input_log_t;
+logging_log_file(i18n_input_log_t)
+
 type i18n_input_var_run_t;
 files_pid_file(i18n_input_var_run_t)
 
 ########################################
 #
-# i18n_input local policy
+# Local policy
 #
 
 allow i18n_input_t self:capability { kill setgid setuid };
 dontaudit i18n_input_t self:capability sys_tty_config;
 allow i18n_input_t self:process { signal_perms setsched setpgid };
 allow i18n_input_t self:fifo_file rw_fifo_file_perms;
-allow i18n_input_t self:unix_dgram_socket create_socket_perms;
-allow i18n_input_t self:unix_stream_socket create_stream_socket_perms;
-allow i18n_input_t self:tcp_socket create_stream_socket_perms;
-allow i18n_input_t self:udp_socket create_socket_perms;
+allow i18n_input_t self:unix_stream_socket { accept listen };
+allow i18n_input_t self:tcp_socket { accept listen };
+
+allow i18n_input_t i18n_input_log_t:dir setattr_dir_perms;
+append_files_pattern(i18n_input_t, i18n_input_log_t, i18n_input_log_t)
+create_files_pattern(i18n_input_t, i18n_input_log_t, i18n_input_log_t)
+setattr_files_pattern(i18n_input_t, i18n_input_log_t, i18n_input_log_t)
 
 manage_dirs_pattern(i18n_input_t, i18n_input_var_run_t, i18n_input_var_run_t)
 manage_files_pattern(i18n_input_t, i18n_input_var_run_t, i18n_input_var_run_t)
@@ -39,39 +48,36 @@
 corenet_all_recvfrom_unlabeled(i18n_input_t)
 corenet_all_recvfrom_netlabel(i18n_input_t)
 corenet_tcp_sendrecv_generic_if(i18n_input_t)
-corenet_udp_sendrecv_generic_if(i18n_input_t)
 corenet_tcp_sendrecv_generic_node(i18n_input_t)
-corenet_udp_sendrecv_generic_node(i18n_input_t)
 corenet_tcp_sendrecv_all_ports(i18n_input_t)
-corenet_udp_sendrecv_all_ports(i18n_input_t)
 corenet_tcp_bind_generic_node(i18n_input_t)
-corenet_tcp_bind_i18n_input_port(i18n_input_t)
-corenet_tcp_connect_all_ports(i18n_input_t)
+
 corenet_sendrecv_i18n_input_server_packets(i18n_input_t)
+corenet_tcp_bind_i18n_input_port(i18n_input_t)
+
 corenet_sendrecv_all_client_packets(i18n_input_t)
+corenet_tcp_connect_all_ports(i18n_input_t)
+
+corecmd_exec_bin(i18n_input_t)
 
 dev_read_sysfs(i18n_input_t)
 
+domain_use_interactive_fds(i18n_input_t)
+
 fs_getattr_all_fs(i18n_input_t)
 fs_search_auto_mountpoints(i18n_input_t)
 
-corecmd_search_bin(i18n_input_t)
-corecmd_exec_bin(i18n_input_t)
-
-domain_use_interactive_fds(i18n_input_t)
-
-files_read_etc_files(i18n_input_t)
 files_read_etc_runtime_files(i18n_input_t)
 files_read_usr_files(i18n_input_t)
 
+auth_use_nsswitch(i18n_input_t)
+
 init_stream_connect_script(i18n_input_t)
 
 logging_send_syslog_msg(i18n_input_t)
 
 miscfiles_read_localization(i18n_input_t)
 
-sysnet_read_config(i18n_input_t)
-
 userdom_dontaudit_use_unpriv_user_fds(i18n_input_t)
 userdom_read_user_home_content_files(i18n_input_t)
 
@@ -90,10 +96,6 @@
 ')
 
 optional_policy(`
-	nis_use_ypbind(i18n_input_t)
-')
-
-optional_policy(`
 	seutil_sigchld_newrole(i18n_input_t)
 ')
 
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/icecast.fc refpolicy/policy/modules/contrib/icecast.fc
--- refpolicy/policy/modules/contrib/icecast.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/icecast.fc	2012-10-06 17:53:28.410732583 +0200
@@ -1,7 +1,8 @@
 /etc/rc\.d/init\.d/icecast	--	gen_context(system_u:object_r:icecast_initrc_exec_t,s0)
 
-/usr/bin/icecast		--	gen_context(system_u:object_r:icecast_exec_t,s0)
+/usr/bin/icecast	--	gen_context(system_u:object_r:icecast_exec_t,s0)
 
-/var/log/icecast(/.*)?			gen_context(system_u:object_r:icecast_log_t,s0)
+/var/log/icecast(/.*)?	gen_context(system_u:object_r:icecast_log_t,s0)
 
-/var/run/icecast(/.*)?			gen_context(system_u:object_r:icecast_var_run_t,s0)
+/var/run/icecast(/.*)?	gen_context(system_u:object_r:icecast_var_run_t,s0)
+/var/run/icecast\.pid	--	gen_context(system_u:object_r:icecast_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/icecast.if refpolicy/policy/modules/contrib/icecast.if
--- refpolicy/policy/modules/contrib/icecast.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/icecast.if	2012-10-06 17:53:28.431732583 +0200
@@ -1,4 +1,4 @@
-## <summary> ShoutCast compatible streaming media server</summary>
+## <summary>ShoutCast compatible streaming media server.</summary>
 
 ########################################
 ## <summary>
@@ -15,12 +15,13 @@
 		type icecast_t, icecast_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, icecast_exec_t, icecast_t)
 ')
 
 ########################################
 ## <summary>
-##	Allow domain signal icecast
+##	Send generic signals to icecast.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -56,7 +57,7 @@
 
 ########################################
 ## <summary>
-##	Read icecast PID files.
+##	Read icecast pid files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -75,7 +76,8 @@
 
 ########################################
 ## <summary>
-##	Manage icecast pid files.
+##	Create, read, write, and delete
+##	icecast pid files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -94,7 +96,7 @@
 
 ########################################
 ## <summary>
-##	Allow the specified domain to read icecast's log files.
+##	Read icecast log files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -114,8 +116,7 @@
 
 ########################################
 ## <summary>
-##	Allow the specified domain to append
-##	icecast log files.
+##	Append icecast log files.
 ## </summary>
 ## <param name="domain">
 ## 	<summary>
@@ -134,7 +135,8 @@
 
 ########################################
 ## <summary>
-##	Allow domain to manage icecast log files
+##	Create, read, write, and delete
+##	icecast log files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -153,8 +155,8 @@
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate
-##	an icecast environment
+##	All of the rules required to
+##	administrate an icecast environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -170,19 +172,21 @@
 #
 interface(`icecast_admin',`
 	gen_require(`
-		type icecast_t, icecast_initrc_exec_t;
+		type icecast_t, icecast_initrc_exec_t, icecast_log_t;
+		type icecast_var_run_t;
 	')
 
-	ps_process_pattern($1, icecast_t)
-
-	# Allow icecast_t to restart the apache service
 	icecast_initrc_domtrans($1)
 	domain_system_change_exemption($1)
 	role_transition $2 icecast_initrc_exec_t system_r;
 	allow $2 system_r;
 
-	icecast_manage_pid_files($1)
+	allow $1 icecast_t:process { ptrace signal_perms };
+	ps_process_pattern($1, icecast_t)
 
-	icecast_manage_log($1)
+	logging_search_logs($1)
+	admin_pattern($1, icecast_log_t)
 
+	files_search_pids($1)
+	admin_pattern($1, icecast_var_run_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/icecast.te refpolicy/policy/modules/contrib/icecast.te
--- refpolicy/policy/modules/contrib/icecast.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/icecast.te	2012-10-06 17:53:28.437732583 +0200
@@ -1,37 +1,47 @@
-policy_module(icecast, 1.1.0)
+policy_module(icecast, 1.1.1)
 
 ########################################
 #
 # Declarations
 #
 
+## <desc>
+##	<p>
+##	Determine whether icecast can listen
+##	on and connect to any TCP port.
+##	</p>
+## </desc>
+gen_tunable(icecast_use_any_tcp_ports, false)
+
 type icecast_t;
 type icecast_exec_t;
+application_executable_file(icecast_exec_t)
 init_daemon_domain(icecast_t, icecast_exec_t)
 
 type icecast_initrc_exec_t;
 init_script_file(icecast_initrc_exec_t)
 
-type icecast_var_run_t;
-files_pid_file(icecast_var_run_t)
-
 type icecast_log_t;
 logging_log_file(icecast_log_t)
 
+type icecast_var_run_t;
+files_pid_file(icecast_var_run_t)
+
 ########################################
 #
-# icecast local policy
+# Local policy
 #
 
 allow icecast_t self:capability { dac_override setgid setuid sys_nice };
-allow icecast_t self:process { getsched fork setsched signal };
+allow icecast_t self:process { getsched setsched signal };
 allow icecast_t self:fifo_file rw_fifo_file_perms;
 allow icecast_t self:unix_stream_socket create_stream_socket_perms;
-allow icecast_t self:tcp_socket create_stream_socket_perms;
+allow icecast_t self:tcp_socket { accept listen };
 
-manage_dirs_pattern(icecast_t, icecast_log_t, icecast_log_t)
-manage_files_pattern(icecast_t, icecast_log_t, icecast_log_t)
-logging_log_filetrans(icecast_t, icecast_log_t, { file dir } )
+allow icecast_t icecast_log_t:dir setattr_dir_perms;
+append_files_pattern(icecast_t, icecast_log_t, icecast_log_t)
+create_files_pattern(icecast_t, icecast_log_t, icecast_log_t)
+setattr_files_pattern(icecast_t, icecast_log_t, icecast_log_t)
 
 manage_dirs_pattern(icecast_t, icecast_var_run_t, icecast_var_run_t)
 manage_files_pattern(icecast_t, icecast_var_run_t, icecast_var_run_t)
@@ -39,18 +49,35 @@
 
 kernel_read_system_state(icecast_t)
 
+corenet_all_recvfrom_unlabeled(icecast_t)
+corenet_all_recvfrom_netlabel(icecast_t)
+corenet_tcp_sendrecv_generic_if(icecast_t)
+corenet_tcp_sendrecv_generic_node(icecast_t)
+corenet_tcp_bind_generic_node(icecast_t)
+
+corenet_sendrecv_soundd_server_packets(icecast_t)
 corenet_tcp_bind_soundd_port(icecast_t)
+corenet_sendrecv_soundd_client_packets(icecast_t)
+corenet_tcp_connect_soundd_port(icecast_t)
+corenet_tcp_sendrecv_soundd_port(icecast_t)
+
+dev_read_sysfs(icecast_t)
+dev_read_urand(icecast_t)
+dev_read_rand(icecast_t)
 
-# Init script handling
 domain_use_interactive_fds(icecast_t)
 
-files_read_etc_files(icecast_t)
-
 auth_use_nsswitch(icecast_t)
 
 miscfiles_read_localization(icecast_t)
 
-sysnet_dns_name_resolve(icecast_t)
+tunable_policy(`icecast_use_any_tcp_ports',`
+	corenet_tcp_connect_all_ports(icecast_t)
+	corenet_sendrecv_all_client_packets(icecast_t)
+	corenet_tcp_bind_all_ports(icecast_t)
+	corenet_sendrecv_all_server_packets(icecast_t)
+	corenet_tcp_sendrecv_all_ports(icecast_t)
+')
 
 optional_policy(`
 	apache_read_sys_content(icecast_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/ifplugd.fc refpolicy/policy/modules/contrib/ifplugd.fc
--- refpolicy/policy/modules/contrib/ifplugd.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/ifplugd.fc	2012-10-06 17:53:36.069732601 +0200
@@ -1,7 +1,7 @@
-/etc/ifplugd(/.*)?			gen_context(system_u:object_r:ifplugd_etc_t,s0)
+/etc/ifplugd(/.*)?	gen_context(system_u:object_r:ifplugd_etc_t,s0)
 
 /etc/rc\.d/init\.d/ifplugd	--	gen_context(system_u:object_r:ifplugd_initrc_exec_t,s0)
 
-/usr/sbin/ifplugd		--	gen_context(system_u:object_r:ifplugd_exec_t,s0)
+/usr/sbin/ifplugd	--	gen_context(system_u:object_r:ifplugd_exec_t,s0)
 
-/var/run/ifplugd.*			gen_context(system_u:object_r:ifplugd_var_run_t,s0)
+/var/run/ifplugd.*	gen_context(system_u:object_r:ifplugd_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/ifplugd.if refpolicy/policy/modules/contrib/ifplugd.if
--- refpolicy/policy/modules/contrib/ifplugd.if	2012-05-04 15:16:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/ifplugd.if	2012-10-06 17:53:36.070732601 +0200
@@ -15,12 +15,13 @@
 		type ifplugd_t, ifplugd_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, ifplugd_exec_t, ifplugd_t)
 ')
 
 ########################################
 ## <summary>
-##	Send a generic signal to ifplugd
+##	Send generic signals to ifplugd.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -38,7 +39,7 @@
 
 ########################################
 ## <summary>
-##	Read ifplugd etc configuration files.
+##	Read ifplugd configuration files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -57,7 +58,8 @@
 
 ########################################
 ## <summary>
-##	Manage ifplugd etc configuration files.
+##	Create, read, write, and delete
+##	ifplugd configuration content.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -77,7 +79,7 @@
 
 ########################################
 ## <summary>
-##	Read ifplugd PID files.
+##	Read ifplugd pid files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -96,8 +98,8 @@
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate 
-##	an ifplugd environment
+##	All of the rules required to
+##	administrate an ifplugd environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -106,15 +108,15 @@
 ## </param>
 ## <param name="role">
 ##	<summary>
-##	The role to be allowed to manage the ifplugd domain.
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <rolecap/>
 #
 interface(`ifplugd_admin',`
 	gen_require(`
-		type ifplugd_t, ifplugd_etc_t;
-		type ifplugd_var_run_t, ifplugd_initrc_exec_t;
+		type ifplugd_t, ifplugd_etc_t, ifplugd_var_run_t;
+		type ifplugd_initrc_exec_t;
 	')
 
 	allow $1 ifplugd_t:process { ptrace signal_perms };
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/ifplugd.te refpolicy/policy/modules/contrib/ifplugd.te
--- refpolicy/policy/modules/contrib/ifplugd.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/ifplugd.te	2012-10-06 17:53:36.070732601 +0200
@@ -1,4 +1,4 @@
-policy_module(ifplugd, 1.0.0)
+policy_module(ifplugd, 1.0.1)
 
 ########################################
 #
@@ -9,49 +9,43 @@
 type ifplugd_exec_t;
 init_daemon_domain(ifplugd_t, ifplugd_exec_t)
 
-# config files
 type ifplugd_etc_t;
 files_type(ifplugd_etc_t)
 
 type ifplugd_initrc_exec_t;
 init_script_file(ifplugd_initrc_exec_t)
 
-# pid files
 type ifplugd_var_run_t;
 files_pid_file(ifplugd_var_run_t)
 
 ########################################
 #
-# ifplugd local policy
+# Local policy
 #
 
 allow ifplugd_t self:capability { net_admin sys_nice net_bind_service };
-dontaudit ifplugd_t self:capability { sys_tty_config sys_ptrace };
+dontaudit ifplugd_t self:capability sys_tty_config;
 allow ifplugd_t self:process { signal signull };
 allow ifplugd_t self:fifo_file rw_fifo_file_perms;
-allow ifplugd_t self:tcp_socket create_stream_socket_perms;
-allow ifplugd_t self:udp_socket create_socket_perms;
+allow ifplugd_t self:tcp_socket { accept listen };
 allow ifplugd_t self:packet_socket create_socket_perms;
-allow ifplugd_t self:netlink_route_socket create_netlink_socket_perms;
+allow ifplugd_t self:netlink_route_socket nlmsg_write;
+
+read_files_pattern(ifplugd_t, ifplugd_etc_t, ifplugd_etc_t)
+exec_files_pattern(ifplugd_t, ifplugd_etc_t, ifplugd_etc_t)
 
-# pid file
 manage_files_pattern(ifplugd_t, ifplugd_var_run_t, ifplugd_var_run_t)
 manage_sock_files_pattern(ifplugd_t, ifplugd_var_run_t, ifplugd_var_run_t)
 files_pid_filetrans(ifplugd_t, ifplugd_var_run_t, { file sock_file })
 
-# config files
-read_files_pattern(ifplugd_t, ifplugd_etc_t, ifplugd_etc_t)
-exec_files_pattern(ifplugd_t, ifplugd_etc_t, ifplugd_etc_t)
-
-kernel_read_system_state(ifplugd_t)
+kernel_read_kernel_sysctls(ifplugd_t)
 kernel_read_network_state(ifplugd_t)
+kernel_read_system_state(ifplugd_t)
 kernel_rw_net_sysctls(ifplugd_t)
-kernel_read_kernel_sysctls(ifplugd_t)
 
-corecmd_exec_shell(ifplugd_t)
 corecmd_exec_bin(ifplugd_t)
+corecmd_exec_shell(ifplugd_t)
 
-# reading of hardware information
 dev_read_sysfs(ifplugd_t)
 
 domain_read_confined_domains_state(ifplugd_t)
@@ -64,7 +58,7 @@
 miscfiles_read_localization(ifplugd_t)
 
 netutils_domtrans(ifplugd_t)
-# transition to ifconfig & dhcpc
+
 sysnet_domtrans_ifconfig(ifplugd_t)
 sysnet_domtrans_dhcpc(ifplugd_t)
 sysnet_delete_dhcpc_pid(ifplugd_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/imaze.fc refpolicy/policy/modules/contrib/imaze.fc
--- refpolicy/policy/modules/contrib/imaze.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/imaze.fc	2012-10-06 17:53:43.258732615 +0200
@@ -1,4 +1,7 @@
-/usr/games/imazesrv		 --	gen_context(system_u:object_r:imazesrv_exec_t,s0)
-/usr/share/games/imaze(/.*)?		gen_context(system_u:object_r:imazesrv_data_t,s0)
+/usr/games/imazesrv	--	gen_context(system_u:object_r:imazesrv_exec_t,s0)
 
-/var/log/imaze\.log		 --	gen_context(system_u:object_r:imazesrv_log_t,s0)
+/usr/share/games/imaze(/.*)?	gen_context(system_u:object_r:imazesrv_data_t,s0)
+
+/var/log/imaze\.log.*	--	gen_context(system_u:object_r:imazesrv_log_t,s0)
+
+/var/run/imaze\.pid	--	gen_context(system_u:object_r:imazesrv_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/imaze.if refpolicy/policy/modules/contrib/imaze.if
--- refpolicy/policy/modules/contrib/imaze.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/imaze.if	2012-10-06 17:53:43.265732615 +0200
@@ -1 +1 @@
-## <summary>iMaze game server</summary>
+## <summary>iMaze game server.</summary>
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/imaze.te refpolicy/policy/modules/contrib/imaze.te
--- refpolicy/policy/modules/contrib/imaze.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/imaze.te	2012-10-06 17:53:43.268732615 +0200
@@ -1,4 +1,4 @@
-policy_module(imaze, 1.7.0)
+policy_module(imaze, 1.7.1)
 
 ########################################
 #
@@ -7,14 +7,12 @@
 
 type imazesrv_t;
 type imazesrv_exec_t;
+application_executable_file(imazesrv_exec_t)
 init_daemon_domain(imazesrv_t, imazesrv_exec_t)
 
 type imazesrv_data_t;
 files_type(imazesrv_data_t)
 
-type imazesrv_data_labs_t;
-files_type(imazesrv_data_labs_t)
-
 type imazesrv_log_t;
 logging_log_file(imazesrv_log_t)
 
@@ -28,30 +26,23 @@
 
 dontaudit imazesrv_t self:capability sys_tty_config;
 allow imazesrv_t self:process ~{ ptrace setcurrent setexec setfscreate setrlimit execmem execstack execheap };
-allow imazesrv_t self:fd use;
 allow imazesrv_t self:fifo_file rw_fifo_file_perms;
-allow imazesrv_t self:unix_dgram_socket { create_socket_perms sendto };
-allow imazesrv_t self:unix_stream_socket { create_stream_socket_perms connectto };
-allow imazesrv_t self:shm create_shm_perms;
-allow imazesrv_t self:sem create_sem_perms;
-allow imazesrv_t self:msgq create_msgq_perms;
-allow imazesrv_t self:msg { send receive };
-allow imazesrv_t self:tcp_socket create_stream_socket_perms;
-allow imazesrv_t self:udp_socket create_socket_perms;
+allow imazesrv_t self:tcp_socket { accept listen };
+allow imazesrv_t self:unix_dgram_socket sendto;
+allow imazesrv_t self:unix_stream_socket { accept connectto listen };
 
 allow imazesrv_t imazesrv_data_t:dir list_dir_perms;
 read_files_pattern(imazesrv_t, imazesrv_data_t, imazesrv_data_t)
 read_lnk_files_pattern(imazesrv_t, imazesrv_data_t, imazesrv_data_t)
 
-allow imazesrv_t imazesrv_log_t:file manage_file_perms;
-allow imazesrv_t imazesrv_log_t:dir add_entry_dir_perms;
+allow imazesrv_t imazesrv_log_t:file { append_file_perms create_file_perms setattr_file_perms };
 logging_log_filetrans(imazesrv_t, imazesrv_log_t, file)
 
 manage_files_pattern(imazesrv_t, imazesrv_var_run_t, imazesrv_var_run_t)
 files_pid_filetrans(imazesrv_t, imazesrv_var_run_t, file)
 
-kernel_read_kernel_sysctls(imazesrv_t)
 kernel_list_proc(imazesrv_t)
+kernel_read_kernel_sysctls(imazesrv_t)
 kernel_read_proc_symlinks(imazesrv_t)
 
 corenet_all_recvfrom_unlabeled(imazesrv_t)
@@ -60,37 +51,32 @@
 corenet_udp_sendrecv_generic_if(imazesrv_t)
 corenet_tcp_sendrecv_generic_node(imazesrv_t)
 corenet_udp_sendrecv_generic_node(imazesrv_t)
-corenet_tcp_sendrecv_all_ports(imazesrv_t)
-corenet_udp_sendrecv_all_ports(imazesrv_t)
 corenet_tcp_bind_generic_node(imazesrv_t)
 corenet_udp_bind_generic_node(imazesrv_t)
+
+corenet_sendrecv_imaze_server_packets(imazesrv_t)
 corenet_tcp_bind_imaze_port(imazesrv_t)
+corenet_tcp_sendrecv_imaze_port(imazesrv_t)
 corenet_udp_bind_imaze_port(imazesrv_t)
-corenet_sendrecv_imaze_server_packets(imazesrv_t)
+corenet_udp_sendrecv_imaze_port(imazesrv_t)
 
 dev_read_sysfs(imazesrv_t)
 
 domain_use_interactive_fds(imazesrv_t)
 
-files_read_etc_files(imazesrv_t)
-
 fs_getattr_all_fs(imazesrv_t)
 fs_search_auto_mountpoints(imazesrv_t)
 
+auth_use_nsswitch(imazesrv_t)
+
 logging_send_syslog_msg(imazesrv_t)
 
 miscfiles_read_localization(imazesrv_t)
 
-sysnet_read_config(imazesrv_t)
-
 userdom_use_unpriv_users_fds(imazesrv_t)
 userdom_dontaudit_search_user_home_dirs(imazesrv_t)
 
 optional_policy(`
-	nis_use_ypbind(imazesrv_t)
-')
-
-optional_policy(`
 	seutil_sigchld_newrole(imazesrv_t)
 ')
 
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/inetd.fc refpolicy/policy/modules/contrib/inetd.fc
--- refpolicy/policy/modules/contrib/inetd.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/inetd.fc	2012-10-06 17:53:50.059732631 +0200
@@ -1,12 +1,14 @@
+/usr/lib/pysieved/pysieved.*\.py	--	gen_context(system_u:object_r:inetd_child_exec_t,s0)
+
+/usr/local/lib/pysieved/pysieved.*\.py	--	gen_context(system_u:object_r:inetd_child_exec_t,s0)
 
 /usr/sbin/identd	--	gen_context(system_u:object_r:inetd_child_exec_t,s0)
 /usr/sbin/in\..*d	--	gen_context(system_u:object_r:inetd_child_exec_t,s0)
-/usr/local/lib/pysieved/pysieved.*\.py -- gen_context(system_u:object_r:inetd_child_exec_t,s0)
 
-/usr/sbin/inetd		--	gen_context(system_u:object_r:inetd_exec_t,s0)
+/usr/sbin/inetd	--	gen_context(system_u:object_r:inetd_exec_t,s0)
 /usr/sbin/rlinetd	--	gen_context(system_u:object_r:inetd_exec_t,s0)
 /usr/sbin/xinetd	--	gen_context(system_u:object_r:inetd_exec_t,s0)
 
-/var/log/(x)?inetd\.log	--	gen_context(system_u:object_r:inetd_log_t,s0)
+/var/log/(x)?inetd\.log.*	--	gen_context(system_u:object_r:inetd_log_t,s0)
 
 /var/run/(x)?inetd\.pid	--	gen_context(system_u:object_r:inetd_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/inetd.if refpolicy/policy/modules/contrib/inetd.if
--- refpolicy/policy/modules/contrib/inetd.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/inetd.if	2012-10-06 17:53:50.070732631 +0200
@@ -115,7 +115,6 @@
 	allow $1 inetd_t:tcp_socket rw_stream_socket_perms;
 	allow $1 inetd_t:udp_socket rw_socket_perms;
 
-	# encrypt the service through stunnel
 	optional_policy(`
 		stunnel_service_domain($1, $2)
 	')
@@ -123,7 +122,7 @@
 
 ########################################
 ## <summary>
-##	Inherit and use file descriptors from inetd.
+##	Inherit and use inetd file descriptors.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -155,7 +154,8 @@
 
 ########################################
 ## <summary>
-##	Run inetd child process in the inet child domain
+##	Run inetd child process in the
+##	inet child domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/inetd.te refpolicy/policy/modules/contrib/inetd.te
--- refpolicy/policy/modules/contrib/inetd.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/inetd.te	2012-10-06 17:54:02.218732657 +0200
@@ -1,4 +1,4 @@
-policy_module(inetd, 1.12.0)
+policy_module(inetd, 1.12.2)
 
 ########################################
 #
@@ -21,7 +21,6 @@
 type inetd_child_t;
 type inetd_child_exec_t;
 inetd_service_domain(inetd_child_t, inetd_child_exec_t)
-role system_r types inetd_child_t;
 
 type inetd_child_tmp_t;
 files_tmp_file(inetd_child_tmp_t)
@@ -42,11 +41,10 @@
 dontaudit inetd_t self:capability sys_tty_config;
 allow inetd_t self:process { setsched setexec setrlimit };
 allow inetd_t self:fifo_file rw_fifo_file_perms;
-allow inetd_t self:tcp_socket create_stream_socket_perms;
-allow inetd_t self:udp_socket create_socket_perms;
+allow inetd_t self:tcp_socket { accept listen };
 allow inetd_t self:fd use;
 
-allow inetd_t inetd_log_t:file manage_file_perms;
+allow inetd_t inetd_log_t:file { append_file_perms create_file_perms setattr_file_perms };
 logging_log_filetrans(inetd_t, inetd_log_t, file)
 
 manage_dirs_pattern(inetd_t, inetd_tmp_t, inetd_tmp_t)
@@ -64,7 +62,6 @@
 
 corecmd_bin_domtrans(inetd_t, inetd_child_t)
 
-# base networking:
 corenet_all_recvfrom_unlabeled(inetd_t)
 corenet_all_recvfrom_netlabel(inetd_t)
 corenet_tcp_sendrecv_generic_if(inetd_t)
@@ -75,69 +72,85 @@
 corenet_udp_sendrecv_all_ports(inetd_t)
 corenet_tcp_bind_generic_node(inetd_t)
 corenet_udp_bind_generic_node(inetd_t)
-corenet_tcp_connect_all_ports(inetd_t)
+
 corenet_sendrecv_all_client_packets(inetd_t)
+corenet_tcp_connect_all_ports(inetd_t)
 
-# listen on service ports:
+corenet_sendrecv_amanda_server_packets(inetd_t)
 corenet_tcp_bind_amanda_port(inetd_t)
 corenet_udp_bind_amanda_port(inetd_t)
+
+corenet_sendrecv_auth_server_packets(inetd_t)
 corenet_tcp_bind_auth_port(inetd_t)
+
+corenet_sendrecv_comsat_server_packets(inetd_t)
 corenet_udp_bind_comsat_port(inetd_t)
+
+corenet_sendrecv_dbskkd_server_packets(inetd_t)
 corenet_tcp_bind_dbskkd_port(inetd_t)
 corenet_udp_bind_dbskkd_port(inetd_t)
+
+corenet_sendrecv_ftp_server_packets(inetd_t)
 corenet_tcp_bind_ftp_port(inetd_t)
 corenet_udp_bind_ftp_port(inetd_t)
+
+corenet_sendrecv_inetd_child_server_packets(inetd_t)
 corenet_tcp_bind_inetd_child_port(inetd_t)
 corenet_udp_bind_inetd_child_port(inetd_t)
+
+corenet_sendrecv_ircd_server_packets(inetd_t)
 corenet_tcp_bind_ircd_port(inetd_t)
+
+corenet_sendrecv_ktalkd_server_packets(inetd_t)
 corenet_udp_bind_ktalkd_port(inetd_t)
+
+corenet_sendrecv_pop_server_packets(inetd_t)
 corenet_tcp_bind_pop_port(inetd_t)
+
+corenet_sendrecv_printer_server_packets(inetd_t)
 corenet_tcp_bind_printer_port(inetd_t)
+
+corenet_sendrecv_rlogind_server_packets(inetd_t)
 corenet_udp_bind_rlogind_port(inetd_t)
+
+corenet_sendrecv_rsh_server_packets(inetd_t)
 corenet_udp_bind_rsh_port(inetd_t)
 corenet_tcp_bind_rsh_port(inetd_t)
+
+corenet_sendrecv_rsync_server_packets(inetd_t)
 corenet_tcp_bind_rsync_port(inetd_t)
 corenet_udp_bind_rsync_port(inetd_t)
+
+corenet_sendrecv_stunnel_server_packets(inetd_t)
 corenet_tcp_bind_stunnel_port(inetd_t)
+
+corenet_sendrecv_swat_server_packets(inetd_t)
 corenet_tcp_bind_swat_port(inetd_t)
 corenet_udp_bind_swat_port(inetd_t)
+
+corenet_sendrecv_telnetd_server_packets(inetd_t)
 corenet_tcp_bind_telnetd_port(inetd_t)
+
+corenet_sendrecv_tftp_server_packets(inetd_t)
 corenet_udp_bind_tftp_port(inetd_t)
+
+corenet_sendrecv_ssh_server_packets(inetd_t)
 corenet_tcp_bind_ssh_port(inetd_t)
+
+corenet_sendrecv_git_server_packets(inetd_t)
 corenet_tcp_bind_git_port(inetd_t)
 corenet_udp_bind_git_port(inetd_t)
 
-# service port packets:
-corenet_sendrecv_amanda_server_packets(inetd_t)
-corenet_sendrecv_auth_server_packets(inetd_t)
-corenet_sendrecv_comsat_server_packets(inetd_t)
-corenet_sendrecv_dbskkd_server_packets(inetd_t)
-corenet_sendrecv_ftp_server_packets(inetd_t)
-corenet_sendrecv_inetd_child_server_packets(inetd_t)
-corenet_sendrecv_ircd_server_packets(inetd_t)
-corenet_sendrecv_ktalkd_server_packets(inetd_t)
-corenet_sendrecv_printer_server_packets(inetd_t)
-corenet_sendrecv_rsh_server_packets(inetd_t)
-corenet_sendrecv_rsync_server_packets(inetd_t)
-corenet_sendrecv_stunnel_server_packets(inetd_t)
-corenet_sendrecv_swat_server_packets(inetd_t)
-corenet_sendrecv_tftp_server_packets(inetd_t)
-
 dev_read_sysfs(inetd_t)
 
+domain_use_interactive_fds(inetd_t)
+
 fs_getattr_all_fs(inetd_t)
 fs_search_auto_mountpoints(inetd_t)
 
 selinux_validate_context(inetd_t)
 selinux_compute_create_context(inetd_t)
 
-# Run other daemons in the inetd_child_t domain.
-corecmd_search_bin(inetd_t)
-corecmd_read_bin_symlinks(inetd_t)
-
-domain_use_interactive_fds(inetd_t)
-
-files_read_etc_files(inetd_t)
 files_read_etc_runtime_files(inetd_t)
 
 auth_use_nsswitch(inetd_t)
@@ -146,14 +159,12 @@
 
 miscfiles_read_localization(inetd_t)
 
-# xinetd needs MLS override privileges to work
 mls_fd_share_all_levels(inetd_t)
 mls_socket_read_to_clearance(inetd_t)
 mls_socket_write_to_clearance(inetd_t)
+mls_net_outbound_all_levels(inetd_t)
 mls_process_set_level(inetd_t)
 
-sysnet_read_config(inetd_t)
-
 userdom_dontaudit_use_unpriv_user_fds(inetd_t)
 userdom_dontaudit_search_user_home_dirs(inetd_t)
 
@@ -177,6 +188,10 @@
 ')
 
 optional_policy(`
+	tftp_read_config_files(inetd_t)
+')
+
+optional_policy(`
 	udev_read_db(inetd_t)
 ')
 
@@ -186,18 +201,13 @@
 
 ########################################
 #
-# inetd child local_policy
+# Child local policy
 #
 
+allow inetd_child_t self:capability { setuid setgid };
 allow inetd_child_t self:process signal_perms;
 allow inetd_child_t self:fifo_file rw_fifo_file_perms;
-allow inetd_child_t self:tcp_socket connected_stream_socket_perms;
-allow inetd_child_t self:udp_socket create_socket_perms;
-
-# for identd
-allow inetd_child_t self:netlink_tcpdiag_socket r_netlink_socket_perms;
-allow inetd_child_t self:capability { setuid setgid };
-files_search_home(inetd_child_t)
+allow inetd_child_t self:tcp_socket { accept listen };
 
 manage_dirs_pattern(inetd_child_t, inetd_child_tmp_t, inetd_child_tmp_t)
 manage_files_pattern(inetd_child_t, inetd_child_tmp_t, inetd_child_tmp_t)
@@ -207,23 +217,13 @@
 files_pid_filetrans(inetd_child_t, inetd_child_var_run_t, file)
 
 kernel_read_kernel_sysctls(inetd_child_t)
-kernel_read_system_state(inetd_child_t)
 kernel_read_network_state(inetd_child_t)
-
-corenet_all_recvfrom_unlabeled(inetd_child_t)
-corenet_all_recvfrom_netlabel(inetd_child_t)
-corenet_tcp_sendrecv_generic_if(inetd_child_t)
-corenet_udp_sendrecv_generic_if(inetd_child_t)
-corenet_tcp_sendrecv_generic_node(inetd_child_t)
-corenet_udp_sendrecv_generic_node(inetd_child_t)
-corenet_tcp_sendrecv_all_ports(inetd_child_t)
-corenet_udp_sendrecv_all_ports(inetd_child_t)
+kernel_read_system_state(inetd_child_t)
 
 dev_read_urand(inetd_child_t)
 
 fs_getattr_xattr_fs(inetd_child_t)
 
-files_read_etc_files(inetd_child_t)
 files_read_etc_runtime_files(inetd_child_t)
 
 auth_use_nsswitch(inetd_child_t)
@@ -232,12 +232,6 @@
 
 miscfiles_read_localization(inetd_child_t)
 
-sysnet_read_config(inetd_child_t)
-
-optional_policy(`
-	kerberos_use(inetd_child_t)
-')
-
 optional_policy(`
 	unconfined_domain(inetd_child_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/inn.fc refpolicy/policy/modules/contrib/inn.fc
--- refpolicy/policy/modules/contrib/inn.fc	2012-05-04 16:16:32.000000000 +0200
+++ refpolicy/policy/modules/contrib/inn.fc	2012-11-02 20:07:55.044957347 +0100
@@ -1,23 +1,17 @@
+/etc/news(/.*)?	gen_context(system_u:object_r:innd_etc_t,s0)
+/etc/news/boot	--	gen_context(system_u:object_r:innd_exec_t,s0)
 
-#
-# /etc
-#
-/etc/news(/.*)?				gen_context(system_u:object_r:innd_etc_t,s0)
-/etc/news/boot		--		gen_context(system_u:object_r:innd_exec_t,s0)
-/etc/rc\.d/init\.d/innd	--		gen_context(system_u:object_r:innd_initrc_exec_t,s0)
-
-#
-# /usr
-#
-/usr/bin/inews		--		gen_context(system_u:object_r:innd_exec_t,s0)
-/usr/bin/rnews		--		gen_context(system_u:object_r:innd_exec_t,s0)
-/usr/bin/rpost		--		gen_context(system_u:object_r:innd_exec_t,s0)
-/usr/bin/suck		--		gen_context(system_u:object_r:innd_exec_t,s0)
+/etc/rc\.d/init\.d/innd	--	gen_context(system_u:object_r:innd_initrc_exec_t,s0)
 
-/usr/sbin/in\.nnrpd	--		gen_context(system_u:object_r:innd_exec_t,s0)
-/usr/sbin/innd.*	--		gen_context(system_u:object_r:innd_exec_t,s0)
+/usr/bin/inews	--	gen_context(system_u:object_r:innd_exec_t,s0)
+/usr/bin/rnews	--	gen_context(system_u:object_r:innd_exec_t,s0)
+/usr/bin/rpost	--	gen_context(system_u:object_r:innd_exec_t,s0)
+/usr/bin/suck	--	gen_context(system_u:object_r:innd_exec_t,s0)
 
-/var/lib/news(/.*)?			gen_context(system_u:object_r:innd_var_lib_t,s0)
+/usr/sbin/in\.nnrpd	--	gen_context(system_u:object_r:innd_exec_t,s0)
+/usr/sbin/innd.*	--	gen_context(system_u:object_r:innd_exec_t,s0)
+
+/var/lib/news(/.*)?	gen_context(system_u:object_r:innd_var_lib_t,s0)
 
 /usr/lib/news/bin/actsync	--	gen_context(system_u:object_r:innd_exec_t,s0)
 /usr/lib/news/bin/archive	--	gen_context(system_u:object_r:innd_exec_t,s0)
@@ -32,9 +26,10 @@
 /usr/lib/news/bin/filechan	--	gen_context(system_u:object_r:innd_exec_t,s0)
 /usr/lib/news/bin/getlist	--	gen_context(system_u:object_r:innd_exec_t,s0)
 /usr/lib/news/bin/grephistory	--	gen_context(system_u:object_r:innd_exec_t,s0)
-/usr/lib/news/bin/inews		--	gen_context(system_u:object_r:innd_exec_t,s0)
+/usr/lib/news/bin/inews	--	gen_context(system_u:object_r:innd_exec_t,s0)
 /usr/lib/news/bin/innconfval	--	gen_context(system_u:object_r:innd_exec_t,s0)
-/usr/lib/news/bin/inndf		--	gen_context(system_u:object_r:innd_exec_t,s0)
+/usr/lib/news/bin/innd	--	gen_context(system_u:object_r:innd_exec_t,s0)
+/usr/lib/news/bin/inndf	--	gen_context(system_u:object_r:innd_exec_t,s0)
 /usr/lib/news/bin/inndstart	--	gen_context(system_u:object_r:innd_exec_t,s0)
 /usr/lib/news/bin/innfeed	--	gen_context(system_u:object_r:innd_exec_t,s0)
 /usr/lib/news/bin/innxbatch	--	gen_context(system_u:object_r:innd_exec_t,s0)
@@ -42,22 +37,22 @@
 /usr/lib/news/bin/makedbz	--	gen_context(system_u:object_r:innd_exec_t,s0)
 /usr/lib/news/bin/makehistory	--	gen_context(system_u:object_r:innd_exec_t,s0)
 /usr/lib/news/bin/newsrequeue	--	gen_context(system_u:object_r:innd_exec_t,s0)
-/usr/lib/news/bin/nnrpd		--	gen_context(system_u:object_r:innd_exec_t,s0)
+/usr/lib/news/bin/nnrpd	--	gen_context(system_u:object_r:innd_exec_t,s0)
 /usr/lib/news/bin/nntpget	--	gen_context(system_u:object_r:innd_exec_t,s0)
 /usr/lib/news/bin/ovdb_recover	--	gen_context(system_u:object_r:innd_exec_t,s0)
 /usr/lib/news/bin/overchan	--	gen_context(system_u:object_r:innd_exec_t,s0)
 /usr/lib/news/bin/prunehistory	--	gen_context(system_u:object_r:innd_exec_t,s0)
-/usr/lib/news/bin/rnews		--	gen_context(system_u:object_r:innd_exec_t,s0)
+/usr/lib/news/bin/rnews	--	gen_context(system_u:object_r:innd_exec_t,s0)
 /usr/lib/news/bin/shlock	--	gen_context(system_u:object_r:innd_exec_t,s0)
 /usr/lib/news/bin/shrinkfile	--	gen_context(system_u:object_r:innd_exec_t,s0)
+/usr/lib/news/bin/sm	--	gen_context(system_u:object_r:innd_exec_t,s0)
 /usr/lib/news/bin/startinnfeed	--	gen_context(system_u:object_r:innd_exec_t,s0)
 
-/usr/lib/news/bin/innd 		--	gen_context(system_u:object_r:innd_exec_t,s0)
-/usr/lib/news/bin/sm		--	gen_context(system_u:object_r:innd_exec_t,s0)
-
-/var/log/news(/.*)?			gen_context(system_u:object_r:innd_log_t,s0)
+/var/log/news.*	--	gen_context(system_u:object_r:innd_log_t,s0)
 
-/var/run/innd(/.*)?			gen_context(system_u:object_r:innd_var_run_t,s0)
-/var/run/news(/.*)?	 		gen_context(system_u:object_r:innd_var_run_t,s0)
+/var/run/innd(/.*)?	gen_context(system_u:object_r:innd_var_run_t,s0)
+/var/run/innd\.pid	--	gen_context(system_u:object_r:innd_var_run_t,s0)
+/var/run/news(/.*)?	gen_context(system_u:object_r:innd_var_run_t,s0)
+/var/run/news\.pid	--	gen_context(system_u:object_r:innd_var_run_t,s0)
 
-/var/spool/news(/.*)?			gen_context(system_u:object_r:news_spool_t,s0)
+/var/spool/news(/.*)?	gen_context(system_u:object_r:news_spool_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/inn.if refpolicy/policy/modules/contrib/inn.if
--- refpolicy/policy/modules/contrib/inn.if	2012-05-04 15:16:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/inn.if	2012-10-31 19:06:51.149580695 +0100
@@ -1,9 +1,8 @@
-## <summary>Internet News NNTP server</summary>
+## <summary>Internet News NNTP server.</summary>
 
 ########################################
 ## <summary>
-##	Allow the specified domain to execute innd
-##	in the caller domain.
+##	Execute innd in the caller domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -13,16 +12,16 @@
 #
 interface(`inn_exec',`
 	gen_require(`
-		type innd_t;
+		type innd_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	can_exec($1, innd_exec_t)
 ')
 
 ########################################
 ## <summary>
-##	Allow the specified domain to execute
-##	inn configuration files in /etc.
+##	Execute inn configuration files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -35,12 +34,14 @@
 		type innd_etc_t;
 	')
 
-	can_exec($1, innd_etc_t)
+	files_search_etc($1)
+	exec_files_pattern($1, innd_etc_t, innd_etc_t)
 ')
 
 ########################################
 ## <summary>
-##	Create, read, write, and delete the innd log.
+##	Create, read, write, and delete
+##	innd log files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -53,13 +54,42 @@
 		type innd_log_t;
 	')
 
-	logging_rw_generic_log_dirs($1)
 	manage_files_pattern($1, innd_log_t, innd_log_t)
 ')
 
 ########################################
 ## <summary>
-##	Create, read, write, and delete the innd pid files.
+##	Create specified objects in generic
+##	log directories with the innd log file type.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="object_class">
+##	<summary>
+##	Class of the object being created.
+##	</summary>
+## </param>
+## <param name="name" optional="true">
+##	<summary>
+##	The name of the object being created.
+##	</summary>
+## </param>
+#
+interface(`inn_generic_log_filetrans_innd_log',`
+	gen_require(`
+		type innd_log_t;
+	')
+
+	logging_log_filetrans($1, innd_log_t, $2, $3)
+')
+
+########################################
+## <summary>
+##	Create, read, write, and delete
+##	innd pid content.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -73,13 +103,14 @@
 	')
 
 	files_search_pids($1)
-	manage_files_pattern($1, innd_var_run_t, innd_var_run_t)
-	manage_lnk_files_pattern($1, innd_var_run_t, innd_var_run_t)
+	allow $1 innd_var_run_t:dir manage_dir_perms;
+	allow $1 innd_var_run_t:file manage_file_perms;
+	allow $1 innd_var_run_t:sock_file manage_sock_file_perms;
 ')
 
 ########################################
 ## <summary>
-##	Read innd configuration files.
+##	Read innd configuration content.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -100,7 +131,7 @@
 
 ########################################
 ## <summary>
-##	Read innd news library files.
+##	Read innd news library content.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -115,12 +146,11 @@
 
 	allow $1 innd_var_lib_t:dir list_dir_perms;
 	allow $1 innd_var_lib_t:file read_file_perms;
-	allow $1 innd_var_lib_t:lnk_file read_lnk_file_perms;
 ')
 
 ########################################
 ## <summary>
-##	Read innd news library files.
+##	Read innd news spool content.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -150,15 +180,16 @@
 #
 interface(`inn_dgram_send',`
 	gen_require(`
-		type innd_t;
+		type innd_t, innd_var_run_t;
 	')
 
-	allow $1 innd_t:unix_dgram_socket sendto;
+	files_search_pids($1)
+	dgram_send_pattern($1, innd_var_run_t, innd_var_run_t, innd_t)
 ')
 
 ########################################
 ## <summary>
-##	Execute inn in the inn domain.
+##	Execute innd in the innd domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -177,8 +208,8 @@
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate 
-##	an inn environment
+##	All of the rules required to
+##	administrate an inn environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -187,7 +218,7 @@
 ## </param>
 ## <param name="role">
 ##	<summary>
-##	The role to be allowed to manage the inn domain.
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <rolecap/>
@@ -199,14 +230,14 @@
 		type innd_var_run_t, innd_initrc_exec_t;
 	')
 
-	allow $1 innd_t:process { ptrace signal_perms };
-	ps_process_pattern($1, innd_t)
-
 	init_labeled_script_domtrans($1, innd_initrc_exec_t)
 	domain_system_change_exemption($1)
 	role_transition $2 innd_initrc_exec_t system_r;
 	allow $2 system_r;
 
+	allow $1 innd_t:process { ptrace signal_perms };
+	ps_process_pattern($1, innd_t)
+
 	files_list_etc($1)
 	admin_pattern($1, innd_etc_t)
 
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/inn.te refpolicy/policy/modules/contrib/inn.te
--- refpolicy/policy/modules/contrib/inn.te	2012-07-25 20:33:04.000000000 +0200
+++ refpolicy/policy/modules/contrib/inn.te	2012-11-12 22:32:43.890145182 +0100
@@ -1,9 +1,10 @@
-policy_module(inn, 1.10.0)
+policy_module(inn, 1.10.3)
 
 ########################################
 #
 # Declarations
 #
+
 type innd_t;
 type innd_exec_t;
 init_daemon_domain(innd_t, innd_exec_t)
@@ -30,28 +31,25 @@
 #
 # Local policy
 #
+
 allow innd_t self:capability { dac_override kill setgid setuid };
 dontaudit innd_t self:capability sys_tty_config;
 allow innd_t self:process { setsched signal_perms };
 allow innd_t self:fifo_file rw_fifo_file_perms;
-allow innd_t self:unix_dgram_socket { sendto create_socket_perms };
-allow innd_t self:unix_stream_socket { connectto create_stream_socket_perms };
-allow innd_t self:tcp_socket create_stream_socket_perms;
-allow innd_t self:udp_socket create_socket_perms;
-allow innd_t self:netlink_route_socket r_netlink_socket_perms;
+allow innd_t self:unix_dgram_socket sendto;
+allow innd_t self:unix_stream_socket { accept connectto listen };
+allow innd_t self:tcp_socket { accept listen };
 
 read_files_pattern(innd_t, innd_etc_t, innd_etc_t)
 read_lnk_files_pattern(innd_t, innd_etc_t, innd_etc_t)
 
-can_exec(innd_t, innd_exec_t)
-
-manage_files_pattern(innd_t, innd_log_t, innd_log_t)
-allow innd_t innd_log_t:dir setattr;
-logging_log_filetrans(innd_t, innd_log_t, file)
+allow innd_t innd_log_t:dir setattr_dir_perms;
+append_files_pattern(innd_t, innd_log_t, innd_log_t)
+create_files_pattern(innd_t, innd_log_t, innd_log_t)
+setattr_files_pattern(innd_t, innd_log_t, innd_log_t)
 
 manage_dirs_pattern(innd_t, innd_var_lib_t, innd_var_lib_t)
 manage_files_pattern(innd_t, innd_var_lib_t, innd_var_lib_t)
-files_var_lib_filetrans(innd_t, innd_var_lib_t, file)
 
 manage_dirs_pattern(innd_t, innd_var_run_t, innd_var_run_t)
 manage_files_pattern(innd_t, innd_var_run_t, innd_var_run_t)
@@ -62,62 +60,64 @@
 manage_files_pattern(innd_t, news_spool_t, news_spool_t)
 manage_lnk_files_pattern(innd_t, news_spool_t, news_spool_t)
 
+can_exec(innd_t, innd_exec_t)
+
 kernel_read_kernel_sysctls(innd_t)
 kernel_read_system_state(innd_t)
 
 corenet_all_recvfrom_unlabeled(innd_t)
 corenet_all_recvfrom_netlabel(innd_t)
 corenet_tcp_sendrecv_generic_if(innd_t)
-corenet_udp_sendrecv_generic_if(innd_t)
 corenet_tcp_sendrecv_generic_node(innd_t)
-corenet_udp_sendrecv_generic_node(innd_t)
 corenet_tcp_sendrecv_all_ports(innd_t)
-corenet_udp_sendrecv_all_ports(innd_t)
 corenet_tcp_bind_generic_node(innd_t)
-corenet_tcp_bind_innd_port(innd_t)
-corenet_tcp_connect_all_ports(innd_t)
+
 corenet_sendrecv_innd_server_packets(innd_t)
+corenet_tcp_bind_innd_port(innd_t)
+
 corenet_sendrecv_all_client_packets(innd_t)
+corenet_tcp_connect_all_ports(innd_t)
+
+corecmd_exec_bin(innd_t)
+corecmd_exec_shell(innd_t)
 
 dev_read_sysfs(innd_t)
 dev_read_urand(innd_t)
 
+domain_use_interactive_fds(innd_t)
+
 fs_getattr_all_fs(innd_t)
 fs_search_auto_mountpoints(innd_t)
 
-corecmd_exec_bin(innd_t)
-corecmd_exec_shell(innd_t)
-
-domain_use_interactive_fds(innd_t)
-
 files_list_spool(innd_t)
-files_read_etc_files(innd_t)
 files_read_etc_runtime_files(innd_t)
 files_read_usr_files(innd_t)
 
+auth_use_nsswitch(innd_t)
+
 logging_send_syslog_msg(innd_t)
 
 miscfiles_read_localization(innd_t)
 
 seutil_dontaudit_search_config(innd_t)
 
-sysnet_read_config(innd_t)
-
 userdom_dontaudit_use_unpriv_user_fds(innd_t)
 userdom_dontaudit_search_user_home_dirs(innd_t)
 
 mta_send_mail(innd_t)
 
-optional_policy(`
-	cron_system_entry(innd_t, innd_exec_t)
+ifdef(`distro_gentoo',`
+	logging_syslog_managed_log_file(innd_log_t, "news.crit")
+	logging_syslog_managed_log_file(innd_log_t, "news.err")
+	logging_syslog_managed_log_file(innd_log_t, "news.notice")
 ')
 
 optional_policy(`
-	hostname_exec(innd_t)
+	cron_system_entry(innd_t, innd_exec_t)
 ')
 
 optional_policy(`
-	nis_use_ypbind(innd_t)
+	hostname_exec(innd_t)
 ')
 
 optional_policy(`
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/iodine.fc refpolicy/policy/modules/contrib/iodine.fc
--- refpolicy/policy/modules/contrib/iodine.fc	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/iodine.fc	2012-10-10 21:35:40.476026379 +0200
@@ -0,0 +1,3 @@
+/etc/rc\.d/init\.d/((iodined)|(iodine-server))	--	gen_context(system_u:object_r:iodined_initrc_exec_t,s0)
+
+/usr/sbin/iodined	--	gen_context(system_u:object_r:iodined_exec_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/iodine.if refpolicy/policy/modules/contrib/iodine.if
--- refpolicy/policy/modules/contrib/iodine.if	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/iodine.if	2012-10-10 21:38:27.225026735 +0200
@@ -0,0 +1,54 @@
+## <summary>IP over DNS tunneling daemon.</summary>
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an iodined environment
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`iodined_admin',`
+	refpolicywarn(`$0($*) has been deprecated, use iodine_admin() instead.')
+	iodine_admin($1, $2)
+')
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an iodined environment
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`iodine_admin',`
+	gen_require(`
+		type iodined_t, iodined_initrc_exec_t;
+	')
+
+	allow $1 iodined_t:process { ptrace signal_perms };
+	ps_process_pattern($1, iodined_t)
+
+	init_labeled_script_domtrans($1, iodined_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 iodined_initrc_exec_t system_r;
+	allow $2 system_r;
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/iodine.te refpolicy/policy/modules/contrib/iodine.te
--- refpolicy/policy/modules/contrib/iodine.te	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/iodine.te	2012-10-10 21:38:27.225026735 +0200
@@ -0,0 +1,50 @@
+policy_module(iodine, 1.0.1)
+
+########################################
+#
+# Declarations
+#
+
+type iodined_t;
+type iodined_exec_t;
+init_daemon_domain(iodined_t, iodined_exec_t)
+
+type iodined_initrc_exec_t;
+init_script_file(iodined_initrc_exec_t)
+
+########################################
+#
+# Local policy
+#
+
+allow iodined_t self:capability { net_admin net_bind_service net_raw sys_chroot setgid setuid };
+allow iodined_t self:rawip_socket create_socket_perms;
+allow iodined_t self:tun_socket create_socket_perms;
+allow iodined_t self:udp_socket connected_socket_perms;
+
+kernel_read_net_sysctls(iodined_t)
+kernel_read_network_state(iodined_t)
+kernel_read_system_state(iodined_t)
+kernel_request_load_module(iodined_t)
+
+corenet_all_recvfrom_netlabel(iodined_t)
+corenet_all_recvfrom_unlabeled(iodined_t)
+corenet_raw_sendrecv_generic_if(iodined_t)
+corenet_udp_sendrecv_generic_if(iodined_t)
+corenet_raw_sendrecv_generic_node(iodined_t)
+corenet_udp_sendrecv_generic_node(iodined_t)
+corenet_udp_bind_generic_node(iodined_t)
+
+corenet_rw_tun_tap_dev(iodined_t)
+
+corenet_sendrecv_dns_server_packets(iodined_t)
+corenet_udp_bind_dns_port(iodined_t)
+corenet_udp_sendrecv_dns_port(iodined_t)
+
+corecmd_exec_shell(iodined_t)
+
+files_read_etc_files(iodined_t)
+
+logging_send_syslog_msg(iodined_t)
+
+sysnet_domtrans_ifconfig(iodined_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/irc.fc refpolicy/policy/modules/contrib/irc.fc
--- refpolicy/policy/modules/contrib/irc.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/irc.fc	2012-10-06 17:54:23.723732701 +0200
@@ -1,11 +1,9 @@
-#
-# /home
-#
 HOME_DIR/\.ircmotd	--	gen_context(system_u:object_r:irc_home_t,s0)
+HOME_DIR/\.irssi(/.*)?	gen_context(system_u:object_r:irc_home_t,s0)
+
+/etc/irssi\.conf	--	gen_context(system_u:object_r:irc_conf_t,s0)
 
-#
-# /usr
-#
 /usr/bin/[st]irc	--	gen_context(system_u:object_r:irc_exec_t,s0)
-/usr/bin/ircII		--	gen_context(system_u:object_r:irc_exec_t,s0)
+/usr/bin/ircII	--	gen_context(system_u:object_r:irc_exec_t,s0)
+/usr/bin/irssi	--	gen_context(system_u:object_r:irc_exec_t,s0)
 /usr/bin/tinyirc	--	gen_context(system_u:object_r:irc_exec_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/irc.if refpolicy/policy/modules/contrib/irc.if
--- refpolicy/policy/modules/contrib/irc.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/irc.if	2012-10-06 19:00:23.962741155 +0200
@@ -1,31 +1,47 @@
-## <summary>IRC client policy</summary>
+## <summary>IRC client policy.</summary>
 
 ########################################
 ## <summary>
-##	Role access for IRC
+##	Role access for IRC.
 ## </summary>
 ## <param name="role">
 ##	<summary>
-##	Role allowed access
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <param name="domain">
 ##	<summary>
-##	User domain for the role
+##	User domain for the role.
 ##	</summary>
 ## </param>
 #
 interface(`irc_role',`
 	gen_require(`
-		type irc_t, irc_exec_t;
+		attribute_role irc_roles;
+		type irc_t, irc_exec_t, irc_home_t;
+		type irc_tmp_t;
 	')
 
-	role $1 types irc_t;
+	########################################
+	#
+	# Declarations
+	#
+
+	roleattribute $1 irc_roles;
+
+	########################################
+	#
+	# Policy
+	#
 
-	# Transition from the user domain to the derived domain.
 	domtrans_pattern($2, irc_exec_t, irc_t)
 
-	# allow ps to show irc
 	ps_process_pattern($2, irc_t)
-	allow $2 irc_t:process signal;
+	allow $2 irc_t:process { ptrace signal_perms };
+
+	allow $2 { irc_home_t irc_tmp_t }:dir { manage_dir_perms relabel_dir_perms };
+	allow $2 { irc_home_t irc_tmp_t }:file { manage_file_perms relabel_file_perms };
+	allow $2 { irc_home_t irc_tmp_t }:lnk_file { manage_lnk_file_perms relabel_lnk_file_perms };
+	userdom_user_home_dir_filetrans($2, irc_home_t, dir, ".irssi")
+	userdom_user_home_dir_filetrans($2, irc_home_t, file, ".ircmotd")
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/irc.te refpolicy/policy/modules/contrib/irc.te
--- refpolicy/policy/modules/contrib/irc.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/irc.te	2012-10-30 19:33:10.535399651 +0100
@@ -1,15 +1,30 @@
-policy_module(irc, 2.2.0)
+policy_module(irc, 2.2.3)
 
 ########################################
 #
 # Declarations
 #
 
+## <desc>
+##	<p>
+##	Determine whether irc clients can
+##	listen on and connect to any
+##	unreserved TCP ports.
+##	</p>
+## </desc>
+gen_tunable(irc_use_any_tcp_ports, false)
+
+attribute_role irc_roles;
+
 type irc_t;
 type irc_exec_t;
 typealias irc_t alias { user_irc_t staff_irc_t sysadm_irc_t };
 typealias irc_t alias { auditadm_irc_t secadm_irc_t };
 userdom_user_application_domain(irc_t, irc_exec_t)
+role irc_roles types irc_t;
+
+type irc_conf_t;
+files_config_file(irc_conf_t)
 
 type irc_home_t;
 typealias irc_home_t alias { user_irc_home_t staff_irc_home_t sysadm_irc_home_t };
@@ -26,16 +41,18 @@
 # Local policy
 #
 
-allow irc_t self:unix_stream_socket create_stream_socket_perms;
-allow irc_t self:tcp_socket create_socket_perms;
-allow irc_t self:udp_socket create_socket_perms;
+allow irc_t self:process { signal sigkill };
+allow irc_t self:fifo_file rw_fifo_file_perms;
+allow irc_t self:unix_stream_socket { accept listen };
+
+allow irc_t irc_conf_t:file read_file_perms;
 
 manage_dirs_pattern(irc_t, irc_home_t, irc_home_t)
 manage_files_pattern(irc_t, irc_home_t, irc_home_t)
 manage_lnk_files_pattern(irc_t, irc_home_t, irc_home_t)
-userdom_user_home_dir_filetrans(irc_t, irc_home_t, { dir file lnk_file })
+userdom_user_home_dir_filetrans(irc_t, irc_home_t, dir, ".irssi")
+userdom_user_home_dir_filetrans(irc_t, irc_home_t, file, ".ircmotd")
 
-# access files under /tmp
 manage_dirs_pattern(irc_t, irc_tmp_t, irc_tmp_t)
 manage_files_pattern(irc_t, irc_tmp_t, irc_tmp_t)
 manage_lnk_files_pattern(irc_t, irc_tmp_t, irc_tmp_t)
@@ -43,48 +60,60 @@
 manage_sock_files_pattern(irc_t, irc_tmp_t, irc_tmp_t)
 files_tmp_filetrans(irc_t, irc_tmp_t, { file dir lnk_file sock_file fifo_file })
 
-kernel_read_proc_symlinks(irc_t)
+kernel_read_system_state(irc_t)
 
 corenet_all_recvfrom_unlabeled(irc_t)
 corenet_all_recvfrom_netlabel(irc_t)
 corenet_tcp_sendrecv_generic_if(irc_t)
-corenet_udp_sendrecv_generic_if(irc_t)
 corenet_tcp_sendrecv_generic_node(irc_t)
-corenet_udp_sendrecv_generic_node(irc_t)
 corenet_tcp_sendrecv_all_ports(irc_t)
-corenet_udp_sendrecv_all_ports(irc_t)
+
+corenet_sendrecv_gatekeeper_client_packets(irc_t)
+corenet_tcp_sendrecv_gatekeeper_port(irc_t)
+corenet_tcp_connect_gatekeeper_port(irc_t)
+
+corenet_sendrecv_http_cache_client_packets(irc_t)
+corenet_tcp_connect_http_cache_port(irc_t)
+corenet_tcp_sendrecv_http_cache_port(irc_t)
+
 corenet_sendrecv_ircd_client_packets(irc_t)
-# cjp: this seems excessive:
-corenet_tcp_connect_all_ports(irc_t)
-corenet_sendrecv_all_client_packets(irc_t)
+corenet_tcp_connect_ircd_port(irc_t)
+corenet_tcp_sendrecv_ircd_port(irc_t)
+
+dev_read_urand(irc_t)
+dev_read_rand(irc_t)
 
 domain_use_interactive_fds(irc_t)
 
-files_dontaudit_search_pids(irc_t)
-files_search_var(irc_t)
-files_read_etc_files(irc_t)
 files_read_usr_files(irc_t)
 
-fs_getattr_xattr_fs(irc_t)
+fs_getattr_all_fs(irc_t)
 fs_search_auto_mountpoints(irc_t)
 
 term_use_controlling_term(irc_t)
 term_list_ptys(irc_t)
 
-# allow utmp access
+auth_use_nsswitch(irc_t)
+
 init_read_utmp(irc_t)
 init_dontaudit_lock_utmp(irc_t)
 
 miscfiles_read_localization(irc_t)
 
-# Inherit and use descriptors from newrole.
-seutil_use_newrole_fds(irc_t)
-
-sysnet_read_config(irc_t)
-
-# Write to the user domain tty.
 userdom_use_user_terminals(irc_t)
 
+userdom_manage_user_home_content_dirs(irc_t)
+userdom_manage_user_home_content_files(irc_t)
+userdom_user_home_dir_filetrans_user_home_content(irc_t, { dir file })
+
+tunable_policy(`irc_use_any_tcp_ports',`
+	corenet_sendrecv_all_server_packets(irc_t)
+	corenet_tcp_bind_all_unreserved_ports(irc_t)
+	corenet_sendrecv_all_client_packets(irc_t)
+	corenet_tcp_connect_all_unreserved_ports(irc_t)
+	corenet_tcp_sendrecv_all_ports(irc_t)
+')
+
 tunable_policy(`use_nfs_home_dirs',`
 	fs_manage_nfs_dirs(irc_t)
 	fs_manage_nfs_files(irc_t)
@@ -98,5 +127,5 @@
 ')
 
 optional_policy(`
-	nis_use_ypbind(irc_t)
+	seutil_use_newrole_fds(irc_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/ircd.fc refpolicy/policy/modules/contrib/ircd.fc
--- refpolicy/policy/modules/contrib/ircd.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/ircd.fc	2012-10-06 17:54:31.620732719 +0200
@@ -1,7 +1,21 @@
-/etc/(dancer-)?ircd(/.*)?	gen_context(system_u:object_r:ircd_etc_t,s0)
+/etc/dancer-ircd(/.*)?	gen_context(system_u:object_r:ircd_etc_t,s0)
+/etc/ircd(/.*)?	gen_context(system_u:object_r:ircd_etc_t,s0)
+/etc/ngircd\.conf	--	gen_context(system_u:object_r:ircd_etc_t,s0)
+/etc/ngircd\.motd	--	gen_context(system_u:object_r:ircd_etc_t,s0)
 
-/usr/sbin/(dancer-)?ircd --	gen_context(system_u:object_r:ircd_exec_t,s0)
+/etc/rc\.d/init\.d/((ircd)|(ngircd)|(dancer-ircd))	--	gen_context(system_u:object_r:ircd_initrc_exec_t,s0)
+
+/usr/bin/ircd	--	gen_context(system_u:object_r:ircd_exec_t,s0)
+
+/usr/sbin/dancer-ircd	--	gen_context(system_u:object_r:ircd_exec_t,s0)
+/usr/sbin/ircd	--	gen_context(system_u:object_r:ircd_exec_t,s0)
+/usr/sbin/ngircd	--	gen_context(system_u:object_r:ircd_exec_t,s0)
 
 /var/lib/dancer-ircd(/.*)?	gen_context(system_u:object_r:ircd_var_lib_t,s0)
-/var/log/(dancer-)?ircd(/.*)?	gen_context(system_u:object_r:ircd_log_t,s0)
+
+/var/log/dancer-ircd(/.*)?	gen_context(system_u:object_r:ircd_log_t,s0)
+/var/log/ircd(/.*)?	gen_context(system_u:object_r:ircd_log_t,s0)
+/var/log/ngircd\.log.*	--	gen_context(system_u:object_r:ircd_log_t,s0)
+
 /var/run/dancer-ircd(/.*)?	gen_context(system_u:object_r:ircd_var_run_t,s0)
+/var/run/ngircd(/.*)?	gen_context(system_u:object_r:ircd_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/ircd.if refpolicy/policy/modules/contrib/ircd.if
--- refpolicy/policy/modules/contrib/ircd.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/ircd.if	2012-10-06 17:54:31.658732719 +0200
@@ -1 +1,45 @@
-## <summary>IRC server</summary>
+## <summary>IRC servers.</summary>
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an ircd environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`ircd_admin',`
+	gen_require(`
+		type ircd_t, ircd_initrc_exec_t, ircd_etc_t;
+		type ircd_log_t, ircd_var_lib_t, ircd_var_run_t;
+	')
+
+	init_labeled_script_domtrans($1, ircd_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 ircd_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	allow $1 ircd_t:process { ptrace signal_perms };
+	ps_process_pattern($1, ircd_t)
+
+	files_search_etc($1)
+	admin_pattern($1, ircd_etc_t)
+
+	logging_search_log($1)
+	admin_pattern($1, ircd_log_t)
+
+	files_search_var_lib($1)
+	admin_pattern($1, ircd_var_lib_t)
+
+	files_search_pids($1)
+	admin_pattern($1, ircd_var_run_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/ircd.te refpolicy/policy/modules/contrib/ircd.te
--- refpolicy/policy/modules/contrib/ircd.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/ircd.te	2012-10-06 17:54:31.659732719 +0200
@@ -1,4 +1,4 @@
-policy_module(ircd, 1.7.0)
+policy_module(ircd, 1.7.1)
 
 ########################################
 #
@@ -9,6 +9,9 @@
 type ircd_exec_t;
 init_daemon_domain(ircd_t, ircd_exec_t)
 
+type ircd_initrc_exec_t;
+init_script_file(ircd_initrc_exec_t)
+
 type ircd_etc_t;
 files_config_file(ircd_etc_t)
 
@@ -28,18 +31,18 @@
 
 dontaudit ircd_t self:capability sys_tty_config;
 allow ircd_t self:process signal_perms;
-allow ircd_t self:tcp_socket create_stream_socket_perms;
-allow ircd_t self:udp_socket create_socket_perms;
+allow ircd_t self:tcp_socket { accept listen };
 
 read_files_pattern(ircd_t, ircd_etc_t, ircd_etc_t)
 read_lnk_files_pattern(ircd_t, ircd_etc_t, ircd_etc_t)
-files_search_etc(ircd_t)
 
-manage_files_pattern(ircd_t, ircd_log_t, ircd_log_t)
-logging_log_filetrans(ircd_t, ircd_log_t, { file dir })
+allow ircd_t ircd_log_t:dir setattr_dir_perms;
+append_files_pattern(ircd_t, ircd_log_t, ircd_log_t)
+create_files_pattern(ircd_t, ircd_log_t, ircd_log_t)
+setattr_files_pattern(ircd_t, ircd_log_t, ircd_log_t)
+logging_log_filetrans(ircd_t, ircd_log_t, file)
 
 manage_files_pattern(ircd_t, ircd_var_lib_t, ircd_var_lib_t)
-files_var_lib_filetrans(ircd_t, ircd_var_lib_t, file)
 
 manage_files_pattern(ircd_t, ircd_var_run_t, ircd_var_run_t)
 files_pid_filetrans(ircd_t, ircd_var_run_t, file)
@@ -47,44 +50,37 @@
 kernel_read_system_state(ircd_t)
 kernel_read_kernel_sysctls(ircd_t)
 
-corecmd_search_bin(ircd_t)
+corecmd_exec_bin(ircd_t)
 
 corenet_all_recvfrom_unlabeled(ircd_t)
 corenet_all_recvfrom_netlabel(ircd_t)
 corenet_tcp_sendrecv_generic_if(ircd_t)
-corenet_udp_sendrecv_generic_if(ircd_t)
 corenet_tcp_sendrecv_generic_node(ircd_t)
-corenet_udp_sendrecv_generic_node(ircd_t)
-corenet_tcp_sendrecv_all_ports(ircd_t)
-corenet_udp_sendrecv_all_ports(ircd_t)
 corenet_tcp_bind_generic_node(ircd_t)
-corenet_tcp_bind_ircd_port(ircd_t)
+
 corenet_sendrecv_ircd_server_packets(ircd_t)
+corenet_tcp_bind_ircd_port(ircd_t)
+corenet_tcp_sendrecv_ircd_port(ircd_t)
 
 dev_read_sysfs(ircd_t)
 
 domain_use_interactive_fds(ircd_t)
 
-files_read_etc_files(ircd_t)
 files_read_etc_runtime_files(ircd_t)
 
 fs_getattr_all_fs(ircd_t)
 fs_search_auto_mountpoints(ircd_t)
 
+auth_use_nsswitch(ircd_t)
+
 logging_send_syslog_msg(ircd_t)
 
 miscfiles_read_localization(ircd_t)
 
-sysnet_read_config(ircd_t)
-
 userdom_dontaudit_use_unpriv_user_fds(ircd_t)
 userdom_dontaudit_search_user_home_dirs(ircd_t)
 
 optional_policy(`
-	nis_use_ypbind(ircd_t)
-')
-
-optional_policy(`
 	seutil_sigchld_newrole(ircd_t)
 ')
 
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/irqbalance.fc refpolicy/policy/modules/contrib/irqbalance.fc
--- refpolicy/policy/modules/contrib/irqbalance.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/irqbalance.fc	2012-10-08 10:25:15.674044016 +0200
@@ -1,2 +1,5 @@
+/etc/rc\.d/init\.d/irqbalance	--	gen_context(system_u:object_r:irqbalance_initrc_exec_t,s0)
 
-/usr/sbin/irqbalance	-- gen_context(system_u:object_r:irqbalance_exec_t,s0)
+/usr/sbin/irqbalance	--	gen_context(system_u:object_r:irqbalance_exec_t,s0)
+
+/var/run/irqbalance\.pid	--	gen_context(system_u:object_r:irqbalance_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/irqbalance.if refpolicy/policy/modules/contrib/irqbalance.if
--- refpolicy/policy/modules/contrib/irqbalance.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/irqbalance.if	2012-10-08 10:25:15.674044016 +0200
@@ -1 +1,35 @@
-## <summary>IRQ balancing daemon</summary>
+## <summary>IRQ balancing daemon.</summary>
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an irqbalance environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`irqbalance_admin',`
+	gen_require(`
+		type irqbalance_t, irqbalance_initrc_exec_t, irqbalance_var_run_t;
+	')
+
+	allow $1 irqbalance_t:process { ptrace signal_perms };
+	ps_process_pattern($1, irqbalance_t)
+
+	init_labeled_script_domtrans($1, irqbalance_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 irqbalance_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	files_search_pids($1)
+	admin_pattern($1, irqbalance_var_run_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/irqbalance.te refpolicy/policy/modules/contrib/irqbalance.te
--- refpolicy/policy/modules/contrib/irqbalance.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/irqbalance.te	2012-10-08 10:25:15.697044008 +0200
@@ -1,4 +1,4 @@
-policy_module(irqbalance, 1.5.0)
+policy_module(irqbalance, 1.5.1)
 
 ########################################
 #
@@ -9,6 +9,9 @@
 type irqbalance_exec_t;
 init_daemon_domain(irqbalance_t, irqbalance_exec_t)
 
+type irqbalance_initrc_exec_t;
+init_script_file(irqbalance_initrc_exec_t)
+
 type irqbalance_var_run_t;
 files_pid_file(irqbalance_var_run_t)
 
@@ -47,6 +50,10 @@
 userdom_dontaudit_use_unpriv_user_fds(irqbalance_t)
 userdom_dontaudit_search_user_home_dirs(irqbalance_t)
 
+ifdef(`hide_broken_symptoms',`
+	dontaudit irqbalance_t self:capability sys_module;
+')
+
 optional_policy(`
 	seutil_sigchld_newrole(irqbalance_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/iscsi.fc refpolicy/policy/modules/contrib/iscsi.fc
--- refpolicy/policy/modules/contrib/iscsi.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/iscsi.fc	2012-10-08 10:25:31.606044049 +0200
@@ -1,7 +1,18 @@
-/sbin/iscsid		--	gen_context(system_u:object_r:iscsid_exec_t,s0)
+/etc/rc\.d/init\.d/((iscsi)|(iscsid))	--	gen_context(system_u:object_r:iscsi_initrc_exec_t,s0)
+
+/sbin/iscsid	--	gen_context(system_u:object_r:iscsid_exec_t,s0)
 /sbin/brcm_iscsiuio	--	gen_context(system_u:object_r:iscsid_exec_t,s0)
+/sbin/iscsiuio	--	gen_context(system_u:object_r:iscsid_exec_t,s0)
+
+/usr/sbin/iscsid	--	gen_context(system_u:object_r:iscsid_exec_t,s0)
+/usr/sbin/brcm_iscsiuio	--	gen_context(system_u:object_r:iscsid_exec_t,s0)
+/usr/sbin/iscsiuio	--	gen_context(system_u:object_r:iscsid_exec_t,s0)
+
+/var/lib/iscsi(/.*)?	gen_context(system_u:object_r:iscsi_var_lib_t,s0)
+
+/var/lock/iscsi(/.*)?	gen_context(system_u:object_r:iscsi_lock_t,s0)
+
+/var/log/brcm-iscsi\.log.*	--	gen_context(system_u:object_r:iscsi_log_t,s0)
+/var/log/iscsiuio\.log.*	--	gen_context(system_u:object_r:iscsi_log_t,s0)
 
-/var/lib/iscsi(/.*)?		gen_context(system_u:object_r:iscsi_var_lib_t,s0)
-/var/lock/iscsi(/.*)?		gen_context(system_u:object_r:iscsi_lock_t,s0)
-/var/log/brcm-iscsi\.log --	gen_context(system_u:object_r:iscsi_log_t,s0)
 /var/run/iscsid\.pid	--	gen_context(system_u:object_r:iscsi_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/iscsi.if refpolicy/policy/modules/contrib/iscsi.if
--- refpolicy/policy/modules/contrib/iscsi.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/iscsi.if	2012-10-08 10:25:31.615044049 +0200
@@ -1,4 +1,4 @@
-## <summary>Establish connections to iSCSI devices</summary>
+## <summary>Establish connections to iSCSI devices.</summary>
 
 ########################################
 ## <summary>
@@ -15,12 +15,14 @@
 		type iscsid_t, iscsid_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, iscsid_exec_t, iscsid_t)
 ')
 
 ########################################
 ## <summary>
-##	Manage iscsid sempaphores.
+##	Create, read, write, and delete
+##	iscsid sempaphores.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -38,7 +40,8 @@
 
 ########################################
 ## <summary>
-##	Connect to ISCSI using a unix domain stream socket.
+##	Connect to iscsid using a unix
+##	domain stream socket.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -51,13 +54,13 @@
 		type iscsid_t, iscsi_var_lib_t;
 	')
 
-	files_search_pids($1)
+	files_search_var_lib($1)
 	stream_connect_pattern($1, iscsi_var_lib_t, iscsi_var_lib_t, iscsid_t)
 ')
 
 ########################################
 ## <summary>
-##	Read iscsi lib files.
+##	Read iscsid lib files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -74,3 +77,51 @@
 	allow $1 iscsi_var_lib_t:dir list_dir_perms;
 	files_search_var_lib($1)
 ')
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an iscsi environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`iscsi_admin',`
+	gen_require(`
+		type iscsid_t, iscsi_lock_t, iscsi_log_t;
+		type iscsi_var_lib_t, iscsi_var_run_t, iscsi_tmp_t;
+		type iscsi_initrc_exec_t;
+	')
+
+	allow $1 iscsid_t:process { ptrace signal_perms };
+	ps_process_pattern($1, iscsid_t)
+
+	init_labeled_script_domtrans($1, iscsi_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 iscsi_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	logging_search_logs($1)
+	admin_pattern($1, iscsi_log_t)
+
+	files_search_locks($1)
+	admin_pattern($1, iscsi_lock_t)
+
+	files_search_var_lib($1)
+	admin_pattern($1, iscsi_var_lib_t)
+
+	files_search_pids($1)
+	admin_pattern($1, iscsi_var_run_t)
+
+	files_search_tmp($1)
+	admin_pattern($1, iscsi_tmp_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/iscsi.te refpolicy/policy/modules/contrib/iscsi.te
--- refpolicy/policy/modules/contrib/iscsi.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/iscsi.te	2012-10-08 10:25:31.615044049 +0200
@@ -1,4 +1,4 @@
-policy_module(iscsi, 1.8.0)
+policy_module(iscsi, 1.8.1)
 
 ########################################
 #
@@ -7,9 +7,11 @@
 
 type iscsid_t;
 type iscsid_exec_t;
-domain_type(iscsid_t)
 init_daemon_domain(iscsid_t, iscsid_exec_t)
 
+type iscsi_initrc_exec_t;
+init_script_file(iscsi_initrc_exec_t)
+
 type iscsi_lock_t;
 files_lock_file(iscsi_lock_t)
 
@@ -27,63 +29,70 @@
 
 ########################################
 #
-# iscsid local policy
+# Local policy
 #
 
 allow iscsid_t self:capability { dac_override ipc_lock net_admin net_raw sys_admin sys_nice sys_resource };
 dontaudit iscsid_t self:capability sys_ptrace;
 allow iscsid_t self:process { setrlimit setsched signal };
 allow iscsid_t self:fifo_file rw_fifo_file_perms;
-allow iscsid_t self:unix_stream_socket { create_stream_socket_perms connectto };
-allow iscsid_t self:unix_dgram_socket create_socket_perms;
+allow iscsid_t self:unix_stream_socket { accept connectto listen };
 allow iscsid_t self:sem create_sem_perms;
 allow iscsid_t self:shm create_shm_perms;
 allow iscsid_t self:netlink_socket create_socket_perms;
 allow iscsid_t self:netlink_kobject_uevent_socket create_socket_perms;
-allow iscsid_t self:netlink_route_socket rw_netlink_socket_perms;
-allow iscsid_t self:tcp_socket create_stream_socket_perms;
-
-can_exec(iscsid_t, iscsid_exec_t)
+allow iscsid_t self:netlink_route_socket nlmsg_write;
+allow iscsid_t self:tcp_socket { listen accept };
 
 manage_dirs_pattern(iscsid_t, iscsi_lock_t, iscsi_lock_t)
 manage_files_pattern(iscsid_t, iscsi_lock_t, iscsi_lock_t)
 files_lock_filetrans(iscsid_t, iscsi_lock_t, { dir file })
 
-manage_files_pattern(iscsid_t, iscsi_log_t, iscsi_log_t)
+allow iscsid_t iscsi_log_t:file { append_file_perms create_file_perms setattr_file_perms };
 logging_log_filetrans(iscsid_t, iscsi_log_t, file)
 
 manage_dirs_pattern(iscsid_t, iscsi_tmp_t, iscsi_tmp_t)
 manage_files_pattern(iscsid_t, iscsi_tmp_t, iscsi_tmp_t)
-fs_tmpfs_filetrans(iscsid_t, iscsi_tmp_t, { dir file } )
+fs_tmpfs_filetrans(iscsid_t, iscsi_tmp_t, { dir file })
 
 allow iscsid_t iscsi_var_lib_t:dir list_dir_perms;
 read_files_pattern(iscsid_t, iscsi_var_lib_t, iscsi_var_lib_t)
 read_lnk_files_pattern(iscsid_t, iscsi_var_lib_t, iscsi_var_lib_t)
-files_search_var_lib(iscsid_t)
 
 manage_files_pattern(iscsid_t, iscsi_var_run_t, iscsi_var_run_t)
 files_pid_filetrans(iscsid_t, iscsi_var_run_t, file)
 
+can_exec(iscsid_t, iscsid_exec_t)
+
 kernel_read_network_state(iscsid_t)
 kernel_read_system_state(iscsid_t)
+kernel_setsched(iscsid_t)
 
 corenet_all_recvfrom_unlabeled(iscsid_t)
 corenet_all_recvfrom_netlabel(iscsid_t)
 corenet_tcp_sendrecv_generic_if(iscsid_t)
 corenet_tcp_sendrecv_generic_node(iscsid_t)
-corenet_tcp_sendrecv_all_ports(iscsid_t)
+
+corenet_sendrecv_http_client_packets(iscsid_t)
 corenet_tcp_connect_http_port(iscsid_t)
+corenet_tcp_sendrecv_http_port(iscsid_t)
+
+corenet_sendrecv_iscsi_client_packets(iscsid_t)
 corenet_tcp_connect_iscsi_port(iscsid_t)
+corenet_tcp_sendrecv_iscsi_port(iscsid_t)
+
+corenet_sendrecv_isns_client_packets(iscsid_t)
 corenet_tcp_connect_isns_port(iscsid_t)
+corenet_tcp_sendrecv_isns_port(iscsid_t)
 
+dev_read_raw_memory(iscsid_t)
 dev_rw_sysfs(iscsid_t)
 dev_rw_userio_dev(iscsid_t)
+dev_write_raw_memory(iscsid_t)
 
 domain_use_interactive_fds(iscsid_t)
 domain_dontaudit_read_all_domains_state(iscsid_t)
 
-files_read_etc_files(iscsid_t)
-
 auth_use_nsswitch(iscsid_t)
 
 init_stream_connect_script(iscsid_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/isns.fc refpolicy/policy/modules/contrib/isns.fc
--- refpolicy/policy/modules/contrib/isns.fc	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/isns.fc	2012-09-27 20:03:30.697126498 +0200
@@ -0,0 +1,8 @@
+/etc/rc\.d/init\.d/isnsd	--	gen_context(system_u:object_r:isnsd_initrc_exec_t,s0)
+
+/usr/sbin/isnsd	--	gen_context(system_u:object_r:isnsd_exec_t,s0)
+
+/var/lib/isns(/.*)?	gen_context(system_u:object_r:isnsd_var_lib_t,s0)
+
+/var/run/isnsd\.pid	--	gen_context(system_u:object_r:isnsd_var_run_t,s0)
+/var/run/isnsctl	-s	gen_context(system_u:object_r:isnsd_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/isns.if refpolicy/policy/modules/contrib/isns.if
--- refpolicy/policy/modules/contrib/isns.if	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/isns.if	2012-09-27 20:03:30.718126498 +0200
@@ -0,0 +1,39 @@
+## <summary>Internet Storage Name Service.</summary>
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an isnsd environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`isnsd_admin',`
+	gen_require(`
+		type isnsd_t, isnsd_initrc_exec_t, isnsd_var_lib_t;
+		type isnsd_var_run_t;
+	')
+
+	allow $1 isnsd_t:process { ptrace signal_perms };
+	ps_process_pattern($1, isnsd_t)
+
+	init_labeled_script_domtrans($1, isnsd_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 isnsd_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	files_search_var_lib($1)
+	admin_pattern($1, isnsd_var_lib_t)
+
+	files_search_pids($1)
+	admin_pattern($1, isnsd_var_run_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/isns.te refpolicy/policy/modules/contrib/isns.te
--- refpolicy/policy/modules/contrib/isns.te	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/isns.te	2012-09-27 20:03:30.718126498 +0200
@@ -0,0 +1,55 @@
+policy_module(isns, 1.0.0)
+
+########################################
+#
+# Declarations
+#
+
+type isnsd_t;
+type isnsd_exec_t;
+init_daemon_domain(isnsd_t, isnsd_exec_t)
+
+type isnsd_initrc_exec_t;
+init_script_file(isnsd_initrc_exec_t)
+
+type isnsd_var_lib_t;
+files_type(isnsd_var_lib_t)
+
+type isnsd_var_run_t;
+files_pid_file(isnsd_var_run_t)
+
+########################################
+#
+# Local policy
+#
+
+allow isnsd_t self:capability kill;
+allow isnsd_t self:process signal;
+allow isnsd_t self:fifo_file rw_fifo_file_perms;
+allow isnsd_t self:udp_socket { accept listen };
+allow isnsd_t self:unix_stream_socket { accept listen };
+
+manage_dirs_pattern(isnsd_t, isnsd_var_lib_t, isnsd_var_lib_t)
+manage_files_pattern(isnsd_t, isnsd_var_lib_t, isnsd_var_lib_t)
+files_var_lib_filetrans(isnsd_t, isnsd_var_lib_t, dir)
+
+manage_sock_files_pattern(isnsd_t, isnsd_var_run_t, isnsd_var_run_t)
+manage_files_pattern(isnsd_t, isnsd_var_run_t, isnsd_var_run_t)
+files_pid_filetrans(isnsd_t, isnsd_var_run_t, { file sock_file })
+
+corenet_all_recvfrom_unlabeled(isnsd_t)
+corenet_all_recvfrom_netlabel(isnsd_t)
+corenet_tcp_sendrecv_generic_if(isnsd_t)
+corenet_tcp_sendrecv_generic_node(isnsd_t)
+corenet_tcp_sendrecv_isns_port(isnsd_t)
+corenet_tcp_bind_generic_node(isnsd_t)
+corenet_sendrecv_isns_server_packets(isnsd_t)
+corenet_tcp_bind_isns_port(isnsd_t)
+
+files_read_etc_files(isnsd_t)
+
+logging_send_syslog_msg(isnsd_t)
+
+miscfiles_read_localization(isnsd_t)
+
+sysnet_dns_name_resolve(isnsd_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/jabber.fc refpolicy/policy/modules/contrib/jabber.fc
--- refpolicy/policy/modules/contrib/jabber.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/jabber.fc	2012-10-08 10:25:42.802044073 +0200
@@ -1,10 +1,25 @@
-/etc/rc\.d/init\.d/jabber --	gen_context(system_u:object_r:jabberd_initrc_exec_t,s0)
+/etc/rc\.d/init\.d/((jabber)|(ejabberd)|(jabberd))	--	gen_context(system_u:object_r:jabberd_initrc_exec_t,s0)
+
+/usr/bin/router	--	gen_context(system_u:object_r:jabberd_router_exec_t,s0)
+/usr/bin/c2s	--	gen_context(system_u:object_r:jabberd_router_exec_t,s0)
+/usr/bin/s2s	--	gen_context(system_u:object_r:jabberd_exec_t,s0)
+/usr/bin/sm	--	gen_context(system_u:object_r:jabberd_exec_t,s0)
 
 /usr/sbin/ejabberd	--	gen_context(system_u:object_r:jabberd_exec_t,s0)
+/usr/sbin/ejabberdctl	--	gen_context(system_u:object_r:jabberd_exec_t,s0)
 /usr/sbin/jabberd	--	gen_context(system_u:object_r:jabberd_exec_t,s0)
 
-/var/lib/ejabberd(/.*)?		gen_context(system_u:object_r:jabberd_var_lib_t,s0)
-/var/lib/jabber(/.*)?		gen_context(system_u:object_r:jabberd_var_lib_t,s0)
+/var/lock/ejabberdctl(/.*)	gen_context(system_u:object_r:jabberd_lock_t,s0)
+
+/var/log/ejabberd(/.*)?	gen_context(system_u:object_r:jabberd_log_t,s0)
+/var/log/jabber(/.*)?	gen_context(system_u:object_r:jabberd_log_t,s0)
+
+/var/lib/ejabberd(/.*)?	gen_context(system_u:object_r:jabberd_var_lib_t,s0)
+/var/lib/ejabberd/spool(/.*)?	gen_context(system_u:object_r:jabberd_spool_t,s0)
+/var/lib/jabber(/.*)?	gen_context(system_u:object_r:jabberd_var_lib_t,s0)
+/var/lib/jabberd(/.*)?	gen_context(system_u:object_r:jabberd_var_lib_t,s0)
+/var/lib/jabberd/log(/.*)?	gen_context(system_u:object_r:jabberd_log_t,s0)
+/var/lib/jabberd/pid(/.*)?	gen_context(system_u:object_r:jabberd_var_run_t,s0)
 
-/var/log/ejabberd(/.*)?		gen_context(system_u:object_r:jabberd_log_t,s0)
-/var/log/jabber(/.*)?		gen_context(system_u:object_r:jabberd_log_t,s0)
+/var/run/ejabber\.pid	--	gen_context(system_u:object_r:jabberd_var_run_t,s0)
+/var/run/jabber\.pid	--	gen_context(system_u:object_r:jabberd_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/jabber.if refpolicy/policy/modules/contrib/jabber.if
--- refpolicy/policy/modules/contrib/jabber.if	2012-05-04 15:16:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/jabber.if	2012-10-08 10:25:42.802044073 +0200
@@ -1,4 +1,44 @@
-## <summary>Jabber instant messaging server</summary>
+## <summary>Jabber instant messaging servers.</summary>
+
+#######################################
+## <summary>
+##	The template to define a jabber domain.
+## </summary>
+## <param name="domain_prefix">
+##	<summary>
+##	Domain prefix to be used.
+##	</summary>
+## </param>
+#
+template(`jabber_domain_template',`
+	gen_require(`
+		attribute jabberd_domain;
+	')
+
+	type $1_t, jabberd_domain;
+	type $1_exec_t;
+	init_daemon_domain($1_t, $1_exec_t)
+')
+
+########################################
+## <summary>
+##	Create, read, write, and delete
+##	jabber lib files.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`jabber_manage_lib_files',`
+	gen_require(`
+		type jabberd_var_lib_t;
+	')
+
+	files_search_var_lib($1)
+	manage_files_pattern($1, jabberd_var_lib_t, jabberd_var_lib_t)
+')
 
 ########################################
 ## <summary>
@@ -16,8 +56,8 @@
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate 
-##	an jabber environment
+##	All of the rules required to
+##	administrate an jabber environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -26,31 +66,38 @@
 ## </param>
 ## <param name="role">
 ##	<summary>
-##	The role to be allowed to manage the jabber domain.
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <rolecap/>
 #
 interface(`jabber_admin',`
 	gen_require(`
-		type jabberd_t, jabberd_log_t, jabberd_var_lib_t;
-		type jabberd_var_run_t, jabberd_initrc_exec_t;
+		attribute jabberd_domain;
+		type jabberd_lock_t, jabberd_log_t, jabberd_spool_t;
+		type jabberd_var_lib_t, jabberd_var_run_t, jabberd_initrc_exec_t;
 	')
 
-	allow $1 jabberd_t:process { ptrace signal_perms };
-	ps_process_pattern($1, jabberd_t)
+	allow $1 jabberd_domain:process { ptrace signal_perms };
+	ps_process_pattern($1, jabberd_domain)
 
 	init_labeled_script_domtrans($1, jabberd_initrc_exec_t)
 	domain_system_change_exemption($1)
 	role_transition $2 jabberd_initrc_exec_t system_r;
 	allow $2 system_r;
 
-	logging_list_logs($1)
+	files_search_locks($1))
+	admin_pattern($1, jabberd_lock_t)
+
+	logging_search_logs($1)
 	admin_pattern($1, jabberd_log_t)
 
-	files_list_var_lib($1)
+	files_search_spool($1)
+	admin_pattern($1, jabberd_spool_t)
+
+	files_search_var_lib($1)
 	admin_pattern($1, jabberd_var_lib_t)
 
-	files_list_pids($1)
+	files_search_pids($1)
 	admin_pattern($1, jabberd_var_run_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/jabber.te refpolicy/policy/modules/contrib/jabber.te
--- refpolicy/policy/modules/contrib/jabber.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/jabber.te	2012-10-08 10:25:42.803044073 +0200
@@ -1,20 +1,27 @@
-policy_module(jabber, 1.9.0)
+policy_module(jabber, 1.9.1)
 
 ########################################
 #
 # Declarations
 #
 
-type jabberd_t;
-type jabberd_exec_t;
-init_daemon_domain(jabberd_t, jabberd_exec_t)
+attribute jabberd_domain;
+
+jabber_domain_template(jabberd)
+jabber_domain_template(jabberd_router)
 
 type jabberd_initrc_exec_t;
 init_script_file(jabberd_initrc_exec_t)
 
+type jabberd_lock_t;
+files_lock_file(jabberd_lock_t)
+
 type jabberd_log_t;
 logging_log_file(jabberd_log_t)
 
+type jabberd_spool_t;
+files_type(jabberd_spool_t)
+
 type jabberd_var_lib_t;
 files_type(jabberd_var_lib_t)
 
@@ -23,45 +30,73 @@
 
 ########################################
 #
+# Common local policy
+#
+
+allow jabberd_domain self:process signal_perms;
+allow jabberd_domain self:fifo_file rw_fifo_file_perms;
+allow jabberd_domain self:tcp_socket { accept listen };
+
+manage_files_pattern(jabberd_domain, jabberd_var_lib_t, jabberd_var_lib_t)
+
+kernel_read_system_state(jabberd_domain)
+
+corenet_all_recvfrom_unlabeled(jabberd_domain)
+corenet_all_recvfrom_netlabel(jabberd_domain)
+corenet_tcp_sendrecv_generic_if(jabberd_domain)
+corenet_tcp_sendrecv_generic_node(jabberd_domain)
+corenet_tcp_bind_generic_node(jabberd_domain)
+
+dev_read_urand(jabberd_domain)
+dev_read_sysfs(jabberd_domain)
+
+fs_getattr_all_fs(jabberd_domain)
+
+logging_send_syslog_msg(jabberd_domain)
+
+miscfiles_read_localization(jabberd_domain)
+
+optional_policy(`
+	nis_use_ypbind(jabberd_domain)
+')
+
+optional_policy(`
+	seutil_sigchld_newrole(jabberd_domain)
+')
+
+########################################
+#
 # Local policy
 #
 
 allow jabberd_t self:capability dac_override;
 dontaudit jabberd_t self:capability sys_tty_config;
-allow jabberd_t self:process signal_perms;
-allow jabberd_t self:fifo_file read_fifo_file_perms;
-allow jabberd_t self:tcp_socket create_stream_socket_perms;
+allow jabberd_t self:tcp_socket create_socket_perms;
 allow jabberd_t self:udp_socket create_socket_perms;
 
-manage_files_pattern(jabberd_t, jabberd_var_lib_t, jabberd_var_lib_t)
-files_var_lib_filetrans(jabberd_t, jabberd_var_lib_t, file)
+manage_files_pattern(jabberd_t, jabberd_lock_t, jabberd_lock_t)
 
-manage_files_pattern(jabberd_t, jabberd_log_t, jabberd_log_t)
+allow jabberd_t jabberd_log_t:dir setattr_dir_perms;
+append_files_pattern(jabberd_t, jabberd_log_t, jabberd_log_t)
+create_files_pattern(jabberd_t, jabberd_log_t, jabberd_log_t)
+setattr_files_pattern(jabberd_t, jabberd_log_t, jabberd_log_t)
 logging_log_filetrans(jabberd_t, jabberd_log_t, { file dir })
 
+manage_files_pattern(jabberd_domain, jabberd_spool_t, jabberd_spool_t)
+
 manage_files_pattern(jabberd_t, jabberd_var_run_t, jabberd_var_run_t)
 files_pid_filetrans(jabberd_t, jabberd_var_run_t, file)
 
 kernel_read_kernel_sysctls(jabberd_t)
-kernel_list_proc(jabberd_t)
-kernel_read_proc_symlinks(jabberd_t)
 
-corenet_all_recvfrom_unlabeled(jabberd_t)
-corenet_all_recvfrom_netlabel(jabberd_t)
-corenet_tcp_sendrecv_generic_if(jabberd_t)
-corenet_udp_sendrecv_generic_if(jabberd_t)
-corenet_tcp_sendrecv_generic_node(jabberd_t)
-corenet_udp_sendrecv_generic_node(jabberd_t)
-corenet_tcp_sendrecv_all_ports(jabberd_t)
-corenet_udp_sendrecv_all_ports(jabberd_t)
-corenet_tcp_bind_generic_node(jabberd_t)
-corenet_tcp_bind_jabber_client_port(jabberd_t)
-corenet_tcp_bind_jabber_interserver_port(jabberd_t)
 corenet_sendrecv_jabber_client_server_packets(jabberd_t)
+corenet_tcp_bind_jabber_client_port(jabberd_t)
+corenet_tcp_sendrecv_jabber_client_port(jabberd_t)
+
 corenet_sendrecv_jabber_interserver_server_packets(jabberd_t)
+corenet_tcp_bind_jabber_interserver_port(jabberd_t)
+corenet_tcp_sendrecv_jabber_interserver_port(jabberd_t)
 
-dev_read_sysfs(jabberd_t)
-# For SSL
 dev_read_rand(jabberd_t)
 
 domain_use_interactive_fds(jabberd_t)
@@ -69,26 +104,34 @@
 files_read_etc_files(jabberd_t)
 files_read_etc_runtime_files(jabberd_t)
 
-fs_getattr_all_fs(jabberd_t)
 fs_search_auto_mountpoints(jabberd_t)
 
-logging_send_syslog_msg(jabberd_t)
-
-miscfiles_read_localization(jabberd_t)
-
 sysnet_read_config(jabberd_t)
 
 userdom_dontaudit_use_unpriv_user_fds(jabberd_t)
 userdom_dontaudit_search_user_home_dirs(jabberd_t)
 
 optional_policy(`
-	nis_use_ypbind(jabberd_t)
+	udev_read_db(jabberd_t)
 ')
 
-optional_policy(`
-	seutil_sigchld_newrole(jabberd_t)
-')
+########################################
+#
+# Router local policy
+#
 
-optional_policy(`
-	udev_read_db(jabberd_t)
-')
+manage_dirs_pattern(jabberd_router_t, jabberd_var_lib_t, jabberd_var_lib_t)
+
+kernel_read_network_state(jabberd_router_t)
+
+corenet_sendrecv_jabber_client_server_packets(jabberd_router_t)
+corenet_tcp_bind_jabber_client_port(jabberd_router_t)
+corenet_tcp_sendrecv_jabber_client_port(jabberd_router_t)
+
+# corenet_sendrecv_jabber_router_server_packets(jabberd_router_t)
+# corenet_tcp_bind_jabber_router_port(jabberd_router_t)
+# corenet_sendrecv_jabber_router_client_packets(jabberd_router_t)
+# corenet_tcp_connect_jabber_router_port(jabberd_router_t)
+# corenet_tcp_sendrecv_jabber_router_port(jabberd_router_t)
+
+auth_use_nsswitch(jabberd_router_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/java.fc refpolicy/policy/modules/contrib/java.fc
--- refpolicy/policy/modules/contrib/java.fc	2012-07-13 16:46:37.000000000 +0200
+++ refpolicy/policy/modules/contrib/java.fc	2012-10-13 19:01:13.337560561 +0200
@@ -1,37 +1,31 @@
-#
-# /opt
-#
+HOME_DIR/\.java(/.*)?	gen_context(system_u:object_r:java_home_t,s0)
+
 /opt/(.*/)?bin/java[^/]*	--	gen_context(system_u:object_r:java_exec_t,s0)
-/opt/ibm/java.*/(bin|javaws)(/.*)? --	gen_context(system_u:object_r:java_exec_t,s0)
-/opt/local/matlab.*/bin.*/MATLAB.* --	gen_context(system_u:object_r:java_exec_t,s0)
+/opt/ibm/java.*/(bin|javaws)(/.*)?	--	gen_context(system_u:object_r:java_exec_t,s0)
+/opt/local/matlab.*/bin.*/MATLAB.*	--	gen_context(system_u:object_r:java_exec_t,s0)
 /opt/matlab.*/bin.*/MATLAB.*	--	gen_context(system_u:object_r:java_exec_t,s0)
 
-#
-# /usr
-#
 /usr/(.*/)?bin/java[^-]*	--	gen_context(system_u:object_r:java_exec_t,s0)
-/usr/bin/fastjar		--	gen_context(system_u:object_r:java_exec_t,s0)
-/usr/bin/frysk			--	gen_context(system_u:object_r:java_exec_t,s0)
-/usr/bin/gappletviewer		--	gen_context(system_u:object_r:java_exec_t,s0)
-/usr/bin/gcj-dbtool		--	gen_context(system_u:object_r:java_exec_t,s0)
-/usr/bin/gij			--	gen_context(system_u:object_r:java_exec_t,s0)
-/usr/bin/gjarsigner		--	gen_context(system_u:object_r:java_exec_t,s0)
-/usr/bin/gkeytool		--	gen_context(system_u:object_r:java_exec_t,s0)
-/usr/bin/grmic			--	gen_context(system_u:object_r:java_exec_t,s0)
-/usr/bin/grmiregistry		--	gen_context(system_u:object_r:java_exec_t,s0)
-/usr/bin/jv-convert		--	gen_context(system_u:object_r:java_exec_t,s0)
-/usr/bin/octave-[^/]*		--	gen_context(system_u:object_r:java_exec_t,s0)
+/usr/bin/fastjar	--	gen_context(system_u:object_r:java_exec_t,s0)
+/usr/bin/frysk	--	gen_context(system_u:object_r:java_exec_t,s0)
+/usr/bin/gappletviewer	--	gen_context(system_u:object_r:java_exec_t,s0)
+/usr/bin/gcj-dbtool	--	gen_context(system_u:object_r:java_exec_t,s0)
+/usr/bin/gij	--	gen_context(system_u:object_r:java_exec_t,s0)
+/usr/bin/gjarsigner	--	gen_context(system_u:object_r:java_exec_t,s0)
+/usr/bin/gkeytool	--	gen_context(system_u:object_r:java_exec_t,s0)
+/usr/bin/grmic	--	gen_context(system_u:object_r:java_exec_t,s0)
+/usr/bin/grmiregistry	--	gen_context(system_u:object_r:java_exec_t,s0)
+/usr/bin/jv-convert	--	gen_context(system_u:object_r:java_exec_t,s0)
+/usr/bin/octave-[^/]*	--	gen_context(system_u:object_r:java_exec_t,s0)
+
+/usr/java/eclipse[^/]*/eclipse	--	gen_context(system_u:object_r:java_exec_t,s0)
 
-/usr/lib/bin/java[^/]*		--	gen_context(system_u:object_r:java_exec_t,s0)
+/usr/lib/bin/java[^/]*	--	gen_context(system_u:object_r:java_exec_t,s0)
 /usr/lib/eclipse/eclipse	--	gen_context(system_u:object_r:java_exec_t,s0)
 /usr/lib/jvm/java(.*/)bin(/.*)?	--	gen_context(system_u:object_r:java_exec_t,s0)
 /usr/lib/opera(/.*)?/opera	--	gen_context(system_u:object_r:java_exec_t,s0)
 /usr/lib/opera(/.*)?/works	--	gen_context(system_u:object_r:java_exec_t,s0)
 
-/usr/local/matlab.*/bin.*/MATLAB.* --	gen_context(system_u:object_r:java_exec_t,s0)
+/usr/local/matlab.*/bin.*/MATLAB.*	--	gen_context(system_u:object_r:java_exec_t,s0)
 
 /usr/matlab.*/bin.*/MATLAB.*	--	gen_context(system_u:object_r:java_exec_t,s0)
-
-ifdef(`distro_redhat',`
-/usr/java/eclipse[^/]*/eclipse	--	gen_context(system_u:object_r:java_exec_t,s0)
-')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/java.if refpolicy/policy/modules/contrib/java.if
--- refpolicy/policy/modules/contrib/java.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/java.if	2012-11-02 19:51:48.062955282 +0100
@@ -2,35 +2,62 @@
 
 ########################################
 ## <summary>
-##	Role access for java
+##	Role access for java.
 ## </summary>
 ## <param name="role">
 ##	<summary>
-##	Role allowed access
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <param name="domain">
 ##	<summary>
-##	User domain for the role
+##	User domain for the role.
 ##	</summary>
 ## </param>
 #
 interface(`java_role',`
 	gen_require(`
-		type java_t, java_exec_t;
+		attribute_role java_roles;
+		type java_t, java_exec_t, java_tmp_t;
+		type java_tmpfs_t;
 	')
 
-	role $1 types java_t;
+	########################################
+	#
+	# Declarations
+	#
+
+	roleattribute $1 java_roles;
+
+	########################################
+	#
+	# Policy
+	#
 
-	# The user role is authorized for this domain.
 	domtrans_pattern($2, java_exec_t, java_t)
-	allow java_t $2:process signull;
-	# Unrestricted inheritance from the caller.
-	allow $2 java_t:process { noatsecure siginh rlimitinh };
 
+	allow $2 java_t:process { noatsecure siginh rlimitinh ptrace signal_perms };
+	ps_process_pattern($2, java_t)
+
+	allow $2 java_tmp_t:dir { manage_dir_perms relabel_dir_perms };
+	allow $2 { java_tmp_t java_tmpfs_t }:file { manage_file_perms relabel_file_perms };
+	allow $2 java_tmpfs_t:fifo_file { manage_fifo_file_perms relabel_fifo_file_perms };
+	allow $2 java_tmpfs_t:lnk_file { manage_lnk_file_perms relabel_lnk_file_perms };
+	allow $2 java_tmpfs_t:sock_file { manage_sock_file_perms relabel_sock_file_perms };
+
+	allow java_t $2:process signull;
 	allow java_t $2:unix_stream_socket connectto;
 	allow java_t $2:unix_stream_socket { read write };
 	allow java_t $2:tcp_socket { read write };
+
+	ifdef(`distro_gentoo',`
+		gen_require(`
+			type java_home_t;
+		')
+	
+		manage_files_pattern($2, java_home_t, java_home_t)
+		manage_dirs_pattern($2, java_home_t, java_home_t)
+	')
 ')
 
 #######################################
@@ -62,33 +89,46 @@
 #
 template(`java_role_template',`
 	gen_require(`
-		type java_exec_t;
+		attribute java_domain;
+		type java_exec_t, java_tmp_t, java_tmpfs_t;
+		type java_home_t;
 	')
 
-	type $1_java_t;
-	domain_type($1_java_t)
-	domain_entry_file($1_java_t, java_exec_t)
-	role $2 types $1_java_t;
-
-	domain_interactive_fd($1_java_t)
-
-	userdom_manage_user_tmpfs_files($1_java_t)
+	########################################
+	#
+	# Declarations
+	#
 
-	allow $1_java_t self:process { ptrace signal getsched execmem execstack };
+	type $1_java_t, java_domain;
+	userdom_user_application_domain($1_java_t, java_exec_t)
 
-	dontaudit $1_java_t $3:tcp_socket { read write };
+	role $2 types $1_java_t;
 
-	allow $3 $1_java_t:process { getattr ptrace noatsecure signal_perms };
+	########################################
+	#
+	# Policy
+	#
 
 	domtrans_pattern($3, java_exec_t, $1_java_t)
 
-	corecmd_bin_domtrans($1_java_t, $3)
+	allow $3 $1_java_t:process { ptrace noatsecure siginh rlimitinh signal_perms };
+	ps_process_pattern($3, $1_java_t)
 
-	dev_dontaudit_append_rand($1_java_t)
+	allow $3 { java_home_t java_tmp_t }:dir { manage_dir_perms relabel_dir_perms };
+	allow $3 { java_tmp_t java_tmpfs_t java_home_t }:file { manage_file_perms relabel_file_perms };
+	allow $3 java_tmpfs_t:fifo_file { manage_fifo_file_perms relabel_fifo_file_perms };
+	allow $3 java_tmpfs_t:lnk_file { manage_lnk_file_perms relabel_lnk_file_perms };
+	allow $3 java_tmpfs_t:sock_file { manage_sock_file_perms relabel_sock_file_perms };
+	userdom_user_home_dir_filetrans($3, java_home_t, dir, ".java")
+
+	allow $1_java_t $3:process signull;
+	allow $1_java_t $3:unix_stream_socket connectto;
+	allow $1_java_t $3:unix_stream_socket { read write };
+	allow $1_java_t $3:tcp_socket { read write };
 
-	files_execmod_all_files($1_java_t)
+	corecmd_bin_domtrans($1_java_t, $3)
 
-	fs_dontaudit_rw_tmpfs_files($1_java_t)
+	auth_use_nsswitch($1_java_t)
 
 	optional_policy(`
 		xserver_role($2, $1_java_t)
@@ -97,7 +137,7 @@
 
 ########################################
 ## <summary>
-##	Run java in javaplugin domain.
+##	Execute the java program in the java domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -110,7 +150,13 @@
 		type java_t, java_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, java_exec_t, java_t)
+
+	ifdef(`distro_gentoo',`
+		# /usr/bin/java is a symlink
+		files_read_usr_symlinks($1)
+	')
 ')
 
 ########################################
@@ -131,16 +177,17 @@
 #
 interface(`java_run',`
 	gen_require(`
-		type java_t;
+		attribute_role java_roles;
 	')
 
 	java_domtrans($1)
-	role $2 types java_t;
+	roleattribute $2 java_roles;
 ')
 
 ########################################
 ## <summary>
-##	Execute the java program in the unconfined java domain.
+##	Execute the java program in the
+##	unconfined java domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -153,13 +200,15 @@
 		type unconfined_java_t, java_exec_t;
 	')
 
-	domtrans_pattern($1, java_exec_t, unconfined_java_t)
 	corecmd_search_bin($1)
+	domtrans_pattern($1, java_exec_t, unconfined_java_t)
 ')
 
 ########################################
 ## <summary>
-##	Execute the java program in the unconfined java domain.
+##	Execute the java program in the
+##	unconfined java domain and allow the
+##	specified role the java domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -174,16 +223,17 @@
 #
 interface(`java_run_unconfined',`
 	gen_require(`
-		type unconfined_java_t;
+		attribute_role unconfined_java_roles;
 	')
 
 	java_domtrans_unconfined($1)
-	role $2 types unconfined_java_t;
+	roleattribute $2 unconfined_java_roles;
 ')
 
 ########################################
 ## <summary>
-##	Execute the java program in the java domain.
+##	Execute the java program in
+##	the callers domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -196,5 +246,84 @@
 		type java_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	can_exec($1, java_exec_t)
 ')
+
+########################################
+## <summary>
+##	Create, read, write, and delete
+##	generic java home content.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`java_manage_generic_home_content',`
+	gen_require(`
+		type java_home_t;
+	')
+
+	userdom_search_user_home_dirs($1)
+	allow $1 java_home_t:dir manage_dir_perms;
+	allow $1 java_home_t:file manage_file_perms;
+')
+
+########################################
+## <summary>
+##	Create specified objects in user home
+##	directories with the generic java
+##	home type.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="object_class">
+##	<summary>
+##	Class of the object being created.
+##	</summary>
+## </param>
+## <param name="name" optional="true">
+##	<summary>
+##	The name of the object being created.
+##	</summary>
+## </param>
+#
+interface(`java_home_filetrans_java_home',`
+	gen_require(`
+		type java_home_t;
+	')
+
+	userdom_user_home_dir_filetrans($1, java_home_t, $2, $3)
+')
+
+########################################
+## <summary>
+##	Run java in javaplugin domain and
+##	do not clean the environment (atsecure)
+## </summary>
+## <desc>
+##	<p>
+##	This is needed when java is called by an application with library
+##	settings (such as is the case when invoked as a browser plugin)
+##	</p>
+## </desc>
+## <param name="domain">
+##	<summary>
+##	Domain allowed to transition.
+##	</summary>
+## </param>
+#
+template(`java_noatsecure_domtrans',`
+	gen_require(`
+		type java_t;
+	')
+
+	allow $1 java_t:process noatsecure;
+
+	java_domtrans($1)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/java.te refpolicy/policy/modules/contrib/java.te
--- refpolicy/policy/modules/contrib/java.te	2012-07-25 20:33:04.000000000 +0200
+++ refpolicy/policy/modules/contrib/java.te	2012-11-02 19:49:49.329955068 +0100
@@ -1,4 +1,4 @@
-policy_module(java, 2.6.0)
+policy_module(java, 2.6.3)
 
 ########################################
 #
@@ -6,18 +6,29 @@
 #
 
 ## <desc>
-## <p>
-## Allow java executable stack
-## </p>
+##	<p>
+##	Determine whether java can make
+##	its stack executable.
+##	</p>
 ## </desc>
 gen_tunable(allow_java_execstack, false)
 
-type java_t;
+attribute java_domain;
+
+attribute_role java_roles;
+roleattribute system_r java_roles;
+
+attribute_role unconfined_java_roles;
+
+type java_t, java_domain;
 type java_exec_t;
 userdom_user_application_domain(java_t, java_exec_t)
 typealias java_t alias { staff_javaplugin_t user_javaplugin_t sysadm_javaplugin_t };
 typealias java_t alias { auditadm_javaplugin_t secadm_javaplugin_t };
-role system_r types java_t;
+role java_roles types java_t;
+
+type java_home_t;
+userdom_user_home_content(java_home_t)
 
 type java_tmp_t;
 userdom_user_tmp_file(java_tmp_t)
@@ -31,100 +42,119 @@
 
 type unconfined_java_t;
 init_system_domain(unconfined_java_t, java_exec_t)
+role unconfined_java_roles types unconfined_java_t;
 
 ########################################
 #
-# Local policy
+# Common local policy
 #
 
-allow java_t self:process { signal_perms getsched setsched execmem };
-allow java_t self:fifo_file rw_fifo_file_perms;
-allow java_t self:tcp_socket create_socket_perms;
-allow java_t self:udp_socket create_socket_perms;
-
-manage_dirs_pattern(java_t, java_tmp_t, java_tmp_t)
-manage_files_pattern(java_t, java_tmp_t, java_tmp_t)
-files_tmp_filetrans(java_t, java_tmp_t, { file dir })
-
-manage_files_pattern(java_t, java_tmpfs_t, java_tmpfs_t)
-manage_lnk_files_pattern(java_t, java_tmpfs_t, java_tmpfs_t)
-manage_fifo_files_pattern(java_t, java_tmpfs_t, java_tmpfs_t)
-manage_sock_files_pattern(java_t, java_tmpfs_t, java_tmpfs_t)
-fs_tmpfs_filetrans(java_t, java_tmpfs_t, { file lnk_file sock_file fifo_file })
-
-can_exec(java_t, java_exec_t)
-
-kernel_read_all_sysctls(java_t)
-kernel_search_vm_sysctl(java_t)
-kernel_read_network_state(java_t)
-kernel_read_system_state(java_t)
-
-# Search bin directory under java for java executable
-corecmd_search_bin(java_t)
-
-corenet_all_recvfrom_unlabeled(java_t)
-corenet_all_recvfrom_netlabel(java_t)
-corenet_tcp_sendrecv_generic_if(java_t)
-corenet_udp_sendrecv_generic_if(java_t)
-corenet_tcp_sendrecv_generic_node(java_t)
-corenet_udp_sendrecv_generic_node(java_t)
-corenet_tcp_sendrecv_all_ports(java_t)
-corenet_udp_sendrecv_all_ports(java_t)
-corenet_tcp_connect_all_ports(java_t)
-corenet_sendrecv_all_client_packets(java_t)
-
-dev_read_sound(java_t)
-dev_write_sound(java_t)
-dev_read_urand(java_t)
-dev_read_rand(java_t)
-dev_dontaudit_append_rand(java_t)
-
-files_read_usr_files(java_t)
-files_search_home(java_t)
-files_search_var_lib(java_t)
-files_read_etc_runtime_files(java_t)
-# Read global fonts and font config
-files_read_etc_files(java_t)
-
-fs_getattr_xattr_fs(java_t)
-fs_dontaudit_rw_tmpfs_files(java_t)
-
-logging_send_syslog_msg(java_t)
-
-miscfiles_read_localization(java_t)
-# Read global fonts and font config
-miscfiles_read_fonts(java_t)
-
-sysnet_read_config(java_t)
-
-userdom_dontaudit_use_user_terminals(java_t)
-userdom_dontaudit_setattr_user_home_content_files(java_t)
-userdom_dontaudit_exec_user_home_content_files(java_t)
-userdom_manage_user_home_content_dirs(java_t)
-userdom_manage_user_home_content_files(java_t)
-userdom_manage_user_home_content_symlinks(java_t)
-userdom_manage_user_home_content_pipes(java_t)
-userdom_manage_user_home_content_sockets(java_t)
-userdom_user_home_dir_filetrans_user_home_content(java_t, { file lnk_file sock_file fifo_file })
-userdom_write_user_tmp_sockets(java_t)
+allow java_domain self:process { signal_perms getsched setsched };
+allow java_domain self:fifo_file rw_fifo_file_perms;
 
-tunable_policy(`allow_java_execstack',`
-	allow java_t self:process execstack;
+manage_dirs_pattern(java_domain, java_home_t, java_home_t)
+manage_files_pattern(java_domain, java_home_t, java_home_t)
+userdom_user_home_dir_filetrans(java_domain, java_home_t, dir, ".java")
+
+manage_dirs_pattern(java_domain, java_tmp_t, java_tmp_t)
+manage_files_pattern(java_domain, java_tmp_t, java_tmp_t)
+files_tmp_filetrans(java_domain, java_tmp_t, { file dir })
+
+manage_files_pattern(java_domain, java_tmpfs_t, java_tmpfs_t)
+manage_lnk_files_pattern(java_domain, java_tmpfs_t, java_tmpfs_t)
+manage_fifo_files_pattern(java_domain, java_tmpfs_t, java_tmpfs_t)
+manage_sock_files_pattern(java_domain, java_tmpfs_t, java_tmpfs_t)
+fs_tmpfs_filetrans(java_domain, java_tmpfs_t, { file lnk_file sock_file fifo_file })
+
+can_exec(java_domain, { java_exec_t java_tmp_t })
+
+kernel_read_all_sysctls(java_domain)
+kernel_search_vm_sysctl(java_domain)
+kernel_read_network_state(java_domain)
+kernel_read_system_state(java_domain)
+
+corecmd_search_bin(java_domain)
+
+corenet_all_recvfrom_unlabeled(java_domain)
+corenet_all_recvfrom_netlabel(java_domain)
+corenet_tcp_sendrecv_generic_if(java_domain)
+corenet_tcp_sendrecv_generic_node(java_domain)
+
+corenet_sendrecv_all_client_packets(java_domain)
+corenet_tcp_connect_all_ports(java_domain)
+corenet_tcp_sendrecv_all_ports(java_domain)
+
+dev_read_sound(java_domain)
+dev_write_sound(java_domain)
+dev_read_urand(java_domain)
+dev_read_rand(java_domain)
+dev_dontaudit_append_rand(java_domain)
+
+files_read_usr_files(java_domain)
+files_read_etc_runtime_files(java_domain)
+
+fs_getattr_all_fs(java_domain)
+fs_dontaudit_rw_tmpfs_files(java_domain)
 
-	allow java_t java_tmp_t:file execute;
+logging_send_syslog_msg(java_domain)
 
-	libs_legacy_use_shared_libs(java_t)
-	libs_legacy_use_ld_so(java_t)
+miscfiles_read_localization(java_domain)
+miscfiles_read_fonts(java_domain)
 
-	miscfiles_legacy_read_localization(java_t)
+userdom_dontaudit_use_user_terminals(java_domain)
+userdom_dontaudit_exec_user_home_content_files(java_domain)
+userdom_manage_user_home_content_dirs(java_domain)
+userdom_manage_user_home_content_files(java_domain)
+userdom_manage_user_home_content_symlinks(java_domain)
+userdom_manage_user_home_content_pipes(java_domain)
+userdom_manage_user_home_content_sockets(java_domain)
+userdom_user_home_dir_filetrans_user_home_content(java_domain, { file lnk_file sock_file fifo_file })
+
+userdom_write_user_tmp_sockets(java_domain)
+
+ifdef(`distro_gentoo',`
+	# For java browser plugin accessing internet resources
+	allow java_domain self:netlink_route_socket create_netlink_socket_perms; 
+	allow java_domain self:sem create_sem_perms;
+
+	manage_dirs_pattern(java_domain, java_home_t, java_home_t)
+	manage_files_pattern(java_domain, java_home_t, java_home_t)
+	userdom_user_home_dir_filetrans(java_domain, java_home_t, dir, ".icedtea")
 ')
 
-optional_policy(`
-	nis_use_ypbind(java_t)
+tunable_policy(`allow_java_execstack',`
+	allow java_domain self:process { execmem execstack };
+
+	libs_legacy_use_shared_libs(java_domain)
+	libs_legacy_use_ld_so(java_domain)
+
+	miscfiles_legacy_read_localization(java_domain)
 ')
 
-optional_policy(`
-	nscd_socket_use(java_t)
+########################################
+#
+# Local policy
+#
+
+auth_use_nsswitch(java_t)
+
+ifdef(`distro_gentoo',`
+	userdom_use_user_terminals(java_t)
+
+	optional_policy(`
+		alsa_domain(java_t, java_tmpfs_t)
+		alsa_read_rw_config(java_t)
+	')
+	
+	optional_policy(`
+		# Plugin communication
+		chromium_rw_tmp_pipes(java_t)
+	')
+	
+	optional_policy(`
+		# Plugin communication
+		mozilla_rw_tmp_pipes(java_t)
+	')
 ')
 
 optional_policy(`
@@ -133,11 +163,10 @@
 
 ########################################
 #
-# Unconfined java local policy
+# Unconfined local policy
 #
 
 optional_policy(`
-	# execheap is needed for itanium/BEA jrocket
 	allow unconfined_java_t self:process { execstack execmem execheap };
 
 	files_execmod_all_files(unconfined_java_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/kdump.fc refpolicy/policy/modules/contrib/kdump.fc
--- refpolicy/policy/modules/contrib/kdump.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/kdump.fc	2012-10-08 20:12:04.842033661 +0200
@@ -1,5 +1,13 @@
 /etc/kdump\.conf	--	gen_context(system_u:object_r:kdump_etc_t,s0)
-/etc/rc\.d/init\.d/kdump --	gen_context(system_u:object_r:kdump_initrc_exec_t,s0)
 
-/sbin/kdump		--	gen_context(system_u:object_r:kdump_exec_t,s0)
-/sbin/kexec		--	gen_context(system_u:object_r:kdump_exec_t,s0)
+/etc/rc\.d/init\.d/kdump	--	gen_context(system_u:object_r:kdump_initrc_exec_t,s0)
+
+/bin/kdumpctl	--	gen_context(system_u:object_r:kdumpctl_exec_t,s0)
+
+/usr/bin/kdumpctl	--	gen_context(system_u:object_r:kdumpctl_exec_t,s0)
+
+/sbin/kdump	--	gen_context(system_u:object_r:kdump_exec_t,s0)
+/sbin/kexec	--	gen_context(system_u:object_r:kdump_exec_t,s0)
+
+/usr/sbin/kdump	--	gen_context(system_u:object_r:kdump_exec_t,s0)
+/usr/sbin/kexec	--	gen_context(system_u:object_r:kdump_exec_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/kdump.if refpolicy/policy/modules/contrib/kdump.if
--- refpolicy/policy/modules/contrib/kdump.if	2012-05-04 15:16:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/kdump.if	2012-10-08 20:12:05.154033669 +0200
@@ -1,4 +1,4 @@
-## <summary>Kernel crash dumping mechanism</summary>
+## <summary>Kernel crash dumping mechanism.</summary>
 
 ######################################
 ## <summary>
@@ -39,7 +39,7 @@
 
 #####################################
 ## <summary>
-##	Read kdump configuration file.
+##	Read kdump configuration files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -58,7 +58,8 @@
 
 ####################################
 ## <summary>
-##	Manage kdump configuration file.
+##	Create, read, write, and delete
+##	kdmup configuration files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -77,8 +78,8 @@
 
 ######################################
 ## <summary>
-##	All of the rules required to administrate 
-##	an kdump environment
+##	All of the rules required to
+##	administrate an kdump environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -87,19 +88,19 @@
 ## </param>
 ## <param name="role">
 ##	<summary>
-##	The role to be allowed to manage the kdump domain.
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <rolecap/>
 #
 interface(`kdump_admin',`
 	gen_require(`
-		type kdump_t, kdump_etc_t;
-		type kdump_initrc_exec_t;
+		type kdump_t, kdump_etc_t, kdumpctl_tmp_t;
+		type kdump_initrc_exec_t, kdumpctl_t;
 	')
 
-	allow $1 kdump_t:process { ptrace signal_perms };
-	ps_process_pattern($1, kdump_t)
+	allow $1 { kdump_t kdumpctl_t }:process { ptrace signal_perms };
+	ps_process_pattern($1, { kdump_t kdumpctl_t })
 
 	init_labeled_script_domtrans($1, kdump_initrc_exec_t)
 	domain_system_change_exemption($1)
@@ -108,4 +109,7 @@
 
 	files_search_etc($1)
 	admin_pattern($1, kdump_etc_t)
+
+	files_search_tmp($1)
+	admin_pattern($1, kdumpctl_tmp_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/kdump.te refpolicy/policy/modules/contrib/kdump.te
--- refpolicy/policy/modules/contrib/kdump.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/kdump.te	2012-10-30 19:32:29.167399562 +0100
@@ -1,4 +1,4 @@
-policy_module(kdump, 1.2.0)
+policy_module(kdump, 1.2.2)
 
 #######################################
 #
@@ -15,24 +15,101 @@
 type kdump_initrc_exec_t;
 init_script_file(kdump_initrc_exec_t)
 
+type kdumpctl_t;
+type kdumpctl_exec_t;
+init_daemon_domain(kdumpctl_t, kdumpctl_exec_t)
+application_executable_file(kdumpctl_exec_t)
+
+type kdumpctl_tmp_t;
+files_tmp_file(kdumpctl_tmp_t)
+
 #####################################
 #
-# kdump local policy
+# Local policy
 #
 
 allow kdump_t self:capability { sys_boot dac_override };
 
-read_files_pattern(kdump_t, kdump_etc_t, kdump_etc_t)
+allow kdump_t kdump_etc_t:file read_file_perms;
 
+files_read_etc_files(kdump_t)
 files_read_etc_runtime_files(kdump_t)
 files_read_kernel_img(kdump_t)
 
-kernel_read_system_state(kdump_t)
 kernel_read_core_if(kdump_t)
 kernel_read_debugfs(kdump_t)
+kernel_read_system_state(kdump_t)
 kernel_request_load_module(kdump_t)
 
 dev_read_framebuffer(kdump_t)
 dev_read_sysfs(kdump_t)
 
 term_use_console(kdump_t)
+
+#######################################
+#
+# Ctl local policy
+#
+
+allow kdumpctl_t self:capability { dac_override sys_chroot };
+allow kdumpctl_t self:process setfscreate;
+allow kdumpctl_t self:fifo_file rw_fifo_file_perms;
+allow kdumpctl_t self:unix_stream_socket { accept listen };
+
+allow kdumpctl_t kdump_etc_t:file read_file_perms;
+
+manage_dirs_pattern(kdumpctl_t, kdumpctl_tmp_t, kdumpctl_tmp_t)
+manage_files_pattern(kdumpctl_t, kdumpctl_tmp_t, kdumpctl_tmp_t)
+manage_lnk_files_pattern(kdumpctl_t, kdumpctl_tmp_t, kdumpctl_tmp_t)
+files_tmp_filetrans(kdumpctl_t, kdumpctl_tmp_t, { file dir lnk_file })
+
+domtrans_pattern(kdumpctl_t, kdump_exec_t, kdump_t)
+
+kernel_read_system_state(kdumpctl_t)
+
+corecmd_exec_bin(kdumpctl_t)
+corecmd_exec_shell(kdumpctl_t)
+
+dev_read_sysfs(kdumpctl_t)
+dev_manage_all_dev_nodes(kdumpctl_t)
+
+domain_use_interactive_fds(kdumpctl_t)
+
+files_create_kernel_img(kdumpctl_t)
+files_read_etc_files(kdumpctl_t)
+files_read_etc_runtime_files(kdumpctl_t)
+files_read_usr_files(kdumpctl_t)
+files_read_kernel_modules(kdumpctl_t)
+files_getattr_all_dirs(kdumpctl_t)
+
+fs_getattr_all_fs(kdumpctl_t)
+
+init_domtrans_script(kdumpctl_t)
+init_exec(kdumpctl_t)
+
+libs_exec_ld_so(kdumpctl_t)
+
+logging_send_syslog_msg(kdumpctl_t)
+
+miscfiles_read_localization(kdumpctl_t)
+
+optional_policy(`
+	gpg_exec(kdumpctl_t)
+')
+
+optional_policy(`
+	lvm_read_config(kdumpctl_t)
+')
+
+optional_policy(`
+	modutils_domtrans_insmod(kdumpctl_t)
+	modutils_read_module_config(kdumpctl_t)
+')
+
+optional_policy(`
+	plymouthd_domtrans_plymouth(kdumpctl_t)
+')
+
+optional_policy(`
+	ssh_exec(kdumpctl_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/kdumpgui.if refpolicy/policy/modules/contrib/kdumpgui.if
--- refpolicy/policy/modules/contrib/kdumpgui.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/kdumpgui.if	2012-10-10 21:34:10.966026188 +0200
@@ -1,2 +1 @@
-## <summary>system-config-kdump GUI</summary>
-
+## <summary>System-config-kdump GUI.</summary>
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/kdumpgui.te refpolicy/policy/modules/contrib/kdumpgui.te
--- refpolicy/policy/modules/contrib/kdumpgui.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/kdumpgui.te	2012-10-30 19:32:30.726399566 +0100
@@ -1,4 +1,4 @@
-policy_module(kdumpgui, 1.1.0)
+policy_module(kdumpgui, 1.1.3)
 
 ########################################
 #
@@ -7,59 +7,83 @@
 
 type kdumpgui_t;
 type kdumpgui_exec_t;
-dbus_system_domain(kdumpgui_t, kdumpgui_exec_t)
+init_system_domain(kdumpgui_t, kdumpgui_exec_t)
+
+type kdumpgui_tmp_t;
+files_tmp_file(kdumpgui_tmp_t)
 
 ######################################
 #
-# system-config-kdump local policy
+# Local policy
 #
 
-allow kdumpgui_t self:capability { net_admin sys_admin sys_rawio };
+allow kdumpgui_t self:capability { net_admin sys_admin sys_nice sys_rawio };
+allow kdumpgui_t self:process { setsched sigkill };
 allow kdumpgui_t self:fifo_file rw_fifo_file_perms;
 allow kdumpgui_t self:netlink_kobject_uevent_socket create_socket_perms;
 
+manage_dirs_pattern(kdumpgui_t, kdumpgui_tmp_t, kdumpgui_tmp_t)
+manage_files_pattern(kdumpgui_t, kdumpgui_tmp_t, kdumpgui_tmp_t)
+files_tmp_filetrans(kdumpgui_t, kdumpgui_tmp_t, { dir file })
+
+kernel_getattr_core_if(kdumpgui_t)
 kernel_read_system_state(kdumpgui_t)
 kernel_read_network_state(kdumpgui_t)
 
 corecmd_exec_bin(kdumpgui_t)
 corecmd_exec_shell(kdumpgui_t)
 
+dev_getattr_all_blk_files(kdumpgui_t)
 dev_dontaudit_getattr_all_chr_files(kdumpgui_t)
 dev_read_sysfs(kdumpgui_t)
 
 files_manage_boot_files(kdumpgui_t)
 files_manage_boot_symlinks(kdumpgui_t)
-# Needed for running chkconfig
 files_manage_etc_symlinks(kdumpgui_t)
-# for blkid.tab
 files_manage_etc_runtime_files(kdumpgui_t)
 files_etc_filetrans_etc_runtime(kdumpgui_t, file)
 files_read_usr_files(kdumpgui_t)
 
+fs_getattr_all_fs(kdumpgui_t)
+fs_list_hugetlbfs(kdumpgui_t)
+fs_read_dos_files(kdumpgui_t)
+
 storage_raw_read_fixed_disk(kdumpgui_t)
 storage_raw_write_fixed_disk(kdumpgui_t)
 
 auth_use_nsswitch(kdumpgui_t)
 
+logging_list_logs(kdumpgui_t)
+logging_read_generic_logs(kdumpgui_t)
 logging_send_syslog_msg(kdumpgui_t)
 
 miscfiles_read_localization(kdumpgui_t)
 
+mount_exec(kdumpgui_t)
+
 init_dontaudit_read_all_script_files(kdumpgui_t)
 
 optional_policy(`
+	bootloader_exec(kdumpgui_t)
+')
+
+optional_policy(`
 	consoletype_exec(kdumpgui_t)
 ')
 
 optional_policy(`
-	dev_rw_lvm_control(kdumpgui_t)
+	dbus_system_domain(kdumpgui_t, kdumpgui_exec_t)
+
+	optional_policy(`
+		policykit_dbus_chat(kdumpgui_t)
+	')
 ')
 
 optional_policy(`
-	kdump_manage_config(kdumpgui_t)
-	kdump_initrc_domtrans(kdumpgui_t)
+	dev_rw_lvm_control(kdumpgui_t)
 ')
 
 optional_policy(`
-	policykit_dbus_chat(kdumpgui_t)
+	kdump_manage_config(kdumpgui_t)
+	kdump_initrc_domtrans(kdumpgui_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/kerberos.fc refpolicy/policy/modules/contrib/kerberos.fc
--- refpolicy/policy/modules/contrib/kerberos.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/kerberos.fc	2012-10-10 21:34:16.387026199 +0200
@@ -1,33 +1,52 @@
-HOME_DIR/\.k5login		--	gen_context(system_u:object_r:krb5_home_t,s0)
-/root/\.k5login			--	gen_context(system_u:object_r:krb5_home_t,s0)
+HOME_DIR/\.k5login	--	gen_context(system_u:object_r:krb5_home_t,s0)
+/root/\.k5login	--	gen_context(system_u:object_r:krb5_home_t,s0)
 
-/etc/krb5\.conf			--	gen_context(system_u:object_r:krb5_conf_t,s0)
-/etc/krb5\.keytab			gen_context(system_u:object_r:krb5_keytab_t,s0)
+/etc/krb5\.conf	--	gen_context(system_u:object_r:krb5_conf_t,s0)
+/etc/krb5\.keytab	--	gen_context(system_u:object_r:krb5_keytab_t,s0)
 
-/etc/krb5kdc(/.*)?			gen_context(system_u:object_r:krb5kdc_conf_t,s0)
-/etc/krb5kdc/kadm5\.keytab 	--	gen_context(system_u:object_r:krb5_keytab_t,s0)
-/etc/krb5kdc/principal.*		gen_context(system_u:object_r:krb5kdc_principal_t,s0)
+/etc/krb5kdc(/.*)?	gen_context(system_u:object_r:krb5kdc_conf_t,s0)
+/etc/krb5kdc/kadm5\.keytab	--	gen_context(system_u:object_r:krb5_keytab_t,s0)
+/etc/krb5kdc/principal.*	gen_context(system_u:object_r:krb5kdc_principal_t,s0)
 
 /etc/rc\.d/init\.d/kadmind	--	gen_context(system_u:object_r:kerberos_initrc_exec_t,s0)
 /etc/rc\.d/init\.d/kprop	--	gen_context(system_u:object_r:kerberos_initrc_exec_t,s0)
 /etc/rc\.d/init\.d/krb524d	--	gen_context(system_u:object_r:kerberos_initrc_exec_t,s0)
 /etc/rc\.d/init\.d/krb5kdc	--	gen_context(system_u:object_r:kerberos_initrc_exec_t,s0)
 
-/usr/(local/)?(kerberos/)?sbin/krb5kdc -- gen_context(system_u:object_r:krb5kdc_exec_t,s0)
-/usr/(local/)?(kerberos/)?sbin/kadmind -- gen_context(system_u:object_r:kadmind_exec_t,s0)
-/usr/kerberos/sbin/kadmin\.local --	gen_context(system_u:object_r:kadmind_exec_t,s0)
+/usr/kerberos/sbin/krb5kdc	--	gen_context(system_u:object_r:krb5kdc_exec_t,s0)
+/usr/kerberos/sbin/kadmind	--	gen_context(system_u:object_r:kadmind_exec_t,s0)
+/usr/kerberos/sbin/kadmin\.local	--	gen_context(system_u:object_r:kadmind_exec_t,s0)
 /usr/kerberos/sbin/kpropd	--	gen_context(system_u:object_r:kpropd_exec_t,s0)
 
-/usr/local/var/krb5kdc(/.*)?		gen_context(system_u:object_r:krb5kdc_conf_t,s0)
+/usr/local/kerberos/sbin/krb5kdc	--	gen_context(system_u:object_r:krb5kdc_exec_t,s0)
+/usr/local/kerberos/sbin/kadmind	--	gen_context(system_u:object_r:kadmind_exec_t,s0)
+
+/usr/sbin/krb5kdc	--	gen_context(system_u:object_r:krb5kdc_exec_t,s0)
+/usr/sbin/kadmind	--	gen_context(system_u:object_r:kadmind_exec_t,s0)
+
+/usr/local/var/krb5kdc(/.*)?	gen_context(system_u:object_r:krb5kdc_conf_t,s0)
 /usr/local/var/krb5kdc/principal.*	gen_context(system_u:object_r:krb5kdc_principal_t,s0)
 
-/var/kerberos/krb5kdc(/.*)?		gen_context(system_u:object_r:krb5kdc_conf_t,s0)
+/usr/var/krb5kdc(/.*)?	gen_context(system_u:object_r:krb5kdc_conf_t,s0)
+/usr/var/krb5kdc/principal.*	gen_context(system_u:object_r:krb5kdc_principal_t,s0)
+
+/var/cache/krb5rcache(/.*)?	gen_context(system_u:object_r:krb5_host_rcache_t,s0)
+
+/var/kerberos/krb5kdc(/.*)?	gen_context(system_u:object_r:krb5kdc_conf_t,s0)
 /var/kerberos/krb5kdc/from_master.*	gen_context(system_u:object_r:krb5kdc_lock_t,s0)
-/var/kerberos/krb5kdc/kadm5\.keytab --	gen_context(system_u:object_r:krb5_keytab_t,s0)
+/var/kerberos/krb5kdc/kadm5\.keytab	--	gen_context(system_u:object_r:krb5_keytab_t,s0)
 /var/kerberos/krb5kdc/principal.*	gen_context(system_u:object_r:krb5kdc_principal_t,s0)
-/var/kerberos/krb5kdc/principal.*\.ok	gen_context(system_u:object_r:krb5kdc_lock_t,s0)
-
-/var/log/krb5kdc\.log			gen_context(system_u:object_r:krb5kdc_log_t,s0)
-/var/log/kadmin(d)?\.log		gen_context(system_u:object_r:kadmind_log_t,s0)
+/var/kerberos/krb5kdc/principal.*\.ok	--	gen_context(system_u:object_r:krb5kdc_lock_t,s0)
 
-/var/tmp/host_0			-- 	gen_context(system_u:object_r:krb5_host_rcache_t,s0)
+/var/log/krb5kdc\.log.*	--	gen_context(system_u:object_r:krb5kdc_log_t,s0)
+/var/log/kadmin\.log.*	--	gen_context(system_u:object_r:kadmind_log_t,s0)
+/var/log/kadmind\.log.*	--	gen_context(system_u:object_r:kadmind_log_t,s0)
+
+/var/tmp/host_0	--	gen_context(system_u:object_r:krb5_host_rcache_t,s0)
+/var/tmp/HTTP_23	--	gen_context(system_u:object_r:krb5_host_rcache_t,s0)
+/var/tmp/HTTP_48	--	gen_context(system_u:object_r:krb5_host_rcache_t,s0)
+/var/tmp/imap_0	--	gen_context(system_u:object_r:krb5_host_rcache_t,s0)
+/var/tmp/nfs_0	--	gen_context(system_u:object_r:krb5_host_rcache_t,s0)
+/var/tmp/ldapmap1_0	--	gen_context(system_u:object_r:krb5_host_rcache_t,s0)
+/var/tmp/ldap_487	--	gen_context(system_u:object_r:krb5_host_rcache_t,s0)
+/var/tmp/ldap_55	--	gen_context(system_u:object_r:krb5_host_rcache_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/kerberos.if refpolicy/policy/modules/contrib/kerberos.if
--- refpolicy/policy/modules/contrib/kerberos.if	2012-05-04 15:16:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/kerberos.if	2012-10-24 17:01:31.524003123 +0200
@@ -1,29 +1,27 @@
-## <summary>MIT Kerberos admin and KDC</summary>
-## <desc>
-##	<p>
-##	This policy supports:
-##	</p>
-##	<p>
-##	Servers:
-##	<ul>
-##		<li>kadmind</li>
-##		<li>krb5kdc</li>
-##	</ul>
-##	</p>
-##	<p>
-##	Clients:
-##	<ul>
-##		<li>kinit</li>
-##		<li>kdestroy</li>
-##		<li>klist</li>
-##		<li>ksu (incomplete)</li>
-##	</ul>
-##	</p>
-## </desc>
+## <summary>MIT Kerberos admin and KDC.</summary>
 
 ########################################
 ## <summary>
-##	Execute kadmind in the current domain
+##	Role access for kerberos.
+## </summary>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <param name="domain">
+##	<summary>
+##	User domain for the role.
+##	</summary>
+## </param>
+#
+template(`kerberos_role',`
+	refpolicywarn(`$0($*) has been deprecated')
+')
+
+########################################
+## <summary>
+##	Execute kadmind in the caller domain.
 ## </summary>
 ## <param name="domain">
 ## <summary>
@@ -36,6 +34,7 @@
 		type kadmind_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	can_exec($1, kadmind_exec_t)
 ')
 
@@ -54,12 +53,13 @@
 		type kpropd_t, kpropd_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, kpropd_exec_t, kpropd_t)
 ')
 
 ########################################
 ## <summary>
-##	Use kerberos services
+##	Support kerberos services.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -69,18 +69,17 @@
 #
 interface(`kerberos_use',`
 	gen_require(`
-		type krb5_conf_t, krb5kdc_conf_t;
-		type krb5_host_rcache_t;
+		type krb5kdc_conf_t, krb5_host_rcache_t;
 	')
 
-	files_search_etc($1)
-	read_files_pattern($1, krb5_conf_t, krb5_conf_t)
-	dontaudit $1 krb5_conf_t:file write;
+	kerberos_read_config($1)
+
+	dontaudit $1 krb5_conf_t:file write_file_perms;
 	dontaudit $1 krb5kdc_conf_t:dir list_dir_perms;
 	dontaudit $1 krb5kdc_conf_t:file rw_file_perms;
 
-	#kerberos libraries are attempting to set the correct file context
 	dontaudit $1 self:process setfscreate;
+
 	selinux_dontaudit_validate_context($1)
 	seutil_dontaudit_read_file_contexts($1)
 
@@ -94,16 +93,17 @@
 		corenet_udp_sendrecv_generic_if($1)
 		corenet_tcp_sendrecv_generic_node($1)
 		corenet_udp_sendrecv_generic_node($1)
+
+		corenet_sendrecv_kerberos_client_packets($1)
+		corenet_tcp_connect_kerberos_port($1)
 		corenet_tcp_sendrecv_kerberos_port($1)
 		corenet_udp_sendrecv_kerberos_port($1)
-		corenet_tcp_bind_generic_node($1)
-		corenet_udp_bind_generic_node($1)
-		corenet_tcp_connect_kerberos_port($1)
-		corenet_tcp_connect_ocsp_port($1)
-		corenet_sendrecv_kerberos_client_packets($1)
+
 		corenet_sendrecv_ocsp_client_packets($1)
+		corenet_tcp_connect_ocsp_port($1)
+		corenet_tcp_sendrecv_ocsp_port($1)
 
-		allow $1 krb5_host_rcache_t:file getattr;
+		allow $1 krb5_host_rcache_t:file getattr_file_perms;
 	')
 
 	optional_policy(`
@@ -119,7 +119,7 @@
 
 ########################################
 ## <summary>
-##	Read the kerberos configuration file (/etc/krb5.conf).
+##	Read kerberos configuration files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -135,13 +135,15 @@
 
 	files_search_etc($1)
 	allow $1 krb5_conf_t:file read_file_perms;
+
+	userdom_search_user_home_dirs($1)
 	allow $1 krb5_home_t:file read_file_perms;
 ')
 
 ########################################
 ## <summary>
-##	Do not audit attempts to write the kerberos
-##	configuration file (/etc/krb5.conf).
+##	Do not audit attempts to write
+##	kerberos configuration files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -154,12 +156,13 @@
 		type krb5_conf_t;
 	')
 
-	dontaudit $1 krb5_conf_t:file write;
+	dontaudit $1 krb5_conf_t:file write_file_perms;
 ')
 
 ########################################
 ## <summary>
-##	Read and write the kerberos configuration file (/etc/krb5.conf).
+##	Read and write kerberos
+##	configuration files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -179,7 +182,75 @@
 
 ########################################
 ## <summary>
-##	Read the kerberos key table.
+##	Create, read, write, and delete
+##	kerberos home files.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`kerberos_manage_krb5_home_files',`
+	gen_require(`
+		type krb5_home_t;
+	')
+
+	userdom_search_user_home_dirs($1)
+	allow $1 krb5_home_t:file manage_file_perms;
+')
+
+########################################
+## <summary>
+##	Relabel kerberos home files.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`kerberos_relabel_krb5_home_files',`
+	gen_require(`
+		type krb5_home_t;
+	')
+
+	userdom_search_user_home_dirs($1)
+	allow $1 krb5_home_t:file relabel_file_perms;
+')
+
+########################################
+## <summary>
+##	Create objects in user home
+##	directories with the krb5 home type.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="object_class">
+##	<summary>
+##	Class of the object being created.
+##	</summary>
+## </param>
+## <param name="name" optional="true">
+##	<summary>
+##	The name of the object being created.
+##	</summary>
+## </param>
+#
+interface(`kerberos_home_filetrans_krb5_home',`
+	gen_require(`
+		type krb5_home_t;
+	')
+
+	userdom_user_home_dir_filetrans($1, krb5_home_t, $2, $3)
+')
+
+########################################
+## <summary>
+##	Read kerberos key table files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -199,7 +270,7 @@
 
 ########################################
 ## <summary>
-##	Read/Write the kerberos key table.
+##	Read and write kerberos key table files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -218,7 +289,58 @@
 
 ########################################
 ## <summary>
-##	Create a derived type for kerberos keytab
+##	Create, read, write, and delete
+##	kerberos key table files.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`kerberos_manage_keytab_files',`
+	gen_require(`
+		type krb5_keytab_t;
+	')
+
+	files_search_etc($1)
+	allow $1 krb5_keytab_t:file manage_file_perms;
+')
+
+########################################
+## <summary>
+##	Create specified objects in generic
+##	etc directories with the kerberos
+##	keytab file type.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="object_class">
+##	<summary>
+##	Class of the object being created.
+##	</summary>
+## </param>
+## <param name="name" optional="true">
+##	<summary>
+##	The name of the object being created.
+##	</summary>
+## </param>
+#
+interface(`kerberos_etc_filetrans_keytab',`
+	gen_require(`
+		type krb5_keytab_t;
+	')
+
+	files_etc_filetrans($1, krb5_keytab_t, $2, $3)
+')
+
+########################################
+## <summary>
+##	Create a derived type for kerberos
+##	keytab files.
 ## </summary>
 ## <param name="prefix">
 ##	<summary>
@@ -232,10 +354,21 @@
 ## </param>
 #
 template(`kerberos_keytab_template',`
+
+	########################################
+	#
+	# Declarations
+	#
+
 	type $1_keytab_t;
 	files_type($1_keytab_t)
 
- 	allow $2 $1_keytab_t:file read_file_perms;
+	########################################
+	#
+	# Policy
+	#
+
+	allow $2 $1_keytab_t:file read_file_perms;
 
 	kerberos_read_keytab($2)
 	kerberos_use($2)
@@ -243,7 +376,7 @@
 
 ########################################
 ## <summary>
-##	Read the kerberos kdc configuration file (/etc/krb5kdc.conf).
+##	Read kerberos kdc configuration files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -263,7 +396,8 @@
 
 ########################################
 ## <summary>
-##	Read the kerberos kdc configuration file (/etc/krb5kdc.conf).
+##	Create, read, write, and delete
+##	kerberos host rcache files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -277,9 +411,6 @@
 		type krb5_host_rcache_t;
 	')
 
-	# creates files as system_u no matter what the selinux user
-	# cjp: should be in the below tunable but typeattribute
-	# does not work in conditionals
 	domain_obj_id_change_exemption($1)
 
 	tunable_policy(`allow_kerberos',`
@@ -289,14 +420,44 @@
 
 		seutil_read_file_contexts($1)
 
-		allow $1 krb5_host_rcache_t:file manage_file_perms;
 		files_search_tmp($1)
+		allow $1 krb5_host_rcache_t:file manage_file_perms;
+	')
+')
+
+########################################
+## <summary>
+##	Create objects in generic temporary
+##	directories with the kerberos host
+##	rcache type.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed to transition.
+##	</summary>
+## </param>
+## <param name="object_class">
+##	<summary>
+##	Class of the object being created.
+##	</summary>
+## </param>
+## <param name="name" optional="true">
+##	<summary>
+##	The name of the object being created.
+##	</summary>
+## </param>
+#
+interface(`kerberos_tmp_filetrans_host_rcache',`
+	gen_require(`
+		type krb5_host_rcache_t;
 	')
+
+	files_tmp_filetrans($1, krb5_host_rcache_t, $2, $3)
 ')
 
 ########################################
 ## <summary>
-##	Connect to krb524 service
+##	Connect to krb524 service.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -309,17 +470,19 @@
 		allow $1 self:udp_socket create_socket_perms;
 
 		corenet_all_recvfrom_unlabeled($1)
+		corenet_all_recvfrom_netlabel($1)
 		corenet_udp_sendrecv_generic_if($1)
 		corenet_udp_sendrecv_generic_node($1)
-		corenet_udp_sendrecv_kerberos_master_port($1)
+
 		corenet_sendrecv_kerberos_master_client_packets($1)
+		corenet_udp_sendrecv_kerberos_master_port($1)
 	')
 ')
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate 
-##	an kerberos environment
+##	All of the rules required to
+##	administrate an kerberos environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -328,7 +491,7 @@
 ## </param>
 ## <param name="role">
 ##	<summary>
-##	The role to be allowed to manage the kerberos domain.
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <rolecap/>
@@ -338,19 +501,12 @@
 		type kadmind_t, krb5kdc_t, kerberos_initrc_exec_t;
 		type kadmind_log_t, kadmind_tmp_t, kadmind_var_run_t;
 		type krb5_conf_t, krb5_keytab_t, krb5kdc_conf_t;
-		type krb5kdc_principal_t, krb5kdc_tmp_t;
+		type krb5kdc_principal_t, krb5kdc_tmp_t, kpropd_t;
 		type krb5kdc_var_run_t, krb5_host_rcache_t;
-		type kpropd_t;
 	')
 
-	allow $1 kadmind_t:process { ptrace signal_perms };
-	ps_process_pattern($1, kadmind_t)
-
-	allow $1 krb5kdc_t:process { ptrace signal_perms };
-	ps_process_pattern($1, krb5kdc_t)
-
-	allow $1 kpropd_t:process { ptrace signal_perms };
-	ps_process_pattern($1, kpropd_t)
+	allow $1 { kadmind_t krb5kdc_t kpropd }:process { ptrace signal_perms };
+	ps_process_pattern($1, { kadmind_t krb5kdc_t kpropd })
 
 	init_labeled_script_domtrans($1, kerberos_initrc_exec_t)
 	domain_system_change_exemption($1)
@@ -361,20 +517,30 @@
 	admin_pattern($1, kadmind_log_t)
 
 	files_list_tmp($1)
-	admin_pattern($1, kadmind_tmp_t)
+	admin_pattern($1, { kadmind_tmp_t krb5_host_rcache_t krb5kdc_tmp_t })
+
+	kerberos_tmp_filetrans_host_rcache($1, file, "host_0")
+	kerberos_tmp_filetrans_host_rcache($1, file, "HTTP_23")
+	kerberos_tmp_filetrans_host_rcache($1, file, "HTTP_48")
+	kerberos_tmp_filetrans_host_rcache($1, file, "imap_0")
+	kerberos_tmp_filetrans_host_rcache($1, file, "nfs_0")
+	kerberos_tmp_filetrans_host_rcache($1, file, "ldapmap1_0")
+	kerberos_tmp_filetrans_host_rcache($1, file, "ldap_487")
+	kerberos_tmp_filetrans_host_rcache($1, file, "ldap_55")
 
 	files_list_pids($1)
-	admin_pattern($1, kadmind_var_run_t)
+	admin_pattern($1, { kadmind_var_run_t krb5kdc_var_run_t })
 
+	files_list_etc($1)
 	admin_pattern($1, krb5_conf_t)
 
-	admin_pattern($1, krb5_host_rcache_t)
-
-	admin_pattern($1, krb5_keytab_t)
+	files_etc_filetrans($1, krb5_conf_t, file, "krb5.conf")
 
-	admin_pattern($1, krb5kdc_principal_t)
+	admin_pattern($1, { krb5_keytab_t  krb5kdc_principal_t })
 
-	admin_pattern($1, krb5kdc_tmp_t)
+	filetrans_pattern($1, krb5kdc_conf_t, krb5kdc_principal_t, file, "principal")
+	filetrans_pattern($1, krb5kdc_conf_t, krb5kdc_principal_t, file, "principal0")
+	filetrans_pattern($1, krb5kdc_conf_t, krb5kdc_principal_t, file, "principal1")
 
-	admin_pattern($1, krb5kdc_var_run_t)
+	kerberos_etc_filetrans_keytab($1, file, "kadm5.keytab")
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/kerberos.te refpolicy/policy/modules/contrib/kerberos.te
--- refpolicy/policy/modules/contrib/kerberos.te	2012-07-10 14:45:57.000000000 +0200
+++ refpolicy/policy/modules/contrib/kerberos.te	2012-10-24 17:01:31.534003121 +0200
@@ -1,4 +1,4 @@
-policy_module(kerberos, 1.11.0)
+policy_module(kerberos, 1.11.4)
 
 ########################################
 #
@@ -6,9 +6,9 @@
 #
 
 ## <desc>
-## <p>
-## Allow confined applications to run with kerberos.
-## </p>
+##	<p>
+##	Determine whether kerberos is supported.
+##	</p>
 ## </desc>
 gen_tunable(allow_kerberos, false)
 
@@ -43,18 +43,15 @@
 type krb5_host_rcache_t;
 files_tmp_file(krb5_host_rcache_t)
 
-# types for general configuration files in /etc
 type krb5_keytab_t;
 files_security_file(krb5_keytab_t)
 
-# types for KDC configs and principal file(s)
 type krb5kdc_conf_t;
 files_type(krb5kdc_conf_t)
 
 type krb5kdc_lock_t;
 files_type(krb5kdc_lock_t)
 
-# types for KDC principal file(s)
 type krb5kdc_principal_t;
 files_type(krb5kdc_principal_t)
 
@@ -77,31 +74,27 @@
 # kadmind local policy
 #
 
-# Use capabilities. Surplus capabilities may be allowed.
 allow kadmind_t self:capability { setuid setgid chown fowner dac_override sys_nice };
 dontaudit kadmind_t self:capability sys_tty_config;
-allow kadmind_t self:process { setfscreate signal_perms };
+allow kadmind_t self:process { setfscreate setsched getsched signal_perms };
 allow kadmind_t self:netlink_route_socket r_netlink_socket_perms;
-allow kadmind_t self:unix_dgram_socket { connect create write };
-allow kadmind_t self:tcp_socket connected_stream_socket_perms;
+allow kadmind_t self:tcp_socket { accept listen };
 allow kadmind_t self:udp_socket create_socket_perms;
 
-allow kadmind_t kadmind_log_t:file manage_file_perms;
+allow kadmind_t kadmind_log_t:file { append_file_perms create_file_perms setattr_file_perms };
 logging_log_filetrans(kadmind_t, kadmind_log_t, file)
 
 allow kadmind_t krb5_conf_t:file read_file_perms;
-dontaudit kadmind_t krb5_conf_t:file write;
+dontaudit kadmind_t krb5_conf_t:file write_file_perms;
 
 read_files_pattern(kadmind_t, krb5kdc_conf_t, krb5kdc_conf_t)
-dontaudit kadmind_t krb5kdc_conf_t:file { write setattr };
+dontaudit kadmind_t krb5kdc_conf_t:file { write_file_perms setattr_file_perms };
 
-allow kadmind_t krb5kdc_lock_t:file { rw_file_perms setattr };
+allow kadmind_t krb5kdc_lock_t:file { rw_file_perms setattr_file_perms };
 
 allow kadmind_t krb5kdc_principal_t:file manage_file_perms;
 filetrans_pattern(kadmind_t, krb5kdc_conf_t, krb5kdc_principal_t, file)
 
-can_exec(kadmind_t, kadmind_exec_t)
-
 manage_dirs_pattern(kadmind_t, kadmind_tmp_t, kadmind_tmp_t)
 manage_files_pattern(kadmind_t, kadmind_tmp_t, kadmind_tmp_t)
 files_tmp_filetrans(kadmind_t, kadmind_tmp_t, { file dir })
@@ -109,10 +102,10 @@
 manage_files_pattern(kadmind_t, kadmind_var_run_t, kadmind_var_run_t)
 files_pid_filetrans(kadmind_t, kadmind_var_run_t, file)
 
+can_exec(kadmind_t, kadmind_exec_t)
+
 kernel_read_kernel_sysctls(kadmind_t)
-kernel_list_proc(kadmind_t)
 kernel_read_network_state(kadmind_t)
-kernel_read_proc_symlinks(kadmind_t)
 kernel_read_system_state(kadmind_t)
 
 corenet_all_recvfrom_unlabeled(kadmind_t)
@@ -125,15 +118,13 @@
 corenet_udp_sendrecv_all_ports(kadmind_t)
 corenet_tcp_bind_generic_node(kadmind_t)
 corenet_udp_bind_generic_node(kadmind_t)
+
+corenet_sendrecv_all_server_packets(kadmind_t)
 corenet_tcp_bind_kerberos_admin_port(kadmind_t)
 corenet_udp_bind_kerberos_admin_port(kadmind_t)
 corenet_tcp_bind_reserved_port(kadmind_t)
-corenet_dontaudit_tcp_bind_all_reserved_ports(kadmind_t)
-corenet_sendrecv_kerberos_admin_server_packets(kadmind_t)
 
 dev_read_sysfs(kadmind_t)
-dev_read_rand(kadmind_t)
-dev_read_urand(kadmind_t)
 
 fs_getattr_all_fs(kadmind_t)
 fs_search_auto_mountpoints(kadmind_t)
@@ -141,7 +132,6 @@
 domain_use_interactive_fds(kadmind_t)
 
 files_read_etc_files(kadmind_t)
-files_read_usr_symlinks(kadmind_t)
 files_read_usr_files(kadmind_t)
 files_read_var_files(kadmind_t)
 
@@ -153,7 +143,6 @@
 
 seutil_read_file_contexts(kadmind_t)
 
-sysnet_read_config(kadmind_t)
 sysnet_use_ldap(kadmind_t)
 
 userdom_dontaudit_use_unpriv_user_fds(kadmind_t)
@@ -180,30 +169,26 @@
 # Krb5kdc local policy
 #
 
-# Use capabilities. Surplus capabilities may be allowed.
 allow krb5kdc_t self:capability { setuid setgid net_admin chown fowner dac_override sys_nice };
 dontaudit krb5kdc_t self:capability sys_tty_config;
 allow krb5kdc_t self:process { setfscreate setsched getsched signal_perms };
 allow krb5kdc_t self:netlink_route_socket r_netlink_socket_perms;
-allow krb5kdc_t self:tcp_socket create_stream_socket_perms;
+allow krb5kdc_t self:tcp_socket { accept listen };
 allow krb5kdc_t self:udp_socket create_socket_perms;
 allow krb5kdc_t self:fifo_file rw_fifo_file_perms;
 
 allow krb5kdc_t krb5_conf_t:file read_file_perms;
 dontaudit krb5kdc_t krb5_conf_t:file write;
 
-can_exec(krb5kdc_t, krb5kdc_exec_t)
-
 read_files_pattern(krb5kdc_t, krb5kdc_conf_t, krb5kdc_conf_t)
-dontaudit krb5kdc_t krb5kdc_conf_t:file write;
+dontaudit krb5kdc_t krb5kdc_conf_t:file write_file_perms;
 
-allow krb5kdc_t krb5kdc_lock_t:file { rw_file_perms setattr };
+allow krb5kdc_t krb5kdc_lock_t:file { rw_file_perms setattr_file_perms };
 
-allow krb5kdc_t krb5kdc_log_t:file manage_file_perms;
+allow krb5kdc_t krb5kdc_log_t:file { append_file_perms create_file_perms setattr_file_perms };
 logging_log_filetrans(krb5kdc_t, krb5kdc_log_t, file)
 
-allow krb5kdc_t krb5kdc_principal_t:file read_file_perms;
-dontaudit krb5kdc_t krb5kdc_principal_t:file write;
+allow krb5kdc_t krb5kdc_principal_t:file rw_file_perms;
 
 manage_dirs_pattern(krb5kdc_t, krb5kdc_tmp_t, krb5kdc_tmp_t)
 manage_files_pattern(krb5kdc_t, krb5kdc_tmp_t, krb5kdc_tmp_t)
@@ -212,10 +197,10 @@
 manage_files_pattern(krb5kdc_t, krb5kdc_var_run_t, krb5kdc_var_run_t)
 files_pid_filetrans(krb5kdc_t, krb5kdc_var_run_t, file)
 
+can_exec(krb5kdc_t, krb5kdc_exec_t)
+
 kernel_read_system_state(krb5kdc_t)
 kernel_read_kernel_sysctls(krb5kdc_t)
-kernel_list_proc(krb5kdc_t)
-kernel_read_proc_symlinks(krb5kdc_t)
 kernel_read_network_state(krb5kdc_t)
 kernel_search_network_sysctl(krb5kdc_t)
 
@@ -227,18 +212,20 @@
 corenet_udp_sendrecv_generic_if(krb5kdc_t)
 corenet_tcp_sendrecv_generic_node(krb5kdc_t)
 corenet_udp_sendrecv_generic_node(krb5kdc_t)
-corenet_tcp_sendrecv_all_ports(krb5kdc_t)
-corenet_udp_sendrecv_all_ports(krb5kdc_t)
 corenet_tcp_bind_generic_node(krb5kdc_t)
 corenet_udp_bind_generic_node(krb5kdc_t)
+
+corenet_sendrecv_kerberos_server_packets(krb5kdc_t)
 corenet_tcp_bind_kerberos_port(krb5kdc_t)
 corenet_udp_bind_kerberos_port(krb5kdc_t)
-corenet_tcp_connect_ocsp_port(krb5kdc_t)
-corenet_sendrecv_kerberos_server_packets(krb5kdc_t)
+corenet_tcp_sendrecv_kerberos_port(krb5kdc_t)
+corenet_udp_sendrecv_kerberos_port(krb5kdc_t)
+
 corenet_sendrecv_ocsp_client_packets(krb5kdc_t)
+corenet_tcp_connect_ocsp_port(krb5kdc_t)
+corenet_tcp_sendrecv_ocsp_port(krb5kdc_t)
 
 dev_read_sysfs(krb5kdc_t)
-dev_read_urand(krb5kdc_t)
 
 fs_getattr_all_fs(krb5kdc_t)
 fs_search_auto_mountpoints(krb5kdc_t)
@@ -253,11 +240,11 @@
 
 logging_send_syslog_msg(krb5kdc_t)
 
+miscfiles_read_generic_certs(krb5kdc_t)
 miscfiles_read_localization(krb5kdc_t)
 
 seutil_read_file_contexts(krb5kdc_t)
 
-sysnet_read_config(krb5kdc_t)
 sysnet_use_ldap(krb5kdc_t)
 
 userdom_dontaudit_use_unpriv_user_fds(krb5kdc_t)
@@ -286,10 +273,9 @@
 
 allow kpropd_t self:capability net_bind_service;
 allow kpropd_t self:process setfscreate;
-
-allow kpropd_t self:fifo_file rw_file_perms;
-allow kpropd_t self:unix_stream_socket create_stream_socket_perms;
-allow kpropd_t self:tcp_socket create_stream_socket_perms;
+allow kpropd_t self:fifo_file rw_fifo_file_perms;
+allow kpropd_t self:unix_stream_socket { accept listen };
+allow kpropd_t self:tcp_socket { accept listen };
 
 allow kpropd_t krb5_host_rcache_t:file manage_file_perms;
 
@@ -311,9 +297,11 @@
 corenet_all_recvfrom_unlabeled(kpropd_t)
 corenet_tcp_sendrecv_generic_if(kpropd_t)
 corenet_tcp_sendrecv_generic_node(kpropd_t)
-corenet_tcp_sendrecv_all_ports(kpropd_t)
 corenet_tcp_bind_generic_node(kpropd_t)
+
+corenet_sendrecv_kprop_server_packets(kpropd_t)
 corenet_tcp_bind_kprop_port(kpropd_t)
+corenet_tcp_sendrecv_kprop_port(kpropd_t)
 
 dev_read_urand(kpropd_t)
 
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/kerneloops.if refpolicy/policy/modules/contrib/kerneloops.if
--- refpolicy/policy/modules/contrib/kerneloops.if	2012-05-04 15:16:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/kerneloops.if	2012-10-10 21:34:19.207026205 +0200
@@ -1,4 +1,4 @@
-## <summary>Service for reporting kernel oopses to kerneloops.org</summary>
+## <summary>Service for reporting kernel oopses to kerneloops.org.</summary>
 
 ########################################
 ## <summary>
@@ -12,10 +12,10 @@
 #
 interface(`kerneloops_domtrans',`
 	gen_require(`
-		type kerneloops_t;
-		type kerneloops_exec_t;
+		type kerneloops_t, kerneloops_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, kerneloops_exec_t, kerneloops_t)
 ')
 
@@ -42,8 +42,9 @@
 
 ########################################
 ## <summary>
-##	dontaudit attempts to Send and receive messages from
-##	kerneloops over dbus.
+##	Do not audit attempts to Send and
+##	receive messages from kerneloops
+##	over dbus.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -63,7 +64,8 @@
 
 ########################################
 ## <summary>
-##	Allow domain to manage kerneloops tmp files
+##	Create, read, write, and delete
+##	kerneloops temporary files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -76,14 +78,14 @@
 		type kerneloops_tmp_t;
 	')
 
-	manage_files_pattern($1, kerneloops_tmp_t, kerneloops_tmp_t)
 	files_search_tmp($1)
+	allow $1 kerneloops_tmp_t:file manage_file_perms;
 ')
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate 
-##	an kerneloops environment
+##	All of the rules required to
+##	administrate an kerneloops environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -92,7 +94,7 @@
 ## </param>
 ## <param name="role">
 ##	<summary>
-##	The role to be allowed to manage the kerneloops domain.
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <rolecap/>
@@ -111,5 +113,6 @@
 	role_transition $2 kerneloops_initrc_exec_t system_r;
 	allow $2 system_r;
 
+	files_search_tmp($1)
 	admin_pattern($1, kerneloops_tmp_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/kerneloops.te refpolicy/policy/modules/contrib/kerneloops.te
--- refpolicy/policy/modules/contrib/kerneloops.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/kerneloops.te	2012-10-10 21:34:19.229026205 +0200
@@ -1,4 +1,4 @@
-policy_module(kerneloops, 1.4.0)
+policy_module(kerneloops, 1.4.1)
 
 ########################################
 #
@@ -17,30 +17,28 @@
 
 ########################################
 #
-# kerneloops local policy
+# Local policy
 #
 
 allow kerneloops_t self:capability sys_nice;
 allow kerneloops_t self:process { getcap setcap setsched getsched signal };
-allow kerneloops_t self:fifo_file rw_file_perms;
+allow kerneloops_t self:fifo_file rw_fifo_file_perms;
 
 manage_files_pattern(kerneloops_t, kerneloops_tmp_t, kerneloops_tmp_t)
 files_tmp_filetrans(kerneloops_t, kerneloops_tmp_t, file)
 
 kernel_read_ring_buffer(kerneloops_t)
 
-# Init script handling
 domain_use_interactive_fds(kerneloops_t)
 
 corenet_all_recvfrom_unlabeled(kerneloops_t)
 corenet_all_recvfrom_netlabel(kerneloops_t)
 corenet_tcp_sendrecv_generic_if(kerneloops_t)
 corenet_tcp_sendrecv_generic_node(kerneloops_t)
-corenet_tcp_sendrecv_all_ports(kerneloops_t)
-corenet_tcp_bind_http_port(kerneloops_t)
-corenet_tcp_connect_http_port(kerneloops_t)
 
-files_read_etc_files(kerneloops_t)
+corenet_sendrecv_http_client_packets(kerneloops_t)
+corenet_tcp_connect_http_port(kerneloops_t)
+corenet_tcp_sendrecv_http_port(kerneloops_t)
 
 auth_use_nsswitch(kerneloops_t)
 
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/keyboardd.fc refpolicy/policy/modules/contrib/keyboardd.fc
--- refpolicy/policy/modules/contrib/keyboardd.fc	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/keyboardd.fc	2012-10-10 21:34:25.793026219 +0200
@@ -0,0 +1 @@
+/usr/bin/system-setup-keyboard	--	gen_context(system_u:object_r:keyboardd_exec_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/keyboardd.if refpolicy/policy/modules/contrib/keyboardd.if
--- refpolicy/policy/modules/contrib/keyboardd.if	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/keyboardd.if	2012-10-10 21:47:34.274027902 +0200
@@ -0,0 +1,19 @@
+## <summary>Xorg.conf keyboard layout callout.</summary>
+
+######################################
+## <summary>
+##	Read keyboardd unnamed pipes.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`keyboardd_read_pipes',`
+	gen_require(`
+		type keyboardd_t;
+	')
+
+	allow $1 keyboardd_t:fifo_file read_fifo_file_perms;
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/keyboardd.te refpolicy/policy/modules/contrib/keyboardd.te
--- refpolicy/policy/modules/contrib/keyboardd.te	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/keyboardd.te	2012-10-10 21:47:34.274027902 +0200
@@ -0,0 +1,24 @@
+policy_module(keyboardd, 1.0.1)
+
+########################################
+#
+# Declarations
+#
+
+type keyboardd_t;
+type keyboardd_exec_t;
+init_daemon_domain(keyboardd_t, keyboardd_exec_t)
+
+########################################
+#
+# Local policy
+#
+
+allow keyboardd_t self:fifo_file rw_fifo_file_perms;
+allow keyboardd_t self:unix_stream_socket create_stream_socket_perms;
+
+files_manage_etc_runtime_files(keyboardd_t)
+files_etc_filetrans_etc_runtime(keyboardd_t, file)
+files_read_etc_files(keyboardd_t)
+
+miscfiles_read_localization(keyboardd_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/keystone.fc refpolicy/policy/modules/contrib/keystone.fc
--- refpolicy/policy/modules/contrib/keystone.fc	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/keystone.fc	2012-09-27 20:03:30.718126498 +0200
@@ -0,0 +1,7 @@
+/etc/rc\.d/init\.d/openstack-keystone	--	gen_context(system_u:object_r:keystone_initrc_exec_t,s0)
+
+/usr/bin/keystone-all	--	gen_context(system_u:object_r:keystone_exec_t,s0)
+
+/var/lib/keystone(/.*)?	gen_context(system_u:object_r:keystone_var_lib_t,s0)
+
+/var/log/keystone(/.*)?	gen_context(system_u:object_r:keystone_log_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/keystone.if refpolicy/policy/modules/contrib/keystone.if
--- refpolicy/policy/modules/contrib/keystone.if	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/keystone.if	2012-09-27 20:03:30.719126498 +0200
@@ -0,0 +1,42 @@
+## <summary>Python implementation of the OpenStack identity service API.</summary>
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an keystone environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`keystone_admin',`
+	gen_require(`
+		type keystone_t, keystone_initrc_exec_t, keystone_log_t;
+		type keystone_var_lib_t, keystone_tmp_t;
+	')
+
+	allow $1 keystone_t:process { ptrace signal_perms };
+	ps_process_pattern($1, keystone_t)
+
+	init_labeled_script_domtrans($1, keystone_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 keystone_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	logging_search_logs($1)
+	admin_pattern($1, keystone_log_t)
+
+	files_search_var_lib($1
+	admin_pattern($1, keystone_var_lib_t)
+
+	files_search_tmp($1)
+	admin_pattern($1, keystone_tmp_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/keystone.te refpolicy/policy/modules/contrib/keystone.te
--- refpolicy/policy/modules/contrib/keystone.te	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/keystone.te	2012-09-27 20:03:30.719126498 +0200
@@ -0,0 +1,76 @@
+policy_module(keystone, 1.0.1)
+
+########################################
+#
+# Declarations
+#
+
+type keystone_t;
+type keystone_exec_t;
+init_daemon_domain(keystone_t, keystone_exec_t)
+
+type keystone_initrc_exec_t;
+init_script_file(keystone_initrc_exec_t)
+
+type keystone_log_t;
+logging_log_file(keystone_log_t)
+
+type keystone_var_lib_t;
+files_type(keystone_var_lib_t)
+
+type keystone_tmp_t;
+files_tmp_file(keystone_tmp_t)
+
+########################################
+#
+# Local policy
+#
+
+allow keystone_t self:fifo_file rw_fifo_file_perms;
+allow keystone_t self:unix_stream_socket { accept listen };
+allow keystone_t self:tcp_socket { accept listen };
+
+manage_dirs_pattern(keystone_t, keystone_log_t, keystone_log_t)
+append_files_pattern(keystone_t, keystone_log_t, keystone_log_t)
+create_files_pattern(keystone_t, keystone_log_t, keystone_log_t)
+setattr_files_pattern(keystone_t, keystone_log_t, keystone_log_t)
+logging_log_filetrans(keystone_t, keystone_log_t, dir)
+
+manage_dirs_pattern(keystone_t, keystone_tmp_t, keystone_tmp_t)
+manage_files_pattern(keystone_t, keystone_tmp_t, keystone_tmp_t)
+manage_lnk_files_pattern(keystone_t, keystone_tmp_t, keystone_tmp_t)
+files_tmp_filetrans(keystone_t, keystone_tmp_t, { dir file lnk_file })
+
+manage_dirs_pattern(keystone_t, keystone_var_lib_t, keystone_var_lib_t)
+manage_files_pattern(keystone_t, keystone_var_lib_t, keystone_var_lib_t)
+files_var_lib_filetrans(keystone_t, keystone_var_lib_t, dir)
+
+can_exec(keystone_t, keystone_tmp_t)
+
+kernel_read_system_state(keystone_t)
+
+corecmd_exec_bin(keystone_t)
+corecmd_exec_shell(keystone_t)
+
+corenet_all_recvfrom_unlabeled(keystone_t)
+corenet_all_recvfrom_netlabel(keystone_t)
+corenet_tcp_sendrecv_generic_if(keystone_t)
+corenet_tcp_sendrecv_generic_node(keystone_t)
+corenet_tcp_bind_generic_node(keystone_t)
+
+corenet_sendrecv_commplex_main_server_packets(keystone_t)
+corenet_tcp_bind_commplex_main_port(keystone_t)
+corenet_tcp_sendrecv_commplex_main_port(keystone_t)
+
+files_read_usr_files(keystone_t)
+
+auth_use_pam(keystone_t)
+
+libs_exec_ldconfig(keystone_t)
+
+miscfiles_read_localization(keystone_t)
+
+optional_policy(`
+	mysql_stream_connect(keystone_t)
+	mysql_tcp_connect(keystone_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/kismet.fc refpolicy/policy/modules/contrib/kismet.fc
--- refpolicy/policy/modules/contrib/kismet.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/kismet.fc	2012-10-10 21:34:22.249026212 +0200
@@ -1,6 +1,13 @@
-HOME_DIR/\.kismet(/.*)?			gen_context(system_u:object_r:kismet_home_t,s0)
+HOME_DIR/\.kismet(/.*)?	gen_context(system_u:object_r:kismet_home_t,s0)
 
-/usr/bin/kismet			--	gen_context(system_u:object_r:kismet_exec_t,s0)
-/var/lib/kismet(/.*)?			gen_context(system_u:object_r:kismet_var_lib_t,s0)
-/var/log/kismet(/.*)?			gen_context(system_u:object_r:kismet_log_t,s0)
-/var/run/kismet_server.pid	--	gen_context(system_u:object_r:kismet_var_run_t,s0)
+/etc/rc\.d/init\.d/kismet.*	--	gen_context(system_u:object_r:kismet_initrc_exec_t,s0)
+
+/usr/bin/kismet	--	gen_context(system_u:object_r:kismet_exec_t,s0)
+/usr/bin/kismet_server	--	gen_context(system_u:object_r:kismet_exec_t,s0)
+/usr/bin/kismet_drone	--	gen_context(system_u:object_r:kismet_exec_t,s0)
+
+/var/lib/kismet(/.*)?	gen_context(system_u:object_r:kismet_var_lib_t,s0)
+
+/var/log/kismet(/.*)?	gen_context(system_u:object_r:kismet_log_t,s0)
+
+/var/run/kismet_server\.pid	--	gen_context(system_u:object_r:kismet_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/kismet.if refpolicy/policy/modules/contrib/kismet.if
--- refpolicy/policy/modules/contrib/kismet.if	2012-05-04 15:16:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/kismet.if	2012-10-10 21:34:22.249026212 +0200
@@ -1,4 +1,42 @@
-## <summary>Kismet is an 802.11 layer2 wireless network detector, sniffer, and intrusion detection system.</summary>
+## <summary>IEEE 802.11 wireless LAN sniffer.</summary>
+
+########################################
+## <summary>
+##	Role access for kismet.
+## </summary>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <param name="domain">
+##	<summary>
+##	User domain for the role.
+##	</summary>
+## </param>
+#
+template(`kismet_role',`
+	gen_require(`
+		type kismet_exec_t, kismet_home_t, kismet_tmp_t;
+		type kistmet_tmpfs_t, kismet_t;
+	')
+
+	kismet_run($1, $2)
+
+	allow $2 kistmet_t:process { ptrace signal_perms };
+	ps_process_pattern($2, kismet_t)
+
+	allow $2 kismet_home_t:dir { manage_dir_perms relabel_dir_perms };
+	allow $2 kismet_home_t:file { manage_file_perms relabel_file_perms };
+	userdom_user_home_dir_filetrans($2, kismet_home_t, dir, ".kismet")
+
+	allow $2 kismet_tmp_t:dir { manage_dir_perms relabel_dir_perms };
+	allow $2 kismet_tmp_t:file { manage_file_perms relabel_file_perms };
+	allow $2 kismet_tmp_t:sock_file { manage_sock_file_perms relabel_sock_file_perms };
+
+	allow $2 kismet_tmpfs_t:dir { manage_dir_perms relabel_dir_perms };
+	allow $2 kismet_tmpfs_t:file { manage_file_perms relabel_file_perms };
+')
 
 ########################################
 ## <summary>
@@ -15,8 +53,8 @@
 		type kismet_t, kismet_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, kismet_exec_t, kismet_t)
-	allow kismet_t $1:process signull;
 ')
 
 ########################################
@@ -37,16 +75,16 @@
 #
 interface(`kismet_run',`
 	gen_require(`
-		type kismet_t;
+		attribute_role kismet_roles;
 	')
 
 	kismet_domtrans($1)
-	role $2 types kismet_t;
+	roleattribute $2 kismet_roles;
 ')
 
 ########################################
 ## <summary>
-##	Read kismet PID files.
+##	Read kismet pid files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -59,13 +97,14 @@
 		type kismet_var_run_t;
 	')
 
-	allow $1 kismet_var_run_t:file read_file_perms;
 	files_search_pids($1)
+	allow $1 kismet_var_run_t:file read_file_perms;
 ')
 
 ########################################
 ## <summary>
-##	Manage kismet var_run files.
+##	Create, read, write, and delete
+##	kismet pid files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -78,8 +117,8 @@
 		type kismet_var_run_t;
 	')
 
+	files_search_pids($1)
 	allow $1 kismet_var_run_t:file manage_file_perms;
-	files_search_pids($1)	
 ')
 
 ########################################
@@ -97,8 +136,8 @@
 		type kismet_var_lib_t;
 	')
 
-	allow $1 kismet_var_lib_t:dir search_dir_perms;
 	files_search_var_lib($1)
+	allow $1 kismet_var_lib_t:dir search_dir_perms;
 ')
 
 ########################################
@@ -116,9 +155,9 @@
 		type kismet_var_lib_t;
 	')
 
-	allow $1 kismet_var_lib_t:file read_file_perms;
-	allow $1 kismet_var_lib_t:dir list_dir_perms;
 	files_search_var_lib($1)
+	allow $1 kismet_var_lib_t:dir list_dir_perms;
+	allow $1 kismet_var_lib_t:file read_file_perms;
 ')
 
 ########################################
@@ -137,13 +176,14 @@
 		type kismet_var_lib_t;
 	')
 
-	manage_files_pattern($1, kismet_var_lib_t, kismet_var_lib_t)
 	files_search_var_lib($1)
+	manage_files_pattern($1, kismet_var_lib_t, kismet_var_lib_t)
 ')
 
 ########################################
 ## <summary>
-##	Manage kismet var_lib files.
+##	Create, read, write, and delete
+##	kismet lib content.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -156,6 +196,7 @@
 		type kismet_var_lib_t;
 	')
 
+	files_search_var_lib($1)
 	manage_dirs_pattern($1, kismet_var_lib_t, kismet_var_lib_t)
 	manage_files_pattern($1, kismet_var_lib_t, kismet_var_lib_t)
 	manage_lnk_files_pattern($1, kismet_var_lib_t, kismet_var_lib_t)
@@ -163,7 +204,7 @@
 
 ########################################
 ## <summary>
-##	Allow the specified domain to read kismet's log files.
+##	Read kismet log files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -183,8 +224,7 @@
 
 ########################################
 ## <summary>
-##	Allow the specified domain to append
-##	kismet log files.
+##	Append kismet log files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -203,7 +243,8 @@
 
 ########################################
 ## <summary>
-##	Allow domain to manage kismet log files
+##	Create, read, write, and delete
+##	kismet log content.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -216,32 +257,54 @@
 		type kismet_log_t;
 	')
 
+	logging_search_logs($1)
 	manage_dirs_pattern($1, kismet_log_t, kismet_log_t)
 	manage_files_pattern($1, kismet_log_t, kismet_log_t)
 	manage_lnk_files_pattern($1, kismet_log_t, kismet_log_t)
-	logging_search_logs($1)
 ')
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate an kismet environment
+##	All of the rules required to
+##	administrate an kismet environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
 ##	Domain allowed access.
 ##	</summary>
 ## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
 ## <rolecap/>
 #
 interface(`kismet_admin',`
 	gen_require(`
-		type kismet_t;
+		type kismet_t, kismet_var_lib_t, kismet_var_run_t;
+		type kismet_log_t, kismet_tmp_t;
 	')
 
+	init_labeled_script_domtrans($1, kismet_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 kismet_initrc_exec_t system_r;
+	allow $2 system_r;
+
 	ps_process_pattern($1, kismet_t)
 	allow $1 kismet_t:process { ptrace signal_perms };
 
-	kismet_manage_pid_files($1)
-	kismet_manage_lib($1)
-	kismet_manage_log($1)
+	files_search_var_lib($1)
+	admin_pattern($1, kismet_var_lib_t)
+
+	files_search_pids($1)
+	admin_pattern($1, kismet_var_run_t)
+	
+	logging_search_logs($1)
+	admin_pattern($1, kismet_log_t)
+
+	files_search_tmp($1)
+	admin_pattern($1, kismet_tmp_t)
+
+	kismet_run($1, $2)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/kismet.te refpolicy/policy/modules/contrib/kismet.te
--- refpolicy/policy/modules/contrib/kismet.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/kismet.te	2012-10-10 21:34:22.250026212 +0200
@@ -1,14 +1,19 @@
-policy_module(kismet, 1.6.0)
+policy_module(kismet, 1.6.1)
 
 ########################################
 #
 # Declarations
 #
 
+attribute_role kismet_roles;
+
 type kismet_t;
 type kismet_exec_t;
-application_domain(kismet_t, kismet_exec_t)
-role system_r types kismet_t;
+init_system_domain(kismet_t, kismet_exec_t)
+role kismet_roles types kismet_t;
+
+type kismet_initrc_exec_t;
+init_script_file(kismet_initrc_exec_t)
 
 type kismet_home_t;
 userdom_user_home_content(kismet_home_t)
@@ -30,26 +35,27 @@
 
 ########################################
 #
-# kismet local policy
+# Local policy
 #
 
 allow kismet_t self:capability { dac_override kill net_admin net_raw setuid setgid };
 allow kismet_t self:process signal_perms;
-allow kismet_t self:fifo_file rw_file_perms;
+allow kismet_t self:fifo_file rw_fifo_file_perms;
 allow kismet_t self:packet_socket create_socket_perms;
 allow kismet_t self:unix_dgram_socket { create_socket_perms sendto };
 allow kismet_t self:unix_stream_socket create_stream_socket_perms;
-allow kismet_t self:tcp_socket create_stream_socket_perms;
+allow kismet_t self:tcp_socket { accept listen };
 
 manage_dirs_pattern(kismet_t, kismet_home_t, kismet_home_t)
 manage_files_pattern(kismet_t, kismet_home_t, kismet_home_t)
 manage_lnk_files_pattern(kismet_t, kismet_home_t, kismet_home_t)
-userdom_user_home_dir_filetrans(kismet_t, kismet_home_t, { file dir })
-userdom_search_user_home_dirs(kismet_t)
+userdom_user_home_dir_filetrans(kismet_t, kismet_home_t, dir)
 
-manage_files_pattern(kismet_t, kismet_log_t, kismet_log_t)
-allow kismet_t kismet_log_t:dir setattr;
-logging_log_filetrans(kismet_t, kismet_log_t, { file dir })
+allow kismet_t kismet_log_t:dir setattr_dir_perms;
+append_files_pattern(kismet_t, kismet_log_t, kismet_log_t)
+create_files_pattern(kismet_t, kismet_log_t, kismet_log_t)
+getattr_files_pattern(kismet_t, kismet_log_t, kismet_log_t)
+logging_log_filetrans(kismet_t, kismet_log_t, dir)
 
 manage_dirs_pattern(kismet_t, kismet_tmp_t, kismet_tmp_t)
 manage_files_pattern(kismet_t, kismet_tmp_t, kismet_tmp_t)
@@ -64,9 +70,10 @@
 allow kismet_t kismet_var_lib_t:dir manage_dir_perms;
 files_var_lib_filetrans(kismet_t, kismet_var_lib_t, { file dir })
 
-allow kismet_t kismet_var_run_t:file manage_file_perms;
 allow kismet_t kismet_var_run_t:dir manage_dir_perms;
-files_pid_filetrans(kismet_t, kismet_var_run_t, { file dir })
+files_pid_filetrans(kismet_t, kismet_var_run_t, file)
+
+can_exec(kismet_t, kismet_exec_t)
 
 kernel_search_debugfs(kismet_t)
 kernel_read_system_state(kismet_t)
@@ -78,24 +85,26 @@
 corenet_all_recvfrom_netlabel(kismet_t)
 corenet_tcp_sendrecv_generic_if(kismet_t)
 corenet_tcp_sendrecv_generic_node(kismet_t)
-corenet_tcp_sendrecv_all_ports(kismet_t)
 corenet_tcp_bind_generic_node(kismet_t)
+
+corenet_sendrecv_kismet_server_packets(kismet_t)
 corenet_tcp_bind_kismet_port(kismet_t)
+corenet_sendrecv_kismet_client_packets(kismet_t)
 corenet_tcp_connect_kismet_port(kismet_t)
-corenet_tcp_connect_pulseaudio_port(kismet_t)
+corenet_tcp_sendrecv_kismet_port(kismet_t)
 
 auth_use_nsswitch(kismet_t)
 
-files_read_etc_files(kismet_t)
 files_read_usr_files(kismet_t)
 
 miscfiles_read_localization(kismet_t)
 
 userdom_use_user_terminals(kismet_t)
-userdom_read_user_tmpfs_files(kismet_t)
 
 optional_policy(`
 	dbus_system_bus_client(kismet_t)
 
-	networkmanager_dbus_chat(kismet_t)
+	optional_policy(`
+		networkmanager_dbus_chat(kismet_t)
+	')
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/ksmtuned.fc refpolicy/policy/modules/contrib/ksmtuned.fc
--- refpolicy/policy/modules/contrib/ksmtuned.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/ksmtuned.fc	2012-10-10 21:35:31.158026359 +0200
@@ -1,5 +1,7 @@
 /etc/rc\.d/init\.d/ksmtuned	--	gen_context(system_u:object_r:ksmtuned_initrc_exec_t,s0)
 
-/usr/sbin/ksmtuned		--	gen_context(system_u:object_r:ksmtuned_exec_t,s0)
+/usr/sbin/ksmtuned	--	gen_context(system_u:object_r:ksmtuned_exec_t,s0)
 
-/var/run/ksmtune\.pid		--	gen_context(system_u:object_r:ksmtuned_var_run_t,s0)
+/var/log/ksmtuned.*	gen_context(system_u:object_r:ksmtuned_log_t,s0)
+
+/var/run/ksmtune\.pid	--	gen_context(system_u:object_r:ksmtuned_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/ksmtuned.if refpolicy/policy/modules/contrib/ksmtuned.if
--- refpolicy/policy/modules/contrib/ksmtuned.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/ksmtuned.if	2012-10-10 21:35:31.158026359 +0200
@@ -1,4 +1,4 @@
-## <summary>Kernel Samepage Merging (KSM) Tuning Daemon</summary>
+## <summary>Kernel Samepage Merging Tuning Daemon.</summary>
 
 ########################################
 ## <summary>
@@ -15,12 +15,14 @@
 		type ksmtuned_t, ksmtuned_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, ksmtuned_exec_t, ksmtuned_t)
 ')
 
 ########################################
 ## <summary>
-##	Execute ksmtuned server in the ksmtuned domain.
+##	Execute ksmtuned server in
+##	the ksmtuned domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -38,8 +40,8 @@
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate
-##	an ksmtuned environment
+##	All of the rules required to
+##	administrate an ksmtuned environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -56,19 +58,20 @@
 interface(`ksmtuned_admin',`
 	gen_require(`
 		type ksmtuned_t, ksmtuned_var_run_t;
-		type ksmtuned_initrc_exec_t;
+		type ksmtuned_initrc_exec_t, ksmtuned_log_t;
 	')
 
+	ksmtuned_initrc_domtrans($1)
+	domain_system_change_exemption($1)
+	role_transition $2 ksmtuned_initrc_exec_t system_r;
+	allow $2 system_r;
+
 	allow $1 ksmtuned_t:process { ptrace signal_perms };
 	ps_process_pattern(ksmtumed_t)
 
 	files_list_pids($1)
 	admin_pattern($1, ksmtuned_var_run_t)
 
-	# Allow ksmtuned_t to restart the apache service
-	ksmtuned_initrc_domtrans($1)
-	domain_system_change_exemption($1)
-	role_transition $2 ksmtuned_initrc_exec_t system_r;
-	allow $2 system_r;
-
+	logging_search_logs($1)
+	admin_pattern($1, ksmtuned_log_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/ksmtuned.te refpolicy/policy/modules/contrib/ksmtuned.te
--- refpolicy/policy/modules/contrib/ksmtuned.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/ksmtuned.te	2012-10-10 21:35:31.177026359 +0200
@@ -1,4 +1,4 @@
-policy_module(ksmtuned, 1.0.0)
+policy_module(ksmtuned, 1.0.1)
 
 ########################################
 #
@@ -12,28 +12,44 @@
 type ksmtuned_initrc_exec_t;
 init_script_file(ksmtuned_initrc_exec_t)
 
+type ksmtuned_log_t;
+logging_log_file(ksmtuned_log_t)
+
 type ksmtuned_var_run_t;
 files_pid_file(ksmtuned_var_run_t)
 
 ########################################
 #
-# ksmtuned local policy
+# Local policy
 #
 
 allow ksmtuned_t self:capability { sys_ptrace sys_tty_config };
-allow ksmtuned_t self:fifo_file rw_file_perms;
+allow ksmtuned_t self:fifo_file rw_fifo_file_perms;
+
+manage_dirs_pattern(ksmtuned_t, ksmtuned_log_t, ksmtuned_log_t)
+append_files_pattern(ksmtuned_t, ksmtuned_log_t, ksmtuned_log_t)
+create_files_pattern(ksmtuned_t, ksmtuned_log_t, ksmtuned_log_t)
+setattr_files_pattern(ksmtuned_t, ksmtuned_log_t, ksmtuned_log_t)
+logging_log_filetrans(ksmtuned_t, ksmtuned_log_t, { file dir })
 
 manage_files_pattern(ksmtuned_t, ksmtuned_var_run_t, ksmtuned_var_run_t)
 files_pid_filetrans(ksmtuned_t, ksmtuned_var_run_t, file)
 
 kernel_read_system_state(ksmtuned_t)
 
+corecmd_exec_bin(ksmtuned_t)
+corecmd_exec_shell(ksmtuned_t)
+
 dev_rw_sysfs(ksmtuned_t)
 
 domain_read_all_domains_state(ksmtuned_t)
 
-corecmd_exec_bin(ksmtuned_t)
+mls_file_read_to_clearance(ksmtuned_t)
+
+term_use_all_terms(ksmtuned_t)
+
+auth_use_nsswitch(ksmtuned_t)
 
-files_read_etc_files(ksmtuned_t)
+logging_send_syslog_msg(ksmtuned_t)
 
 miscfiles_read_localization(ksmtuned_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/ktalk.fc refpolicy/policy/modules/contrib/ktalk.fc
--- refpolicy/policy/modules/contrib/ktalk.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/ktalk.fc	2012-10-10 21:35:36.626026370 +0200
@@ -1,7 +1,7 @@
-
-/usr/bin/ktalkd		--	gen_context(system_u:object_r:ktalkd_exec_t,s0)
+/usr/bin/ktalkd	--	gen_context(system_u:object_r:ktalkd_exec_t,s0)
 
 /usr/sbin/in\.talkd	--	gen_context(system_u:object_r:ktalkd_exec_t,s0)
 /usr/sbin/in\.ntalkd	--	gen_context(system_u:object_r:ktalkd_exec_t,s0)
+/usr/sbin/ktalkd	--	gen_context(system_u:object_r:ktalkd_exec_t,s0)
 
 /var/log/talkd.*	--	gen_context(system_u:object_r:ktalkd_log_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/ktalk.if refpolicy/policy/modules/contrib/ktalk.if
--- refpolicy/policy/modules/contrib/ktalk.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/ktalk.if	2012-10-10 21:35:36.626026370 +0200
@@ -1 +1 @@
-## <summary>KDE Talk daemon</summary>
+## <summary>KDE Talk daemon.</summary>
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/ktalk.te refpolicy/policy/modules/contrib/ktalk.te
--- refpolicy/policy/modules/contrib/ktalk.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/ktalk.te	2012-10-10 21:35:36.626026370 +0200
@@ -1,4 +1,4 @@
-policy_module(ktalk, 1.8.0)
+policy_module(ktalk, 1.8.1)
 
 ########################################
 #
@@ -8,7 +8,6 @@
 type ktalkd_t;
 type ktalkd_exec_t;
 inetd_udp_service_domain(ktalkd_t, ktalkd_exec_t)
-role system_r types ktalkd_t;
 
 type ktalkd_log_t;
 logging_log_file(ktalkd_log_t)
@@ -16,9 +15,6 @@
 type ktalkd_tmp_t;
 files_tmp_file(ktalkd_tmp_t)
 
-type ktalkd_var_run_t;
-files_pid_file(ktalkd_var_run_t)
-
 ########################################
 #
 # Local policy
@@ -26,48 +22,23 @@
 
 allow ktalkd_t self:process signal_perms;
 allow ktalkd_t self:fifo_file rw_fifo_file_perms;
-allow ktalkd_t self:tcp_socket connected_stream_socket_perms;
-allow ktalkd_t self:udp_socket create_socket_perms;
-# for identd
-# cjp: this should probably only be inetd_child rules?
-allow ktalkd_t self:netlink_tcpdiag_socket r_netlink_socket_perms;
-allow ktalkd_t self:capability { setuid setgid };
-files_search_home(ktalkd_t)
-optional_policy(`
-	kerberos_use(ktalkd_t)
-')
-#end for identd
+allow ktalkd_t self:tcp_socket { accept listen };
 
-allow ktalkd_t ktalkd_log_t:file manage_file_perms;
+allow ktalkd_t ktalkd_log_t:file { append_file_perms create_file_perms setattr_file_perms };
 logging_log_filetrans(ktalkd_t, ktalkd_log_t, file)
 
 manage_dirs_pattern(ktalkd_t, ktalkd_tmp_t, ktalkd_tmp_t)
 manage_files_pattern(ktalkd_t, ktalkd_tmp_t, ktalkd_tmp_t)
 files_tmp_filetrans(ktalkd_t, ktalkd_tmp_t, { file dir })
 
-manage_files_pattern(ktalkd_t, ktalkd_var_run_t, ktalkd_var_run_t)
-files_pid_filetrans(ktalkd_t, ktalkd_var_run_t, file)
-
 kernel_read_kernel_sysctls(ktalkd_t)
 kernel_read_system_state(ktalkd_t)
 kernel_read_network_state(ktalkd_t)
 
-corenet_all_recvfrom_unlabeled(ktalkd_t)
-corenet_all_recvfrom_netlabel(ktalkd_t)
-corenet_tcp_sendrecv_generic_if(ktalkd_t)
-corenet_udp_sendrecv_generic_if(ktalkd_t)
-corenet_tcp_sendrecv_generic_node(ktalkd_t)
-corenet_udp_sendrecv_generic_node(ktalkd_t)
-corenet_tcp_sendrecv_all_ports(ktalkd_t)
-corenet_udp_sendrecv_all_ports(ktalkd_t)
-
 dev_read_urand(ktalkd_t)
 
 fs_getattr_xattr_fs(ktalkd_t)
 
-files_read_etc_files(ktalkd_t)
-
-term_search_ptys(ktalkd_t)
 term_use_all_terms(ktalkd_t)
 
 auth_use_nsswitch(ktalkd_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/kudzu.fc refpolicy/policy/modules/contrib/kudzu.fc
--- refpolicy/policy/modules/contrib/kudzu.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/kudzu.fc	2012-10-10 21:35:38.700026375 +0200
@@ -1,5 +1,9 @@
+/etc/rc\.d/init\.d/kudzu	--	gen_context(system_u:object_r:kudzu_initrc_exec_t,s0)
 
 /sbin/kmodule	--	gen_context(system_u:object_r:kudzu_exec_t,s0)
 /sbin/kudzu	--	gen_context(system_u:object_r:kudzu_exec_t,s0)
 
+/usr/sbin/kmodule	--	gen_context(system_u:object_r:kudzu_exec_t,s0)
 /usr/sbin/kudzu	--	gen_context(system_u:object_r:kudzu_exec_t,s0)
+
+/var/run/kudzu(/.*)?	gen_context(system_u:object_r:kudzu_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/kudzu.if refpolicy/policy/modules/contrib/kudzu.if
--- refpolicy/policy/modules/contrib/kudzu.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/kudzu.if	2012-10-10 21:35:38.701026375 +0200
@@ -1,4 +1,4 @@
-## <summary>Hardware detection and configuration tools</summary>
+## <summary>Hardware detection and configuration tools.</summary>
 
 ########################################
 ## <summary>
@@ -15,6 +15,7 @@
 		type kudzu_t, kudzu_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, kudzu_exec_t, kudzu_t)
 ')
 
@@ -37,16 +38,16 @@
 #
 interface(`kudzu_run',`
 	gen_require(`
-		type kudzu_t;
+		attribute_role kudzu_roles;
 	')
 
 	kudzu_domtrans($1)
-	role $2 types kudzu_t;
+	roleattribute $2 kudzu_roles;
 ')
 
 ########################################
 ## <summary>
-##	Get attributes of kudzu executable.
+##	Get attributes of kudzu executable files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -54,11 +55,50 @@
 ##	</summary>
 ## </param>
 #
-# cjp: added for ddcprobe
 interface(`kudzu_getattr_exec_files',`
 	gen_require(`
 		type kudzu_exec_t;
 	')
 
-	allow $1 kudzu_exec_t:file getattr;
+	allow $1 kudzu_exec_t:file getattr_file_perms;
+')
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an kudzu environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`kudzu_admin',`
+	gen_require(`
+		type kudzu_t, kudzu_initrc_exec_t, kudzu_var_run_t;
+		type kudzu_tmp_t;
+	')
+
+	allow $1 kudzu_t:process { ptrace signal_perms };
+	ps_process_pattern($1, kudzu_t)
+
+	init_labeled_script_domtrans($1, kudzu_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 kudzu_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	files_search_tmp($1)
+	admin_pattern($1, kudzu_tmp_t)
+
+	files_search_pids($1)
+	admin_pattern($1, kudzu_var_run_t)
+
+	kudzu_run($1, $2)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/kudzu.te refpolicy/policy/modules/contrib/kudzu.te
--- refpolicy/policy/modules/contrib/kudzu.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/kudzu.te	2012-10-10 21:35:38.717026375 +0200
@@ -1,13 +1,19 @@
-policy_module(kudzu, 1.8.0)
+policy_module(kudzu, 1.8.1)
 
 ########################################
 #
 # Declarations
 #
 
+attribute_role kudzu_roles;
+
 type kudzu_t;
 type kudzu_exec_t;
 init_system_domain(kudzu_t, kudzu_exec_t)
+role kudzu_roles types kudzu_t;
+
+type kudzu_initrc_exec_t;
+init_script_file(kudzu_initrc_exec_t)
 
 type kudzu_tmp_t;
 files_tmp_file(kudzu_tmp_t)
@@ -20,12 +26,11 @@
 # Local policy
 #
 
-allow kudzu_t self:capability { dac_override sys_admin sys_ptrace sys_rawio net_admin sys_tty_config mknod };
+allow kudzu_t self:capability { dac_override sys_admin sys_rawio net_admin sys_tty_config mknod };
 dontaudit kudzu_t self:capability sys_tty_config;
 allow kudzu_t self:process { signal_perms execmem };
 allow kudzu_t self:fifo_file rw_fifo_file_perms;
-allow kudzu_t self:unix_stream_socket { connectto create_stream_socket_perms };
-allow kudzu_t self:unix_dgram_socket create_socket_perms;
+allow kudzu_t self:unix_stream_socket { accept connectto listen };
 allow kudzu_t self:udp_socket { create ioctl };
 
 manage_dirs_pattern(kudzu_t, kudzu_tmp_t, kudzu_tmp_t)
@@ -38,16 +43,14 @@
 files_pid_filetrans(kudzu_t, kudzu_var_run_t, file)
 
 kernel_change_ring_buffer_level(kudzu_t)
-kernel_list_proc(kudzu_t)
 kernel_read_device_sysctls(kudzu_t)
 kernel_read_kernel_sysctls(kudzu_t)
-kernel_read_proc_symlinks(kudzu_t)
 kernel_read_network_state(kudzu_t)
 kernel_read_system_state(kudzu_t)
 kernel_rw_hotplug_sysctls(kudzu_t)
 kernel_rw_kernel_sysctl(kudzu_t)
 
-files_read_kernel_modules(kudzu_t)
+corecmd_exec_all_executables(kudzu_t)
 
 dev_list_sysfs(kudzu_t)
 dev_read_usbfs(kudzu_t)
@@ -57,8 +60,20 @@
 dev_rw_mouse(kudzu_t)
 dev_rwx_zero(kudzu_t)
 
+domain_use_interactive_fds(kudzu_t)
+
+files_read_kernel_modules(kudzu_t)
+files_read_usr_files(kudzu_t)
+files_search_locks(kudzu_t)
+files_manage_etc_files(kudzu_t)
+files_manage_etc_runtime_files(kudzu_t)
+files_etc_filetrans_etc_runtime(kudzu_t, file)
+files_manage_mnt_files(kudzu_t)
+files_manage_mnt_symlinks(kudzu_t)
+files_dontaudit_search_src(kudzu_t)
+files_dontaudit_search_isid_type_dirs(kudzu_t)
+
 fs_search_auto_mountpoints(kudzu_t)
-fs_search_ramfs(kudzu_t)
 fs_write_ramfs_sockets(kudzu_t)
 
 mls_file_read_all_levels(kudzu_t)
@@ -72,38 +87,15 @@
 storage_raw_read_removable_device(kudzu_t)
 
 term_dontaudit_use_console(kudzu_t)
-# so it can write messages to the console
 term_use_unallocated_ttys(kudzu_t)
 
-corecmd_exec_all_executables(kudzu_t)
-
-domain_use_interactive_fds(kudzu_t)
-
-files_search_var(kudzu_t)
-files_search_locks(kudzu_t)
-files_manage_etc_files(kudzu_t)
-files_manage_etc_runtime_files(kudzu_t)
-files_etc_filetrans_etc_runtime(kudzu_t, file)
-files_manage_mnt_files(kudzu_t)
-files_manage_mnt_symlinks(kudzu_t)
-files_dontaudit_search_src(kudzu_t)
-# Read /usr/share/hwdata/.* and /usr/share/terminfo/l/linux
-files_read_usr_files(kudzu_t)
-# for /etc/sysconfig/hwconf - probably need a new type
-files_rw_etc_runtime_files(kudzu_t)
-# for file systems that are not yet mounted
-files_dontaudit_search_isid_type_dirs(kudzu_t)
-
 init_use_fds(kudzu_t)
 init_use_script_ptys(kudzu_t)
 init_stream_connect_script(kudzu_t)
 init_read_state(kudzu_t)
 init_ptrace(kudzu_t)
-# kudzu will telinit to make init re-read
-# the inittab after configuring serial consoles
 init_telinit(kudzu_t)
 
-# Read /usr/lib/gconv/gconv-modules.*
 libs_read_lib_files(kudzu_t)
 
 logging_send_syslog_msg(kudzu_t)
@@ -111,12 +103,6 @@
 miscfiles_read_hwdata(kudzu_t)
 miscfiles_read_localization(kudzu_t)
 
-modutils_read_module_config(kudzu_t)
-modutils_read_module_deps(kudzu_t)
-modutils_rename_module_config(kudzu_t)
-modutils_delete_module_config(kudzu_t)
-modutils_domtrans_insmod(kudzu_t)
-
 sysnet_read_config(kudzu_t)
 
 userdom_use_user_terminals(kudzu_t)
@@ -128,6 +114,14 @@
 ')
 
 optional_policy(`
+	modutils_read_module_config(kudzu_t)
+	modutils_read_module_deps(kudzu_t)
+	modutils_rename_module_config(kudzu_t)
+	modutils_delete_module_config(kudzu_t)
+	modutils_domtrans_insmod(kudzu_t)
+')
+
+optional_policy(`
 	nscd_socket_use(kudzu_t)
 ')
 
@@ -141,5 +135,4 @@
 
 optional_policy(`
 	unconfined_domtrans(kudzu_t)
-	unconfined_domain(kudzu_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/l2tp.fc refpolicy/policy/modules/contrib/l2tp.fc
--- refpolicy/policy/modules/contrib/l2tp.fc	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/l2tp.fc	2012-09-27 20:03:30.719126498 +0200
@@ -0,0 +1,11 @@
+/etc/.*l2tp(/.*)?	gen_context(system_u:object_r:l2tp_conf_t,s0)
+
+/etc/rc\.d/init\.d/.*l2tpd	--	gen_context(system_u:object_r:l2tpd_initrc_exec_t,s0)
+
+/etc/sysconfig/.*l2tpd	--	gen_context(system_u:object_r:l2tp_conf_t,s0)
+
+/usr/sbin/.*l2tpd	--	gen_context(system_u:object_r:l2tpd_exec_t,s0)
+
+/var/run/.*l2tpd(/.*)?	gen_context(system_u:object_r:l2tpd_var_run_t,s0)
+/var/run/prol2tpd\.ctl	-s	gen_context(system_u:object_r:l2tpd_var_run_t,s0)
+/var/run/.*l2tpd\.pid	--	gen_context(system_u:object_r:l2tpd_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/l2tp.if refpolicy/policy/modules/contrib/l2tp.if
--- refpolicy/policy/modules/contrib/l2tp.if	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/l2tp.if	2012-10-19 14:38:47.500529194 +0200
@@ -0,0 +1,102 @@
+## <summary>Layer 2 Tunneling Protocol.</summary>
+
+########################################
+## <summary>
+##	Send to l2tpd with a unix
+##	domain dgram socket.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`l2tpd_dgram_send',`
+	gen_require(`
+		type l2tpd_t, l2tpd_tmp_t, l2tpd_var_run_t;
+	')
+
+	files_search_pids($1)
+	files_search_tmp($1)
+	dgram_send_pattern($1, { l2tpd_tmp_t l2tpd_var_run_t }, { l2tpd_tmp_t l2tpd_var_run_t }, l2tpd_t)
+')
+
+########################################
+## <summary>
+##	Read and write l2tpd sockets.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`l2tpd_rw_socket',`
+	gen_require(`
+		type l2tpd_t;
+	')
+
+	allow $1 l2tpd_t:socket rw_socket_perms;
+')
+
+#####################################
+## <summary>
+##	Connect to l2tpd with a unix
+##	domain stream socket.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`l2tpd_stream_connect',`
+	gen_require(`
+		type l2tpd_t, l2tpd_var_run_t, l2tpd_tmp_t;
+	')
+
+	files_search_pids($1)
+	files_search_tmp($1)
+	stream_connect_pattern($1, { l2tpd_tmp_t l2tpd_var_run_t }, { l2tpd_tmp_t l2tpd_var_run_t }, l2tpd_t)
+')
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an l2tp environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`l2tp_admin',`
+	gen_require(`
+		type l2tpd_t, l2tpd_initrc_exec_t, l2tpd_var_run_t;
+		type l2tp_conf_t, l2tpd_tmp_t;
+	')
+
+	allow $1 l2tpd_t:process { ptrace signal_perms };
+	ps_process_pattern($1, l2tpd_t)
+
+	init_labeled_script_domtrans($1, l2tpd_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 l2tpd_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	files_search_etc($1)
+	admin_pattern($1, l2tp_conf_t)
+
+	files_search_pids($1)
+	admin_pattern($1, l2tpd_var_run_t)
+
+	files_search_tmp($1)
+	admin_pattern($1, l2tpd_tmp_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/l2tp.te refpolicy/policy/modules/contrib/l2tp.te
--- refpolicy/policy/modules/contrib/l2tp.te	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/l2tp.te	2012-10-19 14:38:47.500529194 +0200
@@ -0,0 +1,93 @@
+policy_module(l2tp, 1.0.3)
+
+########################################
+#
+# Declarations
+#
+
+type l2tpd_t;
+type l2tpd_exec_t;
+init_daemon_domain(l2tpd_t, l2tpd_exec_t)
+
+type l2tpd_initrc_exec_t;
+init_script_file(l2tpd_initrc_exec_t)
+
+type l2tp_conf_t;
+files_config_file(l2tp_conf_t)
+
+type l2tpd_tmp_t;
+files_tmp_file(l2tpd_tmp_t)
+
+type l2tpd_var_run_t;
+files_pid_file(l2tpd_var_run_t)
+
+########################################
+#
+# Local policy
+#
+
+allow l2tpd_t self:capability { net_admin net_bind_service };
+allow l2tpd_t self:process signal;
+allow l2tpd_t self:fifo_file rw_fifo_file_perms;
+allow l2tpd_t self:netlink_socket create_socket_perms;
+allow l2tpd_t self:rawip_socket create_socket_perms;
+allow l2tpd_t self:socket create_socket_perms;
+allow l2tpd_t self:tcp_socket { accept listen };
+allow l2tpd_t self:unix_dgram_socket sendto;
+allow l2tpd_t self:unix_stream_socket { accept listen };
+
+read_files_pattern(l2tpd_t, l2tp_conf_t, l2tp_conf_t)
+
+manage_dirs_pattern(l2tpd_t, l2tpd_var_run_t, l2tpd_var_run_t)
+manage_files_pattern(l2tpd_t, l2tpd_var_run_t, l2tpd_var_run_t)
+manage_sock_files_pattern(l2tpd_t, l2tpd_var_run_t, l2tpd_var_run_t)
+manage_fifo_files_pattern(l2tpd_t, l2tpd_var_run_t, l2tpd_var_run_t)
+files_pid_filetrans(l2tpd_t, l2tpd_var_run_t, { dir file sock_file })
+
+manage_sock_files_pattern(l2tpd_t, l2tpd_tmp_t, l2tpd_tmp_t)
+files_tmp_filetrans(l2tpd_t, l2tpd_tmp_t, sock_file)
+
+corenet_all_recvfrom_unlabeled(l2tpd_t)
+corenet_all_recvfrom_netlabel(l2tpd_t)
+corenet_raw_sendrecv_generic_if(l2tpd_t)
+corenet_tcp_sendrecv_generic_if(l2tpd_t)
+corenet_udp_sendrecv_generic_if(l2tpd_t)
+corenet_raw_bind_generic_node(l2tpd_t)
+corenet_tcp_bind_generic_node(l2tpd_t)
+corenet_udp_bind_generic_node(l2tpd_t)
+corenet_raw_sendrecv_generic_node(l2tpd_t)
+corenet_tcp_sendrecv_generic_node(l2tpd_t)
+corenet_udp_sendrecv_generic_node(l2tpd_t)
+corenet_tcp_sendrecv_all_ports(l2tpd_t)
+corenet_udp_sendrecv_all_ports(l2tpd_t)
+
+corenet_sendrecv_all_server_packets(l2tpd_t)
+corenet_tcp_bind_all_rpc_ports(l2tpd_t)
+corenet_udp_bind_all_rpc_ports(l2tpd_t)
+
+corenet_udp_bind_l2tp_port(l2tpd_t)
+
+kernel_read_network_state(l2tpd_t)
+kernel_read_system_state(l2tpd_t)
+kernel_request_load_module(l2tpd_t)
+
+corecmd_exec_bin(l2tpd_t)
+
+dev_read_urand(l2tpd_t)
+
+files_read_etc_files(l2tpd_t)
+
+term_use_generic_ptys(l2tpd_t)
+term_use_ptmx(l2tpd_t)
+
+logging_send_syslog_msg(l2tpd_t)
+
+miscfiles_read_localization(l2tpd_t)
+
+sysnet_dns_name_resolve(l2tpd_t)
+
+optional_policy(`
+	ppp_domtrans(l2tpd_t)
+	ppp_signal(l2tpd_t)
+	ppp_kill(l2tpd_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/ldap.fc refpolicy/policy/modules/contrib/ldap.fc
--- refpolicy/policy/modules/contrib/ldap.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/ldap.fc	2012-10-10 21:44:33.117027513 +0200
@@ -1,17 +1,29 @@
-
 /etc/ldap/slapd\.conf	--	gen_context(system_u:object_r:slapd_etc_t,s0)
+/etc/openldap/certs(/.*)?	gen_context(system_u:object_r:slapd_cert_t,s0)
+/etc/openldap/slapd\.d(/.*)?	gen_context(system_u:object_r:slapd_db_t,s0)
+
 /etc/rc\.d/init\.d/ldap	--	gen_context(system_u:object_r:slapd_initrc_exec_t,s0)
 
-/usr/sbin/slapd		--	gen_context(system_u:object_r:slapd_exec_t,s0)
+/usr/sbin/slapd	--	gen_context(system_u:object_r:slapd_exec_t,s0)
 
-ifdef(`distro_debian',`
-/usr/lib/slapd		--	gen_context(system_u:object_r:slapd_exec_t,s0)
-')
+/usr/lib/openldap/slapd	--	gen_context(system_u:object_r:slapd_exec_t,s0)
+/usr/lib/slapd	--	gen_context(system_u:object_r:slapd_exec_t,s0)
 
-/var/lib/ldap(/.*)?		gen_context(system_u:object_r:slapd_db_t,s0)
+/var/lib/ldap(/.*)?	gen_context(system_u:object_r:slapd_db_t,s0)
 /var/lib/ldap/replog(/.*)?	gen_context(system_u:object_r:slapd_replog_t,s0)
 
-/var/run/ldapi		-s	gen_context(system_u:object_r:slapd_var_run_t,s0)
-/var/run/openldap(/.*)?		gen_context(system_u:object_r:slapd_var_run_t,s0)
+/var/lock/subsys/ldap	--	gen_context(system_u:object_r:slapd_lock_t,s0)
+/var/lock/subsys/slapd	--	gen_context(system_u:object_r:slapd_lock_t,s0)
+
+/var/log/ldap.*	gen_context(system_u:object_r:slapd_log_t,s0)
+/var/log/slapd.*	gen_context(system_u:object_r:slapd_log_t,s0)
+
+/var/lib/openldap-data(/.*)?	gen_context(system_u:object_r:slapd_db_t,s0)
+/var/lib/openldap-ldbm(/.*)?	gen_context(system_u:object_r:slapd_db_t,s0)
+/var/lib/openldap-slurpd(/.*)?	gen_context(system_u:object_r:slapd_db_t,s0)
+
+/var/run/ldapi	-s	gen_context(system_u:object_r:slapd_var_run_t,s0)
+/var/run/openldap(/.*)?	gen_context(system_u:object_r:slapd_var_run_t,s0)
+/var/run/slapd.*	-s	gen_context(system_u:object_r:slapd_var_run_t,s0)
 /var/run/slapd\.args	--	gen_context(system_u:object_r:slapd_var_run_t,s0)
 /var/run/slapd\.pid	--	gen_context(system_u:object_r:slapd_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/ldap.if refpolicy/policy/modules/contrib/ldap.if
--- refpolicy/policy/modules/contrib/ldap.if	2012-07-10 14:45:57.000000000 +0200
+++ refpolicy/policy/modules/contrib/ldap.if	2012-11-01 22:00:34.726787359 +0100
@@ -1,9 +1,8 @@
-## <summary>OpenLDAP directory server</summary>
+## <summary>OpenLDAP directory server.</summary>
 
 ########################################
 ## <summary>
-##	Read the contents of the OpenLDAP
-##	database directories.
+##	List ldap database directories.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -16,12 +15,13 @@
 		type slapd_db_t;
 	')
 
+	files_search_etc($1)
 	allow $1 slapd_db_t:dir list_dir_perms;
 ')
 
 ########################################
 ## <summary>
-##	Read the OpenLDAP configuration files.
+##	Read ldap configuration files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -55,7 +55,8 @@
 
 ########################################
 ## <summary>
-##	Connect to slapd over an unix stream socket.
+##	Connect to slapd over an unix
+##	stream socket.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -74,8 +75,29 @@
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate
-##	an ldap environment
+## 	Connect to ldap over the network.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`ldap_tcp_connect',`
+	gen_require(`
+		type slapd_t;
+	')
+
+	corenet_sendrecv_ldap_client_packets($1)
+	corenet_tcp_connect_ldap_port($1)
+	corenet_tcp_recvfrom_labeled($1, slapd_t)
+	corenet_tcp_sendrecv_ldap_port($1)
+')
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an ldap environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -84,7 +106,7 @@
 ## </param>
 ## <param name="role">
 ##	<summary>
-##	The role to be allowed to manage the ldap domain.
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <rolecap/>
@@ -93,7 +115,8 @@
 	gen_require(`
 		type slapd_t, slapd_tmp_t, slapd_replog_t;
 		type slapd_lock_t, slapd_etc_t, slapd_var_run_t;
-		type slapd_initrc_exec_t;
+		type slapd_initrc_exec_t, slapd_log_t, slapd_cert_t;
+		type slapd_db_t;
 	')
 
 	allow $1 slapd_t:process { ptrace signal_perms };
@@ -105,10 +128,15 @@
 	allow $2 system_r;
 
 	files_list_etc($1)
-	admin_pattern($1, slapd_etc_t)
+	admin_pattern($1, { slapd_etc_t slapd_db_t slapd_cert_t })
 
+	files_list_locks($1)
 	admin_pattern($1, slapd_lock_t)
 
+	logging_list_logs($1)
+	admin_pattern($1, slapd_log_t)
+
+	files_search_var_lib($1)
 	admin_pattern($1, slapd_replog_t)
 
 	files_list_tmp($1)
@@ -117,3 +145,29 @@
 	files_list_pids($1)
 	admin_pattern($1, slapd_var_run_t)
 ')
+
+########################################
+## <summary>
+##	Execute slapd in the slapd domain, and
+##	allow the given role the slapd_t type.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed to transition.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+#
+interface(`ldap_run',`
+	gen_require(`
+		type slapd_t;
+		type slapd_exec_t;
+	')
+
+	role $2 types slapd_t;
+	domtrans_pattern($1, slapd_exec_t, slapd_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/ldap.te refpolicy/policy/modules/contrib/ldap.te
--- refpolicy/policy/modules/contrib/ldap.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/ldap.te	2012-11-01 21:56:16.976786809 +0100
@@ -1,4 +1,4 @@
-policy_module(ldap, 1.10.0)
+policy_module(ldap, 1.10.2)
 
 ########################################
 #
@@ -10,7 +10,7 @@
 init_daemon_domain(slapd_t, slapd_exec_t)
 
 type slapd_cert_t;
-files_type(slapd_cert_t)
+miscfiles_cert_type(slapd_cert_t)
 
 type slapd_db_t;
 files_type(slapd_db_t)
@@ -24,12 +24,18 @@
 type slapd_lock_t;
 files_lock_file(slapd_lock_t)
 
+type slapd_log_t;
+logging_log_file(slapd_log_t)
+
 type slapd_replog_t;
 files_type(slapd_replog_t)
 
 type slapd_tmp_t;
 files_tmp_file(slapd_tmp_t)
 
+type slapd_tmpfs_t;
+files_tmpfs_file(slapd_tmpfs_t)
+
 type slapd_var_run_t;
 files_pid_file(slapd_var_run_t)
 
@@ -38,21 +44,16 @@
 # Local policy
 #
 
-# should not need kill
-# cjp: why net_raw?
 allow slapd_t self:capability { kill setgid setuid net_raw dac_override dac_read_search };
 dontaudit slapd_t self:capability sys_tty_config;
 allow slapd_t self:process setsched;
 allow slapd_t self:fifo_file rw_fifo_file_perms;
-allow slapd_t self:udp_socket create_socket_perms;
-#slapd needs to listen and accept needed by ldapsearch (slapd needs to accept from ldapseach)
-allow slapd_t self:tcp_socket create_stream_socket_perms;
+allow slapd_t self:tcp_socket { accept listen };
 
 allow slapd_t slapd_cert_t:dir list_dir_perms;
 read_files_pattern(slapd_t, slapd_cert_t, slapd_cert_t)
 read_lnk_files_pattern(slapd_t, slapd_cert_t, slapd_cert_t)
 
-# Allow access to the slapd databases
 manage_dirs_pattern(slapd_t, slapd_db_t, slapd_db_t)
 manage_files_pattern(slapd_t, slapd_db_t, slapd_db_t)
 manage_lnk_files_pattern(slapd_t, slapd_db_t, slapd_db_t)
@@ -62,7 +63,12 @@
 allow slapd_t slapd_lock_t:file manage_file_perms;
 files_lock_filetrans(slapd_t, slapd_lock_t, file)
 
-# Allow access to write the replication log (should tighten this)
+manage_dirs_pattern(slapd_t, slapd_log_t, slapd_log_t)
+append_files_pattern(slapd_t, slapd_log_t, slapd_log_t)
+create_files_pattern(slapd_t, slapd_log_t, slapd_log_t)
+setattr_files_pattern(slapd_t, slapd_log_t, slapd_log_t)
+logging_log_filetrans(slapd_t, slapd_log_t, { file dir })
+
 manage_dirs_pattern(slapd_t, slapd_replog_t, slapd_replog_t)
 manage_files_pattern(slapd_t, slapd_replog_t, slapd_replog_t)
 manage_lnk_files_pattern(slapd_t, slapd_replog_t, slapd_replog_t)
@@ -71,9 +77,13 @@
 manage_files_pattern(slapd_t, slapd_tmp_t, slapd_tmp_t)
 files_tmp_filetrans(slapd_t, slapd_tmp_t, { file dir })
 
+manage_files_pattern(slapd_t, slapd_tmpfs_t, slapd_tmpfs_t)
+fs_tmpfs_filetrans(slapd_t, slapd_tmpfs_t, file)
+
+manage_dirs_pattern(slapd_t, slapd_var_run_t, slapd_var_run_t)
 manage_files_pattern(slapd_t, slapd_var_run_t, slapd_var_run_t)
 manage_sock_files_pattern(slapd_t, slapd_var_run_t, slapd_var_run_t)
-files_pid_filetrans(slapd_t, slapd_var_run_t, { file sock_file })
+files_pid_filetrans(slapd_t, slapd_var_run_t, { dir file sock_file })
 
 kernel_read_system_state(slapd_t)
 kernel_read_kernel_sysctls(slapd_t)
@@ -81,26 +91,24 @@
 corenet_all_recvfrom_unlabeled(slapd_t)
 corenet_all_recvfrom_netlabel(slapd_t)
 corenet_tcp_sendrecv_generic_if(slapd_t)
-corenet_udp_sendrecv_generic_if(slapd_t)
 corenet_tcp_sendrecv_generic_node(slapd_t)
-corenet_udp_sendrecv_generic_node(slapd_t)
 corenet_tcp_sendrecv_all_ports(slapd_t)
-corenet_udp_sendrecv_all_ports(slapd_t)
 corenet_tcp_bind_generic_node(slapd_t)
-corenet_tcp_bind_ldap_port(slapd_t)
-corenet_tcp_connect_all_ports(slapd_t)
+
 corenet_sendrecv_ldap_server_packets(slapd_t)
+corenet_tcp_bind_ldap_port(slapd_t)
+
 corenet_sendrecv_all_client_packets(slapd_t)
+corenet_tcp_connect_all_ports(slapd_t)
 
 dev_read_urand(slapd_t)
 dev_read_sysfs(slapd_t)
 
+domain_use_interactive_fds(slapd_t)
+
 fs_getattr_all_fs(slapd_t)
 fs_search_auto_mountpoints(slapd_t)
 
-domain_use_interactive_fds(slapd_t)
-
-files_read_etc_files(slapd_t)
 files_read_etc_runtime_files(slapd_t)
 files_read_usr_files(slapd_t)
 files_list_var_lib(slapd_t)
@@ -115,8 +123,19 @@
 userdom_dontaudit_use_unpriv_user_fds(slapd_t)
 userdom_dontaudit_search_user_home_dirs(slapd_t)
 
+ifdef(`distro_gentoo',`
+	allow slapd_t self:process signal;
+	allow slapd_t self:unix_stream_socket listen;
+
+	userdom_use_user_terminals(slapd_t)
+')
+
 optional_policy(`
 	kerberos_keytab_template(slapd, slapd_t)
+	kerberos_manage_host_rcache(slapd_t)
+	kerberos_tmp_filetrans_host_rcache(slapd_t, file, "ldapmap1_0")
+	kerberos_tmp_filetrans_host_rcache(slapd_t, file, "ldap_487")
+	kerberos_tmp_filetrans_host_rcache(slapd_t, file, "ldap_55")
 ')
 
 optional_policy(`
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/lightsquid.fc refpolicy/policy/modules/contrib/lightsquid.fc
--- refpolicy/policy/modules/contrib/lightsquid.fc	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/lightsquid.fc	2012-09-24 21:06:32.840581325 +0200
@@ -0,0 +1,11 @@
+/etc/cron\.daily/lightsquid	--	gen_context(system_u:object_r:lightsquid_exec_t,s0)
+
+/usr/lib/cgi-bin/lightsquid/.*\.cfg	--	gen_context(system_u:object_r:httpd_lightsquid_content_t,s0)
+/usr/lib/cgi-bin/lightsquid/.*\.cgi	--	gen_context(system_u:object_r:httpd_lightsquid_script_exec_t,s0)
+
+/usr/share/lightsquid/cgi/.*\.cgi	--	gen_context(system_u:object_r:httpd_lightsquid_script_exec_t,s0)
+
+/var/lightsquid(/.*)?	gen_context(system_u:object_r:lightsquid_rw_content_t,s0)
+
+/var/www/html/lightsquid(/.*)?	gen_context(system_u:object_r:httpd_lightsquid_content_t,s0)
+/var/www/html/lightsquid/report(/.*)?	gen_context(system_u:object_r:lightsquid_rw_content_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/lightsquid.if refpolicy/policy/modules/contrib/lightsquid.if
--- refpolicy/policy/modules/contrib/lightsquid.if	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/lightsquid.if	2012-09-24 21:06:32.840581325 +0200
@@ -0,0 +1,80 @@
+## <summary>Log analyzer for squid proxy.</summary>
+
+########################################
+## <summary>
+##	Execute the lightsquid program in
+##	the lightsquid domain.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed to transition.
+##	</summary>
+## </param>
+#
+interface(`lightsquid_domtrans',`
+	gen_require(`
+		type lightsquid_t, lightsquid_exec_t;
+	')
+
+	corecmd_search_bin($1)
+	domtrans_pattern($1, lightsquid_exec_t, lightsquid_t)
+')
+
+########################################
+## <summary>
+##	Execute lightsquid in the
+##	lightsquid domain, and allow the
+##	specified role the lightsquid domain.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed to transition.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+#
+interface(`lightsquid_run',`
+	gen_require(`
+		attribute_role lightsquid_roles;
+	')
+
+	lightsquid_domtrans($1)
+	roleattribute $2 lightsquid_roles;
+')
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an lightsquid environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`lightsquid_admin',`
+	gen_require(`
+		type lightsquid_t, lightsquid_rw_content_t;
+	')
+
+	allow $1 lightsquid_t:process { ptrace signal_perms };
+	ps_process_pattern($1, lightsquid_t)
+
+	lightsquid_run($1, $2)
+
+	files_search_var_lib($1)
+	admin_pattern($1, lightsquid_rw_content_t)
+
+	apache_list_sys_content($1)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/lightsquid.te refpolicy/policy/modules/contrib/lightsquid.te
--- refpolicy/policy/modules/contrib/lightsquid.te	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/lightsquid.te	2012-09-24 21:06:32.840581325 +0200
@@ -0,0 +1,52 @@
+policy_module(lightsquid, 1.0.2)
+
+########################################
+#
+# Declarations
+#
+
+attribute_role lightsquid_roles;
+roleattribute system_r lightsquid_roles;
+
+type lightsquid_t;
+type lightsquid_exec_t;
+application_domain(lightsquid_t, lightsquid_exec_t)
+role lightsquid_roles types lightsquid_t;
+
+type lightsquid_rw_content_t;
+files_type(lightsquid_rw_content_t)
+
+########################################
+#
+# Local policy
+#
+
+manage_dirs_pattern(lightsquid_t, lightsquid_rw_content_t, lightsquid_rw_content_t)
+manage_files_pattern(lightsquid_t, lightsquid_rw_content_t, lightsquid_rw_content_t)
+manage_lnk_files_pattern(lightsquid_t, lightsquid_rw_content_t, lightsquid_rw_content_t)
+files_var_filetrans(lightsquid_t, lightsquid_rw_content_t, dir)
+
+corecmd_exec_bin(lightsquid_t)
+corecmd_exec_shell(lightsquid_t)
+
+dev_read_urand(lightsquid_t)
+
+files_read_etc_files(lightsquid_t)
+files_read_usr_files(lightsquid_t)
+
+miscfiles_read_localization(lightsquid_t)
+
+squid_read_config(lightsquid_t)
+squid_read_log(lightsquid_t)
+
+optional_policy(`
+	apache_content_template(lightsquid)
+
+	list_dirs_pattern(httpd_lightsquid_script_t, lightsquid_rw_content_t, lightsquid_rw_content_t)
+	read_files_pattern(httpd_lightsquid_script_t, lightsquid_rw_content_t, lightsquid_rw_content_t)
+	read_lnk_files_pattern(httpd_lightsquid_script_t, lightsquid_rw_content_t, lightsquid_rw_content_t)
+')
+
+optional_policy(`
+	cron_system_entry(lightsquid_t, lightsquid_exec_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/likewise.fc refpolicy/policy/modules/contrib/likewise.fc
--- refpolicy/policy/modules/contrib/likewise.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/likewise.fc	2012-10-10 21:47:23.630027880 +0200
@@ -1,54 +1,100 @@
-/etc/likewise-open(/.*)?			gen_context(system_u:object_r:likewise_etc_t,s0)
-/etc/likewise-open/.pstore.lock		--	gen_context(system_u:object_r:likewise_pstore_lock_t,s0)
-/etc/likewise-open/likewise-krb5-ad.conf --	gen_context(system_u:object_r:likewise_krb5_ad_t,s0)
-
-/etc/rc\.d/init\.d/dcerpcd		--	gen_context(system_u:object_r:likewise_initrc_exec_t,s0)
-/etc/rc\.d/init\.d/eventlogd		--	gen_context(system_u:object_r:likewise_initrc_exec_t,s0)
-/etc/rc\.d/init\.d/lsassd		--	gen_context(system_u:object_r:likewise_initrc_exec_t,s0)
-/etc/rc\.d/init\.d/lwiod		--	gen_context(system_u:object_r:likewise_initrc_exec_t,s0)
-/etc/rc\.d/init\.d/lwregd		--	gen_context(system_u:object_r:likewise_initrc_exec_t,s0)
-/etc/rc\.d/init\.d/lwsmd		--	gen_context(system_u:object_r:likewise_initrc_exec_t,s0)
-/etc/rc\.d/init\.d/netlogond		--	gen_context(system_u:object_r:likewise_initrc_exec_t,s0)
-/etc/rc\.d/init\.d/srvsvcd		--	gen_context(system_u:object_r:likewise_initrc_exec_t,s0)
-
-/usr/sbin/dcerpcd			--	gen_context(system_u:object_r:dcerpcd_exec_t,s0)
-/usr/sbin/eventlogd			--	gen_context(system_u:object_r:eventlogd_exec_t,s0)
-/usr/sbin/lsassd			--	gen_context(system_u:object_r:lsassd_exec_t,s0)
-/usr/sbin/lwiod				--	gen_context(system_u:object_r:lwiod_exec_t,s0)
-/usr/sbin/lwregd			--	gen_context(system_u:object_r:lwregd_exec_t,s0)
-/usr/sbin/lwsmd				--	gen_context(system_u:object_r:lwsmd_exec_t,s0)
-/usr/sbin/netlogond			--	gen_context(system_u:object_r:netlogond_exec_t,s0)
-/usr/sbin/srvsvcd			--	gen_context(system_u:object_r:srvsvcd_exec_t,s0)
-
-/var/lib/likewise-open(/.*)?			gen_context(system_u:object_r:likewise_var_lib_t,s0)
-/var/lib/likewise-open/\.lsassd		-s	gen_context(system_u:object_r:lsassd_var_socket_t,s0)
-/var/lib/likewise-open/\.lwiod		-s	gen_context(system_u:object_r:lwiod_var_socket_t,s0)
-/var/lib/likewise-open/\.regsd		-s	gen_context(system_u:object_r:lwregd_var_socket_t,s0)
-/var/lib/likewise-open/\.lwsm		-s	gen_context(system_u:object_r:lwsmd_var_socket_t,s0)
+/etc/likewise-open(/.*)?	gen_context(system_u:object_r:likewise_etc_t,s0)
+/etc/likewise-open/\.pstore\.lock	--	gen_context(system_u:object_r:likewise_pstore_lock_t,s0)
+/etc/likewise-open/likewise-krb5-ad\.conf	--	gen_context(system_u:object_r:likewise_krb5_ad_t,s0)
+
+/etc/rc\.d/init\.d/dcerpcd	--	gen_context(system_u:object_r:likewise_initrc_exec_t,s0)
+/etc/rc\.d/init\.d/eventlogd	--	gen_context(system_u:object_r:likewise_initrc_exec_t,s0)
+/etc/rc\.d/init\.d/likewise	--	gen_context(system_u:object_r:likewise_initrc_exec_t,s0)
+/etc/rc\.d/init\.d/lsassd	--	gen_context(system_u:object_r:likewise_initrc_exec_t,s0)
+/etc/rc\.d/init\.d/lwiod	--	gen_context(system_u:object_r:likewise_initrc_exec_t,s0)
+/etc/rc\.d/init\.d/lwregd	--	gen_context(system_u:object_r:likewise_initrc_exec_t,s0)
+/etc/rc\.d/init\.d/lwsmd	--	gen_context(system_u:object_r:likewise_initrc_exec_t,s0)
+/etc/rc\.d/init\.d/netlogond	--	gen_context(system_u:object_r:likewise_initrc_exec_t,s0)
+/etc/rc\.d/init\.d/srvsvcd	--	gen_context(system_u:object_r:likewise_initrc_exec_t,s0)
+
+/opt/likewise/sbin/dcerpcd	--	gen_context(system_u:object_r:dcerpcd_exec_t,s0)
+/opt/likewise/sbin/eventlogd	--	gen_context(system_u:object_r:eventlogd_exec_t,s0)
+/opt/likewise/sbin/lsassd	--	gen_context(system_u:object_r:lsassd_exec_t,s0)
+/opt/likewise/sbin/lwiod	--	gen_context(system_u:object_r:lwiod_exec_t,s0)
+/opt/likewise/sbin/lwregd	--	gen_context(system_u:object_r:lwregd_exec_t,s0)
+/opt/likewise/sbin/lwsmd	--	gen_context(system_u:object_r:lwsmd_exec_t,s0)
+/opt/likewise/sbin/netlogond	--	gen_context(system_u:object_r:netlogond_exec_t,s0)
+/opt/likewise/sbin/srvsvcd	--	gen_context(system_u:object_r:srvsvcd_exec_t,s0)
+
+/usr/sbin/dcerpcd	--	gen_context(system_u:object_r:dcerpcd_exec_t,s0)
+/usr/sbin/eventlogd	--	gen_context(system_u:object_r:eventlogd_exec_t,s0)
+/usr/sbin/lsassd	--	gen_context(system_u:object_r:lsassd_exec_t,s0)
+/usr/sbin/lwiod	--	gen_context(system_u:object_r:lwiod_exec_t,s0)
+/usr/sbin/lwregd	--	gen_context(system_u:object_r:lwregd_exec_t,s0)
+/usr/sbin/lwsmd	--	gen_context(system_u:object_r:lwsmd_exec_t,s0)
+/usr/sbin/netlogond	--	gen_context(system_u:object_r:netlogond_exec_t,s0)
+/usr/sbin/srvsvcd	--	gen_context(system_u:object_r:srvsvcd_exec_t,s0)
+
+/var/lib/likewise(/.*)?	gen_context(system_u:object_r:likewise_var_lib_t,s0)
+/var/lib/likewise/\.eventlog	-s	gen_context(system_u:object_r:eventlogd_var_socket_t,s0)
+/var/lib/likewise/\.lsassd	-s	gen_context(system_u:object_r:lsassd_var_socket_t,s0)
+/var/lib/likewise/\.lwiod	-s	gen_context(system_u:object_r:lwiod_var_socket_t,s0)
+/var/lib/likewise/\.regsd	-s	gen_context(system_u:object_r:lwregd_var_socket_t,s0)
+/var/lib/likewise/\.lwsm	-s	gen_context(system_u:object_r:lwsmd_var_socket_t,s0)
+/var/lib/likewise/\.lwsmd-lock	--	gen_context(system_u:object_r:lwsmd_var_lib_t,s0)
+/var/lib/likewise/\.netlogond	-s	gen_context(system_u:object_r:netlogond_var_socket_t,s0)
+/var/lib/likewise/\.ntlmd	-s	gen_context(system_u:object_r:lsassd_var_socket_t,s0)
+/var/lib/likewise/\.pstore\.lock	--	gen_context(system_u:object_r:likewise_pstore_lock_t,s0)
+/var/lib/likewise/krb5-affinity\.conf	--	gen_context(system_u:object_r:netlogond_var_lib_t,s0)
+/var/lib/likewise/krb5cc.*	--	gen_context(system_u:object_r:lsassd_var_lib_t,s0)
+/var/lib/likewise/krb5ccr_lsass	--	gen_context(system_u:object_r:lsassd_var_lib_t, s0)
+/var/lib/likewise/krb5ccr_lsass\..*	--	gen_context(system_u:object_r:lsassd_var_lib_t, s0)
+/var/lib/likewise/LWNetsd\.err	--	gen_context(system_u:object_r:netlogond_var_lib_t,s0)
+/var/lib/likewise/lsasd\.err	--	gen_context(system_u:object_r:lsassd_var_lib_t,s0)
+/var/lib/likewise/regsd\.err	--	gen_context(system_u:object_r:lwregd_var_lib_t,s0)
+/var/lib/likewise/db	-d	gen_context(system_u:object_r:likewise_var_lib_t,s0)
+/var/lib/likewise/db/lwi_events\.db	--	gen_context(system_u:object_r:eventlogd_var_lib_t,s0)
+/var/lib/likewise/db/sam\.db	--	gen_context(system_u:object_r:lsassd_var_lib_t,s0)
+/var/lib/likewise/db/lsass-adcache\.filedb\..*	--	gen_context(system_u:object_r:lsassd_var_lib_t,s0)
+/var/lib/likewise/db/lsass-adcache\.db	--	gen_context(system_u:object_r:lsassd_var_lib_t,s0)
+/var/lib/likewise/db/lsass-adstate\.filedb	--	gen_context(system_u:object_r:lsassd_var_lib_t,s0)
+/var/lib/likewise/db/registry\.db	--	gen_context(system_u:object_r:lwregd_var_lib_t,s0)
+/var/lib/likewise/rpc	-d	gen_context(system_u:object_r:likewise_var_lib_t,s0)
+/var/lib/likewise/rpc/epmapper	-s	gen_context(system_u:object_r:dcerpcd_var_socket_t, s0)
+/var/lib/likewise/rpc/lsass	-s	gen_context(system_u:object_r:lsassd_var_socket_t, s0)
+/var/lib/likewise/rpc/socket	-s	gen_context(system_u:object_r:eventlogd_var_socket_t, s0)
+/var/lib/likewise/run	-d	gen_context(system_u:object_r:likewise_var_lib_t,s0)
+/var/lib/likewise/run/rpcdep\.dat	--	gen_context(system_u:object_r:dcerpcd_var_lib_t, s0)
+
+/var/lib/likewise-open(/.*)?	gen_context(system_u:object_r:likewise_var_lib_t,s0)
+/var/lib/likewise-open/\.eventlog	-s	gen_context(system_u:object_r:eventlogd_var_socket_t,s0)
+/var/lib/likewise-open/\.lsassd	-s	gen_context(system_u:object_r:lsassd_var_socket_t,s0)
+/var/lib/likewise-open/\.lwiod	-s	gen_context(system_u:object_r:lwiod_var_socket_t,s0)
+/var/lib/likewise-open/\.regsd	-s	gen_context(system_u:object_r:lwregd_var_socket_t,s0)
+/var/lib/likewise-open/\.lwsm	-s	gen_context(system_u:object_r:lwsmd_var_socket_t,s0)
+/var/lib/likewise-open/\.lwsmd-lock	--	gen_context(system_u:object_r:lwsmd_var_lib_t,s0)
 /var/lib/likewise-open/\.netlogond	-s	gen_context(system_u:object_r:netlogond_var_socket_t,s0)
-/var/lib/likewise-open/\.ntlmd		-s	gen_context(system_u:object_r:lsassd_var_socket_t,s0)
-/var/lib/likewise-open/krb5-affinity.conf --	gen_context(system_u:object_r:netlogond_var_lib_t, s0)
+/var/lib/likewise-open/\.ntlmd	-s	gen_context(system_u:object_r:lsassd_var_socket_t,s0)
+/var/lib/likewise-open/\.pstore\.lock	--	gen_context(system_u:object_r:likewise_pstore_lock_t,s0)
+/var/lib/likewise-open/krb5-affinity\.conf	--	gen_context(system_u:object_r:netlogond_var_lib_t,s0)
+/var/lib/likewise-open/krb5cc.*	--	gen_context(system_u:object_r:lsassd_var_lib_t,s0)
 /var/lib/likewise-open/krb5ccr_lsass	--	gen_context(system_u:object_r:lsassd_var_lib_t, s0)
+/var/lib/likewise-open/krb5ccr_lsass\..*	--	gen_context(system_u:object_r:lsassd_var_lib_t, s0)
 /var/lib/likewise-open/LWNetsd\.err	--	gen_context(system_u:object_r:netlogond_var_lib_t,s0)
 /var/lib/likewise-open/lsasd\.err	--	gen_context(system_u:object_r:lsassd_var_lib_t,s0)
 /var/lib/likewise-open/regsd\.err	--	gen_context(system_u:object_r:lwregd_var_lib_t,s0)
-/var/lib/likewise-open/db		-d	gen_context(system_u:object_r:likewise_var_lib_t,s0)
-/var/lib/likewise-open/db/lwi_events.db	--	gen_context(system_u:object_r:eventlogd_var_lib_t,s0)
+/var/lib/likewise-open/db	-d	gen_context(system_u:object_r:likewise_var_lib_t,s0)
+/var/lib/likewise-open/db/lwi_events\.db	--	gen_context(system_u:object_r:eventlogd_var_lib_t,s0)
 /var/lib/likewise-open/db/sam\.db	--	gen_context(system_u:object_r:lsassd_var_lib_t,s0)
-/var/lib/likewise-open/db/lsass-adcache\.db --	gen_context(system_u:object_r:lsassd_var_lib_t,s0)
-/var/lib/likewise-open/db/lsass-adstate\.filedb -- gen_context(system_u:object_r:lsassd_var_lib_t,s0)
+/var/lib/likewise-open/db/lsass-adcache\.filedb\..*	--	gen_context(system_u:object_r:lsassd_var_lib_t,s0)
+/var/lib/likewise-open/db/lsass-adcache\.db	--	gen_context(system_u:object_r:lsassd_var_lib_t,s0)
+/var/lib/likewise-open/db/lsass-adstate\.filedb	--	gen_context(system_u:object_r:lsassd_var_lib_t,s0)
 /var/lib/likewise-open/db/registry\.db	--	gen_context(system_u:object_r:lwregd_var_lib_t,s0)
-/var/lib/likewise-open/rpc		-d	gen_context(system_u:object_r:likewise_var_lib_t,s0)
-/var/lib/likewise-open/rpc/epmapper	-s	gen_context(system_u:object_r:dcerpcd_var_socket_t, s0)
+/var/lib/likewise-open/rpc	-d	gen_context(system_u:object_r:likewise_var_lib_t,s0)
+/var/lib/likewise-open/rpc/epmapper	-s	gen_context(system_u:object_r:dcerpcd_var_socket_t,s0)
 /var/lib/likewise-open/rpc/lsass	-s	gen_context(system_u:object_r:lsassd_var_socket_t, s0)
-/var/lib/likewise-open/rpc/socket 	-s	gen_context(system_u:object_r:eventlogd_var_socket_t, s0)
-/var/lib/likewise-open/run		-d	gen_context(system_u:object_r:likewise_var_lib_t,s0)
-/var/lib/likewise-open/run/rpcdep.dat	--	gen_context(system_u:object_r:dcerpcd_var_lib_t, s0)
-
-/var/run/eventlogd.pid			--	gen_context(system_u:object_r:eventlogd_var_run_t,s0)
-/var/run/lsassd.pid			--	gen_context(system_u:object_r:lsassd_var_run_t,s0)
-/var/run/lwiod.pid			--	gen_context(system_u:object_r:lwiod_var_run_t,s0)
-/var/run/lwregd.pid			--	gen_context(system_u:object_r:lwregd_var_run_t,s0)
-/var/run/netlogond.pid			--	gen_context(system_u:object_r:netlogond_var_run_t,s0)
-/var/run/srvsvcd.pid			--	gen_context(system_u:object_r:srvsvcd_var_run_t,s0)
+/var/lib/likewise-open/rpc/socket	-s	gen_context(system_u:object_r:eventlogd_var_socket_t,s0)
+/var/lib/likewise-open/run	-d	gen_context(system_u:object_r:likewise_var_lib_t,s0)
+/var/lib/likewise-open/run/rpcdep\.dat	--	gen_context(system_u:object_r:dcerpcd_var_lib_t,s0)
 
+/var/run/eventlogd\.pid	--	gen_context(system_u:object_r:eventlogd_var_run_t,s0)
+/var/run/lsassd\.pid	--	gen_context(system_u:object_r:lsassd_var_run_t,s0)
+/var/run/lwiod\.pid	--	gen_context(system_u:object_r:lwiod_var_run_t,s0)
+/var/run/lwregd\.pid	--	gen_context(system_u:object_r:lwregd_var_run_t,s0)
+/var/run/netlogond\.pid	--	gen_context(system_u:object_r:netlogond_var_run_t,s0)
+/var/run/srvsvcd\.pid	--	gen_context(system_u:object_r:srvsvcd_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/likewise.if refpolicy/policy/modules/contrib/likewise.if
--- refpolicy/policy/modules/contrib/likewise.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/likewise.if	2012-10-10 21:47:23.630027880 +0200
@@ -1,22 +1,9 @@
 ## <summary>Likewise Active Directory support for UNIX.</summary>
-## <desc>
-##	<p>
-##	Likewise Open is a free, open source application that joins Linux, Unix,
-##	and Mac machines to Microsoft Active Directory to securely authenticate
-##	users with their domain credentials.
-##	</p>
-## </desc>
 
 #######################################
 ## <summary>
 ##	The template to define a likewise domain.
 ## </summary>
-## <desc>
-##	<p>
-##	This template creates a domain to be used for
-##	a new likewise daemon.
-##	</p>
-## </desc>
 ## <param name="userdomain_prefix">
 ##	<summary>
 ##	The type of daemon to be used.
@@ -24,7 +11,6 @@
 ## </param>
 #
 template(`likewise_domain_template',`
-
 	gen_require(`
 		attribute likewise_domains;
 		type likewise_var_lib_t;
@@ -38,7 +24,6 @@
 	type $1_t;
 	type $1_exec_t;
 	init_daemon_domain($1_t, $1_exec_t)
-	domain_use_interactive_fds($1_t)
 
 	typeattribute $1_t likewise_domains;
 
@@ -53,18 +38,15 @@
 
 	####################################
 	#
-	# Local Policy
+	# Policy
 	#
 
 	allow $1_t self:process { signal_perms getsched setsched };
 	allow $1_t self:fifo_file rw_fifo_file_perms;
-	allow $1_t self:unix_dgram_socket create_socket_perms;
-	allow $1_t self:unix_stream_socket create_stream_socket_perms;
+	allow $1_t self:unix_stream_socket { accept listen };
 	allow $1_t self:tcp_socket create_stream_socket_perms;
 	allow $1_t self:udp_socket create_socket_perms;
 
-	allow $1_t likewise_var_lib_t:dir setattr;
-
 	manage_files_pattern($1_t, $1_var_run_t, $1_var_run_t)
 	files_pid_filetrans($1_t, $1_var_run_t, file)
 
@@ -73,21 +55,12 @@
 
 	manage_sock_files_pattern($1_t, likewise_var_lib_t, $1_var_socket_t)
 	filetrans_pattern($1_t, likewise_var_lib_t, $1_var_socket_t, sock_file)
-
-	dev_read_rand($1_t)
-	dev_read_urand($1_t)
-
-	files_read_etc_files($1_t)
-	files_search_var_lib($1_t)
-
-	logging_send_syslog_msg($1_t)
-
-	miscfiles_read_localization($1_t)
 ')
 
 ########################################
 ## <summary>
-##	Connect to lsassd.
+##	Connect to lsassd with a unix domain
+##	stream socket.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -103,3 +76,59 @@
 	files_search_pids($1)
 	stream_connect_pattern($1, likewise_var_lib_t, lsassd_var_socket_t, lsassd_t)
 ')
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an likewise environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`likewise_admin',`
+	gen_require(`
+		attribute likewise_domains;
+		type likewise_initrc_exec_t, likewise_etc_t, likewise_pstore_lock_t;
+		type likewise_krb5_ad_t, likewise_var_lib_t, eventlogd_var_socket_t;
+		type lsassd_var_socket_t, lwiod_var_socket_t, lwregd_var_socket_t;
+		type lwsmd_var_socket_t, lwsmd_var_lib_t, netlogond_var_socket_t;
+		type netlogond_var_lib_t, lsassd_var_lib_t, lwregd_var_lib_t;
+		type eventlogd_var_lib_t, dcerpcd_var_lib_t, lsassd_tmp_t;
+		type eventlogd_var_run_t, lsassd_var_run_t, lwiod_var_run_t;
+		type lwregd_var_run_t, netlogond_var_run_t, srvsvcd_var_run_t;
+	')
+
+	allow $1 likewise_domains:process { ptrace signal_perms };
+	ps_process_pattern($1, likewise_domains)
+
+	init_labeled_script_domtrans($1, likewise_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 likewise_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	files_list_etc($1)
+	admin_pattern($1, { likewise_etc_t likewise_pstore_lock_t likewise_krb5_ad_t })
+
+	files_search_var_lib($1)
+	admin_pattern($1, { likewise_var_lib_t eventlogd_var_socket_t lsassd_var_socket_t })
+	admin_pattern($1, { lwiod_var_socket_t lwregd_var_socket_t lwsmd_var_socket_t })
+	admin_pattern($1, { lwsmd_var_lib_t netlogond_var_socket_t netlogond_var_lib_t })
+	admin_pattern($1, { lsassd_var_lib_t lwregd_var_lib_t eventlogd_var_lib_t })
+	admin_pattern($1, dcerpcd_var_lib_t)
+
+	files_list_tmp($1)
+	admin_pattern($1, lsassd_tmp_t)
+
+	files_list_pids($1)
+	admin_pattern($1, { eventlogd_var_run_t lsassd_var_run_t lwiod_var_run_t })
+	admin_pattern($1, { lwregd_var_run_t netlogond_var_run_t srvsvcd_var_run_t })
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/likewise.te refpolicy/policy/modules/contrib/likewise.te
--- refpolicy/policy/modules/contrib/likewise.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/likewise.te	2012-10-10 21:47:23.631027880 +0200
@@ -1,4 +1,4 @@
-policy_module(likewise, 1.2.0)
+policy_module(likewise, 1.2.1)
 
 #################################
 #
@@ -7,6 +7,15 @@
 
 attribute likewise_domains;
 
+likewise_domain_template(dcerpcd)
+likewise_domain_template(eventlogd)
+likewise_domain_template(lsassd)
+likewise_domain_template(lwiod)
+likewise_domain_template(lwregd)
+likewise_domain_template(lwsmd)
+likewise_domain_template(netlogond)
+likewise_domain_template(srvsvcd)
+
 type likewise_etc_t;
 files_config_file(likewise_etc_t)
 
@@ -22,51 +31,58 @@
 type likewise_krb5_ad_t;
 files_type(likewise_krb5_ad_t)
 
-likewise_domain_template(dcerpcd)
+type lsassd_tmp_t;
+files_tmp_file(lsassd_tmp_t)
 
-likewise_domain_template(eventlogd)
+#################################
+#
+# Common local policy
+#
 
-likewise_domain_template(lsassd)
+allow likewise_domains likewise_var_lib_t:dir setattr_dir_perms;
 
-type lsassd_tmp_t;
-files_tmp_file(lsassd_tmp_t)
+kernel_read_system_state(likewise_domains)
 
-likewise_domain_template(lwiod)
+dev_read_rand(likewise_domains)
+dev_read_urand(likewise_domains)
 
-likewise_domain_template(lwregd)
+domain_use_interactive_fds(likewise_domains)
 
-likewise_domain_template(lwsmd)
+files_read_etc_files(likewise_domains)
+files_search_var_lib(likewise_domains)
 
-likewise_domain_template(netlogond)
+logging_send_syslog_msg(likewise_domains)
 
-likewise_domain_template(srvsvcd)
+miscfiles_read_localization(likewise_domains)
 
 #################################
 #
-# Likewise dcerpcd personal policy
+# dcerpcd local policy
 #
 
 stream_connect_pattern(dcerpcd_t, likewise_var_lib_t, lwregd_var_socket_t, lwregd_t)
 
 corenet_all_recvfrom_netlabel(dcerpcd_t)
 corenet_all_recvfrom_unlabeled(dcerpcd_t)
-corenet_sendrecv_generic_client_packets(dcerpcd_t)
-corenet_sendrecv_generic_server_packets(dcerpcd_t)
 corenet_tcp_sendrecv_generic_if(dcerpcd_t)
 corenet_tcp_sendrecv_generic_node(dcerpcd_t)
 corenet_tcp_sendrecv_generic_port(dcerpcd_t)
 corenet_tcp_bind_generic_node(dcerpcd_t)
-corenet_tcp_bind_epmap_port(dcerpcd_t)
-corenet_tcp_connect_generic_port(dcerpcd_t)
 corenet_udp_bind_generic_node(dcerpcd_t)
-corenet_udp_bind_epmap_port(dcerpcd_t)
 corenet_udp_sendrecv_generic_if(dcerpcd_t)
 corenet_udp_sendrecv_generic_node(dcerpcd_t)
 corenet_udp_sendrecv_generic_port(dcerpcd_t)
 
+corenet_sendrecv_epmap_server_packets(dcerpcd_t)
+corenet_tcp_bind_epmap_port(dcerpcd_t)
+corenet_udp_bind_epmap_port(dcerpcd_t)
+
+corenet_sendrecv_generic_client_packets(dcerpcd_t)
+corenet_tcp_connect_generic_port(dcerpcd_t)
+
 #################################
 #
-# Likewise Auditing and Logging service policy
+# eventlogd local policy
 #
 
 stream_connect_pattern(eventlogd_t, likewise_var_lib_t, dcerpcd_var_socket_t, dcerpcd_t)
@@ -74,19 +90,16 @@
 
 corenet_all_recvfrom_netlabel(eventlogd_t)
 corenet_all_recvfrom_unlabeled(eventlogd_t)
-corenet_sendrecv_generic_server_packets(eventlogd_t)
 corenet_tcp_sendrecv_generic_if(eventlogd_t)
 corenet_tcp_sendrecv_generic_node(eventlogd_t)
-corenet_tcp_sendrecv_generic_port(eventlogd_t)
-corenet_tcp_bind_generic_node(eventlogd_t)
-corenet_udp_bind_generic_node(eventlogd_t)
-corenet_udp_sendrecv_generic_if(eventlogd_t)
-corenet_udp_sendrecv_generic_node(eventlogd_t)
-corenet_udp_sendrecv_generic_port(eventlogd_t)
+
+corenet_sendrecv_epmap_client_packets(eventlogd_t)
+corenet_tcp_connect_epmap_port(eventlogd_t)
+corenet_tcp_sendrecv_epmap_port(eventlogd_t)
 
 #################################
 #
-# Likewise Authentication service local policy
+# lsassd local policy
 #
 
 allow lsassd_t self:capability { fowner chown fsetid dac_override sys_time };
@@ -107,10 +120,7 @@
 stream_connect_pattern(lsassd_t, likewise_var_lib_t, lwregd_var_socket_t, lwregd_t)
 stream_connect_pattern(lsassd_t, likewise_var_lib_t, netlogond_var_socket_t, netlogond_t)
 
-kernel_read_system_state(lsassd_t)
-kernel_getattr_proc_files(lsassd_t)
 kernel_list_all_proc(lsassd_t)
-kernel_list_proc(lsassd_t)
 
 corecmd_exec_bin(lsassd_t)
 corecmd_exec_shell(lsassd_t)
@@ -119,12 +129,13 @@
 corenet_all_recvfrom_unlabeled(lsassd_t)
 corenet_tcp_sendrecv_generic_if(lsassd_t)
 corenet_tcp_sendrecv_generic_node(lsassd_t)
-corenet_tcp_sendrecv_generic_port(lsassd_t)
-corenet_tcp_bind_generic_node(lsassd_t)
+
+corenet_sendrecv_epmap_client_packets(lsassd_t)
 corenet_tcp_connect_epmap_port(lsassd_t)
 corenet_tcp_sendrecv_epmap_port(lsassd_t)
 
 domain_obj_id_change_exemption(lsassd_t)
+domain_dontaudit_search_all_domains_state(lsassd_t)
 
 files_manage_etc_files(lsassd_t)
 files_manage_etc_symlinks(lsassd_t)
@@ -140,7 +151,6 @@
 seutil_run_semanage(lsassd_t, system_r)
 
 sysnet_use_ldap(lsassd_t)
-sysnet_read_config(lsassd_t)
 
 userdom_home_filetrans_user_home_dir(lsassd_t)
 userdom_manage_user_home_content_files(lsassd_t)
@@ -152,28 +162,30 @@
 
 #################################
 #
-# Likewise I/O service local policy
+# lwiod local policy
 #
 
-allow lwiod_t self:capability { fowner chown fsetid dac_override };
+allow lwiod_t self:capability { fowner chown fsetid dac_override sys_resource };
+allow lwiod_t self:process setrlimit;
 allow lwiod_t self:netlink_route_socket rw_netlink_socket_perms;
 
-allow lwiod_t likewise_krb5_ad_t:file read_file_perms;
-allow lwiod_t netlogond_var_lib_t:file read_file_perms;
+allow lwiod_t { likewise_krb5_ad_t netlogond_var_lib_t }:file read_file_perms;
 
 stream_connect_pattern(lwiod_t, likewise_var_lib_t, lwregd_var_socket_t, lwregd_t)
 stream_connect_pattern(lwiod_t, likewise_var_lib_t, lsassd_var_socket_t, lsassd_t)
+stream_connect_pattern(lwiod_t, likewise_var_lib_t, netlogond_var_socket_t, netlogond_t)
 
 corenet_all_recvfrom_netlabel(lwiod_t)
 corenet_all_recvfrom_unlabeled(lwiod_t)
-corenet_sendrecv_smbd_server_packets(lwiod_t)
-corenet_sendrecv_smbd_client_packets(lwiod_t)
 corenet_tcp_sendrecv_generic_if(lwiod_t)
 corenet_tcp_sendrecv_generic_node(lwiod_t)
-corenet_tcp_sendrecv_generic_port(lwiod_t)
 corenet_tcp_bind_generic_node(lwiod_t)
+
+corenet_sendrecv_smbd_server_packets(lwiod_t)
 corenet_tcp_bind_smbd_port(lwiod_t)
+corenet_sendrecv_smbd_client_packets(lwiod_t)
 corenet_tcp_connect_smbd_port(lwiod_t)
+corenet_tcp_sendrecv_smbd_port(lwiod_t)
 
 sysnet_read_config(lwiod_t)
 
@@ -184,11 +196,15 @@
 
 #################################
 #
-# Likewise Service Manager service local policy
+# lwsmd local policy
 #
 
+allow lwsmd_t self:process setpgid;
+
 allow lwsmd_t likewise_domains:process signal;
 
+allow lwsmd_t { likewise_krb5_ad_t netlogond_var_lib_t }:file read_file_perms;
+
 domtrans_pattern(lwsmd_t, dcerpcd_exec_t, dcerpcd_t)
 domtrans_pattern(lwsmd_t, eventlogd_exec_t, eventlogd_t)
 domtrans_pattern(lwsmd_t, lsassd_exec_t, lsassd_t)
@@ -202,10 +218,10 @@
 
 #################################
 #
-# Likewise DC location service local policy
+# netlogond local policy
 #
 
-allow netlogond_t self:capability {dac_override};
+allow netlogond_t self:capability dac_override;
 
 manage_files_pattern(netlogond_t, likewise_etc_t, likewise_etc_t)
 
@@ -216,7 +232,7 @@
 
 #################################
 #
-# Likewise Srv service local policy
+# srvsvcd local policy
 #
 
 allow srvsvcd_t likewise_etc_t:dir search_dir_perms;
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/links.fc refpolicy/policy/modules/contrib/links.fc
--- refpolicy/policy/modules/contrib/links.fc	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/links.fc	2012-05-05 16:11:27.068762613 +0200
@@ -0,0 +1,2 @@
+/usr/bin/links         -- gen_context(system_u:object_r:links_exec_t,s0)
+HOME_DIR/\.links(/.*)?    gen_context(system_u:object_r:links_home_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/links.if refpolicy/policy/modules/contrib/links.if
--- refpolicy/policy/modules/contrib/links.if	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/links.if	2012-05-05 16:11:27.071762613 +0200
@@ -0,0 +1,46 @@
+## <summary>Links web browser</summary>
+
+#######################################
+## <summary>
+##      The role interface for the links module.
+## </summary>
+## <param name="user_role">
+##      <summary>
+##      The role associated with the user domain.
+##      </summary>
+## </param>
+## <param name="user_domain">
+##      <summary>
+##      The type of the user domain.
+##      </summary>
+## </param>
+#
+interface(`links_role',`
+	gen_require(`
+		type links_t, links_exec_t, links_tmpfs_t, links_home_t;
+	')
+
+	#######################################
+	#
+	# Declarations
+	#
+	
+	role $1 types links_t;
+
+	############################
+	#
+	# Policy
+	#
+
+	manage_dirs_pattern($2, links_home_t, links_home_t)
+	manage_files_pattern($2, links_home_t, links_home_t)
+	manage_lnk_files_pattern($2, links_home_t, links_home_t)
+
+	relabel_dirs_pattern($2, links_home_t, links_home_t)
+	relabel_files_pattern($2, links_home_t, links_home_t)
+	relabel_lnk_files_pattern($2, links_home_t, links_home_t)
+
+	domtrans_pattern($2, links_exec_t, links_t)
+
+	ps_process_pattern($2, links_t)
+')	
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/links.te refpolicy/policy/modules/contrib/links.te
--- refpolicy/policy/modules/contrib/links.te	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/links.te	2012-05-05 16:11:27.075762613 +0200
@@ -0,0 +1,67 @@
+policy_module(links, 1.0.0)
+
+############################
+# 
+# Declarations
+#
+
+## <desc>
+## <p>
+## Allow links to manage files in users home directories (download files)
+## </p>
+## </desc>
+gen_tunable(links_manage_user_files, false)
+
+type links_t;
+type links_exec_t;
+userdom_user_application_domain(links_t, links_exec_t)
+
+type links_home_t;
+userdom_user_home_content(links_home_t)
+
+type links_tmpfs_t;
+userdom_user_tmpfs_file(links_tmpfs_t)
+
+############################
+#
+# Policy
+#
+
+allow links_t self:process signal_perms;
+allow links_t self:unix_stream_socket create_stream_socket_perms;
+
+manage_dirs_pattern(links_t, links_home_t, links_home_t)
+manage_files_pattern(links_t, links_home_t, links_home_t)
+manage_lnk_files_pattern(links_t, links_home_t, links_home_t)
+manage_sock_files_pattern(links_t, links_home_t, links_home_t)
+manage_fifo_files_pattern(links_t, links_home_t, links_home_t)
+userdom_user_home_dir_filetrans(links_t, links_home_t, dir)
+
+manage_fifo_files_pattern(links_t, links_t, links_t)
+
+manage_files_pattern(links_t, links_tmpfs_t, links_tmpfs_t)
+manage_lnk_files_pattern(links_t, links_tmpfs_t, links_tmpfs_t)
+manage_fifo_files_pattern(links_t, links_tmpfs_t, links_tmpfs_t)
+manage_sock_files_pattern(links_t, links_tmpfs_t, links_tmpfs_t)
+fs_tmpfs_filetrans(links_t, links_tmpfs_t, { file lnk_file sock_file fifo_file })
+
+
+domain_use_interactive_fds(links_t)
+
+auth_use_nsswitch(links_t)
+
+userdom_use_user_terminals(links_t)
+
+corenet_tcp_connect_http_port(links_t)
+
+miscfiles_read_localization(links_t)
+
+tunable_policy(`links_manage_user_files',`
+	userdom_manage_user_home_content_dirs(links_t)
+	userdom_manage_user_home_content_files(links_t)
+')
+
+
+optional_policy(`
+	xserver_user_x_domain_template(links, links_t, links_tmpfs_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/lircd.fc refpolicy/policy/modules/contrib/lircd.fc
--- refpolicy/policy/modules/contrib/lircd.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/lircd.fc	2012-10-10 21:47:26.955027887 +0200
@@ -1,10 +1,12 @@
-/dev/lircd		-s	gen_context(system_u:object_r:lircd_sock_t,s0)
+/dev/lircd	-s	gen_context(system_u:object_r:lircd_var_run_t,s0)
 
-/etc/rc\.d/init\.d/lirc	--	gen_context(system_u:object_r:lircd_initrc_exec_t,s0)
+/etc/lirc(/.*)?	gen_context(system_u:object_r:lircd_etc_t,s0)
 /etc/lircd\.conf	--	gen_context(system_u:object_r:lircd_etc_t,s0)
 
-/usr/sbin/lircd		--	gen_context(system_u:object_r:lircd_exec_t,s0)
+/etc/rc\.d/init\.d/lirc	--	gen_context(system_u:object_r:lircd_initrc_exec_t,s0)
+
+/usr/sbin/lircd	--	gen_context(system_u:object_r:lircd_exec_t,s0)
 
-/var/run/lirc(/.*)?		gen_context(system_u:object_r:lircd_var_run_t,s0)
-/var/run/lircd(/.*)?		gen_context(system_u:object_r:lircd_var_run_t,s0)
-/var/run/lircd\.pid		gen_context(system_u:object_r:lircd_var_run_t,s0)
+/var/run/lirc(/.*)?	gen_context(system_u:object_r:lircd_var_run_t,s0)
+/var/run/lircd(/.*)?	gen_context(system_u:object_r:lircd_var_run_t,s0)
+/var/run/lircd\.pid	--	gen_context(system_u:object_r:lircd_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/lircd.if refpolicy/policy/modules/contrib/lircd.if
--- refpolicy/policy/modules/contrib/lircd.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/lircd.if	2012-10-10 21:47:26.955027887 +0200
@@ -1,4 +1,4 @@
-## <summary>Linux infared remote control daemon</summary>
+## <summary>Linux infared remote control daemon.</summary>
 
 ########################################
 ## <summary>
@@ -15,8 +15,8 @@
 		type lircd_t, lircd_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domain_auto_trans($1, lircd_exec_t, lircd_t)
-
 ')
 
 ######################################
@@ -41,7 +41,7 @@
 
 #######################################
 ## <summary>
-##	Read lircd etc file
+##	Read lircd etc files.
 ## </summary>
 ## <param name="domain">
 ## <summary>
@@ -54,13 +54,14 @@
 		type lircd_etc_t;
 	')
 
+	files_search_etc($1)
 	read_files_pattern($1, lircd_etc_t, lircd_etc_t)
 ')
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate
-##	a lircd environment
+##	All of the rules required to
+##	administrate a lircd environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -69,7 +70,7 @@
 ## </param>
 ## <param name="role">
 ##	<summary>
-##	The role to be allowed to manage the syslog domain.
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <rolecap/>
@@ -93,4 +94,5 @@
 
 	files_search_pids($1)
 	admin_pattern($1, lircd_var_run_t)
+	dev_list_all_dev_nodes($1)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/lircd.te refpolicy/policy/modules/contrib/lircd.te
--- refpolicy/policy/modules/contrib/lircd.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/lircd.te	2012-10-10 21:47:26.956027887 +0200
@@ -1,4 +1,4 @@
-policy_module(lircd, 1.1.0)
+policy_module(lircd, 1.1.1)
 
 ########################################
 #
@@ -20,37 +20,43 @@
 
 ########################################
 #
-# lircd local policy
+# Local policy
 #
 
 allow lircd_t self:capability { chown kill sys_admin };
+allow lircd_t self:process signal;
 allow lircd_t self:fifo_file rw_fifo_file_perms;
-allow lircd_t self:unix_dgram_socket create_socket_perms;
-allow lircd_t self:tcp_socket create_stream_socket_perms;
+allow lircd_t self:tcp_socket { accept listen };
 
-# etc file
 read_files_pattern(lircd_t, lircd_etc_t, lircd_etc_t)
 
 manage_dirs_pattern(lircd_t, lircd_var_run_t, lircd_var_run_t)
 manage_files_pattern(lircd_t, lircd_var_run_t, lircd_var_run_t)
 manage_sock_files_pattern(lircd_t, lircd_var_run_t, lircd_var_run_t)
 files_pid_filetrans(lircd_t, lircd_var_run_t, { dir file })
-# /dev/lircd socket
+
 dev_filetrans(lircd_t, lircd_var_run_t, sock_file)
 
+corenet_all_recvfrom_unlabeled(lircd_t)
+corenet_all_recvfrom_netlabel(lircd_t)
 corenet_tcp_sendrecv_generic_if(lircd_t)
+corenet_tcp_sendrecv_generic_node(lircd_t)
 corenet_tcp_bind_generic_node(lircd_t)
+
+corenet_sendrecv_lirc_server_packets(lircd_t)
 corenet_tcp_bind_lirc_port(lircd_t)
-corenet_tcp_sendrecv_all_ports(lircd_t)
+corenet_sendrecv_lirc_client_packets(lircd_t)
 corenet_tcp_connect_lirc_port(lircd_t)
+corenet_tcp_sendrecv_lirc_port(lircd_t)
 
-dev_read_generic_usb_dev(lircd_t)
+dev_rw_generic_usb_dev(lircd_t)
 dev_read_mouse(lircd_t)
 dev_filetrans_lirc(lircd_t)
 dev_rw_lirc(lircd_t)
 dev_rw_input_dev(lircd_t)
+dev_read_sysfs(lircd_t)
 
-files_read_etc_files(lircd_t)
+files_read_config_files(lircd_t)
 files_list_var(lircd_t)
 files_manage_generic_locks(lircd_t)
 files_read_all_locks(lircd_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/livecd.if refpolicy/policy/modules/contrib/livecd.if
--- refpolicy/policy/modules/contrib/livecd.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/livecd.if	2012-10-10 21:47:28.925027890 +0200
@@ -1,4 +1,4 @@
-## <summary>Livecd tool for building alternate livecd for different os and policy versions.</summary>
+## <summary>Tool for building alternate livecd for different os and policy versions.</summary>
 
 ########################################
 ## <summary>
@@ -15,13 +15,15 @@
 		type livecd_t, livecd_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, livecd_exec_t, livecd_t)
 ')
 
 ########################################
 ## <summary>
-##	Execute livecd in the livecd domain, and
-##	allow the specified role the livecd domain.
+##	Execute livecd in the livecd
+##	domain, and allow the specified
+##	role the livecd domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -83,7 +85,7 @@
 
 ########################################
 ## <summary>
-##	Allow read and write access to livecd semaphores.
+##	Read and write livecd semaphores.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -96,5 +98,5 @@
 		type livecd_t;
 	')
 
-	allow $1 livecd_t:sem { unix_read unix_write associate read write };
+	allow $1 livecd_t:sem rw_sem_perms;
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/livecd.te refpolicy/policy/modules/contrib/livecd.te
--- refpolicy/policy/modules/contrib/livecd.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/livecd.te	2012-10-10 21:47:28.925027890 +0200
@@ -1,4 +1,4 @@
-policy_module(livecd, 1.2.0)
+policy_module(livecd, 1.2.1)
 
 ########################################
 #
@@ -18,7 +18,7 @@
 
 ########################################
 #
-# livecd local policy
+# Local policy
 #
 
 dontaudit livecd_t self:capability2 mac_admin;
@@ -29,15 +29,20 @@
 manage_files_pattern(livecd_t, livecd_tmp_t, livecd_tmp_t)
 files_tmp_filetrans(livecd_t, livecd_tmp_t, { dir file })
 
+sysnet_manage_config(livecd_t)
+sysnet_etc_filetrans_config(livecd_t)
+
+optional_policy(`
+	hal_dbus_chat(livecd_t)
+')
 optional_policy(`
 	mount_run(livecd_t, livecd_roles)
 ')
 
 optional_policy(`
-	hal_dbus_chat(livecd_t)
+	rpm_domtrans(livecd_t)
 ')
 
 optional_policy(`
-	unconfined_domain(livecd_t)
+	unconfined_domain_noaudit(livecd_t)
 ')
-
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/lldpad.fc refpolicy/policy/modules/contrib/lldpad.fc
--- refpolicy/policy/modules/contrib/lldpad.fc	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/lldpad.fc	2012-09-24 21:21:45.875583272 +0200
@@ -0,0 +1,7 @@
+/etc/rc\.d/init\.d/lldpad	--	gen_context(system_u:object_r:lldpad_initrc_exec_t,s0)
+
+/usr/sbin/lldpad	--	gen_context(system_u:object_r:lldpad_exec_t,s0)
+
+/var/lib/lldpad(/.*)?	gen_context(system_u:object_r:lldpad_var_lib_t,s0)
+
+/var/run/lldpad.*	gen_context(system_u:object_r:lldpad_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/lldpad.if refpolicy/policy/modules/contrib/lldpad.if
--- refpolicy/policy/modules/contrib/lldpad.if	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/lldpad.if	2012-09-24 21:21:45.875583272 +0200
@@ -0,0 +1,58 @@
+## <summary>Intel LLDP Agent.</summary>
+
+#######################################
+## <summary>
+##	Send to lldpad with a unix dgram socket.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`lldpad_dgram_send',`
+	gen_require(`
+		type lldpad_t, lldpad_var_run_t;
+	')
+
+	files_search_pids($1)
+	dgram_send_pattern($1, lldpad_var_run_t, lldpad_var_run_t, lldpad_t)
+')
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an lldpad environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`lldpad_admin',`
+	gen_require(`
+		type lldpad_t, lldpad_initrc_exec_t, lldpad_var_lib_t;
+		type lldpad_var_run_t;
+	')
+
+	allow $1 lldpad_t:process { ptrace signal_perms };
+	ps_process_pattern($1, lldpad_t)
+
+	init_labeled_script_domtrans($1, lldpad_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 lldpad_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	files_search_var_lib($1)
+	admin_pattern($1, lldpad_var_lib_t)
+
+	files_search_pids($1)
+	admin_pattern($1, lldpad_var_run_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/lldpad.te refpolicy/policy/modules/contrib/lldpad.te
--- refpolicy/policy/modules/contrib/lldpad.te	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/lldpad.te	2012-09-24 21:21:45.875583272 +0200
@@ -0,0 +1,62 @@
+policy_module(lldpad, 1.0.1)
+
+########################################
+#
+# Declarations
+#
+
+type lldpad_t;
+type lldpad_exec_t;
+init_daemon_domain(lldpad_t, lldpad_exec_t)
+
+type lldpad_initrc_exec_t;
+init_script_file(lldpad_initrc_exec_t)
+
+type lldpad_tmpfs_t;
+files_tmpfs_file(lldpad_tmpfs_t)
+
+type lldpad_var_lib_t;
+files_type(lldpad_var_lib_t)
+
+type lldpad_var_run_t;
+files_pid_file(lldpad_var_run_t)
+
+########################################
+#
+# Local policy
+#
+
+allow lldpad_t self:capability { net_admin net_raw };
+allow lldpad_t self:shm create_shm_perms;
+allow lldpad_t self:fifo_file rw_fifo_file_perms;
+allow lldpad_t self:unix_stream_socket { accept listen };
+allow lldpad_t self:netlink_route_socket create_netlink_socket_perms;
+allow lldpad_t self:packet_socket create_socket_perms;
+allow lldpad_t self:udp_socket create_socket_perms;
+
+manage_files_pattern(lldpad_t, lldpad_tmpfs_t, lldpad_tmpfs_t)
+fs_tmpfs_filetrans(lldpad_t, lldpad_tmpfs_t, file)
+
+manage_dirs_pattern(lldpad_t, lldpad_var_lib_t, lldpad_var_lib_t)
+manage_files_pattern(lldpad_t, lldpad_var_lib_t, lldpad_var_lib_t)
+
+manage_dirs_pattern(lldpad_t, lldpad_var_run_t, lldpad_var_run_t)
+manage_files_pattern(lldpad_t, lldpad_var_run_t, lldpad_var_run_t)
+manage_sock_files_pattern(lldpad_t, lldpad_var_run_t, lldpad_var_run_t)
+files_pid_filetrans(lldpad_t, lldpad_var_run_t, { dir file sock_file })
+
+kernel_read_all_sysctls(lldpad_t)
+kernel_read_network_state(lldpad_t)
+kernel_request_load_module(lldpad_t)
+
+dev_read_sysfs(lldpad_t)
+
+files_read_etc_files(lldpad_t)
+
+logging_send_syslog_msg(lldpad_t)
+
+miscfiles_read_localization(lldpad_t)
+
+optional_policy(`
+	fcoe_dgram_send_fcoemon(lldpad_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/loadkeys.fc refpolicy/policy/modules/contrib/loadkeys.fc
--- refpolicy/policy/modules/contrib/loadkeys.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/loadkeys.fc	2012-10-10 21:47:34.275027902 +0200
@@ -1,3 +1,5 @@
+/bin/loadkeys	--	gen_context(system_u:object_r:loadkeys_exec_t,s0)
+/bin/unikeys	--	gen_context(system_u:object_r:loadkeys_exec_t,s0)
 
-/bin/loadkeys		--	gen_context(system_u:object_r:loadkeys_exec_t,s0)
-/bin/unikeys		--	gen_context(system_u:object_r:loadkeys_exec_t,s0)
+/usr/bin/loadkeys	--	gen_context(system_u:object_r:loadkeys_exec_t,s0)
+/usr/bin/unikeys	--	gen_context(system_u:object_r:loadkeys_exec_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/loadkeys.if refpolicy/policy/modules/contrib/loadkeys.if
--- refpolicy/policy/modules/contrib/loadkeys.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/loadkeys.if	2012-10-10 21:47:34.275027902 +0200
@@ -2,7 +2,8 @@
 
 ########################################
 ## <summary>
-##	Execute the loadkeys program in the loadkeys domain.
+##	Execute the loadkeys program in
+##	the loadkeys domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -17,15 +18,13 @@
 
 	corecmd_search_bin($1)
 	domtrans_pattern($1, loadkeys_exec_t, loadkeys_t)
-
-	ifdef(`hide_broken_symptoms',`
-		dontaudit loadkeys_t $1:socket_class_set { read write };
-	')
 ')
 
 ########################################
 ## <summary>
-##	Execute the loadkeys program in the loadkeys domain.
+##	Execute the loadkeys program in
+##	the loadkeys domain, and allow the
+##	specified role the loadkeys domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -34,23 +33,23 @@
 ## </param>
 ## <param name="role">
 ##	<summary>
-##	The role to allow the loadkeys domain.
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <rolecap/>
 #
 interface(`loadkeys_run',`
 	gen_require(`
-		type loadkeys_t;
+		attribute_role loadkeys_roles;
 	')
 
 	loadkeys_domtrans($1)
-	role $2 types loadkeys_t;
+	roleattribute $2 loadkeys_roles;
 ')
 
 ########################################
 ## <summary>
-##	Execute the loadkeys program in the caller domain.
+##	Execute the loadkeys in the caller domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -63,5 +62,6 @@
 		type loadkeys_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	can_exec($1, loadkeys_exec_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/loadkeys.te refpolicy/policy/modules/contrib/loadkeys.te
--- refpolicy/policy/modules/contrib/loadkeys.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/loadkeys.te	2012-10-10 21:47:34.287027902 +0200
@@ -1,16 +1,16 @@
-policy_module(loadkeys, 1.8.0)
+policy_module(loadkeys, 1.8.1)
 
 ########################################
 #
 # Declarations
 #
 
-# cjp: this should probably be rewritten
-# per user domain, since it can rw
-# all user domain ttys
+attribute_role loadkeys_roles;
+
 type loadkeys_t;
 type loadkeys_exec_t;
 init_system_domain(loadkeys_t, loadkeys_exec_t)
+role loadkeys_roles types loadkeys_t;
 
 ########################################
 #
@@ -46,5 +46,9 @@
 ')
 
 optional_policy(`
+	keyboardd_read_pipes(loadkeys_t)
+')
+
+optional_policy(`
 	nscd_dontaudit_search_pid(loadkeys_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/lockdev.fc refpolicy/policy/modules/contrib/lockdev.fc
--- refpolicy/policy/modules/contrib/lockdev.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/lockdev.fc	2012-10-10 21:47:38.923027911 +0200
@@ -1,2 +1,3 @@
-
 /usr/sbin/lockdev	--	gen_context(system_u:object_r:lockdev_exec_t,s0)
+
+/var/lock/lockdev(/.*)?	gen_context(system_u:object_r:lockdev_lock_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/lockdev.if refpolicy/policy/modules/contrib/lockdev.if
--- refpolicy/policy/modules/contrib/lockdev.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/lockdev.if	2012-10-10 21:47:38.924027911 +0200
@@ -1,33 +1,42 @@
-## <summary>device locking policy for lockdev</summary>
+## <summary>Library for locking devices.</summary>
 
 ########################################
 ## <summary>
-##	Role access for lockdev
+##	Role access for lockdev.
 ## </summary>
 ## <param name="role">
 ##	<summary>
-##	Role allowed access
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <param name="domain">
 ##	<summary>
-##	User domain for the role
+##	User domain for the role.
 ##	</summary>
 ## </param>
 #
 interface(`lockdev_role',`
 	gen_require(`
+		attribute_role lockdev_roles;
 		type lockdev_t, lockdev_exec_t;
-		type lockdev_lock_t;
 	')
 
-	role $1 types lockdev_t;
+	########################################
+	#
+	# Declarations
+	#
+
+	roleattribute $1 lockdev_roles;
+
+	########################################
+	#
+	# Policy
+	#
 
-	# Transition from the user domain to the derived domain.
 	domtrans_pattern($2, lockdev_exec_t, lockdev_t)
-	allow lockdev_t $2:process signull;
 
-	# allow ps to show lockdev
+	allow $2 lockdev_t:process { ptrace signal_perms };
 	ps_process_pattern($2, lockdev_t)
-	allow $2 lockdev_t:process signal;
+
+	allow lockdev_t $2:process signull;
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/lockdev.te refpolicy/policy/modules/contrib/lockdev.te
--- refpolicy/policy/modules/contrib/lockdev.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/lockdev.te	2012-10-10 21:47:38.924027911 +0200
@@ -1,15 +1,18 @@
-policy_module(lockdev, 1.4.0)
+policy_module(lockdev, 1.4.1)
 
 ########################################
 #
 # Declarations
 #
 
+attribute_role lockdev_roles;
+
 type lockdev_t;
 type lockdev_exec_t;
 typealias lockdev_t alias { user_lockdev_t staff_lockdev_t sysadm_lockdev_t };
 typealias lockdev_t alias { auditadm_lockdev_t secadm_lockdev_t };
 userdom_user_application_domain(lockdev_t, lockdev_exec_t)
+role lockdev_roles types lockdev_t;
 
 type lockdev_lock_t;
 typealias lockdev_lock_t alias { user_lockdev_lock_t staff_lockdev_lock_t sysadm_lockdev_lock_t };
@@ -22,10 +25,9 @@
 # Local policy
 #
 
-# Use capabilities.
 allow lockdev_t self:capability setgid;
 
-allow lockdev_t lockdev_lock_t:file manage_file_perms;
+manage_files_pattern(lockdev_t, lockdev_lock_t, lockdev_lock_t)
 files_lock_filetrans(lockdev_t, lockdev_lock_t, file)
 
 files_read_all_locks(lockdev_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/logrotate.fc refpolicy/policy/modules/contrib/logrotate.fc
--- refpolicy/policy/modules/contrib/logrotate.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/logrotate.fc	2012-10-10 21:47:43.814027915 +0200
@@ -1,9 +1,6 @@
-/etc/cron\.(daily|weekly)/sysklogd -- gen_context(system_u:object_r:logrotate_exec_t,s0)
+/etc/cron\.(daily|weekly)/sysklogd	--	gen_context(system_u:object_r:logrotate_exec_t,s0)
 
 /usr/sbin/logrotate	--	gen_context(system_u:object_r:logrotate_exec_t,s0)
 
-ifdef(`distro_debian', `
 /var/lib/logrotate(/.*)?	gen_context(system_u:object_r:logrotate_var_lib_t,s0)
-', `
-/var/lib/logrotate\.status --	gen_context(system_u:object_r:logrotate_var_lib_t,s0)
-')
+/var/lib/logrotate\.status	--	gen_context(system_u:object_r:logrotate_var_lib_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/logrotate.if refpolicy/policy/modules/contrib/logrotate.if
--- refpolicy/policy/modules/contrib/logrotate.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/logrotate.if	2012-10-10 21:47:43.814027915 +0200
@@ -1,4 +1,4 @@
-## <summary>Rotate and archive system logs</summary>
+## <summary>Rotates, compresses, removes and mails system log files.</summary>
 
 ########################################
 ## <summary>
@@ -21,8 +21,9 @@
 
 ########################################
 ## <summary>
-##	Execute logrotate in the logrotate domain, and
-##	allow the specified role the logrotate domain.
+##	Execute logrotate in the logrotate
+##	domain, and allow the specified
+##	role the logrotate domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -38,11 +39,11 @@
 #
 interface(`logrotate_run',`
 	gen_require(`
-		type logrotate_t;
+		attribute_role logrotate_roles;
 	')
 
 	logrotate_domtrans($1)
-	role $2 types logrotate_t;
+	roleattribute $2 logrotate_roles;
 ')
 
 ########################################
@@ -84,7 +85,8 @@
 
 ########################################
 ## <summary>
-##	Do not audit attempts to inherit logrotate file descriptors.
+##	Do not audit attempts to inherit
+##	logrotate file descriptors.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -102,7 +104,7 @@
 
 ########################################
 ## <summary>
-##	Read a logrotate temporary files.
+##	Read logrotate temporary files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/logrotate.te refpolicy/policy/modules/contrib/logrotate.te
--- refpolicy/policy/modules/contrib/logrotate.te	2012-05-04 15:16:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/logrotate.te	2012-11-06 21:18:18.197011531 +0100
@@ -1,18 +1,20 @@
-policy_module(logrotate, 1.14.0)
+policy_module(logrotate, 1.14.5)
 
 ########################################
 #
 # Declarations
 #
 
+attribute_role logrotate_roles;
+roleattribute system_r logrotate_roles;
+
 type logrotate_t;
+type logrotate_exec_t;
 domain_type(logrotate_t)
 domain_obj_id_change_exemption(logrotate_t)
 domain_system_change_exemption(logrotate_t)
-role system_r types logrotate_t;
-
-type logrotate_exec_t;
 domain_entry_file(logrotate_t, logrotate_exec_t)
+role logrotate_roles types logrotate_t;
 
 type logrotate_lock_t;
 files_lock_file(logrotate_lock_t)
@@ -23,27 +25,21 @@
 type logrotate_var_lib_t;
 files_type(logrotate_var_lib_t)
 
+mta_base_mail_template(logrotate)
+role system_r types logrotate_mail_t;
+
 ########################################
 #
 # Local policy
 #
 
-# Change ownership on log files.
-allow logrotate_t self:capability { chown dac_override dac_read_search kill fsetid fowner sys_resource sys_nice };
-# for mailx
-dontaudit logrotate_t self:capability { setuid setgid sys_ptrace };
-
-allow logrotate_t self:process ~{ ptrace setcurrent setexec setfscreate setrlimit execmem execstack execheap };
-
-# Set a context other than the default one for newly created files.
-allow logrotate_t self:process setfscreate;
-
+allow logrotate_t self:capability { chown dac_override dac_read_search kill fsetid fowner setuid setgid sys_resource sys_nice };
+allow logrotate_t self:process ~{ ptrace setcurrent setexec setrlimit execmem execstack execheap };
 allow logrotate_t self:fd use;
+allow logrotate_t self:key manage_key_perms;
 allow logrotate_t self:fifo_file rw_fifo_file_perms;
-allow logrotate_t self:unix_dgram_socket create_socket_perms;
-allow logrotate_t self:unix_stream_socket create_stream_socket_perms;
 allow logrotate_t self:unix_dgram_socket sendto;
-allow logrotate_t self:unix_stream_socket connectto;
+allow logrotate_t self:unix_stream_socket { accept connectto listen };
 allow logrotate_t self:shm create_shm_perms;
 allow logrotate_t self:sem create_sem_perms;
 allow logrotate_t self:msgq create_msgq_perms;
@@ -52,64 +48,61 @@
 allow logrotate_t logrotate_lock_t:file manage_file_perms;
 files_lock_filetrans(logrotate_t, logrotate_lock_t, file)
 
-can_exec(logrotate_t, logrotate_tmp_t)
-
 manage_dirs_pattern(logrotate_t, logrotate_tmp_t, logrotate_tmp_t)
 manage_files_pattern(logrotate_t, logrotate_tmp_t, logrotate_tmp_t)
 files_tmp_filetrans(logrotate_t, logrotate_tmp_t, { file dir })
 
-# for /var/lib/logrotate.status and /var/lib/logcheck
 create_dirs_pattern(logrotate_t, logrotate_var_lib_t, logrotate_var_lib_t)
 manage_files_pattern(logrotate_t, logrotate_var_lib_t, logrotate_var_lib_t)
+read_lnk_files_pattern(logrotate_t, logrotate_var_lib_t, logrotate_var_lib_t)
 files_var_lib_filetrans(logrotate_t, logrotate_var_lib_t, file)
 
+can_exec(logrotate_t, logrotate_tmp_t)
+
 kernel_read_system_state(logrotate_t)
 kernel_read_kernel_sysctls(logrotate_t)
 
-dev_read_urand(logrotate_t)
-
-fs_search_auto_mountpoints(logrotate_t)
-fs_getattr_xattr_fs(logrotate_t)
-fs_list_inotifyfs(logrotate_t)
-
-mls_file_read_all_levels(logrotate_t)
-mls_file_write_all_levels(logrotate_t)
-mls_file_upgrade(logrotate_t)
-
-selinux_get_fs_mount(logrotate_t)
-selinux_get_enforce_mode(logrotate_t)
-
-auth_manage_login_records(logrotate_t)
-auth_use_nsswitch(logrotate_t)
-
-# Run helper programs.
 corecmd_exec_bin(logrotate_t)
 corecmd_exec_shell(logrotate_t)
+corecmd_getattr_all_executables(logrotate_t)
+
+dev_read_urand(logrotate_t)
 
 domain_signal_all_domains(logrotate_t)
 domain_use_interactive_fds(logrotate_t)
 domain_getattr_all_entry_files(logrotate_t)
-# Read /proc/PID directories for all domains.
 domain_read_all_domains_state(logrotate_t)
 
 files_read_usr_files(logrotate_t)
-files_read_etc_files(logrotate_t)
 files_read_etc_runtime_files(logrotate_t)
 files_read_all_pids(logrotate_t)
 files_search_all(logrotate_t)
 files_read_var_lib_files(logrotate_t)
-# Write to /var/spool/slrnpull - should be moved into its own type.
 files_manage_generic_spool(logrotate_t)
 files_manage_generic_spool_dirs(logrotate_t)
 files_getattr_generic_locks(logrotate_t)
+files_dontaudit_list_mnt(logrotate_t)
+
+fs_search_auto_mountpoints(logrotate_t)
+fs_getattr_xattr_fs(logrotate_t)
+fs_list_inotifyfs(logrotate_t)
+
+mls_file_read_all_levels(logrotate_t)
+mls_file_write_all_levels(logrotate_t)
+mls_file_upgrade(logrotate_t)
+mls_process_write_to_clearance(logrotate_t)
+
+selinux_get_fs_mount(logrotate_t)
+selinux_get_enforce_mode(logrotate_t)
+
+auth_manage_login_records(logrotate_t)
+auth_use_nsswitch(logrotate_t)
 
-# cjp: why is this needed?
 init_domtrans_script(logrotate_t)
 
 logging_manage_all_logs(logrotate_t)
 logging_send_syslog_msg(logrotate_t)
 logging_send_audit_msgs(logrotate_t)
-# cjp: why is this needed?
 logging_exec_all_logs(logrotate_t)
 
 miscfiles_read_localization(logrotate_t)
@@ -120,25 +113,18 @@
 userdom_list_user_home_dirs(logrotate_t)
 userdom_use_unpriv_users_fds(logrotate_t)
 
-cron_system_entry(logrotate_t, logrotate_exec_t)
-cron_search_spool(logrotate_t)
+mta_sendmail_domtrans(logrotate_t, logrotate_mail_t)
 
-mta_send_mail(logrotate_t)
-
-ifdef(`distro_debian', `
-	allow logrotate_t logrotate_tmp_t:file { relabelfrom relabelto };
-	# for savelog
+ifdef(`distro_debian',`
+	allow logrotate_t logrotate_tmp_t:file relabel_file_perms;
 	can_exec(logrotate_t, logrotate_exec_t)
 
-	# for syslogd-listfiles
-	logging_read_syslog_config(logrotate_t)
-
-	# for "test -x /sbin/syslogd"
 	logging_check_exec_syslog(logrotate_t)
+	logging_read_syslog_config(logrotate_t)
 ')
 
 optional_policy(`
-	abrt_cache_manage(logrotate_t)
+	abrt_manage_cache(logrotate_t)
 ')
 
 optional_policy(`
@@ -158,14 +144,28 @@
 ')
 
 optional_policy(`
+	awstats_domtrans(logrotate_t)
+')
+
+optional_policy(`
 	bind_manage_cache(logrotate_t)
 ')
 
 optional_policy(`
+	callweaver_exec(logrotate_t)
+	callweaver_stream_connect(logrotate_t)
+')
+
+optional_policy(`
 	consoletype_exec(logrotate_t)
 ')
 
 optional_policy(`
+	cron_system_entry(logrotate_t, logrotate_exec_t)
+	cron_search_spool(logrotate_t)
+')
+
+optional_policy(`
 	cups_domtrans(logrotate_t)
 ')
 
@@ -178,6 +178,10 @@
 ')
 
 optional_policy(`
+	chronyd_read_key_files(logrotate_t)
+')
+
+optional_policy(`
 	icecast_signal(logrotate_t)
 ')
 
@@ -195,14 +199,21 @@
 
 optional_policy(`
 	mysql_read_config(logrotate_t)
-	mysql_search_db(logrotate_t)
 	mysql_stream_connect(logrotate_t)
 ')
 
 optional_policy(`
-	psad_domtrans(logrotate_t)
+	openvswitch_read_pid_files(logrotate_t)
+	openvswitch_domtrans(logrotate_t)
+')
+
+optional_policy(`
+	polipo_log_filetrans_log(logrotate_t, file, "polipo")
 ')
 
+optional_policy(`
+	psad_domtrans(logrotate_t)
+')
 
 optional_policy(`
 	samba_exec_log(logrotate_t)
@@ -221,10 +232,22 @@
 ')
 
 optional_policy(`
-	#Red Hat bug 564565
 	su_exec(logrotate_t)
 ')
 
 optional_policy(`
 	varnishd_manage_log(logrotate_t)
 ')
+
+#######################################
+#
+# Mail local policy
+#
+
+allow logrotate_mail_t logrotate_t:fd use;
+allow logrotate_mail_t logrotate_t:fifo_file rw_fifo_file_perms;
+allow logrotate_mail_t logrotate_t:process sigchld;
+
+manage_files_pattern(logrotate_mail_t, logrotate_tmp_t, logrotate_tmp_t)
+
+logging_read_all_logs(logrotate_mail_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/logwatch.fc refpolicy/policy/modules/contrib/logwatch.fc
--- refpolicy/policy/modules/contrib/logwatch.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/logwatch.fc	2012-10-19 14:38:55.056529211 +0200
@@ -1,7 +1,14 @@
+/usr/sbin/epylog	--	gen_context(system_u:object_r:logwatch_exec_t,s0)
 /usr/sbin/logcheck	--	gen_context(system_u:object_r:logwatch_exec_t,s0)
+/usr/sbin/logwatch\.pl	--	gen_context(system_u:object_r:logwatch_exec_t,s0)
 
-/usr/share/logwatch/scripts/logwatch\.pl -- gen_context(system_u:object_r:logwatch_exec_t, s0)
+/usr/share/logwatch/scripts/logwatch\.pl	--	gen_context(system_u:object_r:logwatch_exec_t, s0)
 
 /var/cache/logwatch(/.*)?	gen_context(system_u:object_r:logwatch_cache_t, s0)
-/var/lib/logcheck(/.*)?		gen_context(system_u:object_r:logwatch_cache_t,s0)
-/var/log/logcheck/.+	--	gen_context(system_u:object_r:logwatch_lock_t,s0)
+
+/var/lib/logcheck(/.*)?	gen_context(system_u:object_r:logwatch_cache_t,s0)
+/var/lib/epylog(/.*)?	gen_context(system_u:object_r:logwatch_cache_t,s0)
+
+/var/lock/logcheck.*	gen_context(system_u:object_r:logwatch_lock_t,s0)
+
+/var/run/epylog\.pid	--	gen_context(system_u:object_r:logwatch_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/logwatch.if refpolicy/policy/modules/contrib/logwatch.if
--- refpolicy/policy/modules/contrib/logwatch.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/logwatch.if	2012-10-10 21:47:55.617027948 +0200
@@ -1,4 +1,4 @@
-## <summary>System log analyzer and reporter</summary>
+## <summary>System log analyzer and reporter.</summary>
 
 ########################################
 ## <summary>
@@ -21,7 +21,7 @@
 
 ########################################
 ## <summary>
-##	Search logwatch cache directory.
+##	Search logwatch cache directories.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -34,5 +34,6 @@
 		type logwatch_cache_t;
 	')
 
+	files_search_var($1)
 	allow $1 logwatch_cache_t:dir search_dir_perms;
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/logwatch.te refpolicy/policy/modules/contrib/logwatch.te
--- refpolicy/policy/modules/contrib/logwatch.te	2012-05-04 15:16:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/logwatch.te	2012-10-30 19:32:32.358399569 +0100
@@ -1,4 +1,4 @@
-policy_module(logwatch, 1.11.0)
+policy_module(logwatch, 1.11.4)
 
 #################################
 #
@@ -7,8 +7,7 @@
 
 type logwatch_t;
 type logwatch_exec_t;
-application_domain(logwatch_t, logwatch_exec_t)
-role system_r types logwatch_t;
+init_system_domain(logwatch_t, logwatch_exec_t)
 
 type logwatch_cache_t;
 files_type(logwatch_cache_t)
@@ -19,15 +18,21 @@
 type logwatch_tmp_t;
 files_tmp_file(logwatch_tmp_t)
 
+type logwatch_var_run_t;
+files_pid_file(logwatch_var_run_t)
+
+mta_base_mail_template(logwatch)
+role system_r types logwatch_mail_t;
+
 ########################################
 #
 # Local policy
 #
 
-allow logwatch_t self:capability { dac_override dac_read_search setgid };
-allow logwatch_t self:process signal;
-allow logwatch_t self:fifo_file rw_file_perms;
-allow logwatch_t self:unix_stream_socket create_stream_socket_perms;
+allow logwatch_t self:capability { dac_override dac_read_search setgid sys_nice };
+allow logwatch_t self:process { setsched signal };
+allow logwatch_t self:fifo_file rw_fifo_file_perms;
+allow logwatch_t self:unix_stream_socket { accept listen };
 
 manage_dirs_pattern(logwatch_t, logwatch_cache_t, logwatch_cache_t)
 manage_files_pattern(logwatch_t, logwatch_cache_t, logwatch_cache_t)
@@ -39,6 +44,9 @@
 manage_files_pattern(logwatch_t, logwatch_tmp_t, logwatch_tmp_t)
 files_tmp_filetrans(logwatch_t, logwatch_tmp_t, { file dir })
 
+allow logwatch_t logwatch_var_run_t:file manage_file_perms;
+files_pid_filetrans(logwatch_t, logwatch_var_run_t, file)
+
 kernel_read_fs_sysctls(logwatch_t)
 kernel_read_kernel_sysctls(logwatch_t)
 kernel_read_system_state(logwatch_t)
@@ -51,25 +59,25 @@
 dev_read_urand(logwatch_t)
 dev_read_sysfs(logwatch_t)
 
-# Read /proc/PID directories for all domains.
 domain_read_all_domains_state(logwatch_t)
 
+files_getattr_all_files(logwatch_t)
+files_getattr_all_file_type_fs(logwatch_t)
 files_list_var(logwatch_t)
+files_search_all(logwatch_t)
 files_read_var_symlinks(logwatch_t)
-files_read_etc_files(logwatch_t)
 files_read_etc_runtime_files(logwatch_t)
 files_read_usr_files(logwatch_t)
-files_search_spool(logwatch_t)
-files_search_mnt(logwatch_t)
-files_dontaudit_search_home(logwatch_t)
-files_dontaudit_search_boot(logwatch_t)
-# Execs df and if file system mounted with a context avc raised
-files_dontaudit_search_all_dirs(logwatch_t)
+files_dontaudit_list_tmp(logwatch_t)
 
 fs_getattr_all_fs(logwatch_t)
 fs_dontaudit_list_auto_mountpoints(logwatch_t)
 fs_list_inotifyfs(logwatch_t)
 
+storage_dontaudit_getattr_fixed_disk_dev(logwatch_t)
+
+mls_file_read_to_clearance(logwatch_t)
+
 term_dontaudit_getattr_pty_dirs(logwatch_t)
 term_dontaudit_list_ptys(logwatch_t)
 
@@ -88,17 +96,12 @@
 
 selinux_dontaudit_getattr_dir(logwatch_t)
 
-sysnet_dns_name_resolve(logwatch_t)
 sysnet_exec_ifconfig(logwatch_t)
 
 userdom_dontaudit_search_user_home_dirs(logwatch_t)
 
-mta_send_mail(logwatch_t)
-
-ifdef(`distro_redhat',`
-	files_search_all(logwatch_t)
-	files_getattr_all_file_type_fs(logwatch_t)
-')
+mta_sendmail_domtrans(logwatch_t, logwatch_mail_t)
+mta_getattr_spool(logwatch_t)
 
 tunable_policy(`use_nfs_home_dirs',`
 	fs_list_nfs(logwatch_t)
@@ -130,10 +133,6 @@
 ')
 
 optional_policy(`
-	mta_getattr_spool(logwatch_t)
-')
-
-optional_policy(`
 	ntp_domtrans(logwatch_t)
 ')
 
@@ -145,3 +144,26 @@
 	samba_read_log(logwatch_t)
 	samba_read_share_files(logwatch_t)
 ')
+
+########################################
+#
+# Mail local policy
+#
+
+allow logwatch_mail_t self:capability { dac_read_search dac_override };
+
+allow logwatch_mail_t logwatch_t:fd use;
+allow logwatch_mail_t logwatch_t:fifo_file rw_fifo_file_perms;
+allow logwatch_mail_t logwatch_t:process sigchld;
+
+manage_files_pattern(logwatch_mail_t, logwatch_tmp_t, logwatch_tmp_t)
+
+dev_read_rand(logwatch_mail_t)
+dev_read_urand(logwatch_mail_t)
+dev_read_sysfs(logwatch_mail_t)
+
+logging_read_all_logs(logwatch_mail_t)
+
+optional_policy(`
+	cron_use_system_job_fds(logwatch_mail_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/lpd.fc refpolicy/policy/modules/contrib/lpd.fc
--- refpolicy/policy/modules/contrib/lpd.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/lpd.fc	2012-10-10 21:47:58.117027952 +0200
@@ -1,37 +1,32 @@
-#
-# /dev
-#
-/dev/printer		-s	gen_context(system_u:object_r:printer_t,s0)
-
-/opt/gutenprint/s?bin(/.*)?	gen_context(system_u:object_r:lpr_exec_t,s0)
-
-#
-# /usr
-#
-/usr/bin/cancel(\.cups)? --	gen_context(system_u:object_r:lpr_exec_t,s0)
+/dev/printer	-s	gen_context(system_u:object_r:printer_t,s0)
+
+/opt/gutenprint/bin(/.*)?	gen_context(system_u:object_r:lpr_exec_t,s0)
+/opt/gutenprint/sbin(/.*)?	gen_context(system_u:object_r:lpr_exec_t,s0)
+
+/usr/bin/cancel(\.cups)?	--	gen_context(system_u:object_r:lpr_exec_t,s0)
 /usr/bin/lp(\.cups)?	--	gen_context(system_u:object_r:lpr_exec_t,s0)
 /usr/bin/lpoptions	--	gen_context(system_u:object_r:lpr_exec_t,s0)
 /usr/bin/lpq(\.cups)?	--	gen_context(system_u:object_r:lpr_exec_t,s0)
 /usr/bin/lpr(\.cups)?	--	gen_context(system_u:object_r:lpr_exec_t,s0)
 /usr/bin/lprm(\.cups)?	--	gen_context(system_u:object_r:lpr_exec_t,s0)
-/usr/bin/lpstat(\.cups)? --	gen_context(system_u:object_r:lpr_exec_t,s0)
+/usr/bin/lpstat(\.cups)?	--	gen_context(system_u:object_r:lpr_exec_t,s0)
 
 /usr/sbin/accept	--	gen_context(system_u:object_r:lpr_exec_t,s0)
 /usr/sbin/checkpc	--	gen_context(system_u:object_r:checkpc_exec_t,s0)
-/usr/sbin/lpd		--	gen_context(system_u:object_r:lpd_exec_t,s0)
+/usr/sbin/lpd	--	gen_context(system_u:object_r:lpd_exec_t,s0)
 /usr/sbin/lpadmin	--	gen_context(system_u:object_r:lpr_exec_t,s0)
 /usr/sbin/lpc(\.cups)?	--	gen_context(system_u:object_r:lpr_exec_t,s0)
 /usr/sbin/lpinfo	--	gen_context(system_u:object_r:lpr_exec_t,s0)
 /usr/sbin/lpmove	--	gen_context(system_u:object_r:lpr_exec_t,s0)
 
-/usr/local/linuxprinter/bin/l?lpr -- gen_context(system_u:object_r:lpr_exec_t,s0)
+/usr/local/linuxprinter/bin/l?lpr	--	gen_context(system_u:object_r:lpr_exec_t,s0)
 
-/usr/share/printconf/.* --	gen_context(system_u:object_r:printconf_t,s0)
+/usr/share/printconf/.*	--	gen_context(system_u:object_r:printconf_t,s0)
 
-#
-# /var
-#
-/var/spool/cups(/.*)?		gen_context(system_u:object_r:print_spool_t,mls_systemhigh)
+/var/spool/cups(/.*)?	gen_context(system_u:object_r:print_spool_t,mls_systemhigh)
 /var/spool/cups-pdf(/.*)?	gen_context(system_u:object_r:print_spool_t,mls_systemhigh)
-/var/spool/lpd(/.*)?		gen_context(system_u:object_r:print_spool_t,s0)
-/var/run/lprng(/.*)?		gen_context(system_u:object_r:lpd_var_run_t,s0)
+/var/spool/lpd(/.*)?	gen_context(system_u:object_r:print_spool_t,s0)
+
+/var/run/lprng(/.*)?	gen_context(system_u:object_r:lpd_var_run_t,s0)
+
+/var/spool/turboprint(/.*)?	gen_context(system_u:object_r:lpd_var_run_t,mls_systemhigh)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/lpd.if refpolicy/policy/modules/contrib/lpd.if
--- refpolicy/policy/modules/contrib/lpd.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/lpd.if	2012-10-13 19:01:13.348560174 +0200
@@ -1,33 +1,44 @@
-## <summary>Line printer daemon</summary>
+## <summary>Line printer daemon.</summary>
 
 ########################################
 ## <summary>
-##	Role access for lpd
+##	Role access for lpd.
 ## </summary>
 ## <param name="role">
 ##	<summary>
-##	Role allowed access
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <param name="domain">
 ##	<summary>
-##	User domain for the role
+##	User domain for the role.
 ##	</summary>
 ## </param>
 #
 interface(`lpd_role',`
 	gen_require(`
-		type lpr_t, lpr_exec_t, print_spool_t;
+		attribute_role lpr_roles;
+		type lpr_t, lpr_exec_t;
 	')
 
-	role $1 types lpr_t;
+	########################################
+	#
+	# Declarations
+	#
+
+	roleattribute $1 lpr_roles;
+
+	########################################
+	#
+	# Policy
+	#
 
-	# Transition from the user domain to the derived domain.
 	domtrans_pattern($2, lpr_exec_t, lpr_t)
-	dontaudit lpr_t $2:unix_stream_socket { read write };
 
+	allow $2 lpr_t:process { ptrace signal_perms };
 	ps_process_pattern($2, lpr_t)
-	allow $2 lpr_t:process signull;
+
+	dontaudit lpr_t $2:unix_stream_socket { read write };
 
 	optional_policy(`
 		cups_read_config($2)
@@ -49,13 +60,15 @@
 		type checkpc_t, checkpc_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, checkpc_exec_t, checkpc_t)
 ')
 
 ########################################
 ## <summary>
-##	Execute amrecover in the lpd domain, and
-##	allow the specified role the lpd domain.
+##	Execute amrecover in the lpd
+##	domain, and allow the specified
+##	role the lpd domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -71,16 +84,16 @@
 #
 interface(`lpd_run_checkpc',`
 	gen_require(`
-		type checkpc_t;
+		attribute_role checkpc_roles;
 	')
 
 	lpd_domtrans_checkpc($1)
-	role $2 types checkpc_t;
+	roleattribute $2 checkpc_roles;
 ')
 
 ########################################
 ## <summary>
-##	List the contents of the printer spool directories.
+##	List printer spool directories.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -99,7 +112,7 @@
 
 ########################################
 ## <summary>
-##	Read the printer spool files.
+##	Read printer spool files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -118,7 +131,8 @@
 
 ########################################
 ## <summary>
-##	Create, read, write, and delete printer spool files.
+##	Create, read, write, and delete
+##	printer spool content.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -139,7 +153,7 @@
 
 ########################################
 ## <summary>
-##	Relabel from and to the spool files.
+##	Relabel spool files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -153,12 +167,12 @@
 	')
 
 	files_search_spool($1)
-	allow $1 print_spool_t:file { relabelto relabelfrom };
+	allow $1 print_spool_t:file relabel_file_perms;
 ')
 
 ########################################
 ## <summary>
-##	List the contents of the printer spool directories.
+##	Read printer configuration files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -191,13 +205,39 @@
 		type lpr_t, lpr_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, lpr_exec_t, lpr_t)
 ')
 
 ########################################
 ## <summary>
-##	Allow the specified domain to execute lpr
-##	in the caller domain.
+##	Execute lpr in the lpr domain, and
+##	allow the specified role the lpr domain.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed to transition.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`lpd_run_lpr',`
+	gen_require(`
+		attribute_role lpr_roles;
+	')
+
+	lpd_domtrans_lpr($1)
+	roleattribute $2 lpr_roles;
+')
+
+########################################
+## <summary>
+##	Execute lpr in the caller domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -210,5 +250,6 @@
 		type lpr_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	can_exec($1, lpr_exec_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/lpd.te refpolicy/policy/modules/contrib/lpd.te
--- refpolicy/policy/modules/contrib/lpd.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/lpd.te	2012-10-13 19:01:13.359559888 +0200
@@ -1,4 +1,4 @@
-policy_module(lpd, 1.13.0)
+policy_module(lpd, 1.13.3)
 
 ########################################
 #
@@ -6,16 +6,19 @@
 #
 
 ## <desc>
-## <p>
-## Use lpd server instead of cups
-## </p>
+##	<p>
+##	Determine whether to support lpd server.
+##	</p>
 ## </desc>
 gen_tunable(use_lpd_server, false)
 
+attribute_role checkpc_roles;
+attribute_role lpr_roles;
+
 type checkpc_t;
 type checkpc_exec_t;
 init_system_domain(checkpc_t, checkpc_exec_t)
-role system_r types checkpc_t;
+role checkpc_roles types checkpc_t;
 
 type checkpc_log_t;
 logging_log_file(checkpc_log_t)
@@ -35,13 +38,13 @@
 typealias lpr_t alias { user_lpr_t staff_lpr_t sysadm_lpr_t };
 typealias lpr_t alias { auditadm_lpr_t secadm_lpr_t };
 userdom_user_application_domain(lpr_t, lpr_exec_t)
+role lpr_roles types lpr_t;
 
 type lpr_tmp_t;
 typealias lpr_tmp_t alias { user_lpr_tmp_t staff_lpr_tmp_t sysadm_lpr_tmp_t };
 typealias lpr_tmp_t alias { auditadm_lpr_tmp_t secadm_lpr_tmp_t };
 userdom_user_tmp_file(lpr_tmp_t)
 
-# Type for spool files.
 type print_spool_t;
 typealias print_spool_t alias { user_print_spool_t staff_print_spool_t sysadm_print_spool_t };
 typealias print_spool_t alias { auditadm_print_spool_t secadm_print_spool_t };
@@ -52,33 +55,28 @@
 files_type(printer_t)
 
 type printconf_t;
-files_type(printconf_t)
+files_config_file(printconf_t)
 
 ########################################
 #
 # Checkpc local policy
 #
 
-# Allow checkpc to access the lpd spool so it can check & fix it.
-# This requires that /usr/sbin/checkpc have type checkpc_t.
-
 allow checkpc_t self:capability { setgid setuid dac_override };
 allow checkpc_t self:process signal_perms;
 allow checkpc_t self:unix_stream_socket create_socket_perms;
 allow checkpc_t self:tcp_socket create_socket_perms;
 allow checkpc_t self:udp_socket create_socket_perms;
 
-allow checkpc_t checkpc_log_t:file manage_file_perms;
+allow checkpc_t checkpc_log_t:file { append_file_perms create_file_perms setattr_file_perms };
 logging_log_filetrans(checkpc_t, checkpc_log_t, file)
 
 allow checkpc_t lpd_var_run_t:dir search_dir_perms;
-files_search_pids(checkpc_t)
 
 rw_files_pattern(checkpc_t, print_spool_t, print_spool_t)
 delete_files_pattern(checkpc_t, print_spool_t, print_spool_t)
-files_search_spool(checkpc_t)
 
-allow checkpc_t printconf_t:file getattr;
+allow checkpc_t printconf_t:file getattr_file_perms;
 allow checkpc_t printconf_t:dir list_dir_perms;
 
 kernel_read_system_state(checkpc_t)
@@ -86,27 +84,25 @@
 corenet_all_recvfrom_unlabeled(checkpc_t)
 corenet_all_recvfrom_netlabel(checkpc_t)
 corenet_tcp_sendrecv_generic_if(checkpc_t)
-corenet_udp_sendrecv_generic_if(checkpc_t)
 corenet_tcp_sendrecv_generic_node(checkpc_t)
-corenet_udp_sendrecv_generic_node(checkpc_t)
 corenet_tcp_sendrecv_all_ports(checkpc_t)
-corenet_udp_sendrecv_all_ports(checkpc_t)
-corenet_tcp_connect_all_ports(checkpc_t)
-corenet_sendrecv_all_client_packets(checkpc_t)
 
-dev_append_printer(checkpc_t)
+corenet_sendrecv_all_client_packets(checkpc_t)
+corenet_tcp_connect_all_ports(checkpc_t)
 
-# This is less desirable, but checkpc demands /bin/bash and /bin/chown:
 corecmd_exec_shell(checkpc_t)
 corecmd_exec_bin(checkpc_t)
 
+dev_append_printer(checkpc_t)
+
 domain_use_interactive_fds(checkpc_t)
 
 files_read_etc_files(checkpc_t)
 files_read_etc_runtime_files(checkpc_t)
+files_search_pids(checkpc_t)
+files_search_spool(checkpc_t)
 
 init_use_script_ptys(checkpc_t)
-# Allow access to /dev/console through the fd:
 init_use_fds(checkpc_t)
 
 sysnet_read_config(checkpc_t)
@@ -134,8 +130,7 @@
 dontaudit lpd_t self:capability sys_tty_config;
 allow lpd_t self:process signal_perms;
 allow lpd_t self:fifo_file rw_fifo_file_perms;
-allow lpd_t self:unix_stream_socket create_stream_socket_perms;
-allow lpd_t self:unix_dgram_socket create_socket_perms;
+allow lpd_t self:unix_stream_socket { accept listen };
 allow lpd_t self:tcp_socket create_stream_socket_perms;
 allow lpd_t self:udp_socket create_stream_socket_perms;
 
@@ -143,61 +138,54 @@
 manage_files_pattern(lpd_t, lpd_tmp_t, lpd_tmp_t)
 files_tmp_filetrans(lpd_t, lpd_tmp_t, { file dir })
 
+manage_dirs_pattern(lpd_t, lpd_var_run_t, lpd_var_run_t)
 manage_files_pattern(lpd_t, lpd_var_run_t, lpd_var_run_t)
 manage_sock_files_pattern(lpd_t, lpd_var_run_t, lpd_var_run_t)
-files_pid_filetrans(lpd_t, lpd_var_run_t, file)
+files_pid_filetrans(lpd_t, lpd_var_run_t, { dir file })
 
-# Write to /var/spool/lpd.
 manage_files_pattern(lpd_t, print_spool_t, print_spool_t)
-files_search_spool(lpd_t)
 
-# lpd must be able to execute the filter utilities in /usr/share/printconf.
 allow lpd_t printconf_t:dir list_dir_perms;
-can_exec(lpd_t, printconf_t)
 
-# Create and bind to /dev/printer.
-allow lpd_t printer_t:lnk_file manage_lnk_file_perms;
-dev_filetrans(lpd_t, printer_t, lnk_file)
+allow lpd_t printer_t:sock_file manage_sock_file_perms;
+dev_filetrans(lpd_t, printer_t, sock_file)
+
+can_exec(lpd_t, printconf_t)
 
 kernel_read_kernel_sysctls(lpd_t)
-# bash wants access to /proc/meminfo
 kernel_read_system_state(lpd_t)
 
 corenet_all_recvfrom_unlabeled(lpd_t)
 corenet_all_recvfrom_netlabel(lpd_t)
 corenet_tcp_sendrecv_generic_if(lpd_t)
-corenet_udp_sendrecv_generic_if(lpd_t)
 corenet_tcp_sendrecv_generic_node(lpd_t)
-corenet_udp_sendrecv_generic_node(lpd_t)
-corenet_tcp_sendrecv_all_ports(lpd_t)
-corenet_udp_sendrecv_all_ports(lpd_t)
 corenet_tcp_bind_generic_node(lpd_t)
-corenet_tcp_bind_printer_port(lpd_t)
-corenet_sendrecv_printer_server_packets(lpd_t)
-
-dev_read_sysfs(lpd_t)
-dev_rw_printer(lpd_t)
 
-fs_getattr_all_fs(lpd_t)
-fs_search_auto_mountpoints(lpd_t)
+corenet_sendrecv_printer_server_packets(lpd_t)
+corenet_tcp_bind_printer_port(lpd_t)
+corenet_tcp_sendrecv_printer_port(lpd_t)
 
-# Filter scripts may be shell scripts, and may invoke progs like /bin/mktemp
 corecmd_exec_bin(lpd_t)
 corecmd_exec_shell(lpd_t)
 
+dev_read_sysfs(lpd_t)
+dev_rw_printer(lpd_t)
+
 domain_use_interactive_fds(lpd_t)
 
 files_read_etc_runtime_files(lpd_t)
 files_read_usr_files(lpd_t)
-# for defoma
 files_list_world_readable(lpd_t)
 files_read_world_readable_files(lpd_t)
 files_read_world_readable_symlinks(lpd_t)
 files_list_var_lib(lpd_t)
 files_read_var_lib_files(lpd_t)
 files_read_var_lib_symlinks(lpd_t)
-# config files for lpd are of type etc_t, probably should change this
 files_read_etc_files(lpd_t)
+files_search_spool(lpd_t)
+
+fs_getattr_all_fs(lpd_t)
+fs_search_auto_mountpoints(lpd_t)
 
 logging_send_syslog_msg(lpd_t)
 
@@ -223,31 +211,27 @@
 
 ##############################
 #
-# Local policy
+# Lpr local policy
 #
 
 allow lpr_t self:capability { setuid dac_override net_bind_service chown };
-allow lpr_t self:unix_stream_socket create_stream_socket_perms;
-allow lpr_t self:tcp_socket create_socket_perms;
-allow lpr_t self:udp_socket create_socket_perms;
+allow lpr_t self:unix_stream_socket { accept listen };
 
-can_exec(lpr_t, lpr_exec_t)
-
-# Allow lpd to read, rename, and unlink spool files.
 allow lpd_t print_spool_t:file { read_file_perms rename_file_perms delete_file_perms };
 
+can_exec(lpr_t, lpr_exec_t)
+
+kernel_read_crypto_sysctls(lpr_t)
 kernel_read_kernel_sysctls(lpr_t)
 
 corenet_all_recvfrom_unlabeled(lpr_t)
 corenet_all_recvfrom_netlabel(lpr_t)
 corenet_tcp_sendrecv_generic_if(lpr_t)
-corenet_udp_sendrecv_generic_if(lpr_t)
 corenet_tcp_sendrecv_generic_node(lpr_t)
-corenet_udp_sendrecv_generic_node(lpr_t)
 corenet_tcp_sendrecv_all_ports(lpr_t)
-corenet_udp_sendrecv_all_ports(lpr_t)
-corenet_tcp_connect_all_ports(lpr_t)
+
 corenet_sendrecv_all_client_packets(lpr_t)
+corenet_tcp_connect_all_ports(lpr_t)
 
 dev_read_rand(lpr_t)
 dev_read_urand(lpr_t)
@@ -255,41 +239,32 @@
 domain_use_interactive_fds(lpr_t)
 
 files_search_spool(lpr_t)
-# for lpd config files (should have a new type)
-files_read_etc_files(lpr_t)
-# for test print
 files_read_usr_files(lpr_t)
-#Added to cover read_content macro
 files_list_home(lpr_t)
-files_read_generic_tmp_files(lpr_t)
 
-fs_getattr_xattr_fs(lpr_t)
+fs_getattr_all_fs(lpr_t)
 
-# Access the terminal.
 term_use_controlling_term(lpr_t)
 term_use_generic_ptys(lpr_t)
 
 auth_use_nsswitch(lpr_t)
 
+logging_send_syslog_msg(lpr_t)
+
 miscfiles_read_localization(lpr_t)
 
 userdom_read_user_tmp_symlinks(lpr_t)
-# Write to the user domain tty.
 userdom_use_user_terminals(lpr_t)
 userdom_read_user_home_content_files(lpr_t)
 userdom_read_user_tmp_files(lpr_t)
 
 tunable_policy(`use_lpd_server',`
-	# lpr can run in lightweight mode, without a local print spooler.
-	allow lpr_t lpd_var_run_t:dir search;
-	allow lpr_t lpd_var_run_t:sock_file write;
+	allow lpr_t lpd_t:process signal;
+
+	write_sock_files_pattern(lpr_t, lpd_var_run_t, lpd_var_run_t)
 	files_read_var_files(lpr_t)
 
-	# Connect to lpd via a Unix domain socket.
-	allow lpr_t printer_t:sock_file rw_sock_file_perms;
-	allow lpr_t lpd_t:unix_stream_socket connectto;
-	# Send SIGHUP to lpd.
-	allow lpr_t lpd_t:process signal;
+	stream_connect_pattern(lpr_t, printer_t, printer_t, lpd_t)
 
 	manage_dirs_pattern(lpr_t, lpr_tmp_t, lpr_tmp_t)
 	manage_files_pattern(lpr_t, lpr_tmp_t, lpr_tmp_t)
@@ -297,12 +272,10 @@
 
 	manage_files_pattern(lpr_t, print_spool_t, print_spool_t)
 	filetrans_pattern(lpr_t, print_spool_t, print_spool_t, file)
-	# Read and write shared files in the spool directory.
-	allow lpr_t print_spool_t:file rw_file_perms;
 
 	allow lpr_t printconf_t:dir list_dir_perms;
-	read_files_pattern(lpr_t, printconf_t, printconf_t)
-	read_lnk_files_pattern(lpr_t, printconf_t, printconf_t)
+	allow lpr_t printconf_t:file read_file_perms;
+	allow lpr_t printconf_t:lnk_file read_lnk_file_perms;
 ')
 
 tunable_policy(`use_nfs_home_dirs',`
@@ -324,5 +297,5 @@
 ')
 
 optional_policy(`
-	logging_send_syslog_msg(lpr_t)
+	gnome_stream_connect_all_gkeyringd(lpr_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/mailman.fc refpolicy/policy/modules/contrib/mailman.fc
--- refpolicy/policy/modules/contrib/mailman.fc	2012-05-04 16:17:58.000000000 +0200
+++ refpolicy/policy/modules/contrib/mailman.fc	2012-10-11 18:00:43.922183267 +0200
@@ -1,34 +1,30 @@
-/usr/lib/mailman/bin/mailmanctl --	gen_context(system_u:object_r:mailman_mail_exec_t,s0)
-/usr/lib/mailman/cron/.*	--	gen_context(system_u:object_r:mailman_queue_exec_t,s0)
+/etc/cron\.daily/mailman	--	gen_context(system_u:object_r:mailman_queue_exec_t,s0)
+/etc/cron\.monthly/mailman	--	gen_context(system_u:object_r:mailman_queue_exec_t,s0)
 
-/var/lib/mailman(/.*)?			gen_context(system_u:object_r:mailman_data_t,s0)
-/var/lib/mailman/archives(/.*)?		gen_context(system_u:object_r:mailman_archive_t,s0)
-/var/lock/mailman(/.*)?			gen_context(system_u:object_r:mailman_lock_t,s0)
-/var/log/mailman(/.*)?			gen_context(system_u:object_r:mailman_log_t,s0)
-/var/run/mailman(/.*)?			gen_context(system_u:object_r:mailman_lock_t,s0)
-
-#
-# distro_debian
-#
-ifdef(`distro_debian', `
-/etc/cron\.daily/mailman 	-- 	gen_context(system_u:object_r:mailman_queue_exec_t,s0)
-/etc/cron\.monthly/mailman 	-- 	gen_context(system_u:object_r:mailman_queue_exec_t,s0)
-
-/usr/lib/cgi-bin/mailman/.*	--	gen_context(system_u:object_r:mailman_cgi_exec_t,s0)
-/usr/lib/mailman/mail/wrapper 	--	gen_context(system_u:object_r:mailman_mail_exec_t,s0)
-/usr/mailman/mail/wrapper	--	gen_context(system_u:object_r:mailman_mail_exec_t,s0)
-')
-
-#
-# distro_redhat
-#
-ifdef(`distro_redhat', `
-/etc/mailman(/.*)?			gen_context(system_u:object_r:mailman_data_t,s0)
-
-/usr/lib/mailman/bin/qrunner	--	gen_context(system_u:object_r:mailman_queue_exec_t,s0)
-/usr/lib/mailman/cgi-bin/.*	--	gen_context(system_u:object_r:mailman_cgi_exec_t,s0)
-/usr/lib/mailman/mail/mailman	--	gen_context(system_u:object_r:mailman_mail_exec_t,s0)
-/usr/lib/mailman/scripts/mailman --	gen_context(system_u:object_r:mailman_mail_exec_t,s0)
+/etc/mailman.*	gen_context(system_u:object_r:mailman_data_t,s0)
 
-/var/spool/mailman(/.*)?		gen_context(system_u:object_r:mailman_data_t,s0)
-')
+/usr/lib/mailman.*/bin/mailmanctl	--	gen_context(system_u:object_r:mailman_mail_exec_t,s0)
+/usr/lib/mailman.*/bin/mm-handler.*	--	gen_context(system_u:object_r:mailman_mail_exec_t,s0)
+/usr/lib/mailman.*/cron/.*	--	gen_context(system_u:object_r:mailman_queue_exec_t,s0)
+/var/lib/mailman.*	gen_context(system_u:object_r:mailman_data_t,s0)
+/var/lib/mailman.*/archives(/.*)?	gen_context(system_u:object_r:mailman_archive_t,s0)
+
+/var/lock/mailman.*	gen_context(system_u:object_r:mailman_lock_t,s0)
+/var/lock/subsys/mailman.*	--	gen_context(system_u:object_r:mailman_lock_t,s0)
+
+/var/log/mailman.*	gen_context(system_u:object_r:mailman_log_t,s0)
+
+/var/run/mailman.*	gen_context(system_u:object_r:mailman_var_run_t,s0)
+
+/var/spool/mailman.*	gen_context(system_u:object_r:mailman_data_t,s0)
+
+/usr/lib/cgi-bin/mailman.*/.*	--	gen_context(system_u:object_r:mailman_cgi_exec_t,s0)
+/usr/lib/mailman.*/bin/qrunner	--	gen_context(system_u:object_r:mailman_queue_exec_t,s0)
+/usr/lib/mailman.*/cgi-bin/.*	--	gen_context(system_u:object_r:mailman_cgi_exec_t,s0)
+/usr/lib/mailman.*/mail/mailman	--	gen_context(system_u:object_r:mailman_mail_exec_t,s0)
+/usr/lib/mailman.*/mail/wrapper	--	gen_context(system_u:object_r:mailman_mail_exec_t,s0)
+/usr/lib/mailman.*/scripts/mailman	--	gen_context(system_u:object_r:mailman_mail_exec_t,s0)
+
+/usr/mailman.*/mail/wrapper	--	gen_context(system_u:object_r:mailman_mail_exec_t,s0)
+
+/usr/share/doc/mailman.*/mm-handler.*	--	gen_context(system_u:object_r:mailman_mail_exec_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/mailman.if refpolicy/policy/modules/contrib/mailman.if
--- refpolicy/policy/modules/contrib/mailman.if	2012-05-04 15:16:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/mailman.if	2012-10-13 21:41:29.101580068 +0200
@@ -1,93 +1,44 @@
-## <summary>Mailman is for managing electronic mail discussion and e-newsletter lists</summary>
+## <summary>Manage electronic mail discussion and e-newsletter lists.</summary>
 
 #######################################
 ## <summary>
-##	The template to define a mailmain domain.
+##	The template to define a mailman domain.
 ## </summary>
-## <desc>
-##	<p>
-##	This template creates a domain to be used for
-##	a new mailman daemon.
-##	</p>
-## </desc>
-## <param name="userdomain_prefix">
+## <param name="domain_prefix">
 ##	<summary>
-##	The type of daemon to be used eg, cgi would give mailman_cgi_
+##	Domain prefix to be used.
 ##	</summary>
 ## </param>
 #
-template(`mailman_domain_template', `
-	type mailman_$1_t;
-	domain_type(mailman_$1_t)
-	role system_r types mailman_$1_t;
+template(`mailman_domain_template',`
+	gen_require(`
+		attribute mailman_domain;
+	')
 
+	########################################
+	#
+	# Declarations
+	#
+
+	type mailman_$1_t;
 	type mailman_$1_exec_t;
+	domain_type(mailman_$1_t)
 	domain_entry_file(mailman_$1_t, mailman_$1_exec_t)
+	role system_r types mailman_$1_t;
 
 	type mailman_$1_tmp_t;
 	files_tmp_file(mailman_$1_tmp_t)
 
-	allow mailman_$1_t self:{ unix_stream_socket unix_dgram_socket } create_socket_perms;
-	allow mailman_$1_t self:tcp_socket create_stream_socket_perms;
-	allow mailman_$1_t self:udp_socket create_socket_perms;
-
-	files_search_spool(mailman_$1_t)
-
-	manage_dirs_pattern(mailman_$1_t, mailman_archive_t, mailman_archive_t)
-	manage_files_pattern(mailman_$1_t, mailman_archive_t, mailman_archive_t)
-	manage_lnk_files_pattern(mailman_$1_t, mailman_archive_t, mailman_archive_t)
-
-	manage_dirs_pattern(mailman_$1_t, mailman_data_t, mailman_data_t)
-	manage_files_pattern(mailman_$1_t, mailman_data_t, mailman_data_t)
-	manage_lnk_files_pattern(mailman_$1_t, mailman_data_t, mailman_data_t)
-
-	manage_files_pattern(mailman_$1_t, mailman_lock_t, mailman_lock_t)
-	files_lock_filetrans(mailman_$1_t, mailman_lock_t, file)
-
-	manage_files_pattern(mailman_$1_t, mailman_log_t, mailman_log_t)
-	logging_log_filetrans(mailman_$1_t, mailman_log_t, file)
+	####################################
+	#
+	# Policy
+	#
 
 	manage_dirs_pattern(mailman_$1_t, mailman_$1_tmp_t, mailman_$1_tmp_t)
 	manage_files_pattern(mailman_$1_t, mailman_$1_tmp_t, mailman_$1_tmp_t)
 	files_tmp_filetrans(mailman_$1_t, mailman_$1_tmp_t, { file dir })
 
-	kernel_read_kernel_sysctls(mailman_$1_t)
-	kernel_read_system_state(mailman_$1_t)
-
-	corenet_all_recvfrom_unlabeled(mailman_$1_t)
-	corenet_all_recvfrom_netlabel(mailman_$1_t)
-	corenet_tcp_sendrecv_generic_if(mailman_$1_t)
-	corenet_udp_sendrecv_generic_if(mailman_$1_t)
-	corenet_raw_sendrecv_generic_if(mailman_$1_t)
-	corenet_tcp_sendrecv_generic_node(mailman_$1_t)
-	corenet_udp_sendrecv_generic_node(mailman_$1_t)
-	corenet_raw_sendrecv_generic_node(mailman_$1_t)
-	corenet_tcp_sendrecv_all_ports(mailman_$1_t)
-	corenet_udp_sendrecv_all_ports(mailman_$1_t)
-	corenet_tcp_bind_generic_node(mailman_$1_t)
-	corenet_udp_bind_generic_node(mailman_$1_t)
-	corenet_tcp_connect_smtp_port(mailman_$1_t)
-	corenet_sendrecv_smtp_client_packets(mailman_$1_t)
-
-	fs_getattr_xattr_fs(mailman_$1_t)
-
-	corecmd_exec_all_executables(mailman_$1_t)
-
-	files_exec_etc_files(mailman_$1_t)
-	files_list_usr(mailman_$1_t)
-	files_list_var(mailman_$1_t)
-	files_list_var_lib(mailman_$1_t)
-	files_read_var_lib_symlinks(mailman_$1_t)
-	files_read_etc_runtime_files(mailman_$1_t)
-
 	auth_use_nsswitch(mailman_$1_t)
-
-	libs_exec_ld_so(mailman_$1_t)
-	libs_exec_lib_files(mailman_$1_t)
-
-	logging_send_syslog_msg(mailman_$1_t)
-
-	miscfiles_read_localization(mailman_$1_t)
 ')
 
 #######################################
@@ -105,9 +56,37 @@
 		type mailman_mail_exec_t, mailman_mail_t;
 	')
 
+	libs_search_lib($1)
 	domtrans_pattern($1, mailman_mail_exec_t, mailman_mail_t)
 ')
 
+########################################
+## <summary>
+##	Execute the mailman program in the
+##	mailman domain and allow the
+##	specified role the mailman domain.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed to transition.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`mailman_run',`
+	gen_require(`
+		attribute_role mailman_roles;
+	')
+
+	mailman_domtrans($1)
+	roleattribute $2 mailman_roles;
+')
+
 #######################################
 ## <summary>
 ##	Execute mailman CGI scripts in the 
@@ -124,6 +103,7 @@
 		type mailman_cgi_exec_t, mailman_cgi_t;
 	')
 
+	libs_search_lib($1)
 	domtrans_pattern($1, mailman_cgi_exec_t, mailman_cgi_t)
 ')
 
@@ -142,12 +122,13 @@
 		type mailman_mail_exec_t;
 	')
 
+	libs_search_lib($1)
 	can_exec($1, mailman_mail_exec_t)
 ')
 
 #######################################
 ## <summary>
-##	Send generic signals to the mailman cgi domain.
+##	Send generic signals to mailman cgi.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -165,7 +146,7 @@
 
 #######################################
 ## <summary>
-##	Allow domain to search data directories.
+##	Search mailman data directories.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -178,12 +159,13 @@
 		type mailman_data_t;
 	')
 
+	files_search_spool($1)
 	allow $1 mailman_data_t:dir search_dir_perms;
 ')
 
 #######################################
 ## <summary>
-##	Allow domain to to read mailman data files.
+##	Read mailman data content.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -196,6 +178,7 @@
 		type mailman_data_t;
 	')
 
+	files_search_spool($1)
 	list_dirs_pattern($1, mailman_data_t, mailman_data_t)
 	read_files_pattern($1, mailman_data_t, mailman_data_t)
 	read_lnk_files_pattern($1, mailman_data_t, mailman_data_t)
@@ -203,8 +186,8 @@
 
 #######################################
 ## <summary>
-##	Allow domain to to create mailman data files
-##	and write the directory.
+##	Create, read, write, and delete
+##	mailman data files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -217,13 +200,14 @@
 		type mailman_data_t;
 	')
 
+	files_search_spool($1)
 	manage_dirs_pattern($1, mailman_data_t, mailman_data_t)
 	manage_files_pattern($1, mailman_data_t, mailman_data_t)
 ')
 
 #######################################
 ## <summary>
-##	List the contents of mailman data directories.
+##	List mailman data directories.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -236,12 +220,13 @@
 		type mailman_data_t;
 	')
 
+	files_search_spool($1)
 	allow $1 mailman_data_t:dir list_dir_perms;
 ')
 
 #######################################
 ## <summary>
-##	Allow read acces to mailman data symbolic links.
+##	Read mailman data symbolic links.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -259,7 +244,7 @@
 
 #######################################
 ## <summary>
-##	Read mailman logs.
+##	Read mailman log files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -272,12 +257,13 @@
 		type mailman_log_t;
 	')
 
+	logging_search_logs($1)
 	read_files_pattern($1, mailman_log_t, mailman_log_t)
 ')
 
 #######################################
 ## <summary>
-##	Append to mailman logs.
+##	Append mailman log files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -290,13 +276,14 @@
 		type mailman_log_t;
 	')
 
+	logging_search_logs($1)
 	append_files_pattern($1, mailman_log_t, mailman_log_t)
 ')
 
 #######################################
 ## <summary>
 ##	Create, read, write, and delete
-##	mailman logs.
+##	mailman log content.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -309,13 +296,14 @@
 		type mailman_log_t;
 	')
 
+	logging_search_logs($1)
 	manage_files_pattern($1, mailman_log_t, mailman_log_t)
 	manage_lnk_files_pattern($1, mailman_log_t, mailman_log_t)
 ')
 
 #######################################
 ## <summary>
-##	Allow domain to read mailman archive files.
+##	Read mailman archive content.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -328,6 +316,7 @@
 		type mailman_archive_t;
 	')
 
+	files_search_var_lib($1)
 	allow $1 mailman_archive_t:dir list_dir_perms;
 	read_files_pattern($1, mailman_archive_t, mailman_archive_t)
 	read_lnk_files_pattern($1, mailman_archive_t, mailman_archive_t)
@@ -335,7 +324,8 @@
 
 #######################################
 ## <summary>
-##	Execute mailman_queue in the mailman_queue domain.
+##	Execute mailman_queue in the
+##	mailman_queue domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -348,5 +338,6 @@
 		type mailman_queue_exec_t, mailman_queue_t;
 	')
 
+	libs_search_lib($1)
 	domtrans_pattern($1, mailman_queue_exec_t, mailman_queue_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/mailman.te refpolicy/policy/modules/contrib/mailman.te
--- refpolicy/policy/modules/contrib/mailman.te	2012-07-25 20:33:04.000000000 +0200
+++ refpolicy/policy/modules/contrib/mailman.te	2012-10-15 20:34:58.488002207 +0200
@@ -1,10 +1,14 @@
-policy_module(mailman, 1.9.0)
+policy_module(mailman, 1.9.3)
 
 ########################################
 #
 # Declarations
 #
 
+attribute mailman_domain;
+
+attribute_role mailman_roles;
+
 mailman_domain_template(cgi)
 
 type mailman_data_t;
@@ -19,35 +23,81 @@
 type mailman_lock_t;
 files_lock_file(mailman_lock_t)
 
+type mailman_var_run_t;
+files_pid_file(mailman_var_run_t)
+
 mailman_domain_template(mail)
 init_daemon_domain(mailman_mail_t, mailman_mail_exec_t)
+role mailman_roles types mailman_mail_t;
 
 mailman_domain_template(queue)
 
 ########################################
 #
-# Mailman CGI local policy
+# Common local policy
 #
 
-# cjp: the template invocation for cgi should be
-# in the below optional policy; however, there are no
-# optionals for file contexts yet, so it is promoted
-# to global scope until such facilities exist.
+allow mailman_domain self:tcp_socket { accept listen };
 
-optional_policy(`
-	dev_read_urand(mailman_cgi_t)
+manage_dirs_pattern(mailman_domain, mailman_archive_t, mailman_archive_t)
+manage_files_pattern(mailman_domain, mailman_archive_t, mailman_archive_t)
+manage_lnk_files_pattern(mailman_domain, mailman_archive_t, mailman_archive_t)
+
+manage_dirs_pattern(mailman_domain, mailman_data_t, mailman_data_t)
+manage_files_pattern(mailman_domain, mailman_data_t, mailman_data_t)
+manage_lnk_files_pattern(mailman_domain, mailman_data_t, mailman_data_t)
+
+manage_files_pattern(mailman_domain, mailman_lock_t, mailman_lock_t)
+files_lock_filetrans(mailman_domain, mailman_lock_t, file)
+
+append_files_pattern(mailman_domain, mailman_log_t, mailman_log_t)
+create_files_pattern(mailman_domain, mailman_log_t, mailman_log_t)
+setattr_files_pattern(mailman_domain, mailman_log_t, mailman_log_t)
+logging_log_filetrans(mailman_domain, mailman_log_t, file)
 
-	manage_dirs_pattern(mailman_cgi_t, mailman_archive_t, mailman_archive_t)
-	manage_files_pattern(mailman_cgi_t, mailman_archive_t, mailman_archive_t)
-	manage_lnk_files_pattern(mailman_cgi_t, mailman_archive_t, mailman_archive_t)
+kernel_read_kernel_sysctls(mailman_domain)
+kernel_read_system_state(mailman_domain)
 
-	files_search_spool(mailman_cgi_t)
+corenet_all_recvfrom_unlabeled(mailman_domain)
+corenet_all_recvfrom_netlabel(mailman_domain)
+corenet_tcp_sendrecv_generic_if(mailman_domain)
+corenet_tcp_sendrecv_generic_node(mailman_domain)
 
-	term_use_controlling_term(mailman_cgi_t)
+corenet_sendrecv_smtp_client_packets(mailman_domain)
+corenet_tcp_connect_smtp_port(mailman_domain)
+corenet_tcp_sendrecv_smtp_port(mailman_domain)
 
-	# for python pre-compile foolishness
-	libs_dontaudit_write_lib_dirs(mailman_cgi_t)
+corecmd_exec_all_executables(mailman_domain)
 
+files_exec_etc_files(mailman_domain)
+files_list_usr(mailman_domain)
+files_list_var(mailman_domain)
+files_list_var_lib(mailman_domain)
+files_read_var_lib_symlinks(mailman_domain)
+files_read_etc_runtime_files(mailman_domain)
+files_search_spool(mailman_domain)
+
+fs_getattr_all_fs(mailman_domain)
+
+libs_exec_ld_so(mailman_domain)
+libs_exec_lib_files(mailman_domain)
+
+logging_send_syslog_msg(mailman_domain)
+
+miscfiles_read_localization(mailman_domain)
+
+########################################
+#
+# CGI local policy
+#
+
+dev_read_urand(mailman_cgi_t)
+
+term_use_controlling_term(mailman_cgi_t)
+
+libs_dontaudit_write_lib_dirs(mailman_cgi_t)
+
+optional_policy(`
 	apache_sigchld(mailman_cgi_t)
 	apache_use_fds(mailman_cgi_t)
 	apache_dontaudit_append_log(mailman_cgi_t)
@@ -56,20 +106,31 @@
 	apache_dontaudit_rw_stream_sockets(mailman_cgi_t)
 ')
 
+optional_policy(`
+	postfix_read_config(mailman_cgi_t)
+')
+
 ########################################
 #
-# Mailman mail local policy
+# Mail local policy
 #
 
-allow mailman_mail_t self:unix_dgram_socket create_socket_perms;
-allow mailman_mail_t self:process { signal signull };
 allow mailman_mail_t self:capability { kill dac_override setuid setgid sys_tty_config };
+allow mailman_mail_t self:process { signal signull };
 
-manage_dirs_pattern(mailman_mail_t, mailman_archive_t, mailman_archive_t)
-manage_files_pattern(mailman_mail_t, mailman_archive_t, mailman_archive_t)
-manage_lnk_files_pattern(mailman_mail_t, mailman_archive_t, mailman_archive_t)
+manage_files_pattern(mailman_mail_t, mailman_var_run_t, mailman_var_run_t)
+manage_dirs_pattern(mailman_mail_t, mailman_var_run_t, mailman_var_run_t)
+files_pid_filetrans(mailman_mail_t, mailman_var_run_t, { file dir })
+
+corenet_sendrecv_innd_client_packets(mailman_mail_t)
+corenet_tcp_connect_innd_port(mailman_mail_t)
+corenet_tcp_sendrecv_innd_port(mailman_mail_t)
+
+corenet_sendrecv_spamd_client_packets(mailman_mail_t)
+corenet_tcp_connect_spamd_port(mailman_mail_t)
+corenet_tcp_sendrecv_spamd_port(mailman_mail_t)
 
-files_search_spool(mailman_mail_t)
+dev_read_urand(mailman_mail_t)
 
 fs_rw_anon_inodefs_files(mailman_mail_t)
 
@@ -86,33 +147,28 @@
 
 optional_policy(`
 	postfix_search_spool(mailman_mail_t)
+	postfix_rw_inherited_master_pipes(mailman_mail_t)
 ')
 
 ########################################
 #
-# Mailman queue local policy
+# Queue local policy
 #
 
 allow mailman_queue_t self:capability { setgid setuid };
 allow mailman_queue_t self:process signal;
 allow mailman_queue_t self:fifo_file rw_fifo_file_perms;
-allow mailman_queue_t self:unix_dgram_socket create_socket_perms;
-
-manage_dirs_pattern(mailman_queue_t, mailman_archive_t, mailman_archive_t)
-manage_files_pattern(mailman_queue_t, mailman_archive_t, mailman_archive_t)
-manage_lnk_files_pattern(mailman_queue_t, mailman_archive_t, mailman_archive_t)
 
-kernel_read_proc_symlinks(mailman_queue_t)
+corenet_sendrecv_innd_client_packets(mailman_queue_t)
+corenet_tcp_connect_innd_port(mailman_queue_t)
+corenet_tcp_sendrecv_innd_port(mailman_queue_t)
 
 auth_domtrans_chk_passwd(mailman_queue_t)
 
 files_dontaudit_search_pids(mailman_queue_t)
 
-# for su
 seutil_dontaudit_search_config(mailman_queue_t)
 
-# some of the following could probably be changed to dontaudit, someone who
-# knows mailman well should test this out and send the changes
 userdom_search_user_home_dirs(mailman_queue_t)
 
 optional_policy(`
@@ -125,4 +181,4 @@
 
 optional_policy(`
 	su_exec(mailman_queue_t)
-')
\ No newline at end of file
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/mailscanner.fc refpolicy/policy/modules/contrib/mailscanner.fc
--- refpolicy/policy/modules/contrib/mailscanner.fc	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/mailscanner.fc	2012-10-29 15:48:28.195186457 +0100
@@ -0,0 +1,13 @@
+/etc/MailScanner(/.*)?	gen_context(system_u:object_r:mscan_etc_t,s0)
+
+/etc/rc\.d/init\.d/MailScanner	--	gen_context(system_u:object_r:mscan_initrc_exec_t,s0)
+
+/etc/sysconfig/MailScanner	--	gen_context(system_u:object_r:mscan_etc_t,s0)
+
+/etc/sysconfig/update_spamassassin	--	gen_context(system_u:object_r:mscan_etc_t,s0)
+
+/usr/sbin/MailScanner	--	gen_context(system_u:object_r:mscan_exec_t,s0)
+
+/var/run/MailScanner\.pid	--	gen_context(system_u:object_r:mscan_var_run_t,s0)
+
+/var/spool/MailScanner(/.*)?	gen_context(system_u:object_r:mscan_spool_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/mailscanner.if refpolicy/policy/modules/contrib/mailscanner.if
--- refpolicy/policy/modules/contrib/mailscanner.if	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/mailscanner.if	2012-10-29 15:48:28.195186457 +0100
@@ -0,0 +1,63 @@
+## <summary>E-mail security and anti-spam package for e-mail gateway systems.</summary>
+
+########################################
+## <summary>
+##	Create, read, write, and delete
+##	mscan spool content.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`mscan_manage_spool_content',`
+	gen_require(`
+		type mscan_spool_t;
+	')
+
+	files_search_spool($1)
+	manage_dirs_pattern($1, mscan_spool_t, mscan_spool_t)
+	manage_files_pattern($1, mscan_spool_t, mscan_spool_t)
+')
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an mscan environment
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`mscan_admin',`
+	gen_require(`
+		type mscan_t, mscan_etc_t, mscan_initrc_exec_t;
+		type mscan_var_run_t, mscan_spool_t;
+	')
+
+	allow $1 mscan_t:process { ptrace signal_perms };
+	ps_process_pattern($1, mscan_t)
+
+	init_labeled_script_domtrans($1, mscan_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 mscan_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	files_search_etc($1)
+	admin_pattern($1, mscan_etc_t)
+
+	files_search_pids($1
+	admin_pattern($1, mscan_var_run_t)
+
+	files_search_spool($1)
+	admin_pattern($1, mscan_spool_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/mailscanner.te refpolicy/policy/modules/contrib/mailscanner.te
--- refpolicy/policy/modules/contrib/mailscanner.te	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/mailscanner.te	2012-10-29 15:48:28.196186457 +0100
@@ -0,0 +1,101 @@
+policy_module(mailscanner, 1.0.2)
+
+########################################
+#
+# Declarations
+#
+
+type mscan_t;
+type mscan_exec_t;
+init_daemon_domain(mscan_t, mscan_exec_t)
+
+type mscan_initrc_exec_t;
+init_script_file(mscan_initrc_exec_t)
+
+type mscan_etc_t;
+files_config_file(mscan_etc_t)
+
+type mscan_spool_t;
+files_type(mscan_spool_t)
+
+type mscan_tmp_t;
+files_tmp_file(mscan_tmp_t)
+
+type mscan_var_run_t;
+files_pid_file(mscan_var_run_t)
+
+########################################
+#
+# Local policy
+#
+
+allow mscan_t self:capability { setuid chown setgid dac_override };
+allow mscan_t self:process signal;
+allow mscan_t self:fifo_file rw_fifo_file_perms;
+
+read_files_pattern(mscan_t, mscan_etc_t, mscan_etc_t)
+
+manage_files_pattern(mscan_t, mscan_var_run_t, mscan_var_run_t)
+files_pid_filetrans(mscan_t, mscan_var_run_t, file)
+
+manage_dirs_pattern(mscan_t, mscan_spool_t, mscan_spool_t)
+manage_files_pattern(mscan_t, mscan_spool_t, mscan_spool_t)
+files_spool_filetrans(mscan_t, mscan_spool_t, dir)
+
+manage_dirs_pattern(mscan_t, mscan_tmp_t, mscan_tmp_t)
+manage_files_pattern(mscan_t, mscan_tmp_t, mscan_tmp_t)
+files_tmp_filetrans(mscan_t, mscan_tmp_t, { dir file })
+
+can_exec(mscan_t, mscan_exec_t)
+
+kernel_read_system_state(mscan_t)
+
+corecmd_exec_bin(mscan_t)
+corecmd_exec_shell(mscan_t)
+
+corenet_all_recvfrom_netlabel(mscan_t)
+corenet_all_recvfrom_unlabeled(mscan_t)
+corenet_tcp_bind_generic_node(mscan_t)
+corenet_udp_bind_generic_node(mscan_t)
+corenet_tcp_sendrecv_generic_if(mscan_t)
+corenet_udp_sendrecv_generic_if(mscan_t)
+corenet_tcp_sendrecv_generic_node(mscan_t)
+corenet_udp_sendrecv_generic_node(mscan_t)
+
+corenet_sendrecv_trisoap_client_packets(mscan_t)
+corenet_tcp_connect_trisoap_port(mscan_t)
+corenet_tcp_sendrecv_trisoap_port(mscan_t)
+
+corenet_sendrecv_generic_server_packets(mscan_t)
+corenet_udp_bind_generic_port(mscan_t)
+corenet_udp_sendrecv_all_ports(mscan_t)
+
+dev_read_urand(mscan_t)
+
+files_read_usr_files(mscan_t)
+
+fs_getattr_xattr_fs(mscan_t)
+
+auth_dontaudit_read_shadow(mscan_t)
+auth_use_nsswitch(mscan_t)
+
+logging_send_syslog_msg(mscan_t)
+
+miscfiles_read_localization(mscan_t)
+
+optional_policy(`
+	clamav_domtrans_clamscan(mscan_t)
+')
+
+optional_policy(`
+	mta_send_mail(mscan_t)
+	mta_manage_queue(mscan_t)
+')
+
+optional_policy(`
+	procmail_domtrans(mscan_t)
+')
+
+optional_policy(`
+	spamassassin_read_lib_files(mscan_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/man2html.fc refpolicy/policy/modules/contrib/man2html.fc
--- refpolicy/policy/modules/contrib/man2html.fc	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/man2html.fc	2012-09-27 20:03:30.719126498 +0200
@@ -0,0 +1,5 @@
+/usr/lib/man2html/cgi-bin/man/man2html	--	gen_context(system_u:object_r:httpd_man2html_script_exec_t,s0)
+/usr/lib/man2html/cgi-bin/man/mansec	--	gen_context(system_u:object_r:httpd_man2html_script_exec_t,s0)
+/usr/lib/man2html/cgi-bin/man/manwhatis	--	gen_context(system_u:object_r:httpd_man2html_script_exec_t,s0)
+
+/var/cache/man2html(/.*)?	gen_context(system_u:object_r:httpd_man2html_script_cache_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/man2html.if refpolicy/policy/modules/contrib/man2html.if
--- refpolicy/policy/modules/contrib/man2html.if	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/man2html.if	2012-09-27 20:03:30.719126498 +0200
@@ -0,0 +1 @@
+## <summary>A Unix manpage-to-HTML converter.</summary>
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/man2html.te refpolicy/policy/modules/contrib/man2html.te
--- refpolicy/policy/modules/contrib/man2html.te	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/man2html.te	2012-09-27 20:03:30.719126498 +0200
@@ -0,0 +1,26 @@
+policy_module(man2html, 1.0.0)
+
+########################################
+#
+# Declarations
+#
+
+apache_content_template(man2html)
+
+type httpd_man2html_script_cache_t;
+files_type(httpd_man2html_script_cache_t)
+
+########################################
+#
+# Local policy
+#
+
+manage_dirs_pattern(httpd_man2html_script_t, httpd_man2html_script_cache_t, httpd_man2html_script_cache_t)
+manage_files_pattern(httpd_man2html_script_t, httpd_man2html_script_cache_t, httpd_man2html_script_cache_t)
+manage_lnk_files_pattern(httpd_man2html_script_t, httpd_man2html_script_cache_t, httpd_man2html_script_cache_t)
+files_var_filetrans(httpd_man2html_script_t, httpd_man2html_script_cache_t, dir)
+
+files_read_etc_files(httpd_man2html_script_t)
+
+miscfiles_read_localization(httpd_man2html_script_t)
+miscfiles_read_man_pages(httpd_man2html_script_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/mandb.fc refpolicy/policy/modules/contrib/mandb.fc
--- refpolicy/policy/modules/contrib/mandb.fc	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/mandb.fc	2012-10-31 19:06:52.680580698 +0100
@@ -0,0 +1 @@
+/etc/cron.daily/man-db\.cron	--	gen_context(system_u:object_r:mandb_exec_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/mandb.if refpolicy/policy/modules/contrib/mandb.if
--- refpolicy/policy/modules/contrib/mandb.if	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/mandb.if	2012-10-31 19:06:52.681580698 +0100
@@ -0,0 +1,135 @@
+## <summary>On-line manual database.</summary>
+
+########################################
+## <summary>
+##	Execute the mandb program in
+##	the mandb domain.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed to transition.
+##	</summary>
+## </param>
+#
+interface(`mandb_domtrans',`
+	gen_require(`
+		type mandb_t, mandb_exec_t;
+	')
+
+	corecmd_search_bin($1)
+	domtrans_pattern($1, mandb_exec_t, mandb_t)
+')
+
+########################################
+## <summary>
+##	Execute mandb in the mandb
+##	domain, and allow the specified
+##	role the mandb domain.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed to transition.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+#
+interface(`mandb_run',`
+	gen_require(`
+		attribute_role mandb_roles;
+	')
+
+	lightsquid_domtrans($1)
+	roleattribute $2 mandb_roles;
+')
+
+########################################
+## <summary>
+##	Search mandb cache directories.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`mandb_search_cache',`
+	refpolicywarn(`$0($*) has been deprecated')
+')
+
+########################################
+## <summary>
+##	Delete mandb cache content.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`mandb_delete_cache_content',`
+	refpolicywarn(`$0($*) has been deprecated')
+')
+
+########################################
+## <summary>
+##	Read mandb cache content.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`mandb_read_cache_content',`
+	refpolicywarn(`$0($*) has been deprecated')
+')
+
+########################################
+## <summary>
+##	Create, read, write, and delete
+##	mandb cache files.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`mandb_manage_cache_content',`
+	refpolicywarn(`$0($*) has been deprecated')
+')
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an mandb environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`mandb_admin',`
+	gen_require(`
+		type mandb_t, mandb_cache_t;
+	')
+
+	allow $1 mandb_t:process { ptrace signal_perms };
+	ps_process_pattern($1, mandb_t)
+
+	mandb_run($1, $2)
+
+	# pending
+	# miscfiles_manage_man_cache_content(mandb_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/mandb.te refpolicy/policy/modules/contrib/mandb.te
--- refpolicy/policy/modules/contrib/mandb.te	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/mandb.te	2012-10-31 19:06:52.681580698 +0100
@@ -0,0 +1,38 @@
+policy_module(mandb, 1.0.2)
+
+########################################
+#
+# Declarations
+#
+
+attribute_role mandb_roles;
+roleattribute system_r mandb_roles;
+
+type mandb_t;
+type mandb_exec_t;
+application_domain(mandb_t, mandb_exec_t)
+role mandb_roles types mandb_t;
+
+########################################
+#
+# Local policy
+#
+
+allow mandb_t self:process signal;
+allow mandb_t self:fifo_file rw_fifo_file_perms;
+allow mandb_t self:unix_stream_socket create_stream_socket_perms;
+
+kernel_read_system_state(mandb_t)
+
+corecmd_exec_bin(mandb_t)
+
+domain_use_interactive_fds(mandb_t)
+
+files_read_etc_files(mandb_t)
+
+# pending
+# miscfiles_manage_man_cache_content(mandb_t)
+
+optional_policy(`
+	cron_system_entry(mandb_t, mandb_exec_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/mcelog.fc refpolicy/policy/modules/contrib/mcelog.fc
--- refpolicy/policy/modules/contrib/mcelog.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/mcelog.fc	2012-10-11 18:00:48.376183276 +0200
@@ -1 +1,9 @@
+/etc/mcelog(/.*)?	gen_context(system_u:object_r:mcelog_etc_t,s0)
+
+/etc/rc\.d/init\.d/mcelog	--	gen_context(system_u:object_r:mcelog_initrc_exec_t,s0)
+
 /usr/sbin/mcelog	--	gen_context(system_u:object_r:mcelog_exec_t,s0)
+
+/var/log/mcelog.*	--	gen_context(system_u:object_r:mcelog_log_t,s0)
+
+/var/run/mcelog.*	gen_context(system_u:object_r:mcelog_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/mcelog.if refpolicy/policy/modules/contrib/mcelog.if
--- refpolicy/policy/modules/contrib/mcelog.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/mcelog.if	2012-10-11 18:00:48.376183276 +0200
@@ -1,4 +1,4 @@
-## <summary>policy for mcelog</summary>
+## <summary>Linux hardware error daemon.</summary>
 
 ########################################
 ## <summary>
@@ -15,6 +15,47 @@
 		type mcelog_t, mcelog_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, mcelog_exec_t, mcelog_t)
 ')
 
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an mcelog environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`mcelog_admin',`
+	gen_require(`
+		type mcelog_t, mcelog_initrc_exec_t, mcelog_log_t;
+		type mcelog_var_run_t, mcelog_etc_t;
+	')
+
+	allow $1 mcelog_t:process { ptrace signal_perms };
+	ps_process_pattern($1, mcelog_t)
+
+	init_labeled_script_domtrans($1, mcelog_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 mcelog_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	files_search_etc($1)
+	admin_pattern($1, mcelog_etc_t)
+
+	logging_search_logs($1)
+	admin_pattern($1, mcelog_log_t)
+
+	files_search_pids($1
+	admin_pattern($1, mcelog_var_run_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/mcelog.te refpolicy/policy/modules/contrib/mcelog.te
--- refpolicy/policy/modules/contrib/mcelog.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/mcelog.te	2012-10-11 18:00:48.377183276 +0200
@@ -1,32 +1,123 @@
-policy_module(mcelog, 1.1.0)
+policy_module(mcelog, 1.1.3)
 
 ########################################
 #
 # Declarations
 #
 
+## <desc>
+##	<p>
+##	Determine whether mcelog supports
+##	client mode.
+##	</p>
+## </desc>
+gen_tunable(mcelog_client, false)
+
+## <desc>
+##	<p>
+##	Determine whether mcelog can execute scripts.
+##	</p>
+## </desc>
+gen_tunable(mcelog_exec_scripts, true)
+
+## <desc>
+##	<p>
+##	Determine whether mcelog can use all
+##	the user ttys.
+##	</p>
+## </desc>
+gen_tunable(mcelog_foreground, false)
+
+## <desc>
+##	<p>
+##	Determine whether mcelog supports
+##	server mode.
+##	</p>
+## </desc>
+gen_tunable(mcelog_server, false)
+
+## <desc>
+##	<p>
+##	Determine whether mcelog can use syslog.
+##	</p>
+## </desc>
+gen_tunable(mcelog_syslog, false)
+
 type mcelog_t;
 type mcelog_exec_t;
-application_domain(mcelog_t, mcelog_exec_t)
-cron_system_entry(mcelog_t, mcelog_exec_t)
+init_daemon_domain(mcelog_t, mcelog_exec_t)
+application_executable_file(mcelog_exec_t)
+
+type mcelog_initrc_exec_t;
+init_script_file(mcelog_initrc_exec_t)
+
+type mcelog_etc_t;
+files_config_file(mcelog_etc_t)
+
+type mcelog_log_t;
+logging_log_file(mcelog_log_t)
+
+type mcelog_var_run_t;
+files_pid_file(mcelog_var_run_t)
 
 ########################################
 #
-# mcelog local policy
+# Local policy
 #
 
 allow mcelog_t self:capability sys_admin;
+allow mcelog_t self:unix_stream_socket connected_socket_perms;
+
+allow mcelog_t mcelog_etc_t:dir list_dir_perms;
+read_files_pattern(mcelog_t, mcelog_etc_t, mcelog_etc_t)
+
+manage_dirs_pattern(mcelog_t, mcelog_log_t, mcelog_log_t)
+append_files_pattern(mcelog_t, mcelog_log_t, mcelog_log_t)
+create_files_pattern(mcelog_t, mcelog_log_t, mcelog_log_t)
+setattr_files_pattern(mcelog_t, mcelog_log_t, mcelog_log_t)
+logging_log_filetrans(mcelog_t, mcelog_log_t, { dir file })
+
+manage_dirs_pattern(mcelog_t, mcelog_var_run_t, mcelog_var_run_t)
+manage_files_pattern(mcelog_t, mcelog_var_run_t, mcelog_var_run_t)
+manage_sock_files_pattern(mcelog_t, mcelog_var_run_t, mcelog_var_run_t)
+files_pid_filetrans(mcelog_t, mcelog_var_run_t, { dir file sock_file })
 
 kernel_read_system_state(mcelog_t)
 
 dev_read_raw_memory(mcelog_t)
 dev_read_kmsg(mcelog_t)
+dev_rw_sysfs(mcelog_t)
 
 files_read_etc_files(mcelog_t)
 
-# for /dev/mem access
 mls_file_read_all_levels(mcelog_t)
 
-logging_send_syslog_msg(mcelog_t)
+locallogin_use_fds(mcelog_t)
 
 miscfiles_read_localization(mcelog_t)
+
+tunable_policy(`mcelog_client',`
+	allow mcelog_t self:unix_stream_socket connectto;
+')
+
+tunable_policy(`mcelog_exec_scripts',`
+	allow mcelog_t self:fifo_file rw_fifo_file_perms;
+	corecmd_exec_bin(mcelog_t)
+	corecmd_exec_shell(mcelog_t)
+')
+
+tunable_policy(`mcelog_foreground',`
+	userdom_use_user_terminals(mcelog_t)
+')
+
+tunable_policy(`mcelog_server',`
+	allow mcelog_t self:unix_stream_socket { listen accept };
+')
+
+tunable_policy(`mcelog_syslog',`
+	logging_send_syslog_msg(mcelog_t)
+')
+
+optional_policy(`
+	cron_system_entry(mcelog_t, mcelog_exec_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/mediawiki.fc refpolicy/policy/modules/contrib/mediawiki.fc
--- refpolicy/policy/modules/contrib/mediawiki.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/mediawiki.fc	2012-10-11 18:00:50.565183281 +0200
@@ -1,8 +1,8 @@
 /usr/lib/mediawiki/math/texvc	--	gen_context(system_u:object_r:httpd_mediawiki_script_exec_t,s0)
-/usr/lib/mediawiki/math/texvc_tex --	gen_context(system_u:object_r:httpd_mediawiki_script_exec_t,s0)
-/usr/lib/mediawiki/math/texvc_tes --	gen_context(system_u:object_r:httpd_mediawiki_script_exec_t,s0)
+/usr/lib/mediawiki/math/texvc_tex	--	gen_context(system_u:object_r:httpd_mediawiki_script_exec_t,s0)
+/usr/lib/mediawiki/math/texvc_tes	--	gen_context(system_u:object_r:httpd_mediawiki_script_exec_t,s0)
 
-/usr/share/mediawiki(/.*)?		gen_context(system_u:object_r:httpd_mediawiki_content_t,s0)
+/usr/share/mediawiki(/.*)?	gen_context(system_u:object_r:httpd_mediawiki_content_t,s0)
 
-/var/www/wiki(/.*)?			gen_context(system_u:object_r:httpd_mediawiki_rw_content_t,s0)
-/var/www/wiki/.*\.php	--		gen_context(system_u:object_r:httpd_mediawiki_content_t,s0)
+/var/www/wiki(/.*)?	gen_context(system_u:object_r:httpd_mediawiki_rw_content_t,s0)
+/var/www/wiki/.*\.php	--	gen_context(system_u:object_r:httpd_mediawiki_content_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/mediawiki.if refpolicy/policy/modules/contrib/mediawiki.if
--- refpolicy/policy/modules/contrib/mediawiki.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/mediawiki.if	2012-10-11 18:00:53.186183287 +0200
@@ -1 +1 @@
-## <summary>Mediawiki policy</summary>
+## <summary>Open source wiki package written in PHP.</summary>
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/mediawiki.te refpolicy/policy/modules/contrib/mediawiki.te
--- refpolicy/policy/modules/contrib/mediawiki.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/mediawiki.te	2012-10-11 18:00:53.186183287 +0200
@@ -9,7 +9,7 @@
 
 ########################################
 #
-# mediawiki local policy
+# Local policy
 #
 
 files_search_var_lib(httpd_mediawiki_script_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/memcached.fc refpolicy/policy/modules/contrib/memcached.fc
--- refpolicy/policy/modules/contrib/memcached.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/memcached.fc	2012-10-11 18:00:57.495183296 +0200
@@ -1,5 +1,6 @@
 /etc/rc\.d/init\.d/memcached	--	gen_context(system_u:object_r:memcached_initrc_exec_t,s0)
 
-/usr/bin/memcached		--	gen_context(system_u:object_r:memcached_exec_t,s0)
+/usr/bin/memcached	--	gen_context(system_u:object_r:memcached_exec_t,s0)
 
-/var/run/memcached(/.*)?		gen_context(system_u:object_r:memcached_var_run_t,s0)
+/var/run/ipa_memcached(/.*)?	gen_context(system_u:object_r:memcached_var_run_t,s0)
+/var/run/memcached(/.*)?	gen_context(system_u:object_r:memcached_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/memcached.if refpolicy/policy/modules/contrib/memcached.if
--- refpolicy/policy/modules/contrib/memcached.if	2012-05-04 15:16:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/memcached.if	2012-10-11 18:00:57.495183296 +0200
@@ -1,4 +1,4 @@
-## <summary>high-performance memory object caching system</summary>
+## <summary>High-performance memory object caching system.</summary>
 
 ########################################
 ## <summary>
@@ -12,16 +12,36 @@
 #
 interface(`memcached_domtrans',`
 	gen_require(`
-		type memcached_t;
-		type memcached_exec_t;
+		type memcached_t,memcached_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, memcached_exec_t, memcached_t)
 ')
 
 ########################################
 ## <summary>
-##	Read memcached PID files.
+##	Create, read, write, and delete
+##	memcached pid files.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`memcached_manage_pid_files',`
+	gen_require(`
+		type memcached_var_run_t;
+	')
+
+	files_search_pids($1)
+	manage_files_pattern($1, memcached_var_run_t, memcached_var_run_t)
+')
+
+########################################
+## <summary>
+##	Read memcached pid files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -40,8 +60,49 @@
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate 
-##	an memcached environment
+##	Connect to memcached using a unix
+##	domain stream socket.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`memcached_stream_connect',`
+	gen_require(`
+		type memcached_t, memcached_var_run_t;
+	')
+
+	files_search_pids($1)
+	stream_connect_pattern($1, memcached_var_run_t, memcached_var_run_t, memcached_t)
+')
+
+########################################
+## <summary>
+## 	Connect to memcache over the network.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`memcached_tcp_connect',`
+	gen_require(`
+		type memcached_t;
+	')
+
+	corenet_sendrecv_memcache_client_packets($1)
+	corenet_tcp_connect_memcache_port($1)
+	corenet_tcp_recvfrom_labeled($1, memcached_t)
+	corenet_tcp_sendrecv_memcache_port($1)
+')
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an memcached environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -50,15 +111,14 @@
 ## </param>
 ## <param name="role">
 ##	<summary>
-##	The role to be allowed to manage the memcached domain.
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <rolecap/>
 #
 interface(`memcached_admin',`
 	gen_require(`
-		type memcached_t;
-		type memcached_initrc_exec_t;
+		type memcached_t, memcached_initrc_exec_t, memcached_var_run_t;
 	')
 
 	allow $1 memcached_t:process { ptrace signal_perms };
@@ -69,5 +129,6 @@
 	role_transition $2 memcached_initrc_exec_t system_r;
 	allow $2 system_r;
 
+	files_search_pids($1)
 	admin_pattern($1, memcached_var_run_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/memcached.te refpolicy/policy/modules/contrib/memcached.te
--- refpolicy/policy/modules/contrib/memcached.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/memcached.te	2012-10-11 18:00:57.496183296 +0200
@@ -1,4 +1,4 @@
-policy_module(memcached, 1.2.0)
+policy_module(memcached, 1.2.3)
 
 ########################################
 #
@@ -17,37 +17,39 @@
 
 ########################################
 #
-# memcached local policy
+# Local policy
 #
 
 allow memcached_t self:capability { setuid setgid };
 dontaudit memcached_t self:capability sys_tty_config;
 allow memcached_t self:process { setrlimit signal_perms };
-allow memcached_t self:tcp_socket create_stream_socket_perms;
-allow memcached_t self:udp_socket { create_socket_perms listen };
+allow memcached_t self:tcp_socket { accept listen };
+allow memcached_t self:udp_socket { accept listen };
 allow memcached_t self:fifo_file rw_fifo_file_perms;
 allow memcached_t self:unix_stream_socket create_stream_socket_perms;
 
-corenet_all_recvfrom_unlabeled(memcached_t)
-corenet_udp_sendrecv_generic_if(memcached_t)
-corenet_udp_sendrecv_generic_node(memcached_t)
-corenet_udp_sendrecv_all_ports(memcached_t)
-corenet_udp_bind_generic_node(memcached_t)
-corenet_tcp_sendrecv_generic_if(memcached_t)
-corenet_tcp_sendrecv_generic_node(memcached_t)
-corenet_tcp_sendrecv_all_ports(memcached_t)
-corenet_tcp_bind_generic_node(memcached_t)
-corenet_tcp_bind_memcache_port(memcached_t)
-corenet_udp_bind_memcache_port(memcached_t)
-
 manage_dirs_pattern(memcached_t, memcached_var_run_t, memcached_var_run_t)
 manage_files_pattern(memcached_t, memcached_var_run_t, memcached_var_run_t)
-files_pid_filetrans(memcached_t, memcached_var_run_t, { file dir })
+manage_sock_files_pattern(memcached_t, memcached_var_run_t, memcached_var_run_t)
+files_pid_filetrans(memcached_t, memcached_var_run_t, dir)
 
 kernel_read_kernel_sysctls(memcached_t)
 kernel_read_system_state(memcached_t)
 
-files_read_etc_files(memcached_t)
+corenet_all_recvfrom_unlabeled(memcached_t)
+corenet_all_recvfrom_netlabel(memcached_t)
+corenet_tcp_sendrecv_generic_if(memcached_t)
+corenet_udp_sendrecv_generic_if(memcached_t)
+corenet_tcp_sendrecv_generic_node(memcached_t)
+corenet_udp_sendrecv_generic_node(memcached_t)
+corenet_tcp_bind_generic_node(memcached_t)
+corenet_udp_bind_generic_node(memcached_t)
+
+corenet_sendrecv_memcache_server_packets(memcached_t)
+corenet_tcp_bind_memcache_port(memcached_t)
+corenet_tcp_sendrecv_all_ports(memcached_t)
+corenet_udp_bind_memcache_port(memcached_t)
+corenet_udp_sendrecv_all_ports(memcached_t)
 
 term_dontaudit_use_all_ptys(memcached_t)
 term_dontaudit_use_all_ttys(memcached_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/milter.fc refpolicy/policy/modules/contrib/milter.fc
--- refpolicy/policy/modules/contrib/milter.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/milter.fc	2012-10-11 18:03:58.678183683 +0200
@@ -1,15 +1,18 @@
 /usr/sbin/milter-greylist	--	gen_context(system_u:object_r:greylist_milter_exec_t,s0)
-/usr/sbin/milter-regex		--	gen_context(system_u:object_r:regex_milter_exec_t,s0)
+/usr/sbin/sqlgrey	--	gen_context(system_u:object_r:greylist_milter_exec_t,s0)
+/usr/sbin/milter-regex	--	gen_context(system_u:object_r:regex_milter_exec_t,s0)
 /usr/sbin/spamass-milter	--	gen_context(system_u:object_r:spamass_milter_exec_t,s0)
 
-/var/lib/milter-greylist(/.*)?		gen_context(system_u:object_r:greylist_milter_data_t,s0)
-/var/lib/spamass-milter(/.*)?		gen_context(system_u:object_r:spamass_milter_state_t,s0)
+/var/lib/milter-greylist(/.*)?	gen_context(system_u:object_r:greylist_milter_data_t,s0)
+/var/lib/sqlgrey(/.*)?	gen_context(system_u:object_r:greylist_milter_data_t,s0)
+/var/lib/spamass-milter(/.*)?	gen_context(system_u:object_r:spamass_milter_state_t,s0)
 
-/var/run/milter-greylist(/.*)?		gen_context(system_u:object_r:greylist_milter_data_t,s0)
+/var/run/milter-greylist(/.*)?	gen_context(system_u:object_r:greylist_milter_data_t,s0)
 /var/run/milter-greylist\.pid	--	gen_context(system_u:object_r:greylist_milter_data_t,s0)
-/var/run/spamass(/.*)?			gen_context(system_u:object_r:spamass_milter_data_t,s0)
-/var/run/spamass-milter(/.*)?		gen_context(system_u:object_r:spamass_milter_data_t,s0)
+/var/run/spamass(/.*)?	gen_context(system_u:object_r:spamass_milter_data_t,s0)
+/var/run/sqlgrey\.pid	--	gen_context(system_u:object_r:greylist_milter_data_t,s0)
+/var/run/spamass-milter(/.*)?	gen_context(system_u:object_r:spamass_milter_data_t,s0)
 /var/run/spamass-milter\.pid	--	gen_context(system_u:object_r:spamass_milter_data_t,s0)
 
-/var/spool/milter-regex(/.*)?		gen_context(system_u:object_r:regex_milter_data_t,s0)
+/var/spool/milter-regex(/.*)?	gen_context(system_u:object_r:regex_milter_data_t,s0)
 /var/spool/postfix/spamass(/.*)?	gen_context(system_u:object_r:spamass_milter_data_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/milter.if refpolicy/policy/modules/contrib/milter.if
--- refpolicy/policy/modules/contrib/milter.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/milter.if	2012-10-11 18:03:58.678183683 +0200
@@ -1,54 +1,47 @@
-## <summary>Milter mail filters</summary>
+## <summary>Milter mail filters.</summary>
 
-########################################
+#######################################
 ## <summary>
-##	Create a set of derived types for various
-##	mail filter applications using the milter interface.
+##	The template to define a milter domain.
 ## </summary>
-## <param name="milter_name">
+## <param name="domain_prefix">
 ##	<summary>
-##	The name to be used for deriving type names.
+##	Domain prefix to be used.
 ##	</summary>
 ## </param>
 #
 template(`milter_template',`
-	# attributes common to all milters
 	gen_require(`
 		attribute milter_data_type, milter_domains;
 	')
 
+	########################################
+	#
+	# Declarations
+	#
+
 	type $1_milter_t, milter_domains;
 	type $1_milter_exec_t;
 	init_daemon_domain($1_milter_t, $1_milter_exec_t)
-	role system_r types $1_milter_t;
 
-	# Type for the milter data (e.g. the socket used to communicate with the MTA)
 	type $1_milter_data_t, milter_data_type;
-	files_type($1_milter_data_t)
+	files_pid_file($1_milter_data_t)
 
-	allow $1_milter_t self:fifo_file rw_fifo_file_perms;
-	# Allow communication with MTA over a TCP socket
-	allow $1_milter_t self:tcp_socket create_stream_socket_perms;
-
-	# Allow communication with MTA over a unix-domain socket
-	manage_sock_files_pattern($1_milter_t, $1_milter_data_t, $1_milter_data_t)
+	########################################
+	#
+	# Policy
+	#
 
-	# Create other data files and directories in the data directory
 	manage_files_pattern($1_milter_t, $1_milter_data_t, $1_milter_data_t)
+	manage_sock_files_pattern($1_milter_t, $1_milter_data_t, $1_milter_data_t)
 
-	corenet_tcp_bind_generic_node($1_milter_t)
-	corenet_tcp_bind_milter_port($1_milter_t)
-
-	files_read_etc_files($1_milter_t)
-
-	miscfiles_read_localization($1_milter_t)
-
-	logging_send_syslog_msg($1_milter_t)
+	auth_use_nsswitch($1_milter_t)
 ')
 
 ########################################
 ## <summary>
-##	MTA communication with milter sockets
+##	connect to all milter domains using
+##	a unix domain stream socket.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -61,13 +54,13 @@
 		attribute milter_data_type, milter_domains;
 	')
 
-	getattr_dirs_pattern($1, milter_data_type, milter_data_type)
+	files_search_pids($1)
 	stream_connect_pattern($1, milter_data_type, milter_data_type, milter_domains)
 ')
 
 ########################################
 ## <summary>
-##	Allow getattr of milter sockets
+##	Get attributes of all  milter sock files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -80,13 +73,13 @@
 		attribute milter_data_type;
 	')
 
-	getattr_dirs_pattern($1, milter_data_type, milter_data_type)
 	getattr_sock_files_pattern($1, milter_data_type, milter_data_type)
 ')
 
 ########################################
 ## <summary>
-##	Manage spamassassin milter state
+##	Create, read, write, and delete
+##	spamassissin milter data content.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/milter.te refpolicy/policy/modules/contrib/milter.te
--- refpolicy/policy/modules/contrib/milter.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/milter.te	2012-10-11 18:03:58.678183683 +0200
@@ -1,96 +1,108 @@
-policy_module(milter, 1.4.0)
+policy_module(milter, 1.4.2)
 
 ########################################
 #
 # Declarations
 #
 
-# attributes common to all milters
 attribute milter_domains;
 attribute milter_data_type;
 
-# currently-supported milters are milter-greylist, milter-regex and spamass-milter
 milter_template(greylist)
 milter_template(regex)
 milter_template(spamass)
 
-# Type for the spamass-milter home directory, under which spamassassin will
-# store system-wide preferences, bayes databases etc. if not configured to
-# use per-user configuration
 type spamass_milter_state_t;
 files_type(spamass_milter_state_t)
 
+#######################################
+#
+# Common local policy
+#
+
+allow milter_domains self:fifo_file rw_fifo_file_perms;
+allow milter_domains self:tcp_socket { accept listen };
+
+kernel_dontaudit_read_system_state(milter_domains)
+
+corenet_all_recvfrom_unlabeled(milter_domains)
+corenet_all_recvfrom_netlabel(milter_domains)
+corenet_tcp_sendrecv_generic_if(milter_domains)
+corenet_tcp_sendrecv_generic_node(milter_domains)
+corenet_tcp_bind_generic_node(milter_domains)
+
+corenet_tcp_bind_milter_port(milter_domains)
+corenet_tcp_sendrecv_all_ports(milter_domains)
+
+miscfiles_read_localization(milter_domains)
+
+logging_send_syslog_msg(milter_domains)
+
 ########################################
 #
-# milter-greylist local policy
-#   ensure smtp clients retry mail like real MTAs and not spamware
-#   http://hcpnet.free.fr/milter-greylist/
+# greylist local policy
 #
 
-# It removes any existing socket (not owned by root) whilst running as root,
-# fixes permissions, renices itself and then calls setgid() and setuid() to
-# drop privileges
 allow greylist_milter_t self:capability { chown dac_override setgid setuid sys_nice };
 allow greylist_milter_t self:process { setsched getsched };
 
-# It creates a pid file /var/run/milter-greylist.pid
 files_pid_filetrans(greylist_milter_t, greylist_milter_data_t, file)
 
 kernel_read_kernel_sysctls(greylist_milter_t)
 
-# Allow the milter to read a GeoIP database in /usr/share
+corenet_sendrecv_movaz_ssc_server_packets(greylist_milter_t)
+corenet_tcp_bind_movaz_ssc_port(greylist_milter_t)
+corenet_sendrecv_movaz_ssc_client_packets(greylist_milter_t)
+corenet_tcp_connect_movaz_ssc_port(greylist_milter_t)
+corenet_tcp_sendrecv_movaz_ssc_port(greylist_milter_t)
+
+corenet_sendrecv_kismet_server_packets(greylist_milter_t)
+corenet_tcp_bind_kismet_port(greylist_milter_t)
+corenet_tcp_sendrecv_kismet_port(greylist_milter_t)
+
+corecmd_exec_bin(greylist_milter_t)
+corecmd_exec_shell(greylist_milter_t)
+
+dev_read_rand(greylist_milter_t)
+dev_read_urand(greylist_milter_t)
+
 files_read_usr_files(greylist_milter_t)
-# The milter runs from /var/lib/milter-greylist and maintains files there
 files_search_var_lib(greylist_milter_t)
 
-# Look up username for dropping privs
-auth_use_nsswitch(greylist_milter_t)
-
-# Config is in /etc/mail/greylist.conf
 mta_read_config(greylist_milter_t)
 
+miscfiles_read_localization(greylist_milter_t)
+
+optional_policy(`
+	mysql_stream_connect(greylist_milter_t)
+')
+
 ########################################
 #
-# milter-regex local policy
-#   filter emails using regular expressions
-#   http://www.benzedrine.cx/milter-regex.html
+# regex local policy
 #
 
-# It removes any existing socket (not owned by root) whilst running as root
-# and then calls setgid() and setuid() to drop privileges
 allow regex_milter_t self:capability { setuid setgid dac_override };
 
-# The milter's socket directory lives under /var/spool
 files_search_spool(regex_milter_t)
 
-# Look up username for dropping privs
-auth_use_nsswitch(regex_milter_t)
-
-# Config is in /etc/mail/milter-regex.conf
 mta_read_config(regex_milter_t)
 
 ########################################
 #
-# spamass-milter local policy
-#   pipe emails through SpamAssassin
-#   http://savannah.nongnu.org/projects/spamass-milt/
+# spamass local policy
 #
 
-# The milter runs from /var/lib/spamass-milter
 allow spamass_milter_t spamass_milter_state_t:dir search_dir_perms;
-files_search_var_lib(spamass_milter_t)
 
 kernel_read_system_state(spamass_milter_t)
 
-# When used with -b or -B options, the milter invokes sendmail to send mail
-# to a spamtrap address, using popen()
 corecmd_exec_shell(spamass_milter_t)
-corecmd_read_bin_symlinks(spamass_milter_t)
-corecmd_search_bin(spamass_milter_t)
+
+files_search_var_lib(spamass_milter_t)
 
 mta_send_mail(spamass_milter_t)
 
-# The main job of the milter is to pipe spam through spamc and act on the result
 optional_policy(`
 	spamassassin_domtrans_client(spamass_milter_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/modemmanager.if refpolicy/policy/modules/contrib/modemmanager.if
--- refpolicy/policy/modules/contrib/modemmanager.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/modemmanager.if	2012-10-11 18:03:59.983183685 +0200
@@ -15,6 +15,7 @@
 		type modemmanager_t, modemmanager_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, modemmanager_exec_t, modemmanager_t)
 ')
 
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/modemmanager.te refpolicy/policy/modules/contrib/modemmanager.te
--- refpolicy/policy/modules/contrib/modemmanager.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/modemmanager.te	2012-10-11 18:03:59.983183685 +0200
@@ -1,4 +1,4 @@
-policy_module(modemmanager, 1.1.0)
+policy_module(modemmanager, 1.1.1)
 
 ########################################
 #
@@ -7,17 +7,18 @@
 
 type modemmanager_t;
 type modemmanager_exec_t;
-dbus_system_domain(modemmanager_t, modemmanager_exec_t)
+init_daemon_domain(modemmanager_t, modemmanager_exec_t)
 typealias modemmanager_t alias ModemManager_t;
 typealias modemmanager_exec_t alias ModemManager_exec_t;
 
 ########################################
 #
-# ModemManager local policy
+# Local policy
 #
 
-allow modemmanager_t self:process signal;
-allow modemmanager_t self:fifo_file rw_file_perms;
+allow modemmanager_t self:capability { net_admin sys_admin sys_tty_config };
+allow modemmanager_t self:process { getsched signal };
+allow modemmanager_t self:fifo_file rw_fifo_file_perms;
 allow modemmanager_t self:unix_stream_socket create_stream_socket_perms;
 allow modemmanager_t self:netlink_kobject_uevent_socket create_socket_perms;
 
@@ -28,13 +29,28 @@
 
 files_read_etc_files(modemmanager_t)
 
+term_use_generic_ptys(modemmanager_t)
 term_use_unallocated_ttys(modemmanager_t)
 
 miscfiles_read_localization(modemmanager_t)
 
 logging_send_syslog_msg(modemmanager_t)
 
-networkmanager_dbus_chat(modemmanager_t)
+optional_policy(`
+	dbus_system_domain(modemmanager_t, modemmanager_exec_t)
+
+	optional_policy(`
+		devicekit_dbus_chat_power(modemmanager_t)
+	')
+
+	optional_policy(`
+		networkmanager_dbus_chat(modemmanager_t)
+	')
+
+	optional_policy(`
+		policykit_dbus_chat(modemmanager_t)
+	')
+')
 
 optional_policy(`
 	udev_read_db(modemmanager_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/mojomojo.fc refpolicy/policy/modules/contrib/mojomojo.fc
--- refpolicy/policy/modules/contrib/mojomojo.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/mojomojo.fc	2012-10-11 18:04:01.530183689 +0200
@@ -1,5 +1,5 @@
 /usr/bin/mojomojo_fastcgi\.pl	--	gen_context(system_u:object_r:httpd_mojomojo_script_exec_t,s0)
 
-/usr/share/mojomojo/root(/.*)?		gen_context(system_u:object_r:httpd_mojomojo_content_t,s0)
+/usr/share/mojomojo/root(/.*)?	gen_context(system_u:object_r:httpd_mojomojo_content_t,s0)
 
-/var/lib/mojomojo(/.*)?			gen_context(system_u:object_r:httpd_mojomojo_rw_content_t,s0)
+/var/lib/mojomojo(/.*)?	gen_context(system_u:object_r:httpd_mojomojo_rw_content_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/mojomojo.if refpolicy/policy/modules/contrib/mojomojo.if
--- refpolicy/policy/modules/contrib/mojomojo.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/mojomojo.if	2012-10-11 18:04:03.559183693 +0200
@@ -1,9 +1,9 @@
-## <summary>MojoMojo Wiki</summary>
+## <summary>MojoMojo Wiki.</summary>
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate
-##	an mojomojo environment
+##	All of the rules required to
+##	administrate an mojomojo environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -18,23 +18,6 @@
 ## <rolecap/>
 #
 interface(`mojomojo_admin',`
-	gen_require(`
-		type httpd_mojomojo_script_t;
-		type httpd_mojomojo_content_t, httpd_mojomojo_ra_content_t;
-		type httpd_mojomojo_rw_content_t;
-		type httpd_mojomojo_script_exec_t, httpd_mojomojo_htaccess_t;
-	')
-
-	allow $1 httpd_mojomojo_script_t:process { ptrace signal_perms };
-	ps_process_pattern($1, httpd_mojomojo_script_t)
-
-	files_search_var_lib(httpd_mojomojo_script_t)
-
-	apache_search_sys_content($1)
-	admin_pattern($1, httpd_mojomojo_script_exec_t)
-	admin_pattern($1, httpd_mojomojo_script_t)
-	admin_pattern($1, httpd_mojomojo_content_t)
-	admin_pattern($1, httpd_mojomojo_htaccess_t)
-	admin_pattern($1, httpd_mojomojo_rw_content_t)
-	admin_pattern($1, httpd_mojomojo_ra_content_t)
+	refpolicywarn(`$0($*) has been deprecated, use apache_admin() instead.')
+	apache_admin($1, $2)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/mojomojo.te refpolicy/policy/modules/contrib/mojomojo.te
--- refpolicy/policy/modules/contrib/mojomojo.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/mojomojo.te	2012-10-11 18:04:03.559183693 +0200
@@ -1,4 +1,4 @@
-policy_module(mojomojo, 1.0.0)
+policy_module(mojomojo, 1.0.1)
 
 ########################################
 #
@@ -9,16 +9,13 @@
 
 ########################################
 #
-# mojomojo local policy
+# Local policy
 #
 
 allow httpd_mojomojo_script_t httpd_t:unix_stream_socket rw_stream_socket_perms;
 
-corenet_tcp_connect_postgresql_port(httpd_mojomojo_script_t)
-corenet_tcp_connect_mysqld_port(httpd_mojomojo_script_t)
+corenet_sendrecv_smtp_client_packets(httpd_mojomojo_script_t)
 corenet_tcp_connect_smtp_port(httpd_mojomojo_script_t)
-corenet_sendrecv_postgresql_client_packets(httpd_mojomojo_script_t)
-corenet_sendrecv_mysqld_client_packets(httpd_mojomojo_script_t)
 corenet_sendrecv_smtp_client_packets(httpd_mojomojo_script_t)
 
 files_search_var_lib(httpd_mojomojo_script_t)
@@ -26,11 +23,3 @@
 sysnet_dns_name_resolve(httpd_mojomojo_script_t)
 
 mta_send_mail(httpd_mojomojo_script_t)
-
-optional_policy(`
-	mysql_stream_connect(httpd_mojomojo_script_t)
-')
-
-optional_policy(`
-	postgresql_stream_connect(httpd_mojomojo_script_t)
-')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/mongodb.fc refpolicy/policy/modules/contrib/mongodb.fc
--- refpolicy/policy/modules/contrib/mongodb.fc	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/mongodb.fc	2012-10-13 18:51:25.564558592 +0200
@@ -0,0 +1,9 @@
+/etc/rc\.d/init\.d/mongod	--	gen_context(system_u:object_r:mongod_initrc_exec_t,s0)
+
+/usr/bin/mongod	--	gen_context(system_u:object_r:mongod_exec_t,s0)
+
+/var/lib/mongo.*	gen_context(system_u:object_r:mongod_var_lib_t,s0)
+
+/var/log/mongo.*	gen_context(system_u:object_r:mongod_log_t,s0)
+
+/var/run/mongo.*	gen_context(system_u:object_r:mongod_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/mongodb.if refpolicy/policy/modules/contrib/mongodb.if
--- refpolicy/policy/modules/contrib/mongodb.if	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/mongodb.if	2012-09-27 20:03:30.719126498 +0200
@@ -0,0 +1,42 @@
+## <summary>Scalable, high-performance, open source NoSQL database.</summary>
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an mongodb environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`mongodb_admin',`
+	gen_require(`
+		type mongod_t, mongod_initrc_exec_t, mongod_log_t;
+		type mongod_var_lib_t, mongod_var_run_t;
+	')
+
+	allow $1 mongod_t:process { ptrace signal_perms };
+	ps_process_pattern($1, mongod_t)
+
+	init_labeled_script_domtrans($1, mongod_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 mongod_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	logging_search_logs($1)
+	admin_pattern($1, mongod_log_t)
+
+	files_search_var_lib($1)
+	admin_pattern($1, mongod_var_lib_t)
+
+	files_search_pids($1)
+	admin_pattern($1, mongod_var_run_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/mongodb.te refpolicy/policy/modules/contrib/mongodb.te
--- refpolicy/policy/modules/contrib/mongodb.te	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/mongodb.te	2012-10-28 18:58:41.221026401 +0100
@@ -0,0 +1,61 @@
+policy_module(mongodb, 1.0.2)
+
+########################################
+#
+# Declarations
+#
+
+type mongod_t;
+type mongod_exec_t;
+init_daemon_domain(mongod_t, mongod_exec_t)
+
+type mongod_initrc_exec_t;
+init_script_file(mongod_initrc_exec_t)
+
+type mongod_log_t;
+logging_log_file(mongod_log_t)
+
+type mongod_var_lib_t;
+files_type(mongod_var_lib_t)
+
+type mongod_var_run_t;
+files_pid_file(mongod_var_run_t)
+
+########################################
+#
+# Local policy
+#
+
+allow mongod_t self:process signal;
+allow mongod_t self:fifo_file rw_fifo_file_perms;
+
+manage_dirs_pattern(mongod_t, mongod_log_t, mongod_log_t)
+append_files_pattern(mongod_t, mongod_log_t, mongod_log_t)
+create_files_pattern(mongod_t, mongod_log_t, mongod_log_t)
+setattr_files_pattern(mongod_t, mongod_log_t, mongod_log_t)
+logging_log_filetrans(mongod_t, mongod_log_t, dir)
+
+manage_dirs_pattern(mongod_t, mongod_var_lib_t, mongod_var_lib_t)
+manage_files_pattern(mongod_t, mongod_var_lib_t, mongod_var_lib_t)
+files_var_lib_filetrans(mongod_t, mongod_var_lib_t, dir)
+
+manage_dirs_pattern(mongod_t, mongod_var_run_t, mongod_var_run_t)
+manage_files_pattern(mongod_t, mongod_var_run_t, mongod_var_run_t)
+files_pid_filetrans(mongod_t, mongod_var_run_t, dir)
+
+kernel_read_system_state(mongod_t)
+
+corenet_all_recvfrom_unlabeled(mongod_t)
+corenet_all_recvfrom_netlabel(mongod_t)
+corenet_tcp_sendrecv_generic_if(mongod_t)
+corenet_tcp_sendrecv_generic_node(mongod_t)
+corenet_tcp_bind_generic_node(mongod_t)
+
+dev_read_sysfs(mongod_t)
+dev_read_urand(mongod_t)
+
+files_read_etc_files(mongod_t)
+
+fs_getattr_all_fs(mongod_t)
+
+miscfiles_read_localization(mongod_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/mono.if refpolicy/policy/modules/contrib/mono.if
--- refpolicy/policy/modules/contrib/mono.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/mono.if	2012-10-13 18:52:12.385558692 +0200
@@ -29,10 +29,16 @@
 #
 template(`mono_role_template',`
 	gen_require(`
+		attribute mono_domain;
 		type mono_exec_t;
 	')
 
-	type $1_mono_t;
+	########################################
+	#
+	# Declarations
+	#
+
+	type $1_mono_t, mono_domain;
 	domain_type($1_mono_t)
 	domain_entry_file($1_mono_t, mono_exec_t)
 	role $2 types $1_mono_t;
@@ -40,25 +46,30 @@
 	domain_interactive_fd($1_mono_t)
 	application_type($1_mono_t)
 
-	allow $1_mono_t self:process { ptrace signal getsched execheap execmem execstack };
-
-	allow $3 $1_mono_t:process { getattr ptrace noatsecure signal_perms };
+	########################################
+	#
+	# Policy
+	#
 
 	domtrans_pattern($3, mono_exec_t, $1_mono_t)
 
-	fs_dontaudit_rw_tmpfs_files($1_mono_t)
-	corecmd_bin_domtrans($1_mono_t, $1_t)
+	allow $3 $1_mono_t:process { ptrace noatsecure signal_perms };
+	ps_process_pattern($2, $1_mono_t)
+
+	corecmd_bin_domtrans($1_mono_t, $3)
 
 	userdom_manage_user_tmpfs_files($1_mono_t)
 
 	optional_policy(`
+		fs_dontaudit_rw_tmpfs_files($1_mono_t)
+
 		xserver_role($1_r, $1_mono_t)
 	')
 ')
 
 ########################################
 ## <summary>
-##	Execute the mono program in the mono domain.
+##	Execute mono in the mono domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -93,16 +104,16 @@
 #
 interface(`mono_run',`
 	gen_require(`
-		type mono_t;
+		attribute_role mono_roles;
 	')
 
 	mono_domtrans($1)
-	role $2 types mono_t;
+	roleattribute $2 mono_roles;
 ')
 
 ########################################
 ## <summary>
-##	Execute the mono program in the caller domain.
+##	Execute mono in the caller domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -121,7 +132,7 @@
 
 ########################################
 ## <summary>
-##	Read and write to mono shared memory.
+##	Read and write mono shared memory.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/mono.te refpolicy/policy/modules/contrib/mono.te
--- refpolicy/policy/modules/contrib/mono.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/mono.te	2012-10-13 18:52:12.693557660 +0200
@@ -1,26 +1,37 @@
-policy_module(mono, 1.8.0)
+policy_module(mono, 1.8.1)
 
 ########################################
 #
 # Declarations
 #
 
-type mono_t;
+attribute mono_domain;
+
+attribute_role mono_roles;
+
+type mono_t, mono_domain;
 type mono_exec_t;
-application_type(mono_t)
 init_system_domain(mono_t, mono_exec_t)
+role mono_roles types mono_t;
+
+application_type(mono_t)
 
 ########################################
 #
-# Local policy
+# Common local policy
 #
 
-allow mono_t self:process { ptrace signal getsched execheap execmem execstack };
+allow mono_domain self:process { signal getsched execheap execmem execstack };
 
-init_dbus_chat_script(mono_t)
+########################################
+#
+# local policy
+#
 
 userdom_user_home_dir_filetrans_user_home_content(mono_t, { dir file lnk_file fifo_file sock_file })
 
+init_dbus_chat_script(mono_t)
+
 optional_policy(`
 	avahi_dbus_chat(mono_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/monop.fc refpolicy/policy/modules/contrib/monop.fc
--- refpolicy/policy/modules/contrib/monop.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/monop.fc	2012-10-13 18:53:20.051558700 +0200
@@ -1,4 +1,9 @@
+/etc/rc\.d/init\.d/monopd	--	gen_context(system_u:object_r:monopd_initrc_exec_t,s0)
+
 /etc/monopd\.conf	--	gen_context(system_u:object_r:monopd_etc_t,s0)
 
 /usr/sbin/monopd	--	gen_context(system_u:object_r:monopd_exec_t,s0)
+
 /usr/share/monopd/games(/.*)?	gen_context(system_u:object_r:monopd_share_t,s0)
+
+/var/run/monopd\.pid	--	gen_context(system_u:object_r:monopd_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/monop.if refpolicy/policy/modules/contrib/monop.if
--- refpolicy/policy/modules/contrib/monop.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/monop.if	2012-10-13 18:53:20.051558700 +0200
@@ -1 +1,42 @@
-## <summary>Monopoly daemon</summary>
+## <summary>Monopoly daemon.</summary>
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an monop environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`monop_admin',`
+	gen_require(`
+		type monopd_t, monopd_initrc_exec_t, monopd_share_t;
+		type monopd_etc_t, monopd_var_run_t;
+	')
+
+	allow $1 monopd_t:process { ptrace signal_perms };
+	ps_process_pattern($1, monopd_t)
+
+	init_labeled_script_domtrans($1, monopd_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 monopd_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	logging_search_etc($1)
+	admin_pattern($1, monopd_etc_t)
+
+	files_search_pids($1)
+	admin_pattern($1, monopd_var_run_t)
+
+	files_search_usr($1)
+	admin_pattern($1, monopd_share_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/monop.te refpolicy/policy/modules/contrib/monop.te
--- refpolicy/policy/modules/contrib/monop.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/monop.te	2012-10-13 18:53:20.061558809 +0200
@@ -1,4 +1,4 @@
-policy_module(monop, 1.7.0)
+policy_module(monop, 1.7.1)
 
 ########################################
 #
@@ -9,6 +9,9 @@
 type monopd_exec_t;
 init_daemon_domain(monopd_t, monopd_exec_t)
 
+type monopd_initrc_exec_t;
+init_script_file(monopd_initrc_exec_t)
+
 type monopd_etc_t;
 files_config_file(monopd_etc_t)
 
@@ -25,11 +28,9 @@
 
 dontaudit monopd_t self:capability sys_tty_config;
 allow monopd_t self:process signal_perms;
-allow monopd_t self:tcp_socket create_stream_socket_perms;
-allow monopd_t self:udp_socket create_socket_perms;
+allow monopd_t self:tcp_socket { accept listen };
 
 allow monopd_t monopd_etc_t:file read_file_perms;
-files_search_etc(monopd_t)
 
 allow monopd_t monopd_share_t:dir list_dir_perms;
 read_files_pattern(monopd_t, monopd_share_t, monopd_share_t)
@@ -45,14 +46,12 @@
 corenet_all_recvfrom_unlabeled(monopd_t)
 corenet_all_recvfrom_netlabel(monopd_t)
 corenet_tcp_sendrecv_generic_if(monopd_t)
-corenet_udp_sendrecv_generic_if(monopd_t)
 corenet_tcp_sendrecv_generic_node(monopd_t)
-corenet_udp_sendrecv_generic_node(monopd_t)
-corenet_tcp_sendrecv_all_ports(monopd_t)
-corenet_udp_sendrecv_all_ports(monopd_t)
 corenet_tcp_bind_generic_node(monopd_t)
-corenet_tcp_bind_monopd_port(monopd_t)
+
 corenet_sendrecv_monopd_server_packets(monopd_t)
+corenet_tcp_bind_monopd_port(monopd_t)
+corenet_tcp_sendrecv_monopd_port(monopd_t)
 
 dev_read_sysfs(monopd_t)
 
@@ -67,7 +66,7 @@
 
 miscfiles_read_localization(monopd_t)
 
-sysnet_read_config(monopd_t)
+sysnet_dns_name_resolve(monopd_t)
 
 userdom_dontaudit_use_unpriv_user_fds(monopd_t)
 userdom_dontaudit_search_user_home_dirs(monopd_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/mozilla.fc refpolicy/policy/modules/contrib/mozilla.fc
--- refpolicy/policy/modules/contrib/mozilla.fc	2012-05-04 16:18:26.000000000 +0200
+++ refpolicy/policy/modules/contrib/mozilla.fc	2012-10-17 19:36:49.135198553 +0200
@@ -1,33 +1,37 @@
-HOME_DIR/\.config/chromium(/.*)?	gen_context(system_u:object_r:mozilla_home_t,s0)
-HOME_DIR/\.galeon(/.*)?			gen_context(system_u:object_r:mozilla_home_t,s0)
-HOME_DIR/\.java(/.*)?			gen_context(system_u:object_r:mozilla_home_t,s0)
-HOME_DIR/\.mozilla(/.*)?		gen_context(system_u:object_r:mozilla_home_t,s0)
-HOME_DIR/\.netscape(/.*)?		gen_context(system_u:object_r:mozilla_home_t,s0)
-HOME_DIR/\.phoenix(/.*)?		gen_context(system_u:object_r:mozilla_home_t,s0)
+HOME_DIR/\.galeon(/.*)?	gen_context(system_u:object_r:mozilla_home_t,s0)
+HOME_DIR/\.mozilla(/.*)?	gen_context(system_u:object_r:mozilla_home_t,s0)
+HOME_DIR/\.mozilla/plugins(/.*)?	gen_context(system_u:object_r:mozilla_plugin_home_t,s0)
+HOME_DIR/\.netscape(/.*)?	gen_context(system_u:object_r:mozilla_home_t,s0)
+HOME_DIR/\.phoenix(/.*)?	gen_context(system_u:object_r:mozilla_home_t,s0)
 
-#
-# /bin
-#
-/usr/bin/netscape		--	gen_context(system_u:object_r:mozilla_exec_t,s0)
-/usr/bin/mozilla		--	gen_context(system_u:object_r:mozilla_exec_t,s0)
+/usr/bin/epiphany	--	gen_context(system_u:object_r:mozilla_exec_t,s0)
+/usr/bin/epiphany-bin	--	gen_context(system_u:object_r:mozilla_exec_t,s0)
+/usr/bin/mozilla	--	gen_context(system_u:object_r:mozilla_exec_t,s0)
 /usr/bin/mozilla-snapshot	--	gen_context(system_u:object_r:mozilla_exec_t,s0)
-/usr/bin/epiphany-bin		--	gen_context(system_u:object_r:mozilla_exec_t,s0)
-/usr/bin/epiphany		--	gen_context(system_u:object_r:mozilla_exec_t,s0)
+/usr/bin/firefox-bin	--	gen_context(system_u:object_r:mozilla_exec_t,s0)
 /usr/bin/mozilla-[0-9].*	--	gen_context(system_u:object_r:mozilla_exec_t,s0)
 /usr/bin/mozilla-bin-[0-9].*	--	gen_context(system_u:object_r:mozilla_exec_t,s0)
+/usr/bin/netscape	--	gen_context(system_u:object_r:mozilla_exec_t,s0)
+/usr/bin/nspluginscan	--	gen_context(system_u:object_r:mozilla_plugin_exec_t,s0)
+/usr/bin/nspluginviewer	--	gen_context(system_u:object_r:mozilla_plugin_exec_t,s0)
 
-ifdef(`distro_debian',`
+/usr/lib/[^/]*firefox[^/]*/firefox --	gen_context(system_u:object_r:mozilla_exec_t,s0)
+/usr/lib/[^/]*firefox[^/]*/firefox-bin -- gen_context(system_u:object_r:mozilla_exec_t,s0)
+/usr/lib/firefox[^/]*/mozilla-.* --	gen_context(system_u:object_r:mozilla_exec_t,s0)
+/usr/lib/galeon/galeon	--	gen_context(system_u:object_r:mozilla_exec_t,s0)
 /usr/lib/iceweasel/iceweasel	--	gen_context(system_u:object_r:mozilla_exec_t,s0)
-')
-
-#
-# /lib
-#
-/usr/lib/galeon/galeon		--	gen_context(system_u:object_r:mozilla_exec_t,s0)
-/usr/lib/netscape/.+/communicator/communicator-smotif\.real -- gen_context(system_u:object_r:mozilla_exec_t,s0)
-/usr/lib/netscape/base-4/wrapper --	gen_context(system_u:object_r:mozilla_exec_t,s0)
 /usr/lib/mozilla[^/]*/reg.+	--	gen_context(system_u:object_r:mozilla_exec_t,s0)
 /usr/lib/mozilla[^/]*/mozilla-.* --	gen_context(system_u:object_r:mozilla_exec_t,s0)
-/usr/lib/firefox[^/]*/mozilla-.* --	gen_context(system_u:object_r:mozilla_exec_t,s0)
-/usr/lib/[^/]*firefox[^/]*/firefox-bin -- gen_context(system_u:object_r:mozilla_exec_t,s0)
-/usr/lib/[^/]*firefox[^/]*/firefox --	gen_context(system_u:object_r:mozilla_exec_t,s0)
+/usr/lib/mozilla/plugins-wrapped(/.*)?	gen_context(system_u:object_r:mozilla_plugin_rw_t,s0)
+/usr/lib/netscape/base-4/wrapper	--	gen_context(system_u:object_r:mozilla_exec_t,s0)
+/usr/lib/netscape/.+/communicator/communicator-smotif\.real -- gen_context(system_u:object_r:mozilla_exec_t,s0)
+/usr/lib/nspluginwrapper/npviewer.bin	--	gen_context(system_u:object_r:mozilla_plugin_exec_t,s0)
+/usr/lib/nspluginwrapper/plugin-config	--	gen_context(system_u:object_r:mozilla_plugin_config_exec_t,s0)
+/usr/lib/xulrunner[^/]*/plugin-container	--	gen_context(system_u:object_r:mozilla_plugin_exec_t,s0)
+/usr/lib/[^/]*firefox[^/]*/plugin-container	--	gen_context(system_u:object_r:mozilla_plugin_exec_t,s0)
+
+/opt/firefox/libxul\.so	--	gen_context(system_u:object_r:textrel_shlib_t,s0)
+/opt/firefox/firefox	--	gen_context(system_u:object_r:mozilla_exec_t,s0)
+/opt/firefox/run-mozilla\.sh	--	gen_context(system_u:object_r:mozilla_exec_t,s0)
+/opt/firefox/firefox-bin	--	gen_context(system_u:object_r:mozilla_exec_t,s0)
+/opt/firefox/plugin-container	--	gen_context(system_u:object_r:mozilla_plugin_exec_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/mozilla.if refpolicy/policy/modules/contrib/mozilla.if
--- refpolicy/policy/modules/contrib/mozilla.if	2012-05-04 17:06:48.000000000 +0200
+++ refpolicy/policy/modules/contrib/mozilla.if	2012-10-22 19:58:40.323013924 +0200
@@ -1,58 +1,167 @@
-## <summary>Policy for Mozilla and related web browsers</summary>
+## <summary>Policy for Mozilla and related web browsers.</summary>
 
 ########################################
 ## <summary>
-##	Role access for mozilla
+##	Role access for mozilla.
 ## </summary>
 ## <param name="role">
 ##	<summary>
-##	Role allowed access
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <param name="domain">
 ##	<summary>
-##	User domain for the role
+##	User domain for the role.
 ##	</summary>
 ## </param>
 #
 interface(`mozilla_role',`
 	gen_require(`
 		type mozilla_t, mozilla_exec_t, mozilla_home_t;
+		type mozilla_tmp_t, mozilla_tmpfs_t, mozilla_plugin_tmp_t;
+		type mozilla_plugin_tmpfs_t, mozilla_plugin_home_t;
 		attribute_role mozilla_roles;
 	')
 
+	########################################
+	#
+	# Declarations
+	#
+
 	roleattribute $1 mozilla_roles;
 
-	domain_auto_trans($2, mozilla_exec_t, mozilla_t)
-	# Unrestricted inheritance from the caller.
-	allow $2 mozilla_t:process { noatsecure siginh rlimitinh };
-	allow mozilla_t $2:fd use;
-	allow mozilla_t $2:process { sigchld signull };
-	allow mozilla_t $2:unix_stream_socket connectto;
+	########################################
+	#
+	# Policy
+	#
 
-	# Allow the user domain to signal/ps.
+	domtrans_pattern($2, mozilla_exec_t, mozilla_t)
+
+	allow $2 mozilla_t:process { noatsecure siginh rlimitinh ptrace signal_perms };
 	ps_process_pattern($2, mozilla_t)
-	allow $2 mozilla_t:process signal_perms;
+
+	allow mozilla_t $2:process signull;
+	allow mozilla_t $2:unix_stream_socket connectto;
 
 	allow $2 mozilla_t:fd use;
-	allow $2 mozilla_t:shm { associate getattr };
-	allow $2 mozilla_t:shm { unix_read unix_write };
-	allow $2 mozilla_t:unix_stream_socket connectto;
+	allow $2 mozilla_t:shm rw_shm_perms;
+
+	stream_connect_pattern($2, mozilla_tmpfs_t, mozilla_tmpfs_t, mozilla_t)
+
+	allow $2 { mozilla_home_t mozilla_plugin_home_t }:dir { manage_dir_perms relabel_dir_perms };
+	allow $2 { mozilla_home_t mozilla_plugin_home_t }:file { manage_file_perms relabel_file_perms };
+	allow $2 mozilla_home_t:lnk_file { manage_lnk_file_perms relabel_lnk_file_perms };
+	userdom_user_home_dir_filetrans($2, mozilla_home_t, dir, ".galeon")
+	userdom_user_home_dir_filetrans($2, mozilla_home_t, dir, ".mozilla")
+	userdom_user_home_dir_filetrans($2, mozilla_home_t, dir, ".netscape")
+	userdom_user_home_dir_filetrans($2, mozilla_home_t, dir, ".phoenix")
+
+	filetrans_pattern($2, mozilla_home_t, mozilla_plugin_home_t, dir, "plugins")
+
+	allow $2 { mozilla_tmp_t mozilla_plugin_tmp_t }:dir { manage_dir_perms relabel_dir_perms };
+	allow $2 { mozilla_tmp_t mozilla_plugin_tmp_t }:file { manage_file_perms relabel_file_perms };
+	allow $2 mozilla_plugin_tmp_t:fifo_file { manage_fifo_file_perms relabel_fifo_file_perms };
+
+	allow $2 { mozilla_tmpfs_t mozilla_plugin_tmpfs_t }:dir { manage_dir_perms relabel_dir_perms };
+	allow $2 { mozilla_tmpfs_t mozilla_plugin_tmpfs_t }:file { manage_file_perms relabel_file_perms };
+	allow $2 { mozilla_tmpfs_t mozilla_plugin_tmpfs_t }:fifo_file { manage_fifo_file_perms relabel_fifo_file_perms };
+	allow $2 { mozilla_tmpfs_t mozilla_plugin_tmpfs_t }:sock_file { manage_sock_file_perms relabel_sock_file_perms };
+
+	optional_policy(`
+		mozilla_dbus_chat($2)
+	')
+')
+
+########################################
+## <summary>
+##	Role access for mozilla plugin.
+## </summary>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <param name="domain">
+##	<summary>
+##	User domain for the role.
+##	</summary>
+## </param>
+#
+interface(`mozilla_role_plugin',`
+	gen_require(`
+		type mozilla_plugin_tmp_t, mozilla_plugin_tmpfs_t, mozilla_plugin_rw_t;
+		type mozilla_home_t;
+	')
+
+	mozilla_run_plugin($2, $1)
+	mozilla_run_plugin_config($2, $1)
+
+	allow $2 { mozilla_plugin_t mozilla_plugin_config_t }:process { ptrace signal_perms };
+	ps_process_pattern($2, { mozilla_plugin_t mozilla_plugin_config_t })
+
+	allow $2 mozilla_plugin_t:unix_stream_socket rw_socket_perms;
+	allow $2 mozilla_plugin_t:fd use;
+
+	stream_connect_pattern($2, mozilla_plugin_tmpfs_t, mozilla_plugin_tmpfs_t, mozilla_plugin_t)
+
+	allow mozilla_plugin_t $2:process signull;
+	allow mozilla_plugin_t $2:unix_stream_socket { connectto rw_socket_perms };
+	allow mozilla_plugin_t $2:unix_dgram_socket { sendto rw_socket_perms };
+	allow mozilla_plugin_t $2:shm { rw_shm_perms destroy };
+	allow mozilla_plugin_t $2:sem create_sem_perms;
+
+	allow $2 mozilla_home_t:dir { manage_dir_perms relabel_dir_perms };
+	allow $2 mozilla_home_t:file { manage_file_perms relabel_file_perms };
+	allow $2 mozilla_home_t:lnk_file { manage_lnk_file_perms relabel_lnk_file_perms };
+	userdom_user_home_dir_filetrans($2, mozilla_home_t, dir, ".galeon")
+	userdom_user_home_dir_filetrans($2, mozilla_home_t, dir, ".mozilla")
+	userdom_user_home_dir_filetrans($2, mozilla_home_t, dir, ".netscape")
+	userdom_user_home_dir_filetrans($2, mozilla_home_t, dir, ".phoenix")
+
+	allow $2 mozilla_plugin_tmp_t:dir { manage_dir_perms relabel_dir_perms };
+	allow $2 mozilla_plugin_tmp_t:file { manage_file_perms relabel_file_perms };
+	allow $2 mozilla_plugin_tmp_t:fifo_file { manage_fifo_file_perms relabel_fifo_file_perms };
+
+	allow $2 mozilla_plugin_tmpfs_t:dir { manage_dir_perms relabel_dir_perms };
+	allow $2 mozilla_plugin_tmpfs_t:file { manage_file_perms relabel_file_perms };
+	allow $2 mozilla_plugin_tmpfs_t:fifo_file { manage_fifo_file_perms relabel_fifo_file_perms };
+	allow $2 mozilla_plugin_tmpfs_t:sock_file { manage_sock_file_perms relabel_sock_file_perms };
+
+	allow $2 mozilla_plugin_rw_t:dir list_dir_perms;
+	allow $2 mozilla_plugin_rw_t:file read_file_perms;
+	allow $2 mozilla_plugin_rw_t:lnk_file read_lnk_file_perms;
+
+	can_exec($2, mozilla_plugin_rw_t)
 
-	# X access, Home files
-	manage_dirs_pattern($2, mozilla_home_t, mozilla_home_t)
-	manage_files_pattern($2, mozilla_home_t, mozilla_home_t)
-	manage_lnk_files_pattern($2, mozilla_home_t, mozilla_home_t)
-	relabel_dirs_pattern($2, mozilla_home_t, mozilla_home_t)
-	relabel_files_pattern($2, mozilla_home_t, mozilla_home_t)
-	relabel_lnk_files_pattern($2, mozilla_home_t, mozilla_home_t)
+	optional_policy(`
+		mozilla_dbus_chat_plugin($2)
+	')
+')
+
+########################################
+## <summary>
+##	Read mozilla home directory content.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`mozilla_read_user_home',`
+	gen_require(`
+		type mozilla_home_t;
+	')
 
-	mozilla_dbus_chat($2)
+	list_dirs_pattern($1, mozilla_home_t, mozilla_home_t)
+	read_files_pattern($1, mozilla_home_t, mozilla_home_t)
+	userdom_search_user_home_dirs($1)
 ')
 
+
 ########################################
 ## <summary>
-##	Read mozilla home directory content
+##	Read mozilla home directory files
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -65,15 +174,15 @@
 		type mozilla_home_t;
 	')
 
+	userdom_search_user_home_dirs($1)
 	allow $1 mozilla_home_t:dir list_dir_perms;
 	allow $1 mozilla_home_t:file read_file_perms;
 	allow $1 mozilla_home_t:lnk_file read_lnk_file_perms;
-	userdom_search_user_home_dirs($1)
 ')
 
 ########################################
 ## <summary>
-##	Write mozilla home directory content
+##	Write mozilla home directory files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -86,13 +195,14 @@
 		type mozilla_home_t;
 	')
 
-	write_files_pattern($1, mozilla_home_t, mozilla_home_t)
 	userdom_search_user_home_dirs($1)
+	write_files_pattern($1, mozilla_home_t, mozilla_home_t)
 ')
 
 ########################################
 ## <summary>
-##	Dontaudit attempts to read/write mozilla home directory content
+##	Do not audit attempts to read and
+##	write mozilla home directory files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -110,7 +220,9 @@
 
 ########################################
 ## <summary>
-##	Dontaudit attempts to write mozilla home directory content
+##	Do not audit attempt to Create,
+##	read, write, and delete mozilla
+##	home directory content.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -125,11 +237,12 @@
 
 	dontaudit $1 mozilla_home_t:dir manage_dir_perms;
 	dontaudit $1 mozilla_home_t:file manage_file_perms;
+	dontaudit $1 mozilla_home_t:lnk_file manage_lnk_file_perms;
 ')
 
 ########################################
 ## <summary>
-##	Execute mozilla home directory content.
+##	Execute mozilla home directory files.  (Deprecated)
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -138,16 +251,33 @@
 ## </param>
 #
 interface(`mozilla_exec_user_home_files',`
+	refpolicywarn(`$0($*) has been deprecated, use mozilla_exec_user_plugin_home_files() instead.')
+	mozilla_exec_user_plugin_home_files($1)
+')
+
+########################################
+## <summary>
+##	Execute mozilla plugin home directory files.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`mozilla_exec_user_plugin_home_files',`
 	gen_require(`
-		type mozilla_home_t;
+		type mozilla_home_t, mozilla_plugin_home_t;
 	')
 
-	can_exec($1, mozilla_home_t)
+	userdom_search_user_home_dirs($1)
+	exec_files_pattern($1, { mozilla_home_t mozilla_plugin_home_t }, mozilla_plugin_home_t)
 ')
 
 ########################################
 ## <summary>
-##	Execmod mozilla home directory content.
+##	Mozilla home directory file
+##	text relocation.  (Deprecated)
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -156,11 +286,27 @@
 ## </param>
 #
 interface(`mozilla_execmod_user_home_files',`
+	refpolicywarn(`$0($*) has been deprecated, use mozilla_execmod_user_plugin_home_files() instead.')
+	mozilla_execmod_user_plugin_home_files($1)
+')
+
+########################################
+## <summary>
+##	Mozilla plugin home directory file
+##	text relocation.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`mozilla_execmod_user_plugin_home_files',`
 	gen_require(`
-		type mozilla_home_t;
+		type mozilla_plugin_home_t;
 	')
 
-	allow $1 mozilla_home_t:file execmod;
+	allow $1 mozilla_plugin_home_t:file execmod;
 ')
 
 ########################################
@@ -178,52 +324,102 @@
 		type mozilla_t, mozilla_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, mozilla_exec_t, mozilla_t)
 ')
 
 ########################################
 ## <summary>
-##	Execute a domain transition to run mozilla_plugin.
+##	Execute a domain transition to
+##	run mozilla plugin.
 ## </summary>
 ## <param name="domain">
 ## <summary>
-##	Domain allowed access.
+##	Domain allowed to transition.
 ## </summary>
 ## </param>
 #
 interface(`mozilla_domtrans_plugin',`
 	gen_require(`
-		type mozilla_plugin_t, mozilla_plugin_exec_t, mozilla_plugin_tmpfs_t;
-		class dbus send_msg;
+		type mozilla_plugin_t, mozilla_plugin_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, mozilla_plugin_exec_t, mozilla_plugin_t)
-	allow mozilla_plugin_t $1:process signull;
 ')
 
 ########################################
 ## <summary>
-##	Execute mozilla_plugin in the mozilla_plugin domain, and
-##	allow the specified role the mozilla_plugin domain.
+##	Execute mozilla plugin in the
+##	mozilla plugin domain, and allow
+##	the specified role the mozilla
+##	plugin domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
-##	Domain allowed access
+##	Domain allowed to transition.
 ##	</summary>
 ## </param>
 ## <param name="role">
 ##	<summary>
-##	The role to be allowed the mozilla_plugin domain.
+##	Role allowed access.
 ##	</summary>
 ## </param>
 #
 interface(`mozilla_run_plugin',`
 	gen_require(`
-		type mozilla_plugin_t;
+		attribute_role mozilla_plugin_roles;
 	')
 
 	mozilla_domtrans_plugin($1)
-	role $2 types mozilla_plugin_t;
+	roleattribute $2 mozilla_plugin_roles;
+')
+
+########################################
+## <summary>
+##	Execute a domain transition to
+##	run mozilla plugin config.
+## </summary>
+## <param name="domain">
+## <summary>
+##	Domain allowed to transition.
+## </summary>
+## </param>
+#
+interface(`mozilla_domtrans_plugin_config',`
+	gen_require(`
+		type mozilla_plugin_config_t, mozilla_plugin_config_exec_t;
+	')
+
+	corecmd_search_bin($1)
+	domtrans_pattern($1, mozilla_plugin_config_exec_t, mozilla_plugin_config_t)
+')
+
+########################################
+## <summary>
+##	Execute mozilla plugin config in
+##	the mozilla plugin config domain,
+##	and allow the specified role the
+##	mozilla plugin config domain.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed to transition.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+#
+interface(`mozilla_run_plugin_config',`
+	gen_require(`
+		attribute_role mozilla_plugin_config_roles;
+	')
+
+	mozilla_domtrans_plugin_config($1)
+	roleattribute $2 mozilla_plugin_config_roles;
 ')
 
 ########################################
@@ -249,7 +445,28 @@
 
 ########################################
 ## <summary>
-##	read/write mozilla per user tcp_socket
+##	Send and receive messages from
+##	mozilla plugin over dbus.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`mozilla_dbus_chat_plugin',`
+	gen_require(`
+		type mozilla_plugin_t;
+		class dbus send_msg;
+	')
+
+	allow $1 mozilla_plugin_t:dbus send_msg;
+	allow mozilla_plugin_t $1:dbus send_msg;
+')
+
+########################################
+## <summary>
+##	Read and write mozilla TCP sockets.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -267,11 +484,31 @@
 
 ########################################
 ## <summary>
-##	Read mozilla_plugin tmpfs files
+##	Create, read, write, and delete
+##	mozilla plugin rw files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
-##	Domain allowed access
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`mozilla_manage_plugin_rw_files',`
+	gen_require(`
+		type mozilla_plugin_rw_t;
+	')
+
+	libs_search_lib($1)
+	manage_files_pattern($1, mozilla_plugin_rw_t, mozilla_plugin_rw_t)
+')
+
+########################################
+## <summary>
+##	Read mozilla_plugin tmpfs files.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
 ##	</summary>
 ## </param>
 #
@@ -280,16 +517,17 @@
 		type mozilla_plugin_tmpfs_t;
 	')
 
+	fs_search_tmpfs($1)
 	allow $1 mozilla_plugin_tmpfs_t:file read_file_perms;
 ')
 
 ########################################
 ## <summary>
-##	Delete mozilla_plugin tmpfs files
+##	Delete mozilla_plugin tmpfs files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
-##	Domain allowed access
+##	Domain allowed access.
 ##	</summary>
 ## </param>
 #
@@ -298,5 +536,78 @@
 		type mozilla_plugin_tmpfs_t;
 	')
 
-	allow $1 mozilla_plugin_tmpfs_t:file unlink;
+	fs_search_tmpfs($1)
+	allow $1 mozilla_plugin_tmpfs_t:file delete_file_perms;
+')
+
+########################################
+## <summary>
+##	Read/write to mozilla's tmp fifo files
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access
+##	</summary>
+## </param>
+#
+interface(`mozilla_rw_tmp_pipes',`
+	gen_require(`
+		type mozilla_tmp_t;
+	')
+
+	rw_fifo_files_pattern($1, mozilla_tmp_t, mozilla_tmp_t)
+')
+
+########################################
+## <summary>
+##	Create, read, write, and delete
+##	generic mozilla plugin home content.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`mozilla_manage_generic_plugin_home_content',`
+	gen_require(`
+		type mozilla_plugin_home_t;
+	')
+
+	userdom_search_user_home_dirs($1)
+	allow $1 mozilla_plugin_home_t:dir manage_dir_perms;
+	allow $1 mozilla_plugin_home_t:file manage_file_perms;
+	allow $1 mozilla_plugin_home_t:fifo_file manage_fifo_file_perms;
+	allow $1 mozilla_plugin_home_t:lnk_file manage_lnk_file_perms;
+	allow $1 mozilla_plugin_home_t:sock_file manage_sock_file_perms;
+')
+
+########################################
+## <summary>
+##	Create objects in user home
+##	directories with the generic mozilla
+##	plugin home type.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="object_class">
+##	<summary>
+##	Class of the object being created.
+##	</summary>
+## </param>
+## <param name="name" optional="true">
+##	<summary>
+##	The name of the object being created.
+##	</summary>
+## </param>
+#
+interface(`mozilla_home_filetrans_plugin_home',`
+	gen_require(`
+		type mozilla_plugin_home_t;
+	')
+
+	userdom_user_home_dir_filetrans($1, mozilla_plugin_home_t, $2, $3)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/mozilla.te refpolicy/policy/modules/contrib/mozilla.te
--- refpolicy/policy/modules/contrib/mozilla.te	2012-07-25 20:33:05.000000000 +0200
+++ refpolicy/policy/modules/contrib/mozilla.te	2012-11-02 20:09:03.387957492 +0100
@@ -1,4 +1,4 @@
-policy_module(mozilla, 2.6.0)
+policy_module(mozilla, 2.7.2)
 
 ########################################
 #
@@ -6,13 +6,43 @@
 #
 
 ## <desc>
+##	<p>
+##	Determine whether mozilla can
+##	make its stack executable.
+##	</p>
+## </desc>
+gen_tunable(mozilla_execstack, false)
+
+## <desc>
+## <p>
+## Allow mozilla/firefox to read user content
+## </p>
+## </desc>
+gen_tunable(mozilla_read_user_content, true)
+
+## <desc>
 ## <p>
-## Allow confined web browsers to read home directory content
+## Allow mozilla/firefox to manage user content
 ## </p>
 ## </desc>
-gen_tunable(mozilla_read_content, false)
+gen_tunable(mozilla_manage_user_content, false)
+
+## <desc>
+## <p>
+## Allow mozilla to use java plugins
+## </p>
+## <p>
+## Some plugins use named pipes inside temporary directories created
+## by the browser to communicate with the java process. If other browsers
+## need to use java plugins as well, they will get search privileges within
+## the temporary directories of mozilla
+## </p>
+## </desc>
+gen_tunable(mozilla_use_java, false)
 
 attribute_role mozilla_roles;
+attribute_role mozilla_plugin_roles;
+attribute_role mozilla_plugin_config_roles;
 
 type mozilla_t;
 type mozilla_exec_t;
@@ -21,9 +51,6 @@
 userdom_user_application_domain(mozilla_t, mozilla_exec_t)
 role mozilla_roles types mozilla_t;
 
-type mozilla_conf_t;
-files_config_file(mozilla_conf_t)
-
 type mozilla_home_t;
 typealias mozilla_home_t alias { user_mozilla_home_t staff_mozilla_home_t sysadm_mozilla_home_t };
 typealias mozilla_home_t alias { auditadm_mozilla_home_t secadm_mozilla_home_t };
@@ -31,8 +58,11 @@
 
 type mozilla_plugin_t;
 type mozilla_plugin_exec_t;
-application_domain(mozilla_plugin_t, mozilla_plugin_exec_t)
-role mozilla_roles types mozilla_plugin_t;
+userdom_user_application_domain(mozilla_plugin_t, mozilla_plugin_exec_t)
+role mozilla_plugin_roles types mozilla_plugin_t;
+
+type mozilla_plugin_home_t;
+userdom_user_home_content(mozilla_plugin_home_t)
 
 type mozilla_plugin_tmp_t;
 userdom_user_tmp_file(mozilla_plugin_tmp_t)
@@ -40,6 +70,18 @@
 type mozilla_plugin_tmpfs_t;
 userdom_user_tmpfs_file(mozilla_plugin_tmpfs_t)
 
+optional_policy(`
+	pulseaudio_tmpfs_content(mozilla_plugin_tmpfs_t)
+')
+
+type mozilla_plugin_rw_t;
+files_type(mozilla_plugin_rw_t)
+
+type mozilla_plugin_config_t;
+type mozilla_plugin_config_exec_t;
+userdom_user_application_domain(mozilla_plugin_config_t, mozilla_plugin_config_exec_t)
+role mozilla_plugin_config_roles types mozilla_plugin_config_t;
+
 type mozilla_tmp_t;
 userdom_user_tmp_file(mozilla_tmp_t)
 
@@ -48,6 +90,10 @@
 typealias mozilla_tmpfs_t alias { auditadm_mozilla_tmpfs_t secadm_mozilla_tmpfs_t };
 userdom_user_tmpfs_file(mozilla_tmpfs_t)
 
+optional_policy(`
+	pulseaudio_tmpfs_content(mozilla_tmpfs_t)
+')
+
 ########################################
 #
 # Local policy
@@ -56,26 +102,23 @@
 allow mozilla_t self:capability { sys_nice setgid setuid };
 allow mozilla_t self:process { sigkill signal setsched getsched setrlimit };
 allow mozilla_t self:fifo_file rw_fifo_file_perms;
-allow mozilla_t self:shm { unix_read unix_write read write destroy create };
+allow mozilla_t self:shm create_shm_perms;
 allow mozilla_t self:sem create_sem_perms;
 allow mozilla_t self:socket create_socket_perms;
-allow mozilla_t self:unix_stream_socket { listen accept };
-# Browse the web, connect to printer
-allow mozilla_t self:tcp_socket create_socket_perms;
-allow mozilla_t self:netlink_route_socket r_netlink_socket_perms;
-
-# for bash - old mozilla binary
-can_exec(mozilla_t, mozilla_exec_t)
-
-# X access, Home files
-manage_dirs_pattern(mozilla_t, mozilla_home_t, mozilla_home_t)
-manage_files_pattern(mozilla_t, mozilla_home_t, mozilla_home_t)
-manage_lnk_files_pattern(mozilla_t, mozilla_home_t, mozilla_home_t)
-userdom_search_user_home_dirs(mozilla_t)
-userdom_user_home_dir_filetrans(mozilla_t, mozilla_home_t, dir)
+allow mozilla_t self:unix_stream_socket { accept listen };
+
+allow mozilla_t mozilla_plugin_t:unix_stream_socket rw_socket_perms;
+allow mozilla_t mozilla_plugin_t:fd use;
 
-# Mozpluggerrc
-allow mozilla_t mozilla_conf_t:file read_file_perms;
+allow mozilla_t { mozilla_home_t mozilla_plugin_home_t }:dir manage_dir_perms;
+allow mozilla_t { mozilla_home_t mozilla_plugin_home_t }:file manage_file_perms;
+allow mozilla_t mozilla_home_t:lnk_file manage_lnk_file_perms;
+userdom_user_home_dir_filetrans(mozilla_t, mozilla_home_t, dir, ".galeon")
+userdom_user_home_dir_filetrans(mozilla_t, mozilla_home_t, dir, ".mozilla")
+userdom_user_home_dir_filetrans(mozilla_t, mozilla_home_t, dir, ".netscape")
+userdom_user_home_dir_filetrans(mozilla_t, mozilla_home_t, dir, ".phoenix")
+
+filetrans_pattern(mozilla_t, mozilla_home_t, mozilla_plugin_home_t, dir, "plugins")
 
 manage_files_pattern(mozilla_t, mozilla_tmp_t, mozilla_tmp_t)
 manage_dirs_pattern(mozilla_t, mozilla_tmp_t, mozilla_tmp_t)
@@ -87,92 +130,173 @@
 manage_sock_files_pattern(mozilla_t, mozilla_tmpfs_t, mozilla_tmpfs_t)
 fs_tmpfs_filetrans(mozilla_t, mozilla_tmpfs_t, { file lnk_file sock_file fifo_file })
 
+allow mozilla_t mozilla_plugin_rw_t:dir list_dir_perms;
+allow mozilla_t mozilla_plugin_rw_t:file read_file_perms;
+allow mozilla_t mozilla_plugin_rw_t:lnk_file read_lnk_file_perms;
+
+stream_connect_pattern(mozilla_t, mozilla_plugin_tmpfs_t, mozilla_plugin_tmpfs_t, mozilla_plugin_t)
+
 kernel_read_kernel_sysctls(mozilla_t)
 kernel_read_network_state(mozilla_t)
-# Access /proc, sysctl
 kernel_read_system_state(mozilla_t)
 kernel_read_net_sysctls(mozilla_t)
 
-# Look for plugins
 corecmd_list_bin(mozilla_t)
-# for bash - old mozilla binary
 corecmd_exec_shell(mozilla_t)
 corecmd_exec_bin(mozilla_t)
 
-# Browse the web, connect to printer
 corenet_all_recvfrom_unlabeled(mozilla_t)
 corenet_all_recvfrom_netlabel(mozilla_t)
 corenet_tcp_sendrecv_generic_if(mozilla_t)
-corenet_raw_sendrecv_generic_if(mozilla_t)
 corenet_tcp_sendrecv_generic_node(mozilla_t)
-corenet_raw_sendrecv_generic_node(mozilla_t)
-corenet_tcp_sendrecv_http_port(mozilla_t)
-corenet_tcp_sendrecv_http_cache_port(mozilla_t)
-corenet_tcp_sendrecv_squid_port(mozilla_t)
-corenet_tcp_sendrecv_ftp_port(mozilla_t)
-corenet_tcp_sendrecv_ipp_port(mozilla_t)
+
+corenet_sendrecv_http_client_packets(mozilla_t)
 corenet_tcp_connect_http_port(mozilla_t)
+corenet_tcp_sendrecv_http_port(mozilla_t)
+
+corenet_sendrecv_http_cache_client_packets(mozilla_t)
 corenet_tcp_connect_http_cache_port(mozilla_t)
+corenet_tcp_sendrecv_http_cache_port(mozilla_t)
+
+corenet_sendrecv_squid_client_packets(mozilla_t)
 corenet_tcp_connect_squid_port(mozilla_t)
+corenet_tcp_sendrecv_squid_port(mozilla_t)
+
+corenet_sendrecv_ftp_client_packets(mozilla_t)
 corenet_tcp_connect_ftp_port(mozilla_t)
+corenet_tcp_sendrecv_ftp_port(mozilla_t)
+
+corenet_sendrecv_ipp_client_packets(mozilla_t)
 corenet_tcp_connect_ipp_port(mozilla_t)
-corenet_tcp_connect_generic_port(mozilla_t)
+corenet_tcp_sendrecv_ipp_port(mozilla_t)
+
+corenet_sendrecv_soundd_client_packets(mozilla_t)
 corenet_tcp_connect_soundd_port(mozilla_t)
-corenet_sendrecv_http_client_packets(mozilla_t)
-corenet_sendrecv_http_cache_client_packets(mozilla_t)
-corenet_sendrecv_squid_client_packets(mozilla_t)
-corenet_sendrecv_ftp_client_packets(mozilla_t)
-corenet_sendrecv_ipp_client_packets(mozilla_t)
-corenet_sendrecv_generic_client_packets(mozilla_t)
-# Should not need other ports
-corenet_dontaudit_tcp_sendrecv_generic_port(mozilla_t)
-corenet_dontaudit_tcp_bind_generic_port(mozilla_t)
+corenet_tcp_sendrecv_soundd_port(mozilla_t)
+
+corenet_sendrecv_speech_client_packets(mozilla_t)
 corenet_tcp_connect_speech_port(mozilla_t)
+corenet_tcp_sendrecv_speech_port(mozilla_t)
 
-dev_read_urand(mozilla_t)
+dev_getattr_sysfs_dirs(mozilla_t)
+dev_read_sound(mozilla_t)
 dev_read_rand(mozilla_t)
+dev_read_urand(mozilla_t)
+dev_rw_dri(mozilla_t)
 dev_write_sound(mozilla_t)
-dev_read_sound(mozilla_t)
-dev_dontaudit_rw_dri(mozilla_t)
-dev_getattr_sysfs_dirs(mozilla_t)
 
 domain_dontaudit_read_all_domains_state(mozilla_t)
 
 files_read_etc_runtime_files(mozilla_t)
 files_read_usr_files(mozilla_t)
-files_read_etc_files(mozilla_t)
-# /var/lib
-files_read_var_lib_files(mozilla_t)
-# interacting with gstreamer
 files_read_var_files(mozilla_t)
+files_read_var_lib_files(mozilla_t)
 files_read_var_symlinks(mozilla_t)
 files_dontaudit_getattr_boot_dirs(mozilla_t)
 
-fs_dontaudit_getattr_all_fs(mozilla_t)
+fs_getattr_all_fs(mozilla_t)
 fs_search_auto_mountpoints(mozilla_t)
 fs_list_inotifyfs(mozilla_t)
 fs_rw_tmpfs_files(mozilla_t)
 
 term_dontaudit_getattr_pty_dirs(mozilla_t)
 
+auth_use_nsswitch(mozilla_t)
+
 logging_send_syslog_msg(mozilla_t)
 
 miscfiles_read_fonts(mozilla_t)
 miscfiles_read_localization(mozilla_t)
 miscfiles_dontaudit_setattr_fonts_dirs(mozilla_t)
 
-# Browse the web, connect to printer
-sysnet_dns_name_resolve(mozilla_t)
-
 userdom_use_user_ptys(mozilla_t)
 
 mozilla_run_plugin(mozilla_t, mozilla_roles)
+mozilla_run_plugin_config(mozilla_t, mozilla_roles)
 
 xserver_user_x_domain_template(mozilla, mozilla_t, mozilla_tmpfs_t)
 xserver_dontaudit_read_xdm_tmp_files(mozilla_t)
 xserver_dontaudit_getattr_xdm_tmp_sockets(mozilla_t)
 
+ifdef(`distro_gentoo',`
+	allow mozilla_t mozilla_plugin_t:process { rlimitinh siginh noatsecure };
+
+	manage_fifo_files_pattern(mozilla_t, mozilla_tmp_t, mozilla_tmp_t)
+
+	corenet_dontaudit_tcp_bind_generic_port(mozilla_t)
+	corenet_dontaudit_tcp_sendrecv_generic_port(mozilla_t)
+	corenet_sendrecv_tor_client_packets(mozilla_t)
+	corenet_tcp_connect_tor_port(mozilla_t)
+	corenet_tcp_sendrecv_tor_port(mozilla_t)
+
+	userdom_search_user_home_dirs(mozilla_t)
+
+	xdg_manage_downloads_home(mozilla_t)
+	xdg_read_generic_config_home_files(mozilla_t)
+	xdg_read_generic_data_home_files(mozilla_t)
+
+	#xserver_common_x_domain_template(mozilla_t, mozilla_tmpfs_t) is this
+	#not better than user_x_domain_template ?
+
+	# main refpolicy does not make this distinction anymore
+	# (allows manage rights automatically)
+	tunable_policy(`mozilla_read_user_content',`
+		userdom_list_user_tmp(mozilla_t)
+		userdom_read_user_home_content_files(mozilla_t)
+		userdom_read_user_home_content_symlinks(mozilla_t)
+		userdom_read_user_tmp_files(mozilla_t)
+		userdom_read_user_tmp_symlinks(mozilla_t)
+	
+		ifndef(`enable_mls',`
+			fs_list_dos(mozilla_t)
+			fs_read_dos_files(mozilla_t)
+			fs_read_iso9660_files(mozilla_t)
+			fs_read_removable_files(mozilla_t)
+			fs_read_removable_symlinks(mozilla_t)
+			fs_search_removable(mozilla_t)
+		')
+	',`
+		files_dontaudit_list_home(mozilla_t)
+		files_dontaudit_list_tmp(mozilla_t)
+	
+		fs_dontaudit_list_removable(mozilla_t)
+		fs_dontaudit_read_removable_files(mozilla_t)
+	
+		userdom_dontaudit_list_user_home_dirs(mozilla_t)
+		userdom_dontaudit_list_user_tmp(mozilla_t)
+		userdom_dontaudit_read_user_home_content_files(mozilla_t)
+		userdom_dontaudit_read_user_tmp_files(mozilla_t)
+	')
+
+	optional_policy(`
+		tunable_policy(`mozilla_use_java',`
+			#java_noatsecure_domtrans(mozilla_t)
+			# refpolicy method below, but we might want to introduce
+			# specific domains for this (like mozilla_java_t)? TODO
+			java_exec(mozilla_t)
+			java_manage_generic_home_content(mozilla_t)
+		')
+		
+		java_home_filetrans_java_home(mozilla_t, dir, ".java")
+	
+		# Cannot handle optional_policy within tunable_policy
+		optional_policy(`
+			tunable_policy(`mozilla_use_java',`
+				chromium_tmp_filetrans(mozilla_t, mozilla_tmp_t, fifo_file)
+			')
+		')
+	')
+
+	optional_policy(`
+		nscd_socket_use(mozilla_t)
+	')
+')
+
 tunable_policy(`allow_execmem',`
+	allow mozilla_t self:process execmem;
+')
+
+tunable_policy(`mozilla_execstack',`
 	allow mozilla_t self:process { execmem execstack };
 ')
 
@@ -188,55 +312,6 @@
 	fs_manage_cifs_symlinks(mozilla_t)
 ')
 
-# Uploads, local html
-tunable_policy(`mozilla_read_content && use_nfs_home_dirs',`
-	fs_list_auto_mountpoints(mozilla_t)
-	files_list_home(mozilla_t)
-	fs_read_nfs_files(mozilla_t)
-	fs_read_nfs_symlinks(mozilla_t)
-
-',`
-	files_dontaudit_list_home(mozilla_t)
-	fs_dontaudit_list_auto_mountpoints(mozilla_t)
-	fs_dontaudit_read_nfs_files(mozilla_t)
-	fs_dontaudit_list_nfs(mozilla_t)
-')
-
-tunable_policy(`mozilla_read_content && use_samba_home_dirs',`
-	fs_list_auto_mountpoints(mozilla_t)
-	files_list_home(mozilla_t)
-	fs_read_cifs_files(mozilla_t)
-	fs_read_cifs_symlinks(mozilla_t)
-',`
-	files_dontaudit_list_home(mozilla_t)
-	fs_dontaudit_list_auto_mountpoints(mozilla_t)
-	fs_dontaudit_read_cifs_files(mozilla_t)
-	fs_dontaudit_list_cifs(mozilla_t)
-')
-
-tunable_policy(`mozilla_read_content',`
-	userdom_list_user_tmp(mozilla_t)
-	userdom_read_user_tmp_files(mozilla_t)
-	userdom_read_user_tmp_symlinks(mozilla_t)
-	userdom_read_user_home_content_files(mozilla_t)
-	userdom_read_user_home_content_symlinks(mozilla_t)
-
-	ifndef(`enable_mls',`
-		fs_search_removable(mozilla_t)
-		fs_read_removable_files(mozilla_t)
-		fs_read_removable_symlinks(mozilla_t)
-	')
-',`
-	files_dontaudit_list_tmp(mozilla_t)
-	files_dontaudit_list_home(mozilla_t)
-	fs_dontaudit_list_removable(mozilla_t)
-	fs_dontaudit_read_removable_files(mozilla_t)
-	userdom_dontaudit_list_user_tmp(mozilla_t)
-	userdom_dontaudit_read_user_tmp_files(mozilla_t)
-	userdom_dontaudit_list_user_home_dirs(mozilla_t)
-	userdom_dontaudit_read_user_home_content_files(mozilla_t)
-')
-
 optional_policy(`
 	apache_read_user_scripts(mozilla_t)
 	apache_read_user_content(mozilla_t)
@@ -248,44 +323,48 @@
 
 optional_policy(`
 	cups_read_rw_config(mozilla_t)
-	cups_dbus_chat(mozilla_t)
 ')
 
 optional_policy(`
+	dbus_all_session_bus_client(mozilla_t)
 	dbus_system_bus_client(mozilla_t)
-	dbus_session_bus_client(mozilla_t)
 
 	optional_policy(`
-		networkmanager_dbus_chat(mozilla_t)
+		cups_dbus_chat(mozilla_t)
 	')
-')
 
-optional_policy(`
-	gnome_stream_connect_gconf(mozilla_t)
-	gnome_manage_config(mozilla_t)
-')
+	optional_policy(`
+		mozilla_dbus_chat_plugin(mozilla_t)
+	')
 
-optional_policy(`
-	java_domtrans(mozilla_t)
+	optional_policy(`
+		networkmanager_dbus_chat(mozilla_t)
+	')
 ')
 
 optional_policy(`
-	lpd_domtrans_lpr(mozilla_t)
+	gnome_stream_connect_gconf(mozilla_t)
+	gnome_manage_generic_gconf_home_content(mozilla_t)
+	gnome_home_filetrans_gconf_home(mozilla_t, dir, ".gconf")
+	gnome_home_filetrans_gconf_home(mozilla_t, dir, ".gconfd")
+	gnome_manage_generic_home_content(mozilla_t)
+	gnome_home_filetrans_gnome_home(mozilla_t, dir, ".gnome")
+	gnome_home_filetrans_gnome_home(mozilla_t, dir, ".gnome2")
+	gnome_home_filetrans_gnome_home(mozilla_t, dir, ".gnome2_private")
 ')
 
 optional_policy(`
-	mplayer_domtrans(mozilla_t)
-	mplayer_read_user_home_files(mozilla_t)
+	lpd_run_lpr(mozilla_t, mozilla_roles)
 ')
 
 optional_policy(`
-	nscd_socket_use(mozilla_t)
+	mplayer_exec(mozilla_t)
+	mplayer_manage_generic_home_content(mozilla_t)
+	mplayer_home_filetrans_mplayer_home(mozilla_t, dir, ".mplayer")
 ')
 
 optional_policy(`
-	pulseaudio_role(mozilla_roles, mozilla_t)
-	pulseaudio_stream_connect(mozilla_t)
-	pulseaudio_manage_home_files(mozilla_t)
+	pulseaudio_run(mozilla_t, mozilla_roles)
 ')
 
 optional_policy(`
@@ -294,22 +373,33 @@
 
 ########################################
 #
-# mozilla_plugin local policy
+# Plugin local policy
 #
 
-dontaudit mozilla_plugin_t self:capability { sys_ptrace };
-allow mozilla_plugin_t self:process { setsched signal_perms execmem };
+dontaudit mozilla_plugin_t self:capability { ipc_lock sys_nice sys_ptrace sys_tty_config };
+allow mozilla_plugin_t self:process { setpgid getsched setsched signal_perms setrlimit };
 allow mozilla_plugin_t self:fifo_file manage_fifo_file_perms;
-allow mozilla_plugin_t self:unix_stream_socket { connectto create_stream_socket_perms };
-allow mozilla_plugin_t self:tcp_socket create_stream_socket_perms;
-allow mozilla_plugin_t self:udp_socket create_socket_perms;
-allow mozilla_plugin_t self:netlink_route_socket r_netlink_socket_perms;
 allow mozilla_plugin_t self:netlink_kobject_uevent_socket create_socket_perms;
 allow mozilla_plugin_t self:sem create_sem_perms;
 allow mozilla_plugin_t self:shm create_shm_perms;
+allow mozilla_plugin_t self:tcp_socket { accept listen };
+allow mozilla_plugin_t self:unix_stream_socket { accept connectto listen };
+
+allow mozilla_plugin_t mozilla_t:unix_stream_socket rw_socket_perms;
+allow mozilla_plugin_t mozilla_t:unix_dgram_socket rw_socket_perms;
+allow mozilla_plugin_t mozilla_t:shm { rw_shm_perms destroy };
+allow mozilla_plugin_t mozilla_t:sem create_sem_perms;
+
+manage_dirs_pattern(mozilla_plugin_t, { mozilla_home_t mozilla_plugin_home_t }, { mozilla_home_t mozilla_plugin_home_t })
+manage_files_pattern(mozilla_plugin_t, { mozilla_home_t mozilla_plugin_home_t }, mozilla_plugin_home_t)
+manage_lnk_files_pattern(mozilla_plugin_t, { mozilla_home_t mozilla_plugin_home_t }, mozilla_plugin_home_t)
+
+userdom_user_home_dir_filetrans(mozilla_plugin_t, mozilla_home_t, dir, ".galeon")
+userdom_user_home_dir_filetrans(mozilla_plugin_t, mozilla_home_t, dir, ".mozilla")
+userdom_user_home_dir_filetrans(mozilla_plugin_t, mozilla_home_t, dir, ".netscape")
+userdom_user_home_dir_filetrans(mozilla_plugin_t, mozilla_home_t, dir, ".phoenix")
 
-can_exec(mozilla_plugin_t, mozilla_home_t)
-read_files_pattern(mozilla_plugin_t, mozilla_home_t, mozilla_home_t)
+filetrans_pattern(mozilla_plugin_t, mozilla_home_t, mozilla_plugin_home_t, dir, "plugins")
 
 manage_dirs_pattern(mozilla_plugin_t, mozilla_plugin_tmp_t, mozilla_plugin_tmp_t)
 manage_files_pattern(mozilla_plugin_t, mozilla_plugin_tmp_t, mozilla_plugin_tmp_t)
@@ -323,52 +413,111 @@
 manage_sock_files_pattern(mozilla_plugin_t, mozilla_plugin_tmpfs_t, mozilla_plugin_tmpfs_t)
 fs_tmpfs_filetrans(mozilla_plugin_t, mozilla_plugin_tmpfs_t, { file lnk_file sock_file fifo_file })
 
-can_exec(mozilla_plugin_t, mozilla_exec_t)
+allow mozilla_plugin_t mozilla_plugin_rw_t:dir list_dir_perms;
+allow mozilla_plugin_t mozilla_plugin_rw_t:file read_file_perms;
+allow mozilla_plugin_t mozilla_plugin_rw_t:lnk_file read_lnk_file_perms;
 
-kernel_read_kernel_sysctls(mozilla_plugin_t)
+dgram_send_pattern(mozilla_plugin_t, mozilla_plugin_tmpfs_t, mozilla_plugin_tmpfs_t, mozilla_t)
+stream_connect_pattern(mozilla_plugin_t, mozilla_plugin_tmpfs_t, mozilla_plugin_tmpfs_t, mozilla_t)
+
+can_exec(mozilla_plugin_t, { mozilla_exec_t mozilla_plugin_home_t mozilla_plugin_tmp_t })
+
+kernel_read_all_sysctls(mozilla_plugin_t)
 kernel_read_system_state(mozilla_plugin_t)
 kernel_read_network_state(mozilla_plugin_t)
 kernel_request_load_module(mozilla_plugin_t)
+kernel_dontaudit_getattr_core_if(mozilla_plugin_t)
 
 corecmd_exec_bin(mozilla_plugin_t)
 corecmd_exec_shell(mozilla_plugin_t)
 
 corenet_all_recvfrom_netlabel(mozilla_plugin_t)
 corenet_all_recvfrom_unlabeled(mozilla_plugin_t)
-corenet_tcp_sendrecv_generic_if(mozilla_plugin_t)
-corenet_tcp_sendrecv_generic_node(mozilla_plugin_t)
-corenet_tcp_connect_generic_port(mozilla_plugin_t)
-corenet_tcp_connect_pulseaudio_port(mozilla_plugin_t)
+
+corenet_sendrecv_asterisk_client_packets(mozilla_plugin_t)
+corenet_tcp_connect_asterisk_port(mozilla_plugin_t)
+corenet_tcp_sendrecv_asterisk_port(mozilla_plugin_t)
+
+corenet_sendrecv_ftp_client_packets(mozilla_plugin_t)
+corenet_tcp_connect_ftp_port(mozilla_plugin_t)
+corenet_tcp_sendrecv_ftp_port(mozilla_plugin_t)
+
+corenet_sendrecv_gatekeeper_client_packets(mozilla_plugin_t)
+corenet_tcp_connect_gatekeeper_port(mozilla_plugin_t)
+corenet_tcp_sendrecv_gatekeeper_port(mozilla_plugin_t)
+
+corenet_sendrecv_http_client_packets(mozilla_plugin_t)
 corenet_tcp_connect_http_port(mozilla_plugin_t)
+corenet_tcp_sendrecv_http_port(mozilla_plugin_t)
+
+corenet_sendrecv_http_cache_client_packets(mozilla_plugin_t)
 corenet_tcp_connect_http_cache_port(mozilla_plugin_t)
-corenet_tcp_connect_squid_port(mozilla_plugin_t)
+corenet_tcp_sendrecv_http_cache_port(mozilla_plugin_t)
+
+corenet_sendrecv_ipp_client_packets(mozilla_plugin_t)
 corenet_tcp_connect_ipp_port(mozilla_plugin_t)
+corenet_tcp_sendrecv_ipp_port(mozilla_plugin_t)
+
+corenet_sendrecv_ircd_client_packets(mozilla_plugin_t)
+corenet_tcp_connect_ircd_port(mozilla_plugin_t)
+corenet_tcp_sendrecv_ircd_port(mozilla_plugin_t)
+
+corenet_sendrecv_jabber_client_client_packets(mozilla_plugin_t)
+corenet_tcp_connect_jabber_client_port(mozilla_plugin_t)
+corenet_tcp_sendrecv_jabber_client_port(mozilla_plugin_t)
+
+corenet_sendrecv_mmcc_client_packets(mozilla_plugin_t)
 corenet_tcp_connect_mmcc_port(mozilla_plugin_t)
+corenet_tcp_sendrecv_mmcc_port(mozilla_plugin_t)
+
+corenet_sendrecv_monopd_client_packets(mozilla_plugin_t)
+corenet_tcp_connect_monopd_port(mozilla_plugin_t)
+corenet_tcp_sendrecv_monopd_port(mozilla_plugin_t)
+
+corenet_sendrecv_soundd_client_packets(mozilla_plugin_t)
+corenet_tcp_connect_soundd_port(mozilla_plugin_t)
+corenet_tcp_sendrecv_soundd_port(mozilla_plugin_t)
+
+corenet_sendrecv_speech_client_packets(mozilla_plugin_t)
 corenet_tcp_connect_speech_port(mozilla_plugin_t)
+corenet_tcp_sendrecv_speech_port(mozilla_plugin_t)
+
+corenet_sendrecv_squid_client_packets(mozilla_plugin_t)
+corenet_tcp_connect_squid_port(mozilla_plugin_t)
+corenet_tcp_sendrecv_squid_port(mozilla_plugin_t)
 
+corenet_sendrecv_vnc_client_packets(mozilla_plugin_t)
+corenet_tcp_connect_vnc_port(mozilla_plugin_t)
+corenet_tcp_sendrecv_vnc_port(mozilla_plugin_t)
+
+dev_read_generic_usb_dev(mozilla_plugin_t)
 dev_read_rand(mozilla_plugin_t)
+dev_read_sound(mozilla_plugin_t)
+dev_read_sysfs(mozilla_plugin_t)
 dev_read_urand(mozilla_plugin_t)
 dev_read_video_dev(mozilla_plugin_t)
-dev_write_video_dev(mozilla_plugin_t)
-dev_read_sysfs(mozilla_plugin_t)
-dev_read_sound(mozilla_plugin_t)
 dev_write_sound(mozilla_plugin_t)
-# for nvidia driver
+dev_write_video_dev(mozilla_plugin_t)
+dev_rw_dri(mozilla_plugin_t)
 dev_rw_xserver_misc(mozilla_plugin_t)
-dev_dontaudit_rw_dri(mozilla_plugin_t)
+
+dev_dontaudit_getattr_generic_files(mozilla_plugin_t)
+dev_dontaudit_getattr_generic_pipes(mozilla_plugin_t)
+dev_dontaudit_getattr_all_blk_files(mozilla_plugin_t)
+dev_dontaudit_getattr_all_chr_files(mozilla_plugin_t)
 
 domain_use_interactive_fds(mozilla_plugin_t)
 domain_dontaudit_read_all_domains_state(mozilla_plugin_t)
 
+files_list_mnt(mozilla_plugin_t)
 files_read_config_files(mozilla_plugin_t)
 files_read_usr_files(mozilla_plugin_t)
-files_list_mnt(mozilla_plugin_t)
 
 fs_getattr_all_fs(mozilla_plugin_t)
-fs_list_dos(mozilla_plugin_t)
-fs_read_dos_files(mozilla_plugin_t)
+fs_search_auto_mountpoints(mozilla_plugin_t)
 
-application_dontaudit_signull(mozilla_plugin_t)
+term_getattr_all_ttys(mozilla_plugin_t)
+term_getattr_all_ptys(mozilla_plugin_t)
 
 auth_use_nsswitch(mozilla_plugin_t)
 
@@ -377,29 +526,40 @@
 miscfiles_read_localization(mozilla_plugin_t)
 miscfiles_read_fonts(mozilla_plugin_t)
 miscfiles_read_generic_certs(mozilla_plugin_t)
-miscfiles_dontaudit_setattr_fonts_dirs(mozilla_plugin_t)
-miscfiles_dontaudit_setattr_fonts_cache_dirs(mozilla_plugin_t)
 
-sysnet_dns_name_resolve(mozilla_plugin_t)
+ifdef(`distro_gentoo',`
+	allow mozilla_plugin_t self:netlink_route_socket r_netlink_socket_perms;
+	allow mozilla_plugin_t self:udp_socket create_socket_perms;
 
-term_getattr_all_ttys(mozilla_plugin_t)
-term_getattr_all_ptys(mozilla_plugin_t)
+	corenet_sendrecv_pulseaudio_client_packets(mozilla_plugin_t)
+	corenet_tcp_connect_pulseaudio_port(mozilla_plugin_t)
+	corenet_tcp_sendrecv_pulseaudio_port(mozilla_plugin_t)
+
+	miscfiles_dontaudit_setattr_fonts_cache_dirs(mozilla_plugin_t)
+	miscfiles_dontaudit_setattr_fonts_dirs(mozilla_plugin_t)
+
+	userdom_dontaudit_use_user_terminals(mozilla_plugin_t)
+	userdom_rw_user_tmpfs_files(mozilla_plugin_t)
+
+	xdg_read_generic_config_home_files(mozilla_plugin_t)
 
-userdom_rw_user_tmpfs_files(mozilla_plugin_t)
-userdom_dontaudit_use_user_terminals(mozilla_plugin_t)
-userdom_manage_user_tmp_sockets(mozilla_plugin_t)
-userdom_manage_user_tmp_dirs(mozilla_plugin_t)
-userdom_read_user_tmp_files(mozilla_plugin_t)
-userdom_read_user_tmp_symlinks(mozilla_plugin_t)
-userdom_read_user_home_content_files(mozilla_plugin_t)
-userdom_read_user_home_content_symlinks(mozilla_plugin_t)
+	xserver_user_x_domain_template(mozilla_plugin, mozilla_plugin_t, mozilla_plugin_tmpfs_t)
+
+	optional_policy(`
+		alsa_domain(mozilla_plugin_t, mozilla_plugin_tmpfs_t)
+	')
+
+	optional_policy(`
+		flash_manage_home(mozilla_plugin_t)
+	')
+')
 
 tunable_policy(`allow_execmem',`
-	allow mozilla_plugin_t self:process { execmem execstack };
+	allow mozilla_plugin_t self:process execmem;
 ')
 
-tunable_policy(`allow_execstack',`
-	allow mozilla_plugin_t self:process { execstack };
+tunable_policy(`mozilla_execstack',`
+	allow mozilla_plugin_t self:process { execmem execstack };
 ')
 
 tunable_policy(`use_nfs_home_dirs',`
@@ -420,22 +580,36 @@
 ')
 
 optional_policy(`
+	automount_dontaudit_getattr_tmp_dirs(mozilla_plugin_t)
+')
+
+optional_policy(`
+	dbus_all_session_bus_client(mozilla_plugin_t)
+	dbus_connect_all_session_bus(mozilla_plugin_t)
 	dbus_system_bus_client(mozilla_plugin_t)
-	dbus_session_bus_client(mozilla_plugin_t)
-	dbus_read_lib_files(mozilla_plugin_t)
 ')
 
 optional_policy(`
-	gnome_manage_config(mozilla_plugin_t)
+	gnome_manage_generic_home_content(mozilla_plugin_t)
+	gnome_home_filetrans_gnome_home(mozilla_plugin_t, dir, ".gnome")
+	gnome_home_filetrans_gnome_home(mozilla_plugin_t, dir, ".gnome2")
+	gnome_home_filetrans_gnome_home(mozilla_plugin_t, dir, ".gnome2_private")
 ')
 
 optional_policy(`
 	java_exec(mozilla_plugin_t)
+	java_manage_generic_home_content(mozilla_plugin_t)
+	java_home_filetrans_java_home(mozilla_plugin_t, dir, ".java")
+')
+
+optional_policy(`
+	lpd_run_lpr(mozilla_plugin_t, mozilla_plugin_roles)
 ')
 
 optional_policy(`
 	mplayer_exec(mozilla_plugin_t)
-	mplayer_read_user_home_files(mozilla_plugin_t)
+	mplayer_manage_generic_home_content(mozilla_plugin_t)
+	mplayer_home_filetrans_mplayer_home(mozilla_plugin_t, dir, ".mplayer")
 ')
 
 optional_policy(`
@@ -443,14 +617,114 @@
 ')
 
 optional_policy(`
-	pulseaudio_exec(mozilla_plugin_t)
-	pulseaudio_stream_connect(mozilla_plugin_t)
-	pulseaudio_setattr_home_dir(mozilla_plugin_t)
-	pulseaudio_manage_home_files(mozilla_plugin_t)
+	pulseaudio_run(mozilla_plugin_t, mozilla_plugin_roles)
+')
+
+optional_policy(`
+	udev_read_db(mozilla_plugin_t)
 ')
 
 optional_policy(`
+	xserver_read_user_xauth(mozilla_plugin_t)
 	xserver_read_xdm_pid(mozilla_plugin_t)
 	xserver_stream_connect(mozilla_plugin_t)
 	xserver_use_user_fonts(mozilla_plugin_t)
+	xserver_dontaudit_read_xdm_tmp_files(mozilla_plugin_t)
+')
+
+########################################
+#
+# Plugin config local policy
+#
+
+allow mozilla_plugin_config_t self:capability { dac_override dac_read_search sys_nice setuid setgid };
+allow mozilla_plugin_config_t self:process { setsched signal_perms getsched };
+allow mozilla_plugin_config_t self:fifo_file rw_fifo_file_perms;
+allow mozilla_plugin_config_t self:unix_stream_socket create_stream_socket_perms;
+
+allow mozilla_plugin_config_t mozilla_plugin_rw_t:dir manage_dir_perms;
+allow mozilla_plugin_config_t mozilla_plugin_rw_t:file manage_file_perms;
+allow mozilla_plugin_config_t mozilla_plugin_rw_t:lnk_file manage_lnk_file_perms;
+
+manage_dirs_pattern(mozilla_plugin_config_t, { mozilla_home_t mozilla_plugin_home_t }, { mozilla_home_t mozilla_plugin_home_t })
+manage_files_pattern(mozilla_plugin_config_t, { mozilla_home_t mozilla_plugin_home_t }, mozilla_plugin_home_t)
+manage_lnk_files_pattern(mozilla_plugin_config_t, { mozilla_home_t mozilla_plugin_home_t }, mozilla_plugin_home_t)
+
+userdom_user_home_dir_filetrans(mozilla_plugin_config_t, mozilla_home_t, dir, ".galeon")
+userdom_user_home_dir_filetrans(mozilla_plugin_config_t, mozilla_home_t, dir, ".mozilla")
+userdom_user_home_dir_filetrans(mozilla_plugin_config_t, mozilla_home_t, dir, ".netscape")
+userdom_user_home_dir_filetrans(mozilla_plugin_config_t, mozilla_home_t, dir, ".phoenix")
+
+userdom_user_home_dir_filetrans(mozilla_plugin_config_t, mozilla_plugin_home_t, dir, ".adobe")
+userdom_user_home_dir_filetrans(mozilla_plugin_config_t, mozilla_plugin_home_t, dir, ".macromedia")
+userdom_user_home_dir_filetrans(mozilla_plugin_config_t, mozilla_plugin_home_t, dir, ".gnash")
+userdom_user_home_dir_filetrans(mozilla_plugin_config_t, mozilla_plugin_home_t, dir, ".gcjwebplugin")
+userdom_user_home_dir_filetrans(mozilla_plugin_config_t, mozilla_plugin_home_t, dir, ".icedteaplugin")
+userdom_user_home_dir_filetrans(mozilla_plugin_config_t, mozilla_plugin_home_t, dir, ".spicec")
+userdom_user_home_dir_filetrans(mozilla_plugin_config_t, mozilla_plugin_home_t, dir, ".ICAClient")
+userdom_user_home_dir_filetrans(mozilla_plugin_config_t, mozilla_plugin_home_t, dir, "zimbrauserdata")
+
+filetrans_pattern(mozilla_plugin_config_t, mozilla_home_t, mozilla_plugin_home_t, dir, "plugins")
+
+can_exec(mozilla_plugin_config_t, { mozilla_plugin_rw_t mozilla_plugin_home_t })
+
+kernel_read_system_state(mozilla_plugin_config_t)
+kernel_request_load_module(mozilla_plugin_config_t)
+
+corecmd_exec_bin(mozilla_plugin_config_t)
+corecmd_exec_shell(mozilla_plugin_config_t)
+
+dev_read_urand(mozilla_plugin_config_t)
+dev_rw_dri(mozilla_plugin_config_t)
+dev_search_sysfs(mozilla_plugin_config_t)
+dev_dontaudit_read_rand(mozilla_plugin_config_t)
+
+domain_use_interactive_fds(mozilla_plugin_config_t)
+
+files_list_tmp(mozilla_plugin_config_t)
+files_read_usr_files(mozilla_plugin_config_t)
+files_dontaudit_search_home(mozilla_plugin_config_t)
+
+fs_getattr_all_fs(mozilla_plugin_config_t)
+fs_search_auto_mountpoints(mozilla_plugin_config_t)
+fs_list_inotifyfs(mozilla_plugin_config_t)
+
+auth_use_nsswitch(mozilla_plugin_config_t)
+
+miscfiles_read_localization(mozilla_plugin_config_t)
+miscfiles_read_fonts(mozilla_plugin_config_t)
+
+userdom_read_user_home_content_symlinks(mozilla_plugin_config_t)
+userdom_read_user_home_content_files(mozilla_plugin_config_t)
+
+userdom_use_user_ptys(mozilla_plugin_config_t)
+
+mozilla_run_plugin(mozilla_plugin_config_t, mozilla_plugin_config_roles)
+
+tunable_policy(`allow_execmem',`
+	allow mozilla_plugin_config_t self:process execmem;
+')
+
+tunable_policy(`mozilla_execstack',`
+	allow mozilla_plugin_config_t self:process { execmem execstack };
+')
+
+tunable_policy(`use_nfs_home_dirs',`
+	fs_manage_nfs_dirs(mozilla_plugin_config_t)
+	fs_manage_nfs_files(mozilla_plugin_config_t)
+	fs_manage_nfs_symlinks(mozilla_plugin_config_t)
+')
+
+tunable_policy(`use_samba_home_dirs',`
+	fs_manage_cifs_dirs(mozilla_plugin_config_t)
+	fs_manage_cifs_files(mozilla_plugin_config_t)
+	fs_manage_cifs_symlinks(mozilla_plugin_config_t)
+')
+
+optional_policy(`
+	automount_dontaudit_getattr_tmp_dirs(mozilla_plugin_config_t)
+')
+
+optional_policy(`
+	xserver_use_user_fonts(mozilla_plugin_config_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/mpd.fc refpolicy/policy/modules/contrib/mpd.fc
--- refpolicy/policy/modules/contrib/mpd.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/mpd.fc	2012-10-13 21:32:38.787579239 +0200
@@ -1,8 +1,11 @@
-/etc/mpd\.conf		--	gen_context(system_u:object_r:mpd_etc_t,s0)
+/etc/mpd\.conf	--	gen_context(system_u:object_r:mpd_etc_t,s0)
+
 /etc/rc\.d/init\.d/mpd	--	gen_context(system_u:object_r:mpd_initrc_exec_t,s0)
 
-/usr/bin/mpd		--	gen_context(system_u:object_r:mpd_exec_t,s0)
+/usr/bin/mpd	--	gen_context(system_u:object_r:mpd_exec_t,s0)
 
-/var/lib/mpd(/.*)?		gen_context(system_u:object_r:mpd_var_lib_t,s0)
+/var/lib/mpd(/.*)?	gen_context(system_u:object_r:mpd_var_lib_t,s0)
 /var/lib/mpd/music(/.*)?	gen_context(system_u:object_r:mpd_data_t,s0)
 /var/lib/mpd/playlists(/.*)?	gen_context(system_u:object_r:mpd_data_t,s0)
+
+/var/log/mpd(/.*)?	gen_context(system_u:object_r:mpd_log_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/mpd.if refpolicy/policy/modules/contrib/mpd.if
--- refpolicy/policy/modules/contrib/mpd.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/mpd.if	2012-10-19 09:47:30.273491891 +0200
@@ -1,4 +1,23 @@
-## <summary>Music Player Daemon</summary>
+## <summary>Music Player Daemon.</summary>
+
+########################################
+## <summary>
+##	Role access for mpd.
+## </summary>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <param name="domain">
+##	<summary>
+##	User domain for the role.
+##	</summary>
+## </param>
+#
+template(`mpd_role',`
+	refpolicywarn(`$0($*) has been deprecated')
+')
 
 ########################################
 ## <summary>
@@ -15,6 +34,7 @@
 		type mpd_t, mpd_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, mpd_exec_t, mpd_t)
 ')
 
@@ -57,7 +77,8 @@
 
 ######################################
 ## <summary>
-##	Manage mpd data files.
+##	Create, read, write, and delete
+##	mpd data files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -74,6 +95,78 @@
 	manage_files_pattern($1, mpd_data_t, mpd_data_t)
 ')
 
+########################################
+## <summary>
+##	Create, read, write, and delete
+##	mpd user data content.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`mpd_manage_user_data_content',`
+	gen_require(`
+		type mpd_user_data_t;
+	')
+
+	userdom_search_user_home_dirs($1)
+	allow $1 mpd_user_data_t:dir manage_dir_perms;
+	allow $1 mpd_user_data_t:file manage_file_perms;
+	allow $1 mpd_user_data_t:lnk_file manage_lnk_file_perms;
+')
+
+########################################
+## <summary>
+##	Relabel mpd user data content.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`mpd_relabel_user_data_content',`
+	gen_require(`
+		type mpd_user_data_t;
+	')
+
+	userdom_search_user_home_dirs($1)
+	allow $1 mpd_user_data_t:dir relabel_dir_perms;
+	allow $1 mpd_user_data_t:file relabel_file_perms;
+	allow $1 mpd_user_data_t:lnk_file relabel_lnk_file_perms;
+')
+
+########################################
+## <summary>
+##	Create objects in user home
+##	directories with the mpd user data type.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="object_class">
+##	<summary>
+##	Class of the object being created.
+##	</summary>
+## </param>
+## <param name="name" optional="true">
+##	<summary>
+##	The name of the object being created.
+##	</summary>
+## </param>
+#
+interface(`mpd_home_filetrans_user_data',`
+	gen_require(`
+		type mpd_user_data_t;
+	')
+
+	userdom_user_home_dir_filetrans($1, mpd_user_data_t, $2, $3)
+')
+
 #######################################
 ## <summary>
 ##	Read mpd tmpfs files.
@@ -95,7 +188,8 @@
 
 ###################################
 ## <summary>
-##	Manage mpd tmpfs files.
+##	Create, read, write, and delete
+##	mpd tmpfs files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -128,8 +222,8 @@
 		type mpd_var_lib_t;
 	')
 
-	allow $1 mpd_var_lib_t:dir search_dir_perms;
 	files_search_var_lib($1)
+	allow $1 mpd_var_lib_t:dir search_dir_perms;
 ')
 
 ########################################
@@ -173,8 +267,8 @@
 
 #######################################
 ## <summary>
-##	Create an object in the root directory, with a private
-##	type using a type transition.
+##	Create specified objects in mpd
+##	lib directories with a private type.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -191,6 +285,11 @@
 ##	The object class of the object being created.
 ##	</summary>
 ## </param>
+## <param name="name" optional="true">
+##	<summary>
+##	The name of the object being created.
+##	</summary>
+## </param>
 #
 interface(`mpd_var_lib_filetrans',`
 	gen_require(`
@@ -198,12 +297,13 @@
 	')
 
 	files_search_var_lib($1)
-	filetrans_pattern($1, mpd_var_lib_t, $2, $3)
+	filetrans_pattern($1, mpd_var_lib_t, $2, $3, $4)
 ')
 
 ########################################
 ## <summary>
-##	Manage mpd lib dirs files.
+##	Create, read, write, and delete
+##	mpd lib dirs.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -222,8 +322,8 @@
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate
-##	an mpd environment
+##	All of the rules required to
+##	administrate an mpd environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -241,7 +341,7 @@
 	gen_require(`
 		type mpd_t, mpd_initrc_exec_t, mpd_etc_t;
 		type mpd_data_t, mpd_log_t, mpd_var_lib_t;
-		type mpd_tmpfs_t;
+		type mpd_tmpfs_t, mpd_tmp_t, mpd_user_data_t;
 	')
 
 	allow $1 mpd_t:process { ptrace signal_perms };
@@ -252,16 +352,18 @@
 	role_transition $2 mpd_initrc_exec_t system_r;
 	allow $2 system_r;
 
+	files_search_etc($1)
 	admin_pattern($1, mpd_etc_t)
-	files_list_etc($1)
 
-	files_list_var_lib($1)
-	admin_pattern($1, mpd_var_lib_t)
-
-	admin_pattern($1, mpd_data_t)
+	files_search_var_lib($1)
+	admin_pattern($1, { mpd_data_t mpd_user_data_t mpd_var_lib_t })
 
+	logging_search_logs($1)
 	admin_pattern($1, mpd_log_t)
 
-	fs_list_tmpfs($1)
+	files_search_tmp($1)
+	admin_pattern($1, mpd_tmp_t)
+
+	fs_search_tmpfs($1)
 	admin_pattern($1, mpd_tmpfs_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/mpd.te refpolicy/policy/modules/contrib/mpd.te
--- refpolicy/policy/modules/contrib/mpd.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/mpd.te	2012-11-02 20:08:32.386957427 +0100
@@ -1,15 +1,39 @@
-policy_module(mpd, 1.0.0)
+policy_module(mpd, 1.0.3)
 
 ########################################
 #
 # Declarations
 #
 
+## <desc>
+##	<p>
+##	Determine whether mpd can traverse
+##	user home directories.
+##	</p>
+## </desc>
+gen_tunable(mpd_enable_homedirs, false)
+
+## <desc>
+##	<p>
+##	Determine whether mpd can use
+##	cifs file systems.
+##	</p>
+## </desc>
+gen_tunable(mpd_use_cifs, false)
+
+## <desc>
+##	<p>
+##	Determine whether mpd can use
+##	nfs file systems.
+##	</p>
+## </desc>
+gen_tunable(mpd_use_nfs, false)
+
 type mpd_t;
 type mpd_exec_t;
 init_daemon_domain(mpd_t, mpd_exec_t)
+application_executable_file(mpd_exec_t)
 
-# type for music content
 type mpd_data_t;
 files_type(mpd_data_t)
 
@@ -28,44 +52,58 @@
 type mpd_tmpfs_t;
 files_tmpfs_file(mpd_tmpfs_t)
 
+optional_policy(`
+	pulseaudio_tmpfs_content(mpd_tmpfs_t)
+')
+
 type mpd_var_lib_t;
 files_type(mpd_var_lib_t)
 
+type mpd_user_data_t;
+userdom_user_home_content(mpd_user_data_t) # customizable
+
 ########################################
 #
-# mpd local policy
+# Local policy
 #
 
-# dac_override bug in mpd relating to mpd.log file
 allow mpd_t self:capability { dac_override kill setgid setuid };
 allow mpd_t self:process { getsched setsched setrlimit signal signull };
 allow mpd_t self:fifo_file rw_fifo_file_perms;
-allow mpd_t self:unix_stream_socket { connectto create_stream_socket_perms };
-allow mpd_t self:unix_dgram_socket { create_socket_perms sendto };
-allow mpd_t self:tcp_socket create_stream_socket_perms;
+allow mpd_t self:unix_stream_socket { accept connectto listen };
+allow mpd_t self:unix_dgram_socket sendto;
+allow mpd_t self:tcp_socket { accept listen };
 allow mpd_t self:netlink_kobject_uevent_socket create_socket_perms;
 
-manage_dirs_pattern(mpd_t, mpd_data_t, mpd_data_t)
-manage_files_pattern(mpd_t, mpd_data_t, mpd_data_t)
-manage_lnk_files_pattern(mpd_t, mpd_data_t, mpd_data_t)
+allow mpd_t mpd_data_t:dir manage_dir_perms;
+allow mpd_t mpd_data_t:file manage_file_perms;
+allow mpd_t mpd_data_t:lnk_file read_lnk_file_perms;
 
 read_files_pattern(mpd_t, mpd_etc_t, mpd_etc_t)
 
+allow mpd_t mpd_log_t:dir setattr_dir_perms;
+append_files_pattern(mpd_t, mpd_log_t, mpd_log_t)
+create_files_pattern(mpd_t, mpd_log_t, mpd_log_t)
+setattr_files_pattern(mpd_t, mpd_log_t, mpd_log_t)
+logging_log_filetrans(mpd_t, mpd_log_t, { dir file })
+
 manage_dirs_pattern(mpd_t, mpd_tmp_t, mpd_tmp_t)
 manage_files_pattern(mpd_t, mpd_tmp_t, mpd_tmp_t)
 manage_sock_files_pattern(mpd_t, mpd_tmp_t, mpd_tmp_t)
 files_tmp_filetrans(mpd_t, mpd_tmp_t, { dir file sock_file })
 
-manage_files_pattern(mpd_t, mpd_tmpfs_t, mpd_tmpfs_t)
-manage_dirs_pattern(mpd_t, mpd_tmpfs_t, mpd_tmpfs_t)
-fs_tmpfs_filetrans(mpd_t, mpd_tmpfs_t, file )
+allow mpd_t mpd_tmpfs_t:file manage_file_perms;
+fs_tmpfs_filetrans(mpd_t, mpd_tmpfs_t, file)
+
+allow mpd_t mpd_user_data_t:dir list_dir_perms;
+allow mpd_t mpd_user_data_t:file read_file_perms;
+allow mpd_t mpd_user_data_t:lnk_file read_lnk_file_perms;
 
 manage_dirs_pattern(mpd_t, mpd_var_lib_t, mpd_var_lib_t)
 manage_files_pattern(mpd_t, mpd_var_lib_t, mpd_var_lib_t)
 manage_lnk_files_pattern(mpd_t, mpd_var_lib_t, mpd_var_lib_t)
-files_var_lib_filetrans(mpd_t, mpd_var_lib_t, { dir file lnk_file })
+files_var_lib_filetrans(mpd_t, mpd_var_lib_t, dir)
 
-# needed by pulseaudio
 kernel_getattr_proc(mpd_t)
 kernel_read_system_state(mpd_t)
 kernel_read_kernel_sysctls(mpd_t)
@@ -76,16 +114,25 @@
 corenet_all_recvfrom_netlabel(mpd_t)
 corenet_tcp_sendrecv_generic_if(mpd_t)
 corenet_tcp_sendrecv_generic_node(mpd_t)
+corenet_tcp_bind_generic_node(mpd_t)
+
+corenet_sendrecv_mpd_server_packets(mpd_t)
 corenet_tcp_bind_mpd_port(mpd_t)
+corenet_tcp_sendrecv_mpd_port(mpd_t)
+
+corenet_sendrecv_soundd_server_packets(mpd_t)
 corenet_tcp_bind_soundd_port(mpd_t)
-corenet_tcp_connect_http_port(mpd_t)
-corenet_tcp_connect_http_cache_port(mpd_t)
-corenet_tcp_connect_pulseaudio_port(mpd_t)
+corenet_sendrecv_soundd_client_packets(mpd_t)
 corenet_tcp_connect_soundd_port(mpd_t)
+corenet_tcp_sendrecv_soundd_port(mpd_t)
+
 corenet_sendrecv_http_client_packets(mpd_t)
+corenet_tcp_connect_http_port(mpd_t)
+corenet_tcp_sendrecv_http_port(mpd_t)
+
 corenet_sendrecv_http_cache_client_packets(mpd_t)
-corenet_sendrecv_pulseaudio_client_packets(mpd_t)
-corenet_sendrecv_soundd_client_packets(mpd_t)
+corenet_tcp_connect_http_cache_port(mpd_t)
+corenet_tcp_sendrecv_http_cache_port(mpd_t)
 
 dev_read_sound(mpd_t)
 dev_write_sound(mpd_t)
@@ -93,9 +140,10 @@
 
 files_read_usr_files(mpd_t)
 
-fs_getattr_tmpfs(mpd_t)
+fs_getattr_all_fs(mpd_t)
 fs_list_inotifyfs(mpd_t)
 fs_rw_anon_inodefs_files(mpd_t)
+fs_search_auto_mountpoints(mpd_t)
 
 auth_use_nsswitch(mpd_t)
 
@@ -103,24 +151,57 @@
 
 miscfiles_read_localization(mpd_t)
 
+tunable_policy(`mpd_enable_homedirs',`
+	userdom_search_user_home_dirs(mpd_t)
+')
+
+tunable_policy(`mpd_enable_homedirs && use_nfs_home_dirs',`
+	fs_read_nfs_files(mpd_t)
+	fs_read_nfs_symlinks(mpd_t)
+')
+
+tunable_policy(`mpd_enable_homedirs && use_samba_home_dirs',`
+	fs_read_cifs_files(mpd_t)
+	fs_read_cifs_symlinks(mpd_t)
+')
+
+tunable_policy(`mpd_use_cifs',`
+	fs_manage_cifs_dirs(mpd_t)
+	fs_manage_cifs_files(mpd_t)
+	fs_manage_cifs_symlinks(mpd_t)
+')
+
+tunable_policy(`mpd_use_nfs',`
+	fs_manage_nfs_dirs(mpd_t)
+	fs_manage_nfs_files(mpd_t)
+	fs_manage_nfs_symlinks(mpd_t)
+')
+
 optional_policy(`
 	alsa_read_rw_config(mpd_t)
 ')
 
 optional_policy(`
-	consolekit_dbus_chat(mpd_t)
+	dbus_system_bus_client(mpd_t)
+
+	optional_policy(`
+		consolekit_dbus_chat(mpd_t)
+	')
 ')
 
 optional_policy(`
-	dbus_system_bus_client(mpd_t)
+	pulseaudio_domtrans(mpd_t)
 ')
 
 optional_policy(`
-	pulseaudio_exec(mpd_t)
-	pulseaudio_stream_connect(mpd_t)
-	pulseaudio_signull(mpd_t)
+	rpc_search_nfs_state_data(mpd_t)
 ')
 
 optional_policy(`
 	udev_read_db(mpd_t)
 ')
+
+optional_policy(`
+	xserver_stream_connect(mpd_t)
+	xserver_read_xdm_pid(mpd_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/mplayer.fc refpolicy/policy/modules/contrib/mplayer.fc
--- refpolicy/policy/modules/contrib/mplayer.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/mplayer.fc	2012-10-13 21:33:57.122579406 +0200
@@ -1,14 +1,8 @@
-#
-# /etc
-#
-/etc/mplayer(/.*)?		gen_context(system_u:object_r:mplayer_etc_t,s0)
+HOME_DIR/\.mplayer(/.*)?	gen_context(system_u:object_r:mplayer_home_t,s0)
+
+/etc/mplayer(/.*)?	gen_context(system_u:object_r:mplayer_etc_t,s0)
 
-#
-# /usr
-#
 /usr/bin/mplayer	--	gen_context(system_u:object_r:mplayer_exec_t,s0)
 /usr/bin/mencoder	--	gen_context(system_u:object_r:mencoder_exec_t,s0)
-/usr/bin/vlc		--	gen_context(system_u:object_r:mplayer_exec_t,s0)
-/usr/bin/xine		--	gen_context(system_u:object_r:mplayer_exec_t,s0)
-
-HOME_DIR/\.mplayer(/.*)?	gen_context(system_u:object_r:mplayer_home_t,s0)
+/usr/bin/vlc	--	gen_context(system_u:object_r:mplayer_exec_t,s0)
+/usr/bin/xine	--	gen_context(system_u:object_r:mplayer_exec_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/mplayer.if refpolicy/policy/modules/contrib/mplayer.if
--- refpolicy/policy/modules/contrib/mplayer.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/mplayer.if	2012-10-13 21:33:57.123579406 +0200
@@ -1,4 +1,4 @@
-## <summary>Mplayer media player and encoder</summary>
+## <summary>Mplayer media player and encoder.</summary>
 
 ########################################
 ## <summary>
@@ -17,34 +17,39 @@
 #
 interface(`mplayer_role',`
 	gen_require(`
-		type mencoder_t, mencoder_exec_t;
-		type mplayer_t, mplayer_exec_t;
-		type mplayer_home_t;
+		attribute_role mencoder_roles, mplayer_roles;
+		type mencoder_t, mencoder_exec_t, mplayer_home_t;
+		type mplayer_t, mplayer_exec_t, mplayer_tmpfs_t;
 	')
 
-	role $1 types { mencoder_t mplayer_t };
+	########################################
+	#
+	# Declarations
+	#
+
+	roleattribute $1 mencoder_roles;
+	roleattribute $1 mplayer_roles;
+
+	########################################
+	#
+	# Policy
+	#
 
-	# domain transition
 	domtrans_pattern($2, mencoder_exec_t, mencoder_t)
-
-	# Allow the user domain to signal/ps.
-	ps_process_pattern($2, mencoder_t)
-	allow $2 mencoder_t:process signal_perms;
-
-	# Home access
-	manage_dirs_pattern($2, mplayer_home_t, mplayer_home_t)
-	manage_files_pattern($2, mplayer_home_t, mplayer_home_t)
-	manage_lnk_files_pattern($2, mplayer_home_t, mplayer_home_t)
-	relabel_dirs_pattern($2, mplayer_home_t, mplayer_home_t)
-	relabel_files_pattern($2, mplayer_home_t, mplayer_home_t)
-	relabel_lnk_files_pattern($2, mplayer_home_t, mplayer_home_t)
-
-	# domain transition
 	domtrans_pattern($2, mplayer_exec_t, mplayer_t)
 
-	# Allow the user domain to signal/ps.
-	ps_process_pattern($2, mplayer_t)
-	allow $2 mplayer_t:process signal_perms;
+	allow $2 { mplayer_t mencoder_t }:process { ptrace signal_perms };
+	ps_process_pattern($2, { mplayer_t mencoder_t })
+
+	allow $2 mplayer_home_t:dir { manage_dir_perms relabel_dir_perms };
+	allow $2 mplayer_home_t:file { manage_file_perms relabel_file_perms };
+	allow $2 mplayer_home_t:lnk_file { manage_lnk_file_perms relabel_lnk_file_perms };
+	userdom_user_home_dir_filetrans($2, mplayer_home_t, dir, ".mplayer")
+
+	allow $2 mplayer_tmpfs_t:file { manage_file_perms relabel_file_perms };
+	allow $2 mplayer_tmpfs_t:lnk_file { manage_lnk_file_perms relabel_lnk_file_perms };
+	allow $2 mplayer_tmpfs_t:fifo_file { manage_fifo_file_perms relabel_fifo_file_perms };
+	allow $2 mplayer_tmpfs_t:sock_file { manage_sock_file_perms relabel_sock_file_perms };
 ')
 
 ########################################
@@ -62,6 +67,7 @@
 		type mplayer_t, mplayer_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, mplayer_exec_t, mplayer_t)
 ')
 
@@ -81,12 +87,13 @@
 		type mplayer_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	can_exec($1, mplayer_exec_t)
 ')
 
 ########################################
 ## <summary>
-##	Read mplayer per user homedir
+##	Read mplayer user home content files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -99,6 +106,58 @@
 		type mplayer_home_t;
 	')
 
+	userdom_search_user_home_dirs($1)
 	read_files_pattern($1, mplayer_home_t, mplayer_home_t)
+')
+
+########################################
+## <summary>
+##	Create, read, write, and delete
+##	generic mplayer home content.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`mplayer_manage_generic_home_content',`
+	gen_require(`
+		type mplayer_home_t;
+	')
+
 	userdom_search_user_home_dirs($1)
+	allow $1 mplayer_home_t:dir manage_dir_perms;
+	allow $1 mplayer_home_t:file manage_file_perms;
+	allow $1 mplayer_home_t:lnk_file manage_lnk_file_perms;
+')
+
+########################################
+## <summary>
+##	Create specified objects in user home
+##	directories with the generic mplayer
+##	home type.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="object_class">
+##	<summary>
+##	Class of the object being created.
+##	</summary>
+## </param>
+## <param name="name" optional="true">
+##	<summary>
+##	The name of the object being created.
+##	</summary>
+## </param>
+#
+interface(`mplayer_home_filetrans_mplayer_home',`
+	gen_require(`
+		type mplayer_home_t;
+	')
+
+	userdom_user_home_dir_filetrans($1, mplayer_home_t, $2, $3)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/mplayer.te refpolicy/policy/modules/contrib/mplayer.te
--- refpolicy/policy/modules/contrib/mplayer.te	2012-05-04 15:16:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/mplayer.te	2012-11-06 21:17:57.122011448 +0100
@@ -1,4 +1,4 @@
-policy_module(mplayer, 2.4.0)
+policy_module(mplayer, 2.4.4)
 
 ########################################
 #
@@ -6,23 +6,44 @@
 #
 
 ## <desc>
+##	<p>
+##	Determine whether mplayer can make
+##	its stack executable.
+##	</p>
+## </desc>
+gen_tunable(allow_mplayer_execstack, false)
+
+## <desc>
 ## <p>
-## Allow mplayer executable stack
+## Allow mplayer to read user content
 ## </p>
 ## </desc>
-gen_tunable(allow_mplayer_execstack, false)
+gen_tunable(mplayer_read_user_content, true)
+
+## <desc>
+## <p>
+## Allow mplayer to manage user content
+## </p>
+## </desc>
+gen_tunable(mplayer_manage_user_content, false)
+
+
+attribute_role mencoder_roles;
+attribute_role mplayer_roles;
 
 type mencoder_t;
 type mencoder_exec_t;
 typealias mencoder_t alias { user_mencoder_t staff_mencoder_t sysadm_mencoder_t };
 typealias mencoder_t alias { auditadm_mencoder_t secadm_mencoder_t };
 userdom_user_application_domain(mencoder_t, mencoder_exec_t)
+role mencoder_roles types mencoder_t;
 
 type mplayer_t;
 type mplayer_exec_t;
 typealias mplayer_t alias { user_mplayer_t staff_mplayer_t sysadm_mplayer_t };
 typealias mplayer_t alias { auditadm_mplayer_t secadm_mplayer_t };
 userdom_user_application_domain(mplayer_t, mplayer_exec_t)
+role mplayer_roles types mplayer_t;
 
 type mplayer_etc_t;
 files_config_file(mplayer_etc_t)
@@ -37,55 +58,57 @@
 typealias mplayer_tmpfs_t alias { auditadm_mplayer_tmpfs_t secadm_mplayer_tmpfs_t };
 userdom_user_tmpfs_file(mplayer_tmpfs_t)
 
+optional_policy(`
+	pulseaudio_tmpfs_content(mplayer_tmpfs_t)
+')
+
 ########################################
 #
-# mencoder local policy
+# Mencoder local policy
 #
 
-manage_dirs_pattern(mencoder_t, mplayer_home_t, mplayer_home_t)
-manage_files_pattern(mencoder_t, mplayer_home_t, mplayer_home_t)
-manage_lnk_files_pattern(mencoder_t, mplayer_home_t, mplayer_home_t)
-
-# Read global config
 allow mencoder_t mplayer_etc_t:dir list_dir_perms;
-read_files_pattern(mencoder_t, mplayer_etc_t, mplayer_etc_t)
-read_lnk_files_pattern(mencoder_t, mplayer_etc_t, mplayer_etc_t)
+allow mencoder_t mplayer_etc_t:file read_file_perms;
+allow mencoder_t mplayer_etc_t:lnk_file read_lnk_file_perms;
+
+allow mencoder_t mplayer_home_t:dir manage_dir_perms;
+allow mencoder_t mplayer_home_t:file manage_file_perms;
+allow mencoder_t mplayer_home_t:lnk_file manage_lnk_file_perms;
+userdom_user_home_dir_filetrans(mencoder_t, mplayer_home_t, dir, ".mplayer")
 
-# Read /proc files and directories
-# Necessary for /proc/meminfo, /proc/cpuinfo, etc..
 kernel_read_system_state(mencoder_t)
-# Sysctl on kernel version 
 kernel_read_kernel_sysctls(mencoder_t)
 
-# Required for win32 binary loader 
 dev_rwx_zero(mencoder_t)
-# Access to DVD/CD/V4L
 dev_read_video_dev(mencoder_t)
 
-# Read data in /usr/share (fonts, icons..)
 files_read_usr_files(mencoder_t)
-files_read_usr_symlinks(mencoder_t)
 
 fs_search_auto_mountpoints(mencoder_t)
 
-# Access to DVD/CD/V4L
 storage_raw_read_removable_device(mencoder_t)
 
 miscfiles_read_localization(mencoder_t)
 
 userdom_use_user_terminals(mencoder_t)
-# Handle removable media, /tmp, and /home
-userdom_list_user_tmp(mencoder_t)
-userdom_read_user_tmp_files(mencoder_t)
-userdom_read_user_tmp_symlinks(mencoder_t)
-userdom_read_user_home_content_files(mencoder_t)
-userdom_read_user_home_content_symlinks(mencoder_t)
 
-# Read content to encode
+userdom_manage_user_tmp_dirs(mencoder_t)
+userdom_manage_user_tmp_files(mencoder_t)
+userdom_tmp_filetrans_user_tmp(mplayer_t, { dir file })
+
+userdom_manage_user_home_content_dirs(mencoder_t)
+userdom_manage_user_home_content_files(mencoder_t)
+userdom_user_home_dir_filetrans_user_home_content(mencoder_t, { dir file })
+
 ifndef(`enable_mls',`
+	fs_list_dos(mencoder_t)
+	fs_read_dos_files(mencoder_t)
+
 	fs_search_removable(mencoder_t)
 	fs_read_removable_files(mencoder_t)
 	fs_read_removable_symlinks(mencoder_t)
+
+	fs_read_iso9660_files(mencoder_t)
 ')
 
 tunable_policy(`allow_execmem',`
@@ -101,6 +124,7 @@
 ')
 
 tunable_policy(`use_nfs_home_dirs',`
+	fs_getattr_nfs(mencoder_t)
 	fs_manage_nfs_dirs(mencoder_t)
 	fs_manage_nfs_files(mencoder_t)
 	fs_manage_nfs_symlinks(mencoder_t)
@@ -108,54 +132,29 @@
 ')
 
 tunable_policy(`use_samba_home_dirs',`
+	fs_getattr_cifs(mencoder_t)
 	fs_manage_cifs_dirs(mencoder_t)
 	fs_manage_cifs_files(mencoder_t)
 	fs_manage_cifs_symlinks(mencoder_t)
-
-')
-
-# Read content to encode
-tunable_policy(`use_nfs_home_dirs',`
-	fs_list_auto_mountpoints(mencoder_t)
-	files_list_home(mencoder_t)
-	fs_read_nfs_files(mencoder_t)
-	fs_read_nfs_symlinks(mencoder_t)
-
-',`
-	files_dontaudit_list_home(mencoder_t)
-	fs_dontaudit_list_auto_mountpoints(mencoder_t)
-	fs_dontaudit_read_nfs_files(mencoder_t)
-	fs_dontaudit_list_nfs(mencoder_t)
-')
-
-tunable_policy(`use_samba_home_dirs',`
-	fs_list_auto_mountpoints(mencoder_t)
-	files_list_home(mencoder_t)
-	fs_read_cifs_files(mencoder_t)
-	fs_read_cifs_symlinks(mencoder_t)
-',`
-	files_dontaudit_list_home(mencoder_t)
-	fs_dontaudit_list_auto_mountpoints(mencoder_t)
-	fs_dontaudit_read_cifs_files(mencoder_t)
-	fs_dontaudit_list_cifs(mencoder_t)
 ')
 
 ########################################
 #
-# mplayer local policy
+# Mplayer local policy
 #
 
 allow mplayer_t self:process { signal_perms getsched };
 allow mplayer_t self:fifo_file rw_fifo_file_perms;
 allow mplayer_t self:sem create_sem_perms;
-allow mplayer_t self:netlink_route_socket create_netlink_socket_perms;
-allow mplayer_t self:tcp_socket create_socket_perms;
-allow mplayer_t self:unix_dgram_socket sendto;
-
-manage_dirs_pattern(mplayer_t, mplayer_home_t, mplayer_home_t)
-manage_files_pattern(mplayer_t, mplayer_home_t, mplayer_home_t)
-manage_lnk_files_pattern(mplayer_t, mplayer_home_t, mplayer_home_t)
-userdom_user_home_dir_filetrans(mplayer_t, mplayer_home_t, dir)
+
+allow mplayer_t mplayer_etc_t:dir list_dir_perms;
+allow mplayer_t mplayer_etc_t:file read_file_perms;
+allow mplayer_t mplayer_etc_t:lnk_file read_lnk_file_perms;
+
+allow mplayer_t mplayer_home_t:dir manage_dir_perms;
+allow mplayer_t mplayer_home_t:file manage_file_perms;
+allow mplayer_t mplayer_home_t:lnk_file manage_lnk_file_perms;
+userdom_user_home_dir_filetrans(mplayer_t, mplayer_home_t, dir, ".mplayer")
 
 manage_files_pattern(mplayer_t, mplayer_tmpfs_t, mplayer_tmpfs_t)
 manage_lnk_files_pattern(mplayer_t, mplayer_tmpfs_t, mplayer_tmpfs_t)
@@ -163,84 +162,81 @@
 manage_sock_files_pattern(mplayer_t, mplayer_tmpfs_t, mplayer_tmpfs_t)
 fs_tmpfs_filetrans(mplayer_t, mplayer_tmpfs_t,{ dir file lnk_file sock_file fifo_file })
 
-# Read global config
-allow mplayer_t mplayer_etc_t:dir list_dir_perms;
-read_files_pattern(mplayer_t, mplayer_etc_t, mplayer_etc_t)
-read_lnk_files_pattern(mplayer_t, mplayer_etc_t, mplayer_etc_t)
-
 kernel_dontaudit_list_unlabeled(mplayer_t)
 kernel_dontaudit_getattr_unlabeled_files(mplayer_t)
 kernel_dontaudit_read_unlabeled_files(mplayer_t)
-# Necessary for /proc/meminfo, /proc/cpuinfo, etc..
 kernel_read_system_state(mplayer_t)
-# Sysctl on kernel version 
 kernel_read_kernel_sysctls(mplayer_t)
 
-corenet_all_recvfrom_netlabel(mplayer_t)
-corenet_all_recvfrom_unlabeled(mplayer_t)
-corenet_tcp_sendrecv_generic_if(mplayer_t)
-corenet_tcp_sendrecv_generic_node(mplayer_t)
-corenet_tcp_bind_generic_node(mplayer_t)
-corenet_tcp_connect_pulseaudio_port(mplayer_t)
-corenet_sendrecv_pulseaudio_client_packets(mplayer_t)
-
-# Run bash/sed (??) 
 corecmd_exec_bin(mplayer_t)
 corecmd_exec_shell(mplayer_t)
 
 dev_read_rand(mplayer_t)
+dev_read_realtime_clock(mplayer_t)
+dev_read_sound_mixer(mplayer_t)
 dev_read_urand(mplayer_t)
-# Required for win32 binary loader 
-dev_rwx_zero(mplayer_t)
-# Access to DVD/CD/V4L
 dev_read_video_dev(mplayer_t)
-dev_write_video_dev(mplayer_t)
-# Audio, alsa.conf
-dev_read_sound_mixer(mplayer_t)
 dev_write_sound_mixer(mplayer_t)
-# RTC clock 
-dev_read_realtime_clock(mplayer_t)
+dev_write_video_dev(mplayer_t)
+dev_rwx_zero(mplayer_t)
 
 domain_use_interactive_fds(mplayer_t)
 
-# Access to DVD/CD/V4L
 storage_raw_read_removable_device(mplayer_t)
 
-files_read_etc_files(mplayer_t)
 files_dontaudit_list_non_security(mplayer_t)
 files_dontaudit_getattr_non_security_files(mplayer_t)
 files_read_non_security_files(mplayer_t)
-# Unfortunately the ancient file dialog starts in /
 files_list_home(mplayer_t)
-# Read /etc/mtab
 files_read_etc_runtime_files(mplayer_t)
-# Read data in /usr/share (fonts, icons..)
 files_read_usr_files(mplayer_t)
-files_read_usr_symlinks(mplayer_t)
 
-fs_dontaudit_getattr_all_fs(mplayer_t)
+fs_getattr_all_fs(mplayer_t)
 fs_search_auto_mountpoints(mplayer_t)
 fs_list_inotifyfs(mplayer_t)
 
+auth_use_nsswitch(mplayer_t)
+
+logging_send_syslog_msg(mplayer_t)
+
 miscfiles_read_localization(mplayer_t)
 miscfiles_read_fonts(mplayer_t)
 
 userdom_use_user_terminals(mplayer_t)
-# Read media files
-userdom_list_user_tmp(mplayer_t)
-userdom_read_user_tmp_files(mplayer_t)
-userdom_read_user_tmp_symlinks(mplayer_t)
-userdom_read_user_home_content_files(mplayer_t)
-userdom_read_user_home_content_symlinks(mplayer_t)
-userdom_write_user_tmp_sockets(mplayer_t)
 
 xserver_user_x_domain_template(mplayer, mplayer_t, mplayer_tmpfs_t)
 
-# Read songs
-ifdef(`enable_mls',`',`
+ifdef(`distro_gentoo',`
+	alsa_domain(mplayer_t, mplayer_tmpfs_t)
+
+	xdg_manage_videos_home(mplayer_t)
+
+	tunable_policy(`mplayer_read_user_content',`
+		userdom_read_user_home_content_files(mplayer_t)
+		userdom_read_user_home_content_symlinks(mplayer_t)
+	')
+
+	tunable_policy(`mplayer_manage_user_content',`
+		userdom_manage_user_tmp_dirs(mplayer_t)
+		userdom_manage_user_tmp_files(mplayer_t)
+		userdom_user_home_dir_filetrans_user_home_content(mplayer_t, { dir file })
+
+		userdom_manage_user_home_content_dirs(mplayer_t)
+		userdom_manage_user_home_content_files(mplayer_t)
+
+		userdom_write_user_tmp_sockets(mplayer_t)
+	')
+')
+
+ifndef(`enable_mls',`
+	fs_list_dos(mplayer_t)
+	fs_read_dos_files(mplayer_t)
+
 	fs_search_removable(mplayer_t)
 	fs_read_removable_files(mplayer_t)
 	fs_read_removable_symlinks(mplayer_t)
+
+	fs_read_iso9660_files(mplayer_t)
 ')
 
 tunable_policy(`allow_execmem',`
@@ -260,52 +256,21 @@
 	fs_manage_nfs_files(mplayer_t)
 	fs_manage_nfs_symlinks(mplayer_t)
 ')
+
 tunable_policy(`use_samba_home_dirs',`
 	fs_manage_cifs_dirs(mplayer_t)
 	fs_manage_cifs_files(mplayer_t)
 	fs_manage_cifs_symlinks(mplayer_t)
 ')
 
-# Legacy domain issues
 tunable_policy(`allow_mplayer_execstack',`
 	allow mplayer_t mplayer_tmpfs_t:file execute;
 ')
 
-# Read songs
-tunable_policy(`use_nfs_home_dirs',`
-	fs_list_auto_mountpoints(mplayer_t)
-	files_list_home(mplayer_t)
-	fs_read_nfs_files(mplayer_t)
-	fs_read_nfs_symlinks(mplayer_t)
-
-',`
-	files_dontaudit_list_home(mplayer_t)
-	fs_dontaudit_list_auto_mountpoints(mplayer_t)
-	fs_dontaudit_read_nfs_files(mplayer_t)
-	fs_dontaudit_list_nfs(mplayer_t)
-')
-
-tunable_policy(`use_samba_home_dirs',`
-	fs_list_auto_mountpoints(mplayer_t)
-	files_list_home(mplayer_t)
-	fs_read_cifs_files(mplayer_t)
-	fs_read_cifs_symlinks(mplayer_t)
-',`
-	files_dontaudit_list_home(mplayer_t)
-	fs_dontaudit_list_auto_mountpoints(mplayer_t)
-	fs_dontaudit_read_cifs_files(mplayer_t)
-	fs_dontaudit_list_cifs(mplayer_t)
-')
-
 optional_policy(`
 	alsa_read_rw_config(mplayer_t)
 ')
 
 optional_policy(`
-	nscd_socket_use(mplayer_t)
-')
-
-optional_policy(`
-	pulseaudio_exec(mplayer_t)
-	pulseaudio_stream_connect(mplayer_t)
+	pulseaudio_run(mplayer_t, mplayer_roles)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/mrtg.fc refpolicy/policy/modules/contrib/mrtg.fc
--- refpolicy/policy/modules/contrib/mrtg.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/mrtg.fc	2012-10-13 21:41:12.698580335 +0200
@@ -1,18 +1,15 @@
-#
-# /etc
-#
-/etc/mrtg.*			gen_context(system_u:object_r:mrtg_etc_t,s0)
-
-#
-# /usr
-#
-/usr/bin/mrtg		--	gen_context(system_u:object_r:mrtg_exec_t,s0)
+/etc/mrtg.*	gen_context(system_u:object_r:mrtg_etc_t,s0)
 /etc/mrtg/mrtg\.ok	--	gen_context(system_u:object_r:mrtg_lock_t,s0)
 
-#
-# /var
-#
-/var/lib/mrtg(/.*)?		gen_context(system_u:object_r:mrtg_var_lib_t,s0)
-/var/lock/mrtg(/.*)?		gen_context(system_u:object_r:mrtg_lock_t,s0)
-/var/log/mrtg(/.*)?		gen_context(system_u:object_r:mrtg_log_t,s0)
-/var/run/mrtg\.pid		gen_context(system_u:object_r:mrtg_var_run_t,s0)
+/etc/rc\.d/init\.d/mrtg	--	gen_context(system_u:object_r:mrtg_initrc_exec_t,s0)
+
+/usr/bin/mrtg	--	gen_context(system_u:object_r:mrtg_exec_t,s0)
+
+/var/lib/mrtg(/.*)?	gen_context(system_u:object_r:mrtg_var_lib_t,s0)
+
+/var/lock/mrtg(/.*)?	gen_context(system_u:object_r:mrtg_lock_t,s0)
+/var/lock/subsys/mrtg	--	gen_context(system_u:object_r:mrtg_lock_t,s0)
+
+/var/log/mrtg.*	gen_context(system_u:object_r:mrtg_log_t,s0)
+
+/var/run/mrtg\.pid	--	gen_context(system_u:object_r:mrtg_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/mrtg.if refpolicy/policy/modules/contrib/mrtg.if
--- refpolicy/policy/modules/contrib/mrtg.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/mrtg.if	2012-10-13 21:41:12.698580335 +0200
@@ -1,8 +1,8 @@
-## <summary>Network traffic graphing</summary>
+## <summary>Network traffic graphing.</summary>
 
 ########################################
 ## <summary>
-##	Create and append mrtg logs.
+##	Create and append mrtg log files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -15,6 +15,55 @@
 		type mrtg_log_t;
 	')
 
+	logging_search_logs($1)
 	append_files_pattern($1, mrtg_log_t, mrtg_log_t)
 	create_files_pattern($1, mrtg_log_t, mrtg_log_t)
 ')
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an mrtg environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`mrtg_admin',`
+	gen_require(`
+		type mrtg_t, mrtg_var_run_t, mrtg_initrc_exec_t;
+		type mrtg_var_lib_t, mrtg_lock_t, mrtg_log_t;
+		type mrtg_etc_t;
+	')
+
+	allow $1 mrtg_t:process { ptrace signal_perms };
+	ps_process_pattern($1, mrtg_t)
+
+	init_labeled_script_domtrans($1, mrtg_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 mrtg_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	files_search_etc($1)
+	admin_pattern($1, mrtg_etc_t)
+
+	files_search_locks($1)
+	admin_pattern($1, mrtg_lock_t)
+
+	logging_search_logs($1)
+	admin_pattern($1, mrtg_log_t)
+
+	files_search_pids($1)
+	admin_pattern($1, mrtg_var_run_t)
+
+	files_search_var_lib($1)
+	admin_pattern($1, mrtg_var_lib_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/mrtg.te refpolicy/policy/modules/contrib/mrtg.te
--- refpolicy/policy/modules/contrib/mrtg.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/mrtg.te	2012-10-13 21:41:12.699580335 +0200
@@ -1,4 +1,4 @@
-policy_module(mrtg, 1.8.0)
+policy_module(mrtg, 1.8.1)
 
 ########################################
 #
@@ -9,6 +9,9 @@
 type mrtg_exec_t;
 init_system_domain(mrtg_t, mrtg_exec_t)
 
+type mrtg_initrc_exec_t;
+init_script_file(mrtg_initrc_exec_t)
+
 type mrtg_etc_t;
 files_config_file(mrtg_etc_t)
 
@@ -33,21 +36,21 @@
 dontaudit mrtg_t self:capability sys_tty_config;
 allow mrtg_t self:process signal_perms;
 allow mrtg_t self:fifo_file rw_fifo_file_perms;
-allow mrtg_t self:unix_stream_socket create_socket_perms;
-allow mrtg_t self:tcp_socket create_socket_perms;
-allow mrtg_t self:udp_socket create_socket_perms;
 
 allow mrtg_t mrtg_etc_t:dir list_dir_perms;
-read_files_pattern(mrtg_t, mrtg_etc_t, mrtg_etc_t)
-read_lnk_files_pattern(mrtg_t, mrtg_etc_t, mrtg_etc_t)
-dontaudit mrtg_t mrtg_etc_t:dir write;
-dontaudit mrtg_t mrtg_etc_t:file { write ioctl };
-
-manage_files_pattern(mrtg_t, mrtg_lock_t, mrtg_lock_t)
-manage_lnk_files_pattern(mrtg_t, mrtg_lock_t, mrtg_lock_t)
+allow mrtg_t mrtg_etc_t:file read_file_perms;
+allow mrtg_t mrtg_etc_t:lnk_file read_lnk_file_perms;
 
-manage_files_pattern(mrtg_t, mrtg_log_t, mrtg_log_t)
-logging_log_filetrans(mrtg_t, mrtg_log_t, { file dir })
+allow mrtg_t mrtg_lock_t:dir manage_dir_perms;
+allow mrtg_t mrtg_lock_t:file manage_file_perms;
+allow mrtg_t mrtg_lock_t:lnk_file manage_lnk_file_perms;
+files_lock_filetrans(mrtg_t, mrtg_lock_t, { dir file })
+
+manage_dirs_pattern(mrtg_t, mrtg_log_t, mrtg_log_t)
+append_files_pattern(mrtg_t, mrtg_log_t, mrtg_log_t)
+create_files_pattern(mrtg_t, mrtg_log_t, mrtg_log_t)
+setattr_files_pattern(mrtg_t, mrtg_log_t, mrtg_log_t)
+logging_log_filetrans(mrtg_t, mrtg_log_t, { dir file })
 
 manage_files_pattern(mrtg_t, mrtg_var_lib_t, mrtg_var_lib_t)
 manage_lnk_files_pattern(mrtg_t, mrtg_var_lib_t, mrtg_var_lib_t)
@@ -65,13 +68,11 @@
 corenet_all_recvfrom_unlabeled(mrtg_t)
 corenet_all_recvfrom_netlabel(mrtg_t)
 corenet_tcp_sendrecv_generic_if(mrtg_t)
-corenet_udp_sendrecv_generic_if(mrtg_t)
 corenet_tcp_sendrecv_generic_node(mrtg_t)
-corenet_udp_sendrecv_generic_node(mrtg_t)
-corenet_tcp_sendrecv_all_ports(mrtg_t)
-corenet_udp_sendrecv_all_ports(mrtg_t)
-corenet_tcp_connect_all_ports(mrtg_t)
+
 corenet_sendrecv_all_client_packets(mrtg_t)
+corenet_tcp_connect_all_ports(mrtg_t)
+corenet_tcp_sendrecv_all_ports(mrtg_t)
 
 dev_read_sysfs(mrtg_t)
 dev_read_urand(mrtg_t)
@@ -79,26 +80,22 @@
 domain_use_interactive_fds(mrtg_t)
 domain_dontaudit_search_all_domains_state(mrtg_t)
 
+files_getattr_tmp_dirs(mrtg_t)
+files_read_etc_runtime_files(mrtg_t)
 files_read_usr_files(mrtg_t)
 files_search_var(mrtg_t)
 files_search_locks(mrtg_t)
 files_search_var_lib(mrtg_t)
 files_search_spool(mrtg_t)
-files_getattr_tmp_dirs(mrtg_t)
-# for uptime
-files_read_etc_runtime_files(mrtg_t)
-# read config files
-files_read_etc_files(mrtg_t)
 
 fs_search_auto_mountpoints(mrtg_t)
-fs_getattr_xattr_fs(mrtg_t)
+fs_getattr_all_fs(mrtg_t)
 fs_list_inotifyfs(mrtg_t)
 
 term_dontaudit_use_console(mrtg_t)
 
 init_use_fds(mrtg_t)
 init_use_script_ptys(mrtg_t)
-# for uptime
 init_read_utmp(mrtg_t)
 init_dontaudit_write_utmp(mrtg_t)
 
@@ -122,11 +119,6 @@
 	corenet_udp_sendrecv_lo_if(mrtg_t)
 ')
 
-ifdef(`distro_redhat',`
-	allow mrtg_t mrtg_lock_t:file manage_file_perms;
-	filetrans_pattern(mrtg_t, mrtg_etc_t, mrtg_lock_t, file)
-')
-
 optional_policy(`
 	apache_manage_sys_content(mrtg_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/mta.fc refpolicy/policy/modules/contrib/mta.fc
--- refpolicy/policy/modules/contrib/mta.fc	2012-05-04 16:18:44.000000000 +0200
+++ refpolicy/policy/modules/contrib/mta.fc	2012-10-30 19:32:35.013399575 +0100
@@ -1,30 +1,33 @@
-HOME_DIR/\.forward	--	gen_context(system_u:object_r:mail_forward_t,s0)
+HOME_DIR/\.esmtp_queue	--	gen_context(system_u:object_r:mail_home_t,s0)
+HOME_DIR/\.forward[^/]*	--	gen_context(system_u:object_r:mail_home_t,s0)
+HOME_DIR/dead\.letter	--	gen_context(system_u:object_r:mail_home_t,s0)
+HOME_DIR/\.mailrc	--	gen_context(system_u:object_r:mail_home_t,s0)
+HOME_DIR/Maildir(/.*)?	gen_context(system_u:object_r:mail_home_rw_t,s0)
 
-/bin/mail(x)?		--	gen_context(system_u:object_r:sendmail_exec_t,s0)
+/bin/mail(x)?	--	gen_context(system_u:object_r:sendmail_exec_t,s0)
 
-/etc/aliases		--	gen_context(system_u:object_r:etc_aliases_t,s0)
+/etc/aliases	--	gen_context(system_u:object_r:etc_aliases_t,s0)
 /etc/aliases\.db	--	gen_context(system_u:object_r:etc_aliases_t,s0)
-/etc/mail(/.*)?			gen_context(system_u:object_r:etc_mail_t,s0)
-/etc/mail/aliases	--	gen_context(system_u:object_r:etc_aliases_t,s0)
-/etc/mail/aliases\.db	--	gen_context(system_u:object_r:etc_aliases_t,s0)
-ifdef(`distro_redhat',`
-/etc/postfix/aliases.*		gen_context(system_u:object_r:etc_aliases_t,s0)
-')
+/etc/mail(/.*)?	gen_context(system_u:object_r:etc_mail_t,s0)
+/etc/mail/aliases.*	--	gen_context(system_u:object_r:etc_aliases_t,s0)
+/etc/postfix/aliases.*	--	gen_context(system_u:object_r:etc_aliases_t,s0)
 
-/usr/bin/esmtp		--	gen_context(system_u:object_r:sendmail_exec_t,s0)
+/usr/bin/esmtp	--	gen_context(system_u:object_r:sendmail_exec_t,s0)
+/usr/bin/mail(x)?	--	gen_context(system_u:object_r:sendmail_exec_t,s0)
 
 /usr/lib/sendmail	--	gen_context(system_u:object_r:sendmail_exec_t,s0)
-/usr/lib/courier/bin/sendmail -- gen_context(system_u:object_r:sendmail_exec_t,s0)
+/usr/lib/courier/bin/sendmail	--	gen_context(system_u:object_r:sendmail_exec_t,s0)
 
-/usr/sbin/rmail		--	gen_context(system_u:object_r:sendmail_exec_t,s0)
-/usr/sbin/sendmail\.postfix --	gen_context(system_u:object_r:sendmail_exec_t,s0)
-/usr/sbin/sendmail(\.sendmail)? -- gen_context(system_u:object_r:sendmail_exec_t,s0)
-/usr/sbin/ssmtp 		-- gen_context(system_u:object_r:sendmail_exec_t,s0)
+/usr/sbin/rmail	--	gen_context(system_u:object_r:sendmail_exec_t,s0)
+/usr/sbin/sendmail\.postfix	--	gen_context(system_u:object_r:sendmail_exec_t,s0)
+/usr/sbin/sendmail(\.sendmail)?	--	gen_context(system_u:object_r:sendmail_exec_t,s0)
+/usr/sbin/ssmtp	--	gen_context(system_u:object_r:sendmail_exec_t,s0)
 
-/var/mail(/.*)?			gen_context(system_u:object_r:mail_spool_t,s0)
+/var/mail(/.*)?	gen_context(system_u:object_r:mail_spool_t,s0)
 
 /var/qmail/bin/sendmail	--	gen_context(system_u:object_r:sendmail_exec_t,s0)
 
-/var/spool/imap(/.*)?		gen_context(system_u:object_r:mail_spool_t,s0)
-/var/spool/(client)?mqueue(/.*)? gen_context(system_u:object_r:mqueue_spool_t,s0)
-/var/spool/mail(/.*)?		gen_context(system_u:object_r:mail_spool_t,s0)
+/var/spool/imap(/.*)?	gen_context(system_u:object_r:mail_spool_t,s0)
+/var/spool/(client)?mqueue(/.*)?	gen_context(system_u:object_r:mqueue_spool_t,s0)
+/var/spool/mqueue\.in(/.*)?	gen_context(system_u:object_r:mqueue_spool_t,s0)
+/var/spool/mail(/.*)?	gen_context(system_u:object_r:mail_spool_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/mta.if refpolicy/policy/modules/contrib/mta.if
--- refpolicy/policy/modules/contrib/mta.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/mta.if	2012-11-02 20:05:03.106956972 +0100
@@ -1,4 +1,4 @@
-## <summary>Policy common to all email tranfer agents.</summary>
+## <summary>Common e-mail transfer agent policy.</summary>
 
 ########################################
 ## <summary>
@@ -18,36 +18,23 @@
 
 #######################################
 ## <summary>
-##	Basic mail transfer agent domain template.
+##	The template to define a mail domain.
 ## </summary>
-## <desc>
-##	<p>
-##	This template creates a derived domain which is
-##	a email transfer agent, which sends mail on
-##	behalf of the user.
-##	</p>
-##	<p>
-##	This is the basic types and rules, common
-##	to the system agent and user agents.
-##	</p>
-## </desc>
 ## <param name="domain_prefix">
 ##	<summary>
-##	The prefix of the domain (e.g., user
-##	is the prefix for user_t).
+##	Domain prefix to be used.
 ##	</summary>
 ## </param>
 #
 template(`mta_base_mail_template',`
-
 	gen_require(`
 		attribute user_mail_domain;
 		type sendmail_exec_t;
 	')
 
-	##############################
+	########################################
 	#
-	# $1_mail_t declarations
+	# Declarations
 	#
 
 	type $1_mail_t, user_mail_domain;
@@ -56,124 +43,78 @@
 	type $1_mail_tmp_t;
 	files_tmp_file($1_mail_tmp_t)
 
-	##############################
+	########################################
 	#
-	# $1_mail_t local policy
+	# Declarations
 	#
 
-	allow $1_mail_t self:capability { setuid setgid chown };
-	allow $1_mail_t self:process { signal_perms setrlimit };
-	allow $1_mail_t self:tcp_socket create_socket_perms;
-
-	# re-exec itself
-	can_exec($1_mail_t, sendmail_exec_t)
-	allow $1_mail_t sendmail_exec_t:lnk_file read_lnk_file_perms;
-
-	kernel_read_system_state($1_mail_t)
-	kernel_read_kernel_sysctls($1_mail_t)
-
-	corenet_all_recvfrom_unlabeled($1_mail_t)
-	corenet_all_recvfrom_netlabel($1_mail_t)
-	corenet_tcp_sendrecv_generic_if($1_mail_t)
-	corenet_tcp_sendrecv_generic_node($1_mail_t)
-	corenet_tcp_sendrecv_all_ports($1_mail_t)
-	corenet_tcp_connect_all_ports($1_mail_t)
-	corenet_tcp_connect_smtp_port($1_mail_t)
-	corenet_sendrecv_smtp_client_packets($1_mail_t)
-
-	corecmd_exec_bin($1_mail_t)
-
-	files_read_etc_files($1_mail_t)
-	files_search_spool($1_mail_t)
-	# It wants to check for nscd
-	files_dontaudit_search_pids($1_mail_t)
+	manage_dirs_pattern($1_mail_t, $1_mail_tmp_t, $1_mail_tmp_t)
+	manage_files_pattern($1_mail_t, $1_mail_tmp_t, $1_mail_tmp_t)
+	files_tmp_filetrans($1_mail_t, $1_mail_tmp_t, { file dir })
 
 	auth_use_nsswitch($1_mail_t)
 
-	init_dontaudit_rw_utmp($1_mail_t)
-
-	logging_send_syslog_msg($1_mail_t)
-
-	miscfiles_read_localization($1_mail_t)
-
-	optional_policy(`
-		exim_read_log($1_mail_t)
-		exim_append_log($1_mail_t)
-		exim_manage_spool_files($1_mail_t)
-	')
-
 	optional_policy(`
 		postfix_domtrans_user_mail_handler($1_mail_t)
 	')
-
-	optional_policy(`
-		procmail_exec($1_mail_t)
-	')
-
-	optional_policy(`
-		qmail_domtrans_inject($1_mail_t)
-	')
-
-	optional_policy(`
-		gen_require(`
-			type etc_mail_t, mail_spool_t, mqueue_spool_t;
-		')
-
-		manage_dirs_pattern($1_mail_t, $1_mail_tmp_t, $1_mail_tmp_t)
-		manage_files_pattern($1_mail_t, $1_mail_tmp_t, $1_mail_tmp_t)
-		files_tmp_filetrans($1_mail_t, $1_mail_tmp_t, { file dir })
-
-		allow $1_mail_t etc_mail_t:dir search_dir_perms;
-
-		# Write to /var/spool/mail and /var/spool/mqueue.
-		manage_files_pattern($1_mail_t, mail_spool_t, mail_spool_t)
-		manage_files_pattern($1_mail_t, mqueue_spool_t, mqueue_spool_t)
-
-		# Check available space.
-		fs_getattr_xattr_fs($1_mail_t)
-
-		files_read_etc_runtime_files($1_mail_t)
-
-		# Write to /var/log/sendmail.st
-		sendmail_manage_log($1_mail_t)
-		sendmail_create_log($1_mail_t)
-	')
-
-	optional_policy(`
-		uucp_manage_spool($1_mail_t)
-	')
 ')
 
 ########################################
 ## <summary>
-##	Role access for mta
+##	Role access for mta.
 ## </summary>
 ## <param name="role">
 ##	<summary>
-##	Role allowed access
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <param name="domain">
 ##	<summary>
-##	User domain for the role
+##	User domain for the role.
 ##	</summary>
 ## </param>
 #
 interface(`mta_role',`
 	gen_require(`
 		attribute mta_user_agent;
-		type user_mail_t, sendmail_exec_t;
+		attribute_role user_mail_roles;
+		type user_mail_t, sendmail_exec_t, mail_home_t;
+		type user_mail_tmp_t, mail_home_rw_t;
 	')
 
-	role $1 types { user_mail_t mta_user_agent };
+	roleattribute $1 user_mail_roles;
+
+	# this is something i need to fix
+	# i dont know if and why it is needed
+	# will role attribute work?
+	role $1 types mta_user_agent;
 
-	# Transition from the user domain to the derived domain.
 	domtrans_pattern($2, sendmail_exec_t, user_mail_t)
-	allow $2 sendmail_exec_t:lnk_file { getattr read };
+	allow $2 sendmail_exec_t:lnk_file read_lnk_file_perms;
+
+	allow $2 { user_mail_t mta_user_agent }:process { ptrace signal_perms };
+	ps_process_pattern($2, { user_mail_t mta_user_agent })
+
+	allow $2 mail_home_t:file { manage_file_perms relabel_file_perms };
+	userdom_user_home_dir_filetrans($2, mail_home_t, file, ".esmtp_queue")
+	userdom_user_home_dir_filetrans($2, mail_home_t, file, ".forward")
+	userdom_user_home_dir_filetrans($2, mail_home_t, file, ".mailrc")
+	userdom_user_home_dir_filetrans($2, mail_home_t, file, "dead.letter")
+
+	allow $2 mail_home_rw_t:dir { manage_dir_perms relabel_dir_perms };
+	allow $2 mail_home_rw_t:file { manage_file_perms relabel_file_perms };
+	userdom_user_home_dir_filetrans($2, mail_home_rw_t, dir, "Maildir")
+
+	allow $2 user_mail_tmp_t:dir { manage_dir_perms relabel_dir_perms };
+	allow $2 user_mail_tmp_t:file { manage_file_perms relabel_file_perms };
+
+	optional_policy(`
+		exim_run($2, $1)
+	')
 
-	allow mta_user_agent $2:fd use;
-	allow mta_user_agent $2:process sigchld;
-	allow mta_user_agent $2:fifo_file { read write };
+	optional_policy(`
+		mailman_run($2, $1)
+	')
 ')
 
 ########################################
@@ -220,6 +161,127 @@
 	application_executable_file($1)
 ')
 
+#######################################
+## <summary>
+##	Read mta mail home files.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`mta_read_mail_home_files',`
+	gen_require(`
+		type mail_home_t;
+	')
+
+	userdom_search_user_home_dirs($1)
+	allow $1 mail_home_t:file read_file_perms;
+')
+
+#######################################
+## <summary>
+##	Create, read, write, and delete
+##	mta mail home files.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`mta_manage_mail_home_files',`
+	gen_require(`
+		type mail_home_t;
+	')
+
+	userdom_search_user_home_dirs($1)
+	allow $1 mail_home_t:file manage_file_perms;
+')
+
+########################################
+## <summary>
+##	Create specified objects in user home
+##	directories with the generic mail
+##	home type.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="object_class">
+##	<summary>
+##	Class of the object being created.
+##	</summary>
+## </param>
+## <param name="name" optional="true">
+##	<summary>
+##	The name of the object being created.
+##	</summary>
+## </param>
+#
+interface(`mta_home_filetrans_mail_home',`
+	gen_require(`
+		type mail_home_t;
+	')
+
+	userdom_user_home_dir_filetrans($1, mail_home_t, $2, $3)
+')
+
+#######################################
+## <summary>
+##	Create, read, write, and delete
+##	mta mail home rw content.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`mta_manage_mail_home_rw_content',`
+	gen_require(`
+		type mail_home_rw_t;
+	')
+
+	userdom_search_user_home_dirs($1)
+	manage_dirs_pattern($1, mail_home_rw_t, mail_home_rw_t)
+	manage_files_pattern($1, mail_home_rw_t, mail_home_rw_t)
+	manage_lnk_files_pattern($1, mail_home_rw_t, mail_home_rw_t)
+')
+
+########################################
+## <summary>
+##	Create specified objects in user home
+##	directories with the generic mail
+##	home rw type.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="object_class">
+##	<summary>
+##	Class of the object being created.
+##	</summary>
+## </param>
+## <param name="name" optional="true">
+##	<summary>
+##	The name of the object being created.
+##	</summary>
+## </param>
+#
+interface(`mta_home_filetrans_mail_home_rw',`
+	gen_require(`
+		type mail_home_rw_t;
+	')
+
+	userdom_user_home_dir_filetrans($1, mail_home_rw_t, $2, $3)
+')
+
 ########################################
 ## <summary>
 ##	Make the specified type by a system MTA.
@@ -270,6 +332,7 @@
 	')
 
 	init_system_domain($1, sendmail_exec_t)
+
 	typeattribute $1 mailserver_domain;
 ')
 
@@ -306,7 +369,6 @@
 interface(`mta_mailserver_delivery',`
 	gen_require(`
 		attribute mailserver_delivery;
-		type mail_spool_t;
 	')
 
 	typeattribute $1 mailserver_delivery;
@@ -330,12 +392,6 @@
 	')
 
 	typeattribute $1 mta_user_agent;
-
-	optional_policy(`
-		# apache should set close-on-exec
-		apache_dontaudit_rw_stream_sockets($1)
-		apache_dontaudit_rw_sys_script_stream_sockets($1)
-	')
 ')
 
 ########################################
@@ -350,20 +406,14 @@
 #
 interface(`mta_send_mail',`
 	gen_require(`
-		attribute mta_user_agent;
 		type system_mail_t;
 		attribute mta_exec_type;
 	')
 
-	allow $1 mta_exec_type:lnk_file read_lnk_file_perms;
-	corecmd_read_bin_symlinks($1)
+	corecmd_search_bin($1)
 	domtrans_pattern($1, mta_exec_type, system_mail_t)
 
-	allow mta_user_agent $1:fd use;
-	allow mta_user_agent $1:process sigchld;
-	allow mta_user_agent $1:fifo_file rw_fifo_file_perms;
-
-	dontaudit mta_user_agent $1:unix_stream_socket rw_socket_perms;
+	allow $1 mta_exec_type:lnk_file read_lnk_file_perms;
 ')
 
 ########################################
@@ -396,14 +446,15 @@
 		type sendmail_exec_t;
 	')
 
-	files_search_usr($1)
-	corecmd_read_bin_symlinks($1)
+	corecmd_search_bin($1)
 	domain_auto_trans($1, sendmail_exec_t, $2)
+
+	allow $1 sendmail_exec_t:lnk_file read_lnk_file_perms;
 ')
 
 ########################################
 ## <summary>
-##	Send system mail client a signal
+##	Send signals to system mail.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -422,6 +473,24 @@
 
 ########################################
 ## <summary>
+##	Send kill signals to system mail.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`mta_kill_system_mail',`
+	gen_require(`
+		type system_mail_t;
+	')
+
+	allow $1 system_mail_t:process sigkill;
+')
+
+########################################
+## <summary>
 ##	Execute sendmail in the caller domain.
 ## </summary>
 ## <param name="domain">
@@ -435,12 +504,13 @@
 		type sendmail_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	can_exec($1, sendmail_exec_t)
 ')
 
 ########################################
 ## <summary>
-##	Read mail server configuration.
+##	Read mail server configuration content.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -456,13 +526,13 @@
 
 	files_search_etc($1)
 	allow $1 etc_mail_t:dir list_dir_perms;
-	read_files_pattern($1, etc_mail_t, etc_mail_t)
-	read_lnk_files_pattern($1, etc_mail_t, etc_mail_t)
+	allow $1 etc_mail_t:file read_file_perms;
+	allow $1 etc_mail_t:lnk_file read_lnk_file_perms;
 ')
 
 ########################################
 ## <summary>
-##	write mail server configuration.
+##	Write mail server configuration files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -476,12 +546,13 @@
 		type etc_mail_t;
 	')
 
+	files_search_etc($1)
 	write_files_pattern($1, etc_mail_t, etc_mail_t)
 ')
 
 ########################################
 ## <summary>
-##	Read mail address aliases.
+##	Read mail address alias files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -496,11 +567,21 @@
 
 	files_search_etc($1)
 	allow $1 etc_aliases_t:file read_file_perms;
+
+	ifdef(`distro_gentoo',`
+		gen_require(`
+			type etc_mail_t;
+		')
+
+		search_dirs_pattern($1, etc_mail_t, etc_aliases_t)
+		read_files_pattern($1, etc_mail_t, etc_aliases_t)
+	')
 ')
 
 ########################################
 ## <summary>
-##	Create, read, write, and delete mail address aliases.
+##	Create, read, write, and delete
+##	mail address alias content.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -516,30 +597,86 @@
 	files_search_etc($1)
 	manage_files_pattern($1, etc_aliases_t, etc_aliases_t)
 	manage_lnk_files_pattern($1, etc_aliases_t, etc_aliases_t)
+	
+	ifdef(`distro_gentoo',`
+		gen_require(`
+			type etc_mail_t;
+		')
+
+		search_dirs_pattern($1, etc_mail_t, etc_aliases_t)
+		manage_files_pattern($1, etc_mail_t, etc_aliases_t)
+		manage_lnk_files_pattern($1, etc_mail_t, etc_aliases_t)
+	')
 ')
 
 ########################################
 ## <summary>
-##	Type transition files created in /etc
-##	to the mail address aliases type.
+##	Create specified object in generic
+##	etc directories with the mail address
+##	alias type.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
 ##	Domain allowed access.
 ##	</summary>
 ## </param>
+## <param name="object">
+##	<summary>
+##	The object class of the object being created.
+##	</summary>
+## </param>
+## <param name="name" optional="true">
+##	<summary>
+##	The name of the object being created.
+##	</summary>
+## </param>
 #
 interface(`mta_etc_filetrans_aliases',`
 	gen_require(`
 		type etc_aliases_t;
 	')
 
-	files_etc_filetrans($1, etc_aliases_t, file)
+	files_etc_filetrans($1, etc_aliases_t, $2, $3)
 ')
 
 ########################################
 ## <summary>
-##	Read and write mail aliases.
+##	Create specified objects in specified
+##	directories with a type transition to
+##	the mail address alias type.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="file_type">
+##	<summary>
+##	Directory to transition on.
+##	</summary>
+## </param>
+## <param name="object">
+##	<summary>
+##	The object class of the object being created.
+##	</summary>
+## </param>
+## <param name="name" optional="true">
+##	<summary>
+##	The name of the object being created.
+##	</summary>
+## </param>
+#
+interface(`mta_spec_filetrans_aliases',`
+	gen_require(`
+		type etc_aliases_t;
+	')
+
+	filetrans_pattern($1, $2, etc_aliases_t, $3, $4)
+')
+
+########################################
+## <summary>
+##	Read and write mail alias files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -554,13 +691,23 @@
 	')
 
 	files_search_etc($1)
-	allow $1 etc_aliases_t:file { rw_file_perms setattr };
+	allow $1 etc_aliases_t:file rw_file_perms;
+
+	ifdef(`distro_gentoo',`
+		gen_require(`
+			type etc_mail_t;
+		')
+
+		search_dirs_pattern($1, etc_mail_t, etc_aliases_t)
+		rw_files_pattern($1, etc_mail_t, etc_aliases_t)
+	')
 ')
 
 #######################################
 ## <summary>
-##	Do not audit attempts to read and write TCP
-##	sockets of mail delivery domains.
+##	Do not audit attempts to read
+##	and write TCP sockets of mail
+##	delivery domains.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -592,8 +739,8 @@
 
 #######################################
 ## <summary>
-##	Do not audit attempts to read a symlink
-##	in the mail spool.
+##	Do not audit attempts to read
+##	mail spool symlinks.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -611,7 +758,7 @@
 
 ########################################
 ## <summary>
-##	Get the attributes of mail spool files.
+##	Get attributes of mail spool content.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -632,8 +779,8 @@
 
 ########################################
 ## <summary>
-##	Do not audit attempts to get the attributes
-##	of mail spool files.
+##	Do not audit attempts to get
+##	attributes of mail spool files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -648,14 +795,15 @@
 
 	files_dontaudit_search_spool($1)
 	dontaudit $1 mail_spool_t:dir search_dir_perms;
-	dontaudit $1 mail_spool_t:lnk_file read;
-	dontaudit $1 mail_spool_t:file getattr;
+	dontaudit $1 mail_spool_t:lnk_file read_lnk_file_perms;
+	dontaudit $1 mail_spool_t:file getattr_file_perms;
 ')
 
 #######################################
 ## <summary>
-##	Create private objects in the
-##	mail spool directory.
+##	Create specified objects in the
+##	mail spool directory with a
+##	private type.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -672,6 +820,11 @@
 ##	The object class of the object being created.
 ##	</summary>
 ## </param>
+## <param name="name" optional="true">
+##	<summary>
+##	The name of the object being created.
+##	</summary>
+## </param>
 #
 interface(`mta_spool_filetrans',`
 	gen_require(`
@@ -679,12 +832,31 @@
 	')
 
 	files_search_spool($1)
-	filetrans_pattern($1, mail_spool_t, $2, $3)
+	filetrans_pattern($1, mail_spool_t, $2, $3, $4)
+')
+
+#######################################
+## <summary>
+##  Read mail spool files.
+## </summary>
+## <param name="domain">
+##  <summary>
+##  Domain allowed access.
+##  </summary>
+## </param>
+#
+interface(`mta_read_spool_files',`
+	gen_require(`
+		type mail_spool_t;
+	')
+
+	files_search_spool($1)
+	read_files_pattern($1, mail_spool_t, mail_spool_t)
 ')
 
 ########################################
 ## <summary>
-##	Read and write the mail spool.
+##	Read and write mail spool files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -699,14 +871,13 @@
 
 	files_search_spool($1)
 	allow $1 mail_spool_t:dir list_dir_perms;
-	allow $1 mail_spool_t:file setattr;
-	rw_files_pattern($1, mail_spool_t, mail_spool_t)
-	read_lnk_files_pattern($1, mail_spool_t, mail_spool_t)
+	allow $1 mail_spool_t:file rw_file_perms;
+	allow $1 mail_spool_t:lnk_file read_lnk_file_perms;
 ')
 
 #######################################
 ## <summary>
-##	Create, read, and write the mail spool.
+##	Create, read, and write mail spool files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -721,14 +892,13 @@
 
 	files_search_spool($1)
 	allow $1 mail_spool_t:dir list_dir_perms;
-	create_files_pattern($1, mail_spool_t, mail_spool_t)
-	write_files_pattern($1, mail_spool_t, mail_spool_t)
-	read_lnk_files_pattern($1, mail_spool_t, mail_spool_t)
+	manage_files_pattern($1, mail_spool_t, mail_spool_t)
+	allow $1 mail_spool_t:lnk_file read_lnk_file_perms;
 ')
 
 #######################################
 ## <summary>
-##	Delete from the mail spool.
+##	Delete mail spool files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -747,7 +917,8 @@
 
 ########################################
 ## <summary>
-##	Create, read, write, and delete mail spool files.
+##	Create, read, write, and delete
+##	mail spool content.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -766,9 +937,45 @@
 	manage_lnk_files_pattern($1, mail_spool_t, mail_spool_t)
 ')
 
+#######################################
+## <summary>
+##	Create specified objects in the
+##	mail queue spool directory with a
+##	private type.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="private type">
+##	<summary>
+##	The type of the object to be created.
+##	</summary>
+## </param>
+## <param name="object">
+##	<summary>
+##	The object class of the object being created.
+##	</summary>
+## </param>
+## <param name="name" optional="true">
+##	<summary>
+##	The name of the object being created.
+##	</summary>
+## </param>
+#
+interface(`mta_queue_filetrans',`
+	gen_require(`
+		type mqueue_spool_t;
+	')
+
+	files_search_spool($1)
+	filetrans_pattern($1, mqueue_spool_t, $2, $3, $4)
+')
+
 ########################################
 ## <summary>
-##	Search mail queue dirs.
+##	Search mail queue directories.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -787,7 +994,7 @@
 
 #######################################
 ## <summary>
-##	List the mail queue.
+##	List mail queue directories.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -800,13 +1007,13 @@
 		type mqueue_spool_t;
 	')
 
-	allow $1 mqueue_spool_t:dir list_dir_perms;
 	files_search_spool($1)
+	allow $1 mqueue_spool_t:dir list_dir_perms;
 ')
 
 #######################################
 ## <summary>
-##	Read the mail queue.
+##	Read mail queue files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -819,14 +1026,14 @@
 		type mqueue_spool_t;
 	')
 
-	read_files_pattern($1, mqueue_spool_t, mqueue_spool_t)
 	files_search_spool($1)
+	read_files_pattern($1, mqueue_spool_t, mqueue_spool_t)
 ')
 
 #######################################
 ## <summary>
 ##	Do not audit attempts to read and
-##	write the mail queue.
+##	write mail queue content.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -840,13 +1047,13 @@
 	')
 
 	dontaudit $1 mqueue_spool_t:dir search_dir_perms;
-	dontaudit $1 mqueue_spool_t:file { getattr read write };
+	dontaudit $1 mqueue_spool_t:file rw_file_perms;
 ')
 
 ########################################
 ## <summary>
 ##	Create, read, write, and delete
-##	mail queue files.
+##	mail queue content.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -874,7 +1081,6 @@
 ##	</summary>
 ## </param>
 #
-# cjp: added for postfix
 interface(`mta_read_sendmail_bin',`
 	gen_require(`
 		type sendmail_exec_t;
@@ -885,8 +1091,8 @@
 
 #######################################
 ## <summary>
-##	Read and write unix domain stream sockets
-##	of user mail domains.
+##	Read and write unix domain stream
+##	sockets of all base mail domains.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/mta.te refpolicy/policy/modules/contrib/mta.te
--- refpolicy/policy/modules/contrib/mta.te	2012-07-25 20:33:05.000000000 +0200
+++ refpolicy/policy/modules/contrib/mta.te	2012-10-30 19:32:35.014399575 +0100
@@ -1,4 +1,4 @@
-policy_module(mta, 2.5.0)
+policy_module(mta, 2.6.1)
 
 ########################################
 #
@@ -14,14 +14,19 @@
 
 attribute user_mail_domain;
 
+attribute_role user_mail_roles;
+
 type etc_aliases_t;
 files_type(etc_aliases_t)
 
 type etc_mail_t;
 files_config_file(etc_mail_t)
 
-type mail_forward_t;
-files_type(mail_forward_t)
+type mail_home_t alias mail_forward_t;
+userdom_user_home_content(mail_home_t)
+
+type mail_home_rw_t;
+userdom_user_home_content(mail_home_rw_t)
 
 type mqueue_spool_t;
 files_mountpoint(mqueue_spool_t)
@@ -38,39 +43,151 @@
 mta_base_mail_template(user)
 typealias user_mail_t alias { staff_mail_t sysadm_mail_t };
 typealias user_mail_t alias { auditadm_mail_t secadm_mail_t };
+userdom_user_application_type(user_mail_t)
+role user_mail_roles types user_mail_t;
+
 typealias user_mail_tmp_t alias { staff_mail_tmp_t sysadm_mail_tmp_t };
 typealias user_mail_tmp_t alias { auditadm_mail_tmp_t secadm_mail_tmp_t };
-userdom_user_application_type(user_mail_t)
 userdom_user_tmp_file(user_mail_tmp_t)
 
 ########################################
 #
-# System mail local policy
+# Common base mail policy
+#
+
+allow user_mail_domain self:capability { setuid setgid chown };
+allow user_mail_domain self:process { signal_perms setrlimit };
+allow user_mail_domain self:fifo_file rw_fifo_file_perms;
+
+allow user_mail_domain mta_exec_type:file entrypoint;
+
+allow user_mail_domain mail_home_t:file { append_file_perms read_file_perms };
+
+manage_dirs_pattern(user_mail_domain, mail_home_rw_t, mail_home_rw_t)
+manage_files_pattern(user_mail_domain, mail_home_rw_t, mail_home_rw_t)
+manage_lnk_files_pattern(user_mail_domain, mail_home_rw_t, mail_home_rw_t)
+userdom_user_home_dir_filetrans(user_mail_domain, mail_home_rw_t, dir, "Maildir")
+
+read_files_pattern(user_mail_domain, { etc_mail_t etc_aliases_t }, { etc_mail_t etc_aliases_t })
+
+manage_files_pattern(user_mail_domain, { mqueue_spool_t mail_spool_t }, { mqueue_spool_t mail_spool_t })
+read_lnk_files_pattern(user_mail_domain, { mqueue_spool_t mail_spool_t }, { mqueue_spool_t mail_spool_t })
+
+allow user_mail_domain sendmail_exec_t:lnk_file read_lnk_file_perms;
+
+can_exec(user_mail_domain, { mta_exec_type sendmail_exec_t })
+
+kernel_read_system_state(user_mail_domain)
+kernel_read_kernel_sysctls(user_mail_domain)
+kernel_read_network_state(user_mail_domain)
+kernel_request_load_module(user_mail_domain)
+
+corenet_all_recvfrom_netlabel(user_mail_domain)
+corenet_tcp_sendrecv_generic_if(user_mail_domain)
+corenet_tcp_sendrecv_generic_node(user_mail_domain)
+
+corenet_sendrecv_all_client_packets(user_mail_domain)
+corenet_tcp_connect_all_ports(user_mail_domain)
+corenet_tcp_sendrecv_all_ports(user_mail_domain)
+
+corecmd_exec_bin(user_mail_domain)
+
+dev_read_urand(user_mail_domain)
+
+domain_use_interactive_fds(user_mail_domain)
+
+files_read_etc_runtime_files(user_mail_domain)
+files_read_usr_files(user_mail_domain)
+files_search_spool(user_mail_domain)
+files_dontaudit_search_pids(user_mail_domain)
+
+fs_getattr_all_fs(user_mail_domain)
+
+init_dontaudit_rw_utmp(user_mail_domain)
+
+logging_send_syslog_msg(user_mail_domain)
+
+miscfiles_read_localization(user_mail_domain)
+
+tunable_policy(`use_samba_home_dirs',`
+	fs_manage_cifs_dirs(user_mail_domain)
+	fs_manage_cifs_files(user_mail_domain)
+	fs_read_cifs_symlinks(user_mail_domain)
+')
+
+tunable_policy(`use_nfs_home_dirs',`
+	fs_manage_nfs_dirs(user_mail_domain)
+	fs_manage_nfs_files(user_mail_domain)
+	fs_read_nfs_symlinks(user_mail_domain)
+')
+
+optional_policy(`
+	courier_manage_spool_dirs(user_mail_domain)
+	courier_manage_spool_files(user_mail_domain)
+	courier_rw_spool_pipes(user_mail_domain)
+')
+
+optional_policy(`
+	exim_domtrans(user_mail_domain)
+	exim_manage_log(user_mail_domain)
+	exim_manage_spool_files(user_mail_domain)
+')
+
+optional_policy(`
+	files_getattr_tmp_dirs(user_mail_domain)
+
+	postfix_exec_master(user_mail_domain)
+	postfix_read_config(user_mail_domain)
+	postfix_search_spool(user_mail_domain)
+	postfix_rw_inherited_master_pipes(user_mail_domain)
+
+	ifdef(`distro_redhat',`
+		postfix_config_filetrans(user_mail_domain, etc_aliases_t, { dir file lnk_file sock_file fifo_file })
+	')
+')
+
+optional_policy(`
+	procmail_exec(user_mail_domain)
+')
+
+optional_policy(`
+	qmail_domtrans_inject(user_mail_domain)
+')
+
+optional_policy(`
+	sendmail_manage_log(user_mail_domain)
+	sendmail_log_filetrans_sendmail_log(user_mail_domain, file)
+')
+
+optional_policy(`
+	uucp_manage_spool(user_mail_domain)
+')
+
+########################################
+#
+# System local policy
 #
 
-# newalias required this, not sure if it is needed in 'if' file
 allow system_mail_t self:capability { dac_override fowner };
-allow system_mail_t self:fifo_file rw_fifo_file_perms;
 
 read_files_pattern(system_mail_t, etc_mail_t, etc_mail_t)
 
 read_files_pattern(system_mail_t, mailcontent_type, mailcontent_type)
 
-allow system_mail_t mail_forward_t:file read_file_perms;
-
-allow system_mail_t mta_exec_type:file entrypoint;
+allow system_mail_t mail_home_t:file manage_file_perms;
+userdom_user_home_dir_filetrans(system_mail_t, mail_home_t, file, ".esmtp_queue")
+userdom_user_home_dir_filetrans(system_mail_t, mail_home_t, file, ".forward")
+userdom_user_home_dir_filetrans(system_mail_t, mail_home_t, file, ".mailrc")
+userdom_user_home_dir_filetrans(system_mail_t, mail_home_t, file, "dead.letter")
+
+allow system_mail_t user_mail_domain:dir list_dir_perms;
+allow system_mail_t user_mail_domain:file read_file_perms;
+allow system_mail_t user_mail_domain:lnk_file read_lnk_file_perms;
 
-can_exec(system_mail_t, mta_exec_type)
+corecmd_exec_shell(system_mail_t)
 
-kernel_read_system_state(system_mail_t)
-kernel_read_network_state(system_mail_t)
-kernel_request_load_module(system_mail_t)
-
-dev_read_sysfs(system_mail_t)
 dev_read_rand(system_mail_t)
-dev_read_urand(system_mail_t)
-
-files_read_usr_files(system_mail_t)
+dev_read_sysfs(system_mail_t)
 
 fs_rw_anon_inodefs_files(system_mail_t)
 
@@ -81,13 +198,10 @@
 init_use_script_ptys(system_mail_t)
 
 userdom_use_user_terminals(system_mail_t)
-userdom_dontaudit_search_user_home_dirs(system_mail_t)
 
 optional_policy(`
 	apache_read_squirrelmail_data(system_mail_t)
 	apache_append_squirrelmail_data(system_mail_t)
-
-	# apache should set close-on-exec
 	apache_dontaudit_append_log(system_mail_t)
 	apache_dontaudit_rw_stream_sockets(system_mail_t)
 	apache_dontaudit_rw_tcp_sockets(system_mail_t)
@@ -97,12 +211,17 @@
 optional_policy(`
 	arpwatch_manage_tmp_files(system_mail_t)
 
-	ifdef(`hide_broken_symptoms', `
+	ifdef(`hide_broken_symptoms',`
 		arpwatch_dontaudit_rw_packet_sockets(system_mail_t)
 	')
 ')
 
 optional_policy(`
+	bugzilla_search_content(system_mail_t)
+	bugzilla_dontaudit_rw_stream_sockets(system_mail_t)
+')
+
+optional_policy(`
 	clamav_stream_connect(system_mail_t)
 	clamav_append_log(system_mail_t)
 ')
@@ -114,6 +233,7 @@
 ')
 
 optional_policy(`
+	courier_stream_connect_authdaemon(system_mail_t)
 	courier_manage_spool_dirs(system_mail_t)
 	courier_manage_spool_files(system_mail_t)
 	courier_rw_spool_pipes(system_mail_t)
@@ -130,6 +250,7 @@
 
 optional_policy(`
 	fail2ban_append_log(system_mail_t)
+	fail2ban_rw_inherited_tmp_files(system_mail_t)
 ')
 
 optional_policy(`
@@ -141,7 +262,6 @@
 ')
 
 optional_policy(`
-	# newaliases runs as system_mail_t when the sendmail initscript does a restart
 	milter_getattr_all_sockets(system_mail_t)
 ')
 
@@ -156,24 +276,6 @@
 	manage_fifo_files_pattern(system_mail_t, etc_aliases_t, etc_aliases_t)
 	manage_sock_files_pattern(system_mail_t, etc_aliases_t, etc_aliases_t)
 	files_etc_filetrans(system_mail_t, etc_aliases_t, { file lnk_file sock_file fifo_file })
-
-	domain_use_interactive_fds(system_mail_t)
-
-	# postfix needs this for newaliases
-	files_getattr_tmp_dirs(system_mail_t)
-
-	postfix_exec_master(system_mail_t)
-	postfix_read_config(system_mail_t)
-	postfix_search_spool(system_mail_t)
-
-	ifdef(`distro_redhat',`
-		# compatability for old default main.cf
-		postfix_config_filetrans(system_mail_t, etc_aliases_t, { dir file lnk_file sock_file fifo_file })
-	')
-')
-
-optional_policy(`
-	qmail_domtrans_inject(system_mail_t)
 ')
 
 optional_policy(`
@@ -189,17 +291,28 @@
 ')
 
 optional_policy(`
+	spamassassin_stream_connect_spamd(system_mail_t)
+')
+
+optional_policy(`
 	smartmon_read_tmp_files(system_mail_t)
 ')
 
-# should break this up among sections:
+########################################
+#
+# MTA user agent local policy
+#
+
+userdom_use_user_terminals(mta_user_agent)
+
+optional_policy(`
+	apache_append_log(mta_user_agent)
+')
 
 optional_policy(`
-	# why is mail delivered to a directory of type arpwatch_data_t?
-	arpwatch_search_data(mailserver_delivery)
 	arpwatch_manage_tmp_files(mta_user_agent)
 
-	ifdef(`hide_broken_symptoms', `
+	ifdef(`hide_broken_symptoms',`
 		arpwatch_dontaudit_rw_packet_sockets(mta_user_agent)
 	')
 
@@ -213,6 +326,8 @@
 # Mailserver delivery local policy
 #
 
+allow mailserver_delivery self:fifo_file rw_fifo_file_perms;
+
 allow mailserver_delivery mail_spool_t:dir list_dir_perms;
 create_files_pattern(mailserver_delivery, mail_spool_t, mail_spool_t)
 read_files_pattern(mailserver_delivery, mail_spool_t, mail_spool_t)
@@ -220,20 +335,31 @@
 create_lnk_files_pattern(mailserver_delivery, mail_spool_t, mail_spool_t)
 read_lnk_files_pattern(mailserver_delivery, mail_spool_t, mail_spool_t)
 
-read_files_pattern(mailserver_delivery, mail_forward_t, mail_forward_t)
+manage_dirs_pattern(mailserver_delivery, mail_home_rw_t, mail_home_rw_t)
+manage_files_pattern(mailserver_delivery, { mail_home_t mail_home_rw_t }, { mail_home_t mail_home_rw_t })
+manage_lnk_files_pattern(mailserver_delivery, mail_home_rw_t, mail_home_rw_t)
+userdom_user_home_dir_filetrans(mailserver_delivery, mail_home_t, file, ".esmtp_queue")
+userdom_user_home_dir_filetrans(mailserver_delivery, mail_home_t, file, ".forward")
+userdom_user_home_dir_filetrans(mailserver_delivery, mail_home_t, file, ".mailrc")
+userdom_user_home_dir_filetrans(mailserver_delivery, mail_home_t, file, "dead.letter")
+userdom_user_home_dir_filetrans(mailserver_delivery, mail_home_rw_t, dir, "Maildir")
 
 read_files_pattern(mailserver_delivery, system_mail_tmp_t, system_mail_tmp_t)
 
 tunable_policy(`use_samba_home_dirs',`
 	fs_manage_cifs_dirs(mailserver_delivery)
 	fs_manage_cifs_files(mailserver_delivery)
-	fs_manage_cifs_symlinks(mailserver_delivery)
+	fs_read_cifs_symlinks(mailserver_delivery)
 ')
 
 tunable_policy(`use_nfs_home_dirs',`
 	fs_manage_nfs_dirs(mailserver_delivery)
 	fs_manage_nfs_files(mailserver_delivery)
-	fs_manage_nfs_symlinks(mailserver_delivery)
+	fs_read_nfs_symlinks(mailserver_delivery)
+')
+
+optional_policy(`
+	arpwatch_search_data(mailserver_delivery)
 ')
 
 optional_policy(`
@@ -242,51 +368,38 @@
 ')
 
 optional_policy(`
-	# so MTA can access /var/lib/mailman/mail/wrapper
 	files_search_var_lib(mailserver_delivery)
 
 	mailman_domtrans(mailserver_delivery)
 	mailman_read_data_symlinks(mailserver_delivery)
 ')
 
+optional_policy(`
+	postfix_rw_inherited_master_pipes(mailserver_delivery)
+')
+
+optional_policy(`
+	uucp_domtrans_uux(mailserver_delivery)
+')
+
 ########################################
 #
-# User send mail local policy
+# User local policy
 #
 
-domain_use_interactive_fds(user_mail_t)
+manage_files_pattern(user_mail_t, mail_home_t, mail_home_t)
+userdom_user_home_dir_filetrans(user_mail_t, mail_home_t, file, ".esmtp_queue")
+userdom_user_home_dir_filetrans(user_mail_t, mail_home_t, file, ".forward")
+userdom_user_home_dir_filetrans(user_mail_t, mail_home_t, file, ".mailrc")
+userdom_user_home_dir_filetrans(user_mail_t, mail_home_t, file, "dead.letter")
 
-userdom_use_user_terminals(user_mail_t)
-# Write to the user domain tty. cjp: why?
-userdom_use_user_terminals(mta_user_agent)
-# Create dead.letter in user home directories.
-userdom_manage_user_home_content_files(user_mail_t)
-userdom_user_home_dir_filetrans_user_home_content(user_mail_t, file)
-# for reading .forward - maybe we need a new type for it?
-# also for delivering mail to maildir
-userdom_manage_user_home_content_dirs(mailserver_delivery)
-userdom_manage_user_home_content_files(mailserver_delivery)
-userdom_manage_user_home_content_symlinks(mailserver_delivery)
-userdom_manage_user_home_content_pipes(mailserver_delivery)
-userdom_manage_user_home_content_sockets(mailserver_delivery)
-userdom_user_home_dir_filetrans_user_home_content(mailserver_delivery, { dir file lnk_file fifo_file sock_file })
-# Read user temporary files.
-userdom_read_user_tmp_files(user_mail_t)
-userdom_dontaudit_append_user_tmp_files(user_mail_t)
-# cjp: this should probably be read all user tmp
-# files in an appropriate place for mta_user_agent
-userdom_read_user_tmp_files(mta_user_agent)
+dev_read_sysfs(user_mail_t)
 
-tunable_policy(`use_samba_home_dirs',`
-	fs_manage_cifs_files(user_mail_t)
-	fs_manage_cifs_symlinks(user_mail_t)
-')
+userdom_use_user_terminals(user_mail_t)
 
 optional_policy(`
 	allow user_mail_t self:capability dac_override;
 
-	# Read user temporary files.
-	# postfix seems to need write access if the file handle is opened read/write
 	userdom_rw_user_tmp_files(user_mail_t)
 
 	postfix_read_config(user_mail_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/munin.fc refpolicy/policy/modules/contrib/munin.fc
--- refpolicy/policy/modules/contrib/munin.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/munin.fc	2012-11-06 21:18:55.578011611 +0100
@@ -1,69 +1,76 @@
-/etc/munin(/.*)?			gen_context(system_u:object_r:munin_etc_t,s0)
+/etc/munin(/.*)?	gen_context(system_u:object_r:munin_etc_t,s0)
+
 /etc/rc\.d/init\.d/munin-node	--	gen_context(system_u:object_r:munin_initrc_exec_t,s0)
 
-/usr/bin/munin-.*		--	gen_context(system_u:object_r:munin_exec_t,s0)
-/usr/sbin/munin-.*		--	gen_context(system_u:object_r:munin_exec_t,s0)
+/usr/bin/munin-.*	--	gen_context(system_u:object_r:munin_exec_t,s0)
+
+/usr/sbin/munin-.*	--	gen_context(system_u:object_r:munin_exec_t,s0)
+
 /usr/share/munin/munin-.*	--	gen_context(system_u:object_r:munin_exec_t,s0)
 /usr/share/munin/plugins/.*	--	gen_context(system_u:object_r:munin_exec_t,s0)
 
-# disk plugins
-/usr/share/munin/plugins/diskstat.* --	gen_context(system_u:object_r:disk_munin_plugin_exec_t,s0)
+/usr/share/munin/plugins/diskstat.*	--	gen_context(system_u:object_r:disk_munin_plugin_exec_t,s0)
 /usr/share/munin/plugins/df.*	--	gen_context(system_u:object_r:disk_munin_plugin_exec_t,s0)
-/usr/share/munin/plugins/hddtemp.* --	gen_context(system_u:object_r:disk_munin_plugin_exec_t,s0)
-/usr/share/munin/plugins/smart_.* --	gen_context(system_u:object_r:disk_munin_plugin_exec_t,s0)
+/usr/share/munin/plugins/hddtemp.*	--	gen_context(system_u:object_r:disk_munin_plugin_exec_t,s0)
+/usr/share/munin/plugins/smart_.*	--	gen_context(system_u:object_r:disk_munin_plugin_exec_t,s0)
 
-# mail plugins
-/usr/share/munin/plugins/courier_mta_.*	-- gen_context(system_u:object_r:mail_munin_plugin_exec_t,s0)
-/usr/share/munin/plugins/exim_mail.* --	gen_context(system_u:object_r:mail_munin_plugin_exec_t,s0)
-/usr/share/munin/plugins/mailman --	gen_context(system_u:object_r:mail_munin_plugin_exec_t,s0)
-/usr/share/munin/plugins/mailscanner --	gen_context(system_u:object_r:mail_munin_plugin_exec_t,s0)
-/usr/share/munin/plugins/postfix_mail.*	-- gen_context(system_u:object_r:mail_munin_plugin_exec_t,s0)
-/usr/share/munin/plugins/sendmail_.* --	gen_context(system_u:object_r:mail_munin_plugin_exec_t,s0)
-/usr/share/munin/plugins/qmail.* --	gen_context(system_u:object_r:mail_munin_plugin_exec_t,s0)
-
-# services plugins
-/usr/share/munin/plugins/apache_.* --	gen_context(system_u:object_r:services_munin_plugin_exec_t,s0)
-/usr/share/munin/plugins/asterisk_.* --	gen_context(system_u:object_r:services_munin_plugin_exec_t,s0)
-/usr/share/munin/plugins/http_loadtime -- gen_context(system_u:object_r:services_munin_plugin_exec_t,s0)
-/usr/share/munin/plugins/fail2ban --	gen_context(system_u:object_r:services_munin_plugin_exec_t,s0)
+/usr/share/munin/plugins/courier_mta_.*	--	gen_context(system_u:object_r:mail_munin_plugin_exec_t,s0)
+/usr/share/munin/plugins/exim_mail.*	--	gen_context(system_u:object_r:mail_munin_plugin_exec_t,s0)
+/usr/share/munin/plugins/mailman	--	gen_context(system_u:object_r:mail_munin_plugin_exec_t,s0)
+/usr/share/munin/plugins/mailscanner	--	gen_context(system_u:object_r:mail_munin_plugin_exec_t,s0)
+/usr/share/munin/plugins/postfix_mail.*	--	gen_context(system_u:object_r:mail_munin_plugin_exec_t,s0)
+/usr/share/munin/plugins/sendmail_.*	--	gen_context(system_u:object_r:mail_munin_plugin_exec_t,s0)
+/usr/share/munin/plugins/qmail.*	--	gen_context(system_u:object_r:mail_munin_plugin_exec_t,s0)
+
+/usr/share/munin/plugins/apache_.*	--	gen_context(system_u:object_r:services_munin_plugin_exec_t,s0)
+/usr/share/munin/plugins/asterisk_.*	--	gen_context(system_u:object_r:services_munin_plugin_exec_t,s0)
+/usr/share/munin/plugins/http_loadtime	--	gen_context(system_u:object_r:services_munin_plugin_exec_t,s0)
+/usr/share/munin/plugins/fail2ban	--	gen_context(system_u:object_r:services_munin_plugin_exec_t,s0)
 /usr/share/munin/plugins/lpstat	--	gen_context(system_u:object_r:services_munin_plugin_exec_t,s0)
-/usr/share/munin/plugins/mysql_.* --	gen_context(system_u:object_r:services_munin_plugin_exec_t,s0)
+/usr/share/munin/plugins/mysql_.*	--	gen_context(system_u:object_r:services_munin_plugin_exec_t,s0)
 /usr/share/munin/plugins/named	--	gen_context(system_u:object_r:services_munin_plugin_exec_t,s0)
 /usr/share/munin/plugins/ntp_.*	--	gen_context(system_u:object_r:services_munin_plugin_exec_t,s0)
 /usr/share/munin/plugins/nut.*	--	gen_context(system_u:object_r:services_munin_plugin_exec_t,s0)
-/usr/share/munin/plugins/openvpn --	gen_context(system_u:object_r:services_munin_plugin_exec_t,s0)
-/usr/share/munin/plugins/ping_ 	--	gen_context(system_u:object_r:services_munin_plugin_exec_t,s0)
-/usr/share/munin/plugins/postgres_.* --	gen_context(system_u:object_r:services_munin_plugin_exec_t,s0)
+/usr/share/munin/plugins/openvpn	--	gen_context(system_u:object_r:services_munin_plugin_exec_t,s0)
+/usr/share/munin/plugins/ping_	--	gen_context(system_u:object_r:services_munin_plugin_exec_t,s0)
+/usr/share/munin/plugins/postgres_.*	--	gen_context(system_u:object_r:services_munin_plugin_exec_t,s0)
 /usr/share/munin/plugins/samba	--	gen_context(system_u:object_r:services_munin_plugin_exec_t,s0)
-/usr/share/munin/plugins/slapd_.* --	gen_context(system_u:object_r:services_munin_plugin_exec_t,s0)
-/usr/share/munin/plugins/snmp_.* --	gen_context(system_u:object_r:services_munin_plugin_exec_t,s0)
-/usr/share/munin/plugins/squid_.* --	gen_context(system_u:object_r:services_munin_plugin_exec_t,s0)
-/usr/share/munin/plugins/tomcat_.* --	gen_context(system_u:object_r:services_munin_plugin_exec_t,s0)
-/usr/share/munin/plugins/varnish_.* --	gen_context(system_u:object_r:services_munin_plugin_exec_t,s0)
+/usr/share/munin/plugins/slapd_.*	--	gen_context(system_u:object_r:services_munin_plugin_exec_t,s0)
+/usr/share/munin/plugins/snmp_.*	--	gen_context(system_u:object_r:services_munin_plugin_exec_t,s0)
+/usr/share/munin/plugins/squid_.*	--	gen_context(system_u:object_r:services_munin_plugin_exec_t,s0)
+/usr/share/munin/plugins/tomcat_.*	--	gen_context(system_u:object_r:services_munin_plugin_exec_t,s0)
+/usr/share/munin/plugins/varnish_.*	--	gen_context(system_u:object_r:services_munin_plugin_exec_t,s0)
+
+/usr/share/munin/plugins/selinux_avcstat	--	gen_context(system_u:object_r:selinux_munin_plugin_exec_t,s0)
 
-# system plugins
 /usr/share/munin/plugins/acpi	--	gen_context(system_u:object_r:system_munin_plugin_exec_t,s0)
 /usr/share/munin/plugins/cpu.*	--	gen_context(system_u:object_r:system_munin_plugin_exec_t,s0)
 /usr/share/munin/plugins/forks	--	gen_context(system_u:object_r:system_munin_plugin_exec_t,s0)
 /usr/share/munin/plugins/if_.*	--	gen_context(system_u:object_r:system_munin_plugin_exec_t,s0)
-/usr/share/munin/plugins/iostat.* --	gen_context(system_u:object_r:system_munin_plugin_exec_t,s0)
-/usr/share/munin/plugins/interrupts --	gen_context(system_u:object_r:system_munin_plugin_exec_t,s0)
-/usr/share/munin/plugins/irqstats --	gen_context(system_u:object_r:system_munin_plugin_exec_t,s0)
+/usr/share/munin/plugins/iostat.*	--	gen_context(system_u:object_r:system_munin_plugin_exec_t,s0)
+/usr/share/munin/plugins/interrupts	--	gen_context(system_u:object_r:system_munin_plugin_exec_t,s0)
+/usr/share/munin/plugins/irqstats	--	gen_context(system_u:object_r:system_munin_plugin_exec_t,s0)
 /usr/share/munin/plugins/load	--	gen_context(system_u:object_r:system_munin_plugin_exec_t,s0)
 /usr/share/munin/plugins/memory	--	gen_context(system_u:object_r:system_munin_plugin_exec_t,s0)
-/usr/share/munin/plugins/netstat --	gen_context(system_u:object_r:system_munin_plugin_exec_t,s0)
+/usr/share/munin/plugins/munin_.*	--	gen_context(system_u:object_r:system_munin_plugin_exec_t,s0)
+/usr/share/munin/plugins/netstat	--	gen_context(system_u:object_r:system_munin_plugin_exec_t,s0)
 /usr/share/munin/plugins/nfs.*	--	gen_context(system_u:object_r:system_munin_plugin_exec_t,s0)
-/usr/share/munin/plugins/open_files --	gen_context(system_u:object_r:system_munin_plugin_exec_t,s0)
-/usr/share/munin/plugins/proc_pri --	gen_context(system_u:object_r:system_munin_plugin_exec_t,s0)
-/usr/share/munin/plugins/processes --	gen_context(system_u:object_r:system_munin_plugin_exec_t,s0)
+/usr/share/munin/plugins/open_files	--	gen_context(system_u:object_r:system_munin_plugin_exec_t,s0)
+/usr/share/munin/plugins/proc_pri	--	gen_context(system_u:object_r:system_munin_plugin_exec_t,s0)
+/usr/share/munin/plugins/processes	--	gen_context(system_u:object_r:system_munin_plugin_exec_t,s0)
 /usr/share/munin/plugins/swap	--	gen_context(system_u:object_r:system_munin_plugin_exec_t,s0)
-/usr/share/munin/plugins/threads --	gen_context(system_u:object_r:system_munin_plugin_exec_t,s0)
+/usr/share/munin/plugins/threads	--	gen_context(system_u:object_r:system_munin_plugin_exec_t,s0)
+/usr/share/munin/plugins/unbound	--	gen_context(system_u:object_r:system_munin_plugin_exec_t,s0)
 /usr/share/munin/plugins/uptime	--	gen_context(system_u:object_r:system_munin_plugin_exec_t,s0)
 /usr/share/munin/plugins/users	--	gen_context(system_u:object_r:system_munin_plugin_exec_t,s0)
 /usr/share/munin/plugins/yum	--	gen_context(system_u:object_r:system_munin_plugin_exec_t,s0)
 
-/var/lib/munin(/.*)?			gen_context(system_u:object_r:munin_var_lib_t,s0)
-/var/log/munin.*			gen_context(system_u:object_r:munin_log_t,s0)
-/var/run/munin(/.*)?			gen_context(system_u:object_r:munin_var_run_t,s0)
-/var/www/html/munin(/.*)?		gen_context(system_u:object_r:httpd_munin_content_t,s0)
-/var/www/html/munin/cgi(/.*)?		gen_context(system_u:object_r:httpd_munin_script_exec_t,s0)
+/var/lib/munin(/.*)?	gen_context(system_u:object_r:munin_var_lib_t,s0)
+/var/lib/munin/plugin-state(/.*)?	gen_context(system_u:object_r:munin_plugin_state_t,s0)
+
+/var/log/munin.*	gen_context(system_u:object_r:munin_log_t,s0)
+
+/var/run/munin.*	gen_context(system_u:object_r:munin_var_run_t,s0)
+
+/var/www/html/munin(/.*)?	gen_context(system_u:object_r:httpd_munin_content_t,s0)
+/var/www/html/munin/cgi(/.*)?	gen_context(system_u:object_r:httpd_munin_script_exec_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/munin.if refpolicy/policy/modules/contrib/munin.if
--- refpolicy/policy/modules/contrib/munin.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/munin.if	2012-10-15 20:34:53.648002197 +0200
@@ -1,52 +1,47 @@
-## <summary>Munin network-wide load graphing (formerly LRRD)</summary>
+## <summary>Munin network-wide load graphing.</summary>
 
-########################################
+#######################################
 ## <summary>
-##	Create a set of derived types for various
-##	munin plugins,
+##	The template to define a munin plugin domain.
 ## </summary>
-## <param name="prefix">
+## <param name="domain_prefix">
 ##	<summary>
-##	The name to be used for deriving type names.
+##	Domain prefix to be used.
 ##	</summary>
 ## </param>
 #
 template(`munin_plugin_template',`
 	gen_require(`
-		type munin_t, munin_exec_t, munin_etc_t;
+		attribute munin_plugin_domain, munin_plugin_tmp_content;
+		type munin_t;
 	')
 
-	type $1_munin_plugin_t;
+	########################################
+	#
+	# Declarations
+	#
+
+	type $1_munin_plugin_t, munin_plugin_domain;
 	type $1_munin_plugin_exec_t;
 	typealias $1_munin_plugin_t alias munin_$1_plugin_t;
 	typealias $1_munin_plugin_exec_t alias munin_$1_plugin_exec_t;
 	application_domain($1_munin_plugin_t, $1_munin_plugin_exec_t)
 	role system_r types $1_munin_plugin_t;
 
-	type $1_munin_plugin_tmp_t;
+	type $1_munin_plugin_tmp_t, munin_plugin_tmp_content;
 	typealias $1_munin_plugin_tmp_t alias munin_$1_plugin_tmp_t;
 	files_tmp_file($1_munin_plugin_tmp_t)
 
-	allow $1_munin_plugin_t self:fifo_file rw_fifo_file_perms;
+	########################################
+	#
+	# Policy
+	#
+
+	domtrans_pattern(munin_t, $1_munin_plugin_exec_t, $1_munin_plugin_t)
 
 	manage_files_pattern($1_munin_plugin_t, $1_munin_plugin_tmp_t, $1_munin_plugin_tmp_t)
 	manage_dirs_pattern($1_munin_plugin_t, $1_munin_plugin_tmp_t, $1_munin_plugin_tmp_t)
 	files_tmp_filetrans($1_munin_plugin_t, $1_munin_plugin_tmp_t, { dir file })
-
-	# automatic transition rules from munin domain
-	# to specific munin plugin domain
-	domtrans_pattern(munin_t, $1_munin_plugin_exec_t, $1_munin_plugin_t)
-
-	allow $1_munin_plugin_t munin_exec_t:file read_file_perms;
-	allow $1_munin_plugin_t munin_t:tcp_socket rw_socket_perms;
-
-	read_lnk_files_pattern($1_munin_plugin_t, munin_etc_t, munin_etc_t)
-
-	kernel_read_system_state($1_munin_plugin_t)
-
-	corecmd_exec_bin($1_munin_plugin_t)
-
-	miscfiles_read_localization($1_munin_plugin_t)
 ')
 
 ########################################
@@ -65,14 +60,13 @@
 		type munin_var_run_t, munin_t;
 	')
 
-	allow $1 munin_t:unix_stream_socket connectto;
-	allow $1 munin_var_run_t:sock_file { getattr write };
 	files_search_pids($1)
+	stream_connect_pattern($1, munin_var_run_t, munin_var_run_t, munin_t)
 ')
 
 #######################################
 ## <summary>
-##	Read munin configuration files.
+##	Read munin configuration content.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -86,15 +80,15 @@
 		type munin_etc_t;
 	')
 
+	files_search_etc($1)
 	allow $1 munin_etc_t:dir list_dir_perms;
 	allow $1 munin_etc_t:file read_file_perms;
-	allow $1 munin_etc_t:lnk_file { getattr read };
-	files_search_etc($1)
+	allow $1 munin_etc_t:lnk_file read_lnk_file_perms;
 ')
 
 #######################################
 ## <summary>
-##	Append to the munin log.
+##	Append munin log files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -153,8 +147,8 @@
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate
-##	an munin environment
+##	All of the rules required to
+##	administrate an munin environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -163,21 +157,21 @@
 ## </param>
 ## <param name="role">
 ##	<summary>
-##	The role to be allowed to manage the munin domain.
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <rolecap/>
 #
 interface(`munin_admin',`
 	gen_require(`
+		attribute munin_plugin_domain, munin_plugin_tmp_content;
 		type munin_t, munin_etc_t, munin_tmp_t;
 		type munin_log_t, munin_var_lib_t, munin_var_run_t;
-		type httpd_munin_content_t;
-		type munin_initrc_exec_t;
+		type httpd_munin_content_t, munin_plugin_state_t, munin_initrc_exec_t;
 	')
 
-	allow $1 munin_t:process { ptrace signal_perms };
-	ps_process_pattern($1, munin_t)
+	allow $1 { munin_plugin_domain munin_t }:process { ptrace signal_perms };
+	ps_process_pattern($1, { munin_plugin_domain munin_t })
 
 	init_labeled_script_domtrans($1, munin_initrc_exec_t)
 	domain_system_change_exemption($1)
@@ -185,7 +179,7 @@
 	allow $2 system_r;
 
 	files_list_tmp($1)
-	admin_pattern($1, munin_tmp_t)
+	admin_pattern($1, { munin_tmp_t munin_plugin_tmp_content })
 
 	logging_list_logs($1)
 	admin_pattern($1, munin_log_t)
@@ -194,7 +188,7 @@
 	admin_pattern($1, munin_etc_t)
 
 	files_list_var_lib($1)
-	admin_pattern($1, munin_var_lib_t)
+	admin_pattern($1, { munin_var_lib_t munin_plugin_state_t })
 
 	files_list_pids($1)
 	admin_pattern($1, munin_var_run_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/munin.te refpolicy/policy/modules/contrib/munin.te
--- refpolicy/policy/modules/contrib/munin.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/munin.te	2012-11-06 21:18:55.582011611 +0100
@@ -1,10 +1,13 @@
-policy_module(munin, 1.8.0)
+policy_module(munin, 1.8.3)
 
 ########################################
 #
 # Declarations
 #
 
+attribute munin_plugin_domain;
+attribute munin_plugin_tmp_content;
+
 type munin_t alias lrrd_t;
 type munin_exec_t alias lrrd_exec_t;
 init_daemon_domain(munin_t, munin_exec_t)
@@ -24,40 +27,80 @@
 type munin_var_lib_t alias lrrd_var_lib_t;
 files_type(munin_var_lib_t)
 
+type munin_plugin_state_t;
+files_type(munin_plugin_state_t)
+
 type munin_var_run_t alias lrrd_var_run_t;
 files_pid_file(munin_var_run_t)
 
 munin_plugin_template(disk)
-
 munin_plugin_template(mail)
-
+munin_plugin_template(selinux)
 munin_plugin_template(services)
-
 munin_plugin_template(system)
 
+################################
+#
+# Common munin plugin local policy
+#
+
+allow munin_plugin_domain self:fifo_file rw_fifo_file_perms;
+
+allow munin_plugin_domain munin_t:tcp_socket rw_socket_perms;
+
+read_lnk_files_pattern(munin_plugin_domain, munin_etc_t, munin_etc_t)
+
+allow munin_plugin_domain munin_exec_t:file read_file_perms;
+
+allow munin_plugin_domain munin_var_lib_t:dir search_dir_perms;
+
+manage_files_pattern(munin_plugin_domain, munin_plugin_state_t, munin_plugin_state_t)
+
+kernel_read_system_state(munin_plugin_domain)
+
+corenet_all_recvfrom_unlabeled(munin_plugin_domain)
+corenet_all_recvfrom_netlabel(munin_plugin_domain)
+corenet_tcp_sendrecv_generic_if(munin_plugin_domain)
+corenet_tcp_sendrecv_generic_node(munin_plugin_domain)
+
+corecmd_exec_bin(munin_plugin_domain)
+corecmd_exec_shell(munin_plugin_domain)
+
+files_read_etc_files(munin_plugin_domain)
+files_read_usr_files(munin_plugin_domain)
+files_search_var_lib(munin_plugin_domain)
+
+fs_getattr_all_fs(munin_plugin_domain)
+
+miscfiles_read_localization(munin_plugin_domain)
+
+optional_policy(`
+	nscd_socket_use(munin_plugin_domain)
+')
+
 ########################################
 #
 # Local policy
 #
 
-allow munin_t self:capability { chown dac_override setgid setuid };
+allow munin_t self:capability { chown dac_override kill setgid setuid sys_rawio };
 dontaudit munin_t self:capability sys_tty_config;
 allow munin_t self:process { getsched setsched signal_perms };
-allow munin_t self:unix_stream_socket { create_stream_socket_perms connectto };
-allow munin_t self:unix_dgram_socket { create_socket_perms sendto };
-allow munin_t self:tcp_socket create_stream_socket_perms;
-allow munin_t self:udp_socket create_socket_perms;
+allow munin_t self:unix_stream_socket { accept connectto listen };
+allow munin_t self:unix_dgram_socket sendto;
+allow munin_t self:tcp_socket { accept listen };
 allow munin_t self:fifo_file manage_fifo_file_perms;
 
-allow munin_t munin_etc_t:dir list_dir_perms;
-read_files_pattern(munin_t, munin_etc_t, munin_etc_t)
-read_lnk_files_pattern(munin_t, munin_etc_t, munin_etc_t)
-files_search_etc(munin_t)
+allow munin_t munin_plugin_domain:process signal_perms;
 
-can_exec(munin_t, munin_exec_t)
+allow munin_t munin_etc_t:dir list_dir_perms;
+allow munin_t munin_etc_t:file read_file_perms;
+allow munin_t munin_etc_t:lnk_file read_lnk_file_perms;
 
 manage_dirs_pattern(munin_t, munin_log_t, munin_log_t)
-manage_files_pattern(munin_t, munin_log_t, munin_log_t)
+append_files_pattern(munin_t, munin_log_t, munin_log_t)
+create_files_pattern(munin_t, munin_log_t, munin_log_t)
+setattr_files_pattern(munin_t, munin_log_t, munin_log_t)
 logging_log_filetrans(munin_t, munin_log_t, { file dir })
 
 manage_dirs_pattern(munin_t, munin_tmp_t, munin_tmp_t)
@@ -65,15 +108,18 @@
 manage_sock_files_pattern(munin_t, munin_tmp_t, munin_tmp_t)
 files_tmp_filetrans(munin_t, munin_tmp_t, { file dir sock_file })
 
-# Allow access to the munin databases
 manage_dirs_pattern(munin_t, munin_var_lib_t, munin_var_lib_t)
 manage_files_pattern(munin_t, munin_var_lib_t, munin_var_lib_t)
 manage_lnk_files_pattern(munin_t, munin_var_lib_t, munin_var_lib_t)
-files_search_var_lib(munin_t)
 
+read_files_pattern(munin_t, munin_plugin_state_t, munin_plugin_state_t)
+
+manage_dirs_pattern(munin_t, munin_var_run_t, munin_var_run_t)
 manage_files_pattern(munin_t, munin_var_run_t, munin_var_run_t)
 manage_sock_files_pattern(munin_t, munin_var_run_t, munin_var_run_t)
-files_pid_filetrans(munin_t, munin_var_run_t, file)
+files_pid_filetrans(munin_t, munin_var_run_t, { dir file })
+
+can_exec(munin_t, munin_exec_t)
 
 kernel_read_system_state(munin_t)
 kernel_read_network_state(munin_t)
@@ -85,15 +131,18 @@
 corenet_all_recvfrom_unlabeled(munin_t)
 corenet_all_recvfrom_netlabel(munin_t)
 corenet_tcp_sendrecv_generic_if(munin_t)
-corenet_udp_sendrecv_generic_if(munin_t)
 corenet_tcp_sendrecv_generic_node(munin_t)
-corenet_udp_sendrecv_generic_node(munin_t)
-corenet_tcp_sendrecv_all_ports(munin_t)
-corenet_udp_sendrecv_all_ports(munin_t)
 corenet_tcp_bind_generic_node(munin_t)
+
+corenet_sendrecv_munin_server_packets(munin_t)
 corenet_tcp_bind_munin_port(munin_t)
+corenet_sendrecv_munin_client_packets(munin_t)
 corenet_tcp_connect_munin_port(munin_t)
+corenet_tcp_sendrecv_munin_port(munin_t)
+
+corenet_sendrecv_http_client_packets(munin_t)
 corenet_tcp_connect_http_port(munin_t)
+corenet_tcp_sendrecv_http_port(munin_t)
 
 dev_read_sysfs(munin_t)
 dev_read_urand(munin_t)
@@ -101,7 +150,6 @@
 domain_use_interactive_fds(munin_t)
 domain_read_all_domains_state(munin_t)
 
-files_read_etc_files(munin_t)
 files_read_etc_runtime_files(munin_t)
 files_read_usr_files(munin_t)
 files_list_spool(munin_t)
@@ -116,6 +164,7 @@
 
 miscfiles_read_fonts(munin_t)
 miscfiles_read_localization(munin_t)
+miscfiles_setattr_fonts_cache_dirs(munin_t)
 
 sysnet_exec_ifconfig(munin_t)
 
@@ -143,9 +192,10 @@
 ')
 
 optional_policy(`
+	mta_list_queue(munin_t)
 	mta_read_config(munin_t)
-	mta_send_mail(munin_t)
 	mta_read_queue(munin_t)
+	mta_send_mail(munin_t)
 ')
 
 optional_policy(`
@@ -159,6 +209,7 @@
 
 optional_policy(`
 	postfix_list_spool(munin_t)
+	postfix_getattr_all_spool_files(munin_t)
 ')
 
 optional_policy(`
@@ -179,25 +230,24 @@
 
 ###################################
 #
-# local policy for disk plugins
+# Disk local policy
 #
 
+allow disk_munin_plugin_t self:capability { sys_admin sys_rawio };
 allow disk_munin_plugin_t self:tcp_socket create_stream_socket_perms;
 
 rw_files_pattern(disk_munin_plugin_t, munin_var_lib_t, munin_var_lib_t)
 
-corecmd_exec_shell(disk_munin_plugin_t)
-
+corenet_sendrecv_hddtemp_client_packets(disk_munin_plugin_t)
 corenet_tcp_connect_hddtemp_port(disk_munin_plugin_t)
+corenet_tcp_sendrecv_hddtemp_port(disk_munin_plugin_t)
 
-files_read_etc_files(disk_munin_plugin_t)
-files_read_etc_runtime_files(disk_munin_plugin_t)
-
-fs_getattr_all_fs(disk_munin_plugin_t)
-
+dev_getattr_lvm_control(disk_munin_plugin_t)
 dev_read_sysfs(disk_munin_plugin_t)
 dev_read_urand(disk_munin_plugin_t)
 
+files_read_etc_runtime_files(disk_munin_plugin_t)
+
 storage_getattr_fixed_disk_dev(disk_munin_plugin_t)
 
 sysnet_read_config(disk_munin_plugin_t)
@@ -212,7 +262,7 @@
 
 ####################################
 #
-# local policy for mail plugins
+# Mail local policy
 #
 
 allow mail_munin_plugin_t self:capability dac_override;
@@ -221,17 +271,21 @@
 
 dev_read_urand(mail_munin_plugin_t)
 
-files_read_etc_files(mail_munin_plugin_t)
-
-fs_getattr_all_fs(mail_munin_plugin_t)
-
 logging_read_generic_logs(mail_munin_plugin_t)
 
-mta_read_config(mail_munin_plugin_t)
-mta_send_mail(mail_munin_plugin_t)
-mta_read_queue(mail_munin_plugin_t)
+optional_policy(`
+	mta_list_queue(mail_munin_plugin_t)
+	mta_read_config(mail_munin_plugin_t)
+	mta_read_queue(mail_munin_plugin_t)
+	mta_send_mail(mail_munin_plugin_t)
+')
+
+optional_policy(`
+	nscd_socket_use(mail_munin_plugin_t)
+')
 
 optional_policy(`
+	postfix_getattr_all_spool_files(mail_munin_plugin_t)
 	postfix_read_config(mail_munin_plugin_t)
 	postfix_list_spool(mail_munin_plugin_t)
 ')
@@ -240,28 +294,36 @@
 	sendmail_read_log(mail_munin_plugin_t)
 ')
 
+##################################
+#
+# Selinux local policy
+#
+
+selinux_get_enforce_mode(selinux_munin_plugin_t)
+
 ###################################
 #
-# local policy for service plugins
+# Service local policy
 #
 
+allow services_munin_plugin_t self:shm create_sem_perms;
+allow services_munin_plugin_t self:sem create_sem_perms;
 allow services_munin_plugin_t self:tcp_socket create_stream_socket_perms;
 allow services_munin_plugin_t self:udp_socket create_socket_perms;
 allow services_munin_plugin_t self:netlink_route_socket r_netlink_socket_perms;
 
+corenet_sendrecv_all_client_packets(services_munin_plugin_t)
 corenet_tcp_connect_all_ports(services_munin_plugin_t)
 corenet_tcp_connect_http_port(services_munin_plugin_t)
+corenet_tcp_sendrecv_all_ports(services_munin_plugin_t)
 
 dev_read_urand(services_munin_plugin_t)
 dev_read_rand(services_munin_plugin_t)
 
-fs_getattr_all_fs(services_munin_plugin_t)
-
-files_read_etc_files(services_munin_plugin_t)
-
 sysnet_read_config(services_munin_plugin_t)
 
 optional_policy(`
+	cups_read_config(services_munin_plugin_t)
 	cups_stream_connect(services_munin_plugin_t)
 ')
 
@@ -279,6 +341,10 @@
 ')
 
 optional_policy(`
+	nscd_socket_use(services_munin_plugin_t)
+')
+
+optional_policy(`
 	postgresql_stream_connect(services_munin_plugin_t)
 ')
 
@@ -286,30 +352,37 @@
 	snmp_read_snmp_var_lib_files(services_munin_plugin_t)
 ')
 
+optional_policy(`
+	varnishd_read_lib_files(services_munin_plugin_t)
+')
+
 ##################################
 #
-# local policy for system plugins
+# System local policy
 #
 
 allow system_munin_plugin_t self:udp_socket create_socket_perms;
 
 rw_files_pattern(system_munin_plugin_t, munin_var_lib_t, munin_var_lib_t)
 
+allow system_munin_plugin_t munin_log_t:file read_file_perms;
+
 kernel_read_network_state(system_munin_plugin_t)
 kernel_read_all_sysctls(system_munin_plugin_t)
 
-corecmd_exec_shell(system_munin_plugin_t)
-
-fs_getattr_all_fs(system_munin_plugin_t)
-
 dev_read_sysfs(system_munin_plugin_t)
 dev_read_urand(system_munin_plugin_t)
 
 domain_read_all_domains_state(system_munin_plugin_t)
 
-# needed by users plugin
 init_read_utmp(system_munin_plugin_t)
 
 sysnet_exec_ifconfig(system_munin_plugin_t)
 
 term_getattr_unallocated_ttys(system_munin_plugin_t)
+term_getattr_all_ttys(system_munin_plugin_t)
+term_getattr_all_ptys(system_munin_plugin_t)
+
+optional_policy(`
+	bind_read_config(system_munin_plugin_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/mutt.fc refpolicy/policy/modules/contrib/mutt.fc
--- refpolicy/policy/modules/contrib/mutt.fc	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/mutt.fc	2012-05-05 16:11:28.037762615 +0200
@@ -0,0 +1,10 @@
+HOME_DIR/\.mutt(/.*)?     gen_context(system_u:object_r:mutt_home_t,s0)
+HOME_DIR/\.muttrc      -- gen_context(system_u:object_r:mutt_conf_t,s0)
+HOME_DIR/\.mutt_cache	--	gen_context(system_u:object_r:mutt_home_t,s0)
+HOME_DIR/\.mutt_certificates	--	gen_context(system_u:object_r:mutt_home_t,s0)
+
+/etc/Muttrc	--	gen_context(system_u:object_r:mutt_etc_t,s0)
+/etc/Muttrc\.local	--	gen_context(system_u:object_r:mutt_etc_t,s0)
+/etc/mutt(/.*)?           gen_context(system_u:object_r:mutt_etc_t,s0)
+
+/usr/bin/mutt          -- gen_context(system_u:object_r:mutt_exec_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/mutt.if refpolicy/policy/modules/contrib/mutt.if
--- refpolicy/policy/modules/contrib/mutt.if	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/mutt.if	2012-05-05 16:11:28.054762615 +0200
@@ -0,0 +1,104 @@
+## <summary>Mutt e-mail client</summary>
+
+#######################################
+## <summary>
+##      The role for using the mutt application.
+## </summary>
+## <param name="role">
+##      <summary>
+##      The role associated with the user domain.
+##      </summary>
+## </param>
+## <param name="domain">
+##      <summary>
+##      The user domain.
+##      </summary>
+## </param>
+#
+interface(`mutt_role',`
+	gen_require(`
+		type mutt_t, mutt_exec_t, mutt_home_t, mutt_conf_t, mutt_etc_t;
+		type mutt_tmp_t;
+	')
+
+	role $1 types mutt_t;
+
+	domtrans_pattern($2, mutt_exec_t, mutt_t)
+	
+	allow $2 mutt_t:process { ptrace signal_perms };
+
+	manage_dirs_pattern($2, mutt_home_t, mutt_home_t)
+	manage_files_pattern($2, mutt_home_t, mutt_home_t)
+	
+	manage_dirs_pattern($2, mutt_conf_t, mutt_conf_t)
+	manage_files_pattern($2, mutt_conf_t, mutt_conf_t)
+
+	relabel_dirs_pattern($2, mutt_home_t, mutt_home_t)
+	relabel_files_pattern($2, mutt_home_t, mutt_home_t)
+	
+	relabel_dirs_pattern($2, mutt_conf_t, mutt_conf_t)
+	relabel_files_pattern($2, mutt_conf_t, mutt_conf_t)
+
+	relabel_dirs_pattern($2, mutt_tmp_t, mutt_tmp_t)
+	relabel_files_pattern($2, mutt_tmp_t, mutt_tmp_t)
+
+	ps_process_pattern($2, mutt_t)
+')	
+
+#######################################
+## <summary>
+##      Allow other domains to read mutt's home files 
+## </summary>
+## <param name="domain">
+##      <summary>
+##      The domain that is allowed read access to the mutt_home_t files
+##      </summary>
+## </param>
+#
+interface(`mutt_read_home_files',`
+	gen_require(`
+		type mutt_home_t;
+	')
+
+	read_files_pattern($1, mutt_home_t, mutt_home_t)
+')
+
+#######################################
+## <summary>
+##      Allow other domains to read mutt's temporary files
+## </summary>
+## <param name="domain">
+##      <summary>
+##      The domain that is allowed read access to the temporary files
+##      </summary>
+## </param>
+#
+interface(`mutt_read_tmp_files',`
+	gen_require(`
+		type mutt_tmp_t;
+	')
+
+	read_files_pattern($1, mutt_tmp_t, mutt_tmp_t)
+')
+
+#######################################
+## <summary>
+##      Allow other domains to handle mutt's temporary files (used for instance
+##      for e-mail drafts)
+## </summary>
+## <param name="domain">
+##      <summary>
+##      The domain that is allowed read/write access to the temporary files
+##      </summary>
+## </param>
+#
+interface(`mutt_rw_tmp_files',`
+	gen_require(`
+		type mutt_tmp_t;
+	')
+
+	# The use of rw_files_pattern here is not needed, since this incurs the open privilege as well
+	allow $1 mutt_tmp_t:dir search_dir_perms;
+	allow $1 mutt_tmp_t:file { read write };
+	files_search_tmp($1)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/mutt.te refpolicy/policy/modules/contrib/mutt.te
--- refpolicy/policy/modules/contrib/mutt.te	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/mutt.te	2012-07-27 11:42:43.680075534 +0200
@@ -0,0 +1,101 @@
+policy_module(mutt, 1.0.0)
+
+############################
+# 
+# Declarations
+#
+
+## <desc>
+## <p>
+##   Be able to manage user files (needed to support attachment handling)
+## </p>
+## </desc>
+gen_tunable(mutt_manage_user_content, false)
+
+type mutt_t;
+type mutt_exec_t;
+application_domain(mutt_t, mutt_exec_t)
+ubac_constrained(mutt_t)
+
+type mutt_conf_t;
+userdom_user_home_content(mutt_conf_t)
+
+type mutt_etc_t;
+files_config_file(mutt_etc_t)
+
+type mutt_home_t;
+userdom_user_home_content(mutt_home_t)
+
+type mutt_tmp_t;
+files_tmp_file(mutt_tmp_t)
+ubac_constrained(mutt_tmp_t)
+
+############################
+#
+# Local Policy Rules
+#
+
+allow mutt_t self:process signal_perms;
+allow mutt_t self:fifo_file rw_fifo_file_perms;
+
+manage_dirs_pattern(mutt_t, mutt_home_t, mutt_home_t)
+manage_files_pattern(mutt_t, mutt_home_t, mutt_home_t)
+userdom_user_home_dir_filetrans(mutt_t, mutt_home_t, { dir file })
+
+manage_dirs_pattern(mutt_t, mutt_tmp_t, mutt_tmp_t)
+manage_files_pattern(mutt_t, mutt_tmp_t, mutt_tmp_t)
+files_tmp_filetrans(mutt_t, mutt_tmp_t, { file dir })
+
+read_files_pattern(mutt_t, mutt_etc_t, mutt_etc_t)
+
+read_files_pattern(mutt_t, mutt_conf_t, mutt_conf_t)
+
+
+kernel_read_system_state(mutt_t)
+kernel_dontaudit_search_sysctl(mutt_t)
+
+corecmd_exec_bin(mutt_t)
+corecmd_exec_shell(mutt_t)
+
+corenet_all_recvfrom_netlabel(mutt_t)
+corenet_all_recvfrom_unlabeled(mutt_t)
+corenet_sendrecv_pop_client_packets(mutt_t)
+corenet_sendrecv_smtp_client_packets(mutt_t)
+corenet_tcp_bind_generic_node(mutt_t)
+corenet_tcp_connect_pop_port(mutt_t)
+corenet_tcp_connect_smtp_port(mutt_t)
+corenet_tcp_sendrecv_generic_if(mutt_t)
+corenet_tcp_sendrecv_generic_node(mutt_t)
+corenet_tcp_sendrecv_pop_port(mutt_t)
+corenet_tcp_sendrecv_smtp_port(mutt_t)
+
+dev_read_rand(mutt_t)
+dev_read_urand(mutt_t)
+
+domain_use_interactive_fds(mutt_t)
+
+files_read_usr_files(mutt_t)
+
+
+auth_use_nsswitch(mutt_t)
+
+miscfiles_read_localization(mutt_t)
+
+userdom_search_user_home_content(mutt_t)
+userdom_use_user_terminals(mutt_t)
+
+optional_policy(`
+	gpg_domtrans(mutt_t)
+')
+
+optional_policy(`
+	xdg_manage_generic_cache_home(mutt_t)
+	xdg_read_generic_config_home_files(mutt_t)
+')
+
+tunable_policy(`mutt_manage_user_content',`
+	# Needed for handling attachments
+	userdom_manage_user_home_content_files(mutt_t)
+	userdom_manage_user_home_content_dirs(mutt_t)
+')
+
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/mysql.fc refpolicy/policy/modules/contrib/mysql.fc
--- refpolicy/policy/modules/contrib/mysql.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/mysql.fc	2012-11-02 20:07:56.816957350 +0100
@@ -1,16 +1,11 @@
-# mysql database server
+HOME_DIR/\.my\.cnf	--	gen_context(system_u:object_r:mysqld_home_t,s0)
+
+/etc/my\.cnf	--	gen_context(system_u:object_r:mysqld_etc_t,s0)
+/etc/mysql(/.*)?	gen_context(system_u:object_r:mysqld_etc_t,s0)
+
+/etc/rc\.d/init\.d/mysqld?	--	gen_context(system_u:object_r:mysqld_initrc_exec_t,s0)
+/etc/rc\.d/init\.d/mysqlmanager	--	gen_context(system_u:object_r:mysqlmanagerd_initrc_exec_t,s0)
 
-#
-# /etc
-#
-/etc/my\.cnf		--	gen_context(system_u:object_r:mysqld_etc_t,s0)
-/etc/mysql(/.*)?		gen_context(system_u:object_r:mysqld_etc_t,s0)
-/etc/rc\.d/init\.d/mysqld --	gen_context(system_u:object_r:mysqld_initrc_exec_t,s0)
-/etc/rc\.d/init\.d/mysqlmanager -- gen_context(system_u:object_r:mysqlmanagerd_initrc_exec_t,s0)
-
-#
-# /usr
-#
 /usr/bin/mysqld_safe	--	gen_context(system_u:object_r:mysqld_safe_exec_t,s0)
 /usr/bin/mysql_upgrade	--	gen_context(system_u:object_r:mysqld_exec_t,s0)
 
@@ -18,15 +13,13 @@
 
 /usr/sbin/mysqld(-max)?	--	gen_context(system_u:object_r:mysqld_exec_t,s0)
 /usr/sbin/mysqlmanager	--	gen_context(system_u:object_r:mysqlmanagerd_exec_t,s0)
-/usr/sbin/ndbd		--	gen_context(system_u:object_r:mysqld_exec_t,s0)
+/usr/sbin/ndbd	--	gen_context(system_u:object_r:mysqld_exec_t,s0)
 
-#
-# /var
-#
-/var/lib/mysql(/.*)?		gen_context(system_u:object_r:mysqld_db_t,s0)
-/var/lib/mysql/mysql\.sock -s	gen_context(system_u:object_r:mysqld_var_run_t,s0)
+/var/lib/mysql(/.*)?	gen_context(system_u:object_r:mysqld_db_t,s0)
+/var/lib/mysql/mysql.*	-s	gen_context(system_u:object_r:mysqld_var_run_t,s0)
 
 /var/log/mysql.*	--	gen_context(system_u:object_r:mysqld_log_t,s0)
 
-/var/run/mysqld(/.*)?		gen_context(system_u:object_r:mysqld_var_run_t,s0)
-/var/run/mysqld/mysqlmanager.* -- gen_context(system_u:object_r:mysqlmanagerd_var_run_t,s0)
+/var/run/mysqld.*	gen_context(system_u:object_r:mysqld_var_run_t,s0)
+/var/run/mysqlmanager.*	--	gen_context(system_u:object_r:mysqlmanagerd_var_run_t,s0)
+/var/run/mysqld/mysqlmanager.*	--	gen_context(system_u:object_r:mysqlmanagerd_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/mysql.if refpolicy/policy/modules/contrib/mysql.if
--- refpolicy/policy/modules/contrib/mysql.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/mysql.if	2012-11-02 20:08:30.304957423 +0100
@@ -1,4 +1,23 @@
-## <summary>Policy for MySQL</summary>
+## <summary>Open source database.</summary>
+
+########################################
+## <summary>
+##	Role access for mysql.
+## </summary>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <param name="domain">
+##	<summary>
+##	User domain for the role.
+##	</summary>
+## </param>
+#
+interface(`mysql_role',`
+	refpolicywarn(`$0($*) has been deprecated')
+')
 
 ######################################
 ## <summary>
@@ -15,12 +34,38 @@
 		type mysqld_t, mysqld_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, mysqld_exec_t, mysqld_t)
 ')
 
 ########################################
 ## <summary>
-##	Send a generic signal to MySQL.
+##	Execute mysqld in the mysqld domain, and
+##	allow the specified role the mysqld domain.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed to transition.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+#
+interface(`mysql_run_mysqld',`
+	gen_require(`
+		attribute_role mysqld_roles;
+	')
+
+	mysql_domtrans($1)
+	roleattribute $2 mysqld_roles;
+')
+
+########################################
+## <summary>
+##	Send generic signals to mysqld.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -38,7 +83,7 @@
 
 ########################################
 ## <summary>
-##	Allow the specified domain to connect to postgresql with a tcp socket.
+##	Connect to mysqld with a tcp socket.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -59,7 +104,8 @@
 
 ########################################
 ## <summary>
-##	Connect to MySQL using a unix domain stream socket.
+##	Connect to mysqld with a unix
+#	domain stream socket.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -73,13 +119,13 @@
 		type mysqld_t, mysqld_var_run_t, mysqld_db_t;
 	')
 
-	stream_connect_pattern($1, mysqld_var_run_t, mysqld_var_run_t, mysqld_t)
-	stream_connect_pattern($1, mysqld_db_t, mysqld_var_run_t, mysqld_t)
+	files_search_pids($1)
+	stream_connect_pattern($1, { mysqld_db_t mysqld_var_run_t }, mysqld_var_run_t, mysqld_t)
 ')
 
 ########################################
 ## <summary>
-##	Read MySQL configuration files.
+##	Read mysqld configuration content.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -93,6 +139,7 @@
 		type mysqld_etc_t;
 	')
 
+	files_search_etc($1)
 	allow $1 mysqld_etc_t:dir list_dir_perms;
 	allow $1 mysqld_etc_t:file read_file_perms;
 	allow $1 mysqld_etc_t:lnk_file read_lnk_file_perms;
@@ -100,8 +147,7 @@
 
 ########################################
 ## <summary>
-##	Search the directories that contain MySQL
-##	database storage.
+##	Search mysqld db directories.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -109,8 +155,6 @@
 ##	</summary>
 ## </param>
 #
-# cjp: "_dir" in the name is added to clarify that this
-# is not searching the database itself.
 interface(`mysql_search_db',`
 	gen_require(`
 		type mysqld_db_t;
@@ -122,7 +166,7 @@
 
 ########################################
 ## <summary>
-##	Read and write to the MySQL database directory.
+##	Read and write mysqld database directories.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -141,7 +185,8 @@
 
 ########################################
 ## <summary>
-##	Create, read, write, and delete MySQL database directories.
+##	Create, read, write, and delete
+##	mysqld database directories.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -160,7 +205,7 @@
 
 #######################################
 ## <summary>
-##	Append to the MySQL database directory.
+##	Append mysqld database files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -179,7 +224,7 @@
 
 #######################################
 ## <summary>
-##	Read and write to the MySQL database directory.
+##	Read and write mysqld database files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -198,7 +243,8 @@
 
 #######################################
 ## <summary>
-##	Create, read, write, and delete MySQL database files.
+##	Create, read, write, and delete
+##	mysqld database files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -217,7 +263,7 @@
 
 ########################################
 ## <summary>
-##	Read and write to the MySQL database
+##	Read and write mysqld database sockets.
 ##	named socket.
 ## </summary>
 ## <param name="domain">
@@ -227,18 +273,80 @@
 ## </param>
 #
 interface(`mysql_rw_db_sockets',`
+	refpolicywarn(`$0($*) has been deprecated.')
+')
+
+########################################
+## <summary>
+##	Create, read, write, and delete
+##	mysqld home files.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`mysql_manage_mysqld_home_files',`
 	gen_require(`
-		type mysqld_db_t;
+		type mysqld_home_t;
 	')
 
-	files_search_var_lib($1)
-	allow $1 mysqld_db_t:dir search_dir_perms;
-	allow $1 mysqld_db_t:sock_file rw_sock_file_perms;
+	userdom_search_user_home_dirs($1)
+	allow $1 mysqld_home_t:file manage_file_perms;
 ')
 
 ########################################
 ## <summary>
-##	Write to the MySQL log.
+##	Relabel mysqld home files.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`mysql_relabel_mysqld_home_files',`
+	gen_require(`
+		type mysqld_home_t;
+	')
+
+	userdom_search_user_home_dirs($1)
+	allow $1 mysqld_home_t:file relabel_file_perms;
+')
+
+########################################
+## <summary>
+##	Create objects in user home
+##	directories with the mysqld home type.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="object_class">
+##	<summary>
+##	Class of the object being created.
+##	</summary>
+## </param>
+## <param name="name" optional="true">
+##	<summary>
+##	The name of the object being created.
+##	</summary>
+## </param>
+#
+interface(`mysql_home_filetrans_mysqld_home',`
+	gen_require(`
+		type mysqld_home_t;
+	')
+
+	userdom_user_home_dir_filetrans($1, mysqld_home_t, $2, $3)
+')
+
+########################################
+## <summary>
+##	Write mysqld log files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -252,12 +360,13 @@
 	')
 
 	logging_search_logs($1)
-	allow $1 mysqld_log_t:file { write_file_perms setattr };
+	allow $1 mysqld_log_t:file write_file_perms;
 ')
 
 ######################################
 ## <summary>
-##	Execute MySQL server in the mysql domain.
+##	Execute mysqld safe in the
+##	mysqld safe domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -270,12 +379,13 @@
 		type mysqld_safe_t, mysqld_safe_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, mysqld_safe_exec_t, mysqld_safe_t)
 ')
 
 #####################################
 ## <summary>
-##	Read MySQL PID files.
+##	Read mysqld pid files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -288,13 +398,13 @@
 		type mysqld_var_run_t;
 	')
 
-	mysql_search_pid_files($1)
+	files_search_pids($1)
 	read_files_pattern($1, mysqld_var_run_t, mysqld_var_run_t)
 ')
 
 #####################################
 ## <summary>
-##	Search MySQL PID files.
+##	Search mysqld pid files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -308,12 +418,14 @@
 		type mysqld_var_run_t;
 	')
 
+	files_search_pids($1)
 	search_dirs_pattern($1, mysqld_var_run_t, mysqld_var_run_t)
 ')
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate an mysql environment
+##	All of the rules required to
+##	administrate an mysqld environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -322,34 +434,104 @@
 ## </param>
 ## <param name="role">
 ##	<summary>
-##	The role to be allowed to manage the mysql domain.
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <rolecap/>
 #
 interface(`mysql_admin',`
 	gen_require(`
-		type mysqld_t, mysqld_var_run_t;
-		type mysqld_tmp_t, mysqld_db_t;
-		type mysqld_etc_t, mysqld_log_t;
-		type mysqld_initrc_exec_t;
+		type mysqld_t, mysqld_var_run_t, mysqld_etc_t;
+		type mysqld_tmp_t, mysqld_db_t, mysqld_log_t;
+		type mysqld_safe_t, mysqlmanagerd_t, mysqlmanagerd_var_run_t;
+		type mysqld_initrc_exec_t, mysqlmanagerd_initrc_exec_t, mysqld_home_t;
 	')
 
-	allow $1 mysqld_t:process { ptrace signal_perms };
-	ps_process_pattern($1, mysqld_t)
+	allow $1 { mysqld_safe_t mysqld_t mysqlmanagerd_t }:process { ptrace signal_perms };
+	ps_process_pattern($1, { mysqld_safe_t mysqld_t mysqlmanagerd_t })
 
-	init_labeled_script_domtrans($1, mysqld_initrc_exec_t)
+	init_labeled_script_domtrans($1, {  mysqlmanagerd_initrc_exec_t mysqld_initrc_exec_t })
 	domain_system_change_exemption($1)
-	role_transition $2 mysqld_initrc_exec_t system_r;
+	role_transition $2 { mysqlmanagerd_initrc_exec_t mysqld_initrc_exec_t } system_r;
 	allow $2 system_r;
 
-	admin_pattern($1, mysqld_var_run_t)
+	files_search_pids($1)
+	admin_pattern($1, { mysqlmanagerd_var_run_t mysqld_var_run_t })
 
+	files_search_var_lib($1)
 	admin_pattern($1, mysqld_db_t)
 
-	admin_pattern($1, mysqld_etc_t)
+	files_search_etc($1)
+	admin_pattern($1, { mysqld_etc_t mysqld_home_t })
 
+	logging_search_logs($1)
 	admin_pattern($1, mysqld_log_t)
 
+	files_search_tmp($1)
 	admin_pattern($1, mysqld_tmp_t)
+
+	mysql_run_mysqld($1, $2)
+')
+
+#######################################
+## <summary>
+##	Set the attributes of the MySQL run directories
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access
+##	</summary>
+## </param>
+#
+interface(`mysql_setattr_run_dirs',`
+	gen_require(`
+		type mysqld_var_run_t;
+	')
+
+	setattr_dirs_pattern($1, mysqld_var_run_t, mysqld_var_run_t)
+')
+
+#######################################
+## <summary>
+##	Create MySQL run directories
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access
+##	</summary>
+## </param>
+#
+interface(`mysql_create_run_dirs',`
+	gen_require(`
+		type mysqld_var_run_t;
+	')
+
+	create_dirs_pattern($1, mysqld_var_run_t, mysqld_var_run_t)
+')
+
+#######################################
+## <summary>
+##	Automatically use the MySQL run label for created resources in generic
+##	run locations. This method is deprecated in favor of the
+##	init_daemon_run_dir call.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access
+##	</summary>
+## </param>
+## <param name="class">
+## 	<summary>
+##	Type of the resource created for which the automatic file transition
+##	should occur
+##	</summary>
+## </param>
+## <param name="filename" optional="true">
+## 	<summary>
+##	The name of the resource being created
+##	</summary>
+## </param>
+#
+interface(`mysql_generic_run_filetrans_run',`
+	refpolicywarn(`$0($*) has been deprecated.')
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/mysql.te refpolicy/policy/modules/contrib/mysql.te
--- refpolicy/policy/modules/contrib/mysql.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/mysql.te	2012-11-02 20:08:30.304957423 +0100
@@ -1,4 +1,4 @@
-policy_module(mysql, 1.13.0)
+policy_module(mysql, 1.13.4)
 
 ########################################
 #
@@ -6,15 +6,20 @@
 #
 
 ## <desc>
-## <p>
-## Allow mysqld to connect to all ports
-## </p>
+##	<p>
+##	Determine whether mysqld can
+##	connect to all TCP ports.
+##	</p>
 ## </desc>
 gen_tunable(mysql_connect_any, false)
 
+attribute_role mysqld_roles;
+
 type mysqld_t;
 type mysqld_exec_t;
 init_daemon_domain(mysqld_t, mysqld_exec_t)
+application_domain(mysqld_t, mysqld_exec_t)
+role mysqld_roles types mysqld_t;
 
 type mysqld_safe_t;
 type mysqld_safe_exec_t;
@@ -22,6 +27,7 @@
 
 type mysqld_var_run_t;
 files_pid_file(mysqld_var_run_t)
+init_daemon_run_dir(mysqld_var_run_t, "mysqld")
 
 type mysqld_db_t;
 files_type(mysqld_db_t)
@@ -29,6 +35,9 @@
 type mysqld_etc_t alias etc_mysqld_t;
 files_config_file(mysqld_etc_t)
 
+type mysqld_home_t;
+userdom_user_home_content(mysqld_home_t)
+
 type mysqld_initrc_exec_t;
 init_script_file(mysqld_initrc_exec_t)
 
@@ -58,61 +67,62 @@
 allow mysqld_t self:process { setsched getsched setrlimit signal_perms rlimitinh };
 allow mysqld_t self:fifo_file rw_fifo_file_perms;
 allow mysqld_t self:shm create_shm_perms;
-allow mysqld_t self:unix_stream_socket create_stream_socket_perms;
-allow mysqld_t self:tcp_socket create_stream_socket_perms;
-allow mysqld_t self:udp_socket create_socket_perms;
+allow mysqld_t self:unix_stream_socket { accept listen };
+allow mysqld_t self:tcp_socket { accept listen };
 
 manage_dirs_pattern(mysqld_t, mysqld_db_t, mysqld_db_t)
 manage_files_pattern(mysqld_t, mysqld_db_t, mysqld_db_t)
 manage_lnk_files_pattern(mysqld_t, mysqld_db_t, mysqld_db_t)
 files_var_lib_filetrans(mysqld_t, mysqld_db_t, { dir file lnk_file })
 
-allow mysqld_t mysqld_etc_t:file read_file_perms;
-allow mysqld_t mysqld_etc_t:lnk_file { getattr read };
+filetrans_pattern(mysqld_t, mysqld_db_t, mysqld_var_run_t, sock_file)
+
 allow mysqld_t mysqld_etc_t:dir list_dir_perms;
+allow mysqld_t { mysqld_etc_t mysqld_home_t }:file read_file_perms;
+allow mysqld_t mysqld_etc_t:lnk_file read_lnk_file_perms;
 
-allow mysqld_t mysqld_log_t:file manage_file_perms;
+allow mysqld_t mysqld_log_t:file { append_file_perms create_file_perms setattr_file_perms };
 logging_log_filetrans(mysqld_t, mysqld_log_t, file)
 
 manage_dirs_pattern(mysqld_t, mysqld_tmp_t, mysqld_tmp_t)
 manage_files_pattern(mysqld_t, mysqld_tmp_t, mysqld_tmp_t)
 files_tmp_filetrans(mysqld_t, mysqld_tmp_t, { file dir })
 
+manage_dirs_pattern(mysqld_t, mysqld_var_run_t, mysqld_var_run_t)
 manage_files_pattern(mysqld_t, mysqld_var_run_t, mysqld_var_run_t)
 manage_sock_files_pattern(mysqld_t, mysqld_var_run_t, mysqld_var_run_t)
-files_pid_filetrans(mysqld_t, mysqld_var_run_t, { file sock_file })
+files_pid_filetrans(mysqld_t, mysqld_var_run_t, { dir file sock_file })
 
-kernel_read_system_state(mysqld_t)
 kernel_read_kernel_sysctls(mysqld_t)
+kernel_read_network_state(mysqld_t)
+kernel_read_system_state(mysqld_t)
 
 corenet_all_recvfrom_unlabeled(mysqld_t)
 corenet_all_recvfrom_netlabel(mysqld_t)
 corenet_tcp_sendrecv_generic_if(mysqld_t)
-corenet_udp_sendrecv_generic_if(mysqld_t)
 corenet_tcp_sendrecv_generic_node(mysqld_t)
-corenet_udp_sendrecv_generic_node(mysqld_t)
-corenet_tcp_sendrecv_all_ports(mysqld_t)
-corenet_udp_sendrecv_all_ports(mysqld_t)
 corenet_tcp_bind_generic_node(mysqld_t)
+
+corenet_sendrecv_mysqld_server_packets(mysqld_t)
 corenet_tcp_bind_mysqld_port(mysqld_t)
-corenet_tcp_connect_mysqld_port(mysqld_t)
 corenet_sendrecv_mysqld_client_packets(mysqld_t)
-corenet_sendrecv_mysqld_server_packets(mysqld_t)
+corenet_tcp_connect_mysqld_port(mysqld_t)
+corenet_tcp_sendrecv_mysqld_port(mysqld_t)
+
+corecmd_exec_bin(mysqld_t)
+corecmd_exec_shell(mysqld_t)
 
 dev_read_sysfs(mysqld_t)
 dev_read_urand(mysqld_t)
 
+domain_use_interactive_fds(mysqld_t)
+
 fs_getattr_all_fs(mysqld_t)
 fs_search_auto_mountpoints(mysqld_t)
 fs_rw_hugetlbfs_files(mysqld_t)
 
-domain_use_interactive_fds(mysqld_t)
-
-files_getattr_var_lib_dirs(mysqld_t)
 files_read_etc_runtime_files(mysqld_t)
-files_read_etc_files(mysqld_t)
 files_read_usr_files(mysqld_t)
-files_search_var_lib(mysqld_t)
 
 auth_use_nsswitch(mysqld_t)
 
@@ -120,20 +130,13 @@
 
 miscfiles_read_localization(mysqld_t)
 
-sysnet_read_config(mysqld_t)
-
+userdom_search_user_home_dirs(mysqld_t)
 userdom_dontaudit_use_unpriv_user_fds(mysqld_t)
-# for /root/.my.cnf - should not be needed:
-userdom_read_user_home_content_files(mysqld_t)
-
-ifdef(`distro_redhat',`
-	# because Fedora has the sock_file in the database directory
-	type_transition mysqld_t mysqld_db_t:sock_file mysqld_var_run_t;
-')
 
 tunable_policy(`mysql_connect_any',`
-	corenet_tcp_connect_all_ports(mysqld_t)
 	corenet_sendrecv_all_client_packets(mysqld_t)
+	corenet_tcp_connect_all_ports(mysqld_t)
+	corenet_tcp_sendrecv_all_ports(mysqld_t)
 ')
 
 optional_policy(`
@@ -150,26 +153,35 @@
 
 #######################################
 #
-# Local mysqld_safe policy
+# Safe local policy
 #
 
 allow mysqld_safe_t self:capability { chown dac_override fowner kill };
-dontaudit mysqld_safe_t self:capability sys_ptrace;
+allow mysqld_safe_t self:process { setsched getsched setrlimit };
 allow mysqld_safe_t self:fifo_file rw_fifo_file_perms;
 
+allow mysqld_safe_t mysqld_t:process signull;
+
 read_lnk_files_pattern(mysqld_safe_t, mysqld_db_t, mysqld_db_t)
+manage_files_pattern(mysqld_safe_t, mysqld_db_t, mysqld_db_t)
 
-domtrans_pattern(mysqld_safe_t, mysqld_exec_t, mysqld_t)
+allow mysqld_safe_t mysqld_etc_t:dir list_dir_perms;
+allow mysqld_safe_t { mysqld_etc_t mysqld_home_t }:file read_file_perms;
+allow mysqld_safe_t mysqld_etc_t:lnk_file read_lnk_file_perms;
 
-allow mysqld_safe_t mysqld_log_t:file manage_file_perms;
+allow mysqld_safe_t mysqld_log_t:file { append_file_perms create_file_perms setattr_file_perms };
+logging_log_filetrans(mysqld_safe_t, mysqld_log_t, file)
 
 manage_files_pattern(mysqld_safe_t, mysqld_var_run_t, mysqld_var_run_t)
-delete_sock_files_pattern(mysqld_safe_t, mysqld_var_run_t, mysqld_var_run_t)
+delete_sock_files_pattern(mysqld_safe_t, { mysqld_db_t mysqld_var_run_t }, mysqld_var_run_t)
+
+domtrans_pattern(mysqld_safe_t, mysqld_exec_t, mysqld_t)
 
 kernel_read_system_state(mysqld_safe_t)
 kernel_read_kernel_sysctls(mysqld_safe_t)
 
 corecmd_exec_bin(mysqld_safe_t)
+corecmd_exec_shell(mysqld_safe_t)
 
 dev_list_sysfs(mysqld_safe_t)
 
@@ -177,22 +189,23 @@
 
 files_read_etc_files(mysqld_safe_t)
 files_read_usr_files(mysqld_safe_t)
+files_search_pids(mysqld_safe_t)
 files_dontaudit_getattr_all_dirs(mysqld_safe_t)
+files_dontaudit_search_all_mountpoints(mysqld_safe_t)
 
-logging_log_filetrans(mysqld_safe_t, mysqld_log_t, file)
-
-hostname_exec(mysqld_safe_t)
+logging_send_syslog_msg(mysqld_safe_t)
 
 miscfiles_read_localization(mysqld_safe_t)
 
-mysql_manage_db_files(mysqld_safe_t)
-mysql_read_config(mysqld_safe_t)
-mysql_search_pid_files(mysqld_safe_t)
-mysql_write_log(mysqld_safe_t)
+userdom_search_user_home_dirs(mysqld_safe_t)
+
+optional_policy(`
+	hostname_exec(mysqld_safe_t)
+')
 
 ########################################
 #
-# MySQL Manager Policy
+# Manager local policy
 #
 
 allow mysqlmanagerd_t self:capability { dac_override kill };
@@ -201,12 +214,11 @@
 allow mysqlmanagerd_t self:tcp_socket create_stream_socket_perms;
 allow mysqlmanagerd_t self:unix_stream_socket create_stream_socket_perms;
 
-mysql_read_config(initrc_t)
-mysql_read_config(mysqlmanagerd_t)
-mysql_read_pid_files(mysqlmanagerd_t)
-mysql_search_db(mysqlmanagerd_t)
-mysql_signal(mysqlmanagerd_t)
-mysql_stream_connect(mysqlmanagerd_t)
+allow mysqlmanagerd_t mysqld_t:process signal;
+
+allow mysqlmanagerd_t mysqld_etc_t:dir list_dir_perms;
+allow mysqlmanagerd_t { mysqld_etc_t mysqld_home_t }:file read_file_perms;
+allow mysqlmanagerd_t mysqld_etc_t:lnk_file read_lnk_file_perms;
 
 domtrans_pattern(mysqlmanagerd_t, mysqld_exec_t, mysqld_t)
 
@@ -214,6 +226,8 @@
 manage_sock_files_pattern(mysqlmanagerd_t, mysqld_var_run_t, mysqlmanagerd_var_run_t)
 filetrans_pattern(mysqlmanagerd_t, mysqld_var_run_t, mysqlmanagerd_var_run_t, { file sock_file })
 
+stream_connect_pattern(mysqlmanagerd_t, { mysqld_db_t mysqld_var_run_t }, mysqld_var_run_t, mysqld_t)
+
 kernel_read_system_state(mysqlmanagerd_t)
 
 corecmd_exec_shell(mysqlmanagerd_t)
@@ -222,18 +236,21 @@
 corenet_all_recvfrom_netlabel(mysqlmanagerd_t)
 corenet_tcp_sendrecv_generic_if(mysqlmanagerd_t)
 corenet_tcp_sendrecv_generic_node(mysqlmanagerd_t)
-corenet_tcp_sendrecv_all_ports(mysqlmanagerd_t)
 corenet_tcp_bind_generic_node(mysqlmanagerd_t)
-corenet_tcp_bind_mysqlmanagerd_port(mysqlmanagerd_t)
-corenet_tcp_connect_mysqlmanagerd_port(mysqlmanagerd_t)
+
 corenet_sendrecv_mysqlmanagerd_server_packets(mysqlmanagerd_t)
+corenet_tcp_bind_mysqlmanagerd_port(mysqlmanagerd_t)
 corenet_sendrecv_mysqlmanagerd_client_packets(mysqlmanagerd_t)
+corenet_tcp_connect_mysqlmanagerd_port(mysqlmanagerd_t)
+corenet_tcp_sendrecv_mysqlmanagerd_port(mysqlmanagerd_t)
 
 dev_read_urand(mysqlmanagerd_t)
 
 files_read_etc_files(mysqlmanagerd_t)
 files_read_usr_files(mysqlmanagerd_t)
+files_search_pids(mysqlmanagerd_t)
+files_search_var_lib(mysqlmanagerd_t)
 
 miscfiles_read_localization(mysqlmanagerd_t)
 
-userdom_getattr_user_home_dirs(mysqlmanagerd_t)
+userdom_search_user_home_dirs(mysqlmanagerd_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/nagios.fc refpolicy/policy/modules/contrib/nagios.fc
--- refpolicy/policy/modules/contrib/nagios.fc	2012-05-04 16:19:32.000000000 +0200
+++ refpolicy/policy/modules/contrib/nagios.fc	2012-10-15 20:35:06.932002226 +0200
@@ -1,88 +1,88 @@
-/etc/nagios(/.*)?					gen_context(system_u:object_r:nagios_etc_t,s0)
-/etc/nagios/nrpe\.cfg				--	gen_context(system_u:object_r:nrpe_etc_t,s0)
-/etc/rc\.d/init\.d/nagios			--	gen_context(system_u:object_r:nagios_initrc_exec_t,s0)
-/etc/rc\.d/init\.d/nrpe				--	gen_context(system_u:object_r:nagios_initrc_exec_t,s0)
+/etc/nagios(/.*)?	gen_context(system_u:object_r:nagios_etc_t,s0)
+/etc/nagios/nrpe\.cfg	--	gen_context(system_u:object_r:nrpe_etc_t,s0)
 
-/usr/s?bin/nagios				--	gen_context(system_u:object_r:nagios_exec_t,s0)
-/usr/s?bin/nrpe					--	gen_context(system_u:object_r:nrpe_exec_t,s0)
+/etc/rc\.d/init\.d/nagios	--	gen_context(system_u:object_r:nagios_initrc_exec_t,s0)
+/etc/rc\.d/init\.d/nrpe	--	gen_context(system_u:object_r:nagios_initrc_exec_t,s0)
 
-/usr/lib/cgi-bin/netsaint(/.*)?				gen_context(system_u:object_r:httpd_nagios_script_exec_t,s0)
-/usr/lib/nagios/cgi(/.*)?				gen_context(system_u:object_r:httpd_nagios_script_exec_t,s0)
+/usr/bin/nagios	--	gen_context(system_u:object_r:nagios_exec_t,s0)
+/usr/bin/nrpe	--	gen_context(system_u:object_r:nrpe_exec_t,s0)
 
-/var/log/nagios(/.*)?					gen_context(system_u:object_r:nagios_log_t,s0)
-/var/log/netsaint(/.*)?					gen_context(system_u:object_r:nagios_log_t,s0)
+/usr/sbin/nagios	--	gen_context(system_u:object_r:nagios_exec_t,s0)
+/usr/sbin/nrpe	--	gen_context(system_u:object_r:nrpe_exec_t,s0)
 
-/var/run/nagios.*					gen_context(system_u:object_r:nagios_var_run_t,s0)
+/usr/lib/cgi-bin/nagios(/.*)?	gen_context(system_u:object_r:httpd_nagios_script_exec_t,s0)
+/usr/lib/cgi-bin/netsaint(/.*)?	gen_context(system_u:object_r:httpd_nagios_script_exec_t,s0)
 
-/var/spool/nagios(/.*)?					gen_context(system_u:object_r:nagios_spool_t,s0)
+/usr/lib/nagios/cgi(/.*)?	gen_context(system_u:object_r:httpd_nagios_script_exec_t,s0)
+/usr/lib/nagios/cgi-bin(/.*)?	gen_context(system_u:object_r:httpd_nagios_script_exec_t,s0)
 
-ifdef(`distro_debian',`
-/usr/sbin/nagios				--	gen_context(system_u:object_r:nagios_exec_t,s0)
-')
-/usr/lib/cgi-bin/nagios(/.+)?				gen_context(system_u:object_r:httpd_nagios_script_exec_t,s0)
-/usr/lib/nagios/cgi-bin(/.*)?				gen_context(system_u:object_r:httpd_nagios_script_exec_t,s0)
+/usr/lib/nagios/plugins/eventhandlers(/.*)	gen_context(system_u:object_r:nagios_eventhandler_plugin_exec_t,s0)
 
-# admin plugins
-/usr/lib/nagios/plugins/check_file_age		--	gen_context(system_u:object_r:nagios_admin_plugin_exec_t,s0)
+/usr/lib/nagios/plugins/check_file_age	--	gen_context(system_u:object_r:nagios_admin_plugin_exec_t,s0)
 
-# check disk plugins
-/usr/lib/nagios/plugins/check_disk		--	gen_context(system_u:object_r:nagios_checkdisk_plugin_exec_t,s0)
-/usr/lib/nagios/plugins/check_disk_smb		--	gen_context(system_u:object_r:nagios_checkdisk_plugin_exec_t,s0)
-/usr/lib/nagios/plugins/check_ide_smart		--	gen_context(system_u:object_r:nagios_checkdisk_plugin_exec_t,s0)
+/usr/lib/nagios/plugins/check_disk	--	gen_context(system_u:object_r:nagios_checkdisk_plugin_exec_t,s0)
+/usr/lib/nagios/plugins/check_disk_smb	--	gen_context(system_u:object_r:nagios_checkdisk_plugin_exec_t,s0)
+/usr/lib/nagios/plugins/check_ide_smart	--	gen_context(system_u:object_r:nagios_checkdisk_plugin_exec_t,s0)
 /usr/lib/nagios/plugins/check_linux_raid	--	gen_context(system_u:object_r:nagios_checkdisk_plugin_exec_t,s0)
 
-# mail plugins
 /usr/lib/nagios/plugins/check_mailq		--	gen_context(system_u:object_r:nagios_mail_plugin_exec_t,s0)
 
-# system plugins
-/usr/lib/nagios/plugins/check_breeze		--	gen_context(system_u:object_r:nagios_services_plugin_exec_t,s0)
-/usr/lib/nagios/plugins/check_dummy		--	gen_context(system_u:object_r:nagios_services_plugin_exec_t,s0)
-/usr/lib/nagios/plugins/check_flexlm		--	gen_context(system_u:object_r:nagios_system_plugin_exec_t,s0)
+/usr/lib/nagios/plugins/check_breeze	--	gen_context(system_u:object_r:nagios_services_plugin_exec_t,s0)
+/usr/lib/nagios/plugins/check_dummy	--	gen_context(system_u:object_r:nagios_services_plugin_exec_t,s0)
+/usr/lib/nagios/plugins/check_flexlm	--	gen_context(system_u:object_r:nagios_system_plugin_exec_t,s0)
 /usr/lib/nagios/plugins/check_ifoperstatus	--	gen_context(system_u:object_r:nagios_system_plugin_exec_t,s0)
-/usr/lib/nagios/plugins/check_ifstatus		--	gen_context(system_u:object_r:nagios_system_plugin_exec_t,s0)
-/usr/lib/nagios/plugins/check_load		--	gen_context(system_u:object_r:nagios_system_plugin_exec_t,s0)
-/usr/lib/nagios/plugins/check_log		--	gen_context(system_u:object_r:nagios_system_plugin_exec_t,s0)
-/usr/lib/nagios/plugins/check_mrtg		--	gen_context(system_u:object_r:nagios_system_plugin_exec_t,s0)
-/usr/lib/nagios/plugins/check_mrtgtraf		--	gen_context(system_u:object_r:nagios_system_plugin_exec_t,s0)
-/usr/lib/nagios/plugins/check_nagios		--	gen_context(system_u:object_r:nagios_system_plugin_exec_t,s0)
-/usr/lib/nagios/plugins/check_nwstat		--	gen_context(system_u:object_r:nagios_system_plugin_exec_t,s0)
-/usr/lib/nagios/plugins/check_overcr		--	gen_context(system_u:object_r:nagios_system_plugin_exec_t,s0)
-/usr/lib/nagios/plugins/check_procs		--	gen_context(system_u:object_r:nagios_system_plugin_exec_t,s0)
-/usr/lib/nagios/plugins/check_sensors		--	gen_context(system_u:object_r:nagios_system_plugin_exec_t,s0)
-/usr/lib/nagios/plugins/check_swap		--	gen_context(system_u:object_r:nagios_system_plugin_exec_t,s0)
-/usr/lib/nagios/plugins/check_users		--	gen_context(system_u:object_r:nagios_system_plugin_exec_t,s0)
-/usr/lib/nagios/plugins/check_wave		--	gen_context(system_u:object_r:nagios_system_plugin_exec_t,s0)
-
-# services plugins
-/usr/lib/nagios/plugins/check_cluster		--	gen_context(system_u:object_r:nagios_services_plugin_exec_t,s0)
-/usr/lib/nagios/plugins/check_dhcp		--	gen_context(system_u:object_r:nagios_services_plugin_exec_t,s0)
-/usr/lib/nagios/plugins/check_dig		--	gen_context(system_u:object_r:nagios_services_plugin_exec_t,s0)
-/usr/lib/nagios/plugins/check_dns		--	gen_context(system_u:object_r:nagios_services_plugin_exec_t,s0)
-/usr/lib/nagios/plugins/check_game		--	gen_context(system_u:object_r:nagios_services_plugin_exec_t,s0)
-/usr/lib/nagios/plugins/check_fping		--	gen_context(system_u:object_r:nagios_services_plugin_exec_t,s0)
-/usr/lib/nagios/plugins/check_hpjd		--	gen_context(system_u:object_r:nagios_services_plugin_exec_t,s0)
-/usr/lib/nagios/plugins/check_http		--	gen_context(system_u:object_r:nagios_services_plugin_exec_t,s0)
-/usr/lib/nagios/plugins/check_icmp		--	gen_context(system_u:object_r:nagios_services_plugin_exec_t,s0)
-/usr/lib/nagios/plugins/check_ircd		--	gen_context(system_u:object_r:nagios_services_plugin_exec_t,s0)
-/usr/lib/nagios/plugins/check_ldap		--	gen_context(system_u:object_r:nagios_services_plugin_exec_t,s0)
-/usr/lib/nagios/plugins/check_mysql		--	gen_context(system_u:object_r:nagios_services_plugin_exec_t,s0)
-/usr/lib/nagios/plugins/check_mysql_query 	--	gen_context(system_u:object_r:nagios_services_plugin_exec_t,s0)
-/usr/lib/nagios/plugins/check_nrpe		--	gen_context(system_u:object_r:nagios_services_plugin_exec_t,s0)
-/usr/lib/nagios/plugins/check_nt		--	gen_context(system_u:object_r:nagios_services_plugin_exec_t,s0)
-/usr/lib/nagios/plugins/check_ntp.*		--	gen_context(system_u:object_r:nagios_services_plugin_exec_t,s0)
-/usr/lib/nagios/plugins/check_oracle		--	gen_context(system_u:object_r:nagios_services_plugin_exec_t,s0)
-/usr/lib/nagios/plugins/check_pgsql		--	gen_context(system_u:object_r:nagios_services_plugin_exec_t,s0)
-/usr/lib/nagios/plugins/check_ping		--	gen_context(system_u:object_r:nagios_services_plugin_exec_t,s0)
-/usr/lib/nagios/plugins/check_radius		--	gen_context(system_u:object_r:nagios_services_plugin_exec_t,s0)
-/usr/lib/nagios/plugins/check_real		--	gen_context(system_u:object_r:nagios_services_plugin_exec_t,s0)
-/usr/lib/nagios/plugins/check_rpc		--	gen_context(system_u:object_r:nagios_services_plugin_exec_t,s0)
-/usr/lib/nagios/plugins/check_tcp		--	gen_context(system_u:object_r:nagios_services_plugin_exec_t,s0)
-/usr/lib/nagios/plugins/check_time		--	gen_context(system_u:object_r:nagios_services_plugin_exec_t,s0)
-/usr/lib/nagios/plugins/check_sip		--	gen_context(system_u:object_r:nagios_services_plugin_exec_t,s0)
-/usr/lib/nagios/plugins/check_smtp		--	gen_context(system_u:object_r:nagios_services_plugin_exec_t,s0)
-/usr/lib/nagios/plugins/check_snmp.*		--	gen_context(system_u:object_r:nagios_services_plugin_exec_t,s0)
-/usr/lib/nagios/plugins/check_ssh		--	gen_context(system_u:object_r:nagios_services_plugin_exec_t,s0)
-/usr/lib/nagios/plugins/check_ups		--	gen_context(system_u:object_r:nagios_services_plugin_exec_t,s0)
+/usr/lib/nagios/plugins/check_ifstatus	--	gen_context(system_u:object_r:nagios_system_plugin_exec_t,s0)
+/usr/lib/nagios/plugins/check_load	--	gen_context(system_u:object_r:nagios_system_plugin_exec_t,s0)
+/usr/lib/nagios/plugins/check_log	--	gen_context(system_u:object_r:nagios_system_plugin_exec_t,s0)
+/usr/lib/nagios/plugins/check_mrtg	--	gen_context(system_u:object_r:nagios_system_plugin_exec_t,s0)
+/usr/lib/nagios/plugins/check_mrtgtraf	--	gen_context(system_u:object_r:nagios_system_plugin_exec_t,s0)
+/usr/lib/nagios/plugins/check_nagios	--	gen_context(system_u:object_r:nagios_system_plugin_exec_t,s0)
+/usr/lib/nagios/plugins/check_nwstat	--	gen_context(system_u:object_r:nagios_system_plugin_exec_t,s0)
+/usr/lib/nagios/plugins/check_overcr	--	gen_context(system_u:object_r:nagios_system_plugin_exec_t,s0)
+/usr/lib/nagios/plugins/check_procs	--	gen_context(system_u:object_r:nagios_system_plugin_exec_t,s0)
+/usr/lib/nagios/plugins/check_sensors	--	gen_context(system_u:object_r:nagios_system_plugin_exec_t,s0)
+/usr/lib/nagios/plugins/check_swap	--	gen_context(system_u:object_r:nagios_system_plugin_exec_t,s0)
+/usr/lib/nagios/plugins/check_users	--	gen_context(system_u:object_r:nagios_system_plugin_exec_t,s0)
+/usr/lib/nagios/plugins/check_wave	--	gen_context(system_u:object_r:nagios_system_plugin_exec_t,s0)
+
+/usr/lib/nagios/plugins/check_cluster	--	gen_context(system_u:object_r:nagios_services_plugin_exec_t,s0)
+/usr/lib/nagios/plugins/check_dhcp	--	gen_context(system_u:object_r:nagios_services_plugin_exec_t,s0)
+/usr/lib/nagios/plugins/check_dig	--	gen_context(system_u:object_r:nagios_services_plugin_exec_t,s0)
+/usr/lib/nagios/plugins/check_dns	--	gen_context(system_u:object_r:nagios_services_plugin_exec_t,s0)
+/usr/lib/nagios/plugins/check_game	--	gen_context(system_u:object_r:nagios_services_plugin_exec_t,s0)
+/usr/lib/nagios/plugins/check_fping	--	gen_context(system_u:object_r:nagios_services_plugin_exec_t,s0)
+/usr/lib/nagios/plugins/check_hpjd	--	gen_context(system_u:object_r:nagios_services_plugin_exec_t,s0)
+/usr/lib/nagios/plugins/check_http	--	gen_context(system_u:object_r:nagios_services_plugin_exec_t,s0)
+/usr/lib/nagios/plugins/check_icmp	--	gen_context(system_u:object_r:nagios_services_plugin_exec_t,s0)
+/usr/lib/nagios/plugins/check_ircd	--	gen_context(system_u:object_r:nagios_services_plugin_exec_t,s0)
+/usr/lib/nagios/plugins/check_ldap	--	gen_context(system_u:object_r:nagios_services_plugin_exec_t,s0)
+/usr/lib/nagios/plugins/check_mysql	--	gen_context(system_u:object_r:nagios_services_plugin_exec_t,s0)
+/usr/lib/nagios/plugins/check_mysql_query	--	gen_context(system_u:object_r:nagios_services_plugin_exec_t,s0)
+/usr/lib/nagios/plugins/check_nrpe	--	gen_context(system_u:object_r:nagios_services_plugin_exec_t,s0)
+/usr/lib/nagios/plugins/check_nt	--	gen_context(system_u:object_r:nagios_services_plugin_exec_t,s0)
+/usr/lib/nagios/plugins/check_ntp.*	--	gen_context(system_u:object_r:nagios_services_plugin_exec_t,s0)
+/usr/lib/nagios/plugins/check_oracle	--	gen_context(system_u:object_r:nagios_services_plugin_exec_t,s0)
+/usr/lib/nagios/plugins/check_pgsql	--	gen_context(system_u:object_r:nagios_services_plugin_exec_t,s0)
+/usr/lib/nagios/plugins/check_ping	--	gen_context(system_u:object_r:nagios_services_plugin_exec_t,s0)
+/usr/lib/nagios/plugins/check_radius	--	gen_context(system_u:object_r:nagios_services_plugin_exec_t,s0)
+/usr/lib/nagios/plugins/check_real	--	gen_context(system_u:object_r:nagios_services_plugin_exec_t,s0)
+/usr/lib/nagios/plugins/check_rpc	--	gen_context(system_u:object_r:nagios_services_plugin_exec_t,s0)
+/usr/lib/nagios/plugins/check_tcp	--	gen_context(system_u:object_r:nagios_services_plugin_exec_t,s0)
+/usr/lib/nagios/plugins/check_time	--	gen_context(system_u:object_r:nagios_services_plugin_exec_t,s0)
+/usr/lib/nagios/plugins/check_sip	--	gen_context(system_u:object_r:nagios_services_plugin_exec_t,s0)
+/usr/lib/nagios/plugins/check_smtp	--	gen_context(system_u:object_r:nagios_services_plugin_exec_t,s0)
+/usr/lib/nagios/plugins/check_snmp.*	--	gen_context(system_u:object_r:nagios_services_plugin_exec_t,s0)
+/usr/lib/nagios/plugins/check_ssh	--	gen_context(system_u:object_r:nagios_services_plugin_exec_t,s0)
+/usr/lib/nagios/plugins/check_ups	--	gen_context(system_u:object_r:nagios_services_plugin_exec_t,s0)
+
+/usr/lib/nagios/plugins/check_by_ssh	--	gen_context(system_u:object_r:nagios_unconfined_plugin_exec_t,s0)
+
+/usr/lib/pnp4nagios(/.*)?	gen_context(system_u:object_r:nagios_var_lib_t,s0)
 
-# unconfined plugins
-/usr/lib/nagios/plugins/check_by_ssh		--	gen_context(system_u:object_r:nagios_unconfined_plugin_exec_t,s0)
+/var/log/nagios(/.*)?	gen_context(system_u:object_r:nagios_log_t,s0)
+/var/log/netsaint(/.*)?	gen_context(system_u:object_r:nagios_log_t,s0)
+
+/var/run/nagios.*	--	gen_context(system_u:object_r:nagios_var_run_t,s0)
+/var/run/nrpe.*	--	gen_context(system_u:object_r:nrpe_var_run_t,s0)
+
+/var/spool/nagios(/.*)?	gen_context(system_u:object_r:nagios_spool_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/nagios.if refpolicy/policy/modules/contrib/nagios.if
--- refpolicy/policy/modules/contrib/nagios.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/nagios.if	2012-10-15 20:35:06.933002226 +0200
@@ -1,48 +1,46 @@
-## <summary>Net Saint / NAGIOS - network monitoring server</summary>
+## <summary>Network monitoring server.</summary>
 
-########################################
+#######################################
 ## <summary>
-##	Create a set of derived types for various
-##	nagios plugins,
+##	The template to define a nagios plugin domain.
 ## </summary>
-## <param name="plugins_group_name">
+## <param name="domain_prefix">
 ##	<summary>
-##	The name to be used for deriving type names.
+##	Domain prefix to be used.
 ##	</summary>
 ## </param>
 #
 template(`nagios_plugin_template',`
-
 	gen_require(`
+		attribute nagios_plugin_domain;
 		type nagios_t, nrpe_t;
-		type nagios_log_t;
 	')
 
-	type nagios_$1_plugin_t;
+	########################################
+	#
+	# Declarations
+	#
+
+	type nagios_$1_plugin_t, nagios_plugin_domain;
 	type nagios_$1_plugin_exec_t;
 	application_domain(nagios_$1_plugin_t, nagios_$1_plugin_exec_t)
 	role system_r types nagios_$1_plugin_t;
 
-	allow nagios_$1_plugin_t self:fifo_file rw_fifo_file_perms;
+	########################################
+	#
+	# Policy
+	#
 
 	domtrans_pattern(nrpe_t, nagios_$1_plugin_exec_t, nagios_$1_plugin_t)
+	allow nagios_t nagios_$1_plugin_exec_t:file ioctl; 
 
-	# needed by command.cfg
 	domtrans_pattern(nagios_t, nagios_$1_plugin_exec_t, nagios_$1_plugin_t)
-
-	allow nagios_t nagios_$1_plugin_t:process signal_perms;
-
-	# cjp: leaked file descriptor
-	dontaudit nagios_$1_plugin_t nrpe_t:tcp_socket { read write };
-	dontaudit nagios_$1_plugin_t nagios_log_t:file { read write };
-
-	miscfiles_read_localization(nagios_$1_plugin_t)
 ')
 
 ########################################
 ## <summary>
-##	Do not audit attempts to read or write nagios
-##	unnamed pipes.
+##	Do not audit attempts to read or
+##	write nagios unnamed pipes.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -61,8 +59,7 @@
 
 ########################################
 ## <summary>
-##	Allow the specified domain to read
-##	nagios configuration files.
+##	Read nagios configuration content.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -76,14 +73,15 @@
 		type nagios_etc_t;
 	')
 
+	files_search_etc($1)
 	allow $1 nagios_etc_t:dir list_dir_perms;
 	allow $1 nagios_etc_t:file read_file_perms;
-	files_search_etc($1)
+	allow $1 nagios_etc_t:lnk_file read_lnk_file_perms;
 ')
 
 ######################################
 ## <summary>
-##	Read nagios logs.
+##	Read nagios log files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -102,7 +100,8 @@
 
 ########################################
 ## <summary>
-##	Do not audit attempts to read or write nagios logs.
+##	Do not audit attempts to read or
+##	write nagios log files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -133,14 +132,13 @@
 		type nagios_spool_t;
 	')
 
-	allow $1 nagios_spool_t:dir search_dir_perms;
 	files_search_spool($1)
+	allow $1 nagios_spool_t:dir search_dir_perms;
 ')
 
 ########################################
 ## <summary>
-##	Allow the specified domain to read
-##	nagios temporary files.
+##	Read nagios temporary files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -153,14 +151,13 @@
 		type nagios_tmp_t;
 	')
 
-	allow $1 nagios_tmp_t:file read_file_perms;
 	files_search_tmp($1)
+	allow $1 nagios_tmp_t:file read_file_perms;
 ')
 
 ########################################
 ## <summary>
-##	Execute the nagios NRPE with
-##	a domain transition.
+##	Execute nrpe with a domain transition.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -173,13 +170,14 @@
 		type nrpe_t, nrpe_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, nrpe_exec_t, nrpe_t)
 ')
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate
-##	an nagios environment
+##	All of the rules required to
+##	administrate an nagios environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -188,42 +186,44 @@
 ## </param>
 ## <param name="role">
 ##	<summary>
-##	The role to be allowed to manage the nagios domain.
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <rolecap/>
 #
 interface(`nagios_admin',`
 	gen_require(`
-		type nagios_t, nrpe_t;
-		type nagios_tmp_t, nagios_log_t;
-		type nagios_etc_t, nrpe_etc_t;
-		type nagios_spool_t, nagios_var_run_t;
-		type nagios_initrc_exec_t;
+		attribute nagios_plugin_domain;
+		type nagios_t, nrpe_t, nagios_initrc_exec_t;
+		type nagios_tmp_t, nagios_log_t, nagios_var_lib_t;
+		type nagios_etc_t, nrpe_etc_t, nrpe_var_run_t;
+		type nagios_spool_t, nagios_var_run_t, nagios_system_plugin_tmp_t;
+		type nagios_eventhandler_plugin_tmp_t;
 	')
 
-	allow $1 nagios_t:process { ptrace signal_perms };
-	ps_process_pattern($1, nagios_t)
+	allow $1 { nagios_t nrpe_t nagios_plugin_domain }:process { ptrace signal_perms };
+	ps_process_pattern($1, { nagios_t nrpe_t nagios_plugin_domain })
 
 	init_labeled_script_domtrans($1, nagios_initrc_exec_t)
 	domain_system_change_exemption($1)
 	role_transition $2 nagios_initrc_exec_t system_r;
 	allow $2 system_r;
 
-	files_list_tmp($1)
-	admin_pattern($1, nagios_tmp_t)
+	files_search_tmp($1)
+	admin_pattern($1, { nagios_eventhandler_plugin_tmp_t nagios_tmp_t nagios_system_plugin_tmp_t })
 
-	logging_list_logs($1)
+	logging_search_logs($1)
 	admin_pattern($1, nagios_log_t)
 
-	files_list_etc($1)
-	admin_pattern($1, nagios_etc_t)
+	files_search_etc($1)
+	admin_pattern($1, { nrpe_etc_t nagios_etc_t })
 
-	files_list_spool($1)
+	files_search_spool($1)
 	admin_pattern($1, nagios_spool_t)
 
-	files_list_pids($1)
-	admin_pattern($1, nagios_var_run_t)
+	files_search_pids($1)
+	admin_pattern($1, { nrpe_var_run_t nagios_var_run_t })
 
-	admin_pattern($1, nrpe_etc_t)
+	files_search_var_lib($1)
+	admin_pattern($1, nagios_var_lib_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/nagios.te refpolicy/policy/modules/contrib/nagios.te
--- refpolicy/policy/modules/contrib/nagios.te	2012-07-25 20:33:05.000000000 +0200
+++ refpolicy/policy/modules/contrib/nagios.te	2012-10-15 20:35:06.956002226 +0200
@@ -1,10 +1,12 @@
-policy_module(nagios, 1.12.0)
+policy_module(nagios, 1.12.2)
 
 ########################################
 #
 # Declarations
 #
 
+attribute nagios_plugin_domain;
+
 type nagios_t;
 type nagios_exec_t;
 init_daemon_domain(nagios_t, nagios_exec_t)
@@ -27,12 +29,19 @@
 type nagios_spool_t;
 files_type(nagios_spool_t)
 
+type nagios_var_lib_t;
+files_type(nagios_var_lib_t)
+
 nagios_plugin_template(admin)
 nagios_plugin_template(checkdisk)
 nagios_plugin_template(mail)
 nagios_plugin_template(services)
 nagios_plugin_template(system)
 nagios_plugin_template(unconfined)
+nagios_plugin_template(eventhandler)
+
+type nagios_eventhandler_plugin_tmp_t;
+files_tmp_file(nagios_eventhandler_plugin_tmp_t)
 
 type nagios_system_plugin_tmp_t;
 files_tmp_file(nagios_system_plugin_tmp_t)
@@ -47,6 +56,27 @@
 type nrpe_var_run_t;
 files_pid_file(nrpe_var_run_t)
 
+######################################
+#
+# Common plugin domain local policy
+#
+
+allow nagios_plugin_domain self:fifo_file rw_fifo_file_perms;
+
+dontaudit nagios_plugin_domain nrpe_t:tcp_socket { read write };
+dontaudit nagios_plugin_domain nagios_log_t:file { read write };
+
+kernel_read_system_state(nagios_plugin_domain)
+
+dev_read_urand(nagios_plugin_domain)
+dev_read_rand(nagios_plugin_domain)
+
+files_read_usr_files(nagios_plugin_domain)
+
+miscfiles_read_localization(nagios_plugin_domain)
+
+userdom_use_user_terminals(nagios_plugin_domain)
+
 ########################################
 #
 # Nagios local policy
@@ -55,21 +85,26 @@
 allow nagios_t self:capability { dac_override setgid setuid };
 dontaudit nagios_t self:capability sys_tty_config;
 allow nagios_t self:process { setpgid signal_perms };
-allow nagios_t self:fifo_file rw_file_perms;
-allow nagios_t self:tcp_socket create_stream_socket_perms;
-allow nagios_t self:udp_socket create_socket_perms;
+allow nagios_t self:fifo_file rw_fifo_file_perms;
+allow nagios_t self:tcp_socket { accept listen };
+
+allow nagios_t nagios_plugin_domain:process signal_perms;
+
+allow nagios_t nagios_eventhandler_plugin_exec_t:dir list_dir_perms;
 
-read_files_pattern(nagios_t, nagios_etc_t, nagios_etc_t)
-read_lnk_files_pattern(nagios_t, nagios_etc_t, nagios_etc_t)
 allow nagios_t nagios_etc_t:dir list_dir_perms;
+allow nagios_t nagios_etc_t:file read_file_perms;
+allow nagios_t nagios_etc_t:lnk_file read_lnk_file_perms;
 
-manage_files_pattern(nagios_t, nagios_log_t, nagios_log_t)
-manage_fifo_files_pattern(nagios_t, nagios_log_t, nagios_log_t)
-logging_log_filetrans(nagios_t, nagios_log_t, { file dir })
+allow nagios_t nagios_log_t:dir setattr_dir_perms;
+append_files_pattern(nagios_t, nagios_log_t, nagios_log_t)
+create_files_pattern(nagios_t, nagios_log_t, nagios_log_t)
+setattr_files_pattern(nagios_t, nagios_log_t, nagios_log_t)
+logging_log_filetrans(nagios_t, nagios_log_t, file)
 
 manage_dirs_pattern(nagios_t, nagios_tmp_t, nagios_tmp_t)
 manage_files_pattern(nagios_t, nagios_tmp_t, nagios_tmp_t)
-files_tmp_filetrans(nagios_t, nagios_tmp_t, { file dir })
+files_tmp_filetrans(nagios_t, nagios_tmp_t, { dir file })
 
 manage_files_pattern(nagios_t, nagios_var_run_t, nagios_var_run_t)
 files_pid_filetrans(nagios_t, nagios_var_run_t, file)
@@ -77,8 +112,13 @@
 manage_fifo_files_pattern(nagios_t, nagios_spool_t, nagios_spool_t)
 files_spool_filetrans(nagios_t, nagios_spool_t, fifo_file)
 
+manage_files_pattern(nagios_t, nagios_var_lib_t, nagios_var_lib_t)
+manage_fifo_files_pattern(nagios_t, nagios_var_lib_t, nagios_var_lib_t)
+files_var_lib_filetrans(nagios_t, nagios_var_lib_t, { file fifo_file })
+
 kernel_read_system_state(nagios_t)
 kernel_read_kernel_sysctls(nagios_t)
+kernel_read_software_raid_state(nagios_t)
 
 corecmd_exec_bin(nagios_t)
 corecmd_exec_shell(nagios_t)
@@ -86,12 +126,11 @@
 corenet_all_recvfrom_unlabeled(nagios_t)
 corenet_all_recvfrom_netlabel(nagios_t)
 corenet_tcp_sendrecv_generic_if(nagios_t)
-corenet_udp_sendrecv_generic_if(nagios_t)
 corenet_tcp_sendrecv_generic_node(nagios_t)
-corenet_udp_sendrecv_generic_node(nagios_t)
-corenet_tcp_sendrecv_all_ports(nagios_t)
-corenet_udp_sendrecv_all_ports(nagios_t)
+
+corenet_sendrecv_all_client_packets(nagios_t)
 corenet_tcp_connect_all_ports(nagios_t)
+corenet_tcp_sendrecv_all_ports(nagios_t)
 
 corenet_dontaudit_tcp_bind_all_reserved_ports(nagios_t)
 corenet_dontaudit_udp_bind_all_reserved_ports(nagios_t)
@@ -100,20 +139,16 @@
 dev_read_urand(nagios_t)
 
 domain_use_interactive_fds(nagios_t)
-# for ps
 domain_read_all_domains_state(nagios_t)
 
-files_read_etc_files(nagios_t)
 files_read_etc_runtime_files(nagios_t)
 files_read_kernel_symbol_table(nagios_t)
+files_read_usr_files(nagios_t)
 files_search_spool(nagios_t)
 
 fs_getattr_all_fs(nagios_t)
 fs_search_auto_mountpoints(nagios_t)
 
-# for who
-init_read_utmp(nagios_t)
-
 auth_use_nsswitch(nagios_t)
 
 logging_send_syslog_msg(nagios_t)
@@ -124,10 +159,10 @@
 userdom_dontaudit_search_user_home_dirs(nagios_t)
 
 mta_send_mail(nagios_t)
+mta_signal_system_mail(nagios_t)
+mta_kill_system_mail(nagios_t)
 
 optional_policy(`
-	netutils_domtrans_ping(nagios_t)
-	netutils_signal_ping(nagios_t)
 	netutils_kill_ping(nagios_t)
 ')
 
@@ -141,7 +176,7 @@
 
 ########################################
 #
-# Nagios CGI local policy
+# CGI local policy
 #
 optional_policy(`
 	apache_content_template(nagios)
@@ -153,13 +188,13 @@
 	read_files_pattern(httpd_nagios_script_t, nagios_t, nagios_t)
 	read_lnk_files_pattern(httpd_nagios_script_t, nagios_t, nagios_t)
 
+	allow httpd_nagios_script_t nagios_etc_t:dir list_dir_perms;
+	allow httpd_nagios_script_t nagios_etc_t:file read_file_perms;
+	allow httpd_nagios_script_t nagios_etc_t:lnk_file read_lnk_file_perms;
+
 	files_search_spool(httpd_nagios_script_t)
 	rw_fifo_files_pattern(httpd_nagios_script_t, nagios_spool_t, nagios_spool_t)
 
-	allow httpd_nagios_script_t nagios_etc_t:dir list_dir_perms;
-	read_files_pattern(httpd_nagios_script_t, nagios_etc_t, nagios_etc_t)
-	read_lnk_files_pattern(httpd_nagios_script_t, nagios_etc_t, nagios_etc_t)
-
 	allow httpd_nagios_script_t nagios_log_t:dir list_dir_perms;
 	read_files_pattern(httpd_nagios_script_t, nagios_etc_t, nagios_log_t)
 	read_lnk_files_pattern(httpd_nagios_script_t, nagios_etc_t, nagios_log_t)
@@ -176,23 +211,24 @@
 
 ########################################
 #
-# Nagios remote plugin executor local policy
+# Nrpe local policy
 #
 
 allow nrpe_t self:capability { setuid setgid };
-dontaudit nrpe_t self:capability {sys_tty_config sys_resource};
+dontaudit nrpe_t self:capability { sys_tty_config sys_resource };
 allow nrpe_t self:process { setpgid signal_perms setsched setrlimit };
 allow nrpe_t self:fifo_file rw_fifo_file_perms;
-allow nrpe_t self:tcp_socket create_stream_socket_perms;
+allow nrpe_t self:tcp_socket { accept listen };
 
-domtrans_pattern(nrpe_t, nagios_checkdisk_plugin_exec_t, nagios_checkdisk_plugin_t)
+allow nrpe_t nagios_plugin_domain:process { signal sigkill };
 
 read_files_pattern(nrpe_t, nagios_etc_t, nrpe_etc_t)
-files_search_etc(nrpe_t)
 
 manage_files_pattern(nrpe_t, nrpe_var_run_t, nrpe_var_run_t)
 files_pid_filetrans(nrpe_t, nrpe_var_run_t, file)
 
+domtrans_pattern(nrpe_t, nagios_checkdisk_plugin_exec_t, nagios_checkdisk_plugin_t)
+
 kernel_read_kernel_sysctls(nrpe_t)
 kernel_read_software_raid_state(nrpe_t)
 kernel_read_system_state(nrpe_t)
@@ -200,9 +236,15 @@
 corecmd_exec_bin(nrpe_t)
 corecmd_exec_shell(nrpe_t)
 
+corenet_all_recvfrom_unlabeled(nrpe_t)
+corenet_all_recvfrom_netlabel(nrpe_t)
+corenet_tcp_sendrecv_generic_if(nrpe_t)
+corenet_tcp_sendrecv_generic_node(nrpe_t)
 corenet_tcp_bind_generic_node(nrpe_t)
+
+corenet_sendrecv_inetd_child_server_packets(nrpe_t)
 corenet_tcp_bind_inetd_child_port(nrpe_t)
-corenet_sendrecv_unlabeled_packets(nrpe_t)
+corenet_tcp_sendrecv_inetd_child_port(nrpe_t)
 
 dev_read_sysfs(nrpe_t)
 dev_read_urand(nrpe_t)
@@ -211,7 +253,7 @@
 domain_read_all_domains_state(nrpe_t)
 
 files_read_etc_runtime_files(nrpe_t)
-files_read_etc_files(nrpe_t)
+files_read_usr_files(nrpe_t)
 
 fs_getattr_all_fs(nrpe_t)
 fs_search_auto_mountpoints(nrpe_t)
@@ -246,18 +288,15 @@
 
 #####################################
 #
-# local policy for admin check plugins
+# Admin local policy
 #
 
 corecmd_read_bin_files(nagios_admin_plugin_t)
 corecmd_read_bin_symlinks(nagios_admin_plugin_t)
 
-dev_read_urand(nagios_admin_plugin_t)
 dev_getattr_all_chr_files(nagios_admin_plugin_t)
 dev_getattr_all_blk_files(nagios_admin_plugin_t)
 
-files_read_etc_files(nagios_admin_plugin_t)
-# for check_file_age plugin
 files_getattr_all_dirs(nagios_admin_plugin_t)
 files_getattr_all_files(nagios_admin_plugin_t)
 files_getattr_all_symlinks(nagios_admin_plugin_t)
@@ -267,28 +306,22 @@
 
 ######################################
 #
-# local policy for mail check plugins
+# Mail local policy
 #
 
 allow nagios_mail_plugin_t self:capability { setuid setgid dac_override };
+allow nagios_mail_plugin_t self:tcp_socket { accept listen };
 
-allow nagios_mail_plugin_t self:netlink_route_socket r_netlink_socket_perms;
-allow nagios_mail_plugin_t self:tcp_socket create_stream_socket_perms;
-allow nagios_mail_plugin_t self:udp_socket create_socket_perms;
-
-kernel_read_system_state(nagios_mail_plugin_t)
 kernel_read_kernel_sysctls(nagios_mail_plugin_t)
 
 corecmd_read_bin_files(nagios_mail_plugin_t)
 corecmd_read_bin_symlinks(nagios_mail_plugin_t)
 
-dev_read_urand(nagios_mail_plugin_t)
-
 files_read_etc_files(nagios_mail_plugin_t)
 
 logging_send_syslog_msg(nagios_mail_plugin_t)
 
-sysnet_read_config(nagios_mail_plugin_t)
+sysnet_dns_name_resolve(nagios_mail_plugin_t)
 
 optional_policy(`
 	mta_send_mail(nagios_mail_plugin_t)
@@ -300,17 +333,18 @@
 
 optional_policy(`
 	postfix_stream_connect_master(nagios_mail_plugin_t)
-	posftix_exec_postqueue(nagios_mail_plugin_t)
+	postfix_exec_postqueue(nagios_mail_plugin_t)
 ')
 
 ######################################
 #
-# local policy for disk check plugins
+# Disk local policy
 #
 
-# needed by ioctl()
 allow nagios_checkdisk_plugin_t self:capability { sys_admin sys_rawio };
 
+kernel_read_software_raid_state(nagios_checkdisk_plugin_t)
+
 files_getattr_all_mountpoints(nagios_checkdisk_plugin_t)
 files_read_etc_runtime_files(nagios_checkdisk_plugin_t)
 
@@ -320,28 +354,39 @@
 
 #######################################
 #
-# local policy for service check plugins
+# Services local policy
 #
 
 allow nagios_services_plugin_t self:capability { net_bind_service net_raw };
 allow nagios_services_plugin_t self:process { signal sigkill };
-
-allow nagios_services_plugin_t self:tcp_socket create_stream_socket_perms;
-allow nagios_services_plugin_t self:udp_socket create_socket_perms;
+allow nagios_services_plugin_t self:tcp_socket { accept listen };
 
 corecmd_exec_bin(nagios_services_plugin_t)
 
+corenet_all_recvfrom_unlabeled(nagios_services_plugin_t)
+corenet_all_recvfrom_netlabel(nagios_services_plugin_t)
+corenet_tcp_sendrecv_generic_if(nagios_services_plugin_t)
+corenet_udp_sendrecv_generic_if(nagios_services_plugin_t)
+corenet_tcp_sendrecv_generic_node(nagios_services_plugin_t)
+corenet_udp_sendrecv_generic_node(nagios_services_plugin_t)
+corenet_udp_bind_generic_node(nagios_services_plugin_t)
+
+corenet_sendrecv_all_client_packets(nagios_services_plugin_t)
 corenet_tcp_connect_all_ports(nagios_services_plugin_t)
+corenet_tcp_sendrecv_all_ports(nagios_services_plugin_t)
+
+corenet_sendrecv_dhcpc_server_packets(nagios_services_plugin_t)
 corenet_udp_bind_dhcpc_port(nagios_services_plugin_t)
+corenet_udp_sendrecv_dhcpc_port(nagios_services_plugin_t)
 
 auth_use_nsswitch(nagios_services_plugin_t)
 
 domain_read_all_domains_state(nagios_services_plugin_t)
 
-files_read_usr_files(nagios_services_plugin_t)
-
 optional_policy(`
 	netutils_domtrans_ping(nagios_services_plugin_t)
+	netutils_signal_ping(nagios_services_plugin_t)
+	netutils_kill_ping(nagios_services_plugin_t)
 ')
 
 optional_policy(`
@@ -354,35 +399,49 @@
 
 ######################################
 #
-# local policy for system check plugins
+# System local policy
 #
 
 allow nagios_system_plugin_t self:capability dac_override;
 dontaudit nagios_system_plugin_t self:capability { setuid setgid };
 
-# check_log
+read_files_pattern(nagios_system_plugin_t, nagios_log_t, nagios_log_t)
+
 manage_files_pattern(nagios_system_plugin_t, nagios_system_plugin_tmp_t, nagios_system_plugin_tmp_t)
 manage_dirs_pattern(nagios_system_plugin_t, nagios_system_plugin_tmp_t, nagios_system_plugin_tmp_t)
 files_tmp_filetrans(nagios_system_plugin_t, nagios_system_plugin_tmp_t, { dir file })
 
-kernel_read_system_state(nagios_system_plugin_t)
 kernel_read_kernel_sysctls(nagios_system_plugin_t)
 
 corecmd_exec_bin(nagios_system_plugin_t)
 corecmd_exec_shell(nagios_system_plugin_t)
 
 dev_read_sysfs(nagios_system_plugin_t)
-dev_read_urand(nagios_system_plugin_t)
 
 domain_read_all_domains_state(nagios_system_plugin_t)
 
 files_read_etc_files(nagios_system_plugin_t)
 
-# needed by check_users plugin
+fs_getattr_all_fs(nagios_system_plugin_t)
+
 optional_policy(`
 	init_read_utmp(nagios_system_plugin_t)
 ')
 
+#######################################
+#
+# Event local policy
+#
+
+manage_files_pattern(nagios_eventhandler_plugin_t, nagios_eventhandler_plugin_tmp_t, nagios_eventhandler_plugin_tmp_t)
+manage_dirs_pattern(nagios_eventhandler_plugin_t, nagios_eventhandler_plugin_tmp_t, nagios_eventhandler_plugin_tmp_t)
+files_tmp_filetrans(nagios_eventhandler_plugin_t, nagios_eventhandler_plugin_tmp_t, { dir file })
+
+corecmd_exec_bin(nagios_eventhandler_plugin_t)
+corecmd_exec_shell(nagios_eventhandler_plugin_t)
+
+init_domtrans_script(nagios_eventhandler_plugin_t)
+
 ########################################
 #
 # Unconfined plugin policy
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/ncftool.if refpolicy/policy/modules/contrib/ncftool.if
--- refpolicy/policy/modules/contrib/ncftool.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/ncftool.if	2012-10-15 20:35:08.898002230 +0200
@@ -1,4 +1,4 @@
-## <summary>Netcf network configuration tool (ncftool).</summary>
+## <summary>Cross-platform network configuration library.</summary>
 
 ########################################
 ## <summary>
@@ -15,13 +15,15 @@
 		type ncftool_t, ncftool_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, ncftool_exec_t, ncftool_t)
 ')
 
 ########################################
 ## <summary>
-##	Execute ncftool in the ncftool domain, and
-##	allow the specified role the ncftool domain.
+##	Execute ncftool in the ncftool
+##	domain, and allow the specified
+##	role the ncftool domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -30,7 +32,7 @@
 ## </param>
 ## <param name="role">
 ##	<summary>
-##	The role to be allowed the ncftool domain.
+##	Role allowed access.
 ##	</summary>
 ## </param>
 #
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/ncftool.te refpolicy/policy/modules/contrib/ncftool.te
--- refpolicy/policy/modules/contrib/ncftool.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/ncftool.te	2012-10-15 20:35:08.922002230 +0200
@@ -1,4 +1,4 @@
-policy_module(ncftool, 1.1.0)
+policy_module(ncftool, 1.1.2)
 
 ########################################
 #
@@ -17,15 +17,15 @@
 
 ########################################
 #
-# ncftool local policy
+# Local policy
 #
 
-allow ncftool_t self:capability { net_admin sys_ptrace };
+allow ncftool_t self:capability net_admin;
 allow ncftool_t self:process signal;
 allow ncftool_t self:fifo_file manage_fifo_file_perms;
 allow ncftool_t self:unix_stream_socket create_stream_socket_perms;
-allow ncftool_t self:tcp_socket create_stream_socket_perms;
 allow ncftool_t self:netlink_route_socket create_netlink_socket_perms;
+allow ncftool_t self:tcp_socket create_stream_socket_perms;
 
 kernel_read_kernel_sysctls(ncftool_t)
 kernel_read_modprobe_sysctls(ncftool_t)
@@ -60,6 +60,10 @@
 userdom_read_user_tmp_files(ncftool_t)
 
 optional_policy(`
+	brctl_run(ncftool_t, ncftool_roles)
+')
+
+optional_policy(`
 	consoletype_exec(ncftool_t)
 ')
 
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/nessus.fc refpolicy/policy/modules/contrib/nessus.fc
--- refpolicy/policy/modules/contrib/nessus.fc	2012-05-04 16:19:39.000000000 +0200
+++ refpolicy/policy/modules/contrib/nessus.fc	2012-10-15 20:35:12.534002237 +0200
@@ -1,10 +1,13 @@
+/etc/nessus/nessusd\.conf	--	gen_context(system_u:object_r:nessusd_etc_t,s0)
 
-/etc/nessus/nessusd\.conf --	gen_context(system_u:object_r:nessusd_etc_t,s0)
+/etc/rc\.d/init\.d/nessusd	--	gen_context(system_u:object_r:nessusd_initrc_exec_t,s0)
 
-/usr/lib/nessus/plugins/.* --	gen_context(system_u:object_r:nessusd_exec_t,s0)
+/usr/lib/nessus/plugins/.*	--	gen_context(system_u:object_r:nessusd_exec_t,s0)
 
 /usr/sbin/nessusd	--	gen_context(system_u:object_r:nessusd_exec_t,s0)
 
-/var/lib/nessus(/.*)?		gen_context(system_u:object_r:nessusd_db_t,s0)
+/var/lib/nessus(/.*)?	gen_context(system_u:object_r:nessusd_db_t,s0)
 
-/var/log/nessus(/.*)?		gen_context(system_u:object_r:nessusd_log_t,s0)
+/var/log/nessus(/.*)?	gen_context(system_u:object_r:nessusd_log_t,s0)
+
+/var/run/nessus.*	--	gen_context(system_u:object_r:nessusd_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/nessus.if refpolicy/policy/modules/contrib/nessus.if
--- refpolicy/policy/modules/contrib/nessus.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/nessus.if	2012-10-15 20:35:12.534002237 +0200
@@ -1,4 +1,4 @@
-## <summary>Nessus network scanning daemon</summary>
+## <summary>Network scanning daemon.</summary>
 
 ########################################
 ## <summary>
@@ -13,3 +13,47 @@
 interface(`nessus_tcp_connect',`
 	refpolicywarn(`$0($*) has been deprecated.')
 ')
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an nessus environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`nessus_admin',`
+	gen_require(`
+		type nessusd_t, nessusd_db_t, nessusd_initrc_exec_t;
+		type nessusd_etc_t, nessusd_log_t, nessusd_var_run_t;
+	')
+
+	allow $1 nessusd_t:process { ptrace signal_perms };
+	ps_process_pattern($1, nessusd_t)
+
+	init_labeled_script_domtrans($1, nessusd_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 nessusd_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	logging_search_logs($1)
+	admin_pattern($1, nessusd_log_t)
+
+	files_search_etc($1)
+	admin_pattern($1, nessusd_etc_t)
+
+	files_search_pids($1)
+	admin_pattern($1, nessusd_var_run_t)
+
+	files_search_var_lib($1)
+	admin_pattern($1, nessusd_db_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/nessus.te refpolicy/policy/modules/contrib/nessus.te
--- refpolicy/policy/modules/contrib/nessus.te	2012-07-25 20:33:05.000000000 +0200
+++ refpolicy/policy/modules/contrib/nessus.te	2012-10-15 20:35:12.552002237 +0200
@@ -1,4 +1,4 @@
-policy_module(nessus, 1.8.0)
+policy_module(nessus, 1.8.1)
 
 ########################################
 #
@@ -9,6 +9,9 @@
 type nessusd_exec_t;
 init_daemon_domain(nessusd_t, nessusd_exec_t)
 
+type nessusd_initrc_exec_t;
+init_script_file(nessusd_initrc_exec_t)
+
 type nessusd_db_t;
 files_type(nessusd_db_t)
 
@@ -35,17 +38,17 @@
 allow nessusd_t self:rawip_socket create_socket_perms;
 allow nessusd_t self:packet_socket create_socket_perms;
 
-# Allow access to the nessusd authentication database
 manage_dirs_pattern(nessusd_t, nessusd_db_t, nessusd_db_t)
 manage_files_pattern(nessusd_t, nessusd_db_t, nessusd_db_t)
 manage_lnk_files_pattern(nessusd_t, nessusd_db_t, nessusd_db_t)
-files_list_var_lib(nessusd_t)
 
 allow nessusd_t nessusd_etc_t:file read_file_perms;
-files_search_etc(nessusd_t)
 
-manage_files_pattern(nessusd_t, nessusd_log_t, nessusd_log_t)
-logging_log_filetrans(nessusd_t, nessusd_log_t, { file dir })
+allow nessusd_t nessusd_log_t:dir setattr_dir_perms;
+append_files_pattern(nessusd_t, nessusd_log_t, nessusd_log_t)
+create_files_pattern(nessusd_t, nessusd_log_t, nessusd_log_t)
+setattr_files_pattern(nessusd_t, nessusd_log_t, nessusd_log_t)
+logging_log_filetrans(nessusd_t, nessusd_log_t, file)
 
 manage_files_pattern(nessusd_t, nessusd_var_run_t, nessusd_var_run_t)
 files_pid_filetrans(nessusd_t, nessusd_var_run_t, file)
@@ -53,7 +56,6 @@
 kernel_read_system_state(nessusd_t)
 kernel_read_kernel_sysctls(nessusd_t)
 
-# for nmap etc
 corecmd_exec_bin(nessusd_t)
 
 corenet_all_recvfrom_unlabeled(nessusd_t)
@@ -67,16 +69,19 @@
 corenet_tcp_sendrecv_all_ports(nessusd_t)
 corenet_udp_sendrecv_all_ports(nessusd_t)
 corenet_tcp_bind_generic_node(nessusd_t)
+
+corenet_sendrecv_nessus_server_packets(nessusd_t)
 corenet_tcp_bind_nessus_port(nessusd_t)
-corenet_tcp_connect_all_ports(nessusd_t)
+
 corenet_sendrecv_all_client_packets(nessusd_t)
-corenet_sendrecv_nessus_server_packets(nessusd_t)
+corenet_tcp_connect_all_ports(nessusd_t)
 
 dev_read_sysfs(nessusd_t)
 dev_read_urand(nessusd_t)
 
 domain_use_interactive_fds(nessusd_t)
 
+files_list_var_lib(nessusd_t)
 files_read_etc_files(nessusd_t)
 files_read_etc_runtime_files(nessusd_t)
 
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/networkmanager.fc refpolicy/policy/modules/contrib/networkmanager.fc
--- refpolicy/policy/modules/contrib/networkmanager.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/networkmanager.fc	2012-10-15 20:35:15.289002243 +0200
@@ -1,26 +1,44 @@
-/etc/rc\.d/init\.d/wicd		--	gen_context(system_u:object_r:NetworkManager_initrc_exec_t,s0)
+/etc/rc\.d/init\.d/wicd	--	gen_context(system_u:object_r:NetworkManager_initrc_exec_t,s0)
 
-/etc/NetworkManager/dispatcher\.d(/.*)	gen_context(system_u:object_r:NetworkManager_initrc_exec_t,s0)
+/etc/NetworkManager(/.*)?	gen_context(system_u:object_r:NetworkManager_etc_t,s0)
+/etc/NetworkManager/NetworkManager\.conf	gen_context(system_u:object_r:NetworkManager_etc_rw_t,s0)
+/etc/NetworkManager/system-connections(/.*)?	gen_context(system_u:object_r:NetworkManager_etc_rw_t,s0)
+/etc/NetworkManager/dispatcher\.d(/.*)?	gen_context(system_u:object_r:NetworkManager_initrc_exec_t,s0)
 
-/usr/libexec/nm-dispatcher.action --	gen_context(system_u:object_r:NetworkManager_initrc_exec_t,s0)
+/etc/dhcp/manager-settings\.conf	--	gen_context(system_u:object_r:NetworkManager_etc_rw_t, s0)
+/etc/dhcp/wireless-settings\.conf	--	gen_context(system_u:object_r:NetworkManager_etc_rw_t, s0)
+/etc/dhcp/wired-settings\.conf	--	gen_context(system_u:object_r:NetworkManager_etc_rw_t, s0)
 
-/sbin/wpa_cli			--	gen_context(system_u:object_r:wpa_cli_exec_t,s0)
-/sbin/wpa_supplicant		--	gen_context(system_u:object_r:NetworkManager_exec_t,s0)
+/etc/wicd/manager-settings\.conf	--	gen_context(system_u:object_r:NetworkManager_etc_rw_t, s0)
+/etc/wicd/wireless-settings\.conf	--	gen_context(system_u:object_r:NetworkManager_etc_rw_t, s0)
+/etc/wicd/wired-settings\.conf	--	gen_context(system_u:object_r:NetworkManager_etc_rw_t, s0)
 
-/usr/s?bin/NetworkManager	--	gen_context(system_u:object_r:NetworkManager_exec_t,s0)
-/usr/s?bin/wpa_supplicant	--	gen_context(system_u:object_r:NetworkManager_exec_t,s0)
-/usr/sbin/NetworkManagerDispatcher --	gen_context(system_u:object_r:NetworkManager_exec_t,s0)
+/usr/libexec/nm-dispatcher\.action	--	gen_context(system_u:object_r:NetworkManager_initrc_exec_t,s0)
+
+/sbin/wpa_cli	--	gen_context(system_u:object_r:wpa_cli_exec_t,s0)
+/sbin/wpa_supplicant	--	gen_context(system_u:object_r:NetworkManager_exec_t,s0)
+
+/usr/bin/NetworkManager	--	gen_context(system_u:object_r:NetworkManager_exec_t,s0)
+/usr/bin/wpa_supplicant	--	gen_context(system_u:object_r:NetworkManager_exec_t,s0)
+
+/usr/sbin/NetworkManager	--	gen_context(system_u:object_r:NetworkManager_exec_t,s0)
+/usr/sbin/NetworkManagerDispatcher	--	gen_context(system_u:object_r:NetworkManager_exec_t,s0)
 /usr/sbin/nm-system-settings	--	gen_context(system_u:object_r:NetworkManager_exec_t,s0)
-/usr/sbin/wicd 			--	gen_context(system_u:object_r:NetworkManager_exec_t,s0)
+/usr/sbin/wicd	--	gen_context(system_u:object_r:NetworkManager_exec_t,s0)
+/usr/sbin/wpa_cli	--	gen_context(system_u:object_r:wpa_cli_exec_t,s0)
+/usr/sbin/wpa_supplicant	--	gen_context(system_u:object_r:NetworkManager_exec_t,s0)
 
-/var/lib/wicd(/.*)?			gen_context(system_u:object_r:NetworkManager_var_lib_t,s0)
-/var/lib/NetworkManager(/.*)?		gen_context(system_u:object_r:NetworkManager_var_lib_t,s0)
+/var/lib/wicd(/.*)?	gen_context(system_u:object_r:NetworkManager_var_lib_t,s0)
+/var/lib/NetworkManager(/.*)?	gen_context(system_u:object_r:NetworkManager_var_lib_t,s0)
 
-/var/log/wicd(/.*)? 			gen_context(system_u:object_r:NetworkManager_log_t,s0)
+/var/log/wicd(/.*)?	gen_context(system_u:object_r:NetworkManager_log_t,s0)
 /var/log/wpa_supplicant.*	--	gen_context(system_u:object_r:NetworkManager_log_t,s0)
 
 /var/run/NetworkManager\.pid	--	gen_context(system_u:object_r:NetworkManager_var_run_t,s0)
-/var/run/NetworkManager(/.*)?		gen_context(system_u:object_r:NetworkManager_var_run_t,s0)
-/var/run/nm-dhclient.*			gen_context(system_u:object_r:NetworkManager_var_run_t,s0)
-/var/run/wpa_supplicant(/.*)?		gen_context(system_u:object_r:NetworkManager_var_run_t,s0)
+/var/run/NetworkManager(/.*)?	gen_context(system_u:object_r:NetworkManager_var_run_t,s0)
+/var/run/nm-dhclient.*	gen_context(system_u:object_r:NetworkManager_var_run_t,s0)
+/var/run/nm-dns-dnsmasq\.conf	--	gen_context(system_u:object_r:NetworkManager_var_run_t,s0)
+/var/run/wpa_supplicant(/.*)?	gen_context(system_u:object_r:NetworkManager_var_run_t,s0)
 /var/run/wpa_supplicant-global	-s	gen_context(system_u:object_r:NetworkManager_var_run_t,s0)
+/var/run/wpa_cli-.*		--	gen_context(system_u:object_r:wpa_cli_var_run_t,s0)
+/usr/bin/wpa_cli		--	gen_context(system_u:object_r:wpa_cli_exec_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/networkmanager.if refpolicy/policy/modules/contrib/networkmanager.if
--- refpolicy/policy/modules/contrib/networkmanager.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/networkmanager.if	2012-11-01 22:26:15.852790650 +0100
@@ -2,7 +2,7 @@
 
 ########################################
 ## <summary>
-##	Read and write NetworkManager UDP sockets.
+##	Read and write networkmanager udp sockets.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -10,7 +10,6 @@
 ##	</summary>
 ## </param>
 #
-# cjp: added for named.
 interface(`networkmanager_rw_udp_sockets',`
 	gen_require(`
 		type NetworkManager_t;
@@ -21,7 +20,7 @@
 
 ########################################
 ## <summary>
-##	Read and write NetworkManager packet sockets.
+##	Read and write networkmanager packet sockets.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -29,7 +28,6 @@
 ##	</summary>
 ## </param>
 #
-# cjp: added for named.
 interface(`networkmanager_rw_packet_sockets',`
 	gen_require(`
 		type NetworkManager_t;
@@ -40,7 +38,7 @@
 
 #######################################
 ## <summary>
-## Allow caller to relabel tun_socket
+## Relabel networkmanager tun socket.
 ## </summary>
 ## <param name="domain">
 ## <summary>
@@ -59,7 +57,7 @@
 
 ########################################
 ## <summary>
-##	Read and write NetworkManager netlink
+##	Read and write networkmanager netlink
 ##	routing sockets.
 ## </summary>
 ## <param name="domain">
@@ -68,7 +66,6 @@
 ##	</summary>
 ## </param>
 #
-# cjp: added for named.
 interface(`networkmanager_rw_routing_sockets',`
 	gen_require(`
 		type NetworkManager_t;
@@ -79,7 +76,7 @@
 
 ########################################
 ## <summary>
-##	Execute NetworkManager with a domain transition.
+##	Execute networkmanager with a domain transition.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -98,7 +95,8 @@
 
 ########################################
 ## <summary>
-##	Execute NetworkManager scripts with an automatic domain transition to initrc.
+##	Execute networkmanager scripts with
+##	an automatic domain transition to initrc.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -117,7 +115,7 @@
 ########################################
 ## <summary>
 ##	Send and receive messages from
-##	NetworkManager over dbus.
+##	networkmanager over dbus.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -137,7 +135,7 @@
 
 ########################################
 ## <summary>
-##	Send a generic signal to NetworkManager
+##	Send generic signals to networkmanager.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -155,7 +153,7 @@
 
 ########################################
 ## <summary>
-##	Read NetworkManager lib files.
+##	Read networkmanager lib files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -175,7 +173,27 @@
 
 ########################################
 ## <summary>
-##	Read NetworkManager PID files.
+##	Append networkmanager log files.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`networkmanager_append_log_files',`
+	gen_require(`
+		type NetworkManager_log_t;
+	')
+
+	logging_search_logs($1)
+	allow $1 NetworkManager_log_t:dir list_dir_perms;
+	append_files_pattern($1, NetworkManager_log_t, NetworkManager_log_t)
+')
+
+########################################
+## <summary>
+##	Read networkmanager pid files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -191,3 +209,115 @@
 	files_search_pids($1)
 	allow $1 NetworkManager_var_run_t:file read_file_perms;
 ')
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an networkmanager environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`networkmanager_admin',`
+	gen_require(`
+		type NetworkManager_t, NetworkManager_initrc_exec_t, NetworkManager_etc_t;
+		type NetworkManager_etc_rw_t, NetworkManager_log_t, NetworkManager_tmp_t;
+		type NetworkManager_var_lib_t, NetworkManager_var_run_t, wpa_cli_t;
+	')
+
+	allow $1 { wpa_cli_t NetworkManager_t }:process { ptrace signal_perms };
+	ps_process_pattern($1, { wpa_cli_t NetworkManager_t })
+
+	init_labeled_script_domtrans($1, NetworkManager_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 NetworkManager_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	logging_search_etc($1)
+	admin_pattern($1, { NetworkManager_etc_t NetworkManager_etc_rw_t })
+
+	logging_search_logs($1)
+	admin_pattern($1, NetworkManager_log_t)
+
+	files_search_var_lib($1)
+	admin_pattern($1, NetworkManager_var_lib_t)
+
+	files_search_pids($1)
+	admin_pattern($1, NetworkManager_var_run_t)
+
+	files_search_tmp($1)
+	admin_pattern($1, NetworkManager_tmp_t)
+')
+
+########################################
+## <summary>
+##	Do not audit use of wpa_cli file descriptors
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain to dontaudit access.
+##	</summary>
+## </param>
+#
+interface(`networkmanager_dontaudit_use_wpa_cli_fds',`
+	gen_require(`
+		type wpa_cli_t;
+	')
+
+	dontaudit $1 wpa_cli_t:fd use;
+')
+
+
+########################################
+## <summary>
+##      Execute wpa_cli in the wpa_cli domain.
+## </summary>
+## <param name="domain">
+##      <summary>
+##      Domain allowed to transition.
+##      </summary>
+## </param>
+#
+interface(`networkmanager_domtrans_wpa_cli',`
+        gen_require(`
+                type wpa_cli_t, wpa_cli_exec_t;
+        ')
+
+        corecmd_search_bin($1)
+        domtrans_pattern($1, wpa_cli_exec_t, wpa_cli_t)
+')
+
+########################################
+## <summary>
+##      Execute wpa cli in the wpa_cli domain, and
+##      allow the specified role the wpa_cli domain.
+## </summary>
+## <param name="domain">
+##      <summary>
+##      Domain allowed to transition.
+##      </summary>
+## </param>
+## <param name="role">
+##      <summary>
+##      Role allowed access.
+##      </summary>
+## </param>
+## <rolecap/>
+#
+interface(`networkmanager_run_wpa_cli',`
+        gen_require(`
+                type wpa_cli_exec_t;
+        ')
+
+        networkmanager_domtrans_wpa_cli($1)
+        role $2 types wpa_cli_t;
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/networkmanager.te refpolicy/policy/modules/contrib/networkmanager.te
--- refpolicy/policy/modules/contrib/networkmanager.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/networkmanager.te	2012-11-01 22:25:47.261790568 +0100
@@ -1,4 +1,4 @@
-policy_module(networkmanager, 1.14.0)
+policy_module(networkmanager, 1.14.5)
 
 ########################################
 #
@@ -9,6 +9,12 @@
 type NetworkManager_exec_t;
 init_daemon_domain(NetworkManager_t, NetworkManager_exec_t)
 
+type NetworkManager_etc_t;
+files_config_file(NetworkManager_etc_t)
+
+type NetworkManager_etc_rw_t;
+files_config_file(NetworkManager_etc_rw_t)
+
 type NetworkManager_initrc_exec_t;
 init_script_file(NetworkManager_initrc_exec_t)
 
@@ -28,31 +34,43 @@
 type wpa_cli_exec_t;
 init_system_domain(wpa_cli_t, wpa_cli_exec_t)
 
+ifdef(`distro_gentoo',`
+	type wpa_cli_var_run_t;
+	files_pid_file(wpa_cli_var_run_t)
+')
+
 ########################################
 #
 # Local policy
 #
 
-# networkmanager will ptrace itself if gdb is installed
-# and it receives a unexpected signal (rh bug #204161)
-allow NetworkManager_t self:capability { chown fsetid kill setgid setuid sys_nice sys_ptrace dac_override net_admin net_raw net_bind_service ipc_lock };
-dontaudit NetworkManager_t self:capability { sys_tty_config sys_ptrace };
+allow NetworkManager_t self:capability { chown fsetid kill setgid setuid sys_nice dac_override net_admin net_raw net_bind_service ipc_lock };
+dontaudit NetworkManager_t self:capability { sys_tty_config sys_module sys_ptrace };
 allow NetworkManager_t self:process { ptrace getcap setcap setpgid getsched setsched signal_perms };
 allow NetworkManager_t self:fifo_file rw_fifo_file_perms;
-allow NetworkManager_t self:unix_dgram_socket { sendto create_socket_perms };
-allow NetworkManager_t self:unix_stream_socket create_stream_socket_perms;
+allow NetworkManager_t self:unix_dgram_socket sendto;
+allow NetworkManager_t self:unix_stream_socket { accept listen };
 allow NetworkManager_t self:netlink_route_socket create_netlink_socket_perms;
+allow NetworkManager_t self:netlink_socket create_socket_perms;
 allow NetworkManager_t self:netlink_kobject_uevent_socket create_socket_perms;
-allow NetworkManager_t self:tcp_socket create_stream_socket_perms;
-allow NetworkManager_t self:tun_socket { create_socket_perms relabelfrom };
-allow NetworkManager_t self:udp_socket create_socket_perms;
+allow NetworkManager_t self:tcp_socket { accept listen };
+allow NetworkManager_t self:tun_socket { create_socket_perms relabelfrom relabelto };
 allow NetworkManager_t self:packet_socket create_socket_perms;
 
 allow NetworkManager_t wpa_cli_t:unix_dgram_socket sendto;
 
-can_exec(NetworkManager_t, NetworkManager_exec_t)
-
-manage_files_pattern(NetworkManager_t, NetworkManager_log_t, NetworkManager_log_t)
+allow NetworkManager_t NetworkManager_etc_t:dir list_dir_perms;
+allow NetworkManager_t NetworkManager_etc_t:file read_file_perms;
+allow NetworkManager_t NetworkManager_etc_t:lnk_file read_lnk_file_perms;
+
+manage_dirs_pattern(NetworkManager_t, NetworkManager_etc_rw_t, NetworkManager_etc_rw_t)
+manage_files_pattern(NetworkManager_t, NetworkManager_etc_rw_t, NetworkManager_etc_rw_t)
+filetrans_pattern(NetworkManager_t, NetworkManager_etc_t, NetworkManager_etc_rw_t, { dir file })
+
+allow NetworkManager_t NetworkManager_log_t:dir setattr_dir_perms;
+append_files_pattern(NetworkManager_t, NetworkManager_log_t, NetworkManager_log_t)
+create_files_pattern(NetworkManager_t, NetworkManager_log_t, NetworkManager_log_t)
+setattr_files_pattern(NetworkManager_t, NetworkManager_log_t, NetworkManager_log_t)
 logging_log_filetrans(NetworkManager_t, NetworkManager_log_t, file)
 
 manage_files_pattern(NetworkManager_t, NetworkManager_tmp_t, NetworkManager_tmp_t)
@@ -68,6 +86,8 @@
 manage_sock_files_pattern(NetworkManager_t, NetworkManager_var_run_t, NetworkManager_var_run_t)
 files_pid_filetrans(NetworkManager_t, NetworkManager_var_run_t, { dir file sock_file })
 
+can_exec(NetworkManager_t, { NetworkManager_exec_t wpa_cli_exec_t NetworkManager_tmp_t })
+
 kernel_read_system_state(NetworkManager_t)
 kernel_read_network_state(NetworkManager_t)
 kernel_read_kernel_sysctls(NetworkManager_t)
@@ -86,20 +106,35 @@
 corenet_tcp_sendrecv_all_ports(NetworkManager_t)
 corenet_udp_sendrecv_all_ports(NetworkManager_t)
 corenet_udp_bind_generic_node(NetworkManager_t)
-corenet_udp_bind_isakmp_port(NetworkManager_t)
-corenet_udp_bind_dhcpc_port(NetworkManager_t)
-corenet_tcp_connect_all_ports(NetworkManager_t)
+
 corenet_sendrecv_isakmp_server_packets(NetworkManager_t)
+corenet_udp_bind_isakmp_port(NetworkManager_t)
+
 corenet_sendrecv_dhcpc_server_packets(NetworkManager_t)
+corenet_udp_bind_dhcpc_port(NetworkManager_t)
+
 corenet_sendrecv_all_client_packets(NetworkManager_t)
+corenet_tcp_connect_all_ports(NetworkManager_t)
+
 corenet_rw_tun_tap_dev(NetworkManager_t)
 corenet_getattr_ppp_dev(NetworkManager_t)
 
-dev_read_sysfs(NetworkManager_t)
+corecmd_exec_shell(NetworkManager_t)
+corecmd_exec_bin(NetworkManager_t)
+
+dev_rw_sysfs(NetworkManager_t)
 dev_read_rand(NetworkManager_t)
 dev_read_urand(NetworkManager_t)
 dev_dontaudit_getattr_generic_blk_files(NetworkManager_t)
 dev_getattr_all_chr_files(NetworkManager_t)
+dev_rw_wireless(NetworkManager_t)
+
+domain_use_interactive_fds(NetworkManager_t)
+domain_read_all_domains_state(NetworkManager_t)
+
+files_read_etc_runtime_files(NetworkManager_t)
+files_read_usr_files(NetworkManager_t)
+files_read_usr_src_files(NetworkManager_t)
 
 fs_getattr_all_fs(NetworkManager_t)
 fs_search_auto_mountpoints(NetworkManager_t)
@@ -109,17 +144,6 @@
 
 selinux_dontaudit_search_fs(NetworkManager_t)
 
-corecmd_exec_shell(NetworkManager_t)
-corecmd_exec_bin(NetworkManager_t)
-
-domain_use_interactive_fds(NetworkManager_t)
-domain_read_confined_domains_state(NetworkManager_t)
-
-files_read_etc_files(NetworkManager_t)
-files_read_etc_runtime_files(NetworkManager_t)
-files_read_usr_files(NetworkManager_t)
-files_read_usr_src_files(NetworkManager_t)
-
 storage_getattr_fixed_disk_dev(NetworkManager_t)
 
 init_read_utmp(NetworkManager_t)
@@ -130,27 +154,31 @@
 
 logging_send_syslog_msg(NetworkManager_t)
 
-miscfiles_read_localization(NetworkManager_t)
 miscfiles_read_generic_certs(NetworkManager_t)
-
-modutils_domtrans_insmod(NetworkManager_t)
+miscfiles_read_localization(NetworkManager_t)
 
 seutil_read_config(NetworkManager_t)
 
 sysnet_domtrans_ifconfig(NetworkManager_t)
 sysnet_domtrans_dhcpc(NetworkManager_t)
 sysnet_signal_dhcpc(NetworkManager_t)
+sysnet_signull_dhcpc(NetworkManager_t)
 sysnet_read_dhcpc_pid(NetworkManager_t)
+sysnet_read_dhcp_config(NetworkManager_t)
 sysnet_delete_dhcpc_pid(NetworkManager_t)
+sysnet_kill_dhcpc(NetworkManager_t)
+sysnet_read_dhcpc_state(NetworkManager_t)
+sysnet_delete_dhcpc_state(NetworkManager_t)
 sysnet_search_dhcp_state(NetworkManager_t)
-# in /etc created by NetworkManager will be labelled net_conf_t.
 sysnet_manage_config(NetworkManager_t)
 sysnet_etc_filetrans_config(NetworkManager_t)
 
+# certificates in user home directories (cert_home_t in ~/\.pki)
+userdom_read_user_home_content_files(NetworkManager_t)
+
+userdom_write_user_tmp_sockets(NetworkManager_t)
 userdom_dontaudit_use_unpriv_user_fds(NetworkManager_t)
 userdom_dontaudit_use_user_ttys(NetworkManager_t)
-# Read gnome-keyring
-userdom_read_user_home_content_files(NetworkManager_t)
 
 optional_policy(`
 	avahi_domtrans(NetworkManager_t)
@@ -172,15 +200,31 @@
 ')
 
 optional_policy(`
+	consolekit_read_pid_files(NetworkManager_t)
+')
+
+optional_policy(`
 	consoletype_exec(NetworkManager_t)
 ')
 
 optional_policy(`
+	cron_read_system_job_lib_files(NetworkManager_t)
+')
+
+optional_policy(`
 	dbus_system_domain(NetworkManager_t, NetworkManager_exec_t)
 
 	optional_policy(`
+		avahi_dbus_chat(NetworkManager_t)
+	')
+
+	optional_policy(`
 		consolekit_dbus_chat(NetworkManager_t)
 	')
+
+	optional_policy(`
+		policykit_dbus_chat(NetworkManager_t)
+	')
 ')
 
 optional_policy(`
@@ -194,6 +238,10 @@
 ')
 
 optional_policy(`
+	gnome_stream_connect_all_gkeyringd(NetworkManager_t)
+')
+
+optional_policy(`
 	hal_write_log(NetworkManager_t)
 ')
 
@@ -202,10 +250,29 @@
 ')
 
 optional_policy(`
+	ipsec_domtrans_mgmt(NetworkManager_t)
+	ipsec_kill_mgmt(NetworkManager_t)
+	ipsec_signal_mgmt(NetworkManager_t)
+	ipsec_signull_mgmt(NetworkManager_t)
+')
+
+optional_policy(`
 	iptables_domtrans(NetworkManager_t)
 ')
 
 optional_policy(`
+	libs_exec_ldconfig(NetworkManager_t)
+')
+
+optional_policy(`
+	modutils_domtrans_insmod(NetworkManager_t)
+')
+
+optional_policy(`
+	netutils_exec_ping(NetworkManager_t)
+')
+
+optional_policy(`
 	nscd_domtrans(NetworkManager_t)
 	nscd_signal(NetworkManager_t)
 	nscd_signull(NetworkManager_t)
@@ -214,11 +281,11 @@
 ')
 
 optional_policy(`
-	# Dispatcher starting and stoping ntp
 	ntp_initrc_domtrans(NetworkManager_t)
 ')
 
 optional_policy(`
+	openvpn_read_config(NetworkManager_t)
 	openvpn_domtrans(NetworkManager_t)
 	openvpn_kill(NetworkManager_t)
 	openvpn_signal(NetworkManager_t)
@@ -226,7 +293,6 @@
 ')
 
 optional_policy(`
-	policykit_dbus_chat(NetworkManager_t)
 	policykit_domtrans_auth(NetworkManager_t)
 	policykit_read_lib(NetworkManager_t)
 	policykit_read_reload(NetworkManager_t)
@@ -234,6 +300,10 @@
 ')
 
 optional_policy(`
+	polipo_initrc_domtrans(NetworkManager_t)
+')
+
+optional_policy(`
 	ppp_initrc_domtrans(NetworkManager_t)
 	ppp_domtrans(NetworkManager_t)
 	ppp_manage_pid_files(NetworkManager_t)
@@ -259,10 +329,16 @@
 ')
 
 optional_policy(`
+	# unconfined_dgram_send(NetworkManager_t)
+	unconfined_stream_connect(NetworkManager_t)
+')
+
+optional_policy(`
 	vpn_domtrans(NetworkManager_t)
 	vpn_kill(NetworkManager_t)
 	vpn_signal(NetworkManager_t)
 	vpn_signull(NetworkManager_t)
+	vpn_relabelfrom_tun_socket(NetworkManager_t)
 ')
 
 ########################################
@@ -287,3 +363,28 @@
 miscfiles_read_localization(wpa_cli_t)
 
 term_dontaudit_use_console(wpa_cli_t)
+
+ifdef(`distro_gentoo',`
+	manage_files_pattern(wpa_cli_t, wpa_cli_var_run_t, wpa_cli_var_run_t)
+	files_pid_filetrans(wpa_cli_t, wpa_cli_var_run_t, file)
+
+	corecmd_exec_bin(wpa_cli_t)
+	corecmd_exec_shell(wpa_cli_t)
+
+	domain_use_interactive_fds(wpa_cli_t)
+
+	files_read_etc_files(wpa_cli_t)
+	files_search_pids(wpa_cli_t)
+
+	term_dontaudit_use_console(wpa_cli_t)
+
+	getty_use_fds(wpa_cli_t)
+
+	init_domtrans_script(wpa_cli_t)
+
+	logging_send_syslog_msg(wpa_cli_t)
+
+	sysnet_domtrans_dhcpc(wpa_cli_t)
+
+	userdom_use_user_terminals(wpa_cli_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/nginx.fc refpolicy/policy/modules/contrib/nginx.fc
--- refpolicy/policy/modules/contrib/nginx.fc	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/nginx.fc	2012-05-05 16:11:28.380762616 +0200
@@ -0,0 +1,63 @@
+###############################################################################
+# SELinux module for the NGINX Web Server
+#
+# Project Contact Information:
+#   Stuart Cianos
+#   Email: scianos@alphavida.com
+#
+###############################################################################
+# (C) Copyright 2009 by Stuart Cianos, d/b/a AlphaVida. All Rights Reserved.
+#
+#
+# Stuart Cianos licenses this file to You under the GNU General Public License,
+# Version 3.0 (the "License"); you may not use this file except in compliance
+# with the License.  You may obtain a copy of the License at
+#
+#     http://www.gnu.org/licenses/gpl.txt
+#
+# or in the COPYING file included in the original archive.
+#
+# Disclaimer of Warranty.
+#
+# THERE IS NO WARRANTY FOR THE PROGRAM, TO THE EXTENT PERMITTED BY
+# APPLICABLE LAW.  EXCEPT WHEN OTHERWISE STATED IN WRITING THE COPYRIGHT
+# HOLDERS AND/OR OTHER PARTIES PROVIDE THE PROGRAM "AS IS" WITHOUT WARRANTY
+# OF ANY KIND, EITHER EXPRESSED OR IMPLIED, INCLUDING, BUT NOT LIMITED TO,
+# THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
+# PURPOSE.  THE ENTIRE RISK AS TO THE QUALITY AND PERFORMANCE OF THE PROGRAM
+# IS WITH YOU.  SHOULD THE PROGRAM PROVE DEFECTIVE, YOU ASSUME THE COST OF
+# ALL NECESSARY SERVICING, REPAIR OR CORRECTION.
+#
+# Limitation of Liability.
+#
+# IN NO EVENT UNLESS REQUIRED BY APPLICABLE LAW OR AGREED TO IN WRITING
+# WILL ANY COPYRIGHT HOLDER, OR ANY OTHER PARTY WHO MODIFIES AND/OR CONVEYS
+# THE PROGRAM AS PERMITTED ABOVE, BE LIABLE TO YOU FOR DAMAGES, INCLUDING ANY
+# GENERAL, SPECIAL, INCIDENTAL OR CONSEQUENTIAL DAMAGES ARISING OUT OF THE
+# USE OR INABILITY TO USE THE PROGRAM (INCLUDING BUT NOT LIMITED TO LOSS OF
+# DATA OR DATA BEING RENDERED INACCURATE OR LOSSES SUSTAINED BY YOU OR THIRD
+# PARTIES OR A FAILURE OF THE PROGRAM TO OPERATE WITH ANY OTHER PROGRAMS),
+# EVEN IF SUCH HOLDER OR OTHER PARTY HAS BEEN ADVISED OF THE POSSIBILITY OF
+# SUCH DAMAGES.
+###############################################################################
+# nginx executable will have:
+# label: system_u:object_r:nginx_exec_t
+# MLS sensitivity: s0
+# MCS categories: <none>
+
+#
+# /etc
+#
+/etc/nginx(/.*)?				gen_context(system_u:object_r:nginx_conf_t,s0)
+/etc/ssl/nginx(/.*)?				gen_context(system_u:object_r:nginx_conf_t,s0)
+
+#
+# /usr
+#
+/usr/sbin/nginx				--	gen_context(system_u:object_r:nginx_exec_t,s0)
+
+#
+# /var
+#
+/var/log/nginx(/.*)?				gen_context(system_u:object_r:nginx_log_t,s0)
+/var/tmp/nginx(/.*)?				gen_context(system_u:object_r:nginx_tmp_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/nginx.if refpolicy/policy/modules/contrib/nginx.if
--- refpolicy/policy/modules/contrib/nginx.if	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/nginx.if	2012-05-05 16:11:28.401762616 +0200
@@ -0,0 +1,101 @@
+###############################################################################
+# SELinux module for the NGINX Web Server
+#
+# Project Contact Information:
+#   Stuart Cianos
+#   Email: scianos@alphavida.com
+#
+###############################################################################
+# (C) Copyright 2009 by Stuart Cianos, d/b/a AlphaVida. All Rights Reserved.
+#
+#
+# Stuart Cianos licenses this file to You under the GNU General Public License,
+# Version 3.0 (the "License"); you may not use this file except in compliance
+# with the License.  You may obtain a copy of the License at
+#
+#     http://www.gnu.org/licenses/gpl.txt
+#
+# or in the COPYING file included in the original archive.
+#
+# Disclaimer of Warranty.
+#
+# THERE IS NO WARRANTY FOR THE PROGRAM, TO THE EXTENT PERMITTED BY
+# APPLICABLE LAW.  EXCEPT WHEN OTHERWISE STATED IN WRITING THE COPYRIGHT
+# HOLDERS AND/OR OTHER PARTIES PROVIDE THE PROGRAM "AS IS" WITHOUT WARRANTY
+# OF ANY KIND, EITHER EXPRESSED OR IMPLIED, INCLUDING, BUT NOT LIMITED TO,
+# THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
+# PURPOSE.  THE ENTIRE RISK AS TO THE QUALITY AND PERFORMANCE OF THE PROGRAM
+# IS WITH YOU.  SHOULD THE PROGRAM PROVE DEFECTIVE, YOU ASSUME THE COST OF
+# ALL NECESSARY SERVICING, REPAIR OR CORRECTION.
+#
+# Limitation of Liability.
+#
+# IN NO EVENT UNLESS REQUIRED BY APPLICABLE LAW OR AGREED TO IN WRITING
+# WILL ANY COPYRIGHT HOLDER, OR ANY OTHER PARTY WHO MODIFIES AND/OR CONVEYS
+# THE PROGRAM AS PERMITTED ABOVE, BE LIABLE TO YOU FOR DAMAGES, INCLUDING ANY
+# GENERAL, SPECIAL, INCIDENTAL OR CONSEQUENTIAL DAMAGES ARISING OUT OF THE
+# USE OR INABILITY TO USE THE PROGRAM (INCLUDING BUT NOT LIMITED TO LOSS OF
+# DATA OR DATA BEING RENDERED INACCURATE OR LOSSES SUSTAINED BY YOU OR THIRD
+# PARTIES OR A FAILURE OF THE PROGRAM TO OPERATE WITH ANY OTHER PROGRAMS),
+# EVEN IF SUCH HOLDER OR OTHER PARTY HAS BEEN ADVISED OF THE POSSIBILITY OF
+# SUCH DAMAGES.
+###############################################################################
+## <summary>policy for nginx</summary>
+
+########################################
+## <summary>
+##	Execute a domain transition to run nginx.
+## </summary>
+## <param name="domain">
+## <summary>
+##	Domain allowed to transition.
+## </summary>
+## </param>
+#
+interface(`nginx_domtrans',`
+	gen_require(`
+		type nginx_t, nginx_exec_t;
+	')
+	allow nginx_t $1:fd use;
+	allow nginx_t $1:fifo_file rw_file_perms;
+	allow nginx_t $1:process sigchld;
+
+	domain_auto_trans($1,nginx_exec_t,nginx_t)
+')
+
+########################################
+## <summary>
+##   Administer the nginx domain
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	The role to be allowed to manage the nginx domain.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`nginx_admin',`
+	gen_require(`
+		type nginx_t, nginx_conf_t, nginx_log_t, nginx_var_lib_t, nginx_var_run_t;
+	')
+
+	allow $1 nginx_t:process { ptrace signal_perms };
+	ps_process_pattern($1, nginx_t)
+
+	files_list_etc($1)
+	admin_pattern($1, nginx_conf_t)
+
+	files_list_var_lib($1)
+	admin_pattern($1, nginx_var_lib_t)
+
+	logging_list_logs($1)
+	admin_pattern($1, nginx_log_t)
+
+	files_list_pids($1)
+	admin_pattern($1, nginx_var_run_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/nginx.te refpolicy/policy/modules/contrib/nginx.te
--- refpolicy/policy/modules/contrib/nginx.te	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/nginx.te	2012-11-07 21:13:56.362195119 +0100
@@ -0,0 +1,159 @@
+# SELinux module for the NGINX Web Server
+policy_module(nginx,1.0.10)
+
+########################################
+#
+# Declarations
+#
+
+## <desc>
+## <p>
+## Allow nginx to serve HTTP content (act as an http server)
+## </p>
+## </desc>
+gen_tunable(gentoo_nginx_enable_http_server, false)
+
+## <desc>
+## <p>
+## Allow nginx to act as an imap proxy server)
+## </p>
+## </desc>
+gen_tunable(gentoo_nginx_enable_imap_server, false)
+
+## <desc>
+## <p>
+## Allow nginx to act as a pop3 server)
+## </p>
+## </desc>
+gen_tunable(gentoo_nginx_enable_pop3_server, false)
+
+## <desc>
+## <p>
+## Allow nginx to act as an smtp server)
+## </p>
+## </desc>
+gen_tunable(gentoo_nginx_enable_smtp_server, false)
+
+## <desc>
+## <p>
+## Allow nginx to connect to remote HTTP servers
+## </p>
+## </desc>
+gen_tunable(gentoo_nginx_can_network_connect_http, false)
+
+## <desc>
+## <p>
+## Allow nginx to connect to remote servers (regardless of protocol)
+## </p>
+## </desc>
+gen_tunable(gentoo_nginx_can_network_connect, false)
+
+type nginx_t;
+type nginx_exec_t;
+init_daemon_domain(nginx_t, nginx_exec_t)
+
+# conf files
+type nginx_conf_t;
+files_type(nginx_conf_t)
+
+# log files
+type nginx_log_t;
+logging_log_file(nginx_log_t)
+
+# tmp files
+type nginx_tmp_t;
+files_tmp_file(nginx_tmp_t)
+
+# var/lib files
+type nginx_var_lib_t;
+files_type(nginx_var_lib_t)
+
+# pid files
+type nginx_var_run_t;
+files_pid_file(nginx_var_run_t)
+
+########################################
+#
+# nginx local policy
+#
+
+allow nginx_t self:fifo_file { read write };
+allow nginx_t self:unix_stream_socket create_stream_socket_perms;
+allow nginx_t self:tcp_socket { listen accept };
+allow nginx_t self:capability { setuid net_bind_service setgid chown };
+
+# conf files
+list_dirs_pattern(nginx_t, nginx_conf_t, nginx_conf_t)
+read_files_pattern(nginx_t, nginx_conf_t, nginx_conf_t)
+
+# log files
+manage_files_pattern(nginx_t, nginx_log_t, nginx_log_t)
+logging_log_filetrans(nginx_t, nginx_log_t, { file dir })
+
+
+# pid file
+manage_dirs_pattern(nginx_t, nginx_var_run_t, nginx_var_run_t)
+manage_files_pattern(nginx_t, nginx_var_run_t, nginx_var_run_t)
+files_pid_filetrans(nginx_t, nginx_var_run_t, file)
+
+# tmp files
+manage_files_pattern(nginx_t, nginx_tmp_t, nginx_tmp_t)
+manage_dirs_pattern(nginx_t, nginx_tmp_t, nginx_tmp_t)
+files_tmp_filetrans(nginx_t, nginx_tmp_t, dir)
+
+# var/lib files
+create_files_pattern(nginx_t, nginx_var_lib_t, nginx_var_lib_t)
+create_sock_files_pattern(nginx_t, nginx_var_lib_t, nginx_var_lib_t)
+files_var_lib_filetrans(nginx_t,nginx_var_lib_t, { file dir sock_file })
+
+
+kernel_read_kernel_sysctls(nginx_t)
+corenet_tcp_bind_generic_node(nginx_t)
+corenet_tcp_sendrecv_generic_if(nginx_t)
+corenet_tcp_sendrecv_generic_node(nginx_t)
+
+dev_read_rand(nginx_t)
+dev_read_urand(nginx_t)
+
+domain_use_interactive_fds(nginx_t)
+
+files_read_etc_files(nginx_t)
+
+
+miscfiles_read_localization(nginx_t)
+sysnet_dns_name_resolve(nginx_t)
+
+
+tunable_policy(`gentoo_nginx_enable_http_server',`
+	corenet_tcp_bind_http_port(nginx_t)
+	apache_read_all_content(nginx_t)
+	apache_manage_all_rw_content(nginx_t)
+')
+
+# We enable both binding and connecting, since nginx acts here as a reverse proxy
+tunable_policy(`gentoo_nginx_enable_imap_server',`
+	corenet_tcp_bind_pop_port(nginx_t)
+	corenet_tcp_connect_pop_port(nginx_t)
+')
+
+tunable_policy(`gentoo_nginx_enable_pop3_server',`
+	corenet_tcp_bind_pop_port(nginx_t)
+	corenet_tcp_connect_pop_port(nginx_t)
+')
+
+tunable_policy(`gentoo_nginx_enable_smtp_server',`
+	corenet_tcp_bind_smtp_port(nginx_t)
+	corenet_tcp_connect_smtp_port(nginx_t)
+')
+
+tunable_policy(`gentoo_nginx_can_network_connect_http',`
+	corenet_tcp_connect_http_port(nginx_t)
+')
+
+tunable_policy(`gentoo_nginx_can_network_connect',`
+	corenet_tcp_connect_all_ports(nginx_t)
+')
+
+optional_policy(`
+	phpfpm_stream_connect(nginx_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/nis.fc refpolicy/policy/modules/contrib/nis.fc
--- refpolicy/policy/modules/contrib/nis.fc	2012-05-04 16:10:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/nis.fc	2012-10-16 19:35:56.160014002 +0200
@@ -2,17 +2,19 @@
 /etc/rc\.d/init\.d/yppasswd	--	gen_context(system_u:object_r:nis_initrc_exec_t,s0)
 /etc/rc\.d/init\.d/ypserv	--	gen_context(system_u:object_r:nis_initrc_exec_t,s0)
 /etc/rc\.d/init\.d/ypxfrd	--	gen_context(system_u:object_r:nis_initrc_exec_t,s0)
+
 /etc/ypserv\.conf	--	gen_context(system_u:object_r:ypserv_conf_t,s0)
 
-/sbin/ypbind		--	gen_context(system_u:object_r:ypbind_exec_t,s0)
+/sbin/ypbind	--	gen_context(system_u:object_r:ypbind_exec_t,s0)
 
 /usr/lib/yp/ypxfr	--	gen_context(system_u:object_r:ypxfr_exec_t,s0)
 
-/usr/sbin/rpc\.yppasswdd --	gen_context(system_u:object_r:yppasswdd_exec_t,s0)
+/usr/sbin/rpc\.yppasswdd	--	gen_context(system_u:object_r:yppasswdd_exec_t,s0)
 /usr/sbin/rpc\.ypxfrd	--	gen_context(system_u:object_r:ypxfr_exec_t,s0)
+/usr/sbin/ypbind	--	gen_context(system_u:object_r:ypbind_exec_t,s0)
 /usr/sbin/ypserv	--	gen_context(system_u:object_r:ypserv_exec_t,s0)
 
-/var/yp(/.*)?			gen_context(system_u:object_r:var_yp_t,s0)
+/var/yp(/.*)?	gen_context(system_u:object_r:var_yp_t,s0)
 
 /var/run/ypxfrd.*	--	gen_context(system_u:object_r:ypxfr_var_run_t,s0)
 /var/run/ypbind.*	--	gen_context(system_u:object_r:ypbind_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/nis.if refpolicy/policy/modules/contrib/nis.if
--- refpolicy/policy/modules/contrib/nis.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/nis.if	2012-10-24 17:01:31.547003117 +0200
@@ -1,4 +1,4 @@
-## <summary>Policy for NIS (YP) servers and clients</summary>
+## <summary>Policy for NIS (YP) servers and clients.</summary>
 
 ########################################
 ## <summary>
@@ -34,8 +34,8 @@
 	allow $1 self:udp_socket create_socket_perms;
 
 	allow $1 var_yp_t:dir list_dir_perms;
-	allow $1 var_yp_t:lnk_file { getattr read };
 	allow $1 var_yp_t:file read_file_perms;
+	allow $1 var_yp_t:lnk_file read_lnk_file_perms;
 
 	corenet_all_recvfrom_unlabeled($1)
 	corenet_all_recvfrom_netlabel($1)
@@ -95,7 +95,7 @@
 
 ########################################
 ## <summary>
-##	Use the nis to authenticate passwords
+##	Use nis to authenticate passwords.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -131,6 +131,25 @@
 	domtrans_pattern($1, ypbind_exec_t, ypbind_t)
 ')
 
+#######################################
+## <summary>
+##	Execute ypbind in the caller domain.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`nis_exec_ypbind',`
+	gen_require(`
+		type ypbind_exec_t;
+	')
+
+	corecmd_search_bin($1)
+	can_exec($1, ypbind_exec_t)
+')
+
 ########################################
 ## <summary>
 ##	Execute ypbind in the ypbind domain, and
@@ -150,11 +169,11 @@
 #
 interface(`nis_run_ypbind',`
 	gen_require(`
-		type ypbind_t;
+		attribute_role ypbind_roles;
 	')
 
 	nis_domtrans_ypbind($1)
-	role $2 types ypbind_t;
+	roleattribute $2 ypbind_roles;
 ')
 
 ########################################
@@ -177,7 +196,7 @@
 
 ########################################
 ## <summary>
-##	List the contents of the NIS data directory.
+##	List nis data directories.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -253,11 +272,10 @@
 #
 interface(`nis_delete_ypbind_pid',`
 	gen_require(`
-		type ypbind_t;
+		type ypbind_var_run_t;
 	')
 
-	# TODO: add delete pid from dir call to files
-	allow $1 ypbind_t:file unlink;
+	allow $1 ypbind_var_run_t:file delete_file_perms;
 ')
 
 ########################################
@@ -337,8 +355,8 @@
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate
-##	an nis environment
+##	All of the rules required to
+##	administrate an nis environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -357,40 +375,29 @@
 		type ypbind_t, yppasswdd_t, ypserv_t, ypxfr_t;
 		type ypbind_tmp_t, ypserv_tmp_t, ypserv_conf_t;
 		type ypbind_var_run_t, yppasswdd_var_run_t, ypserv_var_run_t;
-		type ypbind_initrc_exec_t, nis_initrc_exec_t;
+		type ypbind_initrc_exec_t, nis_initrc_exec_t, var_yp_t;
 	')
 
-	allow $1 ypbind_t:process { ptrace signal_perms };
-	ps_process_pattern($1, ypbind_t)
-
-	allow $1 yppasswdd_t:process { ptrace signal_perms };
-	ps_process_pattern($1, yppasswdd_t)
-
-	allow $1 ypserv_t:process { ptrace signal_perms };
-	ps_process_pattern($1, ypserv_t)
-
-	allow $1 ypxfr_t:process { ptrace signal_perms };
-	ps_process_pattern($1, ypxfr_t)
+	allow $1 { ypbind_t yppasswdd_t ypserv_t ypxfr_t }:process { ptrace signal_perms };
+	ps_process_pattern($1, { ypbind_t yppasswdd_t ypserv_t ypxfr_t })
 
 	nis_initrc_domtrans($1)
 	nis_initrc_domtrans_ypbind($1)
 	domain_system_change_exemption($1)
-	role_transition $2 nis_initrc_exec_t system_r;
-	role_transition $2 ypbind_initrc_exec_t system_r;
+	role_transition $2 { nis_initrc_exec_t ypbind_initrc_exec_t } system_r;
 	allow $2 system_r;
 
 	files_list_tmp($1)
-	admin_pattern($1, ypbind_tmp_t)
+	admin_pattern($1, { ypserv_tmp_t ypbind_tmp_t })
 
 	files_list_pids($1)
-	admin_pattern($1, ypbind_var_run_t)
-
-	admin_pattern($1, yppasswdd_var_run_t)
+	admin_pattern($1, { ypserv_var_run_t ypbind_var_run_t yppasswdd_var_run_t })
 
 	files_list_etc($1)
 	admin_pattern($1, ypserv_conf_t)
 
-	admin_pattern($1, ypserv_tmp_t)
+	files_search_var($1)
+	admin_pattern($1, var_yp_t)
 
-	admin_pattern($1, ypserv_var_run_t)
+	nis_run_ypbind($1, $2)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/nis.te refpolicy/policy/modules/contrib/nis.te
--- refpolicy/policy/modules/contrib/nis.te	2012-07-25 20:33:05.000000000 +0200
+++ refpolicy/policy/modules/contrib/nis.te	2012-10-16 19:35:56.200013993 +0200
@@ -1,10 +1,12 @@
-policy_module(nis, 1.11.0)
+policy_module(nis, 1.11.1)
 
 ########################################
 #
 # Declarations
 #
 
+attribute_role ypbind_roles;
+
 type nis_initrc_exec_t;
 init_script_file(nis_initrc_exec_t)
 
@@ -14,6 +16,7 @@
 type ypbind_t;
 type ypbind_exec_t;
 init_daemon_domain(ypbind_t, ypbind_exec_t)
+role ypbind_roles types ypbind_t;
 
 type ypbind_initrc_exec_t;
 init_script_file(ypbind_initrc_exec_t)
@@ -59,7 +62,6 @@
 dontaudit ypbind_t self:capability { net_admin sys_tty_config };
 allow ypbind_t self:fifo_file rw_fifo_file_perms;
 allow ypbind_t self:process signal_perms;
-allow ypbind_t self:{ unix_dgram_socket unix_stream_socket } create_socket_perms;
 allow ypbind_t self:netlink_route_socket r_netlink_socket_perms;
 allow ypbind_t self:tcp_socket create_stream_socket_perms;
 allow ypbind_t self:udp_socket create_socket_perms;
@@ -86,6 +88,7 @@
 corenet_udp_sendrecv_all_ports(ypbind_t)
 corenet_tcp_bind_generic_node(ypbind_t)
 corenet_udp_bind_generic_node(ypbind_t)
+
 corenet_tcp_bind_generic_port(ypbind_t)
 corenet_udp_bind_generic_port(ypbind_t)
 corenet_tcp_bind_reserved_port(ypbind_t)
@@ -93,11 +96,12 @@
 corenet_tcp_bind_all_rpc_ports(ypbind_t)
 corenet_udp_bind_all_rpc_ports(ypbind_t)
 corenet_tcp_connect_all_ports(ypbind_t)
-corenet_dontaudit_tcp_bind_all_reserved_ports(ypbind_t)
-corenet_dontaudit_udp_bind_all_reserved_ports(ypbind_t)
 corenet_sendrecv_all_client_packets(ypbind_t)
 corenet_sendrecv_generic_server_packets(ypbind_t)
 
+corenet_dontaudit_tcp_bind_all_reserved_ports(ypbind_t)
+corenet_dontaudit_udp_bind_all_reserved_ports(ypbind_t)
+
 dev_read_sysfs(ypbind_t)
 
 fs_getattr_all_fs(ypbind_t)
@@ -120,6 +124,7 @@
 optional_policy(`
 	dbus_system_bus_client(ypbind_t)
 	dbus_connect_system_bus(ypbind_t)
+
 	init_dbus_chat_script(ypbind_t)
 
 	optional_policy(`
@@ -144,8 +149,7 @@
 dontaudit yppasswdd_t self:capability sys_tty_config;
 allow yppasswdd_t self:fifo_file rw_fifo_file_perms;
 allow yppasswdd_t self:process { getsched setfscreate signal_perms };
-allow yppasswdd_t self:unix_dgram_socket create_socket_perms;
-allow yppasswdd_t self:unix_stream_socket create_stream_socket_perms;
+allow yppasswdd_t self:unix_stream_socket { accept listen };
 allow yppasswdd_t self:netlink_route_socket r_netlink_socket_perms;
 allow yppasswdd_t self:tcp_socket create_stream_socket_perms;
 allow yppasswdd_t self:udp_socket create_socket_perms;
@@ -156,6 +160,8 @@
 manage_files_pattern(yppasswdd_t, var_yp_t, var_yp_t)
 manage_lnk_files_pattern(yppasswdd_t, var_yp_t, var_yp_t)
 
+can_exec(yppasswdd_t, yppasswdd_exec_t)
+
 kernel_list_proc(yppasswdd_t)
 kernel_read_proc_symlinks(yppasswdd_t)
 kernel_getattr_proc_files(yppasswdd_t)
@@ -171,11 +177,22 @@
 corenet_udp_sendrecv_all_ports(yppasswdd_t)
 corenet_tcp_bind_generic_node(yppasswdd_t)
 corenet_udp_bind_generic_node(yppasswdd_t)
+
 corenet_tcp_bind_all_rpc_ports(yppasswdd_t)
 corenet_udp_bind_all_rpc_ports(yppasswdd_t)
+corenet_sendrecv_generic_server_packets(yppasswdd_t)
+
 corenet_dontaudit_tcp_bind_all_reserved_ports(yppasswdd_t)
 corenet_dontaudit_udp_bind_all_reserved_ports(yppasswdd_t)
-corenet_sendrecv_generic_server_packets(yppasswdd_t)
+
+corecmd_exec_bin(yppasswdd_t)
+corecmd_exec_shell(yppasswdd_t)
+
+domain_use_interactive_fds(yppasswdd_t)
+
+files_read_etc_files(yppasswdd_t)
+files_read_etc_runtime_files(yppasswdd_t)
+files_relabel_etc_files(yppasswdd_t)
 
 dev_read_sysfs(yppasswdd_t)
 
@@ -188,15 +205,6 @@
 auth_relabel_shadow(yppasswdd_t)
 auth_etc_filetrans_shadow(yppasswdd_t)
 
-corecmd_exec_bin(yppasswdd_t)
-corecmd_exec_shell(yppasswdd_t)
-
-domain_use_interactive_fds(yppasswdd_t)
-
-files_read_etc_files(yppasswdd_t)
-files_read_etc_runtime_files(yppasswdd_t)
-files_relabel_etc_files(yppasswdd_t)
-
 logging_send_syslog_msg(yppasswdd_t)
 
 miscfiles_read_localization(yppasswdd_t)
@@ -226,8 +234,7 @@
 dontaudit ypserv_t self:capability sys_tty_config;
 allow ypserv_t self:fifo_file rw_fifo_file_perms;
 allow ypserv_t self:process signal_perms;
-allow ypserv_t self:unix_dgram_socket create_socket_perms;
-allow ypserv_t self:unix_stream_socket create_stream_socket_perms;
+allow ypserv_t self:unix_stream_socket { accept listen };
 allow ypserv_t self:netlink_route_socket r_netlink_socket_perms;
 allow ypserv_t self:tcp_socket connected_stream_socket_perms;
 allow ypserv_t self:udp_socket create_socket_perms;
@@ -257,25 +264,27 @@
 corenet_udp_sendrecv_all_ports(ypserv_t)
 corenet_tcp_bind_generic_node(ypserv_t)
 corenet_udp_bind_generic_node(ypserv_t)
+
 corenet_tcp_bind_reserved_port(ypserv_t)
 corenet_udp_bind_reserved_port(ypserv_t)
 corenet_tcp_bind_all_rpc_ports(ypserv_t)
 corenet_udp_bind_all_rpc_ports(ypserv_t)
+corenet_sendrecv_generic_server_packets(ypserv_t)
+
 corenet_dontaudit_tcp_bind_all_reserved_ports(ypserv_t)
 corenet_dontaudit_udp_bind_all_reserved_ports(ypserv_t)
-corenet_sendrecv_generic_server_packets(ypserv_t)
 
-dev_read_sysfs(ypserv_t)
+corecmd_exec_bin(ypserv_t)
 
-fs_getattr_all_fs(ypserv_t)
-fs_search_auto_mountpoints(ypserv_t)
+files_read_etc_files(ypserv_t)
+files_read_var_files(ypserv_t)
 
-corecmd_exec_bin(ypserv_t)
+dev_read_sysfs(ypserv_t)
 
 domain_use_interactive_fds(ypserv_t)
 
-files_read_var_files(ypserv_t)
-files_read_etc_files(ypserv_t)
+fs_getattr_all_fs(ypserv_t)
+fs_search_auto_mountpoints(ypserv_t)
 
 logging_send_syslog_msg(ypserv_t)
 
@@ -301,8 +310,8 @@
 # ypxfr local policy
 #
 
-allow ypxfr_t self:unix_stream_socket create_stream_socket_perms;
-allow ypxfr_t self:unix_dgram_socket create_stream_socket_perms;
+allow ypxfr_t self:unix_stream_socket { accept listen };
+allow ypxfr_t self:unix_dgram_socket { accept listen };
 allow ypxfr_t self:tcp_socket create_stream_socket_perms;
 allow ypxfr_t self:udp_socket create_socket_perms;
 allow ypxfr_t self:netlink_route_socket r_netlink_socket_perms;
@@ -327,16 +336,18 @@
 corenet_udp_sendrecv_all_ports(ypxfr_t)
 corenet_tcp_bind_generic_node(ypxfr_t)
 corenet_udp_bind_generic_node(ypxfr_t)
+
 corenet_tcp_bind_reserved_port(ypxfr_t)
 corenet_udp_bind_reserved_port(ypxfr_t)
 corenet_tcp_bind_all_rpc_ports(ypxfr_t)
 corenet_udp_bind_all_rpc_ports(ypxfr_t)
-corenet_dontaudit_tcp_bind_all_reserved_ports(ypxfr_t)
-corenet_dontaudit_udp_bind_all_reserved_ports(ypxfr_t)
 corenet_tcp_connect_all_ports(ypxfr_t)
 corenet_sendrecv_generic_server_packets(ypxfr_t)
 corenet_sendrecv_all_client_packets(ypxfr_t)
 
+corenet_dontaudit_tcp_bind_all_reserved_ports(ypxfr_t)
+corenet_dontaudit_udp_bind_all_reserved_ports(ypxfr_t)
+
 files_read_etc_files(ypxfr_t)
 files_search_usr(ypxfr_t)
 
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/nscd.fc refpolicy/policy/modules/contrib/nscd.fc
--- refpolicy/policy/modules/contrib/nscd.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/nscd.fc	2012-10-16 19:36:00.194014011 +0200
@@ -1,13 +1,13 @@
 /etc/rc\.d/init\.d/nscd	--	gen_context(system_u:object_r:nscd_initrc_exec_t,s0)
 
-/usr/sbin/nscd		--	gen_context(system_u:object_r:nscd_exec_t,s0)
+/usr/sbin/nscd	--	gen_context(system_u:object_r:nscd_exec_t,s0)
 
-/var/db/nscd(/.*)?		gen_context(system_u:object_r:nscd_var_run_t,s0)
-/var/cache/nscd(/.*)?		gen_context(system_u:object_r:nscd_var_run_t,s0)
+/var/cache/nscd(/.*)?	gen_context(system_u:object_r:nscd_var_run_t,s0)
+
+/var/db/nscd(/.*)?	gen_context(system_u:object_r:nscd_var_run_t,s0)
 
 /var/log/nscd\.log.*	--	gen_context(system_u:object_r:nscd_log_t,s0)
 
+/var/run/nscd(/.*)?	gen_context(system_u:object_r:nscd_var_run_t,s0)
 /var/run/nscd\.pid	--	gen_context(system_u:object_r:nscd_var_run_t,s0)
 /var/run/\.nscd_socket	-s	gen_context(system_u:object_r:nscd_var_run_t,s0)
-
-/var/run/nscd(/.*)?		gen_context(system_u:object_r:nscd_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/nscd.if refpolicy/policy/modules/contrib/nscd.if
--- refpolicy/policy/modules/contrib/nscd.if	2012-05-04 15:16:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/nscd.if	2012-10-16 19:36:00.195014011 +0200
@@ -1,8 +1,8 @@
-## <summary>Name service cache daemon</summary>
+## <summary>Name service cache daemon.</summary>
 
 ########################################
 ## <summary>
-##	Send generic signals to NSCD.
+##	Send generic signals to nscd.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -20,7 +20,7 @@
 
 ########################################
 ## <summary>
-##	Send NSCD the kill signal.
+##	Send kill signals to nscd.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -38,7 +38,7 @@
 
 ########################################
 ## <summary>
-##	Send signulls to NSCD.
+##	Send null signals to nscd.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -56,7 +56,7 @@
 
 ########################################
 ## <summary>
-##	Execute NSCD in the nscd domain.
+##	Execute nscd in the nscd domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -75,8 +75,7 @@
 
 ########################################
 ## <summary>
-##	Allow the specified domain to execute nscd
-##	in the caller domain.
+##	Execute nscd in the caller domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -89,13 +88,14 @@
 		type nscd_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	can_exec($1, nscd_exec_t)
 ')
 
 ########################################
 ## <summary>
-##	Use NSCD services by connecting using
-##	a unix stream socket.
+##	Use nscd services by connecting using
+##	a unix domain stream socket.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -112,17 +112,20 @@
 	allow $1 self:unix_stream_socket create_socket_perms;
 
 	allow $1 nscd_t:nscd { getpwd getgrp gethost };
+
 	dontaudit $1 nscd_t:fd use;
 	dontaudit $1 nscd_t:nscd { getserv shmempwd shmemgrp shmemhost shmemserv };
+
 	files_search_pids($1)
 	stream_connect_pattern($1, nscd_var_run_t, nscd_var_run_t, nscd_t)
-	dontaudit $1 nscd_var_run_t:file { getattr read };
+	dontaudit $1 nscd_var_run_t:file read_file_perms;
 ')
 
 ########################################
 ## <summary>
-##	Use NSCD services by mapping the database from
-##	an inherited NSCD file descriptor.
+##	Use nscd services by mapping the
+##	database from an inherited nscd
+##	file descriptor.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -136,26 +139,26 @@
 		class nscd { getpwd getgrp gethost shmempwd shmemgrp shmemhost };
 	')
 
-	allow $1 nscd_var_run_t:dir list_dir_perms;
-	allow $1 nscd_t:nscd { shmempwd shmemgrp shmemhost };
+	allow $1 self:unix_stream_socket create_stream_socket_perms;
+
+	allow $1 nscd_t:nscd { getpwd getgrp gethost shmempwd shmemgrp shmemhost };
 
-	# Receive fd from nscd and map the backing file with read access.
 	allow $1 nscd_t:fd use;
 
-	# cjp: these were originally inherited from the
-	# nscd_socket_domain macro. need to investigate
-	# if they are all actually required
-	allow $1 self:unix_stream_socket create_stream_socket_perms;
-	allow $1 nscd_t:unix_stream_socket connectto;
-	allow $1 nscd_var_run_t:sock_file rw_file_perms;
 	files_search_pids($1)
-	allow $1 nscd_t:nscd { getpwd getgrp gethost };
-	dontaudit $1 nscd_var_run_t:file { getattr read };
+	stream_connect_pattern($1, nscd_var_run_t, nscd_var_run_t, nscd_t)
+	dontaudit $1 nscd_var_run_t:file read_file_perms;
+
+	allow $1 nscd_var_run_t:sock_file read_sock_file_perms;
+	allow $1 nscd_var_run_t:dir list_dir_perms;
+
+	dontaudit $1 nscd_var_run_t:file read_file_perms;
 ')
 
 ########################################
 ## <summary>
-##	Do not audit attempts to search the NSCD pid directory.
+##	Do not audit attempts to search
+##	nscd pid directories.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -168,12 +171,12 @@
 		type nscd_var_run_t;
 	')
 
-	dontaudit $1 nscd_var_run_t:dir search;
+	dontaudit $1 nscd_var_run_t:dir search_dir_perms;
 ')
 
 ########################################
 ## <summary>
-##	Read NSCD pid file.
+##	Read nscd pid files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -192,7 +195,7 @@
 
 ########################################
 ## <summary>
-##	Unconfined access to NSCD services.
+##	Unconfined access to nscd services.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -227,16 +230,17 @@
 #
 interface(`nscd_run',`
 	gen_require(`
-		type nscd_t;
+		attribute_role nscd_roles;
 	')
 
 	nscd_domtrans($1)
-	role $2 types nscd_t;
+	roleattribute $2 nscd_roles;
 ')
 
 ########################################
 ## <summary>
-##	Execute the nscd server init script.
+##	Execute the nscd server init
+##	script in the initrc domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -254,8 +258,8 @@
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate 
-##	an nscd environment
+##	All of the rules required to
+##	administrate an nscd environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -264,7 +268,7 @@
 ## </param>
 ## <param name="role">
 ##	<summary>
-##	The role to be allowed to manage the nscd domain.
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <rolecap/>
@@ -288,4 +292,6 @@
 
 	files_list_pids($1)
 	admin_pattern($1, nscd_var_run_t)
+
+	nscd_run($1, $2)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/nscd.te refpolicy/policy/modules/contrib/nscd.te
--- refpolicy/policy/modules/contrib/nscd.te	2012-05-04 15:16:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/nscd.te	2012-10-16 19:36:00.214014011 +0200
@@ -1,4 +1,4 @@
-policy_module(nscd, 1.10.0)
+policy_module(nscd, 1.10.2)
 
 gen_require(`
 	class nscd all_nscd_perms;
@@ -9,15 +9,16 @@
 # Declarations
 #
 
-# cjp: this is out of order because of an
-# ordering problem with loadable modules
+attribute_role nscd_roles;
+
 type nscd_var_run_t;
 files_pid_file(nscd_var_run_t)
+init_daemon_run_dir(nscd_var_run_t, "nscd")
 
-# nscd is both the client program and the daemon.
 type nscd_t;
 type nscd_exec_t;
 init_daemon_domain(nscd_t, nscd_exec_t)
+role nscd_roles types nscd_t;
 
 type nscd_initrc_exec_t;
 init_script_file(nscd_initrc_exec_t)
@@ -34,53 +35,53 @@
 dontaudit nscd_t self:capability sys_tty_config;
 allow nscd_t self:process { getattr getcap setcap setsched signal_perms };
 allow nscd_t self:fifo_file read_fifo_file_perms;
-allow nscd_t self:unix_stream_socket create_stream_socket_perms;
-allow nscd_t self:unix_dgram_socket create_socket_perms;
+allow nscd_t self:unix_stream_socket { accept listen };
 allow nscd_t self:netlink_selinux_socket create_socket_perms;
-allow nscd_t self:tcp_socket create_socket_perms;
-allow nscd_t self:udp_socket create_socket_perms;
 
-# For client program operation, invoked from sysadm_t.
-# Transition occurs to nscd_t due to direct_sysadm_daemon. 
 allow nscd_t self:nscd { admin getstat };
 
-allow nscd_t nscd_log_t:file manage_file_perms;
+allow nscd_t nscd_log_t:file { append_file_perms create_file_perms setattr_file_perms };
 logging_log_filetrans(nscd_t, nscd_log_t, file)
 
 manage_files_pattern(nscd_t, nscd_var_run_t, nscd_var_run_t)
 manage_sock_files_pattern(nscd_t, nscd_var_run_t, nscd_var_run_t)
 files_pid_filetrans(nscd_t, nscd_var_run_t, { file sock_file })
 
-corecmd_search_bin(nscd_t)
 can_exec(nscd_t, nscd_exec_t)
 
-kernel_read_kernel_sysctls(nscd_t)
 kernel_list_proc(nscd_t)
+kernel_read_kernel_sysctls(nscd_t)
+kernel_read_network_state(nscd_t)
 kernel_read_proc_symlinks(nscd_t)
 
+corecmd_search_bin(nscd_t)
+
 dev_read_sysfs(nscd_t)
 dev_read_rand(nscd_t)
 dev_read_urand(nscd_t)
 
+domain_search_all_domains_state(nscd_t)
+domain_use_interactive_fds(nscd_t)
+
+files_read_generic_tmp_symlinks(nscd_t)
+files_read_etc_runtime_files(nscd_t)
+
 fs_getattr_all_fs(nscd_t)
 fs_search_auto_mountpoints(nscd_t)
 fs_list_inotifyfs(nscd_t)
 
-# for when /etc/passwd has just been updated and has the wrong type
 auth_getattr_shadow(nscd_t)
 auth_use_nsswitch(nscd_t)
 
 corenet_all_recvfrom_unlabeled(nscd_t)
 corenet_all_recvfrom_netlabel(nscd_t)
 corenet_tcp_sendrecv_generic_if(nscd_t)
-corenet_udp_sendrecv_generic_if(nscd_t)
 corenet_tcp_sendrecv_generic_node(nscd_t)
-corenet_udp_sendrecv_generic_node(nscd_t)
-corenet_tcp_sendrecv_all_ports(nscd_t)
-corenet_udp_sendrecv_all_ports(nscd_t)
-corenet_udp_bind_generic_node(nscd_t)
-corenet_tcp_connect_all_ports(nscd_t)
+
 corenet_sendrecv_all_client_packets(nscd_t)
+corenet_tcp_connect_all_ports(nscd_t)
+corenet_tcp_sendrecv_all_ports(nscd_t)
+
 corenet_rw_tun_tap_dev(nscd_t)
 
 selinux_get_fs_mount(nscd_t)
@@ -89,12 +90,6 @@
 selinux_compute_create_context(nscd_t)
 selinux_compute_relabel_context(nscd_t)
 selinux_compute_user_contexts(nscd_t)
-domain_use_interactive_fds(nscd_t)
-
-files_read_etc_files(nscd_t)
-files_read_generic_tmp_symlinks(nscd_t)
-# Needed to read files created by firstboot "/etc/hesiod.conf"
-files_read_etc_runtime_files(nscd_t)
 
 logging_send_audit_msgs(nscd_t)
 logging_send_syslog_msg(nscd_t)
@@ -105,18 +100,26 @@
 seutil_read_default_contexts(nscd_t)
 seutil_sigchld_newrole(nscd_t)
 
-sysnet_read_config(nscd_t)
-
 userdom_dontaudit_use_user_terminals(nscd_t)
 userdom_dontaudit_use_unpriv_user_fds(nscd_t)
 userdom_dontaudit_search_user_home_dirs(nscd_t)
 
 optional_policy(`
+	accountsd_dontaudit_rw_fifo_file(nscd_t)
+')
+
+optional_policy(`
 	cron_read_system_job_tmp_files(nscd_t)
 ')
 
 optional_policy(`
-	kerberos_use(nscd_t)
+	tunable_policy(`samba_domain_controller',`
+		samba_append_log(nscd_t)
+		samba_dontaudit_use_fds(nscd_t)
+	')
+
+	samba_read_config(nscd_t)
+	samba_read_var_files(nscd_t)
 ')
 
 optional_policy(`
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/nsd.fc refpolicy/policy/modules/contrib/nsd.fc
--- refpolicy/policy/modules/contrib/nsd.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/nsd.fc	2012-10-16 19:36:07.531014026 +0200
@@ -1,14 +1,16 @@
+/etc/rc\.d/init\.d/nsd	--	gen_context(system_u:object_r:nsd_initrc_exec_t,s0)
 
-/etc/nsd(/.*)?			gen_context(system_u:object_r:nsd_conf_t,s0)
+/etc/nsd(/.*)?	gen_context(system_u:object_r:nsd_conf_t,s0)
 /etc/nsd/nsd\.db	--	gen_context(system_u:object_r:nsd_db_t,s0)
-/etc/nsd/primary(/.*)?		gen_context(system_u:object_r:nsd_zone_t,s0)
+/etc/nsd/primary(/.*)?	gen_context(system_u:object_r:nsd_zone_t,s0)
 /etc/nsd/secondary(/.*)?	gen_context(system_u:object_r:nsd_zone_t,s0)
 
-/usr/sbin/nsd		--	gen_context(system_u:object_r:nsd_exec_t,s0)
-/usr/sbin/nsdc		--	gen_context(system_u:object_r:nsd_exec_t,s0)
+/usr/sbin/nsd	--	gen_context(system_u:object_r:nsd_exec_t,s0)
+/usr/sbin/nsdc	--	gen_context(system_u:object_r:nsd_exec_t,s0)
 /usr/sbin/nsd-notify	--	gen_context(system_u:object_r:nsd_exec_t,s0)
-/usr/sbin/zonec		--	gen_context(system_u:object_r:nsd_exec_t,s0)
+/usr/sbin/zonec	--	gen_context(system_u:object_r:nsd_exec_t,s0)
 
-/var/lib/nsd(/.*)?		gen_context(system_u:object_r:nsd_zone_t,s0)
+/var/lib/nsd(/.*)?	gen_context(system_u:object_r:nsd_zone_t,s0)
 /var/lib/nsd/nsd\.db	--	gen_context(system_u:object_r:nsd_db_t,s0)
+
 /var/run/nsd\.pid	--	gen_context(system_u:object_r:nsd_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/nsd.if refpolicy/policy/modules/contrib/nsd.if
--- refpolicy/policy/modules/contrib/nsd.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/nsd.if	2012-10-16 19:36:07.531014026 +0200
@@ -1,4 +1,4 @@
-## <summary>Authoritative only name server</summary>
+## <summary>Authoritative only name server.</summary>
 
 ########################################
 ## <summary>
@@ -27,3 +27,44 @@
 interface(`nsd_tcp_connect',`
 	refpolicywarn(`$0($*) has been deprecated.')
 ')
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an nsd environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`nsd_admin',`
+	gen_require(`
+		type nsd_t, nsd_conf_t, nsd_var_run_t;
+		type nsd_initrc_exec_t, nsd_db_t, nsd_zone_t;
+	')
+
+	allow $1 nsd_t:process { ptrace signal_perms };
+	ps_process_pattern($1, nsd_t)
+
+	init_labeled_script_domtrans($1, nsd_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 nsd_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	files_search_etc($1)
+	admin_pattern($1, { nsd_conf_t nsd_db_t })
+
+	files_search_var_lib($1)
+	admin_pattern($1, nsd_zone_t)
+
+	files_list_pids($1)
+	admin_pattern($1, nsd_var_run_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/nsd.te refpolicy/policy/modules/contrib/nsd.te
--- refpolicy/policy/modules/contrib/nsd.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/nsd.te	2012-10-16 19:36:07.532014026 +0200
@@ -1,4 +1,4 @@
-policy_module(nsd, 1.7.0)
+policy_module(nsd, 1.7.1)
 
 ########################################
 #
@@ -9,7 +9,9 @@
 type nsd_exec_t;
 init_daemon_domain(nsd_t, nsd_exec_t)
 
-# A type for configuration files of nsd
+type nsd_initrc_exec_t;
+init_script_file(nsd_initrc_exec_t)
+
 type nsd_conf_t;
 files_type(nsd_conf_t)
 
@@ -18,31 +20,29 @@
 domain_entry_file(nsd_crond_t, nsd_exec_t)
 role system_r types nsd_crond_t;
 
-# a type for nsd.db
 type nsd_db_t;
 files_type(nsd_db_t)
 
 type nsd_var_run_t;
 files_pid_file(nsd_var_run_t)
 
-# A type for zone files
 type nsd_zone_t;
 files_type(nsd_zone_t)
 
 ########################################
 #
-# NSD Local policy
+# Local policy
 #
 
-allow nsd_t self:capability { dac_override chown setuid setgid };
+allow nsd_t self:capability { chown dac_override kill setgid setuid };
 dontaudit nsd_t self:capability sys_tty_config;
 allow nsd_t self:process signal_perms;
-allow nsd_t self:tcp_socket create_stream_socket_perms;
-allow nsd_t self:udp_socket create_socket_perms;
+allow nsd_t self:fifo_file rw_fifo_file_perms;
+allow nsd_t self:tcp_socket { accept listen };
 
 allow nsd_t nsd_conf_t:dir list_dir_perms;
-read_files_pattern(nsd_t, nsd_conf_t, nsd_conf_t)
-read_lnk_files_pattern(nsd_t, nsd_conf_t, nsd_conf_t)
+allow nsd_t nsd_conf_t:file read_file_perms;
+allow nsd_t nsd_conf_t:lnk_file read_lnk_file_perms;
 
 allow nsd_t nsd_db_t:file manage_file_perms;
 filetrans_pattern(nsd_t, nsd_zone_t, nsd_db_t, file)
@@ -50,9 +50,10 @@
 manage_files_pattern(nsd_t, nsd_var_run_t, nsd_var_run_t)
 files_pid_filetrans(nsd_t, nsd_var_run_t, file)
 
-allow nsd_t nsd_zone_t:dir list_dir_perms;
-read_files_pattern(nsd_t, nsd_zone_t, nsd_zone_t)
-read_lnk_files_pattern(nsd_t, nsd_zone_t, nsd_zone_t)
+manage_dirs_pattern(nsd_t, nsd_zone_t, nsd_zone_t)
+manage_files_pattern(nsd_t, nsd_zone_t, nsd_zone_t)
+manage_lnk_files_pattern(nsd_t, nsd_zone_t, nsd_zone_t)
+files_var_lib_filetrans(nsd_t, nsd_zone_t, dir)
 
 can_exec(nsd_t, nsd_exec_t)
 
@@ -71,34 +72,30 @@
 corenet_udp_sendrecv_all_ports(nsd_t)
 corenet_tcp_bind_generic_node(nsd_t)
 corenet_udp_bind_generic_node(nsd_t)
+
+corenet_sendrecv_dns_server_packets(nsd_t)
 corenet_tcp_bind_dns_port(nsd_t)
 corenet_udp_bind_dns_port(nsd_t)
-corenet_sendrecv_dns_server_packets(nsd_t)
 
 dev_read_sysfs(nsd_t)
 
 domain_use_interactive_fds(nsd_t)
 
-files_read_etc_files(nsd_t)
 files_read_etc_runtime_files(nsd_t)
 
 fs_getattr_all_fs(nsd_t)
 fs_search_auto_mountpoints(nsd_t)
 
+auth_use_nsswitch(nsd_t)
+
 logging_send_syslog_msg(nsd_t)
 
 miscfiles_read_localization(nsd_t)
 
-sysnet_read_config(nsd_t)
-
 userdom_dontaudit_use_unpriv_user_fds(nsd_t)
 userdom_dontaudit_search_user_home_dirs(nsd_t)
 
 optional_policy(`
-	nis_use_ypbind(nsd_t)
-')
-
-optional_policy(`
 	seutil_sigchld_newrole(nsd_t)
 ')
 
@@ -108,26 +105,23 @@
 
 ########################################
 #
-# Zone update cron job local policy
+# Cron local policy
 #
 
-# kill capability for root cron job and non-root daemon
 allow nsd_crond_t self:capability { dac_override kill };
 dontaudit nsd_crond_t self:capability sys_nice;
 allow nsd_crond_t self:process { setsched signal_perms };
 allow nsd_crond_t self:fifo_file rw_fifo_file_perms;
-allow nsd_crond_t self:tcp_socket create_socket_perms;
-allow nsd_crond_t self:udp_socket create_socket_perms;
 
+allow nsd_crond_t nsd_t:process signal;
+ps_process_pattern(nsd_crond_t, nsd_t)
+
+allow nsd_crond_t nsd_conf_t:dir list_dir_perms;
 allow nsd_crond_t nsd_conf_t:file read_file_perms;
+allow nsd_crond_t nsd_conf_t:lnk_file read_lnk_file_perms;
 
 allow nsd_crond_t nsd_db_t:file manage_file_perms;
 filetrans_pattern(nsd_crond_t, nsd_zone_t, nsd_db_t, file)
-files_search_var_lib(nsd_crond_t)
-
-allow nsd_crond_t nsd_t:process signal;
-
-ps_process_pattern(nsd_crond_t, nsd_t)
 
 manage_files_pattern(nsd_crond_t, nsd_zone_t, nsd_zone_t)
 filetrans_pattern(nsd_crond_t, nsd_conf_t, nsd_zone_t, file)
@@ -142,39 +136,26 @@
 corenet_all_recvfrom_unlabeled(nsd_crond_t)
 corenet_all_recvfrom_netlabel(nsd_crond_t)
 corenet_tcp_sendrecv_generic_if(nsd_crond_t)
-corenet_udp_sendrecv_generic_if(nsd_crond_t)
 corenet_tcp_sendrecv_generic_node(nsd_crond_t)
-corenet_udp_sendrecv_generic_node(nsd_crond_t)
-corenet_tcp_sendrecv_all_ports(nsd_crond_t)
-corenet_udp_sendrecv_all_ports(nsd_crond_t)
-corenet_tcp_connect_all_ports(nsd_crond_t)
+
 corenet_sendrecv_all_client_packets(nsd_crond_t)
+corenet_tcp_connect_all_ports(nsd_crond_t)
+corenet_tcp_sendrecv_all_ports(nsd_crond_t)
 
-# for SSP
 dev_read_urand(nsd_crond_t)
 
 domain_dontaudit_read_all_domains_state(nsd_crond_t)
 
-files_read_etc_files(nsd_crond_t)
 files_read_etc_runtime_files(nsd_crond_t)
-files_search_var_lib(nsd_t)
+
+auth_use_nsswitch(nsd_crond_t)
 
 logging_send_syslog_msg(nsd_crond_t)
 
 miscfiles_read_localization(nsd_crond_t)
 
-sysnet_read_config(nsd_crond_t)
-
 userdom_dontaudit_search_user_home_dirs(nsd_crond_t)
 
 optional_policy(`
 	cron_system_entry(nsd_crond_t, nsd_exec_t)
 ')
-
-optional_policy(`
-	nis_use_ypbind(nsd_crond_t)
-')
-
-optional_policy(`
-	nscd_read_pid(nsd_crond_t)
-')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/nslcd.fc refpolicy/policy/modules/contrib/nslcd.fc
--- refpolicy/policy/modules/contrib/nslcd.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/nslcd.fc	2012-10-16 19:36:10.725014033 +0200
@@ -1,4 +1,7 @@
-/etc/nss-ldapd.conf	--	gen_context(system_u:object_r:nslcd_conf_t,s0)
-/etc/rc\.d/init\.d/nslcd --	gen_context(system_u:object_r:nslcd_initrc_exec_t,s0)
-/usr/sbin/nslcd		--	gen_context(system_u:object_r:nslcd_exec_t,s0)
-/var/run/nslcd(/.*)?		gen_context(system_u:object_r:nslcd_var_run_t,s0)
+/etc/nss-ldapd\.conf	--	gen_context(system_u:object_r:nslcd_conf_t,s0)
+
+/etc/rc\.d/init\.d/nslcd	--	gen_context(system_u:object_r:nslcd_initrc_exec_t,s0)
+
+/usr/sbin/nslcd	--	gen_context(system_u:object_r:nslcd_exec_t,s0)
+
+/var/run/nslcd(/.*)?	gen_context(system_u:object_r:nslcd_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/nslcd.if refpolicy/policy/modules/contrib/nslcd.if
--- refpolicy/policy/modules/contrib/nslcd.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/nslcd.if	2012-10-16 19:36:10.740014033 +0200
@@ -1,4 +1,4 @@
-## <summary>nslcd - local LDAP name service daemon.</summary>
+## <summary>Local LDAP name service daemon.</summary>
 
 ########################################
 ## <summary>
@@ -15,6 +15,7 @@
 		type nslcd_t, nslcd_exec_t;
 	')
 
+	corecmd_searh_bin($1)
 	domtrans_pattern($1, nslcd_exec_t, nslcd_t)
 ')
 
@@ -38,7 +39,7 @@
 
 ########################################
 ## <summary>
-##	Read nslcd PID files.
+##	Read nslcd pid files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -57,7 +58,8 @@
 
 ########################################
 ## <summary>
-##	Connect to nslcd over an unix stream socket.
+##	Connect to nslcd over an unix
+##	domain stream socket.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -70,14 +72,14 @@
 		type nslcd_t, nslcd_var_run_t;
 	')
 
-	stream_connect_pattern($1, nslcd_var_run_t, nslcd_var_run_t, nslcd_t)
 	files_search_pids($1)
+	stream_connect_pattern($1, nslcd_var_run_t, nslcd_var_run_t, nslcd_t)
 ')
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate
-##	an nslcd environment
+##	All of the rules required to
+##	administrate an nslcd environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -93,22 +95,21 @@
 #
 interface(`nslcd_admin',`
 	gen_require(`
-		type nslcd_t, nslcd_initrc_exec_t;
-		type nslcd_conf_t, nslcd_var_run_t;
+		type nslcd_t, nslcd_initrc_exec_t, nslcd_var_run_t;
+		type nslcd_conf_t;
 	')
 
-	ps_process_pattern($1, nslcd_t)
 	allow $1 nslcd_t:process { ptrace signal_perms };
+	ps_process_pattern($1, nslcd_t)
 
-	# Allow nslcd_t to restart the apache service
 	nslcd_initrc_domtrans($1)
 	domain_system_change_exemption($1)
 	role_transition $2 nslcd_initrc_exec_t system_r;
 	allow $2 system_r;
 
-	manage_files_pattern($1, nslcd_conf_t, nslcd_conf_t)
+	files_search_etc($1)
+	admin_pattern($1, nslcd_conf_t)
 
-	manage_dirs_pattern($1, nslcd_var_run_t, nslcd_var_run_t)
-	manage_files_pattern($1, nslcd_var_run_t, nslcd_var_run_t)
-	manage_lnk_files_pattern($1, nslcd_var_run_t, nslcd_var_run_t)
+	files_search_pids($1)
+	admin_pattern($1, nslcd_var_run_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/nslcd.te refpolicy/policy/modules/contrib/nslcd.te
--- refpolicy/policy/modules/contrib/nslcd.te	2012-07-25 20:33:05.000000000 +0200
+++ refpolicy/policy/modules/contrib/nslcd.te	2012-10-16 19:36:10.754014031 +0200
@@ -1,4 +1,4 @@
-policy_module(nslcd, 1.3.0)
+policy_module(nslcd, 1.3.1)
 
 ########################################
 #
@@ -16,16 +16,16 @@
 files_pid_file(nslcd_var_run_t)
 
 type nslcd_conf_t;
-files_type(nslcd_conf_t)
+files_config_file(nslcd_conf_t)
 
 ########################################
 #
-# nslcd local policy
+# Local policy
 #
 
 allow nslcd_t self:capability { setgid setuid dac_override };
 allow nslcd_t self:process signal;
-allow nslcd_t self:unix_stream_socket create_stream_socket_perms;
+allow nslcd_t self:unix_stream_socket { accept listen };
 
 allow nslcd_t nslcd_conf_t:file read_file_perms;
 
@@ -38,10 +38,15 @@
 
 corenet_all_recvfrom_unlabeled(nslcd_t)
 corenet_all_recvfrom_netlabel(nslcd_t)
-corenet_tcp_connect_ldap_port(nslcd_t)
+corenet_tcp_sendrecv_generic_if(nslcd_t)
+corenet_tcp_sendrecv_generic_node(nslcd_t)
+
 corenet_sendrecv_ldap_client_packets(nslcd_t)
+corenet_tcp_connect_ldap_port(nslcd_t)
+corenet_tcp_sendrecv_ldap_port(nslcd_t)
 
-files_read_etc_files(nslcd_t)
+files_read_usr_symlinks(nslcd_t)
+files_list_tmp(nslcd_t)
 
 auth_use_nsswitch(nslcd_t)
 
@@ -49,6 +54,8 @@
 
 miscfiles_read_localization(nslcd_t)
 
+userdom_read_user_tmp_files(nslcd_t)
+
 optional_policy(`
 	ldap_stream_connect(nslcd_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/ntop.fc refpolicy/policy/modules/contrib/ntop.fc
--- refpolicy/policy/modules/contrib/ntop.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/ntop.fc	2012-10-16 19:36:13.101014038 +0200
@@ -1,6 +1,9 @@
-/etc/ntop(/.*)?			gen_context(system_u:object_r:ntop_etc_t,s0)
+/etc/ntop.*	gen_context(system_u:object_r:ntop_etc_t,s0)
 
-/usr/bin/ntop		--	gen_context(system_u:object_r:ntop_exec_t,s0)
+/etc/rc\.d/init\.d/ntop	--	gen_context(system_u:object_r:ntop_initrc_exec_t,s0)
+
+/usr/sbin/ntop	--	gen_context(system_u:object_r:ntop_exec_t,s0)
+
+/var/lib/ntop(/.*)?	gen_context(system_u:object_r:ntop_var_lib_t,s0)
 
-/var/lib/ntop(/.*)?		gen_context(system_u:object_r:ntop_var_lib_t,s0)
 /var/run/ntop\.pid	--	gen_context(system_u:object_r:ntop_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/ntop.if refpolicy/policy/modules/contrib/ntop.if
--- refpolicy/policy/modules/contrib/ntop.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/ntop.if	2012-10-16 19:36:13.101014038 +0200
@@ -1 +1,42 @@
-## <summary>Network Top</summary>
+## <summary>A network traffic probe similar to the UNIX top command.</summary>
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an ntop environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`ntop_admin',`
+	gen_require(`
+		type ntop_t, ntop_etc_t, ntop_var_run_t;
+		type ntop_initrc_exec_t, ntop_var_lib_t;
+	')
+
+	allow $1 ntop_t:process { ptrace signal_perms };
+	ps_process_pattern($1, ntop_t)
+
+	init_labeled_script_domtrans($1, ntop_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 ntop_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	files_search_etc($1)
+	admin_pattern($1, ntop_etc_t)
+
+	files_search_var_lib($1)
+	admin_pattern($1, ntop_var_lib_t)
+
+	files_list_pids($1)
+	admin_pattern($1, ntop_var_run_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/ntop.te refpolicy/policy/modules/contrib/ntop.te
--- refpolicy/policy/modules/contrib/ntop.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/ntop.te	2012-10-16 19:36:13.102014038 +0200
@@ -1,4 +1,4 @@
-policy_module(ntop, 1.9.0)
+policy_module(ntop, 1.9.2)
 
 ########################################
 #
@@ -8,7 +8,6 @@
 type ntop_t;
 type ntop_exec_t;
 init_daemon_domain(ntop_t, ntop_exec_t)
-application_domain(ntop_t, ntop_exec_t)
 
 type ntop_initrc_exec_t;
 init_script_file(ntop_initrc_exec_t)
@@ -34,16 +33,14 @@
 dontaudit ntop_t self:capability sys_tty_config;
 allow ntop_t self:process signal_perms;
 allow ntop_t self:fifo_file rw_fifo_file_perms;
-allow ntop_t self:tcp_socket create_stream_socket_perms;
-allow ntop_t self:udp_socket create_socket_perms;
-allow ntop_t self:unix_dgram_socket create_socket_perms;
-allow ntop_t self:unix_stream_socket create_stream_socket_perms;
+allow ntop_t self:tcp_socket { accept listen };
+allow ntop_t self:unix_stream_socket { accept listen };
 allow ntop_t self:packet_socket create_socket_perms;
 allow ntop_t self:socket create_socket_perms;
 
 allow ntop_t ntop_etc_t:dir list_dir_perms;
-read_files_pattern(ntop_t, ntop_etc_t, ntop_etc_t)
-read_lnk_files_pattern(ntop_t, ntop_etc_t, ntop_etc_t)
+allow ntop_t ntop_etc_t:file read_file_perms;
+allow ntop_t ntop_etc_t:lnk_file read_lnk_file_perms;
 
 manage_dirs_pattern(ntop_t, ntop_tmp_t, ntop_tmp_t)
 manage_files_pattern(ntop_t, ntop_tmp_t, ntop_tmp_t)
@@ -60,32 +57,30 @@
 kernel_read_system_state(ntop_t)
 kernel_read_network_state(ntop_t)
 kernel_read_kernel_sysctls(ntop_t)
-kernel_list_proc(ntop_t)
-kernel_read_proc_symlinks(ntop_t)
 
 corenet_all_recvfrom_unlabeled(ntop_t)
 corenet_all_recvfrom_netlabel(ntop_t)
 corenet_tcp_sendrecv_generic_if(ntop_t)
-corenet_udp_sendrecv_generic_if(ntop_t)
 corenet_raw_sendrecv_generic_if(ntop_t)
 corenet_tcp_sendrecv_generic_node(ntop_t)
-corenet_udp_sendrecv_generic_node(ntop_t)
 corenet_raw_sendrecv_generic_node(ntop_t)
-corenet_tcp_sendrecv_all_ports(ntop_t)
-corenet_udp_sendrecv_all_ports(ntop_t)
+corenet_tcp_bind_generic_node(ntop_t)
+
+corenet_sendrecv_ntop_server_packets(ntop_t)
 corenet_tcp_bind_ntop_port(ntop_t)
+corenet_sendrecv_ntop_client_packets(ntop_t)
 corenet_tcp_connect_ntop_port(ntop_t)
-corenet_tcp_connect_http_port(ntop_t)
+corenet_tcp_sendrecv_ntop_port(ntop_t)
+
 corenet_sendrecv_http_client_packets(ntop_t)
-corenet_sendrecv_ntop_client_packets(ntop_t)
-corenet_sendrecv_ntop_server_packets(ntop_t)
+corenet_tcp_connect_http_port(ntop_t)
+corenet_tcp_sendrecv_http_port(ntop_t)
 
 dev_read_sysfs(ntop_t)
 dev_rw_generic_usb_dev(ntop_t)
 
 domain_use_interactive_fds(ntop_t)
 
-files_read_etc_files(ntop_t)
 files_read_usr_files(ntop_t)
 
 fs_getattr_all_fs(ntop_t)
@@ -95,8 +90,8 @@
 
 logging_send_syslog_msg(ntop_t)
 
-miscfiles_read_localization(ntop_t)
 miscfiles_read_fonts(ntop_t)
+miscfiles_read_localization(ntop_t)
 
 userdom_dontaudit_use_unpriv_user_fds(ntop_t)
 userdom_dontaudit_search_user_home_dirs(ntop_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/ntp.fc refpolicy/policy/modules/contrib/ntp.fc
--- refpolicy/policy/modules/contrib/ntp.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/ntp.fc	2012-10-16 19:36:15.706014044 +0200
@@ -1,22 +1,21 @@
+/etc/cron\.(daily|weekly)/ntp-simple	--	gen_context(system_u:object_r:ntpd_exec_t,s0)
+/etc/cron\.(daily|weekly)/ntp-server	--	gen_context(system_u:object_r:ntpd_exec_t,s0)
 
-/etc/cron\.(daily|weekly)/ntp-simple -- gen_context(system_u:object_r:ntpd_exec_t,s0)
-/etc/cron\.(daily|weekly)/ntp-server -- gen_context(system_u:object_r:ntpd_exec_t,s0)
+/etc/ntpd.*\.conf.*	--	gen_context(system_u:object_r:ntp_conf_t,s0)
+/etc/ntp/crypto(/.*)?	gen_context(system_u:object_r:ntpd_key_t,s0)
+/etc/ntp/data(/.*)?	gen_context(system_u:object_r:ntp_drift_t,s0)
+/etc/ntp/keys	--	gen_context(system_u:object_r:ntpd_key_t,s0)
+/etc/ntp/step-tickers.*	--	gen_context(system_u:object_r:ntp_conf_t,s0)
 
-/etc/ntpd?\.conf.*		--	gen_context(system_u:object_r:net_conf_t,s0)
-/etc/ntp/crypto(/.*)?			gen_context(system_u:object_r:ntpd_key_t,s0)
-/etc/ntp/data(/.*)?			gen_context(system_u:object_r:ntp_drift_t,s0)
-/etc/ntp/keys			--	gen_context(system_u:object_r:ntpd_key_t,s0)
-/etc/ntp/step-tickers.*		--	gen_context(system_u:object_r:net_conf_t,s0)
+/etc/rc\.d/init\.d/ntpd	--	gen_context(system_u:object_r:ntpd_initrc_exec_t,s0)
 
-/etc/rc\.d/init\.d/ntpd		--	gen_context(system_u:object_r:ntpd_initrc_exec_t,s0)
+/usr/sbin/ntpd	--	gen_context(system_u:object_r:ntpd_exec_t,s0)
+/usr/sbin/ntpdate	--	gen_context(system_u:object_r:ntpdate_exec_t,s0)
 
-/usr/sbin/ntpd			--	gen_context(system_u:object_r:ntpd_exec_t,s0)
-/usr/sbin/ntpdate		--	gen_context(system_u:object_r:ntpdate_exec_t,s0)
+/var/lib/ntp(/.*)?	gen_context(system_u:object_r:ntp_drift_t,s0)
 
-/var/lib/ntp(/.*)?			gen_context(system_u:object_r:ntp_drift_t,s0)
+/var/log/ntp.*	--	gen_context(system_u:object_r:ntpd_log_t,s0)
+/var/log/ntpstats(/.*)?	gen_context(system_u:object_r:ntpd_log_t,s0)
+/var/log/xntpd.*	--	gen_context(system_u:object_r:ntpd_log_t,s0)
 
-/var/log/ntp.*			--	gen_context(system_u:object_r:ntpd_log_t,s0)
-/var/log/ntpstats(/.*)?			gen_context(system_u:object_r:ntpd_log_t,s0)
-/var/log/xntpd.*		--	gen_context(system_u:object_r:ntpd_log_t,s0)
-
-/var/run/ntpd\.pid		--	gen_context(system_u:object_r:ntpd_var_run_t,s0)
+/var/run/ntpd\.pid	--	gen_context(system_u:object_r:ntpd_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/ntp.if refpolicy/policy/modules/contrib/ntp.if
--- refpolicy/policy/modules/contrib/ntp.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/ntp.if	2012-10-16 19:36:15.726014044 +0200
@@ -1,4 +1,4 @@
-## <summary>Network time protocol daemon</summary>
+## <summary>Network time protocol daemon.</summary>
 
 ########################################
 ## <summary>
@@ -54,11 +54,11 @@
 #
 interface(`ntp_run',`
 	gen_require(`
-		type ntpd_t;
+		attribute_role ntpd_roles;
 	')
 
 	ntp_domtrans($1)
-	role $2 types ntpd_t;
+	roleattribute $2 ntpd_roles;
 ')
 
 ########################################
@@ -122,8 +122,8 @@
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate
-##	an ntp environment
+##	All of the rules required to
+##	administrate an ntp environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -132,7 +132,7 @@
 ## </param>
 ## <param name="role">
 ##	<summary>
-##	The role to be allowed to manage the ntp domain.
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <rolecap/>
@@ -140,11 +140,11 @@
 interface(`ntp_admin',`
 	gen_require(`
 		type ntpd_t, ntpd_tmp_t, ntpd_log_t;
-		type ntpd_key_t, ntpd_var_run_t;
-		type ntpd_initrc_exec_t;
+		type ntpd_key_t, ntpd_var_run_t, ntp_conf_t;
+		type ntpd_initrc_exec_t, ntp_drift_t;
 	')
 
-	allow $1 ntpd_t:process { ptrace signal_perms getattr };
+	allow $1 ntpd_t:process { ptrace signal_perms };
 	ps_process_pattern($1, ntpd_t)
 
 	init_labeled_script_domtrans($1, ntpd_initrc_exec_t)
@@ -152,7 +152,8 @@
 	role_transition $2 ntpd_initrc_exec_t system_r;
 	allow $2 system_r;
 
-	admin_pattern($1, ntpd_key_t)
+	files_list_etc($1)
+	admin_pattern($1, { ntpd_key_t ntp_conf_t ntp_drift_t })
 
 	logging_list_logs($1)
 	admin_pattern($1, ntpd_log_t)
@@ -162,4 +163,6 @@
 
 	files_list_pids($1)
 	admin_pattern($1, ntpd_var_run_t)
+
+	ntp_run($1, $2)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/ntp.te refpolicy/policy/modules/contrib/ntp.te
--- refpolicy/policy/modules/contrib/ntp.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/ntp.te	2012-10-16 19:36:15.727014044 +0200
@@ -1,20 +1,26 @@
-policy_module(ntp, 1.10.0)
+policy_module(ntp, 1.10.2)
 
 ########################################
 #
 # Declarations
 #
 
+attribute_role ntpd_roles;
+
 type ntp_drift_t;
 files_type(ntp_drift_t)
 
 type ntpd_t;
 type ntpd_exec_t;
 init_daemon_domain(ntpd_t, ntpd_exec_t)
+role ntpd_roles types ntpd_t;
 
 type ntpd_initrc_exec_t;
 init_script_file(ntpd_initrc_exec_t)
 
+type ntp_conf_t;
+files_config_file(ntp_conf_t)
+
 type ntpd_key_t;
 files_type(ntpd_key_t)
 
@@ -38,30 +44,26 @@
 # Local policy
 #
 
-# sys_resource and setrlimit is for locking memory
-# ntpdate wants sys_nice
 allow ntpd_t self:capability { chown dac_override kill setgid setuid sys_time ipc_lock ipc_owner sys_chroot sys_nice sys_resource };
 dontaudit ntpd_t self:capability { net_admin sys_tty_config fsetid sys_nice };
 allow ntpd_t self:process { signal_perms getcap setcap setsched setrlimit };
 allow ntpd_t self:fifo_file rw_fifo_file_perms;
 allow ntpd_t self:shm create_shm_perms;
-allow ntpd_t self:unix_dgram_socket create_socket_perms;
-allow ntpd_t self:unix_stream_socket create_socket_perms;
-allow ntpd_t self:tcp_socket create_stream_socket_perms;
-allow ntpd_t self:udp_socket create_socket_perms;
+allow ntpd_t self:tcp_socket { accept listen };
 
 manage_files_pattern(ntpd_t, ntp_drift_t, ntp_drift_t)
 
-can_exec(ntpd_t, ntpd_exec_t)
+allow ntpd_t ntp_conf_t:file read_file_perms;
 
 read_files_pattern(ntpd_t, ntpd_key_t, ntpd_key_t)
 read_lnk_files_pattern(ntpd_t, ntpd_key_t, ntpd_key_t)
 
-allow ntpd_t ntpd_log_t:dir setattr;
-manage_files_pattern(ntpd_t, ntpd_log_t, ntpd_log_t)
+allow ntpd_t ntpd_log_t:dir setattr_dir_perms;
+append_files_pattern(ntpd_t, ntpd_log_t, ntpd_log_t)
+create_files_pattern(ntpd_t, ntpd_log_t, ntpd_log_t)
+setattr_files_pattern(ntpd_t, ntpd_log_t, ntpd_log_t)
 logging_log_filetrans(ntpd_t, ntpd_log_t, { file dir })
 
-# for some reason it creates a file in /tmp
 manage_dirs_pattern(ntpd_t, ntpd_tmp_t, ntpd_tmp_t)
 manage_files_pattern(ntpd_t, ntpd_tmp_t, ntpd_tmp_t)
 files_tmp_filetrans(ntpd_t, ntpd_tmp_t, { file dir })
@@ -73,6 +75,8 @@
 manage_files_pattern(ntpd_t, ntpd_var_run_t, ntpd_var_run_t)
 files_pid_filetrans(ntpd_t, ntpd_var_run_t, file)
 
+can_exec(ntpd_t, ntpd_exec_t)
+
 kernel_read_kernel_sysctls(ntpd_t)
 kernel_read_system_state(ntpd_t)
 kernel_read_network_state(ntpd_t)
@@ -84,37 +88,37 @@
 corenet_udp_sendrecv_generic_if(ntpd_t)
 corenet_tcp_sendrecv_generic_node(ntpd_t)
 corenet_udp_sendrecv_generic_node(ntpd_t)
-corenet_tcp_sendrecv_all_ports(ntpd_t)
-corenet_udp_sendrecv_all_ports(ntpd_t)
-corenet_tcp_bind_generic_node(ntpd_t)
 corenet_udp_bind_generic_node(ntpd_t)
-corenet_udp_bind_ntp_port(ntpd_t)
-corenet_tcp_connect_ntp_port(ntpd_t)
-corenet_sendrecv_ntp_server_packets(ntpd_t)
-corenet_sendrecv_ntp_client_packets(ntpd_t)
-
-dev_read_sysfs(ntpd_t)
-# for SSP
-dev_read_urand(ntpd_t)
 
-fs_getattr_all_fs(ntpd_t)
-fs_search_auto_mountpoints(ntpd_t)
-
-term_use_ptmx(ntpd_t)
+corenet_sendrecv_ntp_server_packets(ntpd_t)
+corenet_udp_bind_ntp_port(ntpd_t)
+corenet_udp_sendrecv_ntp_port(ntpd_t)
 
-auth_use_nsswitch(ntpd_t)
+corenet_sendrecv_ntp_client_packets(ntpd_t)
+corenet_tcp_connect_ntp_port(ntpd_t)
+corenet_tcp_sendrecv_ntp_port(ntpd_t)
 
 corecmd_exec_bin(ntpd_t)
 corecmd_exec_shell(ntpd_t)
 
+dev_read_sysfs(ntpd_t)
+dev_read_urand(ntpd_t)
+dev_rw_realtime_clock(ntpd_t)
+
 domain_use_interactive_fds(ntpd_t)
 domain_dontaudit_list_all_domains_state(ntpd_t)
 
-files_read_etc_files(ntpd_t)
 files_read_etc_runtime_files(ntpd_t)
 files_read_usr_files(ntpd_t)
 files_list_var_lib(ntpd_t)
 
+fs_getattr_all_fs(ntpd_t)
+fs_search_auto_mountpoints(ntpd_t)
+
+term_use_ptmx(ntpd_t)
+
+auth_use_nsswitch(ntpd_t)
+
 init_exec_script_files(ntpd_t)
 
 logging_send_syslog_msg(ntpd_t)
@@ -125,7 +129,6 @@
 userdom_list_user_home_dirs(ntpd_t)
 
 optional_policy(`
-	# for cron jobs
 	cron_system_entry(ntpd_t, ntpdate_exec_t)
 ')
 
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/numad.fc refpolicy/policy/modules/contrib/numad.fc
--- refpolicy/policy/modules/contrib/numad.fc	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/numad.fc	2012-09-24 21:09:43.924581732 +0200
@@ -0,0 +1,7 @@
+/etc/rc\.d/init\.d/numad	--	gen_context(system_u:object_r:numad_initrc_exec_t,s0)
+
+/usr/bin/numad	--	gen_context(system_u:object_r:numad_exec_t,s0)
+
+/var/log/numad\.log.*	--	gen_context(system_u:object_r:numad_log_t,s0)
+
+/var/run/numad\.pid	--	gen_context(system_u:object_r:numad_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/numad.if refpolicy/policy/modules/contrib/numad.if
--- refpolicy/policy/modules/contrib/numad.if	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/numad.if	2012-09-24 21:09:43.924581732 +0200
@@ -0,0 +1,39 @@
+## <summary>Non-Uniform Memory Alignment Daemon.</summary>
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an numad environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`numad_admin',`
+	gen_require(`
+		type numad_t, numad_initrc_exec_t, numad_log_t;
+		type numad_var_run_t;
+	')
+
+	allow $1 numad_t:process { ptrace signal_perms };
+	ps_process_pattern($1, numad_t)
+
+	init_labeled_script_domtrans($1, numad_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 numad_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	logging_search_logs($1)
+	admin_pattern($1, numad_log_t)
+
+	files_search_pids($1)
+	admin_pattern($1, numad_var_run_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/numad.te refpolicy/policy/modules/contrib/numad.te
--- refpolicy/policy/modules/contrib/numad.te	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/numad.te	2012-10-16 19:36:17.441014047 +0200
@@ -0,0 +1,44 @@
+policy_module(numad, 1.0.3)
+
+########################################
+#
+# Declarations
+#
+
+type numad_t;
+type numad_exec_t;
+init_daemon_domain(numad_t, numad_exec_t)
+application_executable_file(numad_exec_t)
+
+type numad_initrc_exec_t;
+init_script_file(numad_initrc_exec_t)
+
+type numad_log_t;
+logging_log_file(numad_log_t)
+
+type numad_var_run_t;
+files_pid_file(numad_var_run_t)
+
+########################################
+#
+# Local policy
+#
+
+allow numad_t self:fifo_file rw_fifo_file_perms;
+allow numad_t self:msg { send receive };
+allow numad_t self:msgq create_msgq_perms;
+allow numad_t self:unix_stream_socket create_stream_socket_perms;
+
+allow numad_t numad_log_t:file { append_file_perms create_file_perms setattr_file_perms };
+logging_log_filetrans(numad_t, numad_log_t, file)
+
+manage_files_pattern(numad_t, numad_var_run_t, numad_var_run_t)
+files_pid_filetrans(numad_t, numad_var_run_t, file)
+
+kernel_read_system_state(numad_t)
+
+dev_read_sysfs(numad_t)
+
+files_read_etc_files(numad_t)
+
+miscfiles_read_localization(numad_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/nut.fc refpolicy/policy/modules/contrib/nut.fc
--- refpolicy/policy/modules/contrib/nut.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/nut.fc	2012-10-16 19:36:20.906014055 +0200
@@ -1,12 +1,23 @@
-/etc/ups(/.*)?		gen_context(system_u:object_r:nut_conf_t,s0)
+/etc/nut(/.*)?	gen_context(system_u:object_r:nut_conf_t,s0)
+/etc/ups(/.*)?	gen_context(system_u:object_r:nut_conf_t,s0)
 
+/etc/rc\.d/init\.d/nut-driver	--	gen_context(system_u:object_r:nut_initrc_exec_t,s0)
+/etc/rc\.d/init\.d/nut-server	--	gen_context(system_u:object_r:nut_initrc_exec_t,s0)
+
+/sbin/upsd	--	gen_context(system_u:object_r:nut_upsd_exec_t,s0)
 /sbin/upsdrvctl	--	gen_context(system_u:object_r:nut_upsdrvctl_exec_t,s0)
+/sbin/upsmon	--	gen_context(system_u:object_r:nut_upsmon_exec_t,s0)
+
+/usr/lib/cgi-bin/nut/upsimage\.cgi	--	gen_context(system_u:object_r:httpd_nutups_cgi_script_exec_t,s0)
+/usr/lib/cgi-bin/nut/upsset\.cgi	--	gen_context(system_u:object_r:httpd_nutups_cgi_script_exec_t,s0)
+/usr/lib/cgi-bin/nut/upsstats\.cgi	--	gen_context(system_u:object_r:httpd_nutups_cgi_script_exec_t,s0)
 
 /usr/sbin/upsd	--	gen_context(system_u:object_r:nut_upsd_exec_t,s0)
-/usr/sbin/upsmon --	gen_context(system_u:object_r:nut_upsmon_exec_t,s0)
+/usr/sbin/upsdrvctl	--	gen_context(system_u:object_r:nut_upsdrvctl_exec_t,s0)
+/usr/sbin/upsmon	--	gen_context(system_u:object_r:nut_upsmon_exec_t,s0)
 
 /var/run/nut(/.*)?	gen_context(system_u:object_r:nut_var_run_t,s0)
 
-/var/www/nut-cgi-bin/upsimage\.cgi -- gen_context(system_u:object_r:httpd_nutups_cgi_script_exec_t,s0)
-/var/www/nut-cgi-bin/upsset\.cgi -- gen_context(system_u:object_r:httpd_nutups_cgi_script_exec_t,s0)
-/var/www/nut-cgi-bin/upsstats\.cgi -- gen_context(system_u:object_r:httpd_nutups_cgi_script_exec_t,s0)
+/var/www/nut-cgi-bin/upsimage\.cgi	--	gen_context(system_u:object_r:httpd_nutups_cgi_script_exec_t,s0)
+/var/www/nut-cgi-bin/upsset\.cgi	--	gen_context(system_u:object_r:httpd_nutups_cgi_script_exec_t,s0)
+/var/www/nut-cgi-bin/upsstats\.cgi	--	gen_context(system_u:object_r:httpd_nutups_cgi_script_exec_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/nut.if refpolicy/policy/modules/contrib/nut.if
--- refpolicy/policy/modules/contrib/nut.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/nut.if	2012-10-16 19:36:20.907014055 +0200
@@ -1 +1,39 @@
-## <summary>nut - Network UPS Tools </summary>
+## <summary>Network UPS Tools </summary>
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an nut environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`nut_admin',`
+	gen_require(`
+		attribute nut_domain;
+		type nut_initrc_exec_t, nut_var_run_t, nut_conf_t;
+	')
+
+	allow $1 nut_domain:process { ptrace signal_perms };
+	ps_process_pattern($1, nut_domain_t)
+
+	init_labeled_script_domtrans($1, nut_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 nut_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	files_search_etc($1)
+	admin_pattern($1, nut_conf_t)
+
+	files_search_pids($1)
+	admin_pattern($1, nut_var_run_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/nut.te refpolicy/policy/modules/contrib/nut.te
--- refpolicy/policy/modules/contrib/nut.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/nut.te	2012-10-27 13:44:57.307007515 +0200
@@ -1,107 +1,120 @@
-policy_module(nut, 1.2.0)
+policy_module(nut, 1.2.3)
 
 ########################################
 #
 # Declarations
 #
 
+attribute nut_domain;
+
 type nut_conf_t;
 files_config_file(nut_conf_t)
 
-type nut_upsd_t;
+type nut_upsd_t, nut_domain;
 type nut_upsd_exec_t;
 init_daemon_domain(nut_upsd_t, nut_upsd_exec_t)
 
-type nut_upsmon_t;
+type nut_upsmon_t, nut_domain;
 type nut_upsmon_exec_t;
 init_daemon_domain(nut_upsmon_t, nut_upsmon_exec_t)
 
-type nut_upsdrvctl_t;
+type nut_upsdrvctl_t, nut_domain;
 type nut_upsdrvctl_exec_t;
 init_daemon_domain(nut_upsdrvctl_t, nut_upsdrvctl_exec_t)
 
+type nut_initrc_exec_t;
+init_script_file(nut_initrc_exec_t)
+
 type nut_var_run_t;
 files_pid_file(nut_var_run_t)
 
 ########################################
 #
-# Local policy for upsd
+# Common nut domain local policy
 #
 
-allow nut_upsd_t self:capability { setgid setuid dac_override };
+allow nut_domain self:capability { setgid setuid dac_override kill };
+allow nut_domain self:process signal_perms;
+allow nut_domain self:fifo_file rw_fifo_file_perms;
+allow nut_domain self:unix_dgram_socket sendto;
+
+allow nut_domain nut_conf_t:dir list_dir_perms;
+allow nut_domain nut_conf_t:file read_file_perms;
+allow nut_domain nut_conf_t:lnk_file read_lnk_file_perms;
+
+manage_files_pattern(nut_domain, nut_var_run_t, nut_var_run_t)
+manage_dirs_pattern(nut_domain, nut_var_run_t, nut_var_run_t)
+files_pid_filetrans(nut_domain, nut_var_run_t, { dir file })
 
-allow nut_upsd_t self:unix_dgram_socket { create_socket_perms sendto };
-allow nut_upsd_t self:tcp_socket connected_stream_socket_perms;
+kernel_read_kernel_sysctls(nut_domain)
 
-allow nut_upsd_t nut_upsdrvctl_t:unix_stream_socket connectto;
+logging_send_syslog_msg(nut_domain)
 
-read_files_pattern(nut_upsd_t, nut_conf_t, nut_conf_t)
+miscfiles_read_localization(nut_domain)
+
+########################################
+#
+# Upsd local policy
+#
+
+allow nut_upsd_t self:tcp_socket { accept listen };
 
-# pid file
-manage_files_pattern(nut_upsd_t, nut_var_run_t, nut_var_run_t)
-manage_dirs_pattern(nut_upsd_t, nut_var_run_t, nut_var_run_t)
 manage_sock_files_pattern(nut_upsd_t, nut_var_run_t, nut_var_run_t)
-files_pid_filetrans(nut_upsd_t, nut_var_run_t, { dir file sock_file })
+files_pid_filetrans(nut_upsd_t, nut_var_run_t, sock_file)
+
+stream_connect_pattern(nut_upsd_t, nut_var_run_t, nut_var_run_t, nut_upsdrvctl_t)
 
-kernel_read_kernel_sysctls(nut_upsd_t)
+corenet_all_recvfrom_unlabeled(nut_upsd_t)
+corenet_all_recvfrom_netlabel(nut_upsd_t)
+corenet_tcp_sendrecv_generic_if(nut_upsd_t)
+corenet_tcp_sendrecv_generic_node(nut_upsd_t)
+corenet_tcp_sendrecv_all_ports(nut_upsd_t)
+corenet_tcp_bind_generic_node(nut_upsd_t)
 
+corenet_sendrecv_ups_server_packets(nut_upsd_t)
 corenet_tcp_bind_ups_port(nut_upsd_t)
+
+corenet_sendrecv_generic_server_packets(nut_upsd_t)
 corenet_tcp_bind_generic_port(nut_upsd_t)
-corenet_tcp_bind_all_nodes(nut_upsd_t)
 
 files_read_usr_files(nut_upsd_t)
 
 auth_use_nsswitch(nut_upsd_t)
 
-logging_send_syslog_msg(nut_upsd_t)
-
-miscfiles_read_localization(nut_upsd_t)
-
 ########################################
 #
-# Local policy for upsmon
+# Upsmon local policy
 #
 
-allow nut_upsmon_t self:capability { dac_override dac_read_search setgid setuid };
-allow nut_upsmon_t self:fifo_file rw_fifo_file_perms;
-allow nut_upsmon_t self:unix_dgram_socket { create_socket_perms sendto };
-allow nut_upsmon_t self:unix_stream_socket { create_socket_perms connectto };
-allow nut_upsmon_t self:tcp_socket create_socket_perms;
+allow nut_upsmon_t self:capability dac_read_search;
+allow nut_upsmon_t self:unix_stream_socket connectto;
 
-read_files_pattern(nut_upsmon_t, nut_conf_t, nut_conf_t)
-
-# pid file
-manage_files_pattern(nut_upsmon_t, nut_var_run_t, nut_var_run_t)
-manage_dirs_pattern(nut_upsmon_t, nut_var_run_t, nut_var_run_t)
-files_pid_filetrans(nut_upsmon_t, nut_var_run_t, file)
-
-kernel_read_kernel_sysctls(nut_upsmon_t)
 kernel_read_system_state(nut_upsmon_t)
 
 corecmd_exec_bin(nut_upsmon_t)
 corecmd_exec_shell(nut_upsmon_t)
 
+corenet_all_recvfrom_unlabeled(nut_upsmon_t)
+corenet_all_recvfrom_netlabel(nut_upsmon_t)
+corenet_tcp_sendrecv_generic_if(nut_upsmon_t)
+corenet_tcp_sendrecv_generic_node(nut_upsmon_t)
+corenet_tcp_sendrecv_all_ports(nut_upsmon_t)
+corenet_tcp_bind_generic_node(nut_upsmon_t)
+
+corenet_sendrecv_ups_client_packets(nut_upsmon_t)
 corenet_tcp_connect_ups_port(nut_upsmon_t)
+
+corenet_sendrecv_generic_client_packets(nut_upsmon_t)
 corenet_tcp_connect_generic_port(nut_upsmon_t)
 
-# Creates /etc/killpower
 files_manage_etc_runtime_files(nut_upsmon_t)
 files_etc_filetrans_etc_runtime(nut_upsmon_t, file)
 files_search_usr(nut_upsmon_t)
 
-# /usr/bin/wall
 term_write_all_terms(nut_upsmon_t)
 
-# upsmon runs shutdown, probably need a shutdown domain
-init_rw_utmp(nut_upsmon_t)
-init_telinit(nut_upsmon_t)
-
-logging_send_syslog_msg(nut_upsmon_t)
-
 auth_use_nsswitch(nut_upsmon_t)
 
-miscfiles_read_localization(nut_upsmon_t)
-
 mta_send_mail(nut_upsmon_t)
 
 optional_policy(`
@@ -110,29 +123,17 @@
 
 ########################################
 #
-# Local policy for upsdrvctl
+# Upsdrvctl local policy
 #
 
-allow nut_upsdrvctl_t self:capability { dac_override kill setgid setuid };
-allow nut_upsdrvctl_t self:process { sigchld signal signull };
 allow nut_upsdrvctl_t self:fd use;
-allow nut_upsdrvctl_t self:fifo_file rw_fifo_file_perms;
-allow nut_upsdrvctl_t self:unix_dgram_socket { create_socket_perms sendto };
-allow nut_upsdrvctl_t self:udp_socket create_socket_perms;
-
-read_files_pattern(nut_upsdrvctl_t, nut_conf_t, nut_conf_t)
-
-# pid file
-manage_files_pattern(nut_upsdrvctl_t, nut_var_run_t, nut_var_run_t)
-manage_dirs_pattern(nut_upsdrvctl_t, nut_var_run_t, nut_var_run_t)
-manage_sock_files_pattern(nut_upsdrvctl_t, nut_var_run_t, nut_var_run_t)
-files_pid_filetrans(nut_upsdrvctl_t, nut_var_run_t, { file sock_file })
 
-kernel_read_kernel_sysctls(nut_upsdrvctl_t)
+manage_sock_files_pattern(nut_upsdrvctl_t, nut_var_run_t, nut_var_run_t)
+files_pid_filetrans(nut_upsdrvctl_t, nut_var_run_t, sock_file)
 
-# /sbin/upsdrvctl executes other drivers
 corecmd_exec_bin(nut_upsdrvctl_t)
 
+dev_read_sysfs(nut_upsdrvctl_t)
 dev_read_urand(nut_upsdrvctl_t)
 dev_rw_generic_usb_dev(nut_upsdrvctl_t)
 
@@ -142,30 +143,17 @@
 
 init_sigchld(nut_upsdrvctl_t)
 
-logging_send_syslog_msg(nut_upsdrvctl_t)
-
-miscfiles_read_localization(nut_upsdrvctl_t)
-
 #######################################
 #
-# Local policy for upscgi scripts
-# requires httpd_enable_cgi and httpd_can_network_connect
+# Cgi local policy
 #
 
 optional_policy(`
 	apache_content_template(nutups_cgi)
 
-	read_files_pattern(httpd_nutups_cgi_script_t, nut_conf_t, nut_conf_t)
-
-	corenet_all_recvfrom_unlabeled(httpd_nutups_cgi_script_t)
-	corenet_all_recvfrom_netlabel(httpd_nutups_cgi_script_t)
-	corenet_tcp_sendrecv_generic_if(httpd_nutups_cgi_script_t)
-	corenet_tcp_sendrecv_generic_node(httpd_nutups_cgi_script_t)
-	corenet_tcp_sendrecv_all_ports(httpd_nutups_cgi_script_t)
-	corenet_tcp_connect_ups_port(httpd_nutups_cgi_script_t)
-	corenet_udp_sendrecv_generic_if(httpd_nutups_cgi_script_t)
-	corenet_udp_sendrecv_generic_node(httpd_nutups_cgi_script_t)
-	corenet_udp_sendrecv_all_ports(httpd_nutups_cgi_script_t)
+	allow httpd_nutups_cgi_script_t nut_conf_t:dir list_dir_perms;
+	allow httpd_nutups_cgi_script_t nut_conf_t:file read_file_perms;
+	allow httpd_nutups_cgi_script_t nut_conf_t:lnk_file read_lnk_file_perms;
 
 	sysnet_dns_name_resolve(httpd_nutups_cgi_script_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/nx.fc refpolicy/policy/modules/contrib/nx.fc
--- refpolicy/policy/modules/contrib/nx.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/nx.fc	2012-10-16 19:36:24.784014063 +0200
@@ -1,12 +1,13 @@
-/opt/NX/bin/nxserver		--	gen_context(system_u:object_r:nx_server_exec_t,s0)
-/opt/NX/home(/.*)?			gen_context(system_u:object_r:nx_server_var_lib_t,s0)
-/opt/NX/home/nx/\.ssh(/.*)?		gen_context(system_u:object_r:nx_server_home_ssh_t,s0)
-/opt/NX/var(/.*)?			gen_context(system_u:object_r:nx_server_var_run_t,s0)
+/opt/NX/bin/nxserver	--	gen_context(system_u:object_r:nx_server_exec_t,s0)
+/opt/NX/home(/.*)?	gen_context(system_u:object_r:nx_server_var_lib_t,s0)
+/opt/NX/home/nx/\.ssh(/.*)?	gen_context(system_u:object_r:nx_server_home_ssh_t,s0)
+/opt/NX/var(/.*)?	gen_context(system_u:object_r:nx_server_var_run_t,s0)
 
 /usr/libexec/nx/nxserver	--	gen_context(system_u:object_r:nx_server_exec_t,s0)
-/usr/NX/bin/nxserver		--	gen_context(system_u:object_r:nx_server_exec_t,s0)
-/usr/NX/home(/.*)?			gen_context(system_u:object_r:nx_server_var_lib_t,s0)
-/usr/NX/home/nx/\.ssh(/.*)?		gen_context(system_u:object_r:nx_server_home_ssh_t,s0)
 
-/var/lib/nxserver(/.*)?			gen_context(system_u:object_r:nx_server_var_lib_t,s0)
+/usr/NX/bin/nxserver	--	gen_context(system_u:object_r:nx_server_exec_t,s0)
+/usr/NX/home(/.*)?	gen_context(system_u:object_r:nx_server_var_lib_t,s0)
+/usr/NX/home/nx/\.ssh(/.*)?	gen_context(system_u:object_r:nx_server_home_ssh_t,s0)
+
+/var/lib/nxserver(/.*)?	gen_context(system_u:object_r:nx_server_var_lib_t,s0)
 /var/lib/nxserver/home/.ssh(/.*)?	gen_context(system_u:object_r:nx_server_home_ssh_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/nx.if refpolicy/policy/modules/contrib/nx.if
--- refpolicy/policy/modules/contrib/nx.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/nx.if	2012-10-16 19:36:24.802014063 +0200
@@ -1,8 +1,8 @@
-## <summary>NX remote desktop</summary>
+## <summary>NX remote desktop.</summary>
 
 ########################################
 ## <summary>
-##	Transition to NX server.
+##	Transition to nx server.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -15,12 +15,13 @@
 		type nx_server_t, nx_server_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	spec_domtrans_pattern($1, nx_server_exec_t, nx_server_t)
 ')
 
 ########################################
 ## <summary>
-##	Read nx home directory content
+##	Read nx home directory content.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -33,13 +34,13 @@
 		type nx_server_home_ssh_t, nx_server_var_lib_t;
 	')
 
-	allow $1 nx_server_var_lib_t:dir search_dir_perms;
-	read_files_pattern($1, nx_server_home_ssh_t, nx_server_home_ssh_t)
+	files_search_var_lib($1)
+	read_files_pattern($1, { nx_server_var_lib_t nx_server_home_ssh_t }, nx_server_home_ssh_t)
 ')
 
 ########################################
 ## <summary>
-##	Read nx /var/lib content
+##	Search nx lib directories.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -52,13 +53,14 @@
 		type nx_server_var_lib_t;
 	')
 
+	files_search_var_lib($1)
 	allow $1 nx_server_var_lib_t:dir search_dir_perms;
 ')
 
 ########################################
 ## <summary>
-##	Create an object in the root directory, with a private
-##	type using a type transition.
+##	Create specified objects in nx lib
+##	directories with a private type.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -75,11 +77,16 @@
 ##	The object class of the object being created.
 ##	</summary>
 ## </param>
+## <param name="name" optional="true">
+##	<summary>
+##	The name of the object being created.
+##	</summary>
+## </param>
 #
 interface(`nx_var_lib_filetrans',`
 	gen_require(`
 		type nx_server_var_lib_t;
 	')
 
-	filetrans_pattern($1, nx_server_var_lib_t, $2, $3)
+	filetrans_pattern($1, nx_server_var_lib_t, $2, $3, $4)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/nx.te refpolicy/policy/modules/contrib/nx.te
--- refpolicy/policy/modules/contrib/nx.te	2012-05-04 15:16:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/nx.te	2012-10-16 19:36:24.806014063 +0200
@@ -1,4 +1,4 @@
-policy_module(nx, 1.6.0)
+policy_module(nx, 1.6.1)
 
 ########################################
 #
@@ -10,8 +10,7 @@
 domain_type(nx_server_t)
 domain_entry_file(nx_server_t, nx_server_exec_t)
 domain_user_exemption_target(nx_server_t)
-# we need an extra role because nxserver is called from sshd
-# cjp: do we really need this?
+
 role nx_server_r;
 role nx_server_r types nx_server_t;
 allow system_r nx_server_r;
@@ -30,14 +29,14 @@
 
 ########################################
 #
-# NX server local policy
+# Local policy
 #
 
 allow nx_server_t self:fifo_file rw_fifo_file_perms;
 allow nx_server_t self:tcp_socket create_socket_perms;
 allow nx_server_t self:udp_socket create_socket_perms;
 
-allow nx_server_t nx_server_devpts_t:chr_file { rw_chr_file_perms setattr };
+allow nx_server_t nx_server_devpts_t:chr_file { rw_chr_file_perms setattr_chr_file_perms };
 term_create_pty(nx_server_t, nx_server_devpts_t)
 
 manage_dirs_pattern(nx_server_t, nx_server_tmp_t, nx_server_tmp_t)
@@ -54,18 +53,15 @@
 kernel_read_system_state(nx_server_t)
 kernel_read_kernel_sysctls(nx_server_t)
 
-# nxserver is a shell script --> call other programs
 corecmd_exec_shell(nx_server_t)
 corecmd_exec_bin(nx_server_t)
 
 corenet_all_recvfrom_unlabeled(nx_server_t)
 corenet_all_recvfrom_netlabel(nx_server_t)
 corenet_tcp_sendrecv_generic_if(nx_server_t)
-corenet_udp_sendrecv_generic_if(nx_server_t)
 corenet_tcp_sendrecv_generic_node(nx_server_t)
-corenet_udp_sendrecv_generic_node(nx_server_t)
 corenet_tcp_sendrecv_all_ports(nx_server_t)
-corenet_udp_sendrecv_all_ports(nx_server_t)
+
 corenet_tcp_connect_all_ports(nx_server_t)
 corenet_sendrecv_all_client_packets(nx_server_t)
 
@@ -73,8 +69,6 @@
 
 files_read_etc_files(nx_server_t)
 files_read_etc_runtime_files(nx_server_t)
-# for reading the config files; maybe a separate type, 
-# but users need to be able to also read the config
 files_read_usr_files(nx_server_t)
 
 miscfiles_read_localization(nx_server_t)
@@ -83,16 +77,4 @@
 
 sysnet_read_config(nx_server_t)
 
-ifdef(`TODO',`
-# clients already have create permissions; the nxclient wants to also have unlink rights
-allow userdomain xdm_tmp_t:sock_file unlink;
-# for a lockfile created by the client process
-allow nx_server_t user_tmpfile:file getattr;
-')
-
-########################################
-#
-# SSH component local policy
-#
-
 ssh_basic_client_template(nx_server, nx_server_t, nx_server_r)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/oav.fc refpolicy/policy/modules/contrib/oav.fc
--- refpolicy/policy/modules/contrib/oav.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/oav.fc	2012-10-16 19:36:25.926014066 +0200
@@ -1,9 +1,9 @@
-/etc/oav-update(/.*)?			gen_context(system_u:object_r:oav_update_etc_t,s0)
-/etc/scannerdaemon/scannerdaemon\.conf -- gen_context(system_u:object_r:scannerdaemon_etc_t,s0)
+/etc/oav-update(/.*)?	gen_context(system_u:object_r:oav_update_etc_t,s0)
+/etc/scannerdaemon/scannerdaemon\.conf	--	gen_context(system_u:object_r:scannerdaemon_etc_t,s0)
 
-/usr/sbin/oav-update		--	gen_context(system_u:object_r:oav_update_exec_t,s0)
-/usr/sbin/scannerdaemon		--	gen_context(system_u:object_r:scannerdaemon_exec_t,s0)
+/usr/sbin/oav-update	--	gen_context(system_u:object_r:oav_update_exec_t,s0)
+/usr/sbin/scannerdaemon	--	gen_context(system_u:object_r:scannerdaemon_exec_t,s0)
 
 /var/lib/oav-virussignatures	--	gen_context(system_u:object_r:oav_update_var_lib_t,s0)
-/var/lib/oav-update(/.*)?		gen_context(system_u:object_r:oav_update_var_lib_t,s0)
-/var/log/scannerdaemon\.log 	--	gen_context(system_u:object_r:scannerdaemon_log_t,s0)
+/var/lib/oav-update(/.*)?	gen_context(system_u:object_r:oav_update_var_lib_t,s0)
+/var/log/scannerdaemon\.log.*	--	gen_context(system_u:object_r:scannerdaemon_log_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/oav.if refpolicy/policy/modules/contrib/oav.if
--- refpolicy/policy/modules/contrib/oav.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/oav.if	2012-10-16 19:36:25.927014066 +0200
@@ -1,4 +1,4 @@
-## <summary>Open AntiVirus scannerdaemon and signature update</summary>
+## <summary>Open AntiVirus scannerdaemon and signature update.</summary>
 
 ########################################
 ## <summary>
@@ -21,8 +21,9 @@
 
 ########################################
 ## <summary>
-##	Execute oav_update in the oav_update domain, and
-##	allow the specified role the oav_update domain.
+##	Execute oav_update in the oav update
+##	domain, and allow the specified role
+##	the oav_update domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -38,9 +39,9 @@
 #
 interface(`oav_run_update',`
 	gen_require(`
-		type oav_update_t;
+		attribute_role oav_update_roles;
 	')
 
 	oav_domtrans_update($1)
-	role $2 types oav_update_t;
+	roleattribute $2 oav_update_roles;
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/oav.te refpolicy/policy/modules/contrib/oav.te
--- refpolicy/policy/modules/contrib/oav.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/oav.te	2012-10-16 19:36:25.927014066 +0200
@@ -1,15 +1,17 @@
-policy_module(oav, 1.9.0)
+policy_module(oav, 1.9.1)
 
 ########################################
 #
 # Declarations
 #
 
+attribute_role oav_update_roles;
+
 type oav_update_t;
 type oav_update_exec_t;
 application_domain(oav_update_t, oav_update_exec_t)
+role oav_update_roles types oav_update_t;
 
-# cjp: may be collapsable to etc_t
 type oav_update_etc_t;
 files_config_file(oav_update_etc_t)
 
@@ -31,32 +33,21 @@
 
 ########################################
 #
-# OAV update local policy
+# Update local policy
 #
 
 allow oav_update_t self:tcp_socket create_stream_socket_perms;
 allow oav_update_t self:udp_socket create_socket_perms;
 
-# Can read /etc/oav-update/* files
 allow oav_update_t oav_update_etc_t:dir list_dir_perms;
 allow oav_update_t oav_update_etc_t:file read_file_perms;
 
-# Can read /var/lib/oav-update/current
 manage_dirs_pattern(oav_update_t, oav_update_var_lib_t, oav_update_var_lib_t)
 manage_files_pattern(oav_update_t, oav_update_var_lib_t, oav_update_var_lib_t)
 read_lnk_files_pattern(oav_update_t, oav_update_var_lib_t, oav_update_var_lib_t)
 
 corecmd_exec_all_executables(oav_update_t)
 
-corenet_all_recvfrom_unlabeled(oav_update_t)
-corenet_all_recvfrom_netlabel(oav_update_t)
-corenet_tcp_sendrecv_generic_if(oav_update_t)
-corenet_udp_sendrecv_generic_if(oav_update_t)
-corenet_tcp_sendrecv_generic_node(oav_update_t)
-corenet_udp_sendrecv_generic_node(oav_update_t)
-corenet_tcp_sendrecv_all_ports(oav_update_t)
-corenet_udp_sendrecv_all_ports(oav_update_t)
-
 files_exec_etc_files(oav_update_t)
 
 libs_exec_ld_so(oav_update_t)
@@ -85,7 +76,6 @@
 
 allow scannerdaemon_t oav_update_var_lib_t:dir list_dir_perms;
 allow scannerdaemon_t oav_update_var_lib_t:file read_file_perms;
-files_search_var_lib(scannerdaemon_t)
 
 allow scannerdaemon_t scannerdaemon_etc_t:file read_file_perms;
 
@@ -98,33 +88,22 @@
 kernel_read_system_state(scannerdaemon_t)
 kernel_read_kernel_sysctls(scannerdaemon_t)
 
-# Can run kaffe
 corecmd_exec_all_executables(scannerdaemon_t)
 
-corenet_all_recvfrom_unlabeled(scannerdaemon_t)
-corenet_all_recvfrom_netlabel(scannerdaemon_t)
-corenet_tcp_sendrecv_generic_if(scannerdaemon_t)
-corenet_udp_sendrecv_generic_if(scannerdaemon_t)
-corenet_tcp_sendrecv_generic_node(scannerdaemon_t)
-corenet_udp_sendrecv_generic_node(scannerdaemon_t)
-corenet_tcp_sendrecv_all_ports(scannerdaemon_t)
-corenet_udp_sendrecv_all_ports(scannerdaemon_t)
-
 dev_read_sysfs(scannerdaemon_t)
 
 domain_use_interactive_fds(scannerdaemon_t)
 
+files_exec_etc_files(scannerdaemon_t)
 files_read_etc_files(scannerdaemon_t)
 files_read_etc_runtime_files(scannerdaemon_t)
-# Can run kaffe
-files_exec_etc_files(scannerdaemon_t)
+files_search_var_lib(scannerdaemon_t)
 
 fs_getattr_all_fs(scannerdaemon_t)
 fs_search_auto_mountpoints(scannerdaemon_t)
 
 auth_dontaudit_read_shadow(scannerdaemon_t)
 
-# Can run kaffe
 libs_exec_ld_so(scannerdaemon_t)
 libs_exec_lib_files(scannerdaemon_t)
 
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/obex.fc refpolicy/policy/modules/contrib/obex.fc
--- refpolicy/policy/modules/contrib/obex.fc	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/obex.fc	2012-10-16 19:36:27.083014068 +0200
@@ -0,0 +1 @@
+/usr/bin/obex-data-server	--	gen_context(system_u:object_r:obex_exec_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/obex.if refpolicy/policy/modules/contrib/obex.if
--- refpolicy/policy/modules/contrib/obex.if	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/obex.if	2012-10-16 19:36:27.083014068 +0200
@@ -0,0 +1,88 @@
+## <summary>D-Bus service providing high-level OBEX client and server side functionality.</summary>
+
+#######################################
+## <summary>
+##	The role template for obex.
+## </summary>
+## <param name="role_prefix">
+##	<summary>
+##	The prefix of the user domain (e.g., user
+##	is the prefix for user_t).
+##	</summary>
+## </param>
+## <param name="user_role">
+##	<summary>
+##	The role associated with the user domain.
+##	</summary>
+## </param>
+## <param name="user_domain">
+##	<summary>
+##	The type of the user domain.
+##	</summary>
+## </param>
+#
+template(`obex_role_template',`
+	gen_require(`
+		attribute_role obex_roles;
+		type obex_t, obex_exec_exec_t;
+	')
+
+	########################################
+	#
+	# Declarations
+	#
+
+	roleattribute $2 obex_roles;
+
+	########################################
+	#
+	# Policy
+	#
+
+	allow $3 obex_t:process { ptrace signal_perms };
+	ps_process_pattern($3, obex_t)
+
+	dbus_spec_session_domain($1, obex_exec_t, obex_t)
+
+	obex_dbus_chat($3)
+')
+
+########################################
+## <summary>
+##	Execute obex in the obex domain.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed to transition.
+##	</summary>
+## </param>
+#
+interface(`obex_domtrans',`
+	gen_require(`
+		type obex_t, obex_exec_t;
+	')
+
+	corecmd_search_bin($1)
+	domtrans_pattern($1, obex_exec_t, obex_t)
+')
+
+########################################
+## <summary>
+##	Send and receive messages from
+##	obex over dbus.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`obex_dbus_chat',`
+	gen_require(`
+		type obex_t;
+		class dbus send_msg;
+	')
+
+	allow $1 obex_t:dbus send_msg;
+	allow obex_t $1:dbus send_msg;
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/obex.te refpolicy/policy/modules/contrib/obex.te
--- refpolicy/policy/modules/contrib/obex.te	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/obex.te	2012-10-16 19:36:27.083014068 +0200
@@ -0,0 +1,43 @@
+policy_module(obex, 1.0.0)
+
+########################################
+#
+# Declarations
+#
+
+attribute_role obex_roles;
+
+type obex_t;
+type obex_exec_t;
+userdom_user_application_domain(obex_t, obex_exec_t)
+role obex_roles types obex_t;
+
+########################################
+#
+# Local policy
+#
+
+allow obex_t self:fifo_file rw_fifo_file_perms;
+allow obex_t self:socket create_stream_socket_perms;
+
+dev_read_urand(obex_t)
+
+files_read_etc_files(obex_t)
+
+logging_send_syslog_msg(obex_t)
+
+miscfiles_read_localization(obex_t)
+
+userdom_search_user_home_content(obex_t)
+
+optional_policy(`
+	bluetooth_stream_connect(obex_t)
+')
+
+optional_policy(`
+	dbus_system_bus_client(obex_t)
+
+	optional_policy(`
+		bluetooth_dbus_chat(obex_t)
+	')
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/oddjob.fc refpolicy/policy/modules/contrib/oddjob.fc
--- refpolicy/policy/modules/contrib/oddjob.fc	2012-05-04 16:10:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/oddjob.fc	2012-10-16 19:36:48.334014113 +0200
@@ -1,7 +1,10 @@
+/sbin/mkhomedir_helper	--	gen_context(system_u:object_r:oddjob_mkhomedir_exec_t,s0)
+
 /usr/lib/oddjob/mkhomedir	--	gen_context(system_u:object_r:oddjob_mkhomedir_exec_t,s0)
 
-/usr/sbin/oddjobd		--	gen_context(system_u:object_r:oddjob_exec_t,s0)
+/usr/libexec/oddjob/mkhomedir	--	gen_context(system_u:object_r:oddjob_mkhomedir_exec_t,s0)
 
-/sbin/mkhomedir_helper		--	gen_context(system_u:object_r:oddjob_mkhomedir_exec_t,s0)
+/usr/sbin/oddjobd	--	gen_context(system_u:object_r:oddjob_exec_t,s0)
+/usr/sbin/mkhomedir_helper	--	gen_context(system_u:object_r:oddjob_mkhomedir_exec_t,s0)
 
-/var/run/oddjobd\.pid			gen_context(system_u:object_r:oddjob_var_run_t,s0)
+/var/run/oddjobd\.pid	gen_context(system_u:object_r:oddjob_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/oddjob.if refpolicy/policy/modules/contrib/oddjob.if
--- refpolicy/policy/modules/contrib/oddjob.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/oddjob.if	2012-10-27 13:43:55.820007383 +0200
@@ -1,8 +1,4 @@
-## <summary>
-##	Oddjob provides a mechanism by which unprivileged applications can
-##	request that specified privileged operations be performed on their
-##	behalf.
-## </summary>
+## <summary>D-BUS service which runs odd jobs on behalf of client applications.</summary>
 
 ########################################
 ## <summary>
@@ -19,13 +15,14 @@
 		type oddjob_t, oddjob_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, oddjob_exec_t, oddjob_t)
 ')
 
 ########################################
 ## <summary>
-##	Make the specified program domain accessable
-##	from the oddjob.
+##	Make the specified program domain
+##	accessable from the oddjob.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -69,12 +66,13 @@
 
 ########################################
 ## <summary>
-##	Execute a domain transition to run oddjob_mkhomedir.
+##	Execute a domain transition to
+##	run oddjob mkhomedir.
 ## </summary>
 ## <param name="domain">
-## <summary>
+##	<summary>
 ##	Domain allowed to transition.
-## </summary>
+##	</summary>
 ## </param>
 #
 interface(`oddjob_domtrans_mkhomedir',`
@@ -82,12 +80,16 @@
 		type oddjob_mkhomedir_t, oddjob_mkhomedir_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, oddjob_mkhomedir_exec_t, oddjob_mkhomedir_t)
 ')
 
 ########################################
 ## <summary>
-##	Execute the oddjob_mkhomedir program in the oddjob_mkhomedir domain.
+##	Execute oddjob mkhomedir in the
+##	oddjob mkhomedir domain and allow
+##	the specified role the oddjob
+##	mkhomedir domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -103,9 +105,46 @@
 #
 interface(`oddjob_run_mkhomedir',`
 	gen_require(`
-		type oddjob_mkhomedir_t;
+		attribute_role oddjob_mkhomedir_roles;
 	')
 
 	oddjob_domtrans_mkhomedir($1)
-	role $2 types oddjob_mkhomedir_t;
+	roleattribute $2 oddjob_mkhomedir_roles;
+')
+
+#####################################
+## <summary>
+##	Do not audit attempts to read and write 
+##	oddjob fifo files.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain to not audit.
+##	</summary>
+## </param>
+#
+interface(`oddjob_dontaudit_rw_fifo_files',`
+	gen_require(`
+		type oddjob_t;
+	')
+
+	dontaudit $1 oddjob_t:fifo_file rw_fifo_file_perms;
+')
+
+######################################
+## <summary>
+##	Send child terminated signals to oddjob.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`oddjob_sigchld',`
+	gen_require(`
+		type oddjob_t;
+	')
+
+	allow $1 oddjob_t:process sigchld;
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/oddjob.te refpolicy/policy/modules/contrib/oddjob.te
--- refpolicy/policy/modules/contrib/oddjob.te	2012-07-25 20:33:05.000000000 +0200
+++ refpolicy/policy/modules/contrib/oddjob.te	2012-10-27 13:43:55.820007383 +0200
@@ -1,10 +1,12 @@
-policy_module(oddjob, 1.9.0)
+policy_module(oddjob, 1.9.2)
 
 ########################################
 #
 # Declarations
 #
 
+attribute_role oddjob_mkhomedir_roles;
+
 type oddjob_t;
 type oddjob_exec_t;
 domain_type(oddjob_t)
@@ -18,9 +20,8 @@
 domain_type(oddjob_mkhomedir_t)
 domain_obj_id_change_exemption(oddjob_mkhomedir_t)
 init_system_domain(oddjob_mkhomedir_t, oddjob_mkhomedir_exec_t)
-oddjob_system_entry(oddjob_mkhomedir_t, oddjob_mkhomedir_exec_t)
+role oddjob_mkhomedir_roles types oddjob_mkhomedir_t;
 
-# pid files
 type oddjob_var_run_t;
 files_pid_file(oddjob_var_run_t)
 
@@ -30,7 +31,7 @@
 
 ########################################
 #
-# oddjob local policy
+# Local policy
 #
 
 allow oddjob_t self:capability setgid;
@@ -42,6 +43,8 @@
 manage_sock_files_pattern(oddjob_t, oddjob_var_run_t, oddjob_var_run_t)
 files_pid_filetrans(oddjob_t, oddjob_var_run_t, { file sock_file })
 
+domtrans_pattern(oddjob_t, oddjob_mkhomedir_exec_t, oddjob_mkhomedir_t)
+
 kernel_read_system_state(oddjob_t)
 
 corecmd_exec_bin(oddjob_t)
@@ -51,7 +54,7 @@
 
 selinux_compute_create_context(oddjob_t)
 
-files_read_etc_files(oddjob_t)
+auth_use_nsswitch(oddjob_t)
 
 miscfiles_read_localization(oddjob_t)
 
@@ -68,18 +71,16 @@
 
 ########################################
 #
-# oddjob_mkhomedir local policy
+# Mkhomedir local policy
 #
 
 allow oddjob_mkhomedir_t self:capability { chown fowner fsetid dac_override };
 allow oddjob_mkhomedir_t self:process setfscreate;
 allow oddjob_mkhomedir_t self:fifo_file rw_fifo_file_perms;
-allow oddjob_mkhomedir_t self:unix_stream_socket create_stream_socket_perms;
+allow oddjob_mkhomedir_t self:unix_stream_socket { accept listen };
 
 kernel_read_system_state(oddjob_mkhomedir_t)
 
-files_read_etc_files(oddjob_mkhomedir_t)
-
 auth_use_nsswitch(oddjob_mkhomedir_t)
 
 logging_send_syslog_msg(oddjob_mkhomedir_t)
@@ -97,10 +98,8 @@
 seutil_read_file_contexts(oddjob_mkhomedir_t)
 seutil_read_default_contexts(oddjob_mkhomedir_t)
 
-# Add/remove user home directories
 userdom_home_filetrans_user_home_dir(oddjob_mkhomedir_t)
 userdom_manage_user_home_content_dirs(oddjob_mkhomedir_t)
 userdom_manage_user_home_content_files(oddjob_mkhomedir_t)
 userdom_manage_user_home_dirs(oddjob_mkhomedir_t)
 userdom_user_home_dir_filetrans_user_home_content(oddjob_mkhomedir_t, notdevfile_class_set)
-
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/oident.fc refpolicy/policy/modules/contrib/oident.fc
--- refpolicy/policy/modules/contrib/oident.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/oident.fc	2012-10-17 19:37:34.967198629 +0200
@@ -1,8 +1,8 @@
-HOME_DIR/\.oidentd.conf			gen_context(system_u:object_r:oidentd_home_t, s0)
+HOME_DIR/\.oidentd\.conf	--	gen_context(system_u:object_r:oidentd_home_t,s0)
 
-/etc/oidentd\.conf		--	gen_context(system_u:object_r:oidentd_config_t, s0)
-/etc/oidentd_masq\.conf		--	gen_context(system_u:object_r:oidentd_config_t, s0)
+/etc/oidentd\.conf	--	gen_context(system_u:object_r:oidentd_config_t,s0)
+/etc/oidentd_masq\.conf	--	gen_context(system_u:object_r:oidentd_config_t,s0)
 
-/etc/rc\.d/init\.d/oidentd	--	gen_context(system_u:object_r:oidentd_initrc_exec_t, s0)
+/etc/rc\.d/init\.d/oidentd	--	gen_context(system_u:object_r:oidentd_initrc_exec_t,s0)
 
-/usr/sbin/oidentd		--	gen_context(system_u:object_r:oidentd_exec_t, s0)
+/usr/sbin/oidentd	--	gen_context(system_u:object_r:oidentd_exec_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/oident.if refpolicy/policy/modules/contrib/oident.if
--- refpolicy/policy/modules/contrib/oident.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/oident.if	2012-10-19 09:47:30.275491891 +0200
@@ -1,16 +1,27 @@
-## <summary>SELinux policy for Oident daemon.</summary>
-## <desc>
-##	<p>
-##	Oident daemon is a server that implements the TCP/IP
-##	standard IDENT user identification protocol as
-##	specified in the RFC 1413 document.
-##	</p>
-## </desc>
+## <summary>An ident daemon with IP masq/NAT support and the ability to specify responses.</summary>
 
 ########################################
 ## <summary>
-##	Allow the specified domain to read
-##	Oidentd personal configuration files.
+##	Role access for oident.
+## </summary>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <param name="domain">
+##	<summary>
+##	User domain for the role.
+##	</summary>
+## </param>
+#
+interface(`oident_role',`
+	refpolicywarn(`$0($*) has been deprecated')
+')
+
+########################################
+## <summary>
+##	Read oidentd user home content.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -23,14 +34,14 @@
 		type oidentd_home_t;
 	')
 
-	allow $1 oidentd_home_t:file read_file_perms;
 	userdom_search_user_home_dirs($1)
+	allow $1 oidentd_home_t:file read_file_perms;
 ')
 
 ########################################
 ## <summary>
-##	Allow the specified domain to create, read, write, and delete
-##	Oidentd personal configuration files.
+##	Create, read, write, and delete
+##	oidentd user home content.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -43,14 +54,13 @@
 		type oidentd_home_t;
 	')
 
-	allow $1 oidentd_home_t:file manage_file_perms;
 	userdom_search_user_home_dirs($1)
+	allow $1 oidentd_home_t:file manage_file_perms;
 ')
 
 ########################################
 ## <summary>
-##	Allow the specified domain to relabel
-##	Oidentd personal configuration files.
+##	Relabel oidentd user home content.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -63,6 +73,69 @@
 		type oidentd_home_t;
 	')
 
-	allow $1 oidentd_home_t:file relabel_file_perms;
 	userdom_search_user_home_dirs($1)
+	allow $1 oidentd_home_t:file relabel_file_perms;
+')
+
+########################################
+## <summary>
+##	Create objects in user home
+##	directories with the oidentd home type.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="object_class">
+##	<summary>
+##	Class of the object being created.
+##	</summary>
+## </param>
+## <param name="name" optional="true">
+##	<summary>
+##	The name of the object being created.
+##	</summary>
+## </param>
+#
+interface(`oident_home_filetrans_oidentd_home',`
+	gen_require(`
+		type oidentd_home_t;
+	')
+
+	userdom_user_home_dir_filetrans($1, oidentd_home_t, $2, $3)
+')
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an oident environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`oident_admin',`
+	gen_require(`
+		type oidentd_t, oidentd_initrc_exec_t, oidentd_config_t;
+	')
+
+	allow $1 oidentd_t:process { ptrace signal_perms };
+	ps_process_pattern($1, oidentd_t)
+
+	init_labeled_script_domtrans($1, oidentd_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 oidentd_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	files_list_etc($1)
+	admin_pattern($1, oidentd_config_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/oident.te refpolicy/policy/modules/contrib/oident.te
--- refpolicy/policy/modules/contrib/oident.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/oident.te	2012-10-17 19:37:34.968198629 +0200
@@ -1,8 +1,8 @@
-policy_module(oident, 2.2.0)
+policy_module(oident, 2.2.1)
 
 ########################################
 #
-# Oident daemon private declarations
+# Declarations
 #
 
 type oidentd_t;
@@ -22,54 +22,50 @@
 
 ########################################
 #
-# Oident daemon private policy
+# Local policy
 #
 
 allow oidentd_t self:capability { setuid setgid };
-allow oidentd_t self:netlink_route_socket { write getattr read bind create nlmsg_read };
-allow oidentd_t self:netlink_tcpdiag_socket { write read create nlmsg_read };
-allow oidentd_t self:tcp_socket { setopt read bind create accept write getattr listen };
-allow oidentd_t self:udp_socket { write read create connect getattr ioctl };
-allow oidentd_t self:unix_dgram_socket { create connect };
+allow oidentd_t self:netlink_tcpdiag_socket r_netlink_socket_perms;
+allow oidentd_t self:tcp_socket { accept listen };
 
 allow oidentd_t oidentd_config_t:file read_file_perms;
 
+allow oidentd_t oidentd_home_t:file read_file_perms;
+
+kernel_read_kernel_sysctls(oidentd_t)
+kernel_read_network_state(oidentd_t)
+kernel_read_network_state_symlinks(oidentd_t)
+kernel_read_sysctl(oidentd_t)
+kernel_request_load_module(oidentd_t)
+
 corenet_all_recvfrom_unlabeled(oidentd_t)
 corenet_all_recvfrom_netlabel(oidentd_t)
 corenet_tcp_sendrecv_generic_if(oidentd_t)
 corenet_tcp_sendrecv_generic_node(oidentd_t)
 corenet_tcp_bind_generic_node(oidentd_t)
-corenet_tcp_bind_auth_port(oidentd_t)
+
 corenet_sendrecv_auth_server_packets(oidentd_t)
+corenet_tcp_bind_auth_port(oidentd_t)
+corenet_tcp_sendrecv_auth_port(oidentd_t)
 
-files_read_etc_files(oidentd_t)
+fs_getattr_all_fs(oidentd_t)
+fs_search_auto_mountpoints(oidentd_t)
 
-kernel_read_kernel_sysctls(oidentd_t)
-kernel_read_network_state(oidentd_t)
-kernel_read_network_state_symlinks(oidentd_t)
-kernel_read_sysctl(oidentd_t)
-# oidentd requests the tcp_diag kernel module, otherwise
-# it will be stuck using the slow /proc/net/tcp interface
-kernel_request_load_module(oidentd_t)
+auth_use_nsswitch(oidentd_t)
 
 logging_send_syslog_msg(oidentd_t)
 
 miscfiles_read_localization(oidentd_t)
 
-sysnet_read_config(oidentd_t)
-
-oident_read_user_content(oidentd_t)
-
-optional_policy(`
-	nis_use_ypbind(oidentd_t)
-')
+userdom_search_user_home_dirs(oidentd_t)
 
-tunable_policy(`use_samba_home_dirs', `
+tunable_policy(`use_samba_home_dirs',`
 	fs_list_cifs(oidentd_t)
  	fs_read_cifs_files(oidentd_t)
 ')
 
-tunable_policy(`use_nfs_home_dirs', `
+tunable_policy(`use_nfs_home_dirs',`
 	fs_list_nfs(oidentd_t)
  	fs_read_nfs_files(oidentd_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/openca.fc refpolicy/policy/modules/contrib/openca.fc
--- refpolicy/policy/modules/contrib/openca.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/openca.fc	2012-10-17 19:37:36.426198632 +0200
@@ -1,9 +1,9 @@
-/etc/openca(/.*)?			gen_context(system_u:object_r:openca_etc_t,s0)
-/etc/openca/.*\.in(/.*)?		gen_context(system_u:object_r:openca_etc_in_t,s0)
-/etc/openca/rbac(/.*)?			gen_context(system_u:object_r:openca_etc_writeable_t,s0)
+/etc/openca(/.*)?	gen_context(system_u:object_r:openca_etc_t,s0)
+/etc/openca/.*\.in(/.*)?	gen_context(system_u:object_r:openca_etc_in_t,s0)
+/etc/openca/rbac(/.*)?	gen_context(system_u:object_r:openca_etc_writeable_t,s0)
 
-/usr/share/openca(/.*)?			gen_context(system_u:object_r:openca_usr_share_t,s0)
-/usr/share/openca/cgi-bin/ca/.+ --	gen_context(system_u:object_r:openca_ca_exec_t,s0)
+/usr/share/openca(/.*)?	gen_context(system_u:object_r:openca_usr_share_t,s0)
+/usr/share/openca/cgi-bin/ca/.+	--	gen_context(system_u:object_r:openca_ca_exec_t,s0)
 
-/var/lib/openca(/.*)?			gen_context(system_u:object_r:openca_var_lib_t,s0)
+/var/lib/openca(/.*)?	gen_context(system_u:object_r:openca_var_lib_t,s0)
 /var/lib/openca/crypto/keys(/.*)?	gen_context(system_u:object_r:openca_var_lib_keys_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/openca.if refpolicy/policy/modules/contrib/openca.if
--- refpolicy/policy/modules/contrib/openca.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/openca.if	2012-10-17 19:37:38.622198635 +0200
@@ -1,8 +1,8 @@
-## <summary>OpenCA - Open Certificate Authority</summary>
+## <summary>Open Certificate Authority.</summary>
 
 ########################################
 ## <summary>
-##	Execute the OpenCA program with
+##	Execute the openca with
 ##	a domain transition.
 ## </summary>
 ## <param name="domain">
@@ -16,14 +16,14 @@
 		type openca_ca_t, openca_ca_exec_t, openca_usr_share_t;
 	')
 
-	domtrans_pattern($1, openca_ca_exec_t, openca_ca_t)
-	allow $1 openca_usr_share_t:dir search_dir_perms;
 	files_search_usr($1)
+	allow $1 openca_usr_share_t:dir search_dir_perms;
+	domtrans_pattern($1, openca_ca_exec_t, openca_ca_t)
 ')
 
 ########################################
 ## <summary>
-##	Send OpenCA generic signals.
+##	Send generic signals to openca.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -41,7 +41,7 @@
 
 ########################################
 ## <summary>
-##	Send OpenCA stop signals.
+##	Send stop signals to openca.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -59,7 +59,7 @@
 
 ########################################
 ## <summary>
-##	Kill OpenCA.
+##	Send kill signals to openca.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/openca.te refpolicy/policy/modules/contrib/openca.te
--- refpolicy/policy/modules/contrib/openca.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/openca.te	2012-10-17 19:37:38.622198635 +0200
@@ -1,4 +1,4 @@
-policy_module(openca, 1.2.0)
+policy_module(openca, 1.2.1)
 
 ########################################
 #
@@ -11,31 +11,21 @@
 domain_entry_file(openca_ca_t, openca_ca_exec_t)
 role system_r types openca_ca_t;
 
-# cjp: seems like some of these types
-# can be removed and replaced with generic
-# etc or usr files.
-
-# /etc/openca standard files
 type openca_etc_t;
 files_config_file(openca_etc_t)
 
-# /etc/openca template files
 type openca_etc_in_t;
 files_type(openca_etc_in_t)
 
-# /etc/openca writeable (from CGI script) files
 type openca_etc_writeable_t;
 files_type(openca_etc_writeable_t)
 
-# /usr/share/openca/crypto/keys
 type openca_usr_share_t;
 files_type(openca_usr_share_t)
 
-# /var/lib/openca
 type openca_var_lib_t;
 files_type(openca_var_lib_t)
 
-# /var/lib/openca/crypto/keys
 type openca_var_lib_keys_t;
 files_type(openca_var_lib_keys_t)
 
@@ -44,28 +34,23 @@
 # Local policy
 #
 
-# Allow access to other files under /etc/openca
-allow openca_ca_t openca_etc_t:file read_file_perms;
 allow openca_ca_t openca_etc_t:dir list_dir_perms;
+allow openca_ca_t openca_etc_t:file read_file_perms;
+allow openca_ca_t openca_etc_t:lnk_file read_lnk_file_perms;
 
-# Allow access to writeable files under /etc/openca
 manage_dirs_pattern(openca_ca_t, openca_etc_writeable_t, openca_etc_writeable_t)
 manage_files_pattern(openca_ca_t, openca_etc_writeable_t, openca_etc_writeable_t)
 
-# Allow access to other /var/lib/openca files
 manage_dirs_pattern(openca_ca_t, openca_var_lib_t, openca_var_lib_t)
 manage_files_pattern(openca_ca_t, openca_var_lib_t, openca_var_lib_t)
 
-# Allow access to private CA key
 manage_dirs_pattern(openca_ca_t, openca_var_lib_keys_t, openca_var_lib_keys_t)
 manage_files_pattern(openca_ca_t, openca_var_lib_keys_t, openca_var_lib_keys_t)
 
-# Allow access to other /usr/share/openca files
-read_files_pattern(openca_ca_t, openca_usr_share_t, openca_usr_share_t)
-read_lnk_files_pattern(openca_ca_t, openca_usr_share_t, openca_usr_share_t)
 allow openca_ca_t openca_usr_share_t:dir list_dir_perms;
+allow openca_ca_t openca_usr_share_t:file read_file_perms;
+allow openca_ca_t openca_usr_share_t:lnk_file read_lnk_file_perms;
 
-# the perl executable will be able to run a perl script
 corecmd_exec_bin(openca_ca_t)
 
 dev_read_rand(openca_ca_t)
@@ -78,5 +63,4 @@
 libs_exec_lib_files(openca_ca_t)
 
 apache_append_log(openca_ca_t)
-# Allow the script to return its output
 apache_rw_cache_files(openca_ca_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/openct.fc refpolicy/policy/modules/contrib/openct.fc
--- refpolicy/policy/modules/contrib/openct.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/openct.fc	2012-10-17 19:38:27.230198740 +0200
@@ -1,10 +1,6 @@
-#
-# /usr
-#
-/usr/sbin/ifdhandler		--	gen_context(system_u:object_r:openct_exec_t,s0)
+/etc/rc\.d/init\.d/openct	--	gen_context(system_u:object_r:openct_initrc_exec_t,s0)
+
+/usr/sbin/ifdhandler	--	gen_context(system_u:object_r:openct_exec_t,s0)
 /usr/sbin/openct-control	--	gen_context(system_u:object_r:openct_exec_t,s0)
 
-#
-# /var
-#
-/var/run/openct(/.*)?		gen_context(system_u:object_r:openct_var_run_t,s0)
+/var/run/openct(/.*)?	gen_context(system_u:object_r:openct_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/openct.if refpolicy/policy/modules/contrib/openct.if
--- refpolicy/policy/modules/contrib/openct.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/openct.if	2012-10-17 19:38:27.230198740 +0200
@@ -2,7 +2,7 @@
 
 ########################################
 ## <summary>
-##	Send openct a null signal.
+##	Send null signals to openct.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -58,7 +58,7 @@
 
 ########################################
 ## <summary>
-##	Read openct PID files.
+##	Read openct pid files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -77,7 +77,8 @@
 
 ########################################
 ## <summary>
-##	Connect to openct over an unix stream socket.
+##	Connect to openct over an unix
+##	domain stream socket.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -93,3 +94,37 @@
 	files_search_pids($1)
 	stream_connect_pattern($1, openct_var_run_t, openct_var_run_t, openct_t)
 ')
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an openct environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`openct_admin',`
+	gen_require(`
+		type openct_t, openct_initrc_exec_t, openct_var_run_t;
+	')
+
+	allow $1 openct_t:process { ptrace signal_perms };
+	ps_process_pattern($1, openct_t)
+
+	init_labeled_script_domtrans($1, openct_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 openct_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	files_search_pids($1)
+	admin_pattern($1, openct_var_run_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/openct.te refpolicy/policy/modules/contrib/openct.te
--- refpolicy/policy/modules/contrib/openct.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/openct.te	2012-10-17 19:38:27.230198740 +0200
@@ -1,4 +1,4 @@
-policy_module(openct, 1.5.0)
+policy_module(openct, 1.5.1)
 
 ########################################
 #
@@ -9,6 +9,9 @@
 type openct_exec_t;
 init_daemon_domain(openct_t, openct_exec_t)
 
+type openct_initrc_exec_t;
+init_script_file(openct_initrc_exec_t)
+
 type openct_var_run_t;
 files_pid_file(openct_var_run_t)
 
@@ -25,19 +28,19 @@
 manage_sock_files_pattern(openct_t, openct_var_run_t, openct_var_run_t)
 files_pid_filetrans(openct_t, openct_var_run_t, { dir file sock_file })
 
+can_exec(openct_t, openct_exec_t)
+
 kernel_read_kernel_sysctls(openct_t)
 kernel_list_proc(openct_t)
 kernel_read_proc_symlinks(openct_t)
 
 dev_read_sysfs(openct_t)
-# openct asks for this
 dev_rw_usbfs(openct_t)
 dev_rw_smartcard(openct_t)
 dev_rw_generic_usb_dev(openct_t)
 
 domain_use_interactive_fds(openct_t)
 
-# openct asks for this
 files_read_etc_files(openct_t)
 
 fs_getattr_all_fs(openct_t)
@@ -50,7 +53,9 @@
 userdom_dontaudit_use_unpriv_user_fds(openct_t)
 userdom_dontaudit_search_user_home_dirs(openct_t)
 
-openct_exec(openct_t)
+optional_policy(`
+	pcscd_stream_connect(openct_t)
+')
 
 optional_policy(`
 	seutil_sigchld_newrole(openct_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/openhpi.fc refpolicy/policy/modules/contrib/openhpi.fc
--- refpolicy/policy/modules/contrib/openhpi.fc	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/openhpi.fc	2012-09-27 20:03:30.720126498 +0200
@@ -0,0 +1,7 @@
+/etc/rc\.d/init\.d/openhpid	--	gen_context(system_u:object_r:openhpid_initrc_exec_t,s0)
+
+/usr/sbin/openhpid	--	gen_context(system_u:object_r:openhpid_exec_t,s0)
+
+/var/lib/openhpi(/.*)?	gen_context(system_u:object_r:openhpid_var_lib_t,s0)
+
+/var/run/openhpid\.pid	--	gen_context(system_u:object_r:openhpid_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/openhpi.if refpolicy/policy/modules/contrib/openhpi.if
--- refpolicy/policy/modules/contrib/openhpi.if	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/openhpi.if	2012-09-27 20:03:30.720126498 +0200
@@ -0,0 +1,39 @@
+## <summary>Open source implementation of the Service Availability Forum Hardware Platform Interface.</summary>
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an openhpi environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`openhpi_admin',`
+	gen_require(`
+		type openhpid_t, openhpid_initrc_exec_t, openhpid_var_lib_t;
+		type openhpid_var_run_t;
+	')
+
+	allow $1 openhpid_t:process { ptrace signal_perms };
+	ps_process_pattern($1, openhpid_t)
+
+	init_labeled_script_domtrans($1, openhpid_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 openhpid_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	files_search_var_lib($1)
+	admin_pattern($1, openhpid_var_lib_t)
+
+	files_search_pids($1)
+	admin_pattern($1, openhpid_var_run_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/openhpi.te refpolicy/policy/modules/contrib/openhpi.te
--- refpolicy/policy/modules/contrib/openhpi.te	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/openhpi.te	2012-09-27 20:03:30.720126498 +0200
@@ -0,0 +1,57 @@
+policy_module(openhpi, 1.0.1)
+
+########################################
+#
+# Declarations
+#
+
+type openhpid_t;
+type openhpid_exec_t;
+init_daemon_domain(openhpid_t, openhpid_exec_t)
+
+type openhpid_initrc_exec_t;
+init_script_file(openhpid_initrc_exec_t)
+
+type openhpid_var_lib_t;
+files_type(openhpid_var_lib_t)
+
+type openhpid_var_run_t;
+files_pid_file(openhpid_var_run_t)
+
+########################################
+#
+# Local policy
+#
+
+allow openhpid_t self:capability kill;
+allow openhpid_t self:process signal;
+allow openhpid_t self:fifo_file rw_fifo_file_perms;
+allow openhpid_t self:netlink_route_socket r_netlink_socket_perms;
+allow openhpid_t self:unix_stream_socket { accept listen };
+allow openhpid_t self:tcp_socket create_stream_socket_perms;
+allow openhpid_t self:udp_socket create_socket_perms;
+
+manage_dirs_pattern(openhpid_t, openhpid_var_lib_t, openhpid_var_lib_t)
+manage_files_pattern(openhpid_t, openhpid_var_lib_t, openhpid_var_lib_t)
+files_var_lib_filetrans(openhpid_t, openhpid_var_lib_t, dir)
+
+manage_files_pattern(openhpid_t, openhpid_var_run_t, openhpid_var_run_t)
+files_pid_filetrans(openhpid_t, openhpid_var_run_t, file)
+
+corenet_all_recvfrom_unlabeled(openhpid_t)
+corenet_all_recvfrom_netlabel(openhpid_t)
+corenet_tcp_sendrecv_generic_if(openhpid_t)
+corenet_tcp_sendrecv_generic_node(openhpid_t)
+corenet_tcp_bind_generic_node(openhpid_t)
+
+corenet_sendrecv_openhpid_server_packets(openhpid_t)
+corenet_tcp_bind_openhpid_port(openhpid_t)
+corenet_tcp_sendrecv_openhpid_port(openhpid_t)
+
+dev_read_urand(openhpid_t)
+
+files_read_etc_files(openhpid_t)
+
+logging_send_syslog_msg(openhpid_t)
+
+miscfiles_read_localization(openhpid_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/openvpn.fc refpolicy/policy/modules/contrib/openvpn.fc
--- refpolicy/policy/modules/contrib/openvpn.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/openvpn.fc	2012-10-17 19:38:31.028198748 +0200
@@ -1,18 +1,11 @@
-#
-# /etc
-#
-/etc/openvpn(/.*)?		gen_context(system_u:object_r:openvpn_etc_t,s0)
+/etc/openvpn(/.*)?	gen_context(system_u:object_r:openvpn_etc_t,s0)
 /etc/openvpn/ipp.txt	--	gen_context(system_u:object_r:openvpn_etc_rw_t,s0)
-/etc/rc\.d/init\.d/openvpn --	gen_context(system_u:object_r:openvpn_initrc_exec_t,s0)
 
-#
-# /usr
-#
+/etc/rc\.d/init\.d/openvpn	--	gen_context(system_u:object_r:openvpn_initrc_exec_t,s0)
+
 /usr/sbin/openvpn	--	gen_context(system_u:object_r:openvpn_exec_t,s0)
 
-#
-# /var
-#
-/var/log/openvpn.*		gen_context(system_u:object_r:openvpn_var_log_t,s0)
-/var/run/openvpn(/.*)?		gen_context(system_u:object_r:openvpn_var_run_t,s0)
-/var/run/openvpn\.client.* --	gen_context(system_u:object_r:openvpn_var_run_t,s0)
+/var/log/openvpn.*	gen_context(system_u:object_r:openvpn_var_log_t,s0)
+
+/var/run/openvpn(/.*)?	gen_context(system_u:object_r:openvpn_var_run_t,s0)
+/var/run/openvpn\.client.*	--	gen_context(system_u:object_r:openvpn_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/openvpn.if refpolicy/policy/modules/contrib/openvpn.if
--- refpolicy/policy/modules/contrib/openvpn.if	2012-05-04 15:16:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/openvpn.if	2012-10-17 19:38:31.028198748 +0200
@@ -1,8 +1,9 @@
-## <summary>full-featured SSL VPN solution</summary>
+## <summary>full-featured SSL VPN solution.</summary>
 
 ########################################
 ## <summary>
-##	Execute OPENVPN clients in the openvpn domain.
+##	Execute openvpn clients in the
+##	openvpn domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -15,13 +16,15 @@
 		type openvpn_t, openvpn_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, openvpn_exec_t, openvpn_t)
 ')
 
 ########################################
 ## <summary>
-##	Execute OPENVPN clients in the openvpn domain, and
-##	allow the specified role the openvpn domain.
+##	Execute openvpn clients in the
+##	openvpn domain, and allow the
+##	specified role the openvpn domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -37,16 +40,16 @@
 #
 interface(`openvpn_run',`
 	gen_require(`
-		type openvpn_t;
+		attribute_role openvpn_roles;
 	')
 
 	openvpn_domtrans($1)
-	role $2 types openvpn_t;
+	roleattribute $2 openvpn_roles;
 ')
 
 ########################################
 ## <summary>
-##	Send OPENVPN clients the kill signal.
+##	Send kill signals to openvpn.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -64,7 +67,7 @@
 
 ########################################
 ## <summary>
-##	Send generic signals to OPENVPN clients.
+##	Send generic signals to openvpn.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -82,7 +85,7 @@
 
 ########################################
 ## <summary>
-##	Send signulls to OPENVPN clients.
+##	Send null signals to openvpn.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -100,8 +103,7 @@
 
 ########################################
 ## <summary>
-##	Allow the specified domain to read
-##	OpenVPN configuration files.
+##	Read openvpn configuration content.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -117,14 +119,14 @@
 
 	files_search_etc($1)
 	allow $1 openvpn_etc_t:dir list_dir_perms;
-	read_files_pattern($1, openvpn_etc_t, openvpn_etc_t)
-	read_lnk_files_pattern($1, openvpn_etc_t, openvpn_etc_t)
+	allow $1 openvpn_etc_t:file read_file_perms;
+	allow $1 openvpn_etc_t:lnk_file read_lnk_file_perms;
 ')
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate 
-##	an openvpn environment
+##	All of the rules required to
+##	administrate an openvpn environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -133,7 +135,7 @@
 ## </param>
 ## <param name="role">
 ##	<summary>
-##	The role to be allowed to manage the openvpn domain.
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <rolecap/>
@@ -141,7 +143,7 @@
 interface(`openvpn_admin',`
 	gen_require(`
 		type openvpn_t, openvpn_etc_t, openvpn_var_log_t;
-		type openvpn_var_run_t, openvpn_initrc_exec_t;
+		type openvpn_var_run_t, openvpn_initrc_exec_t, openvpn_etc_rw_t;
 	')
 
 	allow $1 openvpn_t:process { ptrace signal_perms };
@@ -153,7 +155,7 @@
 	allow $2 system_r;
 
 	files_list_etc($1)
-	admin_pattern($1, openvpn_etc_t)
+	admin_pattern($1, { openvpn_etc_t openvpn_etc_rw_t })
 
 	logging_list_logs($1)
 	admin_pattern($1, openvpn_var_log_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/openvpn.te refpolicy/policy/modules/contrib/openvpn.te
--- refpolicy/policy/modules/contrib/openvpn.te	2012-05-04 15:16:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/openvpn.te	2012-10-17 19:38:31.029198748 +0200
@@ -1,4 +1,4 @@
-policy_module(openvpn, 1.11.0)
+policy_module(openvpn, 1.11.1)
 
 ########################################
 #
@@ -6,18 +6,20 @@
 #
 
 ## <desc>
-## <p>
-## Allow openvpn to read home directories
-## </p>
+##	<p>
+##	Determine whether openvpn can
+##	read generic user home content files.
+##	</p>
 ## </desc>
 gen_tunable(openvpn_enable_homedirs, false)
 
-# main openvpn domain
+attribute_role openvpn_roles;
+
 type openvpn_t;
 type openvpn_exec_t;
 init_daemon_domain(openvpn_t, openvpn_exec_t)
+role openvpn_roles types openvpn_t;
 
-# configuration files
 type openvpn_etc_t;
 files_config_file(openvpn_etc_t)
 
@@ -27,47 +29,50 @@
 type openvpn_initrc_exec_t;
 init_script_file(openvpn_initrc_exec_t)
 
-# log files
 type openvpn_var_log_t;
 logging_log_file(openvpn_var_log_t)
 
-# pid files
 type openvpn_var_run_t;
 files_pid_file(openvpn_var_run_t)
 
 ########################################
 #
-# openvpn local policy
+# Local policy
 #
 
-allow openvpn_t self:capability { dac_read_search dac_override ipc_lock net_bind_service net_admin setgid setuid sys_chroot sys_tty_config };
-allow openvpn_t self:process { signal getsched };
+allow openvpn_t self:capability { dac_read_search dac_override ipc_lock net_bind_service net_admin setgid setuid sys_chroot sys_tty_config sys_nice };
+allow openvpn_t self:process { signal getsched setsched };
 allow openvpn_t self:fifo_file rw_fifo_file_perms;
-
-allow openvpn_t self:unix_dgram_socket { create_socket_perms sendto };
-allow openvpn_t self:unix_stream_socket { create_stream_socket_perms connectto };
-allow openvpn_t self:udp_socket create_socket_perms;
+allow openvpn_t self:unix_dgram_socket sendto;
+allow openvpn_t self:unix_stream_socket { accept connectto listen };
 allow openvpn_t self:tcp_socket server_stream_socket_perms;
-allow openvpn_t self:tun_socket create;
-allow openvpn_t self:netlink_route_socket rw_netlink_socket_perms;
+allow openvpn_t self:tun_socket { create_socket_perms relabelfrom relabelto };
+allow openvpn_t self:netlink_route_socket nlmsg_write;
 
-can_exec(openvpn_t, openvpn_etc_t)
-read_files_pattern(openvpn_t, openvpn_etc_t, openvpn_etc_t)
-read_lnk_files_pattern(openvpn_t, openvpn_etc_t, openvpn_etc_t)
+allow openvpn_t openvpn_etc_t:dir list_dir_perms;
+allow openvpn_t openvpn_etc_t:file read_file_perms;
+allow openvpn_t openvpn_etc_t:lnk_file read_lnk_file_perms;
 
 manage_files_pattern(openvpn_t, openvpn_etc_t, openvpn_etc_rw_t)
 filetrans_pattern(openvpn_t, openvpn_etc_t, openvpn_etc_rw_t, file)
 
-allow openvpn_t openvpn_var_log_t:file manage_file_perms;
+manage_dirs_pattern(openvpn_t, openvpn_var_log_t, openvpn_var_log_t)
+append_files_pattern(openvpn_t, openvpn_var_log_t, openvpn_var_log_t)
+create_files_pattern(openvpn_t, openvpn_var_log_t, openvpn_var_log_t)
+setattr_files_pattern(openvpn_t, openvpn_var_log_t, openvpn_var_log_t)
 logging_log_filetrans(openvpn_t, openvpn_var_log_t, file)
 
+manage_dirs_pattern(openvpn_t, openvpn_var_run_t, openvpn_var_run_t)
 manage_files_pattern(openvpn_t, openvpn_var_run_t, openvpn_var_run_t)
 files_pid_filetrans(openvpn_t, openvpn_var_run_t, { file dir })
 
+can_exec(openvpn_t, openvpn_etc_t)
+
 kernel_read_kernel_sysctls(openvpn_t)
 kernel_read_net_sysctls(openvpn_t)
 kernel_read_network_state(openvpn_t)
 kernel_read_system_state(openvpn_t)
+kernel_request_load_module(openvpn_t)
 
 corecmd_exec_bin(openvpn_t)
 corecmd_exec_shell(openvpn_t)
@@ -78,39 +83,45 @@
 corenet_udp_sendrecv_generic_if(openvpn_t)
 corenet_tcp_sendrecv_generic_node(openvpn_t)
 corenet_udp_sendrecv_generic_node(openvpn_t)
-corenet_tcp_sendrecv_all_ports(openvpn_t)
-corenet_udp_sendrecv_all_ports(openvpn_t)
 corenet_tcp_bind_generic_node(openvpn_t)
 corenet_udp_bind_generic_node(openvpn_t)
+
+corenet_sendrecv_openvpn_server_packets(openvpn_t)
 corenet_tcp_bind_openvpn_port(openvpn_t)
 corenet_udp_bind_openvpn_port(openvpn_t)
-corenet_tcp_bind_http_port(openvpn_t)
+corenet_sendrecv_openvpn_client_packets(openvpn_t)
 corenet_tcp_connect_openvpn_port(openvpn_t)
+corenet_tcp_sendrecv_openvpn_port(openvpn_t)
+corenet_udp_sendrecv_openvpn_port(openvpn_t)
+
+corenet_sendrecv_http_server_packets(openvpn_t)
+corenet_tcp_bind_http_port(openvpn_t)
+corenet_sendrecv_http_client_packets(openvpn_t)
 corenet_tcp_connect_http_port(openvpn_t)
+corenet_tcp_sendrecv_http_port(openvpn_t)
+
+corenet_sendrecv_http_cache_client_packets(openvpn_t)
 corenet_tcp_connect_http_cache_port(openvpn_t)
+corenet_tcp_sendrecv_http_cache_port(openvpn_t)
+
 corenet_rw_tun_tap_dev(openvpn_t)
-corenet_sendrecv_openvpn_server_packets(openvpn_t)
-corenet_sendrecv_openvpn_client_packets(openvpn_t)
-corenet_sendrecv_http_client_packets(openvpn_t)
 
-dev_search_sysfs(openvpn_t)
 dev_read_rand(openvpn_t)
-dev_read_urand(openvpn_t)
 
-files_read_etc_files(openvpn_t)
 files_read_etc_runtime_files(openvpn_t)
 
-auth_use_pam(openvpn_t)
+fs_getattr_all_fs(openvpn_t)
+fs_search_auto_mountpoints(openvpn_t)
 
-logging_send_syslog_msg(openvpn_t)
+auth_use_pam(openvpn_t)
 
 miscfiles_read_localization(openvpn_t)
 miscfiles_read_all_certs(openvpn_t)
 
-sysnet_dns_name_resolve(openvpn_t)
 sysnet_exec_ifconfig(openvpn_t)
 sysnet_manage_config(openvpn_t)
 sysnet_etc_filetrans_config(openvpn_t)
+sysnet_use_ldap(openvpn_t)
 
 userdom_use_user_terminals(openvpn_t)
 
@@ -119,14 +130,12 @@
 ')
 
 tunable_policy(`openvpn_enable_homedirs && use_nfs_home_dirs',`
-        fs_read_nfs_files(openvpn_t)
-        fs_read_nfs_symlinks(openvpn_t)
-')  
+	fs_read_nfs_files(openvpn_t)
+')
 
 tunable_policy(`openvpn_enable_homedirs && use_samba_home_dirs',`
-        fs_read_cifs_files(openvpn_t)
-        fs_read_cifs_symlinks(openvpn_t)
-')  
+	fs_read_cifs_files(openvpn_t)
+')
 
 optional_policy(`
 	daemontools_service_domain(openvpn_t, openvpn_exec_t)
@@ -136,5 +145,7 @@
 	dbus_system_bus_client(openvpn_t)
 	dbus_connect_system_bus(openvpn_t)
 
-	networkmanager_dbus_chat(openvpn_t)
+	optional_policy(`
+		networkmanager_dbus_chat(openvpn_t)
+	')
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/openvswitch.fc refpolicy/policy/modules/contrib/openvswitch.fc
--- refpolicy/policy/modules/contrib/openvswitch.fc	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/openvswitch.fc	2012-11-06 21:18:18.198011531 +0100
@@ -0,0 +1,12 @@
+/etc/rc\.d/init\.d/openvswitch	--	gen_context(system_u:object_r:openvswitch_initrc_exec_t,s0)
+
+/etc/openvswitch(/.*)?	gen_context(system_u:object_r:openvswitch_conf_t,s0)
+
+/usr/share/openvswitch/scripts/ovs-ctl	--	gen_context(system_u:object_r:openvswitch_exec_t,s0)
+/usr/share/openvswitch/scripts/openvswitch\.init	--	gen_context(system_u:object_r:openvswitch_exec_t,s0)
+
+/var/lib/openvswitch(/.*)?	gen_context(system_u:object_r:openvswitch_var_lib_t,s0)
+
+/var/log/openvswitch(/.*)?	gen_context(system_u:object_r:openvswitch_log_t,s0)
+
+/var/run/openvswitch(/.*)?	gen_context(system_u:object_r:openvswitch_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/openvswitch.if refpolicy/policy/modules/contrib/openvswitch.if
--- refpolicy/policy/modules/contrib/openvswitch.if	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/openvswitch.if	2012-11-06 21:18:18.198011531 +0100
@@ -0,0 +1,83 @@
+## <summary>Multilayer virtual switch.</summary>
+
+########################################
+## <summary>
+##	Execute openvswitch in the openvswitch domain.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed to transition.
+##	</summary>
+## </param>
+#
+interface(`openvswitch_domtrans',`
+	gen_require(`
+		type openvswitch_t, openvswitch_exec_t;
+	')
+
+	corecmd_search_bin($1)
+	domtrans_pattern($1, openvswitch_exec_t, openvswitch_t)
+')
+
+########################################
+## <summary>
+##	Read openvswitch pid files.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`openvswitch_read_pid_files',`
+	gen_require(`
+		type openvswitch_var_run_t;
+	')
+
+	files_search_pids($1)
+	read_files_pattern($1, openvswitch_var_run_t, openvswitch_var_run_t)
+')
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an openvswitch environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`openvswitch_admin',`
+	gen_require(`
+		type openvswitch_t, openvswitch_initrc_exec_t, openvswitch_conf_t;
+		type openvswitch_var_lib_t, openvswitch_log_t, openvswitch_var_run_t;
+	')
+
+	allow $1 openvswitch_t:process { ptrace signal_perms };
+	ps_process_pattern($1, openvswitch_t)
+
+	init_labeled_script_domtrans($1, openvswitch_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 openvswitch_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	files_search_etc($1)
+	admin_pattern($1, openvswitch_conf_t)
+
+	files_search_var_lib($1)
+	admin_pattern($1, openvswitch_var_lib_t)
+
+	logging_search_logs($1)
+	admin_pattern($1, openvswitch_log_t)
+
+	files_search_pids($1)
+	admin_pattern($1, openvswitch_var_run_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/openvswitch.te refpolicy/policy/modules/contrib/openvswitch.te
--- refpolicy/policy/modules/contrib/openvswitch.te	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/openvswitch.te	2012-11-06 21:18:18.198011531 +0100
@@ -0,0 +1,88 @@
+policy_module(openvswitch, 1.0.0)
+
+########################################
+#
+# Declarations
+#
+
+type openvswitch_t;
+type openvswitch_exec_t;
+init_daemon_domain(openvswitch_t, openvswitch_exec_t)
+
+type openvswitch_initrc_exec_t;
+init_script_file(openvswitch_initrc_exec_t)
+
+type openvswitch_conf_t;
+files_config_file(openvswitch_conf_t)
+
+type openvswitch_var_lib_t;
+files_type(openvswitch_var_lib_t)
+
+type openvswitch_log_t;
+logging_log_file(openvswitch_log_t)
+
+type openvswitch_var_run_t;
+files_pid_file(openvswitch_var_run_t)
+
+########################################
+#
+# Local policy
+#
+
+allow openvswitch_t self:capability { net_admin sys_nice sys_resource ipc_lock };
+allow openvswitch_t self:process { setrlimit setsched signal };
+allow openvswitch_t self:fifo_file rw_fifo_file_perms;
+allow openvswitch_t self:rawip_socket create_socket_perms;
+allow openvswitch_t self:unix_stream_socket { accept connectto listen };
+
+manage_dirs_pattern(openvswitch_t, openvswitch_conf_t, openvswitch_conf_t)
+manage_files_pattern(openvswitch_t, openvswitch_conf_t, openvswitch_conf_t)
+manage_lnk_files_pattern(openvswitch_t, openvswitch_conf_t, openvswitch_conf_t)
+
+manage_dirs_pattern(openvswitch_t, openvswitch_var_lib_t, openvswitch_var_lib_t)
+manage_files_pattern(openvswitch_t, openvswitch_var_lib_t, openvswitch_var_lib_t)
+manage_lnk_files_pattern(openvswitch_t, openvswitch_var_lib_t, openvswitch_var_lib_t)
+files_var_lib_filetrans(openvswitch_t, openvswitch_var_lib_t, { dir file lnk_file })
+
+manage_dirs_pattern(openvswitch_t, openvswitch_log_t, openvswitch_log_t)
+append_files_pattern(openvswitch_t, openvswitch_log_t, openvswitch_log_t)
+create_files_pattern(openvswitch_t, openvswitch_log_t, openvswitch_log_t)
+setattr_files_pattern(openvswitch_t, openvswitch_log_t, openvswitch_log_t)
+manage_lnk_files_pattern(openvswitch_t, openvswitch_log_t, openvswitch_log_t)
+logging_log_filetrans(openvswitch_t, openvswitch_log_t, { dir file lnk_file })
+
+manage_dirs_pattern(openvswitch_t, openvswitch_var_run_t, openvswitch_var_run_t)
+manage_files_pattern(openvswitch_t, openvswitch_var_run_t, openvswitch_var_run_t)
+manage_sock_files_pattern(openvswitch_t, openvswitch_var_run_t, openvswitch_var_run_t)
+manage_lnk_files_pattern(openvswitch_t, openvswitch_var_run_t, openvswitch_var_run_t)
+files_pid_filetrans(openvswitch_t, openvswitch_var_run_t, { dir file lnk_file })
+
+can_exec(openvswitch_t, openvswitch_exec_t)
+
+kernel_read_network_state(openvswitch_t)
+kernel_read_system_state(openvswitch_t)
+
+corenet_all_recvfrom_unlabeled(openvswitch_t)
+corenet_all_recvfrom_netlabel(openvswitch_t)
+corenet_raw_sendrecv_generic_if(openvswitch_t)
+corenet_raw_sendrecv_generic_node(openvswitch_t)
+
+corecmd_exec_bin(openvswitch_t)
+
+dev_read_urand(openvswitch_t)
+
+domain_use_interactive_fds(openvswitch_t)
+
+files_read_etc_files(openvswitch_t)
+
+fs_getattr_all_fs(openvswitch_t)
+
+logging_send_syslog_msg(openvswitch_t)
+
+miscfiles_read_localization(openvswitch_t)
+
+sysnet_dns_name_resolve(openvswitch_t)
+
+optional_policy(`
+	iptables_domtrans(openvswitch_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/pacemaker.fc refpolicy/policy/modules/contrib/pacemaker.fc
--- refpolicy/policy/modules/contrib/pacemaker.fc	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/pacemaker.fc	2012-10-17 19:37:07.060198569 +0200
@@ -0,0 +1,9 @@
+/etc/rc\.d/init\.d/pacemaker	--	gen_context(system_u:object_r:pacemaker_initrc_exec_t,s0)
+
+/usr/sbin/pacemakerd	--	gen_context(system_u:object_r:pacemaker_exec_t,s0)
+
+/var/lib/heartbeat/crm(/.*)?	gen_context(system_u:object_r:pacemaker_var_lib_t,s0)
+
+/var/lib/pengine(/.*)?	gen_context(system_u:object_r:pacemaker_var_lib_t,s0)
+
+/var/run/crm(/.*)?	gen_context(system_u:object_r:pacemaker_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/pacemaker.if refpolicy/policy/modules/contrib/pacemaker.if
--- refpolicy/policy/modules/contrib/pacemaker.if	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/pacemaker.if	2012-10-17 19:37:07.060198569 +0200
@@ -0,0 +1,39 @@
+## <summary>A scalable high-availability cluster resource manager.</summary>
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an pacemaker environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`pacemaker_admin',`
+	gen_require(`
+		type pacemaker_t, pacemaker_initrc_exec_t, pacemaker_var_lib_t;
+		type pacemaker_var_run_t;
+	')
+
+	allow $1 pacemaker_t:process { ptrace signal_perms };
+	ps_process_pattern($1, pacemaker_t)
+
+	init_labeled_script_domtrans($1, pacemaker_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 pacemaker_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	files_search_var_lib($1)
+	admin_pattern($1, pacemaker_var_lib_t)
+
+	files_search_pids($1)
+	admin_pattern($1, pacemaker_var_run_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/pacemaker.te refpolicy/policy/modules/contrib/pacemaker.te
--- refpolicy/policy/modules/contrib/pacemaker.te	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/pacemaker.te	2012-10-17 19:37:07.060198569 +0200
@@ -0,0 +1,49 @@
+policy_module(pacemaker, 1.0.0)
+
+########################################
+#
+# Declarations
+#
+
+type pacemaker_t;
+type pacemaker_exec_t;
+init_daemon_domain(pacemaker_t, pacemaker_exec_t)
+
+type pacemaker_initrc_exec_t;
+init_script_file(pacemaker_initrc_exec_t)
+
+type pacemaker_var_lib_t;
+files_type(pacemaker_var_lib_t)
+
+type pacemaker_var_run_t;
+files_pid_file(pacemaker_var_run_t)
+
+########################################
+#
+# Local policy
+#
+
+allow pacemaker_t self:capability { chown dac_override setuid };
+allow pacemaker_t self:process { setrlimit signal };
+allow pacemaker_t self:fifo_file rw_fifo_file_perms;
+allow pacemaker_t self:unix_stream_socket { accept listen };
+
+manage_dirs_pattern(pacemaker_t, pacemaker_var_lib_t, pacemaker_var_lib_t)
+manage_files_pattern(pacemaker_t, pacemaker_var_lib_t, pacemaker_var_lib_t)
+files_var_lib_filetrans(pacemaker_t, pacemaker_var_lib_t, { dir file })
+
+manage_dirs_pattern(pacemaker_t, pacemaker_var_run_t, pacemaker_var_run_t)
+manage_files_pattern(pacemaker_t, pacemaker_var_run_t, pacemaker_var_run_t)
+files_pid_filetrans(pacemaker_t, pacemaker_var_run_t, { dir file })
+
+domain_use_interactive_fds(pacemaker_t)
+
+auth_use_nsswitch(pacemaker_t)
+
+logging_send_syslog_msg(pacemaker_t)
+
+miscfiles_read_localization(pacemaker_t)
+
+optional_policy(`
+	corosync_stream_connect(pacemaker_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/pads.fc refpolicy/policy/modules/contrib/pads.fc
--- refpolicy/policy/modules/contrib/pads.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/pads.fc	2012-10-17 19:38:32.512198751 +0200
@@ -1,10 +1,10 @@
-/etc/pads-ether-codes	--	gen_context(system_u:object_r:pads_config_t, s0)
-/etc/pads-signature-list --	gen_context(system_u:object_r:pads_config_t, s0)
-/etc/pads.conf		--	gen_context(system_u:object_r:pads_config_t, s0)
-/etc/pads-assets.csv	--	gen_context(system_u:object_r:pads_config_t, s0)
+/etc/pads-ether-codes	--	gen_context(system_u:object_r:pads_config_t,s0)
+/etc/pads-signature-list	--	gen_context(system_u:object_r:pads_config_t,s0)
+/etc/pads\.conf	--	gen_context(system_u:object_r:pads_config_t,s0)
+/etc/pads-assets\.csv	--	gen_context(system_u:object_r:pads_config_t,s0)
 
-/etc/rc\.d/init\.d/pads --	gen_context(system_u:object_r:pads_initrc_exec_t, s0)
+/etc/rc\.d/init\.d/pads	--	gen_context(system_u:object_r:pads_initrc_exec_t,s0)
 
-/usr/bin/pads		--	gen_context(system_u:object_r:pads_exec_t, s0)
+/usr/bin/pads	--	gen_context(system_u:object_r:pads_exec_t,s0)
 
-/var/run/pads.pid	--	gen_context(system_u:object_r:pads_var_run_t, s0)
+/var/run/pads\.pid	--	gen_context(system_u:object_r:pads_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/pads.if refpolicy/policy/modules/contrib/pads.if
--- refpolicy/policy/modules/contrib/pads.if	2012-05-04 15:16:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/pads.if	2012-10-17 19:38:33.695198754 +0200
@@ -1,17 +1,9 @@
-## <summary>Passive Asset Detection System</summary>
-## <desc>
-##	<p>
-##	PADS is a libpcap based detection engine used to
-##	passively detect network assets.  It is designed to
-##	complement IDS technology by providing context to IDS
-##	alerts.
-##	</p>
-## </desc>
+## <summary>Passive Asset Detection System.</summary>
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate 
-##	an pads environment
+##	All of the rules required to
+##	administrate an pads environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -27,8 +19,8 @@
 #
 interface(`pads_admin', `
 	gen_require(`
-		type pads_t, pads_config_t;
-		type pads_var_run_t, pads_initrc_exec_t;
+		type pads_t, pads_config_t, pads_var_run_t;
+		type pads_initrc_exec_t;
 	')
 
 	allow $1 pads_t:process { ptrace signal_perms };
@@ -39,6 +31,9 @@
 	role_transition $2 pads_initrc_exec_t system_r;
 	allow $2 system_r;
 
+	files_search_pids($1)
 	admin_pattern($1, pads_var_run_t)
+
+	files_search_etc($1)
 	admin_pattern($1, pads_config_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/pads.te refpolicy/policy/modules/contrib/pads.te
--- refpolicy/policy/modules/contrib/pads.te	2012-05-04 15:16:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/pads.te	2012-10-17 19:38:33.695198754 +0200
@@ -1,4 +1,4 @@
-policy_module(pads, 1.0.0) 
+policy_module(pads, 1.0.1)
 
 ########################################
 #
@@ -8,7 +8,7 @@
 type pads_t;
 type pads_exec_t;
 init_daemon_domain(pads_t, pads_exec_t)
-role system_r types pads_t;
+application_executable_file(pads_exec_t)
 
 type pads_initrc_exec_t;
 init_script_file(pads_initrc_exec_t)
@@ -25,10 +25,8 @@
 #
 
 allow pads_t self:capability { dac_override net_raw };
-allow pads_t self:netlink_route_socket { write getattr read bind create nlmsg_read };
-allow pads_t self:packet_socket { ioctl setopt getopt read bind create };
-allow pads_t self:udp_socket { create ioctl };
-allow pads_t self:unix_dgram_socket { write create connect };
+allow pads_t self:packet_socket create_socket_perms;
+allow pads_t self:socket create_socket_perms;
 
 allow pads_t pads_config_t:file manage_file_perms;
 files_etc_filetrans(pads_t, pads_config_t, file)
@@ -37,6 +35,7 @@
 files_pid_filetrans(pads_t, pads_var_run_t, file)
 
 kernel_read_sysctl(pads_t)
+kernel_read_network_state(pads_t)
 
 corecmd_search_bin(pads_t)
 
@@ -44,10 +43,14 @@
 corenet_all_recvfrom_netlabel(pads_t)
 corenet_tcp_sendrecv_generic_if(pads_t)
 corenet_tcp_sendrecv_generic_node(pads_t)
+
+corenet_sendrecv_prelude_client_packets(pads_t)
 corenet_tcp_connect_prelude_port(pads_t)
+corenet_tcp_sendrecv_prelude_port(pads_t)
 
 dev_read_rand(pads_t)
 dev_read_urand(pads_t)
+dev_read_sysfs(pads_t)
 
 files_read_etc_files(pads_t)
 files_search_spool(pads_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/pan.fc refpolicy/policy/modules/contrib/pan.fc
--- refpolicy/policy/modules/contrib/pan.fc	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/pan.fc	2012-05-05 16:11:29.238762618 +0200
@@ -0,0 +1,6 @@
+HOME_DIR/\.pan2(/.*)?		gen_context(system_u:object_r:pan_home_t,s0)
+
+#
+# /usr
+#
+/usr/bin/pan		--	gen_context(system_u:object_r:pan_exec_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/pan.if refpolicy/policy/modules/contrib/pan.if
--- refpolicy/policy/modules/contrib/pan.if	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/pan.if	2012-05-05 16:11:29.252762618 +0200
@@ -0,0 +1,38 @@
+## <summary>Pan news reader client</summary>
+
+########################################
+## <summary>
+##	Role access for pan
+## </summary>
+## <param name="role">
+##	<summary>
+##	Role allowed access
+##	</summary>
+## </param>
+## <param name="domain">
+##	<summary>
+##	User domain for the role
+##	</summary>
+## </param>
+#
+interface(`pan_role',`
+	gen_require(`
+		type pan_t, pan_exec_t, pan_home_t;
+	')
+	role $1 types pan_t;
+
+	allow $2 pan_t:process signal_perms;
+
+	domtrans_pattern($2, pan_exec_t, pan_t)
+
+	ps_process_pattern($2, pan_t)
+
+        manage_dirs_pattern($2, pan_home_t, pan_home_t)
+        manage_files_pattern($2, pan_home_t, pan_home_t)
+        manage_lnk_files_pattern($2, pan_home_t, pan_home_t)
+
+        relabel_dirs_pattern($2, pan_home_t, pan_home_t)
+        relabel_files_pattern($2, pan_home_t, pan_home_t)
+        relabel_lnk_files_pattern($2, pan_home_t, pan_home_t)
+')
+
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/pan.te refpolicy/policy/modules/contrib/pan.te
--- refpolicy/policy/modules/contrib/pan.te	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/pan.te	2012-10-04 20:03:30.380380405 +0200
@@ -0,0 +1,116 @@
+policy_module(pan, 1.0)
+
+########################################
+#
+# Declarations
+#
+
+## <desc>
+## <p>
+##   Be able to manage user files (needed to support sending and downloading
+##   attachments). Without this boolean set, only files marked as pan_home_t
+##   can be used for sending and receiving.
+## </p>
+## </desc>
+gen_tunable(pan_manage_user_content, false)
+
+
+type pan_t;
+type pan_exec_t;
+application_domain(pan_t, pan_exec_t)
+ubac_constrained(pan_t)
+
+type pan_home_t;
+userdom_user_home_content(pan_home_t)
+
+type pan_tmpfs_t;
+files_tmpfs_file(pan_tmpfs_t)
+ubac_constrained(pan_tmpfs_t)
+
+########################################
+#
+# Pan local policy
+#
+allow pan_t self:process { getsched signal };
+allow pan_t self:fifo_file rw_fifo_file_perms;
+allow pan_t pan_tmpfs_t:file { read write };
+
+# Allow pan to work with its ~/.pan2 location
+manage_dirs_pattern(pan_t, pan_home_t, pan_home_t)
+manage_files_pattern(pan_t, pan_home_t, pan_home_t)
+manage_lnk_files_pattern(pan_t, pan_home_t, pan_home_t)
+
+# Support for shared memory
+fs_tmpfs_filetrans(pan_t, pan_tmpfs_t, file)
+
+kernel_dontaudit_read_system_state(pan_t)
+
+corenet_all_recvfrom_netlabel(pan_t)
+corenet_all_recvfrom_unlabeled(pan_t)
+corenet_sendrecv_innd_client_packets(pan_t)
+corenet_tcp_connect_innd_port(pan_t)
+corenet_tcp_sendrecv_generic_if(pan_t)
+corenet_tcp_sendrecv_generic_node(pan_t)
+corenet_tcp_sendrecv_innd_port(pan_t)
+
+domain_dontaudit_use_interactive_fds(pan_t)
+
+files_read_etc_files(pan_t)
+files_read_usr_files(pan_t)
+
+miscfiles_read_localization(pan_t)
+
+sysnet_dns_name_resolve(pan_t)
+
+userdom_dontaudit_use_user_ttys(pan_t)
+userdom_use_user_ptys(pan_t)
+
+xserver_user_x_domain_template(pan, pan_t, pan_tmpfs_t)
+
+tunable_policy(`pan_manage_user_content',`
+	userdom_manage_user_home_content_dirs(pan_t)
+	userdom_manage_user_home_content_files(pan_t)
+')
+
+tunable_policy(`use_nfs_home_dirs',`
+	fs_manage_nfs_dirs(pan_t)
+	fs_manage_nfs_files(pan_t)
+	fs_manage_nfs_symlinks(pan_t)
+')
+
+tunable_policy(`use_samba_home_dirs',`
+	fs_manage_cifs_dirs(pan_t)
+	fs_manage_cifs_files(pan_t)
+	fs_manage_cifs_symlinks(pan_t)
+')
+
+optional_policy(`
+	cups_read_rw_config(pan_t)
+')
+
+optional_policy(`
+	dbus_system_bus_client(pan_t)
+	dbus_all_session_bus_client(pan_t)
+')
+
+optional_policy(`
+	gnome_stream_connect_gconf(pan_t)
+')
+
+optional_policy(`
+	gpg_domtrans(pan_t)
+	gpg_signal(pan_t)
+')
+
+optional_policy(`
+	lpd_domtrans_lpr(pan_t)
+')
+
+optional_policy(`
+	mozilla_read_user_home_files(pan_t)
+	mozilla_domtrans(pan_t)
+')
+
+optional_policy(`
+	xdg_read_generic_data_home_files(pan_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/passenger.fc refpolicy/policy/modules/contrib/passenger.fc
--- refpolicy/policy/modules/contrib/passenger.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/passenger.fc	2012-10-17 19:38:36.044198759 +0200
@@ -1,11 +1,11 @@
-/usr/lib/ruby/gems/.*/passenger-.*/ext/apache2/ApplicationPoolServerExecutable	-- 	gen_context(system_u:object_r:passenger_exec_t,s0)
-/usr/lib/ruby/gems/.*/passenger-.*/agents/PassengerWatchdog 			-- 	gen_context(system_u:object_r:passenger_exec_t,s0)
-/usr/lib/ruby/gems/.*/passenger-.*/agents/PassengerLoggingAgent			-- 	gen_context(system_u:object_r:passenger_exec_t,s0)
-/usr/lib/ruby/gems/.*/passenger-.*/agents/apache2/PassengerHelperAgent		-- 	gen_context(system_u:object_r:passenger_exec_t,s0)
+/usr/.*/gems/.*/passenger-.*/ext/apache2/ApplicationPoolServerExecutable	--	gen_context(system_u:object_r:passenger_exec_t,s0)
+/usr/.*/gems/.*/passenger-.*/agents/PassengerWatchdog	--	gen_context(system_u:object_r:passenger_exec_t,s0)
+/usr/.*/gems/.*/passenger-.*/agents/PassengerLoggingAgent	--	gen_context(system_u:object_r:passenger_exec_t,s0)
+/usr/.*/gems/.*/passenger-.*/agents/apache2/PassengerHelperAgent	--	gen_context(system_u:object_r:passenger_exec_t,s0)
 
-/var/lib/passenger(/.*)?		gen_context(system_u:object_r:passenger_var_lib_t,s0)
+/var/lib/passenger(/.*)?	gen_context(system_u:object_r:passenger_var_lib_t,s0)
 
-/var/log/passenger(/.*)?		gen_context(system_u:object_r:passenger_log_t,s0)
-/var/log/passenger.*		--	gen_context(system_u:object_r:passenger_log_t,s0)
+/var/log/passenger(/.*)?	gen_context(system_u:object_r:passenger_log_t,s0)
+/var/log/passenger.*	--	gen_context(system_u:object_r:passenger_log_t,s0)
 
-/var/run/passenger(/.*)?		gen_context(system_u:object_r:passenger_var_run_t,s0)
+/var/run/passenger(/.*)?	gen_context(system_u:object_r:passenger_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/passenger.if refpolicy/policy/modules/contrib/passenger.if
--- refpolicy/policy/modules/contrib/passenger.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/passenger.if	2012-10-17 19:38:36.045198759 +0200
@@ -15,12 +15,32 @@
 		type passenger_t, passenger_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, passenger_exec_t, passenger_t)
 ')
 
+######################################
+## <summary>
+##	Execute passenger in the caller domain.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`passenger_exec',`
+	gen_require(`
+		type passenger_exec_t;
+	')
+
+	corecmd_search_bin($1)
+	can_exec($1, passenger_exec_t)
+')
+
 ########################################
 ## <summary>
-##	Read passenger lib files
+##	Read passenger lib files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -33,7 +53,6 @@
 		type passenger_var_lib_t;
 	')
 
-	read_files_pattern($1, passenger_var_lib_t, passenger_var_lib_t)
-	read_lnk_files_pattern($1, passenger_var_lib_t, passenger_var_lib_t)
 	files_search_var_lib($1)
+	read_files_pattern($1, passenger_var_lib_t, passenger_var_lib_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/passenger.te refpolicy/policy/modules/contrib/passenger.te
--- refpolicy/policy/modules/contrib/passenger.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/passenger.te	2012-10-17 19:38:36.045198759 +0200
@@ -1,4 +1,4 @@
-policy_module(passanger, 1.0.0)
+policy_module(passanger, 1.0.1)
 
 ########################################
 #
@@ -14,9 +14,6 @@
 type passenger_log_t;
 logging_log_file(passenger_log_t)
 
-type passenger_tmp_t;
-files_tmp_file(passenger_tmp_t)
-
 type passenger_var_lib_t;
 files_type(passenger_var_lib_t)
 
@@ -25,23 +22,22 @@
 
 ########################################
 #
-# passanger local policy
+# Local policy
 #
 
-allow passenger_t self:capability { chown dac_override fsetid fowner kill setuid setgid sys_nice };
+allow passenger_t self:capability { chown dac_override fsetid fowner kill setuid setgid sys_nice sys_ptrace sys_resource };
 allow passenger_t self:process { setpgid setsched sigkill signal };
 allow passenger_t self:fifo_file rw_fifo_file_perms;
-allow passenger_t self:unix_stream_socket { create_stream_socket_perms connectto };
-
-can_exec(passenger_t, passenger_exec_t)
+allow passenger_t self:unix_stream_socket { accept connectto listen };
 
 manage_dirs_pattern(passenger_t, passenger_log_t, passenger_log_t)
-manage_files_pattern(passenger_t, passenger_log_t, passenger_log_t)
+append_files_pattern(passenger_t, passenger_log_t, passenger_log_t)
+create_files_pattern(passenger_t, passenger_log_t, passenger_log_t)
+setattr_files_pattern(passenger_t, passenger_log_t, passenger_log_t)
 logging_log_filetrans(passenger_t, passenger_log_t, file)
 
 manage_dirs_pattern(passenger_t, passenger_var_lib_t, passenger_var_lib_t)
 manage_files_pattern(passenger_t, passenger_var_lib_t, passenger_var_lib_t)
-files_search_var_lib(passenger_t)
 
 manage_dirs_pattern(passenger_t, passenger_var_run_t, passenger_var_run_t)
 manage_files_pattern(passenger_t, passenger_var_run_t, passenger_var_run_t)
@@ -49,6 +45,8 @@
 manage_sock_files_pattern(passenger_t, passenger_var_run_t, passenger_var_run_t)
 files_pid_filetrans(passenger_t, passenger_var_run_t, { file dir sock_file })
 
+can_exec(passenger_t, passenger_exec_t)
+
 kernel_read_system_state(passenger_t)
 kernel_read_kernel_sysctls(passenger_t)
 
@@ -56,17 +54,24 @@
 corenet_all_recvfrom_unlabeled(passenger_t)
 corenet_tcp_sendrecv_generic_if(passenger_t)
 corenet_tcp_sendrecv_generic_node(passenger_t)
+
+corenet_sendrecv_http_client_packets(passenger_t)
 corenet_tcp_connect_http_port(passenger_t)
+corenet_tcp_sendrecv_http_port(passenger_t)
 
 corecmd_exec_bin(passenger_t)
 corecmd_exec_shell(passenger_t)
 
 dev_read_urand(passenger_t)
 
+domain_read_all_domains_state(passenger_t)
+
 files_read_etc_files(passenger_t)
 
 auth_use_nsswitch(passenger_t)
 
+logging_send_syslog_msg(passenger_t)
+
 miscfiles_read_localization(passenger_t)
 
 userdom_dontaudit_use_user_terminals(passenger_t)
@@ -75,3 +80,22 @@
 	apache_append_log(passenger_t)
 	apache_read_sys_content(passenger_t)
 ')
+
+optional_policy(`
+	hostname_exec(passenger_t)
+')
+
+optional_policy(`
+	mta_send_mail(passenger_t)
+')
+
+optional_policy(`
+	puppet_manage_lib_files(passenger_t)
+	puppet_read_config(passenger_t)
+	puppet_read_log_files(passenger_t)
+')
+
+optional_policy(`
+	rpm_exec(passenger_t)
+	rpm_read_db(passenger_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/pcmcia.fc refpolicy/policy/modules/contrib/pcmcia.fc
--- refpolicy/policy/modules/contrib/pcmcia.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/pcmcia.fc	2012-10-17 19:38:40.847198769 +0200
@@ -1,10 +1,12 @@
+/etc/apm/event\.d/pcmcia	--	gen_context(system_u:object_r:cardmgr_exec_t,s0)
 
-/etc/apm/event\.d/pcmcia --	gen_context(system_u:object_r:cardmgr_exec_t,s0)
+/sbin/cardctl	--	gen_context(system_u:object_r:cardctl_exec_t,s0)
+/sbin/cardmgr	--	gen_context(system_u:object_r:cardmgr_exec_t,s0)
 
-/sbin/cardctl		--	gen_context(system_u:object_r:cardctl_exec_t,s0)
-/sbin/cardmgr		--	gen_context(system_u:object_r:cardmgr_exec_t,s0)
+/usr/sbin/cardctl	--	gen_context(system_u:object_r:cardctl_exec_t,s0)
+/usr/sbin/cardmgr	--	gen_context(system_u:object_r:cardmgr_exec_t,s0)
 
-/var/lib/pcmcia(/.*)?		gen_context(system_u:object_r:cardmgr_var_run_t,s0)
+/var/lib/pcmcia(/.*)?	gen_context(system_u:object_r:cardmgr_var_run_t,s0)
 
 /var/run/cardmgr\.pid	--	gen_context(system_u:object_r:cardmgr_var_run_t,s0)
-/var/run/stab		--	gen_context(system_u:object_r:cardmgr_var_run_t,s0)
+/var/run/stab	--	gen_context(system_u:object_r:cardmgr_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/pcmcia.if refpolicy/policy/modules/contrib/pcmcia.if
--- refpolicy/policy/modules/contrib/pcmcia.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/pcmcia.if	2012-10-17 19:38:40.847198769 +0200
@@ -1,4 +1,4 @@
-## <summary>PCMCIA card management services</summary>
+## <summary>PCMCIA card management services.</summary>
 
 ########################################
 ## <summary>
@@ -31,12 +31,13 @@
 		type cardmgr_t, cardmgr_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, cardmgr_exec_t, cardmgr_t)
 ')
 
 ########################################
 ## <summary>
-##	Inherit and use file descriptors from cardmgr.
+##	Inherit and use cardmgr file descriptors.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -67,13 +68,15 @@
 		type cardmgr_t, cardctl_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, cardctl_exec_t, cardmgr_t)
 ')
 
 ########################################
 ## <summary>
-##	Execute cardmgr in the cardctl domain, and
-##	allow the specified role the cardmgr domain.
+##	Execute cardctl in the cardmgr
+##	domain, and allow the specified
+##	role the cardmgr domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -89,11 +92,11 @@
 #
 interface(`pcmcia_run_cardctl',`
 	gen_require(`
-		type cardmgr_t;
+		attribute_role cardmgr_roles;
 	')
 
 	pcmcia_domtrans_cardctl($1)
-	role $2 types cardmgr_t;
+	roleattribute $2 cardmgr_roles;
 ')
 
 ########################################
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/pcmcia.te refpolicy/policy/modules/contrib/pcmcia.te
--- refpolicy/policy/modules/contrib/pcmcia.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/pcmcia.te	2012-10-17 19:38:40.848198769 +0200
@@ -1,16 +1,16 @@
-policy_module(pcmcia, 1.6.0)
+policy_module(pcmcia, 1.6.1)
 
 ########################################
 #
 # Declarations
 #
 
+attribute_role cardmgr_roles;
+
 type cardmgr_t;
 type cardmgr_exec_t;
 init_daemon_domain(cardmgr_t, cardmgr_exec_t)
 
-# Create symbolic links in /dev.
-# cjp: this should probably be eliminated
 type cardmgr_lnk_t;
 files_type(cardmgr_lnk_t)
 
@@ -22,62 +22,54 @@
 
 type cardctl_exec_t;
 application_domain(cardmgr_t, cardctl_exec_t)
+role cardmgr_roles types cardmgr_t;
 
 ########################################
 #
 # Local policy
 #
 
-# Use capabilities (net_admin for route), setuid for cardctl
 allow cardmgr_t self:capability { dac_read_search dac_override setuid net_admin sys_admin sys_nice sys_tty_config mknod };
 dontaudit cardmgr_t self:capability sys_tty_config;
 allow cardmgr_t self:process signal_perms;
 allow cardmgr_t self:fifo_file rw_fifo_file_perms;
-allow cardmgr_t self:unix_dgram_socket create_socket_perms;
-allow cardmgr_t self:unix_stream_socket create_socket_perms;
+allow cardmgr_t self:unix_stream_socket { accept listen };
 
 allow cardmgr_t cardmgr_lnk_t:lnk_file manage_lnk_file_perms;
 dev_filetrans(cardmgr_t, cardmgr_lnk_t, lnk_file)
 
-# Create stab file
 manage_files_pattern(cardmgr_t, cardmgr_var_lib_t, cardmgr_var_lib_t)
 files_var_lib_filetrans(cardmgr_t, cardmgr_var_lib_t, file)
 
 allow cardmgr_t cardmgr_var_run_t:file manage_file_perms;
 files_pid_filetrans(cardmgr_t, cardmgr_var_run_t, file)
 
-kernel_read_system_state(cardmgr_t)
 kernel_read_kernel_sysctls(cardmgr_t)
+kernel_read_system_state(cardmgr_t)
 kernel_dontaudit_getattr_message_if(cardmgr_t)
 
 corecmd_exec_all_executables(cardmgr_t)
 
-dev_read_sysfs(cardmgr_t)
-dev_manage_cardmgr_dev(cardmgr_t)
-dev_filetrans_cardmgr(cardmgr_t)
 dev_getattr_all_chr_files(cardmgr_t)
 dev_getattr_all_blk_files(cardmgr_t)
-# for SSP
+dev_filetrans_cardmgr(cardmgr_t)
+dev_manage_cardmgr_dev(cardmgr_t)
+dev_read_sysfs(cardmgr_t)
 dev_read_urand(cardmgr_t)
 
-domain_use_interactive_fds(cardmgr_t)
-# Read /proc/PID directories for all domains (for fuser).
-domain_read_confined_domains_state(cardmgr_t)
 domain_getattr_confined_domains(cardmgr_t)
+domain_read_confined_domains_state(cardmgr_t)
+domain_use_interactive_fds(cardmgr_t)
 domain_dontaudit_ptrace_confined_domains(cardmgr_t)
-# cjp: these look excessive:
 domain_dontaudit_getattr_all_pipes(cardmgr_t)
 domain_dontaudit_getattr_all_sockets(cardmgr_t)
 
-files_search_kernel_modules(cardmgr_t)
+files_exec_etc_files(cardmgr_t)
 files_list_usr(cardmgr_t)
-files_search_home(cardmgr_t)
 files_read_etc_runtime_files(cardmgr_t)
-files_exec_etc_files(cardmgr_t)
-# for /var/lib/misc/pcmcia-scheme
-# would be better to have it in a different type if I knew how it was created..
 files_read_var_lib_files(cardmgr_t)
-# cjp: these look excessive:
+files_search_kernel_modules(cardmgr_t)
+files_search_home(cardmgr_t)
 files_dontaudit_getattr_all_dirs(cardmgr_t)
 files_dontaudit_getattr_all_files(cardmgr_t)
 files_dontaudit_getattr_all_symlinks(cardmgr_t)
@@ -101,7 +93,6 @@
 modutils_domtrans_insmod(cardmgr_t)
 
 sysnet_domtrans_ifconfig(cardmgr_t)
-# for /etc/resolv.conf
 sysnet_etc_filetrans_config(cardmgr_t)
 sysnet_manage_config(cardmgr_t)
 
@@ -116,7 +107,6 @@
 
 optional_policy(`
 	sysnet_domtrans_dhcpc(cardmgr_t)
-
 	sysnet_read_dhcpc_pid(cardmgr_t)
 	sysnet_delete_dhcpc_pid(cardmgr_t)
 	sysnet_kill_dhcpc(cardmgr_t)
@@ -129,9 +119,3 @@
 optional_policy(`
 	udev_read_db(cardmgr_t)
 ')
-
-# Create device files in /tmp.
-# cjp: why is this created all over the place?
-files_pid_filetrans(cardmgr_t, cardmgr_dev_t, { chr_file blk_file })
-files_tmp_filetrans(cardmgr_t, cardmgr_dev_t, { chr_file blk_file })
-filetrans_pattern(cardmgr_t, cardmgr_var_run_t, cardmgr_dev_t, { chr_file blk_file })
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/pcscd.fc refpolicy/policy/modules/contrib/pcscd.fc
--- refpolicy/policy/modules/contrib/pcscd.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/pcscd.fc	2012-10-17 19:38:45.941198780 +0200
@@ -1,6 +1,9 @@
+/etc/rc\.d/init\.d/pcscd	--	gen_context(system_u:object_r:pcscd_initrc_exec_t,s0)
+
+/usr/sbin/pcscd	--	gen_context(system_u:object_r:pcscd_exec_t,s0)
+
 /var/run/pcscd\.comm	-s	gen_context(system_u:object_r:pcscd_var_run_t,s0)
+/var/run/pcscd(/.*)?	gen_context(system_u:object_r:pcscd_var_run_t,s0)
 /var/run/pcscd\.pid	--	gen_context(system_u:object_r:pcscd_var_run_t,s0)
 /var/run/pcscd\.pub	--	gen_context(system_u:object_r:pcscd_var_run_t,s0)
 /var/run/pcscd\.events(/.*)?	gen_context(system_u:object_r:pcscd_var_run_t,s0)
-
-/usr/sbin/pcscd		--	gen_context(system_u:object_r:pcscd_exec_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/pcscd.if refpolicy/policy/modules/contrib/pcscd.if
--- refpolicy/policy/modules/contrib/pcscd.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/pcscd.if	2012-10-17 19:38:45.941198780 +0200
@@ -1,13 +1,13 @@
-## <summary>PCSC smart card service</summary>
+## <summary>PCSC smart card service.</summary>
 
 ########################################
 ## <summary>
 ##	Execute a domain transition to run pcscd.
 ## </summary>
 ## <param name="domain">
-## <summary>
+##	<summary>
 ##	Domain allowed to transition.
-## </summary>
+##	</summary>
 ## </param>
 #
 interface(`pcscd_domtrans',`
@@ -15,12 +15,13 @@
 		type pcscd_t, pcscd_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, pcscd_exec_t, pcscd_t)
 ')
 
 ########################################
 ## <summary>
-##	Read pcscd pub files.
+##	Read pcscd pid files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -29,6 +30,21 @@
 ## </param>
 #
 interface(`pcscd_read_pub_files',`
+	refpolicywarn(`$0($*) has been deprecated, use pcscd_read_pid_files() instead.')
+	pcscd_read_pid_files($1)
+')
+
+########################################
+## <summary>
+##	Read pcscd pid files.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`pcscd_read_pid_files',`
 	gen_require(`
 		type pcscd_var_run_t;
 	')
@@ -39,7 +55,8 @@
 
 ########################################
 ## <summary>
-##	Manage pcscd pub files.
+##	Create, read, write, and delete
+##	pcscd pid files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -48,17 +65,13 @@
 ## </param>
 #
 interface(`pcscd_manage_pub_files',`
-	gen_require(`
-		type pcscd_var_run_t;
-	')
-
-	files_search_pids($1)
-	manage_files_pattern($1, pcscd_var_run_t, pcscd_var_run_t)
+	refpolicywarn(`$0($*) has been deprecated')
 ')
 
 ########################################
 ## <summary>
-##	Manage pcscd pub fifo files.
+##	Create, read, write, and delete
+##	pcscd pid fifo files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -67,29 +80,59 @@
 ## </param>
 #
 interface(`pcscd_manage_pub_pipes',`
+	refpolicywarn(`$0($*) has been deprecated')
+')
+
+########################################
+## <summary>
+##	Connect to pcscd over an unix
+##	domain stream socket.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`pcscd_stream_connect',`
 	gen_require(`
-		type pcscd_var_run_t;
+		type pcscd_t, pcscd_var_run_t;
 	')
 
 	files_search_pids($1)
-	manage_fifo_files_pattern($1, pcscd_var_run_t, pcscd_var_run_t)
+	stream_connect_pattern($1, pcscd_var_run_t, pcscd_var_run_t, pcscd_t)
 ')
 
 ########################################
 ## <summary>
-##	Connect to pcscd over an unix stream socket.
+##	All of the rules required to
+##	administrate an pcscd environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
 ##	Domain allowed access.
 ##	</summary>
 ## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
 #
-interface(`pcscd_stream_connect',`
+interface(`pcscd_admin',`
 	gen_require(`
-		type pcscd_t, pcscd_var_run_t;
+		type pcscd_t, pcscd_initrc_exec_t, pcscd_var_run_t;
 	')
 
+	allow $1 pcscd_t:process { ptrace signal_perms };
+	ps_process_pattern($1, pcscd_t)
+
+	init_labeled_script_domtrans($1, pcscd_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 pcscd_initrc_exec_t system_r;
+	allow $2 system_r;
+
 	files_search_pids($1)
-	stream_connect_pattern($1, pcscd_var_run_t, pcscd_var_run_t, pcscd_t)
+	admin_pattern($1, pcscd_var_run_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/pcscd.te refpolicy/policy/modules/contrib/pcscd.te
--- refpolicy/policy/modules/contrib/pcscd.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/pcscd.te	2012-10-17 19:38:45.941198780 +0200
@@ -1,4 +1,4 @@
-policy_module(pcscd, 1.7.0)
+policy_module(pcscd, 1.7.1)
 
 ########################################
 #
@@ -7,24 +7,25 @@
 
 type pcscd_t;
 type pcscd_exec_t;
-domain_type(pcscd_t)
 init_daemon_domain(pcscd_t, pcscd_exec_t)
 
-# pid files
+type pcscd_initrc_exec_t;
+init_script_file(pcscd_initrc_exec_t)
+
 type pcscd_var_run_t;
 files_pid_file(pcscd_var_run_t)
 
 ########################################
 #
-# pcscd local policy
+# Local policy
 #
 
 allow pcscd_t self:capability { dac_override dac_read_search };
 allow pcscd_t self:process signal;
 allow pcscd_t self:fifo_file rw_fifo_file_perms;
-allow pcscd_t self:unix_stream_socket create_stream_socket_perms;
-allow pcscd_t self:unix_dgram_socket create_socket_perms;
-allow pcscd_t self:tcp_socket create_stream_socket_perms;
+allow pcscd_t self:unix_stream_socket { accept listen };
+allow pcscd_t self:tcp_socket { accept listen };
+allow pcscd_t self:netlink_kobject_uevent_socket create_socket_perms;
 
 manage_dirs_pattern(pcscd_t, pcscd_var_run_t, pcscd_var_run_t)
 manage_files_pattern(pcscd_t, pcscd_var_run_t, pcscd_var_run_t)
@@ -38,8 +39,10 @@
 corenet_all_recvfrom_netlabel(pcscd_t)
 corenet_tcp_sendrecv_generic_if(pcscd_t)
 corenet_tcp_sendrecv_generic_node(pcscd_t)
-corenet_tcp_sendrecv_all_ports(pcscd_t)
+
+corenet_sendrecv_http_client_packets(pcscd_t)
 corenet_tcp_connect_http_port(pcscd_t)
+corenet_tcp_sendrecv_http_port(pcscd_t)
 
 dev_rw_generic_usb_dev(pcscd_t)
 dev_rw_smartcard(pcscd_t)
@@ -77,3 +80,7 @@
 optional_policy(`
 	rpm_use_script_fds(pcscd_t)
 ')
+
+optional_policy(`
+	udev_read_db(pcscd_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/pegasus.fc refpolicy/policy/modules/contrib/pegasus.fc
--- refpolicy/policy/modules/contrib/pegasus.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/pegasus.fc	2012-10-17 19:38:50.169198789 +0200
@@ -1,12 +1,15 @@
-
-/etc/Pegasus(/.*)?			gen_context(system_u:object_r:pegasus_conf_t,s0)
+/etc/Pegasus(/.*)?	gen_context(system_u:object_r:pegasus_conf_t,s0)
 /etc/Pegasus/pegasus_current\.conf	gen_context(system_u:object_r:pegasus_data_t,s0)
 
-/usr/sbin/cimserver		--	gen_context(system_u:object_r:pegasus_exec_t,s0)
-/usr/sbin/init_repository	-- 	gen_context(system_u:object_r:pegasus_exec_t,s0)
+/etc/rc\.d/init\.d/tog-pegasus	--	gen_context(system_u:object_r:pegasus_initrc_exec_t,s0)
+
+/usr/sbin/cimserver	--	gen_context(system_u:object_r:pegasus_exec_t,s0)
+/usr/sbin/init_repository	--	gen_context(system_u:object_r:pegasus_exec_t,s0)
+
+/var/cache/Pegasus(/.*)?	gen_context(system_u:object_r:pegasus_cache_t,s0)
 
-/var/lib/Pegasus(/.*)?			gen_context(system_u:object_r:pegasus_data_t,s0)
+/var/lib/Pegasus(/.*)?	gen_context(system_u:object_r:pegasus_data_t,s0)
 
-/var/run/tog-pegasus(/.*)?		gen_context(system_u:object_r:pegasus_var_run_t,s0)
+/var/run/tog-pegasus(/.*)?	gen_context(system_u:object_r:pegasus_var_run_t,s0)
 
 /usr/share/Pegasus/mof(/.*)?/.*\.mof	gen_context(system_u:object_r:pegasus_mof_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/pegasus.if refpolicy/policy/modules/contrib/pegasus.if
--- refpolicy/policy/modules/contrib/pegasus.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/pegasus.if	2012-10-17 19:38:50.169198789 +0200
@@ -1 +1,52 @@
 ## <summary>The Open Group Pegasus CIM/WBEM Server.</summary>
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an pegasus environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`pegasus_admin',`
+	gen_require(`
+		type pegasus_t, pegasus_initrc_exec_t, pegasus_tmp_t;
+		type pegasus_cache_t, pegasus_data_t, pegasus_conf_t;
+		type pegasus_mof_t, pegasus_var_run_t;
+	')
+
+	allow $1 pegasus_t:process { ptrace signal_perms };
+	ps_process_pattern($1, pegasus_t)
+
+	init_labeled_script_domtrans($1, pegasus_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 pegasus_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	files_search_etc($1)
+	admin_pattern($1, pegasus_conf_t)
+
+	files_search_usr($1)
+	admin_pattern($1, pegasus_mof_t)
+
+	files_search_tmp($1)
+	admin_pattern($1, pegasus_tmp_t)
+
+	files_search_var($1)
+	admin_pattern($1, pegasus_cache_t)
+
+	files_search_var_lib($1)
+	admin_pattern($1, pegasus_data_t)
+
+	files_search_pids($1)
+	admin_pattern($1, pegasus_var_run_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/pegasus.te refpolicy/policy/modules/contrib/pegasus.te
--- refpolicy/policy/modules/contrib/pegasus.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/pegasus.te	2012-10-17 19:38:50.170198789 +0200
@@ -1,4 +1,4 @@
-policy_module(pegasus, 1.8.0)
+policy_module(pegasus, 1.8.1)
 
 ########################################
 #
@@ -9,6 +9,12 @@
 type pegasus_exec_t;
 init_daemon_domain(pegasus_t, pegasus_exec_t)
 
+type pegasus_initrc_exec_t;
+init_script_file(pegasus_initrc_exec_t)
+
+type pegasus_cache_t;
+files_type(pegasus_cache_t)
+
 type pegasus_data_t;
 files_type(pegasus_data_t)
 
@@ -16,7 +22,7 @@
 files_tmp_file(pegasus_tmp_t)
 
 type pegasus_conf_t;
-files_type(pegasus_conf_t)
+files_config_file(pegasus_conf_t)
 
 type pegasus_mof_t;
 files_type(pegasus_mof_t)
@@ -29,42 +35,50 @@
 # Local policy
 #
 
-allow pegasus_t self:capability { chown sys_nice setuid setgid dac_override net_bind_service };
+allow pegasus_t self:capability { chown kill ipc_lock sys_nice setuid setgid dac_override net_bind_service };
 dontaudit pegasus_t self:capability sys_tty_config;
 allow pegasus_t self:process signal;
 allow pegasus_t self:fifo_file rw_fifo_file_perms;
-allow pegasus_t self:unix_dgram_socket create_socket_perms;
-allow pegasus_t self:unix_stream_socket create_stream_socket_perms;
-allow pegasus_t self:tcp_socket create_stream_socket_perms;
+allow pegasus_t self:unix_stream_socket { accept listen };
+allow pegasus_t self:tcp_socket { accept listen };
 
 allow pegasus_t pegasus_conf_t:dir rw_dir_perms;
-allow pegasus_t pegasus_conf_t:file { read_file_perms link unlink };
+allow pegasus_t pegasus_conf_t:file { read_file_perms delete_file_perms rename_file_perms };
 allow pegasus_t pegasus_conf_t:lnk_file read_lnk_file_perms;
 
+manage_dirs_pattern(pegasus_t, pegasus_cache_t, pegasus_cache_t)
+manage_files_pattern(pegasus_t, pegasus_cache_t, pegasus_cache_t)
+manage_lnk_files_pattern(pegasus_t, pegasus_cache_t, pegasus_cache_t)
+files_var_filetrans(pegasus_t, pegasus_cache_t, { dir file lnk_file })
+
 manage_dirs_pattern(pegasus_t, pegasus_data_t, pegasus_data_t)
 manage_files_pattern(pegasus_t, pegasus_data_t, pegasus_data_t)
 manage_lnk_files_pattern(pegasus_t, pegasus_data_t, pegasus_data_t)
-filetrans_pattern(pegasus_t, pegasus_conf_t, pegasus_data_t, { file dir })
-
-can_exec(pegasus_t, pegasus_exec_t)
+filetrans_pattern(pegasus_t, pegasus_conf_t, pegasus_data_t, { dir file })
 
 allow pegasus_t pegasus_mof_t:dir list_dir_perms;
-read_files_pattern(pegasus_t, pegasus_mof_t, pegasus_mof_t)
-read_lnk_files_pattern(pegasus_t, pegasus_mof_t, pegasus_mof_t)
+allow pegasus_t pegasus_mof_t:file read_file_perms;
+allow pegasus_t pegasus_mof_t:lnk_file read_lnk_file_perms;
 
 manage_dirs_pattern(pegasus_t, pegasus_tmp_t, pegasus_tmp_t)
 manage_files_pattern(pegasus_t, pegasus_tmp_t, pegasus_tmp_t)
-files_tmp_filetrans(pegasus_t, pegasus_tmp_t, { file dir })
+files_tmp_filetrans(pegasus_t, pegasus_tmp_t, { dir file })
 
-allow pegasus_t pegasus_var_run_t:sock_file { create setattr unlink };
+manage_dirs_pattern(pegasus_t, pegasus_var_run_t, pegasus_var_run_t)
 manage_files_pattern(pegasus_t, pegasus_var_run_t, pegasus_var_run_t)
-files_pid_filetrans(pegasus_t, pegasus_var_run_t, file)
+manage_sock_files_pattern(pegasus_t, pegasus_var_run_t, pegasus_var_run_t)
+files_pid_filetrans(pegasus_t, pegasus_var_run_t, { dir file sock_file })
+
+can_exec(pegasus_t, pegasus_exec_t)
 
+kernel_read_network_state(pegasus_t)
 kernel_read_kernel_sysctls(pegasus_t)
 kernel_read_fs_sysctls(pegasus_t)
 kernel_read_system_state(pegasus_t)
 kernel_search_vm_sysctl(pegasus_t)
 kernel_read_net_sysctls(pegasus_t)
+kernel_read_xen_state(pegasus_t)
+kernel_write_xen_state(pegasus_t)
 
 corenet_all_recvfrom_unlabeled(pegasus_t)
 corenet_all_recvfrom_netlabel(pegasus_t)
@@ -72,16 +86,21 @@
 corenet_tcp_sendrecv_generic_node(pegasus_t)
 corenet_tcp_sendrecv_all_ports(pegasus_t)
 corenet_tcp_bind_generic_node(pegasus_t)
+
+corenet_sendrecv_pegasus_http_server_packets(pegasus_t)
 corenet_tcp_bind_pegasus_http_port(pegasus_t)
+
+corenet_sendrecv_pegasus_https_server_packets(pegasus_t)
 corenet_tcp_bind_pegasus_https_port(pegasus_t)
+
+corenet_sendrecv_pegasus_http_client_packets(pegasus_t)
 corenet_tcp_connect_pegasus_http_port(pegasus_t)
+
+corenet_sendrecv_pegasus_https_client_packets(pegasus_t)
 corenet_tcp_connect_pegasus_https_port(pegasus_t)
-corenet_tcp_connect_generic_port(pegasus_t)
+
 corenet_sendrecv_generic_client_packets(pegasus_t)
-corenet_sendrecv_pegasus_http_client_packets(pegasus_t)
-corenet_sendrecv_pegasus_http_server_packets(pegasus_t)
-corenet_sendrecv_pegasus_https_client_packets(pegasus_t)
-corenet_sendrecv_pegasus_https_server_packets(pegasus_t)
+corenet_tcp_connect_generic_port(pegasus_t)
 
 corecmd_exec_bin(pegasus_t)
 corecmd_exec_shell(pegasus_t)
@@ -99,13 +118,10 @@
 domain_use_interactive_fds(pegasus_t)
 domain_read_all_domains_state(pegasus_t)
 
-files_read_etc_files(pegasus_t)
 files_list_var_lib(pegasus_t)
 files_read_var_lib_files(pegasus_t)
 files_read_var_lib_symlinks(pegasus_t)
 
-hostname_exec(pegasus_t)
-
 init_rw_utmp(pegasus_t)
 init_stream_connect_script(pegasus_t)
 
@@ -114,25 +130,53 @@
 
 miscfiles_read_localization(pegasus_t)
 
-sysnet_read_config(pegasus_t)
-sysnet_domtrans_ifconfig(pegasus_t)
-
 userdom_dontaudit_use_unpriv_user_fds(pegasus_t)
 userdom_dontaudit_search_user_home_dirs(pegasus_t)
 
 optional_policy(`
+	hostname_exec(pegasus_t)
+')
+
+optional_policy(`
+	lldpad_dgram_send(pegasus_t)
+')
+
+optional_policy(`
 	rpm_exec(pegasus_t)
 ')
 
 optional_policy(`
+	samba_manage_config(pegasus_t)
+')
+
+optional_policy(`
 	seutil_sigchld_newrole(pegasus_t)
 	seutil_dontaudit_read_config(pegasus_t)
 ')
 
 optional_policy(`
+	ssh_exec(pegasus_t)
+')
+
+optional_policy(`
+	sysnet_domtrans_ifconfig(pegasus_t)
+')
+
+optional_policy(`
 	udev_read_db(pegasus_t)
 ')
 
 optional_policy(`
 	unconfined_signull(pegasus_t)
 ')
+
+optional_policy(`
+	virt_domtrans(pegasus_t)
+	virt_stream_connect(pegasus_t)
+	virt_manage_config(pegasus_t)
+')
+
+optional_policy(`
+	xen_stream_connect(pegasus_t)
+	xen_stream_connect_xenstore(pegasus_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/perdition.fc refpolicy/policy/modules/contrib/perdition.fc
--- refpolicy/policy/modules/contrib/perdition.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/perdition.fc	2012-10-17 19:38:52.497198794 +0200
@@ -1,3 +1,7 @@
-/etc/perdition(/.*)?		gen_context(system_u:object_r:perdition_etc_t,s0)
+/etc/rc\.d/init\.d/perdition	--	gen_context(system_u:object_r:perdition_initrc_exec_t,s0)
+
+/etc/perdition(/.*)?	gen_context(system_u:object_r:perdition_etc_t,s0)
 
 /usr/sbin/perdition	--	gen_context(system_u:object_r:perdition_exec_t,s0)
+
+/var/run/perdition\.pid	--	gen_context(system_u:object_r:perdition_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/perdition.if refpolicy/policy/modules/contrib/perdition.if
--- refpolicy/policy/modules/contrib/perdition.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/perdition.if	2012-10-17 19:38:52.497198794 +0200
@@ -1,4 +1,4 @@
-## <summary>Perdition POP and IMAP proxy</summary>
+## <summary>Perdition POP and IMAP proxy.</summary>
 
 ########################################
 ## <summary>
@@ -13,3 +13,41 @@
 interface(`perdition_tcp_connect',`
 	refpolicywarn(`$0($*) has been deprecated.')
 ')
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an perdition environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`perdition_admin',`
+	gen_require(`
+		type perdition_t, perdition_initrc_exec_t, perdition_etc_t;
+		type perdition_var_run_t;
+	')
+
+	allow $1 perdition_t:process { ptrace signal_perms };
+	ps_process_pattern($1, perdition_t)
+
+	init_labeled_script_domtrans($1, perdition_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 perdition_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	files_search_etc($1)
+	admin_pattern($1, perdition_etc_t)
+
+	files_search_pids($1)
+	admin_pattern($1, perdition_var_run_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/perdition.te refpolicy/policy/modules/contrib/perdition.te
--- refpolicy/policy/modules/contrib/perdition.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/perdition.te	2012-10-17 19:38:52.498198794 +0200
@@ -1,4 +1,4 @@
-policy_module(perdition, 1.7.0)
+policy_module(perdition, 1.7.1)
 
 ########################################
 #
@@ -9,6 +9,9 @@
 type perdition_exec_t;
 init_daemon_domain(perdition_t, perdition_exec_t)
 
+type perdition_initrc_exec_t;
+init_script_file(perdition_initrc_exec_t)
+
 type perdition_etc_t;
 files_config_file(perdition_etc_t)
 
@@ -23,11 +26,11 @@
 allow perdition_t self:capability { setgid setuid };
 dontaudit perdition_t self:capability sys_tty_config;
 allow perdition_t self:process signal_perms;
-allow perdition_t self:tcp_socket create_stream_socket_perms;
-allow perdition_t self:udp_socket create_socket_perms;
+allow perdition_t self:tcp_socket { accept listen };
 
+allow perdition_t perdition_etc_t:dir list_dir_perms;
 allow perdition_t perdition_etc_t:file read_file_perms;
-files_search_etc(perdition_t)
+allow perdition_t perdition_etc_t:lnk_file read_lnk_file_perms;
 
 manage_files_pattern(perdition_t, perdition_var_run_t, perdition_var_run_t)
 files_pid_filetrans(perdition_t, perdition_var_run_t, file)
@@ -39,14 +42,13 @@
 corenet_all_recvfrom_unlabeled(perdition_t)
 corenet_all_recvfrom_netlabel(perdition_t)
 corenet_tcp_sendrecv_generic_if(perdition_t)
-corenet_udp_sendrecv_generic_if(perdition_t)
 corenet_tcp_sendrecv_generic_node(perdition_t)
-corenet_udp_sendrecv_generic_node(perdition_t)
 corenet_tcp_sendrecv_all_ports(perdition_t)
-corenet_udp_sendrecv_all_ports(perdition_t)
 corenet_tcp_bind_generic_node(perdition_t)
-corenet_tcp_bind_pop_port(perdition_t)
+
 corenet_sendrecv_pop_server_packets(perdition_t)
+corenet_tcp_bind_pop_port(perdition_t)
+corenet_tcp_sendrecv_pop_port(perdition_t)
 
 dev_read_sysfs(perdition_t)
 
@@ -55,14 +57,12 @@
 fs_getattr_all_fs(perdition_t)
 fs_search_auto_mountpoints(perdition_t)
 
-files_read_etc_files(perdition_t)
+auth_use_nsswitch(perdition_t)
 
 logging_send_syslog_msg(perdition_t)
 
 miscfiles_read_localization(perdition_t)
 
-sysnet_read_config(perdition_t)
-
 userdom_dontaudit_use_unpriv_user_fds(perdition_t)
 userdom_dontaudit_search_user_home_dirs(perdition_t)
 
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/phpfpm.fc refpolicy/policy/modules/contrib/phpfpm.fc
--- refpolicy/policy/modules/contrib/phpfpm.fc	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/phpfpm.fc	2012-09-22 12:36:39.924147202 +0200
@@ -0,0 +1,5 @@
+/usr/lib(64)?/php.*/bin/php-fpm		gen_context(system_u:object_r:phpfpm_exec_t,s0)
+/var/run/php*-fpm/*.sock		gen_context(system_u:object_r:phpfpm_var_run_t,s0)
+
+/var/log/php-fpm.log			gen_context(system_u:object_r:phpfpm_log_t,s0)
+/var/run/php-fpm.pid			gen_context(system_u:object_r:phpfpm_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/phpfpm.if refpolicy/policy/modules/contrib/phpfpm.if
--- refpolicy/policy/modules/contrib/phpfpm.if	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/phpfpm.if	2012-09-22 12:36:39.924147202 +0200
@@ -0,0 +1,48 @@
+## <summary>PHP FastCGI Process Manager</summary>
+
+#################################################
+## <summary>
+## 	Administrate a phpfpm environment
+## </summary>
+## <param name="domain">
+## 	<summary>
+##	Domain allowed access
+##	</summary>
+## </param>
+# 
+interface(`phpfpm_admin',`
+	gen_require(`
+		type phpfpm_t;
+		type phpfpm_log_t, phpfpm_tmp_t, phpfpm_var_run_t;
+	')
+
+	allow $1 phpfpm_t:process { ptrace signal_perms };
+	ps_process_pattern($1, phpfpm_t)
+
+	logging_list_logs($1)
+	admin_pattern($1, phpfpm_log_t)
+
+	files_list_tmp($1)
+	admin_pattern($1, phpfpm_tmp_t)
+
+	files_list_pids($1)
+	admin_pattern($1, phpfpm_var_run_t)
+')
+
+########################################
+## <summary>
+##      Connect to phpfpm using a unix domain stream socket.
+## </summary>
+## <param name="domain">
+##      <summary>
+##      Domain allowed access.
+##      </summary>
+## </param>
+## <rolecap/>
+#
+interface(`phpfpm_stream_connect',`
+	gen_require(`
+		type phpfpm_t, phpfpm_var_run_t;
+	')
+	stream_connect_pattern($1, phpfpm_var_run_t, phpfpm_var_run_t, phpfpm_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/phpfpm.te refpolicy/policy/modules/contrib/phpfpm.te
--- refpolicy/policy/modules/contrib/phpfpm.te	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/phpfpm.te	2012-09-27 20:17:08.792128245 +0200
@@ -0,0 +1,100 @@
+policy_module(phpfpm, 1.1)
+
+#######################################
+#
+# Declarations
+#
+
+## <desc>
+## <p>
+## Allow phpfpm to use LDAP services
+## </p>
+## </desc>
+gen_tunable(phpfpm_use_ldap, false)
+
+type phpfpm_t;
+type phpfpm_exec_t;
+init_daemon_domain(phpfpm_t, phpfpm_exec_t)
+
+type phpfpm_tmp_t;
+files_tmp_file(phpfpm_tmp_t)
+
+type phpfpm_var_run_t;
+files_pid_file(phpfpm_var_run_t)
+
+type phpfpm_log_t;
+logging_log_file(phpfpm_log_t)
+
+#######################################
+#
+# Local policy
+#
+
+
+allow phpfpm_t self:process signal;
+allow phpfpm_t self:capability { setuid setgid kill };
+allow phpfpm_t self:tcp_socket rw_stream_socket_perms;
+allow phpfpm_t self:udp_socket connected_socket_perms;
+allow phpfpm_t self:unix_stream_socket { accept create_stream_socket_perms };
+
+manage_files_pattern(phpfpm_t, phpfpm_log_t, phpfpm_log_t)
+logging_log_filetrans(phpfpm_t, phpfpm_log_t, file)
+
+manage_files_pattern(phpfpm_t, phpfpm_tmp_t, phpfpm_tmp_t)
+manage_dirs_pattern(phpfpm_t, phpfpm_tmp_t, phpfpm_tmp_t)
+files_tmp_filetrans(phpfpm_t, phpfpm_tmp_t, {file dir})
+
+manage_files_pattern(phpfpm_t, phpfpm_var_run_t, phpfpm_var_run_t)
+files_pid_filetrans(phpfpm_t, phpfpm_var_run_t, { file sock_file })
+
+manage_sock_files_pattern(phpfpm_t, phpfpm_var_run_t, phpfpm_var_run_t)
+
+kernel_read_kernel_sysctls(phpfpm_t)
+
+corecmd_read_bin_symlinks(phpfpm_t)
+corecmd_search_bin(phpfpm_t)
+
+corenet_tcp_bind_all_unreserved_ports(phpfpm_t)
+corenet_tcp_bind_generic_node(phpfpm_t)
+corenet_tcp_bind_generic_port(phpfpm_t)
+
+dev_read_rand(phpfpm_t)
+dev_read_urand(phpfpm_t)
+
+files_read_etc_files(phpfpm_t)
+files_read_usr_files(phpfpm_t)
+files_search_var_lib(phpfpm_t)
+
+fs_getattr_xattr_fs(phpfpm_t)
+
+miscfiles_read_localization(phpfpm_t)
+
+sysnet_dns_name_resolve(phpfpm_t)
+sysnet_read_config(phpfpm_t)
+
+userdom_search_user_home_dirs(phpfpm_t)
+
+apache_append_all_ra_content(phpfpm_t)
+apache_manage_all_rw_content(phpfpm_t)
+apache_read_sys_content(phpfpm_t)
+apache_dontaudit_search_modules(phpfpm_t)
+
+optional_policy(`
+	mysql_stream_connect(phpfpm_t)
+	mysql_tcp_connect(phpfpm_t)
+')
+
+optional_policy(`
+	postgresql_stream_connect(phpfpm_t)
+	postgresql_tcp_connect(phpfpm_t)
+')
+
+optional_policy(`
+	snmp_read_snmp_var_lib_files(phpfpm_t)
+')
+
+optional_policy(`
+	tunable_policy(`phpfpm_use_ldap',`
+		sysnet_use_ldap(phpfpm_t)
+	')
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/pingd.fc refpolicy/policy/modules/contrib/pingd.fc
--- refpolicy/policy/modules/contrib/pingd.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/pingd.fc	2012-10-17 19:38:55.029198799 +0200
@@ -1,6 +1,7 @@
-/etc/pingd.conf				--	gen_context(system_u:object_r:pingd_etc_t,s0)
+/etc/pingd\.conf	--	gen_context(system_u:object_r:pingd_etc_t,s0)
+
 /etc/rc\.d/init\.d/whatsup-pingd	--	gen_context(system_u:object_r:pingd_initrc_exec_t,s0)
 
-/usr/lib/pingd(/.*)?				gen_context(system_u:object_r:pingd_modules_t,s0)
+/usr/lib/pingd(/.*)?	gen_context(system_u:object_r:pingd_modules_t,s0)
 
-/usr/sbin/pingd				--	gen_context(system_u:object_r:pingd_exec_t,s0)
+/usr/sbin/pingd	--	gen_context(system_u:object_r:pingd_exec_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/pingd.if refpolicy/policy/modules/contrib/pingd.if
--- refpolicy/policy/modules/contrib/pingd.if	2012-05-04 15:16:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/pingd.if	2012-10-17 19:38:55.030198799 +0200
@@ -1,4 +1,4 @@
-## <summary>Pingd of the Whatsup cluster node up/down detection utility</summary>
+## <summary>Pingd of the Whatsup cluster node up/down detection utility.</summary>
 
 ########################################
 ## <summary>
@@ -15,6 +15,7 @@
 		type pingd_t, pingd_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, pingd_exec_t, pingd_t)
 ')
 
@@ -34,12 +35,13 @@
 	')
 
 	files_search_etc($1)
-	read_files_pattern($1, pingd_etc_t, pingd_etc_t)
+	allow $1 pingd_etc_t:file read_file_perms;
 ')
 
 #######################################
 ## <summary>
-##	Manage pingd etc configuration files.
+##	Create, read, write, and delete
+##	pingd etc configuration files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -53,15 +55,13 @@
 	')
 
 	files_search_etc($1)
-	manage_dirs_pattern($1, pingd_etc_t, pingd_etc_t)
-	manage_files_pattern($1, pingd_etc_t, pingd_etc_t)
-
+	allow $1 pingd_etc_t:file manage_file_perms;
 ')
 
 #######################################
 ## <summary>
-##	All of the rules required to administrate 
-##	an pingd environment
+##	All of the rules required to
+##	administrate an pingd environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -70,15 +70,15 @@
 ## </param>
 ## <param name="role">
 ##	<summary>
-##	The role to be allowed to manage the pingd domain.
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <rolecap/>
 #
 interface(`pingd_admin',`
 	gen_require(`
-		type pingd_t, pingd_etc_t;
-		type pingd_initrc_exec_t, pingd_modules_t;
+		type pingd_t, pingd_etc_t, pingd_modules_t;
+		type pingd_initrc_exec_t;
 	')
 
 	allow $1 pingd_t:process { ptrace signal_perms };
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/pingd.te refpolicy/policy/modules/contrib/pingd.te
--- refpolicy/policy/modules/contrib/pingd.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/pingd.te	2012-10-17 19:38:55.030198799 +0200
@@ -1,4 +1,4 @@
-policy_module(pingd, 1.0.0)
+policy_module(pingd, 1.0.1)
 
 ########################################
 #
@@ -9,33 +9,40 @@
 type pingd_exec_t;
 init_daemon_domain(pingd_t, pingd_exec_t)
 
-# type for config
 type pingd_etc_t;
 files_type(pingd_etc_t)
 
 type pingd_initrc_exec_t;
 init_script_file(pingd_initrc_exec_t)
 
-# type for pingd modules
 type pingd_modules_t;
 files_type(pingd_modules_t)
 
 ########################################
 #
-# pingd local policy
+# Local policy
 #
 
 allow pingd_t self:capability net_raw;
-allow pingd_t self:tcp_socket create_stream_socket_perms;
-allow pingd_t self:rawip_socket { write read create bind };
+allow pingd_t self:tcp_socket { accept listen };
+allow pingd_t self:rawip_socket create_socket_perms;
 
-read_files_pattern(pingd_t, pingd_etc_t, pingd_etc_t)
+allow pingd_t pingd_etc_t:file read_file_perms;
 
 read_files_pattern(pingd_t, pingd_modules_t, pingd_modules_t)
 mmap_files_pattern(pingd_t, pingd_modules_t, pingd_modules_t)
 
+corenet_all_recvfrom_unlabeled(pingd_t)
+corenet_all_recvfrom_netlabel(pingd_t)
+corenet_tcp_sendrecv_generic_if(pingd_t)
+corenet_raw_sendrecv_generic_if(pingd_t)
+corenet_tcp_sendrecv_generic_node(pingd_t)
+corenet_raw_sendrecv_generic_node(pingd_t)
+corenet_tcp_sendrecv_all_ports(pingd_t)
 corenet_raw_bind_generic_node(pingd_t)
 corenet_tcp_bind_generic_node(pingd_t)
+
+corenet_sendrecv_pingd_server_packets(pingd_t)
 corenet_tcp_bind_pingd_port(pingd_t)
 
 auth_use_nsswitch(pingd_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/pkcs.fc refpolicy/policy/modules/contrib/pkcs.fc
--- refpolicy/policy/modules/contrib/pkcs.fc	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/pkcs.fc	2012-09-27 20:03:30.720126498 +0200
@@ -0,0 +1,7 @@
+/etc/rc\.d/init\.d/pkcsslotd	--	gen_context(system_u:object_r:pkcs_slotd_initrc_exec_t,s0)
+
+/usr/sbin/pkcsslotd	--	gen_context(system_u:object_r:pkcs_slotd_exec_t,s0)
+
+/var/lib/opencryptoki(/.*)?	gen_context(system_u:object_r:pkcs_slotd_var_lib_t,s0)
+
+/var/run/pkcsslotd\.pid	--	gen_context(system_u:object_r:pkcs_slotd_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/pkcs.if refpolicy/policy/modules/contrib/pkcs.if
--- refpolicy/policy/modules/contrib/pkcs.if	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/pkcs.if	2012-09-27 20:03:30.720126498 +0200
@@ -0,0 +1,45 @@
+## <summary>Implementations of the Cryptoki specification.</summary>
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an pkcs slotd environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`pkcs_admin_slotd',`
+	gen_require(`
+		type pkcs_slotd_t, pkcs_slotd_initrc_exec_t, pkcs_slotd_var_lib_t;
+		type pkcs_slotd_var_run_t, pkcs_slotd_tmp_t, pkcs_slotd_tmpfs_t;
+	')
+
+	allow $1 pkcs_slotd_t:process { ptrace signal_perms };
+	ps_process_pattern($1, pkcs_slotd_t)
+
+	init_labeled_script_domtrans($1, pkcs_slotd_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 pkcs_slotd_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	files_search_var_lib($1)
+	admin_pattern($1, pkcs_slotd_var_lib_t)
+
+	files_search_pids($1)
+	admin_pattern($1, pkcs_slotd_var_run_t)
+
+	files_search_tmp($1)
+	admin_pattern($1, pkcs_slotd_tmp_t)
+
+	fs_search_tmpfs($1)
+	admin_pattern($1, pkcs_slotd_tmpfs_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/pkcs.te refpolicy/policy/modules/contrib/pkcs.te
--- refpolicy/policy/modules/contrib/pkcs.te	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/pkcs.te	2012-09-27 20:03:30.720126498 +0200
@@ -0,0 +1,58 @@
+policy_module(pkcs, 1.0.0)
+
+########################################
+#
+# Declarations
+#
+
+type pkcs_slotd_t;
+type pkcs_slotd_exec_t;
+init_daemon_domain(pkcs_slotd_t, pkcs_slotd_exec_t)
+
+type pkcs_slotd_initrc_exec_t;
+init_script_file(pkcs_slotd_initrc_exec_t)
+
+type pkcs_slotd_var_lib_t;
+files_type(pkcs_slotd_var_lib_t)
+
+type pkcs_slotd_var_run_t;
+files_pid_file(pkcs_slotd_var_run_t)
+
+type pkcs_slotd_tmp_t;
+files_tmp_file(pkcs_slotd_tmp_t)
+
+type pkcs_slotd_tmpfs_t;
+files_tmpfs_file(pkcs_slotd_tmpfs_t)
+
+########################################
+#
+# Local policy
+#
+
+allow pkcs_slotd_t self:capability kill;
+allow pkcs_slotd_t self:fifo_file rw_fifo_file_perms;
+allow pkcs_slotd_t self:sem create_sem_perms;
+allow pkcs_slotd_t self:shm create_shm_perms;
+allow pkcs_slotd_t self:unix_stream_socket { accept listen };
+
+manage_dirs_pattern(pkcs_slotd_t, pkcs_slotd_var_lib_t, pkcs_slotd_var_lib_t)
+manage_files_pattern(pkcs_slotd_t, pkcs_slotd_var_lib_t, pkcs_slotd_var_lib_t)
+manage_lnk_files_pattern(pkcs_slotd_t, pkcs_slotd_var_lib_t, pkcs_slotd_var_lib_t)
+files_var_lib_filetrans(pkcs_slotd_t, pkcs_slotd_var_lib_t, dir)
+
+manage_files_pattern(pkcs_slotd_t, pkcs_slotd_var_run_t, pkcs_slotd_var_run_t)
+files_pid_filetrans(pkcs_slotd_t, pkcs_slotd_var_run_t, file)
+
+manage_dirs_pattern(pkcs_slotd_t, pkcs_slotd_tmp_t, pkcs_slotd_tmp_t)
+manage_files_pattern(pkcs_slotd_t, pkcs_slotd_tmp_t, pkcs_slotd_tmp_t)
+files_tmp_filetrans(pkcs_slotd_t, pkcs_slotd_tmp_t, dir)
+
+manage_dirs_pattern(pkcs_slotd_t, pkcs_slotd_tmpfs_t, pkcs_slotd_tmpfs_t)
+manage_files_pattern(pkcs_slotd_t, pkcs_slotd_tmpfs_t, pkcs_slotd_tmpfs_t)
+fs_tmpfs_filetrans(pkcs_slotd_t, pkcs_slotd_tmpfs_t, dir)
+
+files_read_etc_files(pkcs_slotd_t)
+
+logging_send_syslog_msg(pkcs_slotd_t)
+
+miscfiles_read_localization(pkcs_slotd_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/plymouthd.fc refpolicy/policy/modules/contrib/plymouthd.fc
--- refpolicy/policy/modules/contrib/plymouthd.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/plymouthd.fc	2012-10-19 09:44:48.805491546 +0200
@@ -1,7 +1,15 @@
-/bin/plymouth			--	gen_context(system_u:object_r:plymouth_exec_t,s0)
+/bin/plymouth	--	gen_context(system_u:object_r:plymouth_exec_t,s0)
 
-/sbin/plymouthd			--	gen_context(system_u:object_r:plymouthd_exec_t,s0)
+/sbin/plymouthd	--	gen_context(system_u:object_r:plymouthd_exec_t,s0)
 
-/var/lib/plymouth(/.*)?			gen_context(system_u:object_r:plymouthd_var_lib_t,s0)
-/var/run/plymouth(/.*)?			gen_context(system_u:object_r:plymouthd_var_run_t,s0)
-/var/spool/plymouth(/.*)?		gen_context(system_u:object_r:plymouthd_spool_t,s0)
+/usr/bin/plymouth	--	gen_context(system_u:object_r:plymouth_exec_t,s0)
+
+/usr/sbin/plymouthd	--	gen_context(system_u:object_r:plymouthd_exec_t,s0)
+
+/var/lib/plymouth(/.*)?	gen_context(system_u:object_r:plymouthd_var_lib_t,s0)
+
+/var/log/boot\.log.*	--	gen_context(system_u:object_r:plymouthd_var_log_t,mls_systemhigh)
+
+/var/run/plymouth(/.*)?	gen_context(system_u:object_r:plymouthd_var_run_t,s0)
+
+/var/spool/plymouth(/.*)?	gen_context(system_u:object_r:plymouthd_spool_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/plymouthd.if refpolicy/policy/modules/contrib/plymouthd.if
--- refpolicy/policy/modules/contrib/plymouthd.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/plymouthd.if	2012-10-17 19:38:56.210198802 +0200
@@ -1,4 +1,4 @@
-## <summary>Plymouth graphical boot</summary>
+## <summary>Plymouth graphical boot.</summary>
 
 ########################################
 ## <summary>
@@ -10,17 +10,18 @@
 ## </summary>
 ## </param>
 #
-interface(`plymouthd_domtrans', `
+interface(`plymouthd_domtrans',`
 	gen_require(`
 		type plymouthd_t, plymouthd_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, plymouthd_exec_t, plymouthd_t)
 ')
 
 ########################################
 ## <summary>
-##	Execute the plymoth daemon in the current domain
+##	Execute plymouthd in the caller domain.
 ## </summary>
 ## <param name="domain">
 ## <summary>
@@ -28,18 +29,19 @@
 ## </summary>
 ## </param>
 #
-interface(`plymouthd_exec', `
+interface(`plymouthd_exec',`
 	gen_require(`
 		type plymouthd_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	can_exec($1, plymouthd_exec_t)
 ')
 
 ########################################
 ## <summary>
-##	Allow domain to Stream socket connect
-##	to Plymouth daemon.
+##	Connect to plymouthd using a unix
+##	domain stream socket.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -47,17 +49,18 @@
 ##	</summary>
 ## </param>
 #
-interface(`plymouthd_stream_connect', `
+interface(`plymouthd_stream_connect',`
 	gen_require(`
-		type plymouthd_t;
+		type plymouthd_t, plymouthd_spool_t;
 	')
 
-	allow $1 plymouthd_t:unix_stream_socket connectto;
+	files_search_spool($1)
+	stream_connect_pattern($1, plymouthd_spool_t, plymouthd_spool_t, plymouthd_t)
 ')
 
 ########################################
 ## <summary>
-##	Execute the plymoth command in the current domain
+##	Execute plymouth in the caller domain.
 ## </summary>
 ## <param name="domain">
 ## <summary>
@@ -65,17 +68,18 @@
 ## </summary>
 ## </param>
 #
-interface(`plymouthd_exec_plymouth', `
+interface(`plymouthd_exec_plymouth',`
 	gen_require(`
 		type plymouth_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	can_exec($1, plymouth_exec_t)
 ')
 
 ########################################
 ## <summary>
-##	Execute a domain transition to run plymouthd.
+##	Execute a domain transition to run plymouth.
 ## </summary>
 ## <param name="domain">
 ## <summary>
@@ -83,11 +87,12 @@
 ## </summary>
 ## </param>
 #
-interface(`plymouthd_domtrans_plymouth', `
+interface(`plymouthd_domtrans_plymouth',`
 	gen_require(`
 		type plymouth_t, plymouth_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, plymouth_exec_t, plymouth_t)
 ')
 
@@ -101,13 +106,13 @@
 ##	</summary>
 ## </param>
 #
-interface(`plymouthd_search_spool', `
+interface(`plymouthd_search_spool',`
 	gen_require(`
 		type plymouthd_spool_t;
 	')
 
-	allow $1 plymouthd_spool_t:dir search_dir_perms;
 	files_search_spool($1)
+	allow $1 plymouthd_spool_t:dir search_dir_perms;
 ')
 
 ########################################
@@ -120,7 +125,7 @@
 ##	</summary>
 ## </param>
 #
-interface(`plymouthd_read_spool_files', `
+interface(`plymouthd_read_spool_files',`
 	gen_require(`
 		type plymouthd_spool_t;
 	')
@@ -140,7 +145,7 @@
 ##	</summary>
 ## </param>
 #
-interface(`plymouthd_manage_spool_files', `
+interface(`plymouthd_manage_spool_files',`
 	gen_require(`
 		type plymouthd_spool_t;
 	')
@@ -159,13 +164,13 @@
 ##	</summary>
 ## </param>
 #
-interface(`plymouthd_search_lib', `
+interface(`plymouthd_search_lib',`
 	gen_require(`
 		type plymouthd_var_lib_t;
 	')
 
-	allow $1 plymouthd_var_lib_t:dir search_dir_perms;
 	files_search_var_lib($1)
+	allow $1 plymouthd_var_lib_t:dir search_dir_perms;
 ')
 
 ########################################
@@ -178,7 +183,7 @@
 ##	</summary>
 ## </param>
 #
-interface(`plymouthd_read_lib_files', `
+interface(`plymouthd_read_lib_files',`
 	gen_require(`
 		type plymouthd_var_lib_t;
 	')
@@ -198,7 +203,7 @@
 ##	</summary>
 ## </param>
 #
-interface(`plymouthd_manage_lib_files', `
+interface(`plymouthd_manage_lib_files',`
 	gen_require(`
 		type plymouthd_var_lib_t;
 	')
@@ -209,7 +214,7 @@
 
 ########################################
 ## <summary>
-##	Read plymouthd PID files.
+##	Read plymouthd pid files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -217,7 +222,7 @@
 ##	</summary>
 ## </param>
 #
-interface(`plymouthd_read_pid_files', `
+interface(`plymouthd_read_pid_files',`
 	gen_require(`
 		type plymouthd_var_run_t;
 	')
@@ -228,8 +233,8 @@
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate
-##	an plymouthd environment
+##	All of the rules required to
+##	administrate an plymouthd environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -243,18 +248,21 @@
 ## </param>
 ## <rolecap/>
 #
-interface(`plymouthd_admin', `
+interface(`plymouthd_admin',`
 	gen_require(`
 		type plymouthd_t, plymouthd_spool_t, plymouthd_var_lib_t;
 		type plymouthd_var_run_t;
 	')
 
-	allow $1 plymouthd_t:process { ptrace signal_perms getattr };
+	allow $1 plymouthd_t:process { ptrace signal_perms };
 	read_files_pattern($1, plymouthd_t, plymouthd_t)
 
+	files_search_spool($1)
 	admin_pattern($1, plymouthd_spool_t)
 
+	files_search_var_lib($1)
 	admin_pattern($1, plymouthd_var_lib_t)
 
+	files_search_pids($1)
 	admin_pattern($1, plymouthd_var_run_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/plymouthd.te refpolicy/policy/modules/contrib/plymouthd.te
--- refpolicy/policy/modules/contrib/plymouthd.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/plymouthd.te	2012-10-22 19:59:01.709013969 +0200
@@ -1,4 +1,4 @@
-policy_module(plymouthd, 1.1.0)
+policy_module(plymouthd, 1.1.4)
 
 ########################################
 #
@@ -8,6 +8,7 @@
 type plymouth_t;
 type plymouth_exec_t;
 application_domain(plymouth_t, plymouth_exec_t)
+role system_r types plymouth_t;
 
 type plymouthd_t;
 type plymouthd_exec_t;
@@ -19,16 +20,20 @@
 type plymouthd_var_lib_t;
 files_type(plymouthd_var_lib_t)
 
+type plymouthd_var_log_t;
+logging_log_file(plymouthd_var_log_t)
+
 type plymouthd_var_run_t;
 files_pid_file(plymouthd_var_run_t)
 
 ########################################
 #
-# Plymouthd private policy
+# Daemon local policy
 #
 
 allow plymouthd_t self:capability { sys_admin sys_tty_config };
 dontaudit plymouthd_t self:capability dac_override;
+allow plymouthd_t self:capability2 block_suspend;
 allow plymouthd_t self:process { signal getsched };
 allow plymouthd_t self:fifo_file rw_fifo_file_perms;
 allow plymouthd_t self:unix_stream_socket create_stream_socket_perms;
@@ -42,6 +47,12 @@
 manage_files_pattern(plymouthd_t, plymouthd_var_lib_t, plymouthd_var_lib_t)
 files_var_lib_filetrans(plymouthd_t, plymouthd_var_lib_t, { file dir })
 
+manage_dirs_pattern(plymouthd_t, plymouthd_var_log_t, plymouthd_var_log_t)
+append_files_pattern(plymouthd_t, plymouthd_var_log_t, plymouthd_var_log_t)
+create_files_pattern(plymouthd_t, plymouthd_var_log_t, plymouthd_var_log_t)
+setattr_files_pattern(plymouthd_t, plymouthd_var_log_t, plymouthd_var_log_t)
+logging_log_filetrans(plymouthd_t, plymouthd_var_log_t, { file dir })
+
 manage_dirs_pattern(plymouthd_t, plymouthd_var_run_t, plymouthd_var_run_t)
 manage_files_pattern(plymouthd_t, plymouthd_var_run_t, plymouthd_var_run_t)
 files_pid_filetrans(plymouthd_t, plymouthd_var_run_t, { file dir })
@@ -57,23 +68,45 @@
 
 domain_use_interactive_fds(plymouthd_t)
 
+fs_getattr_all_fs(plymouthd_t)
+
 files_read_etc_files(plymouthd_t)
 files_read_usr_files(plymouthd_t)
 
+term_getattr_pty_fs(plymouthd_t)
+term_use_all_terms(plymouthd_t)
+term_use_ptmx(plymouthd_t)
+
 miscfiles_read_localization(plymouthd_t)
 miscfiles_read_fonts(plymouthd_t)
 miscfiles_manage_fonts_cache(plymouthd_t)
 
+optional_policy(`
+	gnome_read_generic_home_content(plymouthd_t)
+')
+
+optional_policy(`
+	sssd_stream_connect(plymouthd_t)
+')
+
+optional_policy(`
+	xserver_manage_xdm_spool_files(plymouthd_t)
+	xserver_read_xdm_state(plymouthd_t)
+')
+
 ########################################
 #
-# Plymouth private policy
+# Client local policy
 #
 
 allow plymouth_t self:process signal;
-allow plymouth_t self:fifo_file rw_file_perms;
+allow plymouth_t self:fifo_file rw_fifo_file_perms;
 allow plymouth_t self:unix_stream_socket create_stream_socket_perms;
 
+stream_connect_pattern(plymouth_t, plymouthd_spool_t, plymouthd_spool_t, plymouthd_t)
+
 kernel_read_system_state(plymouth_t)
+kernel_stream_connect(plymouth_t)
 
 domain_use_interactive_fds(plymouth_t)
 
@@ -85,9 +118,7 @@
 
 sysnet_read_config(plymouth_t)
 
-plymouthd_stream_connect(plymouth_t)
-
-ifdef(`hide_broken_symptoms', `
+ifdef(`hide_broken_symptoms',`
 	optional_policy(`
 		hal_dontaudit_write_log(plymouth_t)
 		hal_dontaudit_rw_pipes(plymouth_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/podsleuth.fc refpolicy/policy/modules/contrib/podsleuth.fc
--- refpolicy/policy/modules/contrib/podsleuth.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/podsleuth.fc	2012-10-19 09:44:53.271491556 +0200
@@ -1,3 +1,5 @@
 /usr/bin/podsleuth	--	gen_context(system_u:object_r:podsleuth_exec_t,s0)
-/usr/libexec/hal-podsleuth --	gen_context(system_u:object_r:podsleuth_exec_t,s0)
+
+/usr/libexec/hal-podsleuth	--	gen_context(system_u:object_r:podsleuth_exec_t,s0)
+
 /var/cache/podsleuth(/.*)?	gen_context(system_u:object_r:podsleuth_cache_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/podsleuth.if refpolicy/policy/modules/contrib/podsleuth.if
--- refpolicy/policy/modules/contrib/podsleuth.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/podsleuth.if	2012-10-19 09:44:53.271491556 +0200
@@ -1,4 +1,4 @@
-## <summary>Podsleuth is a tool to get information about an Apple (TM) iPod (TM)</summary>
+## <summary>Podsleuth is a tool to get information about an Apple (TM) iPod (TM).</summary>
 
 ########################################
 ## <summary>
@@ -15,14 +15,15 @@
 		type podsleuth_t, podsleuth_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, podsleuth_exec_t, podsleuth_t)
-	allow $1 podsleuth_t:process signal;
 ')
 
 ########################################
 ## <summary>
-##	Execute podsleuth in the podsleuth domain, and
-##	allow the specified role the podsleuth domain.
+##	Execute podsleuth in the podsleuth
+##	domain, and allow the specified role
+##	the podsleuth domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -37,9 +38,9 @@
 #
 interface(`podsleuth_run',`
 	gen_require(`
-		type podsleuth_t;
+		attribute_role podsleuth_roles;
 	')
 
 	podsleuth_domtrans($1)
-	role $2 types podsleuth_t;
+	roleattribute $2 podsleuth_roles;
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/podsleuth.te refpolicy/policy/modules/contrib/podsleuth.te
--- refpolicy/policy/modules/contrib/podsleuth.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/podsleuth.te	2012-10-19 09:44:53.271491556 +0200
@@ -1,14 +1,17 @@
-policy_module(podsleuth, 1.6.0)
+policy_module(podsleuth, 1.6.1)
 
 ########################################
 #
 # Declarations
 #
 
+attribute_role podsleuth_roles;
+roleattribute system_r podsleuth_roles;
+
 type podsleuth_t;
 type podsleuth_exec_t;
 application_domain(podsleuth_t, podsleuth_exec_t)
-role system_r types podsleuth_t;
+role podsleuth_roles types podsleuth_t;
 
 type podsleuth_cache_t;
 files_type(podsleuth_cache_t)
@@ -22,15 +25,15 @@
 
 ########################################
 #
-# podsleuth local policy
+# Local policy
 #
+
 allow podsleuth_t self:capability { kill dac_override sys_admin sys_rawio };
 allow podsleuth_t self:process { ptrace signal signull getsched execheap execmem execstack };
-allow podsleuth_t self:fifo_file rw_file_perms;
+allow podsleuth_t self:fifo_file rw_fifo_file_perms;
 allow podsleuth_t self:unix_stream_socket create_stream_socket_perms;
 allow podsleuth_t self:sem create_sem_perms;
-allow podsleuth_t self:tcp_socket create_stream_socket_perms;
-allow podsleuth_t self:udp_socket create_socket_perms;
+allow podsleuth_t self:tcp_socket { accept listen };
 
 manage_dirs_pattern(podsleuth_t, podsleuth_cache_t, podsleuth_cache_t)
 manage_files_pattern(podsleuth_t, podsleuth_cache_t, podsleuth_cache_t)
@@ -51,7 +54,14 @@
 
 corecmd_exec_bin(podsleuth_t)
 
+corenet_all_recvfrom_unlabeled(podsleuth_t)
+corenet_all_recvfrom_netlabel(podsleuth_t)
+corenet_tcp_sendrecv_generic_if(podsleuth_t)
+corenet_tcp_sendrecv_generic_node(podsleuth_t)
+
+corenet_sendrecv_http_client_packets(podsleuth_t)
 corenet_tcp_connect_http_port(podsleuth_t)
+corenet_tcp_sendrecv_http_port(podsleuth_t)
 
 dev_read_urand(podsleuth_t)
 
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/policykit.fc refpolicy/policy/modules/contrib/policykit.fc
--- refpolicy/policy/modules/contrib/policykit.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/policykit.fc	2012-10-19 09:45:00.025491570 +0200
@@ -1,16 +1,22 @@
-/usr/lib/policykit/polkit-read-auth-helper --	gen_context(system_u:object_r:policykit_auth_exec_t,s0)
-/usr/lib/policykit/polkit-grant-helper.* --	gen_context(system_u:object_r:policykit_grant_exec_t,s0)
-/usr/lib/policykit/polkit-resolve-exe-helper.* -- gen_context(system_u:object_r:policykit_resolve_exec_t,s0)
-/usr/lib/policykit/polkitd		--	gen_context(system_u:object_r:policykit_exec_t,s0)
-/usr/lib/policykit-1/polkitd		--	gen_context(system_u:object_r:policykit_exec_t,s0)
+/usr/lib/polkit-1/polkitd	--	gen_context(system_u:object_r:policykit_exec_t,s0)
+/usr/lib/polkit-1/polkit-agent-helper-1	--	gen_context(system_u:object_r:policykit_auth_exec_t,s0)
+
+/usr/lib/policykit/polkit-read-auth-helper	--	gen_context(system_u:object_r:policykit_auth_exec_t,s0)
+/usr/lib/policykit/polkit-grant-helper.*	--	gen_context(system_u:object_r:policykit_grant_exec_t,s0)
+/usr/lib/policykit/polkit-resolve-exe-helper.*	--	gen_context(system_u:object_r:policykit_resolve_exec_t,s0)
+/usr/lib/policykit/polkitd	--	gen_context(system_u:object_r:policykit_exec_t,s0)
+/usr/lib/policykit-1/polkitd	--	gen_context(system_u:object_r:policykit_exec_t,s0)
 
 /usr/libexec/polkit-read-auth-helper	--	gen_context(system_u:object_r:policykit_auth_exec_t,s0)
 /usr/libexec/polkit-grant-helper.*	--	gen_context(system_u:object_r:policykit_grant_exec_t,s0)
-/usr/libexec/polkit-resolve-exe-helper.* --	gen_context(system_u:object_r:policykit_resolve_exec_t,s0)
-/usr/libexec/polkitd			--	gen_context(system_u:object_r:policykit_exec_t,s0)
+/usr/libexec/polkit-resolve-exe-helper.*	--	gen_context(system_u:object_r:policykit_resolve_exec_t,s0)
+/usr/libexec/polkitd.*	--	gen_context(system_u:object_r:policykit_exec_t,s0)
+/usr/libexec/polkit-1/polkit-agent-helper-1	--	gen_context(system_u:object_r:policykit_auth_exec_t,s0)
+/usr/libexec/polkit-1/polkitd.*	--	gen_context(system_u:object_r:policykit_exec_t,s0)
 
-/var/lib/misc/PolicyKit.reload			gen_context(system_u:object_r:policykit_reload_t,s0)
-/var/lib/PolicyKit(/.*)?			gen_context(system_u:object_r:policykit_var_lib_t,s0)
-/var/lib/PolicyKit-public(/.*)?			gen_context(system_u:object_r:policykit_var_lib_t,s0)
-/var/run/PolicyKit(/.*)?			gen_context(system_u:object_r:policykit_var_run_t,s0)
+/var/lib/misc/PolicyKit.reload	gen_context(system_u:object_r:policykit_reload_t,s0)
+/var/lib/PolicyKit(/.*)?	gen_context(system_u:object_r:policykit_var_lib_t,s0)
+/var/lib/polkit-1(/.*)?	gen_context(system_u:object_r:policykit_var_lib_t,s0)
+/var/lib/PolicyKit-public(/.*)?	gen_context(system_u:object_r:policykit_var_lib_t,s0)
 
+/var/run/PolicyKit(/.*)?	gen_context(system_u:object_r:policykit_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/policykit.if refpolicy/policy/modules/contrib/policykit.if
--- refpolicy/policy/modules/contrib/policykit.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/policykit.if	2012-10-19 09:45:00.025491570 +0200
@@ -23,6 +23,27 @@
 
 ########################################
 ## <summary>
+##	Send and receive messages from
+##	policykit auth over dbus.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`policykit_dbus_chat_auth',`
+	gen_require(`
+		type policykit_auth_t;
+		class dbus send_msg;
+	')
+
+	allow $1 policykit_auth_t:dbus send_msg;
+	allow policykit_auth_t $1:dbus send_msg;
+')
+
+########################################
+## <summary>
 ##	Execute a domain transition to run polkit_auth.
 ## </summary>
 ## <param name="domain">
@@ -36,13 +57,15 @@
 		type policykit_auth_t, policykit_auth_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, policykit_auth_exec_t, policykit_auth_t)
 ')
 
 ########################################
 ## <summary>
-##	Execute a policy_auth in the policy_auth domain, and
-##	allow the specified role the policy_auth domain,
+##	Execute a policy_auth in the policy
+##	auth domain, and allow the specified
+##	role the policy auth domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -57,16 +80,16 @@
 #
 interface(`policykit_run_auth',`
 	gen_require(`
-		type policykit_auth_t;
+		attribute_role policykit_auth_roles;
 	')
 
 	policykit_domtrans_auth($1)
-	role $2 types policykit_auth_t;
+	roleattribute $2 policykit_auth_roles;
 ')
 
 ########################################
 ## <summary>
-##	Execute a domain transition to run polkit_grant.
+##	Execute a domain transition to run polkit grant.
 ## </summary>
 ## <param name="domain">
 ## <summary>
@@ -79,13 +102,15 @@
 		type policykit_grant_t, policykit_grant_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, policykit_grant_exec_t, policykit_grant_t)
 ')
 
 ########################################
 ## <summary>
-##	Execute a policy_grant in the policy_grant domain, and
-##	allow the specified role the policy_grant domain,
+##	Execute a policy_grant in the policy
+##	grant domain, and allow the specified
+##	role the policy grant domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -101,20 +126,16 @@
 #
 interface(`policykit_run_grant',`
 	gen_require(`
-		type policykit_grant_t;
+		attribute_role policykit_grant_roles;
 	')
 
 	policykit_domtrans_grant($1)
-	role $2 types policykit_grant_t;
-
-	allow $1 policykit_grant_t:process signal;
-
-	ps_process_pattern(policykit_grant_t, $1)
+	roleattribute $2 policykit_grant_roles;
 ')
 
 ########################################
 ## <summary>
-##	read policykit reload files
+##	Read policykit reload files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -133,7 +154,7 @@
 
 ########################################
 ## <summary>
-##	rw policykit reload files
+##	Read and write policykit reload files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -152,7 +173,7 @@
 
 ########################################
 ## <summary>
-##	Execute a domain transition to run polkit_resolve.
+##	Execute a domain transition to run polkit resolve.
 ## </summary>
 ## <param name="domain">
 ## <summary>
@@ -165,9 +186,8 @@
 		type policykit_resolve_t, policykit_resolve_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, policykit_resolve_exec_t, policykit_resolve_t)
-
-	ps_process_pattern(policykit_resolve_t, $1)
 ')
 
 ########################################
@@ -185,13 +205,13 @@
 		type policykit_var_lib_t;
 	')
 
-	allow $1 policykit_var_lib_t:dir search_dir_perms;
 	files_search_var_lib($1)
+	allow $1 policykit_var_lib_t:dir search_dir_perms;
 ')
 
 ########################################
 ## <summary>
-##	read policykit lib files
+##	Read policykit lib files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/policykit.te refpolicy/policy/modules/contrib/policykit.te
--- refpolicy/policy/modules/contrib/policykit.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/policykit.te	2012-10-22 19:59:03.413013973 +0200
@@ -1,54 +1,75 @@
-policy_module(policykit, 1.2.0)
+policy_module(policykit, 1.2.7)
 
 ########################################
 #
 # Declarations
 #
 
-type policykit_t alias polkit_t;
-type policykit_exec_t alias polkit_exec_t;
+attribute policykit_domain;
+
+attribute_role policykit_auth_roles;
+attribute_role policykit_grant_roles;
+
+type policykit_t, policykit_domain;
+type policykit_exec_t;
 init_daemon_domain(policykit_t, policykit_exec_t)
 
-type policykit_auth_t alias polkit_auth_t;
-type policykit_auth_exec_t alias polkit_auth_exec_t;
+type policykit_auth_t, policykit_domain;
+type policykit_auth_exec_t;
 init_daemon_domain(policykit_auth_t, policykit_auth_exec_t)
+role policykit_auth_roles types policykit_auth_t;
 
-type policykit_grant_t alias polkit_grant_t;
-type policykit_grant_exec_t alias polkit_grant_exec_t;
+type policykit_grant_t, policykit_domain;
+type policykit_grant_exec_t;
 init_system_domain(policykit_grant_t, policykit_grant_exec_t)
+role policykit_grant_roles types policykit_grant_t;
 
-type policykit_resolve_t alias polkit_resolve_t;
-type policykit_resolve_exec_t alias polkit_resolve_exec_t;
+type policykit_resolve_t, policykit_domain;
+type policykit_resolve_exec_t;
 init_system_domain(policykit_resolve_t, policykit_resolve_exec_t)
 
 type policykit_reload_t alias polkit_reload_t;
 files_type(policykit_reload_t)
 
+type policykit_tmp_t;
+files_tmp_file(policykit_tmp_t)
+
 type policykit_var_lib_t alias polkit_var_lib_t;
 files_type(policykit_var_lib_t)
 
 type policykit_var_run_t alias polkit_var_run_t;
 files_pid_file(policykit_var_run_t)
 
-########################################
+#######################################
 #
-# policykit local policy
+# Common policykit domain local policy
 #
 
-allow policykit_t self:capability { setgid setuid };
-allow policykit_t self:process getattr;
-allow policykit_t self:fifo_file rw_file_perms;
-allow policykit_t self:unix_dgram_socket create_socket_perms;
-allow policykit_t self:unix_stream_socket create_stream_socket_perms;
+allow policykit_domain self:process { execmem getattr };
+allow policykit_domain self:fifo_file rw_fifo_file_perms;
 
-policykit_domtrans_auth(policykit_t)
+kernel_search_proc(policykit_domain)
 
-can_exec(policykit_t, policykit_exec_t)
-corecmd_exec_bin(policykit_t)
+corecmd_exec_bin(policykit_domain)
 
-rw_files_pattern(policykit_t, policykit_reload_t, policykit_reload_t)
+dev_read_sysfs(policykit_domain)
+
+files_read_usr_files(policykit_domain)
 
-policykit_domtrans_resolve(policykit_t)
+logging_send_syslog_msg(policykit_domain)
+
+miscfiles_read_localization(policykit_domain)
+
+########################################
+#
+# Local policy
+#
+
+allow policykit_t self:capability { dac_override dac_read_search setgid setuid sys_nice sys_ptrace };
+allow policykit_t self:process { getsched setsched signal };
+allow policykit_t self:unix_stream_socket { accept connectto listen };
+
+rw_files_pattern(policykit_t, policykit_reload_t, policykit_reload_t)
 
 manage_files_pattern(policykit_t, policykit_var_lib_t, policykit_var_lib_t)
 
@@ -56,85 +77,133 @@
 manage_files_pattern(policykit_t, policykit_var_run_t, policykit_var_run_t)
 files_pid_filetrans(policykit_t, policykit_var_run_t, { file dir })
 
+can_exec(policykit_t, policykit_exec_t)
+
+domtrans_pattern(policykit_t, policykit_auth_exec_t, policykit_auth_t)
+domtrans_pattern(policykit_t, policykit_resolve_exec_t, policykit_resolve_t)
+
 kernel_read_kernel_sysctls(policykit_t)
+kernel_read_system_state(policykit_t)
 
-files_read_etc_files(policykit_t)
-files_read_usr_files(policykit_t)
+domain_read_all_domains_state(policykit_t)
 
-auth_use_nsswitch(policykit_t)
+files_dontaudit_search_all_mountpoints(policykit_t)
 
-logging_send_syslog_msg(policykit_t)
+fs_list_inotifyfs(policykit_t)
 
-miscfiles_read_localization(policykit_t)
+auth_use_nsswitch(policykit_t)
 
+userdom_getattr_all_users(policykit_t)
 userdom_read_all_users_state(policykit_t)
 
+optional_policy(`
+	dbus_system_domain(policykit_t, policykit_exec_t)
+
+	optional_policy(`
+		consolekit_dbus_chat(policykit_t)
+	')
+
+	optional_policy(`
+		rpm_dbus_chat(policykit_t)
+	')
+')
+
+optional_policy(`
+	consolekit_read_pid_files(policykit_t)
+')
+
+optional_policy(`
+	gnome_read_generic_home_content(policykit_t)
+')
+
+optional_policy(`
+	kerberos_manage_host_rcache(policykit_t)
+	kerberos_tmp_filetrans_host_rcache(policykit_t, file, "host_0")
+')
+
 ########################################
 #
-# polkit_auth local policy
+# Auth local policy
 #
 
-allow policykit_auth_t self:capability setgid;
-allow policykit_auth_t self:process getattr;
-allow policykit_auth_t self:fifo_file rw_file_perms;
-allow policykit_auth_t self:unix_dgram_socket create_socket_perms;
-allow policykit_auth_t self:unix_stream_socket create_stream_socket_perms;
+allow policykit_auth_t self:capability { ipc_lock setgid setuid sys_nice };
+dontaudit policykit_auth_t self:capability sys_tty_config;
+allow policykit_auth_t self:process { getsched setsched signal };
+allow policykit_auth_t self:unix_stream_socket { accept listen };
 
-can_exec(policykit_auth_t, policykit_auth_exec_t)
-corecmd_search_bin(policykit_auth_t)
+ps_process_pattern(policykit_auth_t, policykit_domain)
 
 rw_files_pattern(policykit_auth_t, policykit_reload_t, policykit_reload_t)
 
+manage_dirs_pattern(policykit_auth_t, policykit_tmp_t, policykit_tmp_t)
+manage_files_pattern(policykit_auth_t, policykit_tmp_t, policykit_tmp_t)
+files_tmp_filetrans(policykit_auth_t, policykit_tmp_t, { file dir })
+
 manage_files_pattern(policykit_auth_t, policykit_var_lib_t, policykit_var_lib_t)
 
 manage_dirs_pattern(policykit_auth_t, policykit_var_run_t, policykit_var_run_t)
 manage_files_pattern(policykit_auth_t, policykit_var_run_t, policykit_var_run_t)
 files_pid_filetrans(policykit_auth_t, policykit_var_run_t, { file dir })
 
+can_exec(policykit_auth_t, policykit_auth_exec_t)
+
 kernel_read_system_state(policykit_auth_t)
+kernel_dontaudit_search_kernel_sysctl(policykit_auth_t)
 
-files_read_etc_files(policykit_auth_t)
-files_read_usr_files(policykit_auth_t)
+dev_read_video_dev(policykit_auth_t)
 
-auth_use_nsswitch(policykit_auth_t)
+files_read_etc_runtime_files(policykit_auth_t)
+files_search_home(policykit_auth_t)
 
-logging_send_syslog_msg(policykit_auth_t)
+fs_getattr_all_fs(policykit_auth_t)
+fs_search_tmpfs(policykit_auth_t)
 
-miscfiles_read_localization(policykit_auth_t)
+auth_rw_var_auth(policykit_auth_t)
+auth_use_nsswitch(policykit_auth_t)
+auth_domtrans_chk_passwd(policykit_auth_t)
+
+miscfiles_read_fonts(policykit_auth_t)
+miscfiles_setattr_fonts_cache_dirs(policykit_auth_t)
 
 userdom_dontaudit_read_user_home_content_files(policykit_auth_t)
 
 optional_policy(`
-	dbus_system_bus_client(policykit_auth_t)
-	dbus_session_bus_client(policykit_auth_t)
+	dbus_system_domain(policykit_auth_t, policykit_auth_exec_t)
+	dbus_all_session_bus_client(policykit_auth_t)
 
 	optional_policy(`
 		consolekit_dbus_chat(policykit_auth_t)
 	')
+
+	optional_policy(`
+		policykit_dbus_chat(policykit_auth_t)
+	')
 ')
 
 optional_policy(`
-	kernel_search_proc(policykit_auth_t)
 	hal_read_state(policykit_auth_t)
 ')
 
+optional_policy(`
+	kerberos_manage_host_rcache(policykit_auth_t)
+	kerberos_tmp_filetrans_host_rcache(policykit_auth_t, file, "host_0")
+')
+
+optional_policy(`
+	xserver_stream_connect(policykit_auth_t)
+	xserver_read_xdm_pid(policykit_auth_t)
+')
+
 ########################################
 #
-# polkit_grant local policy
+# Grant local policy
 #
 
 allow policykit_grant_t self:capability setuid;
-allow policykit_grant_t self:process getattr;
-allow policykit_grant_t self:fifo_file rw_file_perms;
 allow policykit_grant_t self:unix_dgram_socket create_socket_perms;
 allow policykit_grant_t self:unix_stream_socket create_stream_socket_perms;
 
-policykit_domtrans_auth(policykit_grant_t)
-
-policykit_domtrans_resolve(policykit_grant_t)
-
-can_exec(policykit_grant_t, policykit_grant_exec_t)
-corecmd_search_bin(policykit_grant_t)
+ps_process_pattern(policykit_grant_t, policykit_domain)
 
 rw_files_pattern(policykit_grant_t, policykit_reload_t, policykit_reload_t)
 
@@ -142,19 +211,21 @@
 
 manage_files_pattern(policykit_grant_t, policykit_var_lib_t, policykit_var_lib_t)
 
-files_read_etc_files(policykit_grant_t)
-files_read_usr_files(policykit_grant_t)
-
-auth_use_nsswitch(policykit_grant_t)
-auth_domtrans_chk_passwd(policykit_grant_t)
+can_exec(policykit_grant_t, policykit_grant_exec_t)
 
-logging_send_syslog_msg(policykit_grant_t)
+domtrans_pattern(policykit_grant_t, policykit_auth_exec_t, policykit_auth_t)
+domtrans_pattern(policykit_grant_t, policykit_resolve_exec_t, policykit_resolve_t)
 
-miscfiles_read_localization(policykit_grant_t)
+auth_domtrans_chk_passwd(policykit_grant_t)
+auth_use_nsswitch(policykit_grant_t)
 
 userdom_read_all_users_state(policykit_grant_t)
 
 optional_policy(`
+	cron_manage_system_job_lib_files(policykit_grant_t)
+')
+
+optional_policy(`
 	dbus_system_bus_client(policykit_grant_t)
 
 	optional_policy(`
@@ -164,35 +235,26 @@
 
 ########################################
 #
-# polkit_resolve local policy
+# Resolve local policy
 #
 
-allow policykit_resolve_t self:capability { setuid sys_nice sys_ptrace };
-allow policykit_resolve_t self:process getattr;
-allow policykit_resolve_t self:fifo_file rw_file_perms;
-allow policykit_resolve_t self:unix_dgram_socket create_socket_perms;
-allow policykit_resolve_t self:unix_stream_socket create_stream_socket_perms;
+allow policykit_resolve_t self:capability { setuid sys_nice };
+allow policykit_resolve_t self:unix_stream_socket { accept listen };
 
-policykit_domtrans_auth(policykit_resolve_t)
+ps_process_pattern(policykit_resolve_t, policykit_domain)
 
 read_files_pattern(policykit_resolve_t, policykit_reload_t, policykit_reload_t)
 
 read_files_pattern(policykit_resolve_t, policykit_var_lib_t, policykit_var_lib_t)
 
 can_exec(policykit_resolve_t, policykit_resolve_exec_t)
-corecmd_search_bin(policykit_resolve_t)
 
-files_read_etc_files(policykit_resolve_t)
-files_read_usr_files(policykit_resolve_t)
+domtrans_pattern(policykit_resolve_t, policykit_auth_exec_t, policykit_auth_t)
 
 mcs_ptrace_all(policykit_resolve_t)
 
 auth_use_nsswitch(policykit_resolve_t)
 
-logging_send_syslog_msg(policykit_resolve_t)
-
-miscfiles_read_localization(policykit_resolve_t)
-
 userdom_read_all_users_state(policykit_resolve_t)
 
 optional_policy(`
@@ -204,7 +266,6 @@
 ')
 
 optional_policy(`
-	kernel_search_proc(policykit_resolve_t)
 	hal_read_state(policykit_resolve_t)
 ')
 
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/polipo.fc refpolicy/policy/modules/contrib/polipo.fc
--- refpolicy/policy/modules/contrib/polipo.fc	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/polipo.fc	2012-09-27 20:03:30.753126498 +0200
@@ -0,0 +1,15 @@
+HOME_DIR/\.forbidden	--	gen_context(system_u:object_r:polipo_config_home_t,s0)
+HOME_DIR/\.polipo	--	gen_context(system_u:object_r:polipo_config_home_t,s0)
+HOME_DIR/\.polipo-cache(/.*)?	gen_context(system_u:object_r:polipo_cache_home_t,s0)
+
+/etc/polipo(/.*)?	gen_context(system_u:object_r:polipo_conf_t,s0)
+
+/etc/rc\.d/init\.d/polipo	--	gen_context(system_u:object_r:polipo_initrc_exec_t,s0)
+
+/usr/bin/polipo	--	gen_context(system_u:object_r:polipo_exec_t,s0)
+
+/var/cache/polipo(/.*)?	gen_context(system_u:object_r:polipo_cache_t,s0)
+
+/var/log/polipo.*	--	gen_context(system_u:object_r:polipo_log_t,s0)
+
+/var/run/polipo(/.*)?	gen_context(system_u:object_r:polipo_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/polipo.if refpolicy/policy/modules/contrib/polipo.if
--- refpolicy/policy/modules/contrib/polipo.if	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/polipo.if	2012-10-10 21:47:43.815027917 +0200
@@ -0,0 +1,144 @@
+## <summary>Lightweight forwarding and caching proxy server.</summary>
+
+########################################
+## <summary>
+##	Role access for Polipo session.
+## </summary>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <param name="domain">
+##	<summary>
+##	User domain for the role.
+##	</summary>
+## </param>
+#
+template(`polipo_role',`
+	gen_require(`
+		type polipo_session_t, polipo_exec_t, polipo_config_home_t;
+		type polipo_cache_home_t;
+	')
+
+	########################################
+	#
+	# Declarations
+	#
+
+	role $1 types polipo_session_t;
+
+	########################################
+	#
+	# Policy
+	#
+
+	allow $2 polipo_cache_home_t:dir { manage_dir_perms relabel_dir_perms };
+	allow $2 { polipo_cache_home_t polipo_config_home_t }:file { manage_file_perms relabel_file_perms };
+
+	userdom_user_home_dir_filetrans($2, polipo_config_home_t, file, ".forbidden")
+	userdom_user_home_dir_filetrans($2, polipo_config_home_t, file, ".polipo")
+	userdom_user_home_dir_filetrans($2, polipo_cache_home_t, dir, ".polipo-cache")
+
+	allow $2 polipo_session_t:process { ptrace signal_perms };
+	ps_process_pattern($2, polipo_session_t)
+
+	tunable_policy(`polipo_session_users',`
+		domtrans_pattern($2, polipo_exec_t, polipo_session_t)
+	',`
+		can_exec($2, polipo_exec_t)
+	')
+')
+
+########################################
+## <summary>
+##	Execute Polipo in the Polipo
+##	system domain.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed to transition.
+##	</summary>
+## </param>
+#
+interface(`polipo_initrc_domtrans',`
+	gen_require(`
+		type polipo_initrc_exec_t;
+	')
+
+	init_labeled_script_domtrans($1, polipo_initrc_exec_t)
+')
+
+########################################
+## <summary>
+##	Create specified objects in generic
+##	log directories with the polipo
+##	log file type.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="object_class">
+##	<summary>
+##	Class of the object being created.
+##	</summary>
+## </param>
+## <param name="name" optional="true">
+##	<summary>
+##	The name of the object being created.
+##	</summary>
+## </param>
+#
+interface(`polipo_log_filetrans_log',`
+	gen_require(`
+		type polipo_log_t;
+	')
+
+	logging_log_filetrans($1, polipo_log_t, $2, $3)
+')
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an polipo environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`polipo_admin',`
+	gen_require(`
+		type polipo_system_t, polipo_initrc_exec_t, polipo_cache_t;
+		type polipo_conf_t, polipo_log_t, polipo_var_run_t;
+	')
+
+	allow $1 polipo_system_t:process { ptrace signal_perms };
+	ps_process_pattern($1, polipo_system_t)
+
+	polipo_initrc_domtrans($1)
+	domain_system_change_exemption($1)
+	role_transition $2 polipo_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	files_search_var($1)
+	admin_pattern($1, polipo_cache_t)
+
+	files_search_etc($1)
+	admin_pattern($1, polipo_conf_t)
+
+	logging_search_logs($1)
+	admin_pattern($1, polipo_log_t)
+
+	files_search_pids($1)
+	admin_pattern($1, polipo_var_run_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/polipo.te refpolicy/policy/modules/contrib/polipo.te
--- refpolicy/policy/modules/contrib/polipo.te	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/polipo.te	2012-10-10 21:47:43.836027920 +0200
@@ -0,0 +1,167 @@
+policy_module(polipo, 1.0.4)
+
+########################################
+#
+# Declarations
+#
+
+## <desc>
+##	<p>
+##	Determine whether Polipo system
+##	daemon can access CIFS file systems.
+##	</p>
+## </desc>
+gen_tunable(polipo_system_use_cifs, false)
+
+## <desc>
+##	<p>
+##	Determine whether Polipo system
+##	daemon can access NFS file systems.
+##	</p>
+## </desc>
+gen_tunable(polipo_system_use_nfs, false)
+
+## <desc>
+##	<p>
+##	Determine whether calling user domains
+##	can execute Polipo daemon in the
+##	polipo_session_t domain.
+##	</p>
+## </desc>
+gen_tunable(polipo_session_users, false)
+
+## <desc>
+##	<p>
+##	Determine whether Polipo session daemon
+##	can send syslog messages.
+##	</p>
+## </desc>
+gen_tunable(polipo_session_send_syslog_msg, false)
+
+attribute polipo_daemon;
+
+type polipo_system_t, polipo_daemon;
+type polipo_exec_t;
+init_daemon_domain(polipo_system_t, polipo_exec_t)
+
+type polipo_initrc_exec_t;
+init_script_file(polipo_initrc_exec_t)
+
+type polipo_conf_t;
+files_config_file(polipo_conf_t)
+
+type polipo_cache_t;
+files_type(polipo_cache_t)
+
+type polipo_log_t;
+logging_log_file(polipo_log_t)
+
+type polipo_var_run_t;
+files_pid_file(polipo_var_run_t)
+
+type polipo_session_t, polipo_daemon;
+userdom_user_application_domain(polipo_session_t, polipo_exec_t)
+
+type polipo_cache_home_t;
+userdom_user_home_content(polipo_cache_home_t)
+
+type polipo_config_home_t;
+userdom_user_home_content(polipo_config_home_t)
+
+########################################
+#
+# Session local policy
+#
+
+allow polipo_session_t polipo_config_home_t:file read_file_perms;
+
+manage_dirs_pattern(polipo_session_t, polipo_cache_home_t, polipo_cache_home_t)
+manage_files_pattern(polipo_session_t, polipo_cache_home_t, polipo_cache_home_t)
+userdom_user_home_dir_filetrans(polipo_session_t, polipo_cache_home_t, dir, ".polipo-cache")
+
+auth_use_nsswitch(polipo_session_t)
+
+userdom_use_user_terminals(polipo_session_t)
+
+tunable_policy(`polipo_session_send_syslog_msg',`
+	logging_send_syslog_msg(polipo_session_t)
+')
+
+tunable_policy(`use_nfs_home_dirs',`
+	fs_read_nfs_files(polipo_session_t)
+',`
+	fs_dontaudit_read_nfs_files(polipo_session_t)
+')
+
+tunable_policy(`use_samba_home_dirs',`
+	fs_read_cifs_files(polipo_session_t)
+',`
+	fs_dontaudit_read_cifs_files(polipo_session_t)
+')
+
+########################################
+#
+# System local policy
+#
+
+read_files_pattern(polipo_system_t, polipo_conf_t, polipo_conf_t)
+
+manage_files_pattern(polipo_system_t, polipo_cache_t, polipo_cache_t)
+manage_dirs_pattern(polipo_system_t, polipo_cache_t, polipo_cache_t)
+files_var_filetrans(polipo_system_t, polipo_cache_t, dir)
+
+append_files_pattern(polipo_system_t, polipo_log_t, polipo_log_t)
+create_files_pattern(polipo_system_t, polipo_log_t, polipo_log_t)
+setattr_files_pattern(polipo_system_t, polipo_log_t, polipo_log_t)
+logging_log_filetrans(polipo_system_t, polipo_log_t, file)
+
+manage_files_pattern(polipo_system_t, polipo_var_run_t, polipo_var_run_t)
+files_pid_filetrans(polipo_system_t, polipo_var_run_t, file)
+
+auth_use_nsswitch(polipo_system_t)
+
+logging_send_syslog_msg(polipo_system_t)
+
+optional_policy(`
+	cron_system_entry(polipo_system_t, polipo_exec_t)
+')
+
+tunable_policy(`polipo_system_use_cifs',`
+	fs_manage_cifs_files(polipo_system_t)
+',`
+	fs_dontaudit_read_cifs_files(polipo_system_t)
+')
+
+tunable_policy(`polipo_system_use_nfs',`
+	fs_manage_nfs_files(polipo_system_t)
+',`
+	fs_dontaudit_read_nfs_files(polipo_system_t)
+')
+
+########################################
+#
+# Polipo global local policy
+#
+
+allow polipo_daemon self:fifo_file rw_fifo_file_perms;
+allow polipo_daemon self:tcp_socket { listen accept };
+
+corenet_all_recvfrom_unlabeled(polipo_daemon)
+corenet_all_recvfrom_netlabel(polipo_daemon)
+corenet_tcp_sendrecv_generic_if(polipo_daemon)
+corenet_tcp_sendrecv_generic_node(polipo_daemon)
+corenet_tcp_bind_generic_node(polipo_daemon)
+
+corenet_sendrecv_http_client_packets(polipo_daemon)
+corenet_tcp_sendrecv_http_port(polipo_daemon)
+corenet_tcp_connect_http_port(polipo_daemon)
+
+corenet_sendrecv_http_cache_server_packets(polipo_daemon)
+corenet_tcp_sendrecv_http_cache_port(polipo_daemon)
+corenet_tcp_bind_http_cache_port(polipo_daemon)
+
+files_read_usr_files(polipo_daemon)
+
+fs_search_auto_mountpoints(polipo_daemon)
+
+miscfiles_read_localization(polipo_daemon)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/portage.fc refpolicy/policy/modules/contrib/portage.fc
--- refpolicy/policy/modules/contrib/portage.fc	2012-07-13 16:46:37.000000000 +0200
+++ refpolicy/policy/modules/contrib/portage.fc	2012-10-19 09:45:04.043491579 +0200
@@ -1,35 +1,35 @@
-/etc/make\.conf			--	gen_context(system_u:object_r:portage_conf_t,s0)
-/etc/make\.globals		--	gen_context(system_u:object_r:portage_conf_t,s0)
-/etc/portage(/.*)?			gen_context(system_u:object_r:portage_conf_t,s0)
-/etc/portage/gpg(/.*)?			gen_context(system_u:object_r:portage_gpg_t,s0)
+/etc/make\.conf	--	gen_context(system_u:object_r:portage_conf_t,s0)
+/etc/make\.globals	--	gen_context(system_u:object_r:portage_conf_t,s0)
+/etc/portage(/.*)?	gen_context(system_u:object_r:portage_conf_t,s0)
+/etc/portage/gpg(/.*)?	gen_context(system_u:object_r:portage_gpg_t,s0)
 
-/usr/bin/gcc-config		--	gen_context(system_u:object_r:gcc_config_exec_t,s0)
-/usr/bin/glsa-check		--	gen_context(system_u:object_r:portage_exec_t,s0)
-/usr/bin/layman			--	gen_context(system_u:object_r:portage_fetch_exec_t,s0)
-/usr/bin/sandbox		--	gen_context(system_u:object_r:portage_exec_t,s0)
+/usr/bin/gcc-config	--	gen_context(system_u:object_r:gcc_config_exec_t,s0)
+/usr/bin/glsa-check	--	gen_context(system_u:object_r:portage_exec_t,s0)
+/usr/bin/layman	--	gen_context(system_u:object_r:portage_fetch_exec_t,s0)
+/usr/bin/sandbox	--	gen_context(system_u:object_r:portage_exec_t,s0)
 
 /usr/lib/portage/bin/ebuild	--	gen_context(system_u:object_r:portage_exec_t,s0)
 /usr/lib/portage/bin/emerge	--	gen_context(system_u:object_r:portage_exec_t,s0)
-/usr/lib/portage/bin/emerge-webrsync -- gen_context(system_u:object_r:portage_fetch_exec_t,s0)
-/usr/lib/portage/bin/quickpkg --	gen_context(system_u:object_r:portage_exec_t,s0)
-/usr/lib/portage/bin/ebuild\.sh --	gen_context(system_u:object_r:portage_exec_t,s0)
-/usr/lib/portage/bin/regenworld --	gen_context(system_u:object_r:portage_exec_t,s0)
+/usr/lib/portage/bin/emerge-webrsync	--	gen_context(system_u:object_r:portage_fetch_exec_t,s0)
+/usr/lib/portage/bin/quickpkg	--	gen_context(system_u:object_r:portage_exec_t,s0)
+/usr/lib/portage/bin/ebuild\.sh	--	gen_context(system_u:object_r:portage_exec_t,s0)
+/usr/lib/portage/bin/regenworld	--	gen_context(system_u:object_r:portage_exec_t,s0)
 /usr/lib/portage/bin/sandbox	--	gen_context(system_u:object_r:portage_exec_t,s0)
 
-/usr/portage(/.*)?			gen_context(system_u:object_r:portage_ebuild_t,s0)
+/usr/portage(/.*)?	gen_context(system_u:object_r:portage_ebuild_t,s0)
 /usr/portage/distfiles/cvs-src(/.*)?	gen_context(system_u:object_r:portage_srcrepo_t,s0)
 /usr/portage/distfiles/egit-src(/.*)?	gen_context(system_u:object_r:portage_srcrepo_t,s0)
 /usr/portage/distfiles/git-src(/.*)?	gen_context(system_u:object_r:portage_srcrepo_t,s0)
 /usr/portage/distfiles/svn-src(/.*)?	gen_context(system_u:object_r:portage_srcrepo_t,s0)
 
-/var/db/pkg(/.*)?			gen_context(system_u:object_r:portage_db_t,s0)
-/var/cache/edb(/.*)?			gen_context(system_u:object_r:portage_cache_t,s0)
-/var/log/emerge\.log.*		--	gen_context(system_u:object_r:portage_log_t,s0)
+/var/db/pkg(/.*)?	gen_context(system_u:object_r:portage_db_t,s0)
+/var/cache/edb(/.*)?	gen_context(system_u:object_r:portage_cache_t,s0)
+/var/log/emerge\.log.*	--	gen_context(system_u:object_r:portage_log_t,s0)
 /var/log/emerge-fetch.log	--	gen_context(system_u:object_r:portage_log_t,s0)
-/var/log/portage(/.*)?			gen_context(system_u:object_r:portage_log_t,s0)
-/var/lib/layman(/.*)?			gen_context(system_u:object_r:portage_ebuild_t,s0)
-/var/lib/portage(/.*)?			gen_context(system_u:object_r:portage_cache_t,s0)
-/var/tmp/binpkgs(/.*)?			gen_context(system_u:object_r:portage_tmp_t,s0)
-/var/tmp/emerge-webrsync(/.*)?		gen_context(system_u:object_r:portage_tmp_t,s0)
-/var/tmp/portage(/.*)?			gen_context(system_u:object_r:portage_tmp_t,s0)
-/var/tmp/portage-pkg(/.*)?		gen_context(system_u:object_r:portage_tmp_t,s0)
+/var/log/portage(/.*)?	gen_context(system_u:object_r:portage_log_t,s0)
+/var/lib/layman(/.*)?	gen_context(system_u:object_r:portage_ebuild_t,s0)
+/var/lib/portage(/.*)?	gen_context(system_u:object_r:portage_cache_t,s0)
+/var/tmp/binpkgs(/.*)?	gen_context(system_u:object_r:portage_tmp_t,s0)
+/var/tmp/emerge-webrsync(/.*)?	gen_context(system_u:object_r:portage_tmp_t,s0)
+/var/tmp/portage(/.*)?	gen_context(system_u:object_r:portage_tmp_t,s0)
+/var/tmp/portage-pkg(/.*)?	gen_context(system_u:object_r:portage_tmp_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/portage.if refpolicy/policy/modules/contrib/portage.if
--- refpolicy/policy/modules/contrib/portage.if	2012-07-13 16:46:37.000000000 +0200
+++ refpolicy/policy/modules/contrib/portage.if	2012-10-28 18:56:52.953026170 +0100
@@ -1,7 +1,4 @@
-## <summary>
-##	Portage Package Management System. The primary package management and
-##	distribution system for Gentoo.
-## </summary>
+## <summary>Package Management System.</summary>
 
 ########################################
 ## <summary>
@@ -18,16 +15,15 @@
 		type portage_t, portage_exec_t;
 	')
 
-	files_search_usr($1)
 	corecmd_search_bin($1)
-
 	domtrans_pattern($1, portage_exec_t, portage_t)
 ')
 
 ########################################
 ## <summary>
-##	Execute emerge in the portage domain, and
-##	allow the specified role the portage domain.
+##	Execute emerge in the portage domain,
+##	and allow the specified role the
+##	portage domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -36,7 +32,7 @@
 ## </param>
 ## <param name="role">
 ##	<summary>
-##	The role to allow the portage domain.
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <rolecap/>
@@ -67,7 +63,6 @@
 ## </param>
 #
 interface(`portage_compile_domain',`
-
 	gen_require(`
 		class dbus send_msg;
 		type portage_devpts_t, portage_log_t, portage_srcrepo_t, portage_tmp_t;
@@ -97,12 +92,12 @@
 	allow $1 self:netlink_selinux_socket { bind create read };
 	allow $1 self:dbus send_msg;
 
-	allow $1 portage_devpts_t:chr_file { rw_chr_file_perms setattr };
+	allow $1 portage_devpts_t:chr_file { rw_chr_file_perms setattr_chr_file_perms };
 	term_create_pty($1, portage_devpts_t)
 
 	# write compile logs
-	allow $1 portage_log_t:dir setattr;
-	allow $1 portage_log_t:file { write_file_perms setattr };
+	allow $1 portage_log_t:dir setattr_dir_perms;
+	allow $1 portage_log_t:file { write_file_perms setattr_file_perms };
 
 	# Support live ebuilds (-9999)
 	manage_dirs_pattern($1, portage_srcrepo_t, portage_srcrepo_t)
@@ -182,9 +177,7 @@
 	libs_exec_lib_files($1)
 	# some config scripts use ldd
 	libs_exec_ld_so($1)
-	# this violates the idea of sandbox, but
-	# regular sandbox allows it
-	libs_domtrans_ldconfig($1)
+	libs_exec_ldconfig($1)
 
 	logging_send_syslog_msg($1)
 
@@ -203,16 +196,17 @@
 	ifdef(`TODO',`
 	# some gui ebuilds want to interact with X server, like xawtv
 	optional_policy(`
-		allow $1 xdm_xserver_tmp_t:dir { add_name remove_name write };
-		allow $1 xdm_xserver_tmp_t:sock_file { create getattr unlink write };
+		allow $1 xdm_xserver_tmp_t:dir { add_entry_dir_perms del_entry_dir_perms };
+		allow $1 xdm_xserver_tmp_t:sock_file { create_file_perms delete_file_perms write_file_perms };
 	')
 	') dnl end TODO
 ')
 
 ########################################
 ## <summary>
-##	Execute tree management functions (fetching, layman, ...)
-##      in the portage_fetch_t domain.
+##	Execute tree management functions
+##	(fetching, layman, ...) in the
+##	portage fetch domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -225,17 +219,17 @@
 		type portage_fetch_t, portage_fetch_exec_t;
 	')
 
-	files_search_usr($1)
 	corecmd_search_bin($1)
-
 	domtrans_pattern($1, portage_fetch_exec_t, portage_fetch_t)
 ')
 
 ########################################
 ## <summary>
-##   Execute tree management functions (fetching, layman, ...)
-##   in the portage_fetch_t domain, and allow the specified role
-##   the portage_fetch_t domain.
+##	Execute tree management functions
+##	(fetching, layman, ...) in the
+##	portage fetch domain, and allow
+##	the specified role the portage
+##	fetch domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -244,24 +238,23 @@
 ## </param>
 ## <param name="role">
 ##	<summary>
-##	The role to allow the portage_fetch domain.
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <rolecap/>
 #
 interface(`portage_run_fetch',`
 	gen_require(`
-		type portage_fetch_t;
+		attribute_role portage_fetch_roles;
 	')
 
 	portage_domtrans_fetch($1)
-	role $2 types portage_fetch_t;
+	roleattribute $2 portage_fetch_roles;
 ')
 
-
 ########################################
 ## <summary>
-##	Execute gcc-config in the gcc_config domain.
+##	Execute gcc-config in the gcc config domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -274,16 +267,15 @@
 		type gcc_config_t, gcc_config_exec_t;
 	')
 
-	files_search_usr($1)
 	corecmd_search_bin($1)
-
 	domtrans_pattern($1, gcc_config_exec_t, gcc_config_t)
 ')
 
 ########################################
 ## <summary>
-##	Execute gcc-config in the gcc_config domain, and
-##	allow the specified role the gcc_config domain.
+##	Execute gcc-config in the gcc config
+##	domain, and allow the specified role
+##	the gcc_config domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -292,18 +284,18 @@
 ## </param>
 ## <param name="role">
 ##	<summary>
-##	The role to allow the gcc_config domain.
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <rolecap/>
 #
 interface(`portage_run_gcc_config',`
 	gen_require(`
-		type gcc_config_t;
+		attribute_role gcc_config_roles;
 	')
 
 	portage_domtrans_gcc_config($1)
-	role $2 types gcc_config_t;
+	roleattribute $2 gcc_config_roles;
 ')
 
 ########################################
@@ -362,3 +354,29 @@
 
 	dontaudit $1 portage_tmp_t:file rw_file_perms;
 ')
+
+########################################
+## <summary>
+##   Allow the domain to run within an eselect module script. 
+## </summary>
+## <param name="domain">
+##     <summary>
+##     Domain to allow within an eselect module
+##     </summary>
+## </param>
+#   Specific to Gentoo,
+#   eselect modules allow users to switch between different flavors or versions
+#   of underlying components. In return, eselect makes a wrapper binary which 
+#   makes the proper selections. If this binary is different from bin_t, it might
+#   not hold the necessary privileges for the wrapper to function. However, just
+#   marking the target binaries doesn't always work, since for python scripts the
+#   wrapper doesn't execute it, but treats the target as a library.
+#
+interface(`portage_eselect_module',`
+       gen_require(`
+               attribute portage_eselect_domain;
+       ')
+
+       typeattribute $1 portage_eselect_domain;
+')
+
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/portage.te refpolicy/policy/modules/contrib/portage.te
--- refpolicy/policy/modules/contrib/portage.te	2012-07-25 20:33:05.000000000 +0200
+++ refpolicy/policy/modules/contrib/portage.te	2012-11-14 20:07:21.713495412 +0100
@@ -1,4 +1,4 @@
-policy_module(portage, 1.13.0)
+policy_module(portage, 1.13.5)
 
 ########################################
 #
@@ -6,17 +6,21 @@
 #
 
 ## <desc>
-## <p>
-## Allow the portage domains to use NFS mounts (regular nfs_t)
-## </p>
+##	<p>
+##	Determine whether portage can
+##	use nfs filesystems.
+##	</p>
 ## </desc>
 gen_tunable(portage_use_nfs, false)
 
+attribute_role gcc_config_roles;
 attribute_role portage_roles;
+attribute_role portage_fetch_roles;
 
 type gcc_config_t;
 type gcc_config_exec_t;
 application_domain(gcc_config_t, gcc_config_exec_t)
+role gcc_config_roles types gcc_config_t;
 
 # constraining type
 type portage_t;
@@ -41,7 +45,7 @@
 application_domain(portage_fetch_t, portage_fetch_exec_t)
 corecmd_shell_entry_type(portage_fetch_t)
 rsync_entry_type(portage_fetch_t)
-role portage_roles types portage_fetch_t;
+role portage_fetch_roles types portage_fetch_t;
 
 type portage_devpts_t;
 term_pty(portage_devpts_t)
@@ -76,13 +80,21 @@
 type portage_tmpfs_t;
 files_tmpfs_file(portage_tmpfs_t)
 
+ifdef(`distro_gentoo',`
+	type gcc_config_tmp_t;
+	files_tmp_file(gcc_config_tmp_t)
+
+	# Assigned to domains that are managed by eselect
+	attribute portage_eselect_domain;
+')
+
 ########################################
 #
 # gcc-config policy
 #
 
 allow gcc_config_t self:capability { chown fsetid };
-allow gcc_config_t self:fifo_file rw_file_perms;
+allow gcc_config_t self:fifo_file rw_fifo_file_perms;
 
 manage_files_pattern(gcc_config_t, portage_cache_t, portage_cache_t)
 
@@ -129,7 +141,13 @@
 consoletype_exec(gcc_config_t)
 
 ifdef(`distro_gentoo',`
+	allow gcc_config_t gcc_config_tmp_t:file manage_file_perms;
+	files_tmp_filetrans(gcc_config_t, gcc_config_tmp_t, file)
+
 	init_exec_rc(gcc_config_t)
+
+	files_manage_etc_runtime_files(gcc_config_t)
+	files_manage_etc_runtime_lnk_files(gcc_config_t)
 ')
 
 tunable_policy(`portage_use_nfs',`
@@ -165,7 +183,7 @@
 corecmd_shell_spec_domtrans(portage_t, portage_fetch_t)
 rsync_entry_domtrans(portage_t, portage_fetch_t)
 allow portage_fetch_t portage_t:fd use;
-allow portage_fetch_t portage_t:fifo_file rw_file_perms;
+allow portage_fetch_t portage_t:fifo_file rw_fifo_file_perms;
 allow portage_fetch_t portage_t:process sigchld;
 dontaudit portage_fetch_t portage_devpts_t:chr_file { read write };
 
@@ -173,7 +191,7 @@
 domain_trans(portage_t, portage_exec_t, portage_sandbox_t)
 corecmd_shell_spec_domtrans(portage_t, portage_sandbox_t)
 allow portage_sandbox_t portage_t:fd use;
-allow portage_sandbox_t portage_t:fifo_file rw_file_perms;
+allow portage_sandbox_t portage_t:fifo_file rw_fifo_file_perms;
 allow portage_sandbox_t portage_t:process sigchld;
 allow portage_sandbox_t self:process ptrace;
 dontaudit portage_sandbox_t self:netlink_route_socket rw_netlink_socket_perms;
@@ -206,6 +224,10 @@
 # if sesandbox is disabled, compiling is performed in this domain
 portage_compile_domain(portage_t)
 
+ifdef(`distro_gentoo',`
+	allow portage_t self:capability2 block_suspend;
+')
+
 optional_policy(`
 	bootloader_run(portage_t, portage_roles)
 ')
@@ -229,7 +251,7 @@
 ifdef(`TODO',`
 # seems to work ok without these
 dontaudit portage_t device_t:{ blk_file chr_file } getattr;
-dontaudit portage_t proc_t:dir setattr;
+dontaudit portage_t proc_t:dir setattr_dir_perms;
 dontaudit portage_t device_type:chr_file read_chr_file_perms;
 dontaudit portage_t device_type:blk_file read_blk_file_perms;
 ')
@@ -243,12 +265,12 @@
 allow portage_fetch_t self:process signal;
 allow portage_fetch_t self:capability { dac_override fowner fsetid chown };
 allow portage_fetch_t self:fifo_file rw_fifo_file_perms;
-allow portage_fetch_t self:tcp_socket create_stream_socket_perms;
+allow portage_fetch_t self:tcp_socket { accept listen };
 allow portage_fetch_t self:unix_stream_socket create_socket_perms;
 
 allow portage_fetch_t portage_conf_t:dir list_dir_perms;
 
-allow portage_fetch_t portage_devpts_t:chr_file { rw_chr_file_perms setattr };
+allow portage_fetch_t portage_devpts_t:chr_file { rw_chr_file_perms setattr_chr_file_perms };
 
 allow portage_fetch_t portage_gpg_t:dir rw_dir_perms;
 allow portage_fetch_t portage_gpg_t:file manage_file_perms;
@@ -292,27 +314,33 @@
 
 domain_use_interactive_fds(portage_fetch_t)
 
-files_read_etc_files(portage_fetch_t)
 files_read_etc_runtime_files(portage_fetch_t)
 files_read_usr_files(portage_fetch_t)
-files_search_var_lib(portage_fetch_t)
 files_dontaudit_search_pids(portage_fetch_t)
 
+fs_search_auto_mountpoints(portage_fetch_t)
+
 logging_list_logs(portage_fetch_t)
 logging_dontaudit_search_logs(portage_fetch_t)
 
 term_search_ptys(portage_fetch_t)
 
-miscfiles_read_localization(portage_fetch_t)
+auth_use_nsswitch(portage_fetch_t)
 
-sysnet_read_config(portage_fetch_t)
-sysnet_dns_name_resolve(portage_fetch_t)
+miscfiles_read_generic_certs(portage_fetch_t)
+miscfiles_read_localization(portage_fetch_t)
 
 userdom_use_user_terminals(portage_fetch_t)
 userdom_dontaudit_read_user_home_content_files(portage_fetch_t)
 
 rsync_exec(portage_fetch_t)
 
+ifdef(`distro_gentoo',`
+	dev_rw_autofs(portage_fetch_t)
+
+	fs_search_auto_mountpoints(portage_fetch_t)
+')
+
 ifdef(`hide_broken_symptoms',`
 	dontaudit portage_fetch_t portage_cache_t:file read;
 ')
@@ -336,8 +364,23 @@
 
 portage_compile_domain(portage_sandbox_t)
 
+auth_use_nsswitch(portage_sandbox_t)
+
 ifdef(`hide_broken_symptoms',`
 	# leaked descriptors
-	dontaudit portage_sandbox_t portage_cache_t:dir { setattr };
-	dontaudit portage_sandbox_t portage_cache_t:file { setattr write };
+	dontaudit portage_sandbox_t portage_cache_t:dir { setattr_dir_perms };
+	dontaudit portage_sandbox_t portage_cache_t:file { setattr_file_perms write };
+')
+
+ifdef(`distro_gentoo',`
+	##########################################
+	#
+	# Portage eselect module domain
+	#
+
+	allow portage_eselect_domain self:fifo_file { read write };
+
+	corecmd_exec_shell(portage_eselect_domain)
+
+	files_manage_etc_runtime_files(portage_eselect_domain)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/portmap.fc refpolicy/policy/modules/contrib/portmap.fc
--- refpolicy/policy/modules/contrib/portmap.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/portmap.fc	2012-10-19 09:47:13.617491855 +0200
@@ -1,16 +1,12 @@
+/etc/rc\.d/init\.d/portmap	--	gen_context(system_u:object_r:portmap_initrc_exec_t,s0)
 
-/sbin/portmap		--	gen_context(system_u:object_r:portmap_exec_t,s0)
+/sbin/pmap_dump	--	gen_context(system_u:object_r:portmap_helper_exec_t,s0)
+/sbin/pmap_set	--	gen_context(system_u:object_r:portmap_helper_exec_t,s0)
+/sbin/portmap	--	gen_context(system_u:object_r:portmap_exec_t,s0)
 
-ifdef(`distro_debian',`
-/sbin/pmap_dump		--	gen_context(system_u:object_r:portmap_helper_exec_t,s0)
-/sbin/pmap_set		--	gen_context(system_u:object_r:portmap_helper_exec_t,s0)
-', `
 /usr/sbin/pmap_dump	--	gen_context(system_u:object_r:portmap_helper_exec_t,s0)
 /usr/sbin/pmap_set	--	gen_context(system_u:object_r:portmap_helper_exec_t,s0)
-')
+/usr/sbin/portmap	--	gen_context(system_u:object_r:portmap_exec_t,s0)
 
-/var/run/portmap\.upgrade-state -- gen_context(system_u:object_r:portmap_var_run_t,s0)
-
-ifdef(`distro_debian',`
-/var/run/portmap_mapping --	gen_context(system_u:object_r:portmap_var_run_t,s0)
-')
+/var/run/portmap\.upgrade-state	--	gen_context(system_u:object_r:portmap_var_run_t,s0)
+/var/run/portmap_mapping	--	gen_context(system_u:object_r:portmap_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/portmap.if refpolicy/policy/modules/contrib/portmap.if
--- refpolicy/policy/modules/contrib/portmap.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/portmap.if	2012-10-19 09:47:13.617491855 +0200
@@ -2,7 +2,7 @@
 
 ########################################
 ## <summary>
-##	Execute portmap_helper in the helper domain.
+##	Execute portmap helper in the helper domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -21,9 +21,9 @@
 
 ########################################
 ## <summary>
-##	Execute portmap helper in the helper domain, and
-##	allow the specified role the helper domain.
-##	Communicate with portmap.
+##	Execute portmap helper in the helper
+##	domain, and allow the specified role
+##	the helper domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -39,11 +39,11 @@
 #
 interface(`portmap_run_helper',`
 	gen_require(`
-		type portmap_t, portmap_helper_t;
+		attribute_role portmap_helper_roles;
 	')
 
 	portmap_domtrans_helper($1)
-	role $2 types portmap_helper_t;
+	roleattribute $2 portmap_helper_roles;
 ')
 
 ########################################
@@ -87,3 +87,43 @@
 interface(`portmap_tcp_connect',`
 	refpolicywarn(`$0($*) has been deprecated.')
 ')
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an portmap environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`portmap_admin',`
+	gen_require(`
+		type portmap_t, portmap_initrc_exec_t, portmap_helper_t;
+		type portmap_var_run_t, portmap_tmp_t;
+	')
+
+	allow $1 { portmap_t portmap_helper_t }:process { ptrace signal_perms };
+	ps_process_pattern($1, { portmap_t portmap_helper_t })
+
+	init_labeled_script_domtrans($1, portmap_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 portmap_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	files_search_pids($1)
+	admin_pattern($1, portmap_var_run_t)
+
+	files_search_tmp($1)
+	admin_pattern($1, portmap_tmp_t)
+
+	portmap_run_helper($1, $2)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/portmap.te refpolicy/policy/modules/contrib/portmap.te
--- refpolicy/policy/modules/contrib/portmap.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/portmap.te	2012-10-19 09:47:13.617491855 +0200
@@ -1,10 +1,12 @@
-policy_module(portmap, 1.10.0)
+policy_module(portmap, 1.10.1)
 
 ########################################
 #
 # Declarations
 #
 
+attribute_role portmap_helper_roles;
+
 type portmap_t;
 type portmap_exec_t;
 init_daemon_domain(portmap_t, portmap_exec_t)
@@ -12,7 +14,10 @@
 type portmap_helper_t;
 type portmap_helper_exec_t;
 init_system_domain(portmap_helper_t, portmap_helper_exec_t)
-role system_r types portmap_helper_t;
+role portmap_helper_roles types portmap_helper_t;
+
+type portmap_initrc_exec_t;
+init_script_file(portmap_initrc_exec_t)
 
 type portmap_tmp_t;
 files_tmp_file(portmap_tmp_t)
@@ -22,16 +27,13 @@
 
 ########################################
 #
-# Portmap local policy
+# Local policy
 #
 
 allow portmap_t self:capability { setuid setgid };
 dontaudit portmap_t self:capability sys_tty_config;
-allow portmap_t self:netlink_route_socket r_netlink_socket_perms;
-allow portmap_t self:unix_dgram_socket create_socket_perms;
-allow portmap_t self:unix_stream_socket create_stream_socket_perms;
-allow portmap_t self:tcp_socket create_stream_socket_perms;
-allow portmap_t self:udp_socket create_socket_perms;
+allow portmap_t self:unix_stream_socket { accept listen };
+allow portmap_t self:tcp_socket { accept listen };
 
 manage_dirs_pattern(portmap_t, portmap_tmp_t, portmap_tmp_t)
 manage_files_pattern(portmap_t, portmap_tmp_t, portmap_tmp_t)
@@ -53,16 +55,21 @@
 corenet_udp_sendrecv_all_ports(portmap_t)
 corenet_tcp_bind_generic_node(portmap_t)
 corenet_udp_bind_generic_node(portmap_t)
+
+corenet_sendrecv_all_client_packets(portmap_t)
+corenet_sendrecv_all_server_packets(portmap_t)
+
 corenet_tcp_bind_portmap_port(portmap_t)
 corenet_udp_bind_portmap_port(portmap_t)
+
 corenet_tcp_connect_all_ports(portmap_t)
-corenet_sendrecv_portmap_client_packets(portmap_t)
-corenet_sendrecv_portmap_server_packets(portmap_t)
-# portmap binds to arbitary ports
+
 corenet_tcp_bind_generic_port(portmap_t)
 corenet_udp_bind_generic_port(portmap_t)
+
 corenet_tcp_bind_reserved_port(portmap_t)
 corenet_udp_bind_reserved_port(portmap_t)
+
 corenet_dontaudit_tcp_bind_all_reserved_ports(portmap_t)
 corenet_dontaudit_udp_bind_all_ports(portmap_t)
 
@@ -73,26 +80,14 @@
 
 domain_use_interactive_fds(portmap_t)
 
-files_read_etc_files(portmap_t)
-
 logging_send_syslog_msg(portmap_t)
 
 miscfiles_read_localization(portmap_t)
 
-sysnet_read_config(portmap_t)
-
 userdom_dontaudit_use_unpriv_user_fds(portmap_t)
 userdom_dontaudit_search_user_home_dirs(portmap_t)
 
 optional_policy(`
-	nis_use_ypbind(portmap_t)
-')
-
-optional_policy(`
-	nscd_socket_use(portmap_t)
-')
-
-optional_policy(`
 	seutil_sigchld_newrole(portmap_t)
 ')
 
@@ -102,13 +97,11 @@
 
 ########################################
 #
-# Portmap helper local policy
+# Helper local policy
 #
 
 dontaudit portmap_helper_t self:capability net_admin;
-allow portmap_helper_t self:netlink_route_socket r_netlink_socket_perms;
-allow portmap_helper_t self:tcp_socket create_stream_socket_perms;
-allow portmap_helper_t self:udp_socket create_socket_perms;
+allow portmap_helper_t self:tcp_socket { accept listen };
 
 allow portmap_helper_t portmap_var_run_t:file manage_file_perms;
 files_pid_filetrans(portmap_helper_t, portmap_var_run_t, file)
@@ -117,34 +110,33 @@
 corenet_all_recvfrom_netlabel(portmap_helper_t)
 corenet_tcp_sendrecv_generic_if(portmap_helper_t)
 corenet_udp_sendrecv_generic_if(portmap_helper_t)
-corenet_raw_sendrecv_generic_if(portmap_helper_t)
 corenet_tcp_sendrecv_generic_node(portmap_helper_t)
 corenet_udp_sendrecv_generic_node(portmap_helper_t)
-corenet_raw_sendrecv_generic_node(portmap_helper_t)
 corenet_tcp_sendrecv_all_ports(portmap_helper_t)
 corenet_udp_sendrecv_all_ports(portmap_helper_t)
 corenet_tcp_bind_generic_node(portmap_helper_t)
 corenet_udp_bind_generic_node(portmap_helper_t)
+
+corenet_sendrecv_all_client_packets(portmap_helper_t)
+corenet_sendrecv_all_server_packets(portmap_helper_t)
+
 corenet_tcp_bind_reserved_port(portmap_helper_t)
 corenet_udp_bind_reserved_port(portmap_helper_t)
+
+corenet_tcp_connect_all_ports(portmap_helper_t)
+
 corenet_dontaudit_tcp_bind_all_reserved_ports(portmap_helper_t)
 corenet_dontaudit_udp_bind_all_reserved_ports(portmap_helper_t)
-corenet_tcp_connect_all_ports(portmap_helper_t)
 
 domain_dontaudit_use_interactive_fds(portmap_helper_t)
 
-files_read_etc_files(portmap_helper_t)
 files_rw_generic_pids(portmap_helper_t)
 
+auth_use_nsswitch(portmap_helper_t)
+
 init_rw_utmp(portmap_helper_t)
 
 logging_send_syslog_msg(portmap_helper_t)
 
-sysnet_read_config(portmap_helper_t)
-
 userdom_use_user_terminals(portmap_helper_t)
 userdom_dontaudit_use_all_users_fds(portmap_helper_t)
-
-optional_policy(`
-	nis_use_ypbind(portmap_helper_t)
-')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/portreserve.fc refpolicy/policy/modules/contrib/portreserve.fc
--- refpolicy/policy/modules/contrib/portreserve.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/portreserve.fc	2012-10-19 09:47:16.158491861 +0200
@@ -1,7 +1,9 @@
-/etc/portreserve(/.*)?			gen_context(system_u:object_r:portreserve_etc_t,s0)
+/etc/portreserve(/.*)?	gen_context(system_u:object_r:portreserve_etc_t,s0)
 
 /etc/rc\.d/init\.d/portreserve	--	gen_context(system_u:object_r:portreserve_initrc_exec_t,s0)
 
-/sbin/portreserve		--	gen_context(system_u:object_r:portreserve_exec_t,s0)
+/sbin/portreserve	--	gen_context(system_u:object_r:portreserve_exec_t,s0)
 
-/var/run/portreserve(/.*)? 		gen_context(system_u:object_r:portreserve_var_run_t,s0)
+/usr/sbin/portreserve	--	gen_context(system_u:object_r:portreserve_exec_t,s0)
+
+/var/run/portreserve(/.*)?	gen_context(system_u:object_r:portreserve_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/portreserve.if refpolicy/policy/modules/contrib/portreserve.if
--- refpolicy/policy/modules/contrib/portreserve.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/portreserve.if	2012-10-19 09:47:16.158491861 +0200
@@ -15,13 +15,13 @@
 		type portreserve_t, portreserve_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, portreserve_exec_t, portreserve_t)
 ')
 
 #######################################
 ## <summary>
-##	Allow the specified domain to read
-##	portreserve etcuration files.
+##	Read portreserve configuration content.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -37,14 +37,14 @@
 
 	files_search_etc($1)
 	allow $1 portreserve_etc_t:dir list_dir_perms;
-	read_files_pattern($1, portreserve_etc_t, portreserve_etc_t)
-	read_lnk_files_pattern($1, portreserve_etc_t, portreserve_etc_t)
+	allow $1 portreserve_etc_t:file read_file_perms;
+	allow $1 portreserve_etc_t:lnk_file read_lnk_file_perms;
 ')
 
 #######################################
 ## <summary>
-##	Allow the specified domain to manage
-##	portreserve etcuration files.
+##	Create, read, write, and delete
+##	portreserve configuration content.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -58,14 +58,15 @@
 	')
 
 	files_search_etc($1)
-	manage_dirs_pattern($1, portreserve_etc_t, portreserve_etc_t)
-	manage_files_pattern($1, portreserve_etc_t, portreserve_etc_t)
-	read_lnk_files_pattern($1, portreserve_etc_t, portreserve_etc_t)
+	allow $1 portreserve_etc_t:dir manage_dir_perms;
+	allow $1 portreserve_etc_t:file manage_file_perms;
+	allow $1 portreserve_etc_t:lnk_file manage_lnk_file_perms;
 ')
 
 ########################################
 ## <summary>
-##	Execute portreserve in the portreserve domain.
+##	Execute portreserve init scripts in
+##	the init script domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -83,8 +84,8 @@
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate
-##	an portreserve environment.
+##	All of the rules required to
+##	administrate an portreserve environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/portreserve.te refpolicy/policy/modules/contrib/portreserve.te
--- refpolicy/policy/modules/contrib/portreserve.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/portreserve.te	2012-10-19 09:47:16.158491861 +0200
@@ -1,4 +1,4 @@
-policy_module(portreserve, 1.3.0)
+policy_module(portreserve, 1.3.1)
 
 ########################################
 #
@@ -13,14 +13,14 @@
 init_script_file(portreserve_initrc_exec_t)
 
 type portreserve_etc_t;
-files_type(portreserve_etc_t)
+files_config_file(portreserve_etc_t)
 
 type portreserve_var_run_t;
 files_pid_file(portreserve_var_run_t)
 
 ########################################
 #
-# Portreserve local policy
+# Local policy
 #
 
 allow portreserve_t self:capability { dac_read_search dac_override };
@@ -30,11 +30,10 @@
 allow portreserve_t self:tcp_socket create_socket_perms;
 allow portreserve_t self:udp_socket create_socket_perms;
 
-# Read etc files
-list_dirs_pattern(portreserve_t, portreserve_etc_t, portreserve_etc_t)
-read_files_pattern(portreserve_t, portreserve_etc_t, portreserve_etc_t)
+allow portreserve_t portreserve_etc_t:dir list_dir_perms;
+allow portreserve_t portreserve_etc_t:file read_file_perms;
+allow portreserve_t portreserve_etc_t:lnk_file read_lnk_file_perms;
 
-# Manage /var/run/portreserve/*
 manage_dirs_pattern(portreserve_t, portreserve_var_run_t, portreserve_var_run_t)
 manage_files_pattern(portreserve_t, portreserve_var_run_t, portreserve_var_run_t)
 manage_sock_files_pattern(portreserve_t, portreserve_var_run_t, portreserve_var_run_t)
@@ -44,8 +43,16 @@
 
 corenet_all_recvfrom_unlabeled(portreserve_t)
 corenet_all_recvfrom_netlabel(portreserve_t)
+corenet_tcp_sendrecv_generic_if(portreserve_t)
+corenet_udp_sendrecv_generic_if(portreserve_t)
+corenet_tcp_sendrecv_generic_node(portreserve_t)
+corenet_udp_sendrecv_generic_node(portreserve_t)
+corenet_tcp_sendrecv_all_ports(portreserve_t)
+corenet_udp_sendrecv_all_ports(portreserve_t)
 corenet_tcp_bind_generic_node(portreserve_t)
 corenet_udp_bind_generic_node(portreserve_t)
+
+corenet_sendrecv_all_server_packets(portreserve_t)
 corenet_tcp_bind_all_ports(portreserve_t)
 corenet_udp_bind_all_ports(portreserve_t)
 
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/portslave.fc refpolicy/policy/modules/contrib/portslave.fc
--- refpolicy/policy/modules/contrib/portslave.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/portslave.fc	2012-10-19 09:47:19.382491868 +0200
@@ -1,4 +1,6 @@
-/etc/portslave(/.*)?		gen_context(system_u:object_r:portslave_etc_t,s0)
+/etc/portslave(/.*)?	gen_context(system_u:object_r:portslave_etc_t,s0)
 
 /usr/sbin/ctlportslave	--	gen_context(system_u:object_r:portslave_exec_t,s0)
 /usr/sbin/portslave	--	gen_context(system_u:object_r:portslave_exec_t,s0)
+
+/var/lock/subsys/portslave	--	gen_context(system_u:object_r:portslave_lock_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/portslave.if refpolicy/policy/modules/contrib/portslave.if
--- refpolicy/policy/modules/contrib/portslave.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/portslave.if	2012-10-19 09:47:19.382491868 +0200
@@ -1,4 +1,4 @@
-## <summary>Portslave terminal server software</summary>
+## <summary>Portslave terminal server software.</summary>
 
 ########################################
 ## <summary>
@@ -15,5 +15,6 @@
 		type portslave_t, portslave_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, portslave_exec_t, portslave_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/portslave.te refpolicy/policy/modules/contrib/portslave.te
--- refpolicy/policy/modules/contrib/portslave.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/portslave.te	2012-10-19 14:38:47.501529194 +0200
@@ -1,4 +1,4 @@
-policy_module(portslave, 1.7.0)
+policy_module(portslave, 1.7.2)
 
 ########################################
 #
@@ -21,29 +21,23 @@
 # Local policy
 #
 
-# setuid setgid net_admin fsetid for pppd
-# sys_admin for ctlportslave
-# net_bind_service for rlogin
 allow portslave_t self:capability { setuid setgid net_admin fsetid net_bind_service sys_tty_config };
 dontaudit portslave_t self:capability sys_admin;
 allow portslave_t self:process signal_perms;
 allow portslave_t self:process ~{ ptrace setcurrent setexec setfscreate setrlimit execmem execstack execheap };
 allow portslave_t self:fd use;
 allow portslave_t self:fifo_file rw_fifo_file_perms;
-allow portslave_t self:unix_dgram_socket create_socket_perms;
-allow portslave_t self:unix_stream_socket create_stream_socket_perms;
 allow portslave_t self:unix_dgram_socket sendto;
-allow portslave_t self:unix_stream_socket connectto;
+allow portslave_t self:unix_stream_socket { accept connectto listen };
 allow portslave_t self:shm create_shm_perms;
 allow portslave_t self:sem create_sem_perms;
 allow portslave_t self:msgq create_msgq_perms;
 allow portslave_t self:msg { send receive };
-allow portslave_t self:tcp_socket create_stream_socket_perms;
-allow portslave_t self:udp_socket create_socket_perms;
+allow portslave_t self:tcp_socket { accept listen };
 
 allow portslave_t portslave_etc_t:dir list_dir_perms;
-read_files_pattern(portslave_t, portslave_etc_t, portslave_etc_t)
-read_lnk_files_pattern(portslave_t, portslave_etc_t, portslave_etc_t)
+allow portslave_t portslave_etc_t:file read_file_perms;
+allow portslave_t portslave_etc_t:lnk_file read_lnk_file_perms;
 
 allow portslave_t portslave_lock_t:file manage_file_perms;
 files_lock_filetrans(portslave_t, portslave_lock_t, file)
@@ -62,15 +56,14 @@
 corenet_udp_sendrecv_generic_node(portslave_t)
 corenet_tcp_sendrecv_all_ports(portslave_t)
 corenet_udp_sendrecv_all_ports(portslave_t)
+
 corenet_rw_ppp_dev(portslave_t)
 
 dev_read_sysfs(portslave_t)
-# for ssh
 dev_read_urand(portslave_t)
 
 domain_use_interactive_fds(portslave_t)
 
-files_read_etc_files(portslave_t)
 files_read_etc_runtime_files(portslave_t)
 files_exec_etc_files(portslave_t)
 
@@ -82,29 +75,23 @@
 term_use_all_ttys(portslave_t)
 term_search_ptys(portslave_t)
 
-auth_rw_login_records(portslave_t)
 auth_domtrans_chk_passwd(portslave_t)
+auth_rw_login_records(portslave_t)
+auth_use_nsswitch(portslave_t)
 
 init_rw_utmp(portslave_t)
 
 logging_send_syslog_msg(portslave_t)
 logging_search_logs(portslave_t)
 
-sysnet_read_config(portslave_t)
-
 userdom_use_unpriv_users_fds(portslave_t)
-# for ~/.ppprc - if it actually exists then you need some policy to read it
-userdom_search_user_home_dirs(portslave_t)
-
-mta_send_mail(portslave_t)
 
-# this should probably be a domtrans to pppd
-# instead of exec.
+ppp_read_home_files(portslave_t)
 ppp_read_rw_config(portslave_t)
 ppp_exec(portslave_t)
 ppp_read_secrets(portslave_t)
 ppp_manage_pid_files(portslave_t)
-ppp_pid_filetrans(portslave_t)
+ppp_pid_filetrans(portslave_t, file)
 
 ssh_exec(portslave_t)
 
@@ -113,7 +100,7 @@
 ')
 
 optional_policy(`
-	nis_use_ypbind(portslave_t)
+	mta_send_mail(portslave_t)
 ')
 
 optional_policy(`
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/postfix.fc refpolicy/policy/modules/contrib/postfix.fc
--- refpolicy/policy/modules/contrib/postfix.fc	2012-05-04 16:21:45.000000000 +0200
+++ refpolicy/policy/modules/contrib/postfix.fc	2012-11-17 19:16:01.524042072 +0100
@@ -1,37 +1,39 @@
-# postfix
-/etc/postfix(/.*)?		gen_context(system_u:object_r:postfix_etc_t,s0)
-ifdef(`distro_redhat', `
-/usr/libexec/postfix/.*	--	gen_context(system_u:object_r:postfix_exec_t,s0)
-/usr/libexec/postfix/cleanup --	gen_context(system_u:object_r:postfix_cleanup_exec_t,s0)
-/usr/libexec/postfix/lmtp --	gen_context(system_u:object_r:postfix_smtp_exec_t,s0)
-/usr/libexec/postfix/local --	gen_context(system_u:object_r:postfix_local_exec_t,s0)
-/usr/libexec/postfix/master --	gen_context(system_u:object_r:postfix_master_exec_t,s0)
-/usr/libexec/postfix/pickup --	gen_context(system_u:object_r:postfix_pickup_exec_t,s0)
-/usr/libexec/postfix/(n)?qmgr -- gen_context(system_u:object_r:postfix_qmgr_exec_t,s0)
-/usr/libexec/postfix/showq --	gen_context(system_u:object_r:postfix_showq_exec_t,s0)
-/usr/libexec/postfix/smtp --	gen_context(system_u:object_r:postfix_smtp_exec_t,s0)
-/usr/libexec/postfix/scache --	gen_context(system_u:object_r:postfix_smtp_exec_t,s0)
-/usr/libexec/postfix/smtpd --	gen_context(system_u:object_r:postfix_smtpd_exec_t,s0)
-/usr/libexec/postfix/bounce --	gen_context(system_u:object_r:postfix_bounce_exec_t,s0)
-/usr/libexec/postfix/pipe --	gen_context(system_u:object_r:postfix_pipe_exec_t,s0)
-/usr/libexec/postfix/virtual --	gen_context(system_u:object_r:postfix_virtual_exec_t,s0)
-', `
+/etc/postfix.*	gen_context(system_u:object_r:postfix_etc_t,s0)
+/etc/postfix/postfix-script.*	--	gen_context(system_u:object_r:postfix_exec_t,s0)
+/etc/postfix/prng_exch	--	gen_context(system_u:object_r:postfix_prng_t,s0)
+
+/etc/rc\.d/init\.d/postfix	--	gen_context(system_u:object_r:postfix_initrc_exec_t,s0)
+
 /usr/lib/postfix/.*	--	gen_context(system_u:object_r:postfix_exec_t,s0)
-/usr/lib/postfix/cleanup --	gen_context(system_u:object_r:postfix_cleanup_exec_t,s0)
+/usr/lib/postfix/cleanup	--	gen_context(system_u:object_r:postfix_cleanup_exec_t,s0)
 /usr/lib/postfix/local	--	gen_context(system_u:object_r:postfix_local_exec_t,s0)
 /usr/lib/postfix/master	--	gen_context(system_u:object_r:postfix_master_exec_t,s0)
 /usr/lib/postfix/pickup	--	gen_context(system_u:object_r:postfix_pickup_exec_t,s0)
-/usr/lib/postfix/(n)?qmgr --	gen_context(system_u:object_r:postfix_qmgr_exec_t,s0)
+/usr/lib/postfix/(n)?qmgr	--	gen_context(system_u:object_r:postfix_qmgr_exec_t,s0)
 /usr/lib/postfix/smtp	--	gen_context(system_u:object_r:postfix_smtp_exec_t,s0)
 /usr/lib/postfix/lmtp	--	gen_context(system_u:object_r:postfix_smtp_exec_t,s0)
 /usr/lib/postfix/scache	--	gen_context(system_u:object_r:postfix_smtp_exec_t,s0)
 /usr/lib/postfix/smtpd	--	gen_context(system_u:object_r:postfix_smtpd_exec_t,s0)
 /usr/lib/postfix/bounce	--	gen_context(system_u:object_r:postfix_bounce_exec_t,s0)
 /usr/lib/postfix/pipe	--	gen_context(system_u:object_r:postfix_pipe_exec_t,s0)
-/usr/lib/postfix/virtual --	gen_context(system_u:object_r:postfix_virtual_exec_t,s0)
-')
-/etc/postfix/postfix-script.* -- gen_context(system_u:object_r:postfix_exec_t,s0)
-/etc/postfix/prng_exch	--	gen_context(system_u:object_r:postfix_prng_t,s0)
+/usr/lib/postfix/virtual	--	gen_context(system_u:object_r:postfix_virtual_exec_t,s0)
+
+/usr/libexec/postfix/.*	--	gen_context(system_u:object_r:postfix_exec_t,s0)
+/usr/libexec/postfix/cleanup	--	gen_context(system_u:object_r:postfix_cleanup_exec_t,s0)
+/usr/libexec/postfix/lmtp	--	gen_context(system_u:object_r:postfix_smtp_exec_t,s0)
+/usr/libexec/postfix/local	--	gen_context(system_u:object_r:postfix_local_exec_t,s0)
+/usr/libexec/postfix/master	--	gen_context(system_u:object_r:postfix_master_exec_t,s0)
+/usr/libexec/postfix/pickup	--	gen_context(system_u:object_r:postfix_pickup_exec_t,s0)
+/usr/libexec/postfix/(n)?qmgr	--	gen_context(system_u:object_r:postfix_qmgr_exec_t,s0)
+/usr/libexec/postfix/showq	--	gen_context(system_u:object_r:postfix_showq_exec_t,s0)
+/usr/libexec/postfix/smtp	--	gen_context(system_u:object_r:postfix_smtp_exec_t,s0)
+/usr/libexec/postfix/scache	--	gen_context(system_u:object_r:postfix_smtp_exec_t,s0)
+/usr/libexec/postfix/smtpd	--	gen_context(system_u:object_r:postfix_smtpd_exec_t,s0)
+/usr/libexec/postfix/bounce	--	gen_context(system_u:object_r:postfix_bounce_exec_t,s0)
+/usr/libexec/postfix/pipe	--	gen_context(system_u:object_r:postfix_pipe_exec_t,s0)
+/usr/libexec/postfix/virtual	--	gen_context(system_u:object_r:postfix_virtual_exec_t,s0)
+
+/usr/sbin/postalias	--	gen_context(system_u:object_r:postfix_master_exec_t,s0)
 /usr/sbin/postcat	--	gen_context(system_u:object_r:postfix_master_exec_t,s0)
 /usr/sbin/postdrop	--	gen_context(system_u:object_r:postfix_postdrop_exec_t,s0)
 /usr/sbin/postfix	--	gen_context(system_u:object_r:postfix_master_exec_t,s0)
@@ -42,12 +44,18 @@
 /usr/sbin/postqueue	--	gen_context(system_u:object_r:postfix_postqueue_exec_t,s0)
 /usr/sbin/postsuper	--	gen_context(system_u:object_r:postfix_master_exec_t,s0)
 
-/var/lib/postfix(/.*)?		gen_context(system_u:object_r:postfix_data_t,s0)
+/var/lib/postfix.*	gen_context(system_u:object_r:postfix_data_t,s0)
 
-/var/spool/postfix(/.*)?	gen_context(system_u:object_r:postfix_spool_t,s0)
-/var/spool/postfix/maildrop(/.*)? gen_context(system_u:object_r:postfix_spool_maildrop_t,s0)
+/var/spool/postfix.*	gen_context(system_u:object_r:postfix_spool_t,s0)
+/var/spool/postfix/deferred(/.*)?	-d	gen_context(system_u:object_r:postfix_spool_maildrop_t,s0)
+/var/spool/postfix/defer(/.*)?	gen_context(system_u:object_r:postfix_spool_maildrop_t,s0)
+/var/spool/postfix/maildrop(/.*)?	gen_context(system_u:object_r:postfix_spool_maildrop_t,s0)
 /var/spool/postfix/pid/.*	gen_context(system_u:object_r:postfix_var_run_t,s0)
-/var/spool/postfix/private(/.*)? gen_context(system_u:object_r:postfix_private_t,s0)
-/var/spool/postfix/public(/.*)? gen_context(system_u:object_r:postfix_public_t,s0)
-/var/spool/postfix/bounce(/.*)? gen_context(system_u:object_r:postfix_spool_bounce_t,s0)
+/var/spool/postfix/private(/.*)?	gen_context(system_u:object_r:postfix_private_t,s0)
+/var/spool/postfix/public(/.*)?	gen_context(system_u:object_r:postfix_public_t,s0)
+/var/spool/postfix/bounce(/.*)?	gen_context(system_u:object_r:postfix_spool_bounce_t,s0)
 /var/spool/postfix/flush(/.*)?	gen_context(system_u:object_r:postfix_spool_flush_t,s0)
+
+ifdef(`distro_gentoo',`
+/var/spool/postfix/pid(/.*)?	gen_context(system_u:object_r:postfix_var_run_t,s0)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/postfix.if refpolicy/policy/modules/contrib/postfix.if
--- refpolicy/policy/modules/contrib/postfix.if	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/postfix.if	2012-11-17 12:35:01.071990715 +0100
@@ -1,4 +1,4 @@
-## <summary>Postfix email server</summary>
+## <summary>Postfix email server.</summary>
 
 ########################################
 ## <summary>
@@ -16,138 +16,88 @@
 	')
 ')
 
-########################################
+#######################################
 ## <summary>
-##	Creates types and rules for a basic
-##	postfix process domain.
+##	The template to define a postfix domain.
 ## </summary>
-## <param name="prefix">
+## <param name="domain_prefix">
 ##	<summary>
-##	Prefix for the domain.
+##	Domain prefix to be used.
 ##	</summary>
 ## </param>
 #
 template(`postfix_domain_template',`
-	type postfix_$1_t;
+	gen_require(`
+		attribute postfix_domain;
+	')
+
+	########################################
+	#
+	# Declarations
+	#
+
+	type postfix_$1_t, postfix_domain;
 	type postfix_$1_exec_t;
 	domain_type(postfix_$1_t)
 	domain_entry_file(postfix_$1_t, postfix_$1_exec_t)
 	role system_r types postfix_$1_t;
 
-	dontaudit postfix_$1_t self:capability sys_tty_config;
-	allow postfix_$1_t self:process { signal_perms setpgid };
-	allow postfix_$1_t self:unix_dgram_socket create_socket_perms;
-	allow postfix_$1_t self:unix_stream_socket create_stream_socket_perms;
-	allow postfix_$1_t self:unix_stream_socket connectto;
-
-	allow postfix_master_t postfix_$1_t:process signal;
-	#https://bugzilla.redhat.com/bugzilla/show_bug.cgi?id=244456
-	allow postfix_$1_t postfix_master_t:file read;
-
-	allow postfix_$1_t postfix_etc_t:dir list_dir_perms;
-	read_files_pattern(postfix_$1_t, postfix_etc_t, postfix_etc_t)
-	read_lnk_files_pattern(postfix_$1_t, postfix_etc_t, postfix_etc_t)
+	########################################
+	#
+	# Policy
+	#
 
 	can_exec(postfix_$1_t, postfix_$1_exec_t)
 
-	allow postfix_$1_t postfix_exec_t:file { mmap_file_perms lock ioctl };
-
-	allow postfix_$1_t postfix_master_t:process sigchld;
-
-	allow postfix_$1_t postfix_spool_t:dir list_dir_perms;
-
-	allow postfix_$1_t postfix_var_run_t:file manage_file_perms;
-	files_pid_filetrans(postfix_$1_t, postfix_var_run_t, file)
-
-	kernel_read_system_state(postfix_$1_t)
-	kernel_read_network_state(postfix_$1_t)
-	kernel_read_all_sysctls(postfix_$1_t)
-
-	dev_read_sysfs(postfix_$1_t)
-	dev_read_rand(postfix_$1_t)
-	dev_read_urand(postfix_$1_t)
-
-	fs_search_auto_mountpoints(postfix_$1_t)
-	fs_getattr_xattr_fs(postfix_$1_t)
-	fs_rw_anon_inodefs_files(postfix_$1_t)
-
-	term_dontaudit_use_console(postfix_$1_t)
-
-	corecmd_exec_shell(postfix_$1_t)
-
-	files_read_etc_files(postfix_$1_t)
-	files_read_etc_runtime_files(postfix_$1_t)
-	files_read_usr_symlinks(postfix_$1_t)
-	files_search_spool(postfix_$1_t)
-	files_getattr_tmp_dirs(postfix_$1_t)
-	files_search_all_mountpoints(postfix_$1_t)
-
-	init_dontaudit_use_fds(postfix_$1_t)
-	init_sigchld(postfix_$1_t)
-
 	auth_use_nsswitch(postfix_$1_t)
-
-	logging_send_syslog_msg(postfix_$1_t)
-
-	miscfiles_read_localization(postfix_$1_t)
-	miscfiles_read_generic_certs(postfix_$1_t)
-
-	userdom_dontaudit_use_unpriv_user_fds(postfix_$1_t)
-
-	optional_policy(`
-		udev_read_db(postfix_$1_t)
-	')
 ')
 
-########################################
+#######################################
 ## <summary>
-##	Creates a postfix server process domain.
+##	The template to define a postfix server domain.
 ## </summary>
-## <param name="prefix">
+## <param name="domain_prefix">
 ##	<summary>
-##	Prefix of the domain.
+##	Domain prefix to be used.
 ##	</summary>
 ## </param>
 #
 template(`postfix_server_domain_template',`
+	gen_require(`
+		attribute postfix_server_domain, postfix_server_tmp_content;
+	')
+
+	########################################
+	#
+	# Declarations
+	#
+
 	postfix_domain_template($1)
 
-	type postfix_$1_tmp_t;
+	typeattribute postfix_$1_t postfix_server_domain;
+
+	type postfix_$1_tmp_t, postfix_server_tmp_content;
 	files_tmp_file(postfix_$1_tmp_t)
 
-	allow postfix_$1_t self:capability { setuid setgid dac_override };
-	allow postfix_$1_t postfix_master_t:unix_stream_socket { connectto rw_stream_socket_perms };
-	allow postfix_$1_t self:tcp_socket create_socket_perms;
-	allow postfix_$1_t self:udp_socket create_socket_perms;
+	########################################
+	#
+	# Declarations
+	#
 
 	manage_dirs_pattern(postfix_$1_t, postfix_$1_tmp_t, postfix_$1_tmp_t)
 	manage_files_pattern(postfix_$1_t, postfix_$1_tmp_t, postfix_$1_tmp_t)
 	files_tmp_filetrans(postfix_$1_t, postfix_$1_tmp_t, { file dir })
 
 	domtrans_pattern(postfix_master_t, postfix_$1_exec_t, postfix_$1_t)
-
-	corenet_all_recvfrom_unlabeled(postfix_$1_t)
-	corenet_all_recvfrom_netlabel(postfix_$1_t)
-	corenet_tcp_sendrecv_generic_if(postfix_$1_t)
-	corenet_udp_sendrecv_generic_if(postfix_$1_t)
-	corenet_tcp_sendrecv_generic_node(postfix_$1_t)
-	corenet_udp_sendrecv_generic_node(postfix_$1_t)
-	corenet_tcp_sendrecv_all_ports(postfix_$1_t)
-	corenet_udp_sendrecv_all_ports(postfix_$1_t)
-	corenet_tcp_bind_generic_node(postfix_$1_t)
-	corenet_udp_bind_generic_node(postfix_$1_t)
-	corenet_tcp_connect_all_ports(postfix_$1_t)
-	corenet_sendrecv_all_client_packets(postfix_$1_t)
 ')
 
-########################################
+#######################################
 ## <summary>
-##	Creates a process domain for programs
-##	that are ran by users.
+##	The template to define a postfix user domain.
 ## </summary>
-## <param name="prefix">
+## <param name="domain_prefix">
 ##	<summary>
-##	Prefix of the domain.
+##	Domain prefix to be used.
 ##	</summary>
 ## </param>
 #
@@ -156,10 +106,20 @@
 		attribute postfix_user_domains, postfix_user_domtrans;
 	')
 
+	########################################
+	#
+	# Declarations
+	#
+
 	postfix_domain_template($1)
 
 	typeattribute postfix_$1_t postfix_user_domains;
 
+	########################################
+	#
+	# Policy
+	#
+
 	allow postfix_$1_t self:capability dac_override;
 
 	domtrans_pattern(postfix_user_domtrans, postfix_$1_exec_t, postfix_$1_t)
@@ -169,7 +129,7 @@
 
 ########################################
 ## <summary>
-##	Read postfix configuration files.
+##	Read postfix configuration content.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -183,15 +143,16 @@
 		type postfix_etc_t;
 	')
 
-	read_files_pattern($1, postfix_etc_t, postfix_etc_t)
-	read_lnk_files_pattern($1, postfix_etc_t, postfix_etc_t)
 	files_search_etc($1)
+	allow $1 postfix_etc_t:dir list_dir_perms;
+	allow $1 postfix_etc_t:file read_file_perms;
+	allow $1 postfix_etc_t:lnk_file read_lnk_file_perms;
 ')
 
 ########################################
 ## <summary>
-##	Create files with the specified type in
-##	the postfix configuration directories.
+##	Create specified object in postfix
+##	etc directories with a type transition.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -208,14 +169,18 @@
 ##	The object class of the object being created.
 ##	</summary>
 ## </param>
+## <param name="name" optional="true">
+##	<summary>
+##	The name of the object being created.
+##	</summary>
+## </param>
 #
 interface(`postfix_config_filetrans',`
 	gen_require(`
 		type postfix_etc_t;
 	')
 
-	files_search_etc($1)
-	filetrans_pattern($1, postfix_etc_t, $2, $3)
+	filetrans_pattern($1, postfix_etc_t, $2, $3, $4)
 ')
 
 ########################################
@@ -240,8 +205,7 @@
 
 ########################################
 ## <summary>
-##	Allow read/write postfix local pipes
-##	TCP sockets.
+##	Read and write postfix local pipes.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -259,7 +223,7 @@
 
 ########################################
 ## <summary>
-##	Allow domain to read postfix local process state
+##	Read postfix local process state files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -272,12 +236,34 @@
 		type postfix_local_t;
 	')
 
-	read_files_pattern($1, postfix_local_t, postfix_local_t)
+	kernel_search_proc($1)
+	allow $1 postfix_local_t:dir list_dir_perms;
+	allow $1 postfix_local_t:file read_file_perms;
+	allow $1 postfix_local_t:lnk_file read_lnk_file_perms;
 ')
 
 ########################################
 ## <summary>
-##	Allow domain to read postfix master process state
+##	Read and write inherited postfix master pipes.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`postfix_rw_inherited_master_pipes',`
+	gen_require(`
+		type postfix_master_t;
+	')
+
+	allow $1 postfix_master_t:fd use;
+	allow $1 postfix_master_t:fifo_file { getattr write append lock ioctl read };
+')
+
+########################################
+## <summary>
+##	Read postfix master process state files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -290,7 +276,28 @@
 		type postfix_master_t;
 	')
 
-	read_files_pattern($1, postfix_master_t, postfix_master_t)
+	kernel_search_proc($1)
+	allow $1 postfix_master_t:dir list_dir_perms;
+	allow $1 postfix_master_t:file read_file_perms;
+	allow $1 postfix_master_t:lnk_file read_lnk_file_perms;
+')
+
+########################################
+## <summary>
+##	Use postfix master file descriptors.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`postfix_use_fds_master',`
+	gen_require(`
+		type postfix_master_t;
+	')
+
+	allow $1 postfix_master_t:fd use;
 ')
 
 ########################################
@@ -328,13 +335,15 @@
 		type postfix_map_t, postfix_map_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, postfix_map_exec_t, postfix_map_t)
 ')
 
 ########################################
 ## <summary>
-##	Execute postfix_map in the postfix_map domain, and
-##	allow the specified role the postfix_map domain.
+##	Execute postfix map in the postfix
+##	map domain, and allow the specified
+##	role the postfix_map domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -350,17 +359,17 @@
 #
 interface(`postfix_run_map',`
 	gen_require(`
-		type postfix_map_t;
+		attribute_role postfix_map_roles;
 	')
 
 	postfix_domtrans_map($1)
-	role $2 types postfix_map_t;
+	roleattribute $2 postfix_map_roles;
 ')
 
 ########################################
 ## <summary>
-##	Execute the master postfix program in the
-##	postfix_master domain.
+##	Execute the master postfix program
+##	in the postfix_master domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -373,13 +382,14 @@
 		type postfix_master_t, postfix_master_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, postfix_master_exec_t, postfix_master_t)
 ')
 
 ########################################
 ## <summary>
-##	Execute the master postfix program in the
-##	caller domain.
+##	Execute the master postfix program
+##	in the caller domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -392,12 +402,14 @@
 		type postfix_master_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	can_exec($1, postfix_master_exec_t)
 ')
 
 #######################################
 ## <summary>
-##	Connect to postfix master process using a unix domain stream socket.
+##	Connect to postfix master process
+##	using a unix domain stream socket.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -416,8 +428,24 @@
 
 ########################################
 ## <summary>
+##	Read and write postfix master
+##	unnamed pipes.  (Deprecated)
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`postfix_rw_master_pipes',`
+	refpolicywarn(`$0($*) has been deprecated, use postfix_rw_inherited_master_pipes() instead.')
+	postfix_rw_inherited_master_pipes($1)
+')
+
+########################################
+## <summary>
 ##	Execute the master postdrop in the
-##	postfix_postdrop domain.
+##	postfix postdrop domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -430,13 +458,14 @@
 		type postfix_postdrop_t, postfix_postdrop_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, postfix_postdrop_exec_t, postfix_postdrop_t)
 ')
 
 ########################################
 ## <summary>
 ##	Execute the master postqueue in the
-##	postfix_postqueue domain.
+##	postfix postqueue domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -449,12 +478,14 @@
 		type postfix_postqueue_t, postfix_postqueue_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, postfix_postqueue_exec_t, postfix_postqueue_t)
 ')
 
 #######################################
 ## <summary>
-##	Execute the master postqueue in the caller domain.
+##	Execute the master postqueue in
+##	the caller domain.  (Deprecated)
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -463,16 +494,33 @@
 ## </param>
 #
 interface(`posftix_exec_postqueue',`
+	refpolicywarn(`$0($*) has been deprecated.')
+	postfix_exec_postqueue($1)
+')
+
+#######################################
+## <summary>
+##	Execute postfix postqueue in
+##	the caller domain.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`postfix_exec_postqueue',`
 	gen_require(`
 		type postfix_postqueue_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	can_exec($1, postfix_postqueue_exec_t)
 ')
 
 ########################################
 ## <summary>
-##	Create a named socket in a postfix private directory.
+##	Create postfix private sock files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -485,13 +533,13 @@
 		type postfix_private_t;
 	')
 
-	allow $1 postfix_private_t:dir list_dir_perms;
 	create_sock_files_pattern($1, postfix_private_t, postfix_private_t)
 ')
 
 ########################################
 ## <summary>
-##	manage named socket in a postfix private directory.
+##	Create, read, write, and delete
+##	postfix private sock files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -504,14 +552,13 @@
 		type postfix_private_t;
 	')
 
-	allow $1 postfix_private_t:dir list_dir_perms;
 	manage_sock_files_pattern($1, postfix_private_t, postfix_private_t)
 ')
 
 ########################################
 ## <summary>
-##	Execute the master postfix program in the
-##	postfix_master domain.
+##	Execute the smtp postfix program
+##	in the postfix smtp domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -524,11 +571,32 @@
 		type postfix_smtp_t, postfix_smtp_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, postfix_smtp_exec_t, postfix_smtp_t)
 ')
 
 ########################################
 ## <summary>
+##	Get attributes of all postfix mail
+##	spool files.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`postfix_getattr_all_spool_files',`
+	gen_require(`
+		attribute postfix_spool_type;
+	')
+
+	files_search_spool($1)
+	getattr_files_pattern($1, postfix_spool_type, postfix_spool_type)
+')
+
+########################################
+## <summary>
 ##	Search postfix mail spool directories.
 ## </summary>
 ## <param name="domain">
@@ -542,8 +610,8 @@
 		type postfix_spool_t;
 	')
 
-	allow $1 postfix_spool_t:dir search_dir_perms;
 	files_search_spool($1)
+	allow $1 postfix_spool_t:dir search_dir_perms;
 ')
 
 ########################################
@@ -561,8 +629,8 @@
 		type postfix_spool_t;
 	')
 
-	allow $1 postfix_spool_t:dir list_dir_perms;
 	files_search_spool($1)
+	allow $1 postfix_spool_t:dir list_dir_perms;
 ')
 
 ########################################
@@ -586,7 +654,8 @@
 
 ########################################
 ## <summary>
-##	Create, read, write, and delete postfix mail spool files.
+##	Create, read, write, and delete
+##	postfix mail spool files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -621,3 +690,66 @@
 
 	typeattribute $1 postfix_user_domtrans;
 ')
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an postfix environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`postfix_admin',`
+	gen_require(`
+		attribute postfix_domain, postfix_spool_type, postfix_server_tmp_content;
+		type postfix_initrc_exec_t, postfix_prng_t, postfix_etc_t;
+		type postfix_data_t, postfix_var_run_t, postfix_public_t;
+		type postfix_private_t, postfix_map_tmp_t, postfix_exec_t;
+	')
+
+	allow $1 postfix_domain:process { ptrace signal_perms };
+	ps_process_pattern($1, postfix_domain)
+
+	init_labeled_script_domtrans($1, postfix_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 postfix_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	files_search_etc($1)
+	admin_pattern($1, { postfix_prng_t postfix_etc_t postfix_exec_t })
+
+	files_search_spool($1)
+	admin_pattern($1, { postfix_public_t postfix_private_t postfix_spool_type })
+
+	files_search_var_lib($1)
+	admin_pattern($1, postfix_data_t)
+
+	files_search_pids($1)
+	admin_pattern($1, postfix_var_run_t)
+
+	files_search_tmp($1)
+	admin_pattern($1, { postfix_server_tmp_content postfix_map_tmp_t })
+
+	postfix_run_map($1, $2)
+
+	ifdef(`distro_gentoo',`
+		gen_require(`
+			type postfix_showq_exec_t;
+		')
+	
+		can_exec($1, postfix_showq_exec_t)
+	
+		postfix_exec_master($1)
+		postfix_exec_postqueue($1)
+		postfix_stream_connect_master($1)
+	')
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/postfix.te refpolicy/policy/modules/contrib/postfix.te
--- refpolicy/policy/modules/contrib/postfix.te	2012-07-25 20:33:05.000000000 +0200
+++ refpolicy/policy/modules/contrib/postfix.te	2012-11-17 18:54:06.038039274 +0100
@@ -1,18 +1,31 @@
-policy_module(postfix, 1.14.0)
+policy_module(postfix, 1.14.8)
 
 ########################################
 #
 # Declarations
 #
 
+## <desc>
+##	<p>
+##	Determine whether postfix local
+##	can manage mail spool content.
+##	</p>
+## </desc>
+gen_tunable(postfix_local_write_mail_spool, true)
+
+attribute postfix_domain;
+attribute postfix_server_domain;
+attribute postfix_server_tmp_content;
+attribute postfix_spool_type;
 attribute postfix_user_domains;
-# domains that transition to the
-# postfix user domains
 attribute postfix_user_domtrans;
 
+attribute_role postfix_map_roles;
+roleattribute system_r postfix_map_roles;
+
 postfix_server_domain_template(bounce)
 
-type postfix_spool_bounce_t;
+type postfix_spool_bounce_t, postfix_spool_type;
 files_type(postfix_spool_bounce_t)
 
 postfix_server_domain_template(cleanup)
@@ -26,21 +39,21 @@
 postfix_server_domain_template(local)
 mta_mailserver_delivery(postfix_local_t)
 
-# Program for creating database files
 type postfix_map_t;
 type postfix_map_exec_t;
 application_domain(postfix_map_t, postfix_map_exec_t)
-role system_r types postfix_map_t;
+role postfix_map_roles types postfix_map_t;
 
 type postfix_map_tmp_t;
 files_tmp_file(postfix_map_tmp_t)
 
 postfix_domain_template(master)
 typealias postfix_master_t alias postfix_t;
-# alias is a hack to make the disable trans bool
-# generation macro work
 mta_mailserver(postfix_t, postfix_master_exec_t)
 
+type postfix_initrc_exec_t;
+init_script_file(postfix_initrc_exec_t)
+
 postfix_server_domain_template(pickup)
 
 postfix_server_domain_template(pipe)
@@ -49,6 +62,7 @@
 mta_mailserver_user_agent(postfix_postdrop_t)
 
 postfix_user_domain_template(postqueue)
+mta_mailserver_user_agent(postfix_postqueue_t)
 
 type postfix_private_t;
 files_type(postfix_private_t)
@@ -65,13 +79,13 @@
 
 postfix_server_domain_template(smtpd)
 
-type postfix_spool_t;
+type postfix_spool_t, postfix_spool_type;
 files_type(postfix_spool_t)
 
-type postfix_spool_maildrop_t;
+type postfix_spool_maildrop_t, postfix_spool_type;
 files_type(postfix_spool_maildrop_t)
 
-type postfix_spool_flush_t;
+type postfix_spool_flush_t, postfix_spool_type;
 files_type(postfix_spool_flush_t)
 
 type postfix_public_t;
@@ -80,7 +94,6 @@
 type postfix_var_run_t;
 files_pid_file(postfix_var_run_t)
 
-# the data_directory config parameter
 type postfix_data_t;
 files_type(postfix_data_t)
 
@@ -89,58 +102,162 @@
 
 ########################################
 #
-# Postfix master process local policy
+# Common postfix domain local policy
+#
+
+allow postfix_domain self:capability { sys_nice sys_chroot };
+dontaudit postfix_domain self:capability sys_tty_config;
+allow postfix_domain self:process { signal_perms setpgid setsched };
+allow postfix_domain self:fifo_file rw_fifo_file_perms;
+allow postfix_domain self:unix_stream_socket { accept connectto listen };
+
+allow postfix_domain postfix_etc_t:dir list_dir_perms;
+allow postfix_domain postfix_etc_t:file read_file_perms;
+allow postfix_domain postfix_etc_t:lnk_file read_lnk_file_perms;
+
+allow postfix_domain postfix_master_t:file read_file_perms;
+
+allow postfix_domain postfix_exec_t:file { mmap_file_perms lock };
+
+allow postfix_domain postfix_master_t:process sigchld;
+
+allow postfix_domain postfix_spool_t:dir list_dir_perms;
+
+allow postfix_domain postfix_var_run_t:file manage_file_perms;
+files_pid_filetrans(postfix_domain, postfix_var_run_t, file)
+
+kernel_read_system_state(postfix_domain)
+kernel_read_network_state(postfix_domain)
+kernel_read_all_sysctls(postfix_domain)
+
+dev_read_sysfs(postfix_domain)
+dev_read_rand(postfix_domain)
+dev_read_urand(postfix_domain)
+
+fs_search_auto_mountpoints(postfix_domain)
+fs_getattr_all_fs(postfix_domain)
+fs_rw_anon_inodefs_files(postfix_domain)
+
+term_dontaudit_use_console(postfix_domain)
+
+corecmd_exec_shell(postfix_domain)
+
+files_read_etc_runtime_files(postfix_domain)
+files_read_usr_files(postfix_domain)
+files_search_spool(postfix_domain)
+files_getattr_tmp_dirs(postfix_domain)
+files_search_all_mountpoints(postfix_domain)
+
+init_dontaudit_use_fds(postfix_domain)
+init_sigchld(postfix_domain)
+
+logging_send_syslog_msg(postfix_domain)
+
+miscfiles_read_localization(postfix_domain)
+miscfiles_read_generic_certs(postfix_domain)
+
+userdom_dontaudit_use_unpriv_user_fds(postfix_domain)
+
+ifdef(`distro_gentoo',`
+manage_files_pattern(postfix_domain, postfix_var_run_t, postfix_var_run_t)
+')
+
+optional_policy(`
+	udev_read_db(postfix_domain)
+')
+
+########################################
+#
+# Common postfix server domain local policy
+#
+
+allow postfix_server_domain self:capability { setuid setgid dac_override };
+
+allow postfix_server_domain postfix_master_t:unix_stream_socket { connectto rw_stream_socket_perms };
+
+corenet_all_recvfrom_unlabeled(postfix_server_domain)
+corenet_all_recvfrom_netlabel(postfix_server_domain)
+corenet_tcp_sendrecv_generic_if(postfix_server_domain)
+corenet_tcp_sendrecv_generic_node(postfix_server_domain)
+
+corenet_sendrecv_all_client_packets(postfix_server_domain)
+corenet_tcp_connect_all_ports(postfix_server_domain)
+corenet_tcp_sendrecv_all_ports(postfix_server_domain)
+
+########################################
+#
+# Common postfix user domain local policy
+#
+
+allow postfix_user_domains self:capability dac_override;
+
+domain_use_interactive_fds(postfix_user_domains)
+
+########################################
+#
+# Master local policy
 #
 
-# chown is to set the correct ownership of queue dirs
 allow postfix_master_t self:capability { chown dac_override kill setgid setuid net_bind_service sys_tty_config };
-allow postfix_master_t self:fifo_file rw_fifo_file_perms;
+allow postfix_master_t self:capability2 block_suspend;
+allow postfix_master_t self:process setrlimit;
 allow postfix_master_t self:tcp_socket create_stream_socket_perms;
 allow postfix_master_t self:udp_socket create_socket_perms;
-allow postfix_master_t self:process setrlimit;
 
-allow postfix_master_t postfix_etc_t:file rw_file_perms;
+allow postfix_master_t postfix_domain:fifo_file rw_fifo_file_perms;
+allow postfix_master_t postfix_domain:process signal;
 
-can_exec(postfix_master_t, postfix_exec_t)
+allow postfix_master_t postfix_etc_t:dir rw_dir_perms;
+allow postfix_master_t postfix_etc_t:file rw_file_perms;
 
 allow postfix_master_t postfix_data_t:dir manage_dir_perms;
 allow postfix_master_t postfix_data_t:file manage_file_perms;
 
 allow postfix_master_t postfix_map_exec_t:file { mmap_file_perms ioctl lock };
 
-allow postfix_master_t postfix_postdrop_exec_t:file getattr;
-
-allow postfix_master_t postfix_postqueue_exec_t:file getattr;
-
-manage_fifo_files_pattern(postfix_master_t, postfix_private_t, postfix_private_t)
-manage_sock_files_pattern(postfix_master_t, postfix_private_t, postfix_private_t)
-
-domtrans_pattern(postfix_master_t, postfix_postqueue_exec_t, postfix_postqueue_t)
+allow postfix_master_t { postfix_postdrop_exec_t postfix_postqueue_exec_t }:file getattr_file_perms;
 
 allow postfix_master_t postfix_prng_t:file rw_file_perms;
 
-manage_fifo_files_pattern(postfix_master_t, postfix_public_t, postfix_public_t)
-manage_sock_files_pattern(postfix_master_t, postfix_public_t, postfix_public_t)
-
-domtrans_pattern(postfix_master_t, postfix_showq_exec_t, postfix_showq_t)
-
-# allow access to deferred queue and allow removing bogus incoming entries
 manage_dirs_pattern(postfix_master_t, postfix_spool_t, postfix_spool_t)
 manage_files_pattern(postfix_master_t, postfix_spool_t, postfix_spool_t)
 files_spool_filetrans(postfix_master_t, postfix_spool_t, dir)
 
 allow postfix_master_t postfix_spool_bounce_t:dir manage_dir_perms;
-allow postfix_master_t postfix_spool_bounce_t:file getattr;
+allow postfix_master_t postfix_spool_bounce_t:file getattr_file_perms;
+filetrans_pattern(postfix_master_t, postfix_spool_t, postfix_spool_bounce_t, dir, "bounce")
 
 manage_dirs_pattern(postfix_master_t, postfix_spool_flush_t, postfix_spool_flush_t)
 manage_files_pattern(postfix_master_t, postfix_spool_flush_t, postfix_spool_flush_t)
 manage_lnk_files_pattern(postfix_master_t, postfix_spool_flush_t, postfix_spool_flush_t)
+filetrans_pattern(postfix_master_t, postfix_spool_t, postfix_spool_flush_t, dir, "flush")
 
+create_dirs_pattern(postfix_master_t, postfix_spool_t, postfix_private_t)
+manage_fifo_files_pattern(postfix_master_t, postfix_private_t, postfix_private_t)
+manage_sock_files_pattern(postfix_master_t, postfix_private_t, postfix_private_t)
+setattr_dirs_pattern(postfix_master_t, postfix_private_t, postfix_private_t)
+filetrans_pattern(postfix_master_t, postfix_spool_t, postfix_private_t, dir, "private")
+
+create_dirs_pattern(postfix_master_t, postfix_spool_t, postfix_public_t)
+manage_fifo_files_pattern(postfix_master_t, postfix_public_t, postfix_public_t)
+manage_sock_files_pattern(postfix_master_t, postfix_public_t, postfix_public_t)
+setattr_dirs_pattern(postfix_master_t, postfix_public_t, postfix_public_t)
+filetrans_pattern(postfix_master_t, postfix_spool_t, postfix_public_t, dir, "public")
+
+create_dirs_pattern(postfix_master_t, postfix_spool_t, postfix_spool_maildrop_t)
 delete_files_pattern(postfix_master_t, postfix_spool_maildrop_t, postfix_spool_maildrop_t)
 rename_files_pattern(postfix_master_t, postfix_spool_maildrop_t, postfix_spool_maildrop_t)
 setattr_dirs_pattern(postfix_master_t, postfix_spool_maildrop_t, postfix_spool_maildrop_t)
+filetrans_pattern(postfix_master_t, postfix_spool_t, postfix_spool_maildrop_t, dir, "maildrop")
+
+create_dirs_pattern(postfix_master_t, postfix_spool_t, postfix_var_run_t)
+setattr_dirs_pattern(postfix_master_t, postfix_var_run_t, postfix_var_run_t)
+filetrans_pattern(postfix_master_t, postfix_spool_t, postfix_var_run_t, dir, "pid")
 
-kernel_read_all_sysctls(postfix_master_t)
+can_exec(postfix_master_t, postfix_exec_t)
+
+domtrans_pattern(postfix_master_t, postfix_postqueue_exec_t, postfix_postqueue_t)
+domtrans_pattern(postfix_master_t, postfix_showq_exec_t, postfix_showq_t)
 
 corenet_all_recvfrom_unlabeled(postfix_master_t)
 corenet_all_recvfrom_netlabel(postfix_master_t)
@@ -151,39 +268,54 @@
 corenet_tcp_sendrecv_all_ports(postfix_master_t)
 corenet_udp_sendrecv_all_ports(postfix_master_t)
 corenet_tcp_bind_generic_node(postfix_master_t)
-corenet_tcp_bind_amavisd_send_port(postfix_master_t)
-corenet_tcp_bind_smtp_port(postfix_master_t)
-corenet_tcp_connect_all_ports(postfix_master_t)
+
 corenet_sendrecv_amavisd_send_server_packets(postfix_master_t)
+corenet_tcp_bind_amavisd_send_port(postfix_master_t)
+
 corenet_sendrecv_smtp_server_packets(postfix_master_t)
+corenet_tcp_bind_smtp_port(postfix_master_t)
+
+corenet_sendrecv_spamd_server_packets(postfix_master_t)
+corenet_tcp_bind_spamd_port(postfix_master_t)
+
 corenet_sendrecv_all_client_packets(postfix_master_t)
+corenet_tcp_connect_all_ports(postfix_master_t)
+
+# Can this be conditional?
+corenet_sendrecv_all_server_packets(postfix_master_t)
+corenet_udp_bind_all_unreserved_ports(postfix_master_t)
+corenet_dontaudit_udp_bind_all_ports(postfix_master_t)
 
-# for a find command
 selinux_dontaudit_search_fs(postfix_master_t)
 
-corecmd_exec_shell(postfix_master_t)
 corecmd_exec_bin(postfix_master_t)
 
 domain_use_interactive_fds(postfix_master_t)
 
-files_read_usr_files(postfix_master_t)
+files_search_tmp(postfix_master_t)
+
+mcs_file_read_all(postfix_master_t)
 
 term_dontaudit_search_ptys(postfix_master_t)
 
 miscfiles_read_man_pages(postfix_master_t)
 
 seutil_sigchld_newrole(postfix_master_t)
-# postfix does a "find" on startup for some reason - keep it quiet
 seutil_dontaudit_search_config(postfix_master_t)
 
-mta_rw_aliases(postfix_master_t)
+mta_manage_aliases(postfix_master_t)
+mta_etc_filetrans_aliases(postfix_master_t, file, "aliases")
+mta_etc_filetrans_aliases(postfix_master_t, file, "aliases.db")
+mta_etc_filetrans_aliases(postfix_master_t, file, "aliasesdb-stamp")
+mta_spec_filetrans_aliases(postfix_master_t, postfix_etc_t, file)
 mta_read_sendmail_bin(postfix_master_t)
 mta_getattr_spool(postfix_master_t)
 
-ifdef(`distro_redhat',`
-	# for newer main.cf that uses /etc/aliases
-	mta_manage_aliases(postfix_master_t)
-	mta_etc_filetrans_aliases(postfix_master_t)
+ifdef(`distro_gentoo',`
+	allow postfix_master_t self:capability fowner;
+
+	filetrans_pattern(postfix_master_t, postfix_spool_t, postfix_spool_maildrop_t, dir, "defer")
+	filetrans_pattern(postfix_master_t, postfix_spool_t, postfix_spool_maildrop_t, dir, "deferred")
 ')
 
 optional_policy(`
@@ -195,7 +327,6 @@
 ')
 
 optional_policy(`
-#	for postalias
 	mailman_manage_data_files(postfix_master_t)
 ')
 
@@ -213,32 +344,40 @@
 
 ########################################
 #
-# Postfix bounce local policy
+# Bounce local policy
 #
 
 allow postfix_bounce_t self:capability dac_read_search;
-allow postfix_bounce_t self:tcp_socket create_socket_perms;
 
-allow postfix_bounce_t postfix_public_t:sock_file write;
-allow postfix_bounce_t postfix_public_t:dir search;
+write_sock_files_pattern(postfix_bounce_t, postfix_public_t, postfix_public_t)
 
 manage_dirs_pattern(postfix_bounce_t, postfix_spool_t, postfix_spool_t)
 manage_files_pattern(postfix_bounce_t, postfix_spool_t, postfix_spool_t)
 manage_lnk_files_pattern(postfix_bounce_t, postfix_spool_t, postfix_spool_t)
 files_spool_filetrans(postfix_bounce_t, postfix_spool_t, dir)
 
+manage_files_pattern(postfix_bounce_t, postfix_spool_maildrop_t, postfix_spool_maildrop_t)
+manage_dirs_pattern(postfix_bounce_t, postfix_spool_maildrop_t, postfix_spool_maildrop_t)
+allow postfix_bounce_t postfix_spool_maildrop_t:lnk_file read_lnk_file_perms;
+
 manage_dirs_pattern(postfix_bounce_t, postfix_spool_bounce_t, postfix_spool_bounce_t)
 manage_files_pattern(postfix_bounce_t, postfix_spool_bounce_t, postfix_spool_bounce_t)
 manage_lnk_files_pattern(postfix_bounce_t, postfix_spool_bounce_t, postfix_spool_bounce_t)
 
 ########################################
 #
-# Postfix cleanup local policy
+# Cleanup local policy
 #
 
 allow postfix_cleanup_t self:process setrlimit;
 
-# connect to master process
+allow postfix_cleanup_t postfix_smtpd_t:tcp_socket rw_stream_socket_perms;
+allow postfix_cleanup_t postfix_smtpd_t:unix_stream_socket rw_socket_perms;
+
+allow postfix_cleanup_t postfix_spool_maildrop_t:dir list_dir_perms;
+allow postfix_cleanup_t postfix_spool_maildrop_t:file read_file_perms;
+allow postfix_cleanup_t postfix_spool_maildrop_t:lnk_file read_lnk_file_perms;
+
 stream_connect_pattern(postfix_cleanup_t, postfix_private_t, postfix_private_t, postfix_master_t)
 
 rw_fifo_files_pattern(postfix_cleanup_t, postfix_public_t, postfix_public_t)
@@ -253,6 +392,10 @@
 
 corecmd_exec_bin(postfix_cleanup_t)
 
+corenet_sendrecv_kismet_client_packets(postfix_cleanup_t)
+corenet_tcp_connect_kismet_port(postfix_cleanup_t)
+corenet_tcp_sendrecv_kismet_port(postfix_cleanup_t)
+
 mta_read_aliases(postfix_cleanup_t)
 
 optional_policy(`
@@ -261,35 +404,32 @@
 
 ########################################
 #
-# Postfix local local policy
+# Local local policy
 #
 
-allow postfix_local_t self:fifo_file rw_fifo_file_perms;
-allow postfix_local_t self:process { setsched setrlimit };
+allow postfix_local_t self:capability chown;
+allow postfix_local_t self:process setrlimit;
 
-# connect to master process
 stream_connect_pattern(postfix_local_t, postfix_public_t, postfix_public_t, postfix_master_t)
 
-# for .forward - maybe we need a new type for it?
 rw_sock_files_pattern(postfix_local_t, postfix_private_t, postfix_private_t)
 
 allow postfix_local_t postfix_spool_t:file rw_file_perms;
 
-corecmd_exec_shell(postfix_local_t)
-corecmd_exec_bin(postfix_local_t)
+domtrans_pattern(postfix_local_t, postfix_postdrop_exec_t, postfix_postdrop_t)
 
-files_read_etc_files(postfix_local_t)
+corecmd_exec_bin(postfix_local_t)
 
 logging_dontaudit_search_logs(postfix_local_t)
 
-mta_read_aliases(postfix_local_t)
 mta_delete_spool(postfix_local_t)
-# For reading spamassasin
+mta_read_aliases(postfix_local_t)
 mta_read_config(postfix_local_t)
+mta_send_mail(postfix_local_t)
 
-domtrans_pattern(postfix_local_t, postfix_postdrop_exec_t, postfix_postdrop_t)
-# Might be a leak, but I need a postfix expert to explain
-allow postfix_postdrop_t postfix_local_t:unix_stream_socket { read write };
+tunable_policy(`postfix_local_write_mail_spool',`
+	mta_manage_spool(postfix_local_t)
+')
 
 optional_policy(`
 	clamav_search_lib(postfix_local_t)
@@ -297,29 +437,47 @@
 ')
 
 optional_policy(`
-#	for postalias
+	dovecot_domtrans_deliver(postfix_local_t)
+')
+
+optional_policy(`
+	dspam_domtrans(postfix_local_t)
+')
+
+optional_policy(`
 	mailman_manage_data_files(postfix_local_t)
 	mailman_append_log(postfix_local_t)
 	mailman_read_log(postfix_local_t)
 ')
 
 optional_policy(`
+	nagios_search_spool(postfix_local_t)
+')
+
+optional_policy(`
 	procmail_domtrans(postfix_local_t)
 ')
 
+optional_policy(`
+	sendmail_rw_pipes(postfix_local_t)
+')
+
+optional_policy(`
+	zarafa_domtrans_deliver(postfix_local_t)
+	zarafa_stream_connect_server(postfix_local_t)
+')
+
 ########################################
 #
-# Postfix map local policy
+# Map local policy
 #
+
 allow postfix_map_t self:capability { dac_override setgid setuid };
-allow postfix_map_t self:unix_stream_socket create_stream_socket_perms;
-allow postfix_map_t self:unix_dgram_socket create_socket_perms;
-allow postfix_map_t self:tcp_socket create_stream_socket_perms;
-allow postfix_map_t self:udp_socket create_socket_perms;
-
-manage_dirs_pattern(postfix_map_t, postfix_etc_t, postfix_etc_t)
-manage_files_pattern(postfix_map_t, postfix_etc_t, postfix_etc_t)
-manage_lnk_files_pattern(postfix_map_t, postfix_etc_t, postfix_etc_t)
+allow postfix_map_t self:tcp_socket { accept listen };
+
+allow postfix_map_t postfix_etc_t:dir manage_dir_perms;
+allow postfix_map_t postfix_etc_t:file manage_file_perms;
+allow postfix_map_t postfix_etc_t:lnk_file manage_lnk_file_perms;
 
 manage_dirs_pattern(postfix_map_t, postfix_map_tmp_t, postfix_map_tmp_t)
 manage_files_pattern(postfix_map_t, postfix_map_tmp_t, postfix_map_tmp_t)
@@ -332,13 +490,11 @@
 corenet_all_recvfrom_unlabeled(postfix_map_t)
 corenet_all_recvfrom_netlabel(postfix_map_t)
 corenet_tcp_sendrecv_generic_if(postfix_map_t)
-corenet_udp_sendrecv_generic_if(postfix_map_t)
 corenet_tcp_sendrecv_generic_node(postfix_map_t)
-corenet_udp_sendrecv_generic_node(postfix_map_t)
-corenet_tcp_sendrecv_all_ports(postfix_map_t)
-corenet_udp_sendrecv_all_ports(postfix_map_t)
-corenet_tcp_connect_all_ports(postfix_map_t)
+
 corenet_sendrecv_all_client_packets(postfix_map_t)
+corenet_tcp_connect_all_ports(postfix_map_t)
+corenet_tcp_sendrecv_all_ports(postfix_map_t)
 
 corecmd_list_bin(postfix_map_t)
 corecmd_read_bin_symlinks(postfix_map_t)
@@ -348,7 +504,6 @@
 
 files_list_home(postfix_map_t)
 files_read_usr_files(postfix_map_t)
-files_read_etc_files(postfix_map_t)
 files_read_etc_runtime_files(postfix_map_t)
 files_dontaudit_search_var(postfix_map_t)
 
@@ -363,34 +518,35 @@
 ')
 
 optional_policy(`
-#	for postalias
 	mailman_manage_data_files(postfix_map_t)
 ')
 
 ########################################
 #
-# Postfix pickup local policy
+# Pickup local policy
 #
 
-allow postfix_pickup_t self:tcp_socket create_socket_perms;
-
 stream_connect_pattern(postfix_pickup_t, postfix_private_t, postfix_private_t, postfix_master_t)
 
 rw_fifo_files_pattern(postfix_pickup_t, postfix_public_t, postfix_public_t)
 rw_sock_files_pattern(postfix_pickup_t, postfix_public_t, postfix_public_t)
 
-postfix_list_spool(postfix_pickup_t)
+allow postfix_pickup_t postfix_spool_t:dir list_dir_perms;
+read_files_pattern(postfix_pickup_t, postfix_spool_t, postfix_spool_t)
+delete_files_pattern(postfix_pickup_t, postfix_spool_t, postfix_spool_t)
 
 allow postfix_pickup_t postfix_spool_maildrop_t:dir list_dir_perms;
 read_files_pattern(postfix_pickup_t, postfix_spool_maildrop_t, postfix_spool_maildrop_t)
 delete_files_pattern(postfix_pickup_t, postfix_spool_maildrop_t, postfix_spool_maildrop_t)
 
+mcs_file_read_all(postfix_pickup_t)
+mcs_file_write_all(postfix_pickup_t)
+
 ########################################
 #
-# Postfix pipe local policy
+# Pipe local policy
 #
 
-allow postfix_pipe_t self:fifo_file rw_fifo_file_perms;
 allow postfix_pipe_t self:process setrlimit;
 
 write_sock_files_pattern(postfix_pipe_t, postfix_private_t, postfix_private_t)
@@ -401,6 +557,8 @@
 
 domtrans_pattern(postfix_pipe_t, postfix_postdrop_exec_t, postfix_postdrop_t)
 
+corecmd_exec_bin(postfix_pipe_t)
+
 optional_policy(`
 	dovecot_domtrans_deliver(postfix_pipe_t)
 ')
@@ -420,6 +578,7 @@
 
 optional_policy(`
 	spamassassin_domtrans_client(postfix_pipe_t)
+	spamassassin_kill_client(postfix_pipe_t)
 ')
 
 optional_policy(`
@@ -428,21 +587,19 @@
 
 ########################################
 #
-# Postfix postdrop local policy
+# Postdrop local policy
 #
 
-# usually it does not need a UDP socket
 allow postfix_postdrop_t self:capability sys_resource;
-allow postfix_postdrop_t self:tcp_socket create;
-allow postfix_postdrop_t self:udp_socket create_socket_perms;
 
 rw_fifo_files_pattern(postfix_postdrop_t, postfix_public_t, postfix_public_t)
 
-postfix_list_spool(postfix_postdrop_t)
 manage_files_pattern(postfix_postdrop_t, postfix_spool_maildrop_t, postfix_spool_maildrop_t)
 
-corenet_udp_sendrecv_generic_if(postfix_postdrop_t)
-corenet_udp_sendrecv_generic_node(postfix_postdrop_t)
+allow postfix_postdrop_t postfix_local_t:unix_stream_socket { read write };
+
+mcs_file_read_all(postfix_postdrop_t)
+mcs_file_write_all(postfix_postdrop_t)
 
 term_dontaudit_use_all_ptys(postfix_postdrop_t)
 term_dontaudit_use_all_ttys(postfix_postdrop_t)
@@ -457,7 +614,6 @@
 	cron_system_entry(postfix_postdrop_t, postfix_postdrop_exec_t)
 ')
 
-# https://bugzilla.redhat.com/bugzilla/show_bug.cgi?id=239951
 optional_policy(`
 	fstools_read_pipes(postfix_postdrop_t)
 ')
@@ -472,21 +628,15 @@
 
 #######################################
 #
-# Postfix postqueue local policy
+# Postqueue local policy
 #
 
-allow postfix_postqueue_t self:tcp_socket create;
-allow postfix_postqueue_t self:udp_socket { create ioctl };
-
-# wants to write to /var/spool/postfix/public/showq
 stream_connect_pattern(postfix_postqueue_t, postfix_public_t, postfix_public_t, postfix_master_t)
 
-# write to /var/spool/postfix/public/qmgr
 write_fifo_files_pattern(postfix_postqueue_t, postfix_public_t, postfix_public_t)
 
 domtrans_pattern(postfix_postqueue_t, postfix_showq_exec_t, postfix_showq_t)
 
-# to write the mailq output, it really should not need read access!
 term_use_all_ptys(postfix_postqueue_t)
 term_use_all_ttys(postfix_postqueue_t)
 
@@ -504,94 +654,105 @@
 
 ########################################
 #
-# Postfix qmgr local policy
+# Qmgr local policy
 #
 
+allow postfix_qmgr_t postfix_spool_bounce_t:dir list_dir_perms;
+allow postfix_qmgr_t postfix_spool_bounce_t:file read_file_perms;
+allow postfix_qmgr_t postfix_spool_bounce_t:lnk_file read_lnk_file_perms;
+
 stream_connect_pattern(postfix_qmgr_t, { postfix_private_t postfix_public_t }, { postfix_private_t postfix_public_t }, postfix_master_t)
 
 rw_fifo_files_pattern(postfix_qmgr_t, postfix_public_t, postfix_public_t)
 
-# for /var/spool/postfix/active
+manage_files_pattern(postfix_qmgr_t, postfix_spool_maildrop_t, postfix_spool_maildrop_t)
+manage_dirs_pattern(postfix_qmgr_t, postfix_spool_maildrop_t, postfix_spool_maildrop_t)
+allow postfix_qmgr_t postfix_spool_maildrop_t:lnk_file read_lnk_file_perms;
+
 manage_dirs_pattern(postfix_qmgr_t, postfix_spool_t, postfix_spool_t)
 manage_files_pattern(postfix_qmgr_t, postfix_spool_t, postfix_spool_t)
 manage_lnk_files_pattern(postfix_qmgr_t, postfix_spool_t, postfix_spool_t)
 files_spool_filetrans(postfix_qmgr_t, postfix_spool_t, dir)
 
-allow postfix_qmgr_t postfix_spool_bounce_t:dir list_dir_perms;
-allow postfix_qmgr_t postfix_spool_bounce_t:file read_file_perms;
-allow postfix_qmgr_t postfix_spool_bounce_t:lnk_file { getattr read };
-
 corecmd_exec_bin(postfix_qmgr_t)
 
 ########################################
 #
-# Postfix showq local policy
+# Showq local policy
 #
 
 allow postfix_showq_t self:capability { setuid setgid };
-allow postfix_showq_t self:tcp_socket create_socket_perms;
 
 allow postfix_showq_t postfix_master_t:unix_stream_socket { accept rw_socket_perms };
 
-allow postfix_showq_t postfix_spool_t:file read_file_perms;
-
-postfix_list_spool(postfix_showq_t)
-
 allow postfix_showq_t postfix_spool_maildrop_t:dir list_dir_perms;
 allow postfix_showq_t postfix_spool_maildrop_t:file read_file_perms;
-allow postfix_showq_t postfix_spool_maildrop_t:lnk_file { getattr read };
+allow postfix_showq_t postfix_spool_maildrop_t:lnk_file read_lnk_file_perms;
+
+allow postfix_showq_t postfix_spool_t:file read_file_perms;
+
+mcs_file_read_all(postfix_showq_t)
 
-# to write the mailq output, it really should not need read access!
 term_use_all_ptys(postfix_showq_t)
 term_use_all_ttys(postfix_showq_t)
 
 ########################################
 #
-# Postfix smtp delivery local policy
+# Smtp delivery local policy
 #
 
-# connect to master process
 allow postfix_smtp_t self:capability sys_chroot;
-stream_connect_pattern(postfix_smtp_t, { postfix_private_t postfix_public_t }, { postfix_private_t postfix_public_t }, postfix_master_t)
 
-allow postfix_smtp_t postfix_prng_t:file rw_file_perms;
+stream_connect_pattern(postfix_smtp_t, { postfix_private_t postfix_public_t }, { postfix_private_t postfix_public_t }, postfix_master_t)
 
-allow postfix_smtp_t postfix_spool_t:file rw_file_perms;
+allow postfix_smtp_t { postfix_prng_t postfix_spool_t }:file rw_file_perms;
 
-files_search_all_mountpoints(postfix_smtp_t)
+rw_files_pattern(postfix_smtp_t, postfix_spool_maildrop_t, postfix_spool_maildrop_t)
 
 optional_policy(`
 	cyrus_stream_connect(postfix_smtp_t)
 ')
 
 optional_policy(`
+	dovecot_stream_connect(postfix_smtp_t)
+')
+
+optional_policy(`
+	dspam_stream_connect(postfix_smtp_t)
+')
+
+optional_policy(`
 	milter_stream_connect_all(postfix_smtp_t)
 ')
 
 ########################################
 #
-# Postfix smtpd local policy
+# Smtpd local policy
 #
+
 allow postfix_smtpd_t postfix_master_t:tcp_socket rw_stream_socket_perms;
 
-# connect to master process
 stream_connect_pattern(postfix_smtpd_t, { postfix_private_t postfix_public_t }, { postfix_private_t postfix_public_t }, postfix_master_t)
 
-# Connect to policy server
-corenet_tcp_connect_postfix_policyd_port(postfix_smtpd_t)
-
-# for prng_exch
-allow postfix_smtpd_t postfix_spool_t:file rw_file_perms;
+manage_dirs_pattern(postfix_smtpd_t, postfix_spool_t, postfix_spool_t)
+manage_files_pattern(postfix_smtpd_t, postfix_spool_t, postfix_spool_t)
+manage_lnk_files_pattern(postfix_smtpd_t, postfix_spool_t, postfix_spool_t)
 allow postfix_smtpd_t postfix_prng_t:file rw_file_perms;
 
+corenet_sendrecv_postfix_policyd_client_packets(postfix_smtpd_t)
+corenet_tcp_connect_postfix_policyd_port(postfix_smtpd_t)
+corenet_tcp_sendrecv_postfix_policyd_port(postfix_smtpd_t)
+
 corecmd_exec_bin(postfix_smtpd_t)
 
-# for OpenSSL certificates
-files_read_usr_files(postfix_smtpd_t)
+fs_getattr_all_dirs(postfix_smtpd_t)
+fs_getattr_all_fs(postfix_smtpd_t)
+
 mta_read_aliases(postfix_smtpd_t)
 
 optional_policy(`
 	dovecot_stream_connect_auth(postfix_smtpd_t)
+	dovecot_stream_connect(postfix_smtpd_t)
 ')
 
 optional_policy(`
@@ -599,6 +760,10 @@
 ')
 
 optional_policy(`
+	milter_stream_connect_all(postfix_smtpd_t)
+')
+
+optional_policy(`
 	postgrey_stream_connect(postfix_smtpd_t)
 ')
 
@@ -606,27 +771,31 @@
 	sasl_connect(postfix_smtpd_t)
 ')
 
+optional_policy(`
+	spamassassin_read_spamd_pid_files(postfix_smtpd_t)
+	spamassassin_stream_connect_spamd(postfix_smtpd_t)
+')
+
 ########################################
 #
-# Postfix virtual local policy
+# Virtual local policy
 #
 
-allow postfix_virtual_t self:fifo_file rw_fifo_file_perms;
-allow postfix_virtual_t self:process { setsched setrlimit };
+allow postfix_virtual_t self:process setrlimit;
 
 allow postfix_virtual_t postfix_spool_t:file rw_file_perms;
 
-# connect to master process
 stream_connect_pattern(postfix_virtual_t, { postfix_private_t postfix_public_t }, { postfix_private_t postfix_public_t }, postfix_master_t)
 
-corecmd_exec_shell(postfix_virtual_t)
 corecmd_exec_bin(postfix_virtual_t)
 
-files_read_etc_files(postfix_virtual_t)
-files_read_usr_files(postfix_virtual_t)
-
 mta_read_aliases(postfix_virtual_t)
 mta_delete_spool(postfix_virtual_t)
-# For reading spamassasin
 mta_read_config(postfix_virtual_t)
 mta_manage_spool(postfix_virtual_t)
+
+userdom_manage_user_home_dirs(postfix_virtual_t)
+userdom_manage_user_home_content_dirs(postfix_virtual_t)
+userdom_manage_user_home_content_files(postfix_virtual_t)
+userdom_home_filetrans_user_home_dir(postfix_virtual_t)
+userdom_user_home_dir_filetrans_user_home_content(postfix_virtual_t, { file dir })
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/postfixpolicyd.fc refpolicy/policy/modules/contrib/postfixpolicyd.fc
--- refpolicy/policy/modules/contrib/postfixpolicyd.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/postfixpolicyd.fc	2012-10-19 14:38:42.277529183 +0200
@@ -1,6 +1,7 @@
-/etc/policyd.conf		--	gen_context(system_u:object_r:postfix_policyd_conf_t, s0)
-/etc/rc\.d/init\.d/postfixpolicyd --	gen_context(system_u:object_r:postfix_policyd_initrc_exec_t,s0)
+/etc/policyd\.conf	--	gen_context(system_u:object_r:postfix_policyd_conf_t,s0)
 
-/usr/sbin/policyd		--	gen_context(system_u:object_r:postfix_policyd_exec_t, s0)
+/etc/rc\.d/init\.d/postfixpolicyd	--	gen_context(system_u:object_r:postfix_policyd_initrc_exec_t,s0)
 
-/var/run/policyd\.pid		--	gen_context(system_u:object_r:postfix_policyd_var_run_t, s0)
+/usr/sbin/policyd	--	gen_context(system_u:object_r:postfix_policyd_exec_t,s0)
+
+/var/run/policyd\.pid	--	gen_context(system_u:object_r:postfix_policyd_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/postfixpolicyd.if refpolicy/policy/modules/contrib/postfixpolicyd.if
--- refpolicy/policy/modules/contrib/postfixpolicyd.if	2012-05-04 15:16:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/postfixpolicyd.if	2012-10-19 14:38:42.278529183 +0200
@@ -1,9 +1,9 @@
-## <summary>Postfix policy server</summary>
+## <summary>Postfix policy server.</summary>
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate 
-##	an postfixpolicyd environment
+##	All of the rules required to administrate
+##	an postfixpolicyd environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -12,7 +12,7 @@
 ## </param>
 ## <param name="role">
 ##	<summary>
-##	The role to be allowed to manage the postfixpolicyd domain.
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <rolecap/>
@@ -20,8 +20,7 @@
 interface(`postfixpolicyd_admin',`
 	gen_require(`
 		type postfix_policyd_t, postfix_policyd_conf_t;
-		type postfix_policyd_var_run_t;
-		type postfix_policyd_initrc_exec_t;	
+		type postfix_policyd_var_run_t, postfix_policyd_initrc_exec_t;
 	')
 
 	allow $1 postfix_policyd_t:process { ptrace signal_perms };
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/postfixpolicyd.te refpolicy/policy/modules/contrib/postfixpolicyd.te
--- refpolicy/policy/modules/contrib/postfixpolicyd.te	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/postfixpolicyd.te	2012-10-19 14:38:42.278529183 +0200
@@ -1,4 +1,4 @@
-policy_module(postfixpolicyd, 1.2.0)
+policy_module(postfixpolicyd, 1.2.1)
 
 ########################################
 #
@@ -20,17 +20,16 @@
 
 ########################################
 #
-# Local Policy
+# Local policy
 #
 
-allow postfix_policyd_t self:tcp_socket create_stream_socket_perms;
 allow postfix_policyd_t self:capability { sys_resource sys_chroot setgid setuid };
 allow postfix_policyd_t self:process setrlimit;
-allow postfix_policyd_t self:unix_dgram_socket { connect create write};
+allow postfix_policyd_t self:tcp_socket { accept listen };
 
 allow postfix_policyd_t postfix_policyd_conf_t:dir list_dir_perms;
 allow postfix_policyd_t postfix_policyd_conf_t:file read_file_perms;
-allow postfix_policyd_t postfix_policyd_conf_t:lnk_file { getattr read };
+allow postfix_policyd_t postfix_policyd_conf_t:lnk_file read_lnk_file_perms;
 
 manage_files_pattern(postfix_policyd_t, postfix_policyd_var_run_t, postfix_policyd_var_run_t)
 files_pid_filetrans(postfix_policyd_t, postfix_policyd_var_run_t, file)
@@ -38,10 +37,15 @@
 corenet_all_recvfrom_unlabeled(postfix_policyd_t)
 corenet_tcp_sendrecv_generic_if(postfix_policyd_t)
 corenet_tcp_sendrecv_generic_node(postfix_policyd_t)
-corenet_tcp_sendrecv_all_ports(postfix_policyd_t)
 corenet_tcp_bind_generic_node(postfix_policyd_t)
+
+corenet_sendrecv_postfix_policyd_server_packets(postfix_policyd_t)
 corenet_tcp_bind_postfix_policyd_port(postfix_policyd_t)
+corenet_tcp_sendrecv_postfix_policyd_port(postfix_policyd_t)
+
+corenet_sendrecv_mysqld_server_packets(postfix_policyd_t)
 corenet_tcp_bind_mysqld_port(postfix_policyd_t)
+corenet_tcp_sendrecv_mysqld_port(postfix_policyd_t)
 
 files_read_etc_files(postfix_policyd_t)
 files_read_usr_files(postfix_policyd_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/postgrey.fc refpolicy/policy/modules/contrib/postgrey.fc
--- refpolicy/policy/modules/contrib/postgrey.fc	2012-05-04 15:15:21.000000000 +0200
+++ refpolicy/policy/modules/contrib/postgrey.fc	2012-10-19 14:38:44.531529188 +0200
@@ -1,12 +1,12 @@
+/etc/postgrey(/.*)?	gen_context(system_u:object_r:postgrey_etc_t,s0)
 
-/etc/postgrey(/.*)?		gen_context(system_u:object_r:postgrey_etc_t,s0)
-/etc/rc\.d/init\.d/postgrey --	gen_context(system_u:object_r:postgrey_initrc_exec_t,s0)
+/etc/rc\.d/init\.d/postgrey	--	gen_context(system_u:object_r:postgrey_initrc_exec_t,s0)
 
 /usr/sbin/postgrey	--	gen_context(system_u:object_r:postgrey_exec_t,s0)
 
-/var/lib/postgrey(/.*)?		gen_context(system_u:object_r:postgrey_var_lib_t,s0)
+/var/lib/postgrey(/.*)?	gen_context(system_u:object_r:postgrey_var_lib_t,s0)
 
-/var/run/postgrey(/.*)?		gen_context(system_u:object_r:postgrey_var_run_t,s0)
+/var/run/postgrey(/.*)?	gen_context(system_u:object_r:postgrey_var_run_t,s0)
 /var/run/postgrey\.pid	--	gen_context(system_u:object_r:postgrey_var_run_t,s0)
 
-/var/spool/postfix/postgrey(/.*)? gen_context(system_u:object_r:postgrey_spool_t,s0)
+/var/spool/postfix/postgrey(/.*)?	gen_context(system_u:object_r:postgrey_spool_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/postgrey.if refpolicy/policy/modules/contrib/postgrey.if
--- refpolicy/policy/modules/contrib/postgrey.if	2012-05-04 15:16:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/postgrey.if	2012-10-19 14:38:44.532529188 +0200
@@ -1,8 +1,9 @@
-## <summary>Postfix grey-listing server</summary>
+## <summary>Postfix grey-listing server.</summary>
 
 ########################################
 ## <summary>
-##	Write to postgrey socket
+##	Connect to postgrey using a unix
+##	domain stream socket.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -15,14 +16,14 @@
 		type postgrey_var_run_t, postgrey_t, postgrey_spool_t;
 	')
 
-	stream_connect_pattern($1, postgrey_var_run_t, postgrey_var_run_t, postgrey_t)
-	stream_connect_pattern($1, postgrey_spool_t, postgrey_spool_t, postgrey_t)
 	files_search_pids($1)
+	files_search_spool($1)
+	stream_connect_pattern($1, { postgrey_spool_t postgrey_var_run_t }, { postgrey_spool_t postgrey_var_run_t }, postgrey_t)
 ')
 
 ########################################
 ## <summary>
-##	Search the spool directory
+##	Search spool directories.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -35,13 +36,14 @@
 		type postgrey_spool_t;
 	')
 
+	files_search_spool($1)
 	allow $1 postgrey_spool_t:dir search_dir_perms;
 ')
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate 
-##	an postgrey environment
+##	All of the rules required to
+##	administrate an postgrey environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -50,14 +52,14 @@
 ## </param>
 ## <param name="role">
 ##	<summary>
-##	The role to be allowed to manage the postgrey domain.
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <rolecap/>
 #
 interface(`postgrey_admin',`
 	gen_require(`
-		type postgrey_t, postgrey_etc_t;
+		type postgrey_t, postgrey_etc_t, postgrey_spool_t;
 		type postgrey_var_lib_t, postgrey_var_run_t;
 		type postgrey_initrc_exec_t;
 	')
@@ -76,6 +78,9 @@
 	files_list_var_lib($1)
 	admin_pattern($1, postgrey_var_lib_t)
 
+	files_list_spool($1)
+	admin_pattern($1, postgrey_spool_t)
+
 	files_list_pids($1)
 	admin_pattern($1, postgrey_var_run_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/postgrey.te refpolicy/policy/modules/contrib/postgrey.te
--- refpolicy/policy/modules/contrib/postgrey.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/postgrey.te	2012-10-19 14:38:44.532529188 +0200
@@ -1,4 +1,4 @@
-policy_module(postgrey, 1.8.0)
+policy_module(postgrey, 1.8.1)
 
 ########################################
 #
@@ -32,12 +32,12 @@
 allow postgrey_t self:capability { chown dac_override setgid setuid };
 dontaudit postgrey_t self:capability sys_tty_config;
 allow postgrey_t self:process signal_perms;
-allow postgrey_t self:tcp_socket create_stream_socket_perms;
 allow postgrey_t self:fifo_file create_fifo_file_perms;
+allow postgrey_t self:tcp_socket create_stream_socket_perms;
 
 allow postgrey_t postgrey_etc_t:dir list_dir_perms;
-read_files_pattern(postgrey_t, postgrey_etc_t, postgrey_etc_t)
-read_lnk_files_pattern(postgrey_t, postgrey_etc_t, postgrey_etc_t)
+allow postgrey_t postgrey_etc_t:file read_file_perms;
+allow postgrey_t postgrey_etc_t:lnk_file read_lnk_file_perms;
 
 manage_dirs_pattern(postgrey_t, postgrey_spool_t, postgrey_spool_t)
 manage_files_pattern(postgrey_t, postgrey_spool_t, postgrey_spool_t)
@@ -55,17 +55,17 @@
 kernel_read_system_state(postgrey_t)
 kernel_read_kernel_sysctls(postgrey_t)
 
-# for perl
 corecmd_search_bin(postgrey_t)
 
 corenet_all_recvfrom_unlabeled(postgrey_t)
 corenet_all_recvfrom_netlabel(postgrey_t)
 corenet_tcp_sendrecv_generic_if(postgrey_t)
 corenet_tcp_sendrecv_generic_node(postgrey_t)
-corenet_tcp_sendrecv_all_ports(postgrey_t)
 corenet_tcp_bind_generic_node(postgrey_t)
-corenet_tcp_bind_postgrey_port(postgrey_t)
+
 corenet_sendrecv_postgrey_server_packets(postgrey_t)
+corenet_tcp_bind_postgrey_port(postgrey_t)
+corenet_tcp_sendrecv_postgrey_port(postgrey_t)
 
 dev_read_urand(postgrey_t)
 dev_read_sysfs(postgrey_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/ppp.fc refpolicy/policy/modules/contrib/ppp.fc
--- refpolicy/policy/modules/contrib/ppp.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/ppp.fc	2012-10-19 14:38:47.501529194 +0200
@@ -1,38 +1,30 @@
-#
-# /etc
-#
-/etc/rc\.d/init\.d/ppp		--	gen_context(system_u:object_r:pppd_initrc_exec_t,s0)
-
-/etc/ppp			-d	gen_context(system_u:object_r:pppd_etc_t,s0)
-/etc/ppp(/.*)?			--	gen_context(system_u:object_r:pppd_etc_rw_t,s0)
-/etc/ppp/peers(/.*)?			gen_context(system_u:object_r:pppd_etc_rw_t,s0)
-/etc/ppp/.*secrets		--	gen_context(system_u:object_r:pppd_secret_t,s0)
-/etc/ppp/resolv\.conf 		--	gen_context(system_u:object_r:pppd_etc_rw_t,s0)
-# Fix /etc/ppp {up,down} family scripts (see man pppd)
-/etc/ppp/(auth|ip(v6|x)?)-(up|down) --	gen_context(system_u:object_r:pppd_initrc_exec_t,s0)
-
-/root/.ppprc			--	gen_context(system_u:object_r:pppd_etc_t,s0)
-
-#
-# /sbin
-#
-/sbin/ppp-watch			--	gen_context(system_u:object_r:pppd_exec_t,s0)
-
-#
-# /usr
-#
-/usr/sbin/pppd			--	gen_context(system_u:object_r:pppd_exec_t,s0)
-/usr/sbin/pptp 			--	gen_context(system_u:object_r:pptp_exec_t,s0)
-/usr/sbin/ipppd			--	gen_context(system_u:object_r:pppd_exec_t,s0)
-
-#
-# /var
-#
-/var/run/(i)?ppp.*pid[^/]*	--	gen_context(system_u:object_r:pppd_var_run_t,s0)
-/var/run/pppd[0-9]*\.tdb	--	gen_context(system_u:object_r:pppd_var_run_t,s0)
-/var/run/ppp(/.*)?			gen_context(system_u:object_r:pppd_var_run_t,s0)
-# Fix pptp sockets
-/var/run/pptp(/.*)?			gen_context(system_u:object_r:pptp_var_run_t,s0)
+HOME_DIR/\.ppprc	--	gen_context(system_u:object_r:ppp_home_t,s0)
+
+/etc/rc\.d/init\.d/ppp	--	gen_context(system_u:object_r:pppd_initrc_exec_t,s0)
+
+/etc/ppp	-d	gen_context(system_u:object_r:pppd_etc_t,s0)
+/etc/ppp(/.*)?	--	gen_context(system_u:object_r:pppd_etc_rw_t,s0)
+/etc/ppp/peers(/.*)?	gen_context(system_u:object_r:pppd_etc_rw_t,s0)
+/etc/ppp/.*secrets	--	gen_context(system_u:object_r:pppd_secret_t,s0)
+/etc/ppp/resolv\.conf	--	gen_context(system_u:object_r:pppd_etc_rw_t,s0)
+/etc/ppp/(auth|ip(v6|x)?)-(up|down)	--	gen_context(system_u:object_r:pppd_initrc_exec_t,s0)
+
+/sbin/ppp-watch	--	gen_context(system_u:object_r:pppd_exec_t,s0)
+/sbin/pppoe-server	--	gen_context(system_u:object_r:pppd_exec_t,s0)
+
+/usr/sbin/ipppd	--	gen_context(system_u:object_r:pppd_exec_t,s0)
+/usr/sbin/ppp-watch	--	gen_context(system_u:object_r:pppd_exec_t,s0)
+/usr/sbin/pppd	--	gen_context(system_u:object_r:pppd_exec_t,s0)
+/usr/sbin/pppoe-server	--	gen_context(system_u:object_r:pppd_exec_t,s0)
+/usr/sbin/pptp	--	gen_context(system_u:object_r:pptp_exec_t,s0)
+
+/var/lock/ppp(/.*)?	gen_context(system_u:object_r:pppd_lock_t,s0)
 
 /var/log/ppp-connect-errors.*	--	gen_context(system_u:object_r:pppd_log_t,s0)
-/var/log/ppp/.*			--	gen_context(system_u:object_r:pppd_log_t,s0)
+/var/log/ppp/.*	--	gen_context(system_u:object_r:pppd_log_t,s0)
+/var/log/pptp.*	--	gen_context(system_u:object_r:pptp_log_t,s0)
+
+/var/run/(i)?ppp.*pid[^/]*	--	gen_context(system_u:object_r:pppd_var_run_t,s0)
+/var/run/pppd[0-9]*\.tdb	--	gen_context(system_u:object_r:pppd_var_run_t,s0)
+/var/run/ppp(/.*)?	gen_context(system_u:object_r:pppd_var_run_t,s0)
+/var/run/pptp(/.*)?	gen_context(system_u:object_r:pptp_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/ppp.if refpolicy/policy/modules/contrib/ppp.if
--- refpolicy/policy/modules/contrib/ppp.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/ppp.if	2012-10-19 14:38:47.502529194 +0200
@@ -1,8 +1,115 @@
-## <summary>Point to Point Protocol daemon creates links in ppp networks</summary>
+## <summary>Point to Point Protocol daemon creates links in ppp networks.</summary>
 
 ########################################
 ## <summary>
-##	Use PPP file discriptors.
+##	Role access for ppp.
+## </summary>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <param name="domain">
+##	<summary>
+##	User domain for the role.
+##	</summary>
+## </param>
+#
+interface(`ppp_role',`
+	refpolicywarn(`$0($*) has been deprecated')
+')
+
+########################################
+## <summary>
+##	Create, read, write, and delete
+##	ppp home files.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`ppp_manage_home_files',`
+	gen_require(`
+		type ppp_home_t;
+	')
+
+	userdom_search_user_home_dirs($1)
+	allow $1 ppp_home_t:file manage_file_perms;
+')
+
+########################################
+## <summary>
+##	Read ppp user home content files.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`ppp_read_home_files',`
+	gen_require(`
+		type ppp_home_t;
+
+	')
+
+	userdom_search_user_home_dirs($1)
+	allow $1 ppp_home_t:file read_file_perms;
+')
+
+########################################
+## <summary>
+##	Relabel ppp home files.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`ppp_relabel_home_files',`
+	gen_require(`
+		type ppp_home_t;
+	')
+
+	userdom_search_user_home_dirs($1)
+	allow $1 ppp_home_t:file relabel_file_perms;
+')
+
+########################################
+## <summary>
+##	Create objects in user home
+##	directories with the ppp home type.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="object_class">
+##	<summary>
+##	Class of the object being created.
+##	</summary>
+## </param>
+## <param name="name" optional="true">
+##	<summary>
+##	The name of the object being created.
+##	</summary>
+## </param>
+#
+interface(`ppp_home_filetrans_ppp_home',`
+	gen_require(`
+		type ppp_home_t;
+	')
+
+	userdom_user_home_dir_filetrans($1, ppp_home_t, $2, $3)
+')
+
+########################################
+## <summary>
+##	Inherit and use ppp file discriptors.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -21,7 +128,7 @@
 ########################################
 ## <summary>
 ##	Do not audit attempts to inherit
-##	and use PPP file discriptors.
+##	and use ppp file discriptors.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -39,7 +146,7 @@
 
 ########################################
 ## <summary>
-##	Send a SIGCHLD signal to PPP.
+##	Send child terminated signals to ppp.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -58,7 +165,7 @@
 
 ########################################
 ## <summary>
-##	Send ppp a kill signal
+##	Send kill signals to ppp.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -77,7 +184,7 @@
 
 ########################################
 ## <summary>
-##	Send a generic signal to PPP.
+##	Send generic signals to ppp.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -95,7 +202,7 @@
 
 ########################################
 ## <summary>
-##	Send a generic signull to PPP.
+##	Send null signals to ppp.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -113,7 +220,7 @@
 
 ########################################
 ## <summary>
-##	 Execute domain in the ppp domain.
+##	 Execute pppd in the pppd domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -132,7 +239,8 @@
 
 ########################################
 ## <summary>
-##	 Conditionally execute ppp daemon on behalf of a user or staff type.
+##	Conditionally execute pppd on
+##	behalf of a user or staff type.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -141,17 +249,17 @@
 ## </param>
 ## <param name="role">
 ##	<summary>
-##	The role to allow the ppp domain.
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <rolecap/>
 #
 interface(`ppp_run_cond',`
 	gen_require(`
-		type pppd_t;
+		attribute_role pppd_roles;
 	')
 
-	role $2 types pppd_t;
+	roleattribute $2 pppd_roles;
 
 	tunable_policy(`pppd_for_user',`
 		ppp_domtrans($1)
@@ -160,7 +268,8 @@
 
 ########################################
 ## <summary>
-##	 Unconditionally execute ppp daemon on behalf of a user or staff type.
+##	Unconditionally execute ppp daemon
+##	on behalf of a user or staff type.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -169,7 +278,7 @@
 ## </param>
 ## <param name="role">
 ##	<summary>
-##	The role to allow the ppp domain.
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <rolecap/>
@@ -185,7 +294,7 @@
 
 ########################################
 ## <summary>
-##	 Execute domain in the ppp caller.
+##	 Execute domain in the caller domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -217,13 +326,13 @@
 		type pppd_etc_t;
 	')
 
-	read_files_pattern($1, pppd_etc_t, pppd_etc_t)
 	files_search_etc($1)
+	read_files_pattern($1, pppd_etc_t, pppd_etc_t)
 ')
 
 ########################################
 ## <summary>
-##	Read PPP-writable configuration files.
+##	Read ppp writable configuration content.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -236,14 +345,15 @@
 		type pppd_etc_t, pppd_etc_rw_t;
 	')
 
-	allow $1 pppd_etc_t:dir list_dir_perms;
-	allow $1 pppd_etc_rw_t:file read_file_perms;
 	files_search_etc($1)
+	allow $1 { pppd_etc_t pppd_etc_rw_t }:dir list_dir_perms;
+	allow $1 pppd_etc_rw_t:file read_file_perms;
+	allow $1 { pppd_etc_t pppd_etc_rw_t }:lnk_file read_lnk_file_perms;
 ')
 
 ########################################
 ## <summary>
-##	Read PPP secrets.
+##	Read ppp secret files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -256,14 +366,15 @@
 		type pppd_etc_t, pppd_secret_t;
 	')
 
+	files_search_etc($1)
 	allow $1 pppd_etc_t:dir list_dir_perms;
 	allow $1 pppd_secret_t:file read_file_perms;
-	files_search_etc($1)
+	allow $1 pppd_etc_t:lnk_file read_lnk_file_perms;
 ')
 
 ########################################
 ## <summary>
-##	Read PPP pid files.
+##	Read ppp pid files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -276,12 +387,14 @@
 		type pppd_var_run_t;
 	')
 
+	files_search_pids($1)
 	allow $1 pppd_var_run_t:file read_file_perms;
 ')
 
 ########################################
 ## <summary>
-##	Create, read, write, and delete PPP pid files.
+##	Create, read, write, and delete
+##	ppp pid files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -294,30 +407,43 @@
 		type pppd_var_run_t;
 	')
 
+	files_search_pids($1)
 	allow $1 pppd_var_run_t:file manage_file_perms;
 ')
 
 ########################################
 ## <summary>
-##	Create, read, write, and delete PPP pid files.
+##	Create specified pppd pid objects
+##	with a type transition.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
 ##	Domain allowed access.
 ##	</summary>
 ## </param>
+## <param name="object_class">
+##	<summary>
+##	Class of the object being created.
+##	</summary>
+## </param>
+## <param name="name" optional="true">
+##	<summary>
+##	The name of the object being created.
+##	</summary>
+## </param>
 #
 interface(`ppp_pid_filetrans',`
 	gen_require(`
 		type pppd_var_run_t;
 	')
 
-	files_pid_filetrans($1, pppd_var_run_t, file)
+	files_pid_filetrans($1, pppd_var_run_t, $2, $3)
 ')
 
 ########################################
 ## <summary>
-##	Execute ppp server in the ntpd domain.
+##	Execute pppd init script in
+##	the initrc domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -335,28 +461,31 @@
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate
-##	an ppp environment
+##	All of the rules required to
+##	administrate an ppp environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
 ##	Domain allowed access.
 ##	</summary>
 ## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
 ## <rolecap/>
 #
 interface(`ppp_admin',`
 	gen_require(`
 		type pppd_t, pppd_tmp_t, pppd_log_t, pppd_lock_t;
-		type pppd_etc_t, pppd_secret_t;
-		type pppd_etc_rw_t, pppd_var_run_t;
-
+		type pppd_etc_t, pppd_secret_t, pppd_etc_rw_t;
+		type pppd_var_run_t, pppd_initrc_exec_t;
 		type pptp_t, pptp_log_t, pptp_var_run_t;
- 		type pppd_initrc_exec_t;
 	')
 
-	allow $1 pppd_t:process { ptrace signal_perms getattr };
-	ps_process_pattern($1, pppd_t)
+	allow $1 { pptp_t pppd_t }:process { ptrace signal_perms };
+	ps_process_pattern($1, { pptp_t pppd_t })
 
 	ppp_initrc_domtrans($1)
 	domain_system_change_exemption($1)
@@ -367,24 +496,14 @@
 	admin_pattern($1, pppd_tmp_t)
 
 	logging_list_logs($1)
-	admin_pattern($1, pppd_log_t)
+	admin_pattern($1, { pptp_log_t pppd_log_t })
 
+	files_list_locks($1)
 	admin_pattern($1, pppd_lock_t)
 
 	files_list_etc($1)
-	admin_pattern($1, pppd_etc_t)
-
-	admin_pattern($1, pppd_etc_rw_t)
-
-	admin_pattern($1, pppd_secret_t)
+	admin_pattern($1, { pppd_etc_rw_t pppd_secret_t pppd_etc_t })
 
 	files_list_pids($1)
-	admin_pattern($1, pppd_var_run_t)
-
-	allow $1 pptp_t:process { ptrace signal_perms getattr };
-	ps_process_pattern($1, pptp_t)
-
-	admin_pattern($1, pptp_log_t)
-
-	admin_pattern($1, pptp_var_run_t)
+	admin_pattern($1, { pptp_var_run_t pppd_var_run_t })
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/ppp.te refpolicy/policy/modules/contrib/ppp.te
--- refpolicy/policy/modules/contrib/ppp.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/ppp.te	2012-10-19 14:38:47.502529194 +0200
@@ -1,4 +1,4 @@
-policy_module(ppp, 1.13.0)
+policy_module(ppp, 1.13.3)
 
 ########################################
 #
@@ -6,23 +6,24 @@
 #
 
 ## <desc>
-## <p>
-## Allow pppd to load kernel modules for certain modems
-## </p>
+##	<p>
+##	Determine whether pppd can
+##	load kernel modules.
+##	</p>
 ## </desc>
 gen_tunable(pppd_can_insmod, false)
 
 ## <desc>
-## <p>
-## Allow pppd to be run for a regular user
-## </p>
+##	<p>
+##	Determine whether common users can
+##	run pppd with a domain transition.
+##	</p>
 ## </desc>
 gen_tunable(pppd_for_user, false)
 
 attribute_role pppd_roles;
+attribute_role pptp_roles;
 
-# pppd_t is the domain for the pppd program.
-# pppd_exec_t is the type of the pppd executable.
 type pppd_t;
 type pppd_exec_t;
 init_daemon_domain(pppd_t, pppd_exec_t)
@@ -31,18 +32,15 @@
 type pppd_devpts_t;
 term_pty(pppd_devpts_t)
 
-# Define a separate type for /etc/ppp
 type pppd_etc_t;
 files_config_file(pppd_etc_t)
 
-# Define a separate type for writable files under /etc/ppp
 type pppd_etc_rw_t;
 files_type(pppd_etc_rw_t)
 
 type pppd_initrc_exec_t alias pppd_script_exec_t;
 init_script_file(pppd_initrc_exec_t)
 
-# pppd_secret_t is the type of the pap and chap password files
 type pppd_secret_t;
 files_type(pppd_secret_t)
 
@@ -61,7 +59,7 @@
 type pptp_t;
 type pptp_exec_t;
 init_daemon_domain(pptp_t, pptp_exec_t)
-role pppd_roles types pptp_t;
+role pptp_roles types pptp_t;
 
 type pptp_log_t;
 logging_log_file(pptp_log_t)
@@ -69,56 +67,54 @@
 type pptp_var_run_t;
 files_pid_file(pptp_var_run_t)
 
+type ppp_home_t;
+userdom_user_home_content(ppp_home_t)
+
 ########################################
 #
-# PPPD Local policy
+# PPPD local policy
 #
 
-allow pppd_t self:capability { kill net_admin setuid setgid fsetid fowner net_raw dac_override };
+allow pppd_t self:capability { kill net_admin setuid setgid sys_admin fsetid fowner net_raw dac_override };
 dontaudit pppd_t self:capability sys_tty_config;
-allow pppd_t self:process { getsched signal };
+allow pppd_t self:process { getsched setsched signal };
 allow pppd_t self:fifo_file rw_fifo_file_perms;
 allow pppd_t self:socket create_socket_perms;
-allow pppd_t self:unix_dgram_socket create_socket_perms;
-allow pppd_t self:unix_stream_socket create_socket_perms;
-allow pppd_t self:netlink_route_socket rw_netlink_socket_perms;
-allow pppd_t self:tcp_socket create_stream_socket_perms;
-allow pppd_t self:udp_socket { connect connected_socket_perms };
+allow pppd_t self:netlink_route_socket nlmsg_write;
+allow pppd_t self:tcp_socket { accept listen };
 allow pppd_t self:packet_socket create_socket_perms;
 
-domtrans_pattern(pppd_t, pptp_exec_t, pptp_t)
-
-allow pppd_t pppd_devpts_t:chr_file { rw_chr_file_perms setattr };
+allow pppd_t pppd_devpts_t:chr_file { rw_chr_file_perms setattr_chr_file_perms };
 
 allow pppd_t pppd_etc_t:dir rw_dir_perms;
-allow pppd_t pppd_etc_t:file read_file_perms;
-allow pppd_t pppd_etc_t:lnk_file { getattr read };
+allow pppd_t { pppd_etc_t ppp_home_t }:file read_file_perms;
+allow pppd_t pppd_etc_t:lnk_file read_lnk_file_perms;
 
 manage_files_pattern(pppd_t, pppd_etc_rw_t, pppd_etc_rw_t)
-# Automatically label newly created files under /etc/ppp with this type
 filetrans_pattern(pppd_t, pppd_etc_t, pppd_etc_rw_t, file)
 
 allow pppd_t pppd_lock_t:file manage_file_perms;
 files_lock_filetrans(pppd_t, pppd_lock_t, file)
 
-allow pppd_t pppd_log_t:file manage_file_perms;
+allow pppd_t pppd_log_t:file { append_file_perms create_file_perms setattr_file_perms };
 logging_log_filetrans(pppd_t, pppd_log_t, file)
 
 manage_dirs_pattern(pppd_t, pppd_tmp_t, pppd_tmp_t)
 manage_files_pattern(pppd_t, pppd_tmp_t, pppd_tmp_t)
-files_tmp_filetrans(pppd_t, pppd_tmp_t, { file dir })
+files_tmp_filetrans(pppd_t, pppd_tmp_t, { dir file})
 
+manage_dirs_pattern(pppd_t, pppd_var_run_t, pppd_var_run_t)
 manage_files_pattern(pppd_t, pppd_var_run_t, pppd_var_run_t)
-files_pid_filetrans(pppd_t, pppd_var_run_t, file)
+files_pid_filetrans(pppd_t, pppd_var_run_t, { dir file })
+
+can_exec(pppd_t, pppd_exec_t)
+
+domtrans_pattern(pppd_t, pptp_exec_t, pptp_t)
 
 allow pppd_t pptp_t:process signal;
 
-# for SSP
-# Access secret files
 allow pppd_t pppd_secret_t:file read_file_perms;
 
-ppp_initrc_domtrans(pppd_t)
-
 kernel_read_kernel_sysctls(pppd_t)
 kernel_read_system_state(pppd_t)
 kernel_rw_net_sysctls(pppd_t)
@@ -126,7 +122,6 @@
 kernel_request_load_module(pppd_t)
 
 dev_read_urand(pppd_t)
-dev_search_sysfs(pppd_t)
 dev_read_sysfs(pppd_t)
 dev_rw_modem(pppd_t)
 
@@ -140,19 +135,9 @@
 corenet_udp_sendrecv_generic_node(pppd_t)
 corenet_tcp_sendrecv_all_ports(pppd_t)
 corenet_udp_sendrecv_all_ports(pppd_t)
-# Access /dev/ppp.
-corenet_rw_ppp_dev(pppd_t)
-
-fs_getattr_all_fs(pppd_t)
-fs_search_auto_mountpoints(pppd_t)
 
-term_use_unallocated_ttys(pppd_t)
-term_setattr_unallocated_ttys(pppd_t)
-term_ioctl_generic_ptys(pppd_t)
-# for pppoe
-term_create_pty(pppd_t, pppd_devpts_t)
+corenet_rw_ppp_dev(pppd_t)
 
-# allow running ip-up and ip-down scripts and running chat.
 corecmd_exec_bin(pppd_t)
 corecmd_exec_shell(pppd_t)
 
@@ -162,14 +147,23 @@
 files_manage_etc_runtime_files(pppd_t)
 files_dontaudit_write_etc_files(pppd_t)
 
-# for scripts
-files_read_etc_files(pppd_t)
+fs_getattr_all_fs(pppd_t)
+fs_search_auto_mountpoints(pppd_t)
+
+term_use_unallocated_ttys(pppd_t)
+term_setattr_unallocated_ttys(pppd_t)
+term_ioctl_generic_ptys(pppd_t)
+term_create_pty(pppd_t, pppd_devpts_t)
+term_use_generic_ptys(pppd_t)
 
+init_labeled_script_domtrans(pppd_t, pppd_initrc_exec_t)
 init_read_utmp(pppd_t)
-init_dontaudit_write_utmp(pppd_t)
 init_signal_script(pppd_t)
+init_dontaudit_write_utmp(pppd_t)
 
+auth_run_chk_passwd(pppd_t, pppd_roles)
 auth_use_nsswitch(pppd_t)
+auth_write_login_records(pppd_t)
 
 logging_send_syslog_msg(pppd_t)
 logging_send_audit_msgs(pppd_t)
@@ -184,13 +178,17 @@
 userdom_dontaudit_use_unpriv_user_fds(pppd_t)
 userdom_search_user_home_dirs(pppd_t)
 
-ppp_exec(pppd_t)
-
 optional_policy(`
 	ddclient_run(pppd_t, pppd_roles)
 ')
 
 optional_policy(`
+	l2tpd_dgram_send(pppd_t)
+	l2tpd_rw_socket(pppd_t)
+	l2tpd_stream_connect(pppd_t)
+')
+
+optional_policy(`
 	tunable_policy(`pppd_can_insmod',`
 		modutils_domtrans_insmod(pppd_t)
 	')
@@ -198,6 +196,8 @@
 
 optional_policy(`
 	mta_send_mail(pppd_t)
+	mta_system_content(pppd_etc_t)
+	mta_system_content(pppd_etc_rw_t)
 ')
 
 optional_policy(`
@@ -218,19 +218,16 @@
 
 ########################################
 #
-# PPTP Local policy
+# PPTP local policy
 #
 
 allow pptp_t self:capability { dac_override dac_read_search net_raw net_admin };
 dontaudit pptp_t self:capability sys_tty_config;
 allow pptp_t self:process signal;
 allow pptp_t self:fifo_file rw_fifo_file_perms;
-allow pptp_t self:unix_dgram_socket create_socket_perms;
-allow pptp_t self:unix_stream_socket { connectto create_stream_socket_perms };
+allow pptp_t self:unix_stream_socket { accept connectto listen };
 allow pptp_t self:rawip_socket create_socket_perms;
-allow pptp_t self:tcp_socket create_socket_perms;
-allow pptp_t self:udp_socket create_socket_perms;
-allow pptp_t self:netlink_route_socket rw_netlink_socket_perms;
+allow pptp_t self:netlink_route_socket nlmsg_write;
 
 allow pptp_t pppd_etc_t:dir list_dir_perms;
 allow pptp_t pppd_etc_t:file read_file_perms;
@@ -239,24 +236,22 @@
 allow pptp_t pppd_etc_rw_t:dir list_dir_perms;
 allow pptp_t pppd_etc_rw_t:file read_file_perms;
 allow pptp_t pppd_etc_rw_t:lnk_file read_lnk_file_perms;
-can_exec(pptp_t, pppd_etc_rw_t)
 
-# Allow pptp to append to pppd log files
 allow pptp_t pppd_log_t:file append_file_perms;
 
-allow pptp_t pptp_log_t:file manage_file_perms;
+allow pptp_t pptp_log_t:file { append_file_perms create_file_perms setattr_file_perms };
 logging_log_filetrans(pptp_t, pptp_log_t, file)
 
 manage_files_pattern(pptp_t, pptp_var_run_t, pptp_var_run_t)
 manage_sock_files_pattern(pptp_t, pptp_var_run_t, pptp_var_run_t)
 files_pid_filetrans(pptp_t, pptp_var_run_t, file)
 
-kernel_list_proc(pptp_t)
+can_exec(pptp_t, pppd_etc_rw_t)
+
 kernel_read_kernel_sysctls(pptp_t)
-kernel_read_proc_symlinks(pptp_t)
+kernel_read_network_state(pptp_t)
 kernel_read_system_state(pptp_t)
-
-dev_read_sysfs(pptp_t)
+kernel_signal(pptp_t)
 
 corecmd_exec_shell(pptp_t)
 corecmd_read_bin_symlinks(pptp_t)
@@ -268,12 +263,14 @@
 corenet_tcp_sendrecv_generic_node(pptp_t)
 corenet_raw_sendrecv_generic_node(pptp_t)
 corenet_tcp_sendrecv_all_ports(pptp_t)
-corenet_tcp_bind_generic_node(pptp_t)
-corenet_tcp_connect_generic_port(pptp_t)
+
 corenet_tcp_connect_all_reserved_ports(pptp_t)
+corenet_tcp_connect_generic_port(pptp_t)
 corenet_sendrecv_generic_client_packets(pptp_t)
 
-files_read_etc_files(pptp_t)
+dev_read_sysfs(pptp_t)
+
+domain_use_interactive_fds(pptp_t)
 
 fs_getattr_all_fs(pptp_t)
 fs_search_auto_mountpoints(pptp_t)
@@ -282,8 +279,6 @@
 term_search_ptys(pptp_t)
 term_use_ptmx(pptp_t)
 
-domain_use_interactive_fds(pptp_t)
-
 auth_use_nsswitch(pptp_t)
 
 logging_send_syslog_msg(pptp_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/prelink.fc refpolicy/policy/modules/contrib/prelink.fc
--- refpolicy/policy/modules/contrib/prelink.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/prelink.fc	2012-10-19 14:38:53.360529207 +0200
@@ -1,11 +1,11 @@
 /etc/cron\.daily/prelink	--	gen_context(system_u:object_r:prelink_cron_system_exec_t,s0)
 
-/etc/prelink\.cache		--	gen_context(system_u:object_r:prelink_cache_t,s0)
+/etc/prelink\.cache	--	gen_context(system_u:object_r:prelink_cache_t,s0)
 
 /usr/sbin/prelink(\.bin)?	--	gen_context(system_u:object_r:prelink_exec_t,s0)
 
-/var/log/prelink\.log		--	gen_context(system_u:object_r:prelink_log_t,s0)
-/var/log/prelink(/.*)?			gen_context(system_u:object_r:prelink_log_t,s0)
+/var/log/prelink\.log.*	--	gen_context(system_u:object_r:prelink_log_t,s0)
+/var/log/prelink(/.*)?	gen_context(system_u:object_r:prelink_log_t,s0)
 
-/var/lib/misc/prelink.*		--	gen_context(system_u:object_r:prelink_var_lib_t,s0)
-/var/lib/prelink(/.*)?			gen_context(system_u:object_r:prelink_var_lib_t,s0)
+/var/lib/misc/prelink.*	--	gen_context(system_u:object_r:prelink_var_lib_t,s0)
+/var/lib/prelink(/.*)?	gen_context(system_u:object_r:prelink_var_lib_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/prelink.if refpolicy/policy/modules/contrib/prelink.if
--- refpolicy/policy/modules/contrib/prelink.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/prelink.if	2012-10-19 14:38:53.360529207 +0200
@@ -2,7 +2,7 @@
 
 ########################################
 ## <summary>
-##	Execute the prelink program in the prelink domain.
+##	Execute prelink in the prelink domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -18,15 +18,15 @@
 	corecmd_search_bin($1)
 	domtrans_pattern($1, prelink_exec_t, prelink_t)
 
-	ifdef(`hide_broken_symptoms', `
+	ifdef(`hide_broken_symptoms',`
 		dontaudit prelink_t $1:socket_class_set { read write };
-		dontaudit prelink_t $1:fifo_file setattr;
+		dontaudit prelink_t $1:fifo_file setattr_fifo_file_perms;
 	')
 ')
 
 ########################################
 ## <summary>
-##	Execute the prelink program in the current domain.
+##	Execute prelink in the caller domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -45,7 +45,9 @@
 
 ########################################
 ## <summary>
-##	Execute the prelink program in the prelink domain.
+##	Execute prelink in the prelink
+##	domain, and allow the specified role
+##	the prelink domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -54,18 +56,18 @@
 ## </param>
 ## <param name="role">
 ##	<summary>
-##	The role to allow the prelink domain.
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <rolecap/>
 #
 interface(`prelink_run',`
 	gen_require(`
-		type prelink_t;
+		attribute_role prelink_roles;
 	')
 
 	prelink_domtrans($1)
-	role $2 types prelink_t;
+	roleattribute $2 prelink_roles;
 ')
 
 ########################################
@@ -78,7 +80,6 @@
 ##	</summary>
 ## </param>
 #
-# cjp: added for misc non-entrypoint objects
 interface(`prelink_object_file',`
 	gen_require(`
 		attribute prelink_object;
@@ -89,7 +90,7 @@
 
 ########################################
 ## <summary>
-##	Read the prelink cache.
+##	Read prelink cache files.
 ## </summary>
 ## <param name="file_type">
 ##	<summary>
@@ -108,7 +109,7 @@
 
 ########################################
 ## <summary>
-##	Delete the prelink cache.
+##	Delete prelink cache files.
 ## </summary>
 ## <param name="file_type">
 ##	<summary>
@@ -121,8 +122,8 @@
 		type prelink_cache_t;
 	')
 
-	allow $1 prelink_cache_t:file unlink;
 	files_rw_etc_dirs($1)
+	allow $1 prelink_cache_t:file delete_file_perms;
 ')
 
 ########################################
@@ -167,7 +168,7 @@
 
 ########################################
 ## <summary>
-##	Relabel from files in the /boot directory.
+##	Relabel from prelink lib files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -186,7 +187,7 @@
 
 ########################################
 ## <summary>
-##	Relabel from files in the /boot directory.
+##	Relabel prelink lib files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/prelink.te refpolicy/policy/modules/contrib/prelink.te
--- refpolicy/policy/modules/contrib/prelink.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/prelink.te	2012-10-19 14:38:53.360529207 +0200
@@ -1,4 +1,4 @@
-policy_module(prelink, 1.10.0)
+policy_module(prelink, 1.10.1)
 
 ########################################
 #
@@ -6,10 +6,13 @@
 
 attribute prelink_object;
 
+attribute_role prelink_roles;
+
 type prelink_t;
 type prelink_exec_t;
 init_system_domain(prelink_t, prelink_exec_t)
 domain_obj_id_change_exemption(prelink_t)
+role prelink_roles types prelink_t;
 
 type prelink_cache_t;
 files_type(prelink_cache_t)
@@ -36,23 +39,23 @@
 # Local policy
 #
 
-allow prelink_t self:capability { chown dac_override fowner fsetid sys_resource };
+allow prelink_t self:capability { chown dac_override fowner fsetid setfcap sys_resource };
 allow prelink_t self:process { execheap execmem execstack signal };
 allow prelink_t self:fifo_file rw_fifo_file_perms;
 
 allow prelink_t prelink_cache_t:file manage_file_perms;
 files_etc_filetrans(prelink_t, prelink_cache_t, file)
 
-allow prelink_t prelink_log_t:dir setattr;
+allow prelink_t prelink_log_t:dir setattr_dir_perms;
 create_files_pattern(prelink_t, prelink_log_t, prelink_log_t)
 append_files_pattern(prelink_t, prelink_log_t, prelink_log_t)
 read_lnk_files_pattern(prelink_t, prelink_log_t, prelink_log_t)
 logging_log_filetrans(prelink_t, prelink_log_t, file)
 
-allow prelink_t prelink_tmp_t:file { manage_file_perms execute relabelfrom execmod };
+allow prelink_t prelink_tmp_t:file { manage_file_perms mmap_file_perms relabel_file_perms execmod };
 files_tmp_filetrans(prelink_t, prelink_tmp_t, file)
 
-allow prelink_t prelink_tmpfs_t:file { manage_file_perms execute relabelfrom execmod };
+allow prelink_t prelink_tmpfs_t:file { manage_file_perms mmap_file_perms relabel_file_perms execmod };
 fs_tmpfs_filetrans(prelink_t, prelink_tmpfs_t, file)
 
 manage_dirs_pattern(prelink_t, prelink_var_lib_t, prelink_var_lib_t)
@@ -60,9 +63,7 @@
 relabel_files_pattern(prelink_t, prelink_var_lib_t, prelink_var_lib_t)
 files_var_lib_filetrans(prelink_t, prelink_var_lib_t, { dir file })
 
-# prelink misc objects that are not system
-# libraries or entrypoints
-allow prelink_t prelink_object:file { manage_file_perms execute relabelto relabelfrom };
+allow prelink_t prelink_object:file { manage_file_perms mmap_file_perms relabel_file_perms };
 
 kernel_read_system_state(prelink_t)
 kernel_read_kernel_sysctls(prelink_t)
@@ -74,20 +75,24 @@
 
 dev_read_urand(prelink_t)
 
-files_list_all(prelink_t)
 files_getattr_all_files(prelink_t)
-files_write_non_security_dirs(prelink_t)
-files_read_etc_files(prelink_t)
-files_read_etc_runtime_files(prelink_t)
-files_dontaudit_read_all_symlinks(prelink_t)
+files_list_all(prelink_t)
 files_manage_usr_files(prelink_t)
 files_manage_var_files(prelink_t)
+files_read_etc_files(prelink_t)
+files_read_etc_runtime_files(prelink_t)
 files_relabelfrom_usr_files(prelink_t)
+files_search_var_lib(prelink_t)
+files_write_non_security_dirs(prelink_t)
+files_dontaudit_read_all_symlinks(prelink_t)
 
-fs_getattr_xattr_fs(prelink_t)
+fs_getattr_all_fs(prelink_t)
+fs_search_auto_mountpoints(prelink_t)
 
 selinux_get_enforce_mode(prelink_t)
 
+storage_getattr_fixed_disk_dev(prelink_t)
+
 libs_exec_ld_so(prelink_t)
 libs_legacy_use_shared_libs(prelink_t)
 libs_manage_ld_so(prelink_t)
@@ -99,6 +104,29 @@
 miscfiles_read_localization(prelink_t)
 
 userdom_use_user_terminals(prelink_t)
+userdom_manage_user_home_content_files(prelink_t)
+# pending
+# userdom_relabel_user_home_content_files(prelink_t)
+# userdom_execmod_user_home_content_files(prelink_t)
+userdom_exec_user_home_content_files(prelink_t)
+
+ifdef(`hide_broken_symptoms',`
+	miscfiles_read_man_pages(prelink_t)
+
+	optional_policy(`
+		dbus_read_config(prelink_t)
+	')
+')
+
+tunable_policy(`use_nfs_home_dirs',`
+	fs_exec_nfs_files(prelink_t)
+	fs_manage_nfs_files(prelink_t)
+')
+
+tunable_policy(`use_samba_home_dirs',`
+	fs_exec_cifs_files(prelink_t)
+	fs_manage_cifs_files(prelink_t)
+')
 
 optional_policy(`
 	amanda_manage_lib(prelink_t)
@@ -109,6 +137,14 @@
 ')
 
 optional_policy(`
+	gnome_dontaudit_read_inherited_gconf_config_files(prelink_t)
+')
+
+optional_policy(`
+	mozilla_manage_plugin_rw_files(prelink_t)
+')
+
+optional_policy(`
 	rpm_manage_tmp_files(prelink_t)
 ')
 
@@ -118,17 +154,17 @@
 
 ########################################
 #
-# Prelink Cron system Policy
+# Cron system local policy
 #
 
 optional_policy(`
 	allow prelink_cron_system_t self:capability setuid;
 	allow prelink_cron_system_t self:process { setsched setfscreate signal };
 	allow prelink_cron_system_t self:fifo_file rw_fifo_file_perms;
-	allow prelink_cron_system_t self:unix_dgram_socket { write bind create setopt };
+	allow prelink_cron_system_t self:unix_dgram_socket create_socket_perms;
 
 	read_files_pattern(prelink_cron_system_t, prelink_cache_t, prelink_cache_t)
-	allow prelink_cron_system_t prelink_cache_t:file unlink;
+	allow prelink_cron_system_t prelink_cache_t:file delete_file_perms;
 
 	domtrans_pattern(prelink_cron_system_t, prelink_exec_t, prelink_t)
 	allow prelink_cron_system_t prelink_t:process noatsecure;
@@ -137,17 +173,22 @@
 
 	manage_files_pattern(prelink_cron_system_t, prelink_var_lib_t, prelink_var_lib_t)
 	files_var_lib_filetrans(prelink_cron_system_t, prelink_var_lib_t, file)
-	allow prelink_cron_system_t prelink_var_lib_t:file { relabelfrom relabelto };
+	allow prelink_cron_system_t prelink_var_lib_t:file relabel_file_perms;
 
 	kernel_read_system_state(prelink_cron_system_t)
 
 	corecmd_exec_bin(prelink_cron_system_t)
 	corecmd_exec_shell(prelink_cron_system_t)
 
+	dev_list_sysfs(prelink_cron_system_t)
+	dev_read_sysfs(prelink_cron_system_t)
+
+	files_rw_etc_dirs(prelink_cron_system_t)
 	files_dontaudit_search_all_mountpoints(prelink_cron_system_t)
-	files_read_etc_files(prelink_cron_system_t)
-	files_search_var_lib(prelink_cron_system_t)
 
+	auth_use_nsswitch(prelink_cron_system_t)
+
+	init_telinit(prelink_cron_system_t)
 	init_exec(prelink_cron_system_t)
 
 	libs_exec_ld_so(prelink_cron_system_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/prelude.fc refpolicy/policy/modules/contrib/prelude.fc
--- refpolicy/policy/modules/contrib/prelude.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/prelude.fc	2012-10-19 14:38:58.415529217 +0200
@@ -1,18 +1,25 @@
-/etc/prelude-correlator(/.*)?		gen_context(system_u:object_r:prelude_correlator_config_t, s0)
-/etc/rc\.d/init\.d/prelude-correlator -- gen_context(system_u:object_r:prelude_initrc_exec_t, s0)
-/etc/rc\.d/init\.d/prelude-lml --	gen_context(system_u:object_r:prelude_initrc_exec_t,s0)
-/etc/rc\.d/init\.d/prelude-manager --	gen_context(system_u:object_r:prelude_initrc_exec_t,s0)
+/etc/prelude-correlator(/.*)?	gen_context(system_u:object_r:prelude_correlator_config_t, s0)
 
-/sbin/audisp-prelude		--	gen_context(system_u:object_r:prelude_audisp_exec_t,s0)
+/etc/rc\.d/init\.d/prelude-correlator	--	gen_context(system_u:object_r:prelude_initrc_exec_t,s0)
+/etc/rc\.d/init\.d/prelude-lml	--	gen_context(system_u:object_r:prelude_initrc_exec_t,s0)
+/etc/rc\.d/init\.d/prelude-manager	--	gen_context(system_u:object_r:prelude_initrc_exec_t,s0)
 
-/usr/bin/prelude-correlator	--	gen_context(system_u:object_r:prelude_correlator_exec_t, s0)
-/usr/bin/prelude-lml		--	gen_context(system_u:object_r:prelude_lml_exec_t,s0)
+/sbin/audisp-prelude	--	gen_context(system_u:object_r:prelude_audisp_exec_t,s0)
+
+/usr/bin/prelude-correlator	--	gen_context(system_u:object_r:prelude_correlator_exec_t,s0)
+/usr/bin/prelude-lml	--	gen_context(system_u:object_r:prelude_lml_exec_t,s0)
 /usr/bin/prelude-manager	--	gen_context(system_u:object_r:prelude_exec_t,s0)
+
+/usr/sbin/audisp-prelude	--	gen_context(system_u:object_r:prelude_audisp_exec_t,s0)
+
 /usr/share/prewikka/cgi-bin(/.*)?	gen_context(system_u:object_r:httpd_prewikka_script_exec_t,s0)
 
-/var/lib/prelude-lml(/.*)?		gen_context(system_u:object_r:prelude_var_lib_t,s0)
-/var/log/prelude.*			gen_context(system_u:object_r:prelude_log_t,s0)
-/var/run/prelude-lml.pid	--	gen_context(system_u:object_r:prelude_lml_var_run_t,s0)
-/var/run/prelude-manager(/.*)?		gen_context(system_u:object_r:prelude_var_run_t,s0)
+/var/lib/prelude-lml(/.*)?	gen_context(system_u:object_r:prelude_var_lib_t,s0)
+
+/var/log/prelude.*	gen_context(system_u:object_r:prelude_log_t,s0)
+
+/var/run/prelude-lml\.pid	--	gen_context(system_u:object_r:prelude_lml_var_run_t,s0)
+/var/run/prelude-manager(/.*)?	gen_context(system_u:object_r:prelude_var_run_t,s0)
+
 /var/spool/prelude-manager(/.*)?	gen_context(system_u:object_r:prelude_spool_t,s0)
-/var/spool/prelude(/.*)?		gen_context(system_u:object_r:prelude_spool_t,s0)
+/var/spool/prelude(/.*)?	gen_context(system_u:object_r:prelude_spool_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/prelude.if refpolicy/policy/modules/contrib/prelude.if
--- refpolicy/policy/modules/contrib/prelude.if	2012-05-04 15:16:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/prelude.if	2012-10-19 14:38:58.415529217 +0200
@@ -1,13 +1,13 @@
-## <summary>Prelude hybrid intrusion detection system</summary>
+## <summary>Prelude hybrid intrusion detection system.</summary>
 
 ########################################
 ## <summary>
 ##	Execute a domain transition to run prelude.
 ## </summary>
 ## <param name="domain">
-## <summary>
+##	<summary>
 ##	Domain allowed to transition.
-## </summary>
+##	</summary>
 ## </param>
 #
 interface(`prelude_domtrans',`
@@ -15,17 +15,19 @@
 		type prelude_t, prelude_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, prelude_exec_t, prelude_t)
 ')
 
 ########################################
 ## <summary>
-##	Execute a domain transition to run prelude_audisp.
+##	Execute a domain transition to
+##	run prelude audisp.
 ## </summary>
 ## <param name="domain">
-## <summary>
+##	<summary>
 ##	Domain allowed to transition.
-## </summary>
+##	</summary>
 ## </param>
 #
 interface(`prelude_domtrans_audisp',`
@@ -33,17 +35,18 @@
 		type prelude_audisp_t, prelude_audisp_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, prelude_audisp_exec_t, prelude_audisp_t)
 ')
 
 ########################################
 ## <summary>
-##	Signal the prelude_audisp domain.
+##	Send generic signals to prelude audisp.
 ## </summary>
 ## <param name="domain">
-## <summary>
-##	Domain allowed acccess.
-## </summary>
+##	<summary>
+##	Domain allowed access.
+##	</summary>
 ## </param>
 #
 interface(`prelude_signal_audisp',`
@@ -56,7 +59,7 @@
 
 ########################################
 ## <summary>
-##	Read the prelude spool files
+##	Read prelude spool files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -75,12 +78,13 @@
 
 ########################################
 ## <summary>
-##	Manage to prelude-manager spool files.
+##	Create, read, write, and delete
+##	prelude manager spool files.
 ## </summary>
 ## <param name="domain">
-## <summary>
+##	<summary>
 ##	Domain allowed access.
-## </summary>
+##	</summary>
 ## </param>
 #
 interface(`prelude_manage_spool',`
@@ -95,8 +99,8 @@
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate 
-##	an prelude environment
+##	All of the rules required to
+##	administrate an prelude environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -112,33 +116,32 @@
 #
 interface(`prelude_admin',`
 	gen_require(`
-		type prelude_t, prelude_spool_t;
-		type prelude_var_run_t, prelude_var_lib_t;
+		type prelude_t, prelude_spool_t, prelude_lml_var_run_t;
+		type prelude_var_run_t, prelude_var_lib_t, prelude_log_t;
 		type prelude_audisp_t, prelude_audisp_var_run_t;
-		type prelude_initrc_exec_t;
-
-		type prelude_lml_t, prelude_lml_tmp_t;
-		type prelude_lml_var_run_t;
+		type prelude_initrc_exec_t, prelude_lml_t, prelude_lml_tmp_t;
 	')
 
-	allow $1 prelude_t:process { ptrace signal_perms };
-	ps_process_pattern($1, prelude_t)
-
-	allow $1 prelude_audisp_t:process { ptrace signal_perms };
-	ps_process_pattern($1, prelude_audisp_t)
-
-	allow $1 prelude_lml_t:process { ptrace signal_perms };
-	ps_process_pattern($1, prelude_lml_t)
+	allow $1 { prelude_t prelude_audisp_t prelude_lml_t prelude_correlator_t }:process { ptrace signal_perms };
+	ps_process_pattern($1, { prelude_t prelude_audisp_t prelude_lml_t prelude_correlator_t })
 
 	init_labeled_script_domtrans($1, prelude_initrc_exec_t)
 	domain_system_change_exemption($1)
 	role_transition $2 prelude_initrc_exec_t system_r;
 	allow $2 system_r;
 
+	files_search_spool($1)
 	admin_pattern($1, prelude_spool_t)
+
+	logging_search_logs($1)
+	admin_pattern($1, prelude_log_t)
+
+	files_search_var_lib($1)
 	admin_pattern($1, prelude_var_lib_t)
-	admin_pattern($1, prelude_var_run_t)
-	admin_pattern($1, prelude_audisp_var_run_t)
+
+	files_search_pids($1)
+	admin_pattern($1, { prelude_audisp_var_run_t prelude_var_run_t prelude_lml_var_run_t })
+
+	files_search_tmp($1)
 	admin_pattern($1, prelude_lml_tmp_t)
-	admin_pattern($1, prelude_lml_var_run_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/prelude.te refpolicy/policy/modules/contrib/prelude.te
--- refpolicy/policy/modules/contrib/prelude.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/prelude.te	2012-10-19 14:38:58.416529217 +0200
@@ -1,4 +1,4 @@
-policy_module(prelude, 1.3.0)
+policy_module(prelude, 1.3.2)
 
 ########################################
 #
@@ -35,7 +35,6 @@
 type prelude_correlator_t;
 type prelude_correlator_exec_t;
 init_daemon_domain(prelude_correlator_t, prelude_correlator_exec_t)
-role system_r types prelude_correlator_t;
 
 type prelude_correlator_config_t;
 files_config_file(prelude_correlator_config_t)
@@ -52,25 +51,25 @@
 
 ########################################
 #
-# prelude local policy
+# Prelude local policy
 #
 
 allow prelude_t self:capability { dac_override sys_tty_config };
-allow prelude_t self:fifo_file rw_file_perms;
-allow prelude_t self:unix_stream_socket create_stream_socket_perms;
-allow prelude_t self:netlink_route_socket r_netlink_socket_perms;
-allow prelude_t self:tcp_socket create_stream_socket_perms;
-
-manage_files_pattern(prelude_t, prelude_log_t, prelude_log_t)
+allow prelude_t self:fifo_file rw_fifo_file_perms;
+allow prelude_t self:unix_stream_socket { accept listen };
+allow prelude_t self:tcp_socket { accept listen };
+
+allow prelude_t prelude_log_t:dir setattr_dir_perms;
+append_files_pattern(prelude_t, prelude_log_t, prelude_log_t)
+create_files_pattern(prelude_t, prelude_log_t, prelude_log_t)
+setattr_files_pattern(prelude_t, prelude_log_t, prelude_log_t)
 logging_log_filetrans(prelude_t, prelude_log_t, file)
 
 manage_dirs_pattern(prelude_t, prelude_spool_t, prelude_spool_t)
 manage_files_pattern(prelude_t, prelude_spool_t, prelude_spool_t)
-files_search_spool(prelude_t)
 
 manage_dirs_pattern(prelude_t, prelude_var_lib_t, prelude_var_lib_t)
 manage_files_pattern(prelude_t, prelude_var_lib_t, prelude_var_lib_t)
-files_search_var_lib(prelude_t)
 
 manage_dirs_pattern(prelude_t, prelude_var_run_t, prelude_var_run_t)
 manage_files_pattern(prelude_t, prelude_var_run_t, prelude_var_run_t)
@@ -87,17 +86,19 @@
 corenet_tcp_sendrecv_generic_if(prelude_t)
 corenet_tcp_sendrecv_generic_node(prelude_t)
 corenet_tcp_bind_generic_node(prelude_t)
+
+corenet_sendrecv_prelude_server_packets(prelude_t)
 corenet_tcp_bind_prelude_port(prelude_t)
+corenet_sendrecv_prelude_client_packets(prelude_t)
 corenet_tcp_connect_prelude_port(prelude_t)
-corenet_tcp_connect_postgresql_port(prelude_t)
-corenet_tcp_connect_mysqld_port(prelude_t)
+corenet_tcp_sendrecv_prelude_port(prelude_t)
 
 dev_read_rand(prelude_t)
 dev_read_urand(prelude_t)
 
-files_read_etc_files(prelude_t)
 files_read_etc_runtime_files(prelude_t)
 files_read_usr_files(prelude_t)
+files_search_spool(prelude_t)
 files_search_tmp(prelude_t)
 
 fs_rw_anon_inodefs_files(prelude_t)
@@ -110,30 +111,27 @@
 miscfiles_read_localization(prelude_t)
 
 optional_policy(`
-	mysql_search_db(prelude_t)
 	mysql_stream_connect(prelude_t)
+	mysql_tcp_connect(prelude_t)
 ')
 
 optional_policy(`
 	postgresql_stream_connect(prelude_t)
+	postgresql_tcp_connect(prelude_t)
 ')
 
 ########################################
 #
-# prelude_audisp local policy
+# Audisp local policy
 #
 
 allow prelude_audisp_t self:capability { dac_override ipc_lock setpcap };
 allow prelude_audisp_t self:process { getcap setcap };
-allow prelude_audisp_t self:fifo_file rw_file_perms;
-allow prelude_audisp_t self:unix_stream_socket create_stream_socket_perms;
-allow prelude_audisp_t self:unix_dgram_socket create_socket_perms;
-allow prelude_audisp_t self:netlink_route_socket r_netlink_socket_perms;
-allow prelude_audisp_t self:tcp_socket create_socket_perms;
+allow prelude_audisp_t self:fifo_file rw_fifo_file_perms;
+allow prelude_audisp_t self:unix_stream_socket { accept listen };
 
 manage_dirs_pattern(prelude_audisp_t, prelude_spool_t, prelude_spool_t)
 manage_files_pattern(prelude_audisp_t, prelude_spool_t, prelude_spool_t)
-files_search_spool(prelude_audisp_t)
 
 manage_sock_files_pattern(prelude_audisp_t, prelude_audisp_var_run_t, prelude_audisp_var_run_t)
 files_pid_filetrans(prelude_audisp_t, prelude_audisp_var_run_t, sock_file)
@@ -147,17 +145,19 @@
 corenet_all_recvfrom_netlabel(prelude_audisp_t)
 corenet_tcp_sendrecv_generic_if(prelude_audisp_t)
 corenet_tcp_sendrecv_generic_node(prelude_audisp_t)
-corenet_tcp_bind_generic_node(prelude_audisp_t)
+
+corenet_sendrecv_prelude_client_packets(prelude_audisp_t)
 corenet_tcp_connect_prelude_port(prelude_audisp_t)
+corenet_tcp_sendrecv_prelude_port(prelude_audisp_t)
 
 dev_read_rand(prelude_audisp_t)
 dev_read_urand(prelude_audisp_t)
 
-# Init script handling
 domain_use_interactive_fds(prelude_audisp_t)
 
 files_read_etc_files(prelude_audisp_t)
 files_read_etc_runtime_files(prelude_audisp_t)
+files_search_spool(prelude_audisp_t)
 files_search_tmp(prelude_audisp_t)
 
 logging_send_syslog_msg(prelude_audisp_t)
@@ -168,13 +168,14 @@
 
 ########################################
 #
-# prelude_correlator local policy
+# Correlator local policy
 #
 
 allow prelude_correlator_t self:capability dac_override;
-allow prelude_correlator_t self:netlink_route_socket r_netlink_socket_perms;
-allow prelude_correlator_t self:tcp_socket create_stream_socket_perms;
-allow prelude_correlator_t self:unix_dgram_socket create_socket_perms;
+allow prelude_correlator_t self:tcp_socket { accept listen };
+
+manage_dirs_pattern(prelude_correlator_t, prelude_spool_t, prelude_spool_t)
+manage_files_pattern(prelude_correlator_t, prelude_spool_t, prelude_spool_t)
 
 allow prelude_correlator_t prelude_correlator_config_t:dir list_dir_perms;
 read_files_pattern(prelude_correlator_t, prelude_correlator_config_t, prelude_correlator_config_t)
@@ -187,7 +188,10 @@
 corenet_all_recvfrom_netlabel(prelude_correlator_t)
 corenet_tcp_sendrecv_generic_if(prelude_correlator_t)
 corenet_tcp_sendrecv_generic_node(prelude_correlator_t)
+
+corenet_sendrecv_prelude_client_packets(prelude_correlator_t)
 corenet_tcp_connect_prelude_port(prelude_correlator_t)
+corenet_tcp_sendrecv_prelude_port(prelude_correlator_t)
 
 dev_read_rand(prelude_correlator_t)
 dev_read_urand(prelude_correlator_t)
@@ -202,31 +206,24 @@
 
 sysnet_dns_name_resolve(prelude_correlator_t)
 
-prelude_manage_spool(prelude_correlator_t)
-
 ########################################
 #
-# prelude_lml local declarations
+# Lml local declarations
 #
 
 allow prelude_lml_t self:capability dac_override;
-allow prelude_lml_t self:tcp_socket { write getattr setopt read create connect };
-allow prelude_lml_t self:unix_dgram_socket { write create connect };
 allow prelude_lml_t self:fifo_file rw_fifo_file_perms;
 allow prelude_lml_t self:unix_stream_socket connectto;
 
 manage_dirs_pattern(prelude_lml_t, prelude_lml_tmp_t, prelude_lml_tmp_t)
 manage_files_pattern(prelude_lml_t, prelude_lml_tmp_t, prelude_lml_tmp_t)
 files_tmp_filetrans(prelude_lml_t, prelude_lml_tmp_t, { file dir })
-files_list_tmp(prelude_lml_t)
 
 manage_dirs_pattern(prelude_lml_t, prelude_spool_t, prelude_spool_t)
 manage_files_pattern(prelude_lml_t, prelude_spool_t, prelude_spool_t)
-files_search_spool(prelude_lml_t)
 
 manage_dirs_pattern(prelude_lml_t, prelude_var_lib_t, prelude_var_lib_t)
 manage_files_pattern(prelude_lml_t, prelude_var_lib_t, prelude_var_lib_t)
-files_search_var_lib(prelude_lml_t)
 
 manage_files_pattern(prelude_lml_t, prelude_lml_var_run_t, prelude_lml_var_run_t)
 files_pid_filetrans(prelude_lml_t, prelude_lml_var_run_t, file)
@@ -236,19 +233,22 @@
 
 corecmd_exec_bin(prelude_lml_t)
 
+corenet_all_recvfrom_unlabeled(prelude_lml_t)
+corenet_all_recvfrom_netlabel(prelude_lml_t)
 corenet_tcp_sendrecv_generic_if(prelude_lml_t)
 corenet_tcp_sendrecv_generic_node(prelude_lml_t)
-corenet_tcp_recvfrom_netlabel(prelude_lml_t)
-corenet_tcp_recvfrom_unlabeled(prelude_lml_t)
-corenet_sendrecv_unlabeled_packets(prelude_lml_t)
+
+corenet_sendrecv_prelude_client_packets(prelude_lml_t)
 corenet_tcp_connect_prelude_port(prelude_lml_t)
+corenet_tcp_sendrecv_prelude_port(prelude_lml_t)
 
 dev_read_rand(prelude_lml_t)
 dev_read_urand(prelude_lml_t)
 
 files_list_etc(prelude_lml_t)
-files_read_etc_files(prelude_lml_t)
+files_list_tmp(prelude_lml_t)
 files_read_etc_runtime_files(prelude_lml_t)
+files_search_spool(prelude_lml_t)
 
 fs_getattr_all_fs(prelude_lml_t)
 fs_list_inotifyfs(prelude_lml_t)
@@ -264,8 +264,6 @@
 
 miscfiles_read_localization(prelude_lml_t)
 
-sysnet_dns_name_resolve(prelude_lml_t)
-
 userdom_read_all_users_state(prelude_lml_t)
 
 optional_policy(`
@@ -275,7 +273,7 @@
 
 ########################################
 #
-# prewikka_cgi Declarations
+# Cgi Declarations
 #
 
 optional_policy(`
@@ -283,14 +281,11 @@
 
 	can_exec(httpd_prewikka_script_t, httpd_prewikka_script_exec_t)
 
-	files_read_etc_files(httpd_prewikka_script_t)
 	files_search_tmp(httpd_prewikka_script_t)
 
 	kernel_read_sysctl(httpd_prewikka_script_t)
 	kernel_search_network_sysctl(httpd_prewikka_script_t)
 
-	corenet_tcp_connect_postgresql_port(httpd_prewikka_script_t)
-
 	auth_use_nsswitch(httpd_prewikka_script_t)
 
 	logging_send_syslog_msg(httpd_prewikka_script_t)
@@ -298,11 +293,12 @@
 	apache_search_sys_content(httpd_prewikka_script_t)
 
 	optional_policy(`
-		mysql_search_db(httpd_prewikka_script_t)
 		mysql_stream_connect(httpd_prewikka_script_t)
+		mysql_tcp_connect(httpd_prewikka_script_t)
 	')
 
 	optional_policy(`
 		postgresql_stream_connect(httpd_prewikka_script_t)
+		postgresql_tcp_connect(httpd_prewikka_script_t)
 	')
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/privoxy.fc refpolicy/policy/modules/contrib/privoxy.fc
--- refpolicy/policy/modules/contrib/privoxy.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/privoxy.fc	2012-10-19 14:39:00.678529222 +0200
@@ -1,6 +1,9 @@
-/etc/privoxy/[^/]*\.action --	gen_context(system_u:object_r:privoxy_etc_rw_t,s0)
-/etc/rc\.d/init\.d/privoxy --	gen_context(system_u:object_r:privoxy_initrc_exec_t,s0)
+/etc/privoxy/[^/]*\.action	--	gen_context(system_u:object_r:privoxy_etc_rw_t,s0)
+
+/etc/rc\.d/init\.d/privoxy	--	gen_context(system_u:object_r:privoxy_initrc_exec_t,s0)
 
 /usr/sbin/privoxy	--	gen_context(system_u:object_r:privoxy_exec_t,s0)
 
-/var/log/privoxy(/.*)?		gen_context(system_u:object_r:privoxy_log_t,s0)
+/var/log/privoxy(/.*)?	gen_context(system_u:object_r:privoxy_log_t,s0)
+
+/var/run/privoxy\.pid	--	gen_context(system_u:object_r:privoxy_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/privoxy.if refpolicy/policy/modules/contrib/privoxy.if
--- refpolicy/policy/modules/contrib/privoxy.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/privoxy.if	2012-10-19 14:39:00.678529222 +0200
@@ -2,8 +2,8 @@
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate
-##	an privoxy environment
+##	All of the rules required to
+##	administrate an privoxy environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/privoxy.te refpolicy/policy/modules/contrib/privoxy.te
--- refpolicy/policy/modules/contrib/privoxy.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/privoxy.te	2012-10-19 14:39:00.678529222 +0200
@@ -1,4 +1,4 @@
-policy_module(privoxy, 1.11.0)
+policy_module(privoxy, 1.11.1)
 
 ########################################
 #
@@ -6,14 +6,14 @@
 #
 
 ## <desc>
-## <p>
-## Allow privoxy to connect to all ports, not just
-## HTTP, FTP, and Gopher ports.
-## </p>
+##	<p>
+##	Determine whether privoxy can
+##	connect to all tcp ports.
+##	</p>
 ## </desc>
 gen_tunable(privoxy_connect_any, false)
 
-type privoxy_t; # web_client_domain
+type privoxy_t;
 type privoxy_exec_t;
 init_daemon_domain(privoxy_t, privoxy_exec_t)
 
@@ -36,47 +36,61 @@
 
 allow privoxy_t self:capability { setgid setuid };
 dontaudit privoxy_t self:capability sys_tty_config;
-allow privoxy_t self:tcp_socket create_stream_socket_perms;
+allow privoxy_t self:tcp_socket { accept listen };
 
 allow privoxy_t privoxy_etc_rw_t:file rw_file_perms;
 
-manage_files_pattern(privoxy_t, privoxy_log_t, privoxy_log_t)
+allow privoxy_t privoxy_log_t:dir setattr_dir_perms;
+append_files_pattern(privoxy_t, privoxy_log_t, privoxy_log_t)
+create_files_pattern(privoxy_t, privoxy_log_t, privoxy_log_t)
+setattr_files_pattern(privoxy_t, privoxy_log_t, privoxy_log_t)
 logging_log_filetrans(privoxy_t, privoxy_log_t, file)
 
 manage_files_pattern(privoxy_t, privoxy_var_run_t, privoxy_var_run_t)
 files_pid_filetrans(privoxy_t, privoxy_var_run_t, file)
 
-kernel_read_system_state(privoxy_t)
 kernel_read_kernel_sysctls(privoxy_t)
+kernel_read_network_state(privoxy_t)
+kernel_read_system_state(privoxy_t)
 
 corenet_all_recvfrom_unlabeled(privoxy_t)
 corenet_all_recvfrom_netlabel(privoxy_t)
 corenet_tcp_sendrecv_generic_if(privoxy_t)
 corenet_tcp_sendrecv_generic_node(privoxy_t)
-corenet_tcp_sendrecv_all_ports(privoxy_t)
 corenet_tcp_bind_generic_node(privoxy_t)
-corenet_tcp_bind_http_cache_port(privoxy_t)
+
+corenet_sendrecv_http_client_packets(privoxy_t)
 corenet_tcp_connect_http_port(privoxy_t)
+corenet_tcp_sendrecv_http_port(privoxy_t)
+
+corenet_sendrecv_http_cache_server_packets(privoxy_t)
+corenet_tcp_bind_http_cache_port(privoxy_t)
+corenet_sendrecv_http_cache_client_packets(privoxy_t)
 corenet_tcp_connect_http_cache_port(privoxy_t)
+corenet_tcp_sendrecv_http_cache_port(privoxy_t)
+
+corenet_sendrecv_squid_client_packets(privoxy_t)
 corenet_tcp_connect_squid_port(privoxy_t)
+corenet_tcp_sendrecv_squid_port(privoxy_t)
+
+corenet_sendrecv_ftp_client_packets(privoxy_t)
 corenet_tcp_connect_ftp_port(privoxy_t)
+corenet_tcp_sendrecv_ftp_port(privoxy_t)
+
+corenet_sendrecv_pgpkeyserver_client_packets(privoxy_t)
 corenet_tcp_connect_pgpkeyserver_port(privoxy_t)
-corenet_tcp_connect_tor_port(privoxy_t)
-corenet_sendrecv_http_cache_client_packets(privoxy_t)
-corenet_sendrecv_squid_client_packets(privoxy_t)
-corenet_sendrecv_http_cache_server_packets(privoxy_t)
-corenet_sendrecv_http_client_packets(privoxy_t)
-corenet_sendrecv_ftp_client_packets(privoxy_t)
+corenet_tcp_sendrecv_pgpkeyserver_port(privoxy_t)
+
 corenet_sendrecv_tor_client_packets(privoxy_t)
+corenet_tcp_connect_tor_port(privoxy_t)
+corenet_tcp_sendrecv_tor_port(privoxy_t)
 
 dev_read_sysfs(privoxy_t)
 
-fs_getattr_all_fs(privoxy_t)
-fs_search_auto_mountpoints(privoxy_t)
-
 domain_use_interactive_fds(privoxy_t)
 
-files_read_etc_files(privoxy_t)
+fs_getattr_all_fs(privoxy_t)
+fs_search_auto_mountpoints(privoxy_t)
 
 auth_use_nsswitch(privoxy_t)
 
@@ -86,12 +100,11 @@
 
 userdom_dontaudit_use_unpriv_user_fds(privoxy_t)
 userdom_dontaudit_search_user_home_dirs(privoxy_t)
-# cjp: this should really not be needed
-userdom_use_user_terminals(privoxy_t)
 
 tunable_policy(`privoxy_connect_any',`
-	corenet_tcp_connect_all_ports(privoxy_t)
 	corenet_sendrecv_all_client_packets(privoxy_t)
+	corenet_tcp_connect_all_ports(privoxy_t)
+	corenet_tcp_sendrecv_all_ports(privoxy_t)
 ')
 
 optional_policy(`
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/procmail.fc refpolicy/policy/modules/contrib/procmail.fc
--- refpolicy/policy/modules/contrib/procmail.fc	2012-05-04 15:16:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/procmail.fc	2012-10-19 14:39:02.591529227 +0200
@@ -1,5 +1,6 @@
+HOME_DIR/\.procmailrc	--	gen_context(system_u:object_r:procmail_home_t,s0)
 
 /usr/bin/procmail	--	gen_context(system_u:object_r:procmail_exec_t,s0)
 
-/var/log/procmail\.log.* --	gen_context(system_u:object_r:procmail_log_t,s0)
-/var/log/procmail(/.*)?		gen_context(system_u:object_r:procmail_log_t,s0) 
+/var/log/procmail\.log.*	--	gen_context(system_u:object_r:procmail_log_t,s0)
+/var/log/procmail(/.*)?	gen_context(system_u:object_r:procmail_log_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/procmail.if refpolicy/policy/modules/contrib/procmail.if
--- refpolicy/policy/modules/contrib/procmail.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/procmail.if	2012-10-19 14:39:02.591529227 +0200
@@ -1,4 +1,4 @@
-## <summary>Procmail mail delivery agent</summary>
+## <summary>Procmail mail delivery agent.</summary>
 
 ########################################
 ## <summary>
@@ -15,7 +15,6 @@
 		type procmail_exec_t, procmail_t;
 	')
 
-	files_search_usr($1)
 	corecmd_search_bin($1)
 	domtrans_pattern($1, procmail_exec_t, procmail_t)
 ')
@@ -35,13 +34,100 @@
 		type procmail_exec_t;
 	')
 
-	files_search_usr($1)
 	corecmd_search_bin($1)
 	can_exec($1, procmail_exec_t)
 ')
 
 ########################################
 ## <summary>
+##	Create, read, write, and delete
+##	procmail home files.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`procmail_manage_home_files',`
+	gen_require(`
+		type procmail_home_t;
+	')
+
+	userdom_search_user_home_dirs($1)
+	allow $1 procmail_home_t:file manage_file_perms;
+')
+
+########################################
+## <summary>
+##	Read procmail user home content files.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`procmail_read_home_files',`
+	gen_require(`
+		type procmail_home_t;
+
+	')
+
+	userdom_search_user_home_dirs($1)
+	allow $1 procmail_home_t:file read_file_perms;
+')
+
+########################################
+## <summary>
+##	Relabel procmail home files.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`procmail_relabel_home_files',`
+	gen_require(`
+		type ppp_home_t;
+	')
+
+	userdom_search_user_home_dirs($1)
+	allow $1 procmail_home_t:file relabel_file_perms;
+')
+
+########################################
+## <summary>
+##	Create objects in user home
+##	directories with the procmail home type.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="object_class">
+##	<summary>
+##	Class of the object being created.
+##	</summary>
+## </param>
+## <param name="name" optional="true">
+##	<summary>
+##	The name of the object being created.
+##	</summary>
+## </param>
+#
+interface(`procmail_home_filetrans_procmail_home',`
+	gen_require(`
+		type procmail_home_t;
+	')
+
+	userdom_user_home_dir_filetrans($1, procmail_home_t, $2, $3)
+')
+
+########################################
+## <summary>
 ##	Read procmail tmp files.
 ## </summary>
 ## <param name="domain">
@@ -61,7 +147,7 @@
 
 ########################################
 ## <summary>
-##	Read/write procmail tmp files.
+##	Read and write procmail tmp files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/procmail.te refpolicy/policy/modules/contrib/procmail.te
--- refpolicy/policy/modules/contrib/procmail.te	2012-05-04 15:16:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/procmail.te	2012-10-19 14:39:02.591529227 +0200
@@ -1,4 +1,4 @@
-policy_module(procmail, 1.12.0)
+policy_module(procmail, 1.12.1)
 
 ########################################
 #
@@ -10,8 +10,11 @@
 application_domain(procmail_t, procmail_exec_t)
 role system_r types procmail_t;
 
+type procmail_home_t;
+userdom_user_home_content(procmail_home_t)
+
 type procmail_log_t;
-logging_log_file(procmail_log_t) 
+logging_log_file(procmail_log_t)
 
 type procmail_tmp_t;
 files_tmp_file(procmail_tmp_t)
@@ -24,15 +27,11 @@
 allow procmail_t self:capability { sys_nice chown fsetid setuid setgid dac_override };
 allow procmail_t self:process { setsched signal signull };
 allow procmail_t self:fifo_file rw_fifo_file_perms;
-allow procmail_t self:unix_stream_socket create_socket_perms;
-allow procmail_t self:unix_dgram_socket create_socket_perms;
-allow procmail_t self:tcp_socket create_stream_socket_perms;
-allow procmail_t self:udp_socket create_socket_perms;
+allow procmail_t self:tcp_socket { accept listen };
 
-can_exec(procmail_t, procmail_exec_t)
+allow procmail_t procmail_home_t:file read_file_perms;
 
-# Write log to /var/log/procmail.log or /var/log/procmail/.*
-allow procmail_t procmail_log_t:dir setattr;
+allow procmail_t procmail_log_t:dir setattr_dir_perms;
 create_files_pattern(procmail_t, procmail_log_t, procmail_log_t)
 append_files_pattern(procmail_t, procmail_log_t, procmail_log_t)
 read_lnk_files_pattern(procmail_t, procmail_log_t, procmail_log_t)
@@ -41,61 +40,43 @@
 allow procmail_t procmail_tmp_t:file manage_file_perms;
 files_tmp_filetrans(procmail_t, procmail_tmp_t, file)
 
+can_exec(procmail_t, procmail_exec_t)
+
 kernel_read_system_state(procmail_t)
 kernel_read_kernel_sysctls(procmail_t)
 
 corenet_all_recvfrom_unlabeled(procmail_t)
 corenet_all_recvfrom_netlabel(procmail_t)
 corenet_tcp_sendrecv_generic_if(procmail_t)
-corenet_udp_sendrecv_generic_if(procmail_t)
 corenet_tcp_sendrecv_generic_node(procmail_t)
-corenet_udp_sendrecv_generic_node(procmail_t)
-corenet_tcp_sendrecv_all_ports(procmail_t)
-corenet_udp_sendrecv_all_ports(procmail_t)
-corenet_udp_bind_generic_node(procmail_t)
-corenet_tcp_connect_spamd_port(procmail_t)
+
 corenet_sendrecv_spamd_client_packets(procmail_t)
+corenet_tcp_connect_spamd_port(procmail_t)
+corenet_tcp_sendrecv_spamd_port(procmail_t)
+
 corenet_sendrecv_comsat_client_packets(procmail_t)
+corenet_tcp_connect_comsat_port(procmail_t)
+corenet_tcp_sendrecv_comsat_port(procmail_t)
+
+corecmd_exec_bin(procmail_t)
+corecmd_exec_shell(procmail_t)
 
 dev_read_urand(procmail_t)
 
-fs_getattr_xattr_fs(procmail_t)
+fs_getattr_all_fs(procmail_t)
 fs_search_auto_mountpoints(procmail_t)
 fs_rw_anon_inodefs_files(procmail_t)
 
 auth_use_nsswitch(procmail_t)
 
-corecmd_exec_bin(procmail_t)
-corecmd_exec_shell(procmail_t)
-corecmd_read_bin_symlinks(procmail_t)
-
-files_read_etc_files(procmail_t)
 files_read_etc_runtime_files(procmail_t)
-files_search_pids(procmail_t)
-# for spamassasin
 files_read_usr_files(procmail_t)
 
 logging_send_syslog_msg(procmail_t)
 
 miscfiles_read_localization(procmail_t)
 
-# only works until we define a different type for maildir
-userdom_manage_user_home_content_dirs(procmail_t)
-userdom_manage_user_home_content_files(procmail_t)
-userdom_manage_user_home_content_symlinks(procmail_t)
-userdom_manage_user_home_content_pipes(procmail_t)
-userdom_manage_user_home_content_sockets(procmail_t)
-userdom_user_home_dir_filetrans_user_home_content(procmail_t, { dir file lnk_file fifo_file sock_file })
-
-# Do not audit attempts to access /root.
-userdom_dontaudit_search_user_home_dirs(procmail_t)
-
-mta_manage_spool(procmail_t)
-mta_read_queue(procmail_t)
-
-ifdef(`hide_broken_symptoms',`
-	mta_dontaudit_rw_queue(procmail_t)
-')
+userdom_search_user_home_dirs(procmail_t)
 
 tunable_policy(`use_nfs_home_dirs',`
 	fs_manage_nfs_dirs(procmail_t)
@@ -115,16 +96,32 @@
 ')
 
 optional_policy(`
+	cyrus_stream_connect(procmail_t)
+')
+
+optional_policy(`
+	mta_manage_spool(procmail_t)
+	mta_read_config(procmail_t)
+	mta_read_queue(procmail_t)
+	mta_manage_mail_home_rw_content(procmail_t)
+	mta_home_filetrans_mail_home_rw(procmail_t, dir, "Maildir")
+')
+
+optional_policy(`
 	munin_dontaudit_search_lib(procmail_t)
 ')
 
 optional_policy(`
-	# for a bug in the postfix local program
+	nagios_search_spool(procmail_t)
+')
+
+optional_policy(`
 	postfix_dontaudit_rw_local_tcp_sockets(procmail_t)
 	postfix_dontaudit_use_fds(procmail_t)
 	postfix_read_spool_files(procmail_t)
 	postfix_read_local_state(procmail_t)
 	postfix_read_master_state(procmail_t)
+	postfix_rw_master_pipes(procmail_t)
 ')
 
 optional_policy(`
@@ -133,7 +130,6 @@
 ')
 
 optional_policy(`
-	mta_read_config(procmail_t)
 	sendmail_domtrans(procmail_t)
 	sendmail_signal(procmail_t)
 	sendmail_dontaudit_rw_tcp_sockets(procmail_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/psad.fc refpolicy/policy/modules/contrib/psad.fc
--- refpolicy/policy/modules/contrib/psad.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/psad.fc	2012-10-22 19:56:33.046013652 +0200
@@ -1,8 +1,11 @@
-/etc/rc\.d/init\.d/psad --		gen_context(system_u:object_r:psad_initrc_exec_t,s0)
-/etc/psad(/.*)?				gen_context(system_u:object_r:psad_etc_t,s0)
+/etc/psad(/.*)?	gen_context(system_u:object_r:psad_etc_t,s0)
 
-/usr/sbin/psad		--		gen_context(system_u:object_r:psad_exec_t,s0)
+/etc/rc\.d/init\.d/psad	--	gen_context(system_u:object_r:psad_initrc_exec_t,s0)
 
-/var/lib/psad(/.*)?			gen_context(system_u:object_r:psad_var_lib_t,s0)
-/var/log/psad(/.*)?			gen_context(system_u:object_r:psad_var_log_t,s0)
-/var/run/psad(/.*)?			gen_context(system_u:object_r:psad_var_run_t,s0)
+/usr/sbin/psad	--	gen_context(system_u:object_r:psad_exec_t,s0)
+
+/var/lib/psad(/.*)?	gen_context(system_u:object_r:psad_var_lib_t,s0)
+
+/var/log/psad(/.*)?	gen_context(system_u:object_r:psad_var_log_t,s0)
+
+/var/run/psad(/.*)?	gen_context(system_u:object_r:psad_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/psad.if refpolicy/policy/modules/contrib/psad.if
--- refpolicy/policy/modules/contrib/psad.if	2012-05-04 15:16:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/psad.if	2012-10-22 19:56:33.067013652 +0200
@@ -1,4 +1,4 @@
-## <summary>Intrusion Detection and Log Analysis with iptables</summary>
+## <summary>Intrusion Detection and Log Analysis with iptables.</summary>
 
 ########################################
 ## <summary>
@@ -15,12 +15,13 @@
 		type psad_t, psad_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, psad_exec_t, psad_t)
 ')
 
 ########################################
 ## <summary>
-##	Send a generic signal to psad
+##	Send generic signals to psad.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -38,7 +39,7 @@
 
 #######################################
 ## <summary>
-##	Send a null signal to psad.
+##	Send null signals to psad.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -56,7 +57,7 @@
 
 ########################################
 ## <summary>
-##	Read psad etc configuration files.
+##	Read psad configuration content.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -70,12 +71,15 @@
 	')
 
 	files_search_etc($1)
-	read_files_pattern($1, psad_etc_t, psad_etc_t)
+	allow $1 psad_etc_t:dir list_dir_perms;
+	allow $1 psad_etc_t:file read_file_perms;
+	allow $1 psad_etc_t:lnk_file read_lnk_file_perms;
 ')
 
 ########################################
 ## <summary>
-##	Manage psad etc configuration files.
+##	Create, read, write, and delete
+##	psad configuration content.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -89,14 +93,14 @@
 	')
 
 	files_search_etc($1)
-	manage_dirs_pattern($1, psad_etc_t, psad_etc_t)
-	manage_files_pattern($1, psad_etc_t, psad_etc_t)
-
+	allow $1 psad_etc_t:dir manage_dir_perms;
+	allow $1 psad_etc_t:file manage_file_perms;
+	allow $1 psad_etc_t:lnk_file manage_lnk_file_perms;
 ')
 
 ########################################
 ## <summary>
-##	Read psad PID files.
+##	Read psad pid files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -115,7 +119,7 @@
 
 ########################################
 ## <summary>
-##	Read psad PID files.
+##	Read and write psad pid files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -134,7 +138,7 @@
 
 ########################################
 ## <summary>
-##	Allow the specified domain to read psad's log files.
+##	Read psad log content.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -149,13 +153,13 @@
 	')
 
 	logging_search_logs($1)
-	list_dirs_pattern($1, psad_var_log_t, psad_var_log_t)
-	read_files_pattern($1, psad_var_log_t, psad_var_log_t)
+	allow $1 psad_var_log_t:dir list_dir_perms;
+	allow $1 psad_var_log_t:file read_file_perms;
 ')
 
 ########################################
 ## <summary>
-##	Allow the specified domain to append to psad's log files.
+##	Append psad log files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -170,7 +174,6 @@
 	')
 
 	logging_search_logs($1)
-	list_dirs_pattern($1, psad_var_log_t, psad_var_log_t)
 	append_files_pattern($1, psad_var_log_t, psad_var_log_t)
 ')
 
@@ -186,17 +189,16 @@
 #
 interface(`psad_rw_fifo_file',`
 	gen_require(`
-		type psad_t;
+		type psad_var_lib_t;
 	')
 
 	files_search_var_lib($1)
-	search_dirs_pattern($1, psad_var_lib_t, psad_var_lib_t)
 	rw_fifo_files_pattern($1, psad_var_lib_t, psad_var_lib_t)
 ')
 
 #######################################
 ## <summary>
-##	Read and write psad tmp files.
+##	Read and write psad temporary files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -215,8 +217,8 @@
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate 
-##	an psad environment
+##	All of the rules required to
+##	administrate an psad environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -225,7 +227,7 @@
 ## </param>
 ## <param name="role">
 ##	<summary>
-##	The role to be allowed to manage the syslog domain.
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <rolecap/>
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/psad.te refpolicy/policy/modules/contrib/psad.te
--- refpolicy/policy/modules/contrib/psad.te	2012-05-04 15:16:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/psad.te	2012-10-22 19:56:33.073013652 +0200
@@ -1,4 +1,4 @@
-policy_module(psad, 1.0.0) 
+policy_module(psad, 1.0.1)
 
 ########################################
 #
@@ -9,89 +9,81 @@
 type psad_exec_t;
 init_daemon_domain(psad_t, psad_exec_t)
 
-# config files
 type psad_etc_t;
-files_type(psad_etc_t)
+files_config_file(psad_etc_t)
 
 type psad_initrc_exec_t;
 init_script_file(psad_initrc_exec_t)
 
-# var/lib files
 type psad_var_lib_t;
 files_type(psad_var_lib_t)
 
-# log files
 type psad_var_log_t;
 logging_log_file(psad_var_log_t)
 
-# pid files
 type psad_var_run_t;
 files_pid_file(psad_var_run_t)
 
-# tmp files
 type psad_tmp_t;
 files_tmp_file(psad_tmp_t)
 
 ########################################
 #
-# psad local policy
+# Local policy
 #
 
 allow psad_t self:capability { net_admin net_raw setuid setgid dac_override };
 dontaudit psad_t self:capability sys_tty_config;
-allow psad_t self:process signull;
+allow psad_t self:process signal_perms;
 allow psad_t self:fifo_file rw_fifo_file_perms;
 allow psad_t self:rawip_socket create_socket_perms;
 
-# config files
-read_files_pattern(psad_t, psad_etc_t, psad_etc_t)
-list_dirs_pattern(psad_t, psad_etc_t, psad_etc_t)
+allow psad_t psad_etc_t:dir list_dir_perms;
+allow psad_t psad_etc_t:file read_file_perms;
+allow psad_t psad_etc_t:lnk_file read_lnk_file_perms;
 
-# log files
-manage_files_pattern(psad_t, psad_var_log_t, psad_var_log_t)
 manage_dirs_pattern(psad_t, psad_var_log_t, psad_var_log_t)
+append_files_pattern(psad_t, psad_var_log_t, psad_var_log_t)
+create_files_pattern(psad_t, psad_var_log_t, psad_var_log_t)
+setattr_files_pattern(psad_t, psad_var_log_t, psad_var_log_t)
 logging_log_filetrans(psad_t, psad_var_log_t, { file dir })
 
-# pid file
+manage_dirs_pattern(psad_t, psad_var_run_t, psad_var_run_t)
 manage_files_pattern(psad_t, psad_var_run_t, psad_var_run_t)
 manage_sock_files_pattern(psad_t, psad_var_run_t, psad_var_run_t)
-files_pid_filetrans(psad_t, psad_var_run_t, { file sock_file })
+files_pid_filetrans(psad_t, psad_var_run_t, { dir file sock_file })
 
-# tmp files
 manage_dirs_pattern(psad_t, psad_tmp_t, psad_tmp_t)
 manage_files_pattern(psad_t, psad_tmp_t, psad_tmp_t)
 files_tmp_filetrans(psad_t, psad_tmp_t, { file dir })
 
-# /var/lib files
-search_dirs_pattern(psad_t, psad_var_lib_t, psad_var_lib_t)
 manage_fifo_files_pattern(psad_t, psad_var_lib_t, psad_var_lib_t)
 
 kernel_read_system_state(psad_t)
 kernel_read_network_state(psad_t)
 kernel_read_net_sysctls(psad_t)
 
-corecmd_exec_shell(psad_t)
 corecmd_exec_bin(psad_t)
+corecmd_exec_shell(psad_t)
 
 corenet_all_recvfrom_unlabeled(psad_t)
 corenet_all_recvfrom_netlabel(psad_t)
 corenet_tcp_sendrecv_generic_if(psad_t)
 corenet_tcp_sendrecv_generic_node(psad_t)
-corenet_tcp_bind_generic_node(psad_t)
-corenet_tcp_sendrecv_all_ports(psad_t)
-corenet_tcp_connect_whois_port(psad_t)
+
 corenet_sendrecv_whois_client_packets(psad_t)
+corenet_tcp_connect_whois_port(psad_t)
+corenet_tcp_sendrecv_whois_port(psad_t)
 
 dev_read_urand(psad_t)
 
 files_read_etc_runtime_files(psad_t)
+files_read_usr_files(psad_t)
 
 fs_getattr_all_fs(psad_t)
 
 auth_use_nsswitch(psad_t)
 
-iptables_domtrans(psad_t)
-
 logging_read_generic_logs(psad_t)
 logging_read_syslog_config(psad_t)
 logging_send_syslog_msg(psad_t)
@@ -101,6 +93,10 @@
 sysnet_exec_ifconfig(psad_t)
 
 optional_policy(`
+	iptables_domtrans(psad_t)
+')
+
+optional_policy(`
 	mta_send_mail(psad_t)
 	mta_read_queue(psad_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/ptchown.if refpolicy/policy/modules/contrib/ptchown.if
--- refpolicy/policy/modules/contrib/ptchown.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/ptchown.if	2012-11-02 20:08:08.163957376 +0100
@@ -1,4 +1,4 @@
-## <summary>helper function for grantpt(3), changes ownship and permissions of pseudotty</summary>
+## <summary>helper function for grantpt(3), changes ownship and permissions of pseudotty.</summary>
 
 ########################################
 ## <summary>
@@ -15,13 +15,34 @@
 		type ptchown_t, ptchown_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, ptchown_exec_t, ptchown_t)
 ')
 
+#######################################
+## <summary>
+##	Execute ptchown in the caller domain.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`ptchown_exec',`
+	gen_require(`
+		type ptchown_exec_t;
+	')
+
+	corecmd_search_bin($1)
+	can_exec($1, ptchown_exec_t)
+')
+
 ########################################
 ## <summary>
-##	Execute ptchown in the ptchown domain, and
-##	allow the specified role the ptchown domain.
+##	Execute ptchown in the ptchown
+##	domain, and allow the specified
+##	role the ptchown domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -36,9 +57,9 @@
 #
 interface(`ptchown_run',`
 	gen_require(`
-		type ptchown_t;
+		attribute_role ptchown_roles;
 	')
 
 	ptchown_domtrans($1)
-	role $2 types ptchown_t;
+	roleattribute $2 ptchown_roles;
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/ptchown.te refpolicy/policy/modules/contrib/ptchown.te
--- refpolicy/policy/modules/contrib/ptchown.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/ptchown.te	2012-11-02 20:08:08.164957376 +0100
@@ -1,18 +1,21 @@
-policy_module(ptchown, 1.1.0)
+policy_module(ptchown, 1.1.2)
 
 ########################################
 #
 # Declarations
 #
 
+attribute_role ptchown_roles;
+roleattribute system_r ptchown_roles;
+
 type ptchown_t;
 type ptchown_exec_t;
 application_domain(ptchown_t, ptchown_exec_t)
-role system_r types ptchown_t;
+role ptchown_roles types ptchown_t;
 
 ########################################
 #
-# ptchown local policy
+# Local policy
 #
 
 allow ptchown_t self:capability { chown fowner fsetid setuid };
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/publicfile.fc refpolicy/policy/modules/contrib/publicfile.fc
--- refpolicy/policy/modules/contrib/publicfile.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/publicfile.fc	2012-10-22 19:57:35.959013786 +0200
@@ -1,6 +1,5 @@
-
-/usr/bin/ftpd		--	gen_context(system_u:object_r:publicfile_exec_t,s0)
-/usr/bin/httpd		--	gen_context(system_u:object_r:publicfile_exec_t,s0)
+/usr/bin/publicfile-ftpd		--	gen_context(system_u:object_r:publicfile_exec_t,s0)
+/usr/bin/publicfile-httpd		--	gen_context(system_u:object_r:publicfile_exec_t,s0)
 
 # this is the place where online content located
 # set this to suit your needs
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/publicfile.if refpolicy/policy/modules/contrib/publicfile.if
--- refpolicy/policy/modules/contrib/publicfile.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/publicfile.if	2012-10-22 19:57:45.688013807 +0200
@@ -1 +1 @@
-## <summary>publicfile supplies files to the public through HTTP and FTP</summary>
+## <summary>publicfile supplies files to the public through HTTP and FTP.</summary>
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/publicfile.te refpolicy/policy/modules/contrib/publicfile.te
--- refpolicy/policy/modules/contrib/publicfile.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/publicfile.te	2012-10-22 19:57:45.698013806 +0200
@@ -1,4 +1,4 @@
-policy_module(publicfile, 1.1.0)
+policy_module(publicfile, 1.1.1)
 
 ########################################
 #
@@ -18,8 +18,10 @@
 #
 
 allow publicfile_t self:capability { dac_override setgid setuid sys_chroot };
+
 allow publicfile_t publicfile_content_t:dir list_dir_perms;
 allow publicfile_t publicfile_content_t:file read_file_perms;
+allow publicfile_t publicfile_content_t:lnk_file read_lnk_file_perms;
 
 files_search_var(publicfile_t)
 
@@ -30,5 +32,3 @@
 optional_policy(`
 	ucspitcp_service_domain(publicfile_t, publicfile_exec_t)
 ')
-
-#allow publicfile_t initrc_t:tcp_socket { read write };
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/pulseaudio.fc refpolicy/policy/modules/contrib/pulseaudio.fc
--- refpolicy/policy/modules/contrib/pulseaudio.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/pulseaudio.fc	2012-11-02 20:08:32.391957427 +0100
@@ -1,7 +1,9 @@
-HOME_DIR/\.pulse-cookie		gen_context(system_u:object_r:pulseaudio_home_t,s0)
-HOME_DIR/\.pulse(/.*)?		gen_context(system_u:object_r:pulseaudio_home_t,s0)
+HOME_DIR/\.esd_auth	--	gen_context(system_u:object_r:pulseaudio_home_t,s0)
+HOME_DIR/\.pulse(/.*)?	gen_context(system_u:object_r:pulseaudio_home_t,s0)
+HOME_DIR/\.pulse-cookie	--	gen_context(system_u:object_r:pulseaudio_home_t,s0)
 
 /usr/bin/pulseaudio	--	gen_context(system_u:object_r:pulseaudio_exec_t,s0)
 
-/var/lib/pulse(/.*)?		gen_context(system_u:object_r:pulseaudio_var_lib_t,s0)
-/var/run/pulse(/.*)?		gen_context(system_u:object_r:pulseaudio_var_run_t,s0)
+/var/lib/pulse(/.*)?	gen_context(system_u:object_r:pulseaudio_var_lib_t,s0)
+
+/var/run/pulse(/.*)?	gen_context(system_u:object_r:pulseaudio_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/pulseaudio.if refpolicy/policy/modules/contrib/pulseaudio.if
--- refpolicy/policy/modules/contrib/pulseaudio.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/pulseaudio.if	2012-11-02 20:09:22.165957534 +0100
@@ -2,41 +2,47 @@
 
 ########################################
 ## <summary>
-##	Role access for pulseaudio
+##	Role access for pulseaudio.
 ## </summary>
 ## <param name="role">
 ##	<summary>
-##	Role allowed access
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <param name="domain">
 ##	<summary>
-##	User domain for the role
+##	User domain for the role.
 ##	</summary>
 ## </param>
 #
 interface(`pulseaudio_role',`
 	gen_require(`
-		type pulseaudio_t, pulseaudio_exec_t;
-		class dbus { acquire_svc send_msg };
+		attribute pulseaudio_tmpfsfile;
+		type pulseaudio_t, pulseaudio_home_t, pulseaudio_tmpfs_t;
+		type pulseaudio_tmp_t;
 	')
 
-	role $1 types pulseaudio_t;
-
-	# Transition from the user domain to the derived domain.
-	domtrans_pattern($2, pulseaudio_exec_t, pulseaudio_t)
+	pulseaudio_run($2, $1)
 
+	allow $2 pulseaudio_t:process { ptrace signal_perms };
 	ps_process_pattern($2, pulseaudio_t)
 
-	allow pulseaudio_t $2:process { signal signull };
-	allow $2 pulseaudio_t:process { signal signull sigkill };
-	ps_process_pattern(pulseaudio_t, $2)
+	allow $2 pulseaudio_home_t:dir { manage_dir_perms relabel_dir_perms };
+	allow $2 pulseaudio_home_t:file { manage_file_perms relabel_file_perms };
+	allow $2 pulseaudio_home_t:lnk_file { manage_lnk_file_perms relabel_lnk_file_perms };
+
+	userdom_user_home_dir_filetrans($2, pulseaudio_home_t, dir, ".pulse")
+	userdom_user_home_dir_filetrans($2, pulseaudio_home_t, file, ".esd_auth")
+	userdom_user_home_dir_filetrans($2, pulseaudio_home_t, file, ".pulse-cookie")
+
+	allow $2 { pulseaudio_tmpfs_t pulseaudio_tmpfsfile }:dir { manage_dir_perms relabel_dir_perms };
+	allow $2 { pulseaudio_tmpfs_t pulseaudio_tmpfsfile }:file { manage_file_perms relabel_file_perms };
+
+	allow $2 pulseaudio_tmp_t:dir { manage_dir_perms relabel_dir_perms };
+	allow $2 pulseaudio_tmp_t:file { manage_file_perms relabel_file_perms };
+	allow $2 pulseaudio_tmp_t:sock_file { manage_sock_file_perms relabel_sock_file_perms };
 
 	allow pulseaudio_t $2:unix_stream_socket connectto;
-	allow $2 pulseaudio_t:unix_stream_socket connectto;
-
-	allow $2 pulseaudio_t:dbus send_msg;
-	allow pulseaudio_t $2:dbus { acquire_svc send_msg };
 ')
 
 ########################################
@@ -51,16 +57,21 @@
 #
 interface(`pulseaudio_domtrans',`
 	gen_require(`
+		attribute pulseaudio_client;
 		type pulseaudio_t, pulseaudio_exec_t;
 	')
 
+	typeattribute $1 pulseaudio_client;
+
+	corecmd_search_bin($1)
 	domtrans_pattern($1, pulseaudio_exec_t, pulseaudio_t)
 ')
 
 ########################################
 ## <summary>
-##	Execute pulseaudio in the pulseaudio domain, and
-##	allow the specified role the pulseaudio domain.
+##	Execute pulseaudio in the pulseaudio
+##	domain, and allow the specified role
+##	the pulseaudio domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -75,16 +86,16 @@
 #
 interface(`pulseaudio_run',`
 	gen_require(`
-		type pulseaudio_t;
+		attribute_role pulseaudio_roles;
 	')
 
 	pulseaudio_domtrans($1)
-	role $2 types pulseaudio_t;
+	roleattribute $2 pulseaudio_roles;
 ')
 
 ########################################
 ## <summary>
-##	Execute a pulseaudio in the current domain.
+##	Execute pulseaudio in the caller domain.
 ## </summary>
 ## <param name="domain">
 ## <summary>
@@ -97,12 +108,13 @@
 		type pulseaudio_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	can_exec($1, pulseaudio_exec_t)
 ')
 
 ########################################
 ## <summary>
-##	Do not audit to execute a pulseaudio.
+##	Do not audit attempts to execute pulseaudio.
 ## </summary>
 ## <param name="domain">
 ## <summary>
@@ -120,7 +132,7 @@
 
 ########################################
 ## <summary>
-##	Send signull signal to pulseaudio
+##	Send null signals to pulseaudio.
 ##	processes.
 ## </summary>
 ## <param name="domain">
@@ -139,8 +151,8 @@
 
 #####################################
 ## <summary>
-##	Connect to pulseaudio over a unix domain
-##	stream socket.
+##	Connect to pulseaudio with a unix
+##	domain stream socket.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -150,13 +162,11 @@
 #
 interface(`pulseaudio_stream_connect',`
 	gen_require(`
-		type pulseaudio_t, pulseaudio_var_run_t;
+		type pulseaudio_t, pulseaudio_var_run_t, pulseaudio_tmp_t;
 	')
 
 	files_search_pids($1)
-	allow $1 pulseaudio_t:process signull;
-	allow pulseaudio_t $1:process signull;
-	stream_connect_pattern($1, pulseaudio_var_run_t, pulseaudio_var_run_t, pulseaudio_t)
+	stream_connect_pattern($1, { pulseaudio_tmp_t pulseaudio_var_run_t }, { pulseaudio_tmp_t pulseaudio_var_run_t }, pulseaudio_t)
 ')
 
 ########################################
@@ -182,9 +192,9 @@
 
 ########################################
 ## <summary>
-##	Set the attributes of the pulseaudio homedir.
+##	Set attributes of pulseaudio home directories.
 ## </summary>
-## <param name="user_domain">
+## <param name="domain">
 ##	<summary>
 ##	Domain allowed access.
 ##	</summary>
@@ -195,34 +205,50 @@
 		type pulseaudio_home_t;
 	')
 
-	allow $1 pulseaudio_home_t:dir setattr;
+	allow $1 pulseaudio_home_t:dir setattr_dir_perms;
 ')
 
 ########################################
 ## <summary>
-##	Read pulseaudio homedir files.
+##	Read pulseaudio home content.
 ## </summary>
-## <param name="user_domain">
+## <param name="domain">
 ##	<summary>
 ##	Domain allowed access.
 ##	</summary>
 ## </param>
 #
 interface(`pulseaudio_read_home_files',`
+	refpolicywarn(`$0($*) has been deprecated, use pulseaudio_read_home() instead.')
+	pulseaudio_read_home($1)
+')
+
+########################################
+## <summary>
+##	Read pulseaudio home content.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`pulseaudio_read_home',`
 	gen_require(`
 		type pulseaudio_home_t;
 	')
 
 	userdom_search_user_home_dirs($1)
-	read_files_pattern($1, pulseaudio_home_t, pulseaudio_home_t)
-	read_lnk_files_pattern($1, pulseaudio_home_t, pulseaudio_home_t)
+	allow $1 pulseaudio_home_t:dir list_dir_perms;
+	allow $1 pulseaudio_home_t:file read_file_perms;
+	allow $1 pulseaudio_home_t:lnk_file read_lnk_file_perms;
 ')
 
 ########################################
 ## <summary>
 ##	Read and write Pulse Audio files.
 ## </summary>
-## <param name="user_domain">
+## <param name="domain">
 ##	<summary>
 ##	Domain allowed access.
 ##	</summary>
@@ -233,28 +259,94 @@
 		type pulseaudio_home_t;
 	')
 
+	userdom_search_user_home_dirs($1)
 	rw_files_pattern($1, pulseaudio_home_t, pulseaudio_home_t)
 	read_lnk_files_pattern($1, pulseaudio_home_t, pulseaudio_home_t)
-	userdom_search_user_home_dirs($1)
 ')
 
 ########################################
 ## <summary>
-##	Create, read, write, and delete pulseaudio
-##	home directory files.
+##	Create, read, write, and delete
+##	pulseaudio home content.
 ## </summary>
-## <param name="user_domain">
+## <param name="domain">
 ##	<summary>
 ##	Domain allowed access.
 ##	</summary>
 ## </param>
 #
 interface(`pulseaudio_manage_home_files',`
+	refpolicywarn(`$0($*) has been deprecated, use pulseaudio_manage_home() instead.')
+	pulseaudio_manage_home($1)
+')
+
+########################################
+## <summary>
+##	Create, read, write, and delete
+##	pulseaudio home content.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`pulseaudio_manage_home',`
 	gen_require(`
 		type pulseaudio_home_t;
 	')
 
 	userdom_search_user_home_dirs($1)
-	manage_files_pattern($1, pulseaudio_home_t, pulseaudio_home_t)
-	read_lnk_files_pattern($1, pulseaudio_home_t, pulseaudio_home_t)
+	allow $1 pulseaudio_home_t:dir manage_dir_perms;
+	allow $1 pulseaudio_home_t:file manage_file_perms;
+	allow $1 pulseaudio_home_t:lnk_file manage_lnk_file_perms;
+')
+
+########################################
+## <summary>
+##	Create objects in user home
+##	directories with the pulseaudio
+##	home type.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="object_class">
+##	<summary>
+##	Class of the object being created.
+##	</summary>
+## </param>
+## <param name="name" optional="true">
+##	<summary>
+##	The name of the object being created.
+##	</summary>
+## </param>
+#
+interface(`pulseaudio_home_filetrans_pulseaudio_home',`
+	gen_require(`
+		type pulseaudio_home_t;
+	')
+
+	userdom_user_home_dir_filetrans($1, pulseaudio_home_t, $2, $3)
+')
+
+########################################
+## <summary>
+##	Make the specified tmpfs file type
+##	pulseaudio tmpfs content.
+## </summary>
+## <param name="file_type">
+##	<summary>
+##	File type to make pulseaudio tmpfs content.
+##	</summary>
+## </param>
+#
+interface(`pulseaudio_tmpfs_content',`
+	gen_require(`
+		attribute pulseaudio_tmpfsfile;
+	')
+
+	typeattribute $1 pulseaudio_tmpfsfile;
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/pulseaudio.te refpolicy/policy/modules/contrib/pulseaudio.te
--- refpolicy/policy/modules/contrib/pulseaudio.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/pulseaudio.te	2012-11-02 20:09:22.165957534 +0100
@@ -1,47 +1,68 @@
-policy_module(pulseaudio, 1.5.0)
+policy_module(pulseaudio, 1.5.3)
 
 ########################################
 #
 # Declarations
 #
 
+attribute pulseaudio_client;
+attribute pulseaudio_tmpfsfile;
+
+attribute_role pulseaudio_roles;
+
 type pulseaudio_t;
 type pulseaudio_exec_t;
 init_daemon_domain(pulseaudio_t, pulseaudio_exec_t)
 userdom_user_application_domain(pulseaudio_t, pulseaudio_exec_t)
-role system_r types pulseaudio_t;
+role pulseaudio_roles types pulseaudio_t;
 
 type pulseaudio_home_t;
 userdom_user_home_content(pulseaudio_home_t)
 
+type pulseaudio_tmp_t;
+userdom_user_tmp_file(pulseaudio_tmp_t)
+
 type pulseaudio_tmpfs_t;
 userdom_user_tmpfs_file(pulseaudio_tmpfs_t)
 
 type pulseaudio_var_lib_t;
 files_type(pulseaudio_var_lib_t)
-ubac_constrained(pulseaudio_var_lib_t)
 
 type pulseaudio_var_run_t;
 files_pid_file(pulseaudio_var_run_t)
-ubac_constrained(pulseaudio_var_run_t)
 
 ########################################
 #
-# pulseaudio local policy
+# Local policy
 #
 
 allow pulseaudio_t self:capability { fowner fsetid chown setgid setuid sys_nice sys_resource sys_tty_config };
 allow pulseaudio_t self:process { getcap setcap setrlimit setsched getsched signal signull };
-allow pulseaudio_t self:fifo_file rw_file_perms;
-allow pulseaudio_t self:unix_stream_socket { create_stream_socket_perms connectto };
-allow pulseaudio_t self:unix_dgram_socket { sendto create_socket_perms };
-allow pulseaudio_t self:tcp_socket create_stream_socket_perms;
-allow pulseaudio_t self:udp_socket create_socket_perms;
+allow pulseaudio_t self:fifo_file rw_fifo_file_perms;
+allow pulseaudio_t self:unix_stream_socket { accept connectto listen };
+allow pulseaudio_t self:unix_dgram_socket sendto;
+allow pulseaudio_t self:tcp_socket { accept listen };
 allow pulseaudio_t self:netlink_kobject_uevent_socket create_socket_perms;
 
-manage_dirs_pattern(pulseaudio_t, pulseaudio_home_t, pulseaudio_home_t)
-manage_files_pattern(pulseaudio_t, pulseaudio_home_t, pulseaudio_home_t)
-userdom_search_user_home_dirs(pulseaudio_t)
+allow pulseaudio_t pulseaudio_home_t:dir manage_dir_perms;
+allow pulseaudio_t pulseaudio_home_t:file manage_file_perms;
+allow pulseaudio_t pulseaudio_home_t:lnk_file manage_lnk_file_perms;
+
+userdom_user_home_dir_filetrans(pulseaudio_t, pulseaudio_home_t, dir, ".pulse")
+userdom_user_home_dir_filetrans(pulseaudio_t, pulseaudio_home_t, file, ".esd_auth")
+userdom_user_home_dir_filetrans(pulseaudio_t, pulseaudio_home_t, file, ".pulse-cookie")
+
+manage_dirs_pattern(pulseaudio_t, pulseaudio_tmp_t, pulseaudio_tmp_t)
+manage_files_pattern(pulseaudio_t, pulseaudio_tmp_t, pulseaudio_tmp_t)
+manage_sock_files_pattern(pulseaudio_t, pulseaudio_tmp_t, pulseaudio_tmp_t)
+files_tmp_filetrans(pulseaudio_t, pulseaudio_tmp_t, dir)
+userdom_user_tmp_filetrans(pulseaudio_t, pulseaudio_tmp_t, file, "pid")
+userdom_user_tmp_filetrans(pulseaudio_t, pulseaudio_tmp_t, sock_file, "dbus-socket")
+userdom_user_tmp_filetrans(pulseaudio_t, pulseaudio_tmp_t, sock_file, "native")
+
+manage_dirs_pattern(pulseaudio_t, pulseaudio_tmpfs_t, pulseaudio_tmpfs_t)
+manage_files_pattern(pulseaudio_t, pulseaudio_tmpfs_t, pulseaudio_tmpfs_t)
+fs_tmpfs_filetrans(pulseaudio_t, pulseaudio_tmpfs_t, { dir file })
 
 manage_dirs_pattern(pulseaudio_t, pulseaudio_var_lib_t, pulseaudio_var_lib_t)
 manage_files_pattern(pulseaudio_t, pulseaudio_var_lib_t, pulseaudio_var_lib_t)
@@ -53,6 +74,9 @@
 manage_sock_files_pattern(pulseaudio_t, pulseaudio_var_run_t, pulseaudio_var_run_t)
 files_pid_filetrans(pulseaudio_t, pulseaudio_var_run_t, { dir file })
 
+allow pulseaudio_t pulseaudio_client:process signull;
+ps_process_pattern(pulseaudio_t, pulseaudio_client)
+
 can_exec(pulseaudio_t, pulseaudio_exec_t)
 
 kernel_getattr_proc(pulseaudio_t)
@@ -63,25 +87,35 @@
 
 corenet_all_recvfrom_unlabeled(pulseaudio_t)
 corenet_all_recvfrom_netlabel(pulseaudio_t)
-corenet_tcp_bind_pulseaudio_port(pulseaudio_t)
-corenet_tcp_bind_soundd_port(pulseaudio_t)
 corenet_tcp_sendrecv_generic_if(pulseaudio_t)
-corenet_tcp_sendrecv_generic_node(pulseaudio_t)
-corenet_udp_bind_sap_port(pulseaudio_t)
 corenet_udp_sendrecv_generic_if(pulseaudio_t)
+corenet_tcp_sendrecv_generic_node(pulseaudio_t)
 corenet_udp_sendrecv_generic_node(pulseaudio_t)
 
+corenet_sendrecv_pulseaudio_server_packets(pulseaudio_t)
+corenet_tcp_bind_pulseaudio_port(pulseaudio_t)
+corenet_tcp_sendrecv_pulseaudio_port(pulseaudio_t)
+
+corenet_sendrecv_soundd_server_packets(pulseaudio_t)
+corenet_tcp_bind_soundd_port(pulseaudio_t)
+corenet_tcp_sendrecv_soundd_port(pulseaudio_t)
+
+corenet_sendrecv_sap_server_packets(pulseaudio_t)
+corenet_udp_bind_sap_port(pulseaudio_t)
+corenet_udp_sendrecv_sap_port(pulseaudio_t)
+
 dev_read_sound(pulseaudio_t)
 dev_write_sound(pulseaudio_t)
 dev_read_sysfs(pulseaudio_t)
 dev_read_urand(pulseaudio_t)
 
-files_read_etc_files(pulseaudio_t)
 files_read_usr_files(pulseaudio_t)
 
-fs_rw_anon_inodefs_files(pulseaudio_t)
 fs_getattr_tmpfs(pulseaudio_t)
+fs_getattr_all_fs(pulseaudio_t)
 fs_list_inotifyfs(pulseaudio_t)
+fs_rw_anon_inodefs_files(pulseaudio_t)
+fs_search_auto_mountpoints(pulseaudio_t)
 
 term_use_all_ttys(pulseaudio_t)
 term_use_all_ptys(pulseaudio_t)
@@ -92,10 +126,24 @@
 
 miscfiles_read_localization(pulseaudio_t)
 
-# cjp: this seems excessive. need to confirm
-userdom_manage_user_home_content_files(pulseaudio_t)
-userdom_manage_user_tmp_files(pulseaudio_t)
-userdom_manage_user_tmpfs_files(pulseaudio_t)
+userdom_search_user_home_dirs(pulseaudio_t)
+userdom_write_user_tmp_sockets(pulseaudio_t)
+
+tunable_policy(`use_nfs_home_dirs',`
+	fs_manage_nfs_dirs(pulseaudio_t)
+	fs_manage_nfs_files(pulseaudio_t)
+	fs_manage_nfs_symlinks(pulseaudio_t)
+')
+
+tunable_policy(`use_samba_home_dirs',`
+	fs_manage_cifs_dirs(pulseaudio_t)
+	fs_manage_cifs_files(pulseaudio_t)
+	fs_manage_cifs_symlinks(pulseaudio_t)
+')
+
+optional_policy(`
+	alsa_read_rw_config(pulseaudio_t)
+')
 
 optional_policy(`
 	bluetooth_stream_connect(pulseaudio_t)
@@ -103,9 +151,8 @@
 
 optional_policy(`
 	dbus_system_domain(pulseaudio_t, pulseaudio_exec_t)
-	dbus_system_bus_client(pulseaudio_t)
-	dbus_session_bus_client(pulseaudio_t)
-	dbus_connect_session_bus(pulseaudio_t)
+	dbus_all_session_bus_client(pulseaudio_t)
+	dbus_connect_all_session_bus(pulseaudio_t)
 
 	optional_policy(`
 		consolekit_dbus_chat(pulseaudio_t)
@@ -146,3 +193,59 @@
 	xserver_read_xdm_pid(pulseaudio_t)
 	xserver_user_x_domain_template(pulseaudio, pulseaudio_t, pulseaudio_tmpfs_t)
 ')
+
+########################################
+#
+# Client local policy
+#
+
+allow pulseaudio_client self:unix_dgram_socket sendto;
+
+allow pulseaudio_client pulseaudio_client:process signull;
+
+read_files_pattern(pulseaudio_client, { pulseaudio_tmpfsfile pulseaudio_tmpfs_t }, { pulseaudio_tmpfsfile pulseaudio_tmpfs_t })
+delete_files_pattern(pulseaudio_client, pulseaudio_tmpfsfile, pulseaudio_tmpfsfile)
+
+fs_getattr_tmpfs(pulseaudio_client)
+
+corenet_all_recvfrom_unlabeled(pulseaudio_client)
+corenet_all_recvfrom_netlabel(pulseaudio_client)
+corenet_tcp_sendrecv_generic_if(pulseaudio_client)
+corenet_tcp_sendrecv_generic_node(pulseaudio_client)
+
+corenet_sendrecv_pulseaudio_client_packets(pulseaudio_client)
+corenet_tcp_connect_pulseaudio_port(pulseaudio_client)
+corenet_tcp_sendrecv_pulseaudio_port(pulseaudio_client)
+
+pulseaudio_stream_connect(pulseaudio_client)
+pulseaudio_manage_home(pulseaudio_client)
+pulseaudio_home_filetrans_pulseaudio_home(pulseaudio_client, dir, ".pulse")
+pulseaudio_home_filetrans_pulseaudio_home(pulseaudio_client, file, ".esd_auth")
+pulseaudio_home_filetrans_pulseaudio_home(pulseaudio_client, file, ".pulse-cookie")
+pulseaudio_signull(pulseaudio_client)
+
+rtkit_scheduled(pulseaudio_client)
+
+# TODO: ~/.cache
+userdom_manage_user_home_content_files(pulseaudio_client)
+
+userdom_read_user_tmpfs_files(pulseaudio_client)
+# userdom_delete_user_tmpfs_files(pulseaudio_client)
+
+tunable_policy(`use_nfs_home_dirs',`
+	fs_getattr_nfs(pulseaudio_client)
+	fs_manage_nfs_dirs(pulseaudio_client)
+	fs_manage_nfs_files(pulseaudio_client)
+	fs_read_nfs_symlinks(pulseaudio_client)
+')
+
+tunable_policy(`use_samba_home_dirs',`
+	fs_getattr_cifs(pulseaudio_client)
+	fs_manage_cifs_dirs(pulseaudio_client)
+	fs_manage_cifs_files(pulseaudio_client)
+	fs_read_cifs_symlinks(pulseaudio_client)
+')
+
+optional_policy(`
+	pulseaudio_dbus_chat(pulseaudio_client)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/puppet.fc refpolicy/policy/modules/contrib/puppet.fc
--- refpolicy/policy/modules/contrib/puppet.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/puppet.fc	2012-10-22 20:05:41.082014823 +0200
@@ -1,11 +1,17 @@
-/etc/puppet(/.*)?			gen_context(system_u:object_r:puppet_etc_t,s0)
+/etc/puppet(/.*)?	gen_context(system_u:object_r:puppet_etc_t,s0)
 
 /etc/rc\.d/init\.d/puppet	--	gen_context(system_u:object_r:puppet_initrc_exec_t,s0)
 /etc/rc\.d/init\.d/puppetmaster --	gen_context(system_u:object_r:puppetmaster_initrc_exec_t,s0)
 
-/usr/sbin/puppetd		--	gen_context(system_u:object_r:puppet_exec_t,s0)
-/usr/sbin/puppetmasterd		--	gen_context(system_u:object_r:puppetmaster_exec_t,s0)
+/usr/sbin/puppetca	--	gen_context(system_u:object_r:puppetca_exec_t,s0)
+/usr/bin/puppetca	--	gen_context(system_u:object_r:puppetca_exec_t,s0)
+/usr/bin/puppetd	--	gen_context(system_u:object_r:puppet_exec_t,s0)
+/usr/sbin/puppetd	--	gen_context(system_u:object_r:puppet_exec_t,s0)
+/usr/bin/puppetmasterd	--	gen_context(system_u:object_r:puppetmaster_exec_t,s0)
+/usr/sbin/puppetmasterd	--	gen_context(system_u:object_r:puppetmaster_exec_t,s0)
 
-/var/lib/puppet(/.*)?			gen_context(system_u:object_r:puppet_var_lib_t,s0)
-/var/log/puppet(/.*)?			gen_context(system_u:object_r:puppet_log_t,s0)
-/var/run/puppet(/.*)?			gen_context(system_u:object_r:puppet_var_run_t,s0)
+/var/lib/puppet(/.*)?	gen_context(system_u:object_r:puppet_var_lib_t,s0)
+
+/var/log/puppet(/.*)?	gen_context(system_u:object_r:puppet_log_t,s0)
+
+/var/run/puppet(/.*)?	gen_context(system_u:object_r:puppet_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/puppet.if refpolicy/policy/modules/contrib/puppet.if
--- refpolicy/policy/modules/contrib/puppet.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/puppet.if	2012-10-24 20:04:30.025025566 +0200
@@ -1,19 +1,134 @@
-## <summary>Puppet client daemon</summary>
-## <desc>
-##	<p>
-##	Puppet is a configuration management system written in Ruby.
-##	The client daemon is responsible for periodically requesting the
-##	desired system state from the server and ensuring the state of
-##	the client system matches.
-##	</p>
-## </desc>
+## <summary>Configuration management system.</summary>
+
+########################################
+## <summary>
+##	Execute puppetca in the puppetca
+##	domain.
+## </summary>
+## <param name="domain">
+## <summary>
+##	Domain allowed to transition.
+## </summary>
+## </param>
+#
+interface(`puppet_domtrans_puppetca',`
+	gen_require(`
+		type puppetca_t, puppetca_exec_t;
+	')
+
+	corecmd_search_bin($1)
+	domtrans_pattern($1, puppetca_exec_t, puppetca_t)
+')
+
+#####################################
+## <summary>
+##	Execute puppetca in the puppetca
+##	domain and allow the specified
+##	role the puppetca domain.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed to transition.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`puppet_run_puppetca',`
+	gen_require(`
+		attribute_role puppetca_roles;
+	')
+
+	puppet_domtrans_puppetca($1)
+	roleattribute $2 puppetca_roles;
+')
+
+####################################
+## <summary>
+##	Read puppet configuration content.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`puppet_read_config',`
+	gen_require(`
+		type puppet_etc_t;
+	')
+
+	files_search_etc($1)
+	allow $1 puppet_etc_t:dir list_dir_perms;
+	allow $1 puppet_etc_t:file read_file_perms;
+	allow $1 puppet_etc_t:lnk_file read_lnk_file_perms;
+')
+
+################################################
+## <summary>
+##	Read Puppet lib files.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`puppet_read_lib_files',`
+	gen_require(`
+		type puppet_var_lib_t;
+	')
+
+	files_search_var_lib($1)
+	read_files_pattern($1, puppet_var_lib_t, puppet_var_lib_t)
+')
+
+###############################################
+## <summary>
+##	Create, read, write, and delete
+##	puppet lib files.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`puppet_manage_lib_files',`
+	gen_require(`
+		type puppet_var_lib_t;
+	')
+
+	files_search_var_lib($1)
+	manage_files_pattern($1, puppet_var_lib_t, puppet_var_lib_t)
+')
+
+#####################################
+## <summary>
+##	Read puppet log files.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`puppet_read_log_files',`
+	gen_require(`
+		type puppet_log_t;
+	')
+
+	logging_search_logs($1)
+	read_files_pattern($1, puppet_log_t, puppet_log_t)
+')
 
 ################################################
 ## <summary>
-##	Read / Write to Puppet temp files.  Puppet uses
-##	some system binaries (groupadd, etc) that run in
-##	a non-puppet domain and redirects output into temp
-##	files.
+##	Read and write to puppet tempoprary files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -26,6 +141,57 @@
 		type puppet_tmp_t;
 	')
 
+	files_search_tmp($1)
 	allow $1 puppet_tmp_t:file rw_file_perms;
+')
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an puppet environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`puppet_admin',`
+	gen_require(`
+		type puppet_initrc_exec_t, puppetmaster_initrc_exec_t, puppet_log_t;
+		type puppet_var_lib_t, puppet_tmp_t, puppet_etc_t;
+		type puppet_var_run_t, puppetmaster_tmp_t;
+		type puppet_t, puppetca_t, puppetmaster_t;
+	')
+
+	allow $1 { puppet_t puppetca_t puppetmaster_t }:process { ptrace signal_perms };
+	ps_process_pattern($1, { puppet_t puppetca_t puppetmaster_t })
+
+	init_labeled_script_domtrans($1, { puppet_initrc_exec_t puppetmaster_initrc_exec_t })
+	domain_system_change_exemption($1)
+	role_transition $2 { puppet_initrc_exec_t puppetmaster_initrc_exec_t } system_r;
+	allow $2 system_r;
+
+	files_search_etc($1)
+	admin_pattern($1, puppet_etc_t)
+
+	logging_search_logs($1)
+	admin_pattern($1, puppet_log_t)
+
+	files_search_var_lib($1)
+	admin_pattern($1, puppet_var_lib_t)
+
+	files_search_pids($1)
+	admin_pattern($1, puppet_var_run_t)
+
 	files_search_tmp($1)
+	admin_pattern($1, { puppet_tmp_t puppetmaster_tmp_t })
+
+	puppet_run_puppetca($1, $2)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/puppet.te refpolicy/policy/modules/contrib/puppet.te
--- refpolicy/policy/modules/contrib/puppet.te	2012-07-25 20:33:05.000000000 +0200
+++ refpolicy/policy/modules/contrib/puppet.te	2012-11-02 20:00:12.230956359 +0100
@@ -1,4 +1,4 @@
-policy_module(puppet, 1.3.0)
+policy_module(puppet, 1.3.5)
 
 ########################################
 #
@@ -6,13 +6,16 @@
 #
 
 ## <desc>
-## <p>
-## Allow Puppet client to manage all file
-## types.
-## </p>
+##	<p>
+##	Determine whether puppet can
+##	manage all non-security files.
+##	</p>
 ## </desc>
 gen_tunable(puppet_manage_all_files, false)
 
+attribute_role puppetca_roles;
+roleattribute system_r puppetca_roles;
+
 type puppet_t;
 type puppet_exec_t;
 init_daemon_domain(puppet_t, puppet_exec_t)
@@ -35,6 +38,11 @@
 type puppet_var_run_t;
 files_pid_file(puppet_var_run_t)
 
+type puppetca_t;
+type puppetca_exec_t;
+application_domain(puppetca_t, puppetca_exec_t)
+role puppetca_roles types puppetca_t;
+
 type puppetmaster_t;
 type puppetmaster_exec_t;
 init_daemon_domain(puppetmaster_t, puppetmaster_exec_t)
@@ -47,29 +55,30 @@
 
 ########################################
 #
-# Puppet personal policy
+# Local policy
 #
 
-allow puppet_t self:capability { fowner fsetid setuid setgid dac_override sys_nice sys_ptrace sys_tty_config };
+allow puppet_t self:capability { fowner fsetid setuid setgid dac_override sys_nice sys_tty_config };
 allow puppet_t self:process { signal signull getsched setsched };
 allow puppet_t self:fifo_file rw_fifo_file_perms;
-allow puppet_t self:netlink_route_socket create_netlink_socket_perms;
-allow puppet_t self:tcp_socket create_stream_socket_perms;
-allow puppet_t self:udp_socket create_socket_perms;
+allow puppet_t self:netlink_route_socket nlmsg_write;
+allow puppet_t self:tcp_socket { accept listen };
 
-read_files_pattern(puppet_t, puppet_etc_t, puppet_etc_t)
+allow puppet_t puppet_etc_t:dir list_dir_perms;
+allow puppet_t puppet_etc_t:file read_file_perms;
+allow puppet_t puppet_etc_t:lnk_file read_lnk_file_perms;
 
 manage_dirs_pattern(puppet_t, puppet_var_lib_t, puppet_var_lib_t)
 manage_files_pattern(puppet_t, puppet_var_lib_t, puppet_var_lib_t)
-files_search_var_lib(puppet_t)
 
 setattr_dirs_pattern(puppet_t, puppet_var_run_t, puppet_var_run_t)
 manage_files_pattern(puppet_t, puppet_var_run_t, puppet_var_run_t)
 files_pid_filetrans(puppet_t, puppet_var_run_t, { file dir })
 
-create_dirs_pattern(puppet_t, var_log_t, puppet_log_t)
-create_files_pattern(puppet_t, puppet_log_t, puppet_log_t)
+allow puppet_t puppet_log_t:dir { create_dir_perms setattr_dir_perms };
 append_files_pattern(puppet_t, puppet_log_t, puppet_log_t)
+create_files_pattern(puppet_t, puppet_log_t, puppet_log_t)
+setattr_files_pattern(puppet_t, puppet_log_t, puppet_log_t)
 logging_log_filetrans(puppet_t, puppet_log_t, { file dir })
 
 manage_dirs_pattern(puppet_t, puppet_tmp_t, puppet_tmp_t)
@@ -80,29 +89,33 @@
 kernel_dontaudit_search_kernel_sysctl(puppet_t)
 kernel_read_system_state(puppet_t)
 kernel_read_crypto_sysctls(puppet_t)
+kernel_read_kernel_sysctls(puppet_t)
 
 corecmd_exec_bin(puppet_t)
 corecmd_exec_shell(puppet_t)
+corecmd_read_all_executables(puppet_t)
 
 corenet_all_recvfrom_netlabel(puppet_t)
 corenet_all_recvfrom_unlabeled(puppet_t)
 corenet_tcp_sendrecv_generic_if(puppet_t)
 corenet_tcp_sendrecv_generic_node(puppet_t)
-corenet_tcp_bind_generic_node(puppet_t)
-corenet_tcp_connect_puppet_port(puppet_t)
+
 corenet_sendrecv_puppet_client_packets(puppet_t)
+corenet_tcp_connect_puppet_port(puppet_t)
+corenet_tcp_sendrecv_puppet_port(puppet_t)
 
 dev_read_rand(puppet_t)
 dev_read_sysfs(puppet_t)
 dev_read_urand(puppet_t)
 
-domain_read_all_domains_state(puppet_t)
 domain_interactive_fd(puppet_t)
+domain_read_all_domains_state(puppet_t)
 
 files_manage_config_files(puppet_t)
 files_manage_config_dirs(puppet_t)
 files_manage_etc_dirs(puppet_t)
 files_manage_etc_files(puppet_t)
+files_read_usr_files(puppet_t)
 files_read_usr_symlinks(puppet_t)
 files_relabel_config_dirs(puppet_t)
 files_relabel_config_files(puppet_t)
@@ -130,15 +143,57 @@
 seutil_domtrans_setfiles(puppet_t)
 seutil_domtrans_semanage(puppet_t)
 
-sysnet_dns_name_resolve(puppet_t)
 sysnet_run_ifconfig(puppet_t, system_r)
 
+ifdef(`distro_gentoo',`
+	allow puppet_t self:capability chown;
+
+	kernel_read_kernel_sysctls(puppet_t)
+	kernel_read_network_state(puppet_t)
+
+	sysnet_use_ldap(puppet_t)
+
+	usermanage_domtrans_passwd(puppet_t)
+
+	optional_policy(`
+		init_exec_rc(puppet_t)
+		portage_run(puppet_t, system_r)
+	')
+')
+
 tunable_policy(`puppet_manage_all_files',`
 	files_manage_non_auth_files(puppet_t)
+
+	# We should use files_relabel_all_files here, but it calls
+	# seutil_relabelto_bin_policy which sets a "typeattribute type attr",
+	# which is not allowed within a tunable_policy.
+	# So, we duplicate the content of files_relabel_all_files except for
+	# the policy configuration stuff and hope users do that through Portage
+
+	gen_require(`
+		attribute file_type;
+		attribute security_file_type;
+		type policy_config_t;
+	')
+
+	allow puppet_t { file_type -policy_config_t -security_file_type }:dir list_dir_perms;
+	relabel_dirs_pattern(puppet_t, { file_type -policy_config_t -security_file_type }, { file_type -policy_config_t -security_file_type })
+	relabel_files_pattern(puppet_t, { file_type -policy_config_t -security_file_type }, { file_type -policy_config_t -security_file_type })
+	relabel_lnk_files_pattern(puppet_t, { file_type -policy_config_t -security_file_type }, { file_type -policy_config_t -security_file_type })
+	relabel_fifo_files_pattern(puppet_t, { file_type -policy_config_t -security_file_type }, { file_type -policy_config_t -security_file_type })
+	relabel_sock_files_pattern(puppet_t, { file_type -policy_config_t -security_file_type }, { file_type -policy_config_t -security_file_type })
+	# this is only relabelfrom since there should be no
+	# device nodes with file types.
+	relabelfrom_blk_files_pattern(puppet_t, { file_type -policy_config_t -security_file_type }, { file_type -policy_config_t -security_file_type })
+	relabelfrom_chr_files_pattern(puppet_t, { file_type -policy_config_t -security_file_type }, { file_type -policy_config_t -security_file_type })
 ')
 
 optional_policy(`
-	consoletype_domtrans(puppet_t)
+	cfengine_read_lib_files(puppet_t)
+')
+
+optional_policy(`
+	consoletype_exec(puppet_t)
 ')
 
 optional_policy(`
@@ -146,6 +201,14 @@
 ')
 
 optional_policy(`
+	mount_domtrans(puppet_t)
+')
+
+optional_policy(`
+	mta_send_mail(puppet_t)
+')
+
+optional_policy(`
 	portage_domtrans(puppet_t)
 	portage_domtrans_fetch(puppet_t)
 	portage_domtrans_gcc_config(puppet_t)
@@ -170,38 +233,88 @@
 
 ########################################
 #
-# Pupper master personal policy
+# Ca local policy
+#
+
+allow puppetca_t self:capability { dac_override setgid setuid };
+allow puppetca_t self:fifo_file rw_fifo_file_perms;
+
+allow puppetca_t puppet_etc_t:dir list_dir_perms;
+allow puppetca_t puppet_etc_t:file read_file_perms;
+allow puppetca_t puppet_etc_t:lnk_file read_lnk_file_perms;
+
+allow puppetca_t puppet_var_lib_t:dir list_dir_perms;
+manage_files_pattern(puppetca_t, puppet_var_lib_t, puppet_var_lib_t)
+manage_dirs_pattern(puppetca_t, puppet_var_lib_t, puppet_var_lib_t)
+
+allow puppetca_t puppet_log_t:dir search_dir_perms;
+
+allow puppetca_t puppet_var_run_t:dir search_dir_perms;
+
+kernel_read_system_state(puppetca_t)
+kernel_read_kernel_sysctls(puppetca_t)
+
+corecmd_exec_bin(puppetca_t)
+corecmd_exec_shell(puppetca_t)
+
+dev_read_urand(puppetca_t)
+dev_search_sysfs(puppetca_t)
+
+files_read_etc_files(puppetca_t)
+files_search_pids(puppetca_t)
+files_search_var_lib(puppetca_t)
+
+selinux_validate_context(puppetca_t)
+
+logging_search_logs(puppetca_t)
+
+miscfiles_read_localization(puppetca_t)
+miscfiles_read_generic_certs(puppetca_t)
+
+seutil_read_file_contexts(puppetca_t)
+
+optional_policy(`
+	hostname_exec(puppetca_t)
+')
+
+########################################
+#
+# Master local policy
 #
 
 allow puppetmaster_t self:capability { dac_read_search dac_override setuid setgid fowner chown fsetid sys_tty_config };
 allow puppetmaster_t self:process { signal_perms getsched setsched };
 allow puppetmaster_t self:fifo_file rw_fifo_file_perms;
-allow puppetmaster_t self:netlink_route_socket create_netlink_socket_perms;
+allow puppetmaster_t self:netlink_route_socket nlmsg_write;
 allow puppetmaster_t self:socket create;
-allow puppetmaster_t self:tcp_socket create_stream_socket_perms;
-allow puppetmaster_t self:udp_socket create_socket_perms;
-
-list_dirs_pattern(puppetmaster_t, puppet_etc_t, puppet_etc_t)
-read_files_pattern(puppetmaster_t, puppet_etc_t, puppet_etc_t)
+allow puppetmaster_t self:tcp_socket { accept listen };
 
-allow puppetmaster_t puppet_log_t:dir { rw_dir_perms setattr };
-allow puppetmaster_t puppet_log_t:file { rw_file_perms create setattr };
+allow puppetmaster_t puppet_etc_t:dir list_dir_perms;
+allow puppetmaster_t puppet_etc_t:file read_file_perms;
+allow puppetmaster_t puppet_etc_t:lnk_file read_lnk_file_perms;
+
+allow puppetmaster_t puppet_log_t:dir setattr_dir_perms;
+append_files_pattern(puppetmaster_t, puppet_log_t, puppet_log_t)
+create_files_pattern(puppetmaster_t, puppet_log_t, puppet_log_t)
+setattr_files_pattern(puppetmaster_t, puppet_log_t, puppet_log_t)
 logging_log_filetrans(puppetmaster_t, puppet_log_t, { file dir })
 
-manage_dirs_pattern(puppetmaster_t, puppet_var_lib_t, puppet_var_lib_t)
-manage_files_pattern(puppetmaster_t, puppet_var_lib_t, puppet_var_lib_t)
+allow puppetmaster_t puppet_var_lib_t:dir { manage_dir_perms relabel_dir_perms };
+allow puppetmaster_t puppet_var_lib_t:file { manage_file_perms relabel_file_perms };
 
-setattr_dirs_pattern(puppetmaster_t, puppet_var_run_t, puppet_var_run_t)
-manage_files_pattern(puppetmaster_t, puppet_var_run_t, puppet_var_run_t)
+allow puppetmaster_t puppet_var_run_t:dir { create_dir_perms setattr_dir_perms relabel_dir_perms };
+allow puppetmaster_t puppet_var_run_t:file manage_file_perms;
 files_pid_filetrans(puppetmaster_t, puppet_var_run_t, { file dir })
 
-manage_dirs_pattern(puppetmaster_t, puppetmaster_tmp_t, puppetmaster_tmp_t)
-manage_files_pattern(puppetmaster_t, puppetmaster_tmp_t, puppetmaster_tmp_t)
+allow puppetmaster_t puppetmaster_tmp_t:dir { manage_dir_perms relabel_dir_perms };
+allow puppetmaster_t puppetmaster_tmp_t:file manage_file_perms;
 files_tmp_filetrans(puppetmaster_t, puppetmaster_tmp_t, { file dir })
 
 kernel_dontaudit_search_kernel_sysctl(puppetmaster_t)
+kernel_read_network_state(puppetmaster_t)
 kernel_read_system_state(puppetmaster_t)
 kernel_read_crypto_sysctls(puppetmaster_t)
+kernel_read_kernel_sysctls(puppetmaster_t)
 
 corecmd_exec_bin(puppetmaster_t)
 corecmd_exec_shell(puppetmaster_t)
@@ -211,22 +324,31 @@
 corenet_tcp_sendrecv_generic_if(puppetmaster_t)
 corenet_tcp_sendrecv_generic_node(puppetmaster_t)
 corenet_tcp_bind_generic_node(puppetmaster_t)
-corenet_tcp_bind_puppet_port(puppetmaster_t)
+
 corenet_sendrecv_puppet_server_packets(puppetmaster_t)
+corenet_tcp_bind_puppet_port(puppetmaster_t)
+corenet_tcp_sendrecv_puppet_port(puppetmaster_t)
 
 dev_read_rand(puppetmaster_t)
 dev_read_urand(puppetmaster_t)
+dev_search_sysfs(puppetmaster_t)
 
+domain_obj_id_change_exemption(puppetmaster_t)
 domain_read_all_domains_state(puppetmaster_t)
 
-files_read_etc_files(puppetmaster_t)
-files_search_var_lib(puppetmaster_t)
+files_read_usr_files(puppetmaster_t)
+
+selinux_validate_context(puppetmaster_t)
+
+auth_use_nsswitch(puppetmaster_t)
 
 logging_send_syslog_msg(puppetmaster_t)
 
+miscfiles_read_generic_certs(puppetmaster_t)
 miscfiles_read_localization(puppetmaster_t)
 
-sysnet_dns_name_resolve(puppetmaster_t)
+seutil_read_file_contexts(puppetmaster_t)
+
 sysnet_run_ifconfig(puppetmaster_t, system_r)
 
 optional_policy(`
@@ -234,8 +356,20 @@
 ')
 
 optional_policy(`
+	mysql_stream_connect(puppetmaster_t)
+')
+
+optional_policy(`
+	postgresql_stream_connect(puppetmaster_t)
+')
+
+optional_policy(`
 	files_read_usr_symlinks(puppetmaster_t)
 
 	rpm_exec(puppetmaster_t)
 	rpm_read_db(puppetmaster_t)
 ')
+
+optional_policy(`
+	mta_send_mail(puppetmaster_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/pwauth.fc refpolicy/policy/modules/contrib/pwauth.fc
--- refpolicy/policy/modules/contrib/pwauth.fc	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/pwauth.fc	2012-10-22 20:08:17.643015155 +0200
@@ -0,0 +1,3 @@
+/usr/bin/pwauth	--	gen_context(system_u:object_r:pwauth_exec_t,s0)
+
+/var/run/pwauth\.lock	--	gen_context(system_u:object_r:pwauth_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/pwauth.if refpolicy/policy/modules/contrib/pwauth.if
--- refpolicy/policy/modules/contrib/pwauth.if	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/pwauth.if	2012-10-22 20:08:17.644015155 +0200
@@ -0,0 +1,72 @@
+## <summary>External plugin for mod_authnz_external authenticator.</summary>
+
+########################################
+## <summary>
+##	Role access for pwauth.
+## </summary>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <param name="domain">
+##	<summary>
+##	User domain for the role.
+##	</summary>
+## </param>
+#
+interface(`pwauth_role',`
+	gen_require(`
+		type pwauth_t;
+	')
+
+	pwauth_run($2, $1)
+
+	ps_process_pattern($2, pwauth_t)
+	allow $2 pwauth_t:process { ptrace signal_perms };
+')
+
+########################################
+## <summary>
+##	Execute pwauth in the pwauth domain.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed to transition.
+##	</summary>
+## </param>
+#
+interface(`pwauth_domtrans',`
+	gen_require(`
+		type pwauth_t, pwauth_exec_t;
+	')
+
+	corecmd_search_bin($1)
+	domtrans_pattern($1, pwauth_exec_t, pwauth_t)
+')
+
+########################################
+## <summary>
+##	Execute pwauth in the pwauth
+##	domain, and allow the specified
+##	role the pwauth domain.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed to transition.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+#
+interface(`pwauth_run',`
+	gen_require(`
+		attribute_role pwauth_roles;
+	')
+
+	pwauth_domtrans($1)
+	roleattribute $2 pwauth_roles;
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/pwauth.te refpolicy/policy/modules/contrib/pwauth.te
--- refpolicy/policy/modules/contrib/pwauth.te	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/pwauth.te	2012-10-22 20:08:17.644015155 +0200
@@ -0,0 +1,42 @@
+policy_module(pwauth, 1.0.0)
+
+########################################
+#
+# Declarations
+#
+
+attribute_role pwauth_roles;
+roleattribute system_r pwauth_roles;
+
+type pwauth_t;
+type pwauth_exec_t;
+application_domain(pwauth_t, pwauth_exec_t)
+role pwauth_roles types pwauth_t;
+
+type pwauth_var_run_t;
+files_pid_file(pwauth_var_run_t)
+
+########################################
+#
+# Local policy
+#
+
+allow pwauth_t self:capability setuid;
+allow pwauth_t self:process setrlimit;
+allow pwauth_t self:fifo_file manage_fifo_file_perms;
+allow pwauth_t self:unix_stream_socket { accept listen };
+
+manage_files_pattern(pwauth_t, pwauth_var_run_t, pwauth_var_run_t)
+files_pid_filetrans(pwauth_t, pwauth_var_run_t, file)
+
+domain_use_interactive_fds(pwauth_t)
+
+auth_domtrans_chkpwd(pwauth_t)
+auth_use_nsswitch(pwauth_t)
+
+init_read_utmp(pwauth_t)
+
+logging_send_syslog_msg(pwauth_t)
+logging_send_audit_msgs(pwauth_t)
+
+miscfiles_read_localization(pwauth_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/pxe.fc refpolicy/policy/modules/contrib/pxe.fc
--- refpolicy/policy/modules/contrib/pxe.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/pxe.fc	2012-10-22 20:10:18.043015413 +0200
@@ -1,6 +1,7 @@
+/etc/rc\.d/init\.d/pxe	--	gen_context(system_u:object_r:pxe_initrc_exec_t,s0)
 
-/usr/sbin/pxe		--	gen_context(system_u:object_r:pxe_exec_t,s0)
+/usr/sbin/pxe	--	gen_context(system_u:object_r:pxe_exec_t,s0)
 
-/var/log/pxe\.log	--	gen_context(system_u:object_r:pxe_log_t,s0)
+/var/log/pxe\.log.*	--	gen_context(system_u:object_r:pxe_log_t,s0)
 
 /var/run/pxe\.pid	--	gen_context(system_u:object_r:pxe_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/pxe.if refpolicy/policy/modules/contrib/pxe.if
--- refpolicy/policy/modules/contrib/pxe.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/pxe.if	2012-10-22 20:10:18.347015409 +0200
@@ -1 +1,39 @@
-## <summary>Server for the PXE network boot protocol</summary>
+## <summary>Server for the PXE network boot protocol.</summary>
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an pxe environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`pxe_admin',`
+	gen_require(`
+		type pxe_t, pxe_initrc_exec_t, pxe_log_t;
+		type pxe_var_run_t;
+	')
+
+	allow $1 pxe_t:process { ptrace signal_perms };
+	ps_process_pattern($1, pxe_t)
+
+	init_labeled_script_domtrans($1, pxe_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 pxe_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	logging_search_logs($1)
+	admin_pattern($1, pxe_log_t)
+
+	files_search_pids($1)
+	admin_pattern($1, pxe_var_run_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/pxe.te refpolicy/policy/modules/contrib/pxe.te
--- refpolicy/policy/modules/contrib/pxe.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/pxe.te	2012-10-22 20:10:18.347015409 +0200
@@ -1,6 +1,4 @@
-policy_module(pxe, 1.4.0)
-
-# cjp: policy seems incomplete
+policy_module(pxe, 1.4.1)
 
 ########################################
 #
@@ -11,6 +9,9 @@
 type pxe_exec_t;
 init_daemon_domain(pxe_t, pxe_exec_t)
 
+type pxe_initrc_exec_t;
+init_script_file(pxe_initrc_exec_t)
+
 type pxe_log_t;
 logging_log_file(pxe_log_t)
 
@@ -26,17 +27,24 @@
 dontaudit pxe_t self:capability sys_tty_config;
 allow pxe_t self:process signal_perms;
 
-allow pxe_t pxe_log_t:file manage_file_perms;
+allow pxe_t pxe_log_t:file { append_file_perms create_file_perms setattr_file_perms };
 logging_log_filetrans(pxe_t, pxe_log_t, file)
 
 manage_files_pattern(pxe_t, pxe_var_run_t, pxe_var_run_t)
 files_pid_filetrans(pxe_t, pxe_var_run_t, file)
 
 kernel_read_kernel_sysctls(pxe_t)
-kernel_list_proc(pxe_t)
-kernel_read_proc_symlinks(pxe_t)
+kernel_read_system_state(pxe_t)
+
+corenet_all_recvfrom_unlabeled(pxe_t)
+corenet_all_recvfrom_netlabel(pxe_t)
+corenet_udp_sendrecv_generic_if(pxe_t)
+corenet_udp_sendrecv_generic_node(pxe_t)
+corenet_udp_bind_generic_node(pxe_t)
 
+corenet_sendrecv_pxe_server_packets(pxe_t)
 corenet_udp_bind_pxe_port(pxe_t)
+corenet_udp_sendrecv_pxe_port(pxe_t)
 
 dev_read_sysfs(pxe_t)
 
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/pyicqt.fc refpolicy/policy/modules/contrib/pyicqt.fc
--- refpolicy/policy/modules/contrib/pyicqt.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/pyicqt.fc	2012-10-08 10:25:48.563044087 +0200
@@ -1,7 +1,11 @@
-/etc/pyicq-t(/.*)?			gen_context(system_u:object_r:pyicqt_conf_t,s0)
+/etc/pyicq-t(/.*)?	gen_context(system_u:object_r:pyicqt_conf_t,s0)
+
+/etc/rc\.d/init\.d/pyicq-t	--	gen_context(system_u:object_r:pyicqt_initrc_exec_t,s0)
 
 /usr/share/pyicq-t/PyICQt\.py	--	gen_context(system_u:object_r:pyicqt_exec_t,s0)
 
-/var/run/pyicq-t(/.*)?			gen_context(system_u:object_r:pyicqt_var_run_t,s0)
+/var/log/pyicq-t\.log.*	--	gen_context(system_u:object_r:pyicqt_log_t,s0)
+
+/var/run/pyicq-t(/.*)?	gen_context(system_u:object_r:pyicqt_var_run_t,s0)
 
-/var/spool/pyicq-t(/.*)?		gen_context(system_u:object_r:pyicqt_spool_t,s0)
+/var/spool/pyicq-t(/.*)?	gen_context(system_u:object_r:pyicqt_spool_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/pyicqt.if refpolicy/policy/modules/contrib/pyicqt.if
--- refpolicy/policy/modules/contrib/pyicqt.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/pyicqt.if	2012-10-08 10:25:48.563044087 +0200
@@ -1 +1,45 @@
-## <summary>PyICQt is an ICQ transport for XMPP server.</summary>
+## <summary>ICQ transport for XMPP server.</summary>
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an pyicqt environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`pyicqt_admin',`
+	gen_require(`
+		type pyicqt_t, pyicqt_log_t, pyicqt_spool_t;
+		type pyicqt_var_run_t, pyicqt_initrc_exec_t, pyicqt_conf_t;
+	')
+
+	allow $1 pyicqt_t:process { ptrace signal_perms };
+	ps_process_pattern($1, pyicqt_t)
+
+	init_labeled_script_domtrans($1, pyicqt_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 pyicqt_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	files_search_etc($1)
+	admin_pattern($1, pyicqt_conf_t)
+
+	logging_search_logs($1)
+	admin_pattern($1, pyicqt_log_t)
+
+	files_search_spool($1)
+	admin_pattern($1, pyicqt_spool_t)
+
+	files_search_pids($1)
+	admin_pattern($1, pyicqt_var_run_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/pyicqt.te refpolicy/policy/modules/contrib/pyicqt.te
--- refpolicy/policy/modules/contrib/pyicqt.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/pyicqt.te	2012-10-08 10:25:48.571044085 +0200
@@ -1,4 +1,4 @@
-policy_module(pyicqt, 1.0.0)
+policy_module(pyicqt, 1.0.1)
 
 ########################################
 #
@@ -9,9 +9,15 @@
 type pyicqt_exec_t;
 init_daemon_domain(pyicqt_t, pyicqt_exec_t)
 
+type pyicqt_initrc_exec_t;
+init_script_file(pyicqt_initrc_exec_t)
+
 type pyicqt_conf_t;
 files_config_file(pyicqt_conf_t)
 
+type pyicqt_log_t;
+logging_log_file(pyicqt_log_t)
+
 type pyicqt_spool_t;
 files_type(pyicqt_spool_t)
 
@@ -20,18 +26,23 @@
 
 ########################################
 #
-# PyICQt policy
+# Local policy
 #
 
+allow pyicqt_t self:process signal_perms;
 allow pyicqt_t self:fifo_file rw_fifo_file_perms;
-allow pyicqt_t self:tcp_socket create_socket_perms;
-allow pyicqt_t self:udp_socket create_socket_perms;
+allow pyicqt_t self:tcp_socket { accept listen };
 
 read_files_pattern(pyicqt_t, pyicqt_conf_t, pyicqt_conf_t)
 
+allow pyicqt_t pyicqt_log_t:file append_file_perms;
+allow pyicqt_t pyicqt_log_t:file create_file_perms;
+allow pyicqt_t pyicqt_log_t:file setattr_file_perms;
+logging_log_filetrans(pyicqt_t, pyicqt_log_t, file)
+
 manage_dirs_pattern(pyicqt_t, pyicqt_spool_t, pyicqt_spool_t)
 manage_files_pattern(pyicqt_t, pyicqt_spool_t, pyicqt_spool_t)
-files_spool_filetrans(pyicqt_t, pyicqt_spool_t, { dir file })
+files_spool_filetrans(pyicqt_t, pyicqt_spool_t, dir)
 
 manage_files_pattern(pyicqt_t, pyicqt_var_run_t, pyicqt_var_run_t)
 files_pid_filetrans(pyicqt_t, pyicqt_var_run_t, file)
@@ -44,16 +55,38 @@
 corenet_all_recvfrom_netlabel(pyicqt_t)
 corenet_tcp_sendrecv_generic_if(pyicqt_t)
 corenet_tcp_sendrecv_generic_node(pyicqt_t)
-corenet_tcp_connect_generic_port(pyicqt_t)
-corenet_sendrecv_generic_client_packets(pyicqt_t)
+corenet_tcp_bind_generic_node(pyicqt_t)
+
+# corenet_sendrecv_jabber_router_server_packets(pyicqt_t)
+# corenet_tcp_bind_jabber_router_port(pyicqt_t)
+# corenet_sendrecv_jabber_router_client_packets(pyicqt_t)
+# corenet_tcp_connect_jabber_router_port(pyicqt_t)
+# corenet_tcp_sendrecv_jabber_router_port(pyicqt_t)
 
+dev_read_sysfs(pyicqt_t)
 dev_read_urand(pyicqt_t)
 
-files_read_etc_files(pyicqt_t)
 files_read_usr_files(pyicqt_t)
 
+fs_getattr_all_fs(pyicqt_t)
+
+auth_use_nsswitch(pyicqt_t)
+
 libs_read_lib_files(pyicqt_t)
 
+logging_send_syslog_msg(pyicqt_t)
+
 miscfiles_read_localization(pyicqt_t)
 
-sysnet_read_config(pyicqt_t)
+optional_policy(`
+	jabber_manage_lib_files(pyicqt_t)
+')
+
+optional_policy(`
+	mysql_stream_connect(pyicqt_t)
+	mysql_tcp_connect(pyicqt_t)
+')
+
+optional_policy(`
+	seutil_sigchld_newrole(pyicqt_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/pyzor.fc refpolicy/policy/modules/contrib/pyzor.fc
--- refpolicy/policy/modules/contrib/pyzor.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/pyzor.fc	2012-10-22 20:10:21.282015420 +0200
@@ -1,9 +1,12 @@
-/etc/pyzor(/.*)?		gen_context(system_u:object_r:pyzor_etc_t, s0)
+HOME_DIR/\.pyzor(/.*)?	gen_context(system_u:object_r:pyzor_home_t,s0)
 
-HOME_DIR/\.pyzor(/.*)?		gen_context(system_u:object_r:pyzor_home_t,s0)
+/etc/pyzor(/.*)?	gen_context(system_u:object_r:pyzor_etc_t, s0)
 
-/usr/bin/pyzor		--	gen_context(system_u:object_r:pyzor_exec_t,s0)
-/usr/bin/pyzord		--	gen_context(system_u:object_r:pyzord_exec_t,s0)
+/etc/rc\.d/init\.d/pyzord	--	gen_context(system_u:object_r:pyzord_initrc_exec_t,s0)
 
-/var/lib/pyzord(/.*)?		gen_context(system_u:object_r:pyzor_var_lib_t,s0)
-/var/log/pyzord\.log	--	gen_context(system_u:object_r:pyzord_log_t,s0)
+/usr/bin/pyzor	--	gen_context(system_u:object_r:pyzor_exec_t,s0)
+/usr/bin/pyzord	--	gen_context(system_u:object_r:pyzord_exec_t,s0)
+
+/var/lib/pyzord(/.*)?	gen_context(system_u:object_r:pyzor_var_lib_t,s0)
+
+/var/log/pyzord\.log.*	--	gen_context(system_u:object_r:pyzord_log_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/pyzor.if refpolicy/policy/modules/contrib/pyzor.if
--- refpolicy/policy/modules/contrib/pyzor.if	2012-05-04 15:16:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/pyzor.if	2012-10-22 20:10:21.283015420 +0200
@@ -2,7 +2,7 @@
 
 ########################################
 ## <summary>
-##	Role access for pyzor
+##	Role access for pyzor.
 ## </summary>
 ## <param name="role">
 ##	<summary>
@@ -17,23 +17,28 @@
 #
 interface(`pyzor_role',`
 	gen_require(`
-		type pyzor_t, pyzor_exec_t;
-		type pyzor_home_t, pyzor_var_lib_t, pyzor_tmp_t;
+		attribute_role pyzor_roles;
+		type pyzor_t, pyzor_exec_t, pyzor_home_t;
+		type pyzor_tmp_t;
 	')
 
-	role $1 types pyzor_t;
+	roleattribute $1 pyzor_roles;
 
-	# Transition from the user domain to the derived domain.
 	domtrans_pattern($2, pyzor_exec_t, pyzor_t)
 
-	# allow ps to show pyzor and allow the user to kill it 
+	allow $2 pyzor_t:process { ptrace signal_perms };
 	ps_process_pattern($2, pyzor_t)
-	allow $2 pyzor_t:process signal;
+
+	allow $2 { pyzor_home_t pyzor_tmp_t }:dir { manage_dir_perms relabel_dir_perms };
+	allow $2  { pyzor_home_t pyzor_tmp_t }:file { manage_file_perms relabel_file_perms };
+	allow $2 pyzor_home_t:lnk_file { manage_lnk_file_perms relabel_lnk_file_perms };
+
+	userdom_user_home_dir_filetrans($2, pyzor_home_t, dir, ".pyzor")
 ')
 
 ########################################
 ## <summary>
-##	Send generic signals to pyzor
+##	Send generic signals to pyzor.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -64,7 +69,6 @@
 		type pyzor_exec_t, pyzor_t;
 	')
 
-	files_search_usr($1)
 	corecmd_search_bin($1)
 	domtrans_pattern($1, pyzor_exec_t, pyzor_t)
 ')
@@ -84,7 +88,49 @@
 		type pyzor_exec_t;
 	')
 
-	files_search_usr($1)
 	corecmd_search_bin($1)
 	can_exec($1, pyzor_exec_t)
 ')
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an pyzor environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`pyzor_admin',`
+	gen_require(`
+		type pyzord_t, pyzord_initrc_exec_t, pyzord_log_t;
+		type pyzor_var_lib_t, pyzor_etc_t;
+	')
+
+	allow $1 pyzord_t:process { ptrace signal_perms };
+	ps_process_pattern($1, pyzord_t)
+
+	init_labeled_script_domtrans($1, pyzord_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 pyzord_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	files_search_etc($1)
+	admin_pattern($1, pyzor_etc_t)
+
+	logging_search_logs($1)
+	admin_pattern($1, pyzord_log_t)
+
+	files_search_var_lib($1)
+	admin_pattern($1, pyzor_var_lib_t)
+
+	pyzor_role($2, $1)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/pyzor.te refpolicy/policy/modules/contrib/pyzor.te
--- refpolicy/policy/modules/contrib/pyzor.te	2012-05-04 15:16:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/pyzor.te	2012-10-22 20:10:21.682015456 +0200
@@ -1,16 +1,19 @@
-policy_module(pyzor, 2.2.0)
+policy_module(pyzor, 2.2.1)
 
 ########################################
 #
 # Declarations
 #
 
+attribute_role pyzor_roles;
+roleattribute system_r pyzor_roles;
+
 type pyzor_t;
 type pyzor_exec_t;
 typealias pyzor_t alias { user_pyzor_t staff_pyzor_t sysadm_pyzor_t };
 typealias pyzor_t alias { auditadm_pyzor_t secadm_pyzor_t };
 userdom_user_application_domain(pyzor_t, pyzor_exec_t)
-role system_r types pyzor_t;
+role pyzor_roles types pyzor_t;
 
 type pyzor_etc_t;
 files_type(pyzor_etc_t)
@@ -35,24 +38,24 @@
 type pyzord_exec_t;
 init_daemon_domain(pyzord_t, pyzord_exec_t)
 
+type pyzord_initrc_exec_t;
+init_script_file(pyzord_initrc_exec_t)
+
 type pyzord_log_t;
 logging_log_file(pyzord_log_t)
 
 ########################################
 #
-# Pyzor client local policy
+# Local policy
 #
 
-allow pyzor_t self:udp_socket create_socket_perms;
-
 manage_dirs_pattern(pyzor_t, pyzor_home_t, pyzor_home_t)
 manage_files_pattern(pyzor_t, pyzor_home_t, pyzor_home_t)
 manage_lnk_files_pattern(pyzor_t, pyzor_home_t, pyzor_home_t)
-userdom_user_home_dir_filetrans(pyzor_t, pyzor_home_t, { dir file lnk_file })
+userdom_user_home_dir_filetrans(pyzor_t, pyzor_home_t, dir, ".pyzor")
 
 allow pyzor_t pyzor_var_lib_t:dir list_dir_perms;
 read_files_pattern(pyzor_t, pyzor_var_lib_t, pyzor_var_lib_t)
-files_search_var_lib(pyzor_t)
 
 manage_files_pattern(pyzor_t, pyzor_tmp_t, pyzor_tmp_t)
 manage_dirs_pattern(pyzor_t, pyzor_tmp_t, pyzor_tmp_t)
@@ -64,23 +67,37 @@
 corecmd_list_bin(pyzor_t)
 corecmd_getattr_bin_files(pyzor_t)
 
+corenet_all_recvfrom_unlabeled(pyzor_t)
+corenet_all_recvfrom_netlabel(pyzor_t)
 corenet_tcp_sendrecv_generic_if(pyzor_t)
-corenet_udp_sendrecv_generic_if(pyzor_t)
 corenet_tcp_sendrecv_generic_node(pyzor_t)
-corenet_udp_sendrecv_generic_node(pyzor_t)
-corenet_tcp_sendrecv_all_ports(pyzor_t)
-corenet_udp_sendrecv_all_ports(pyzor_t)
+
+corenet_sendrecv_http_client_packets(pyzor_t)
 corenet_tcp_connect_http_port(pyzor_t)
+corenet_tcp_sendrecv_http_port(pyzor_t)
 
 dev_read_urand(pyzor_t)
 
-files_read_etc_files(pyzor_t)
+fs_getattr_all_fs(pyzor_t)
+fs_search_auto_mountpoints(pyzor_t)
 
 auth_use_nsswitch(pyzor_t)
 
 miscfiles_read_localization(pyzor_t)
 
-userdom_dontaudit_search_user_home_dirs(pyzor_t)
+mta_read_queue(pyzor_t)
+
+tunable_policy(`use_nfs_home_dirs',`
+	fs_manage_nfs_dirs(pyzor_t)
+	fs_manage_nfs_files(pyzor_t)
+	fs_manage_nfs_symlinks(pyzor_t)
+')
+
+tunable_policy(`use_samba_home_dirs',`
+	fs_manage_cifs_dirs(pyzor_t)
+	fs_manage_cifs_files(pyzor_t)
+	fs_manage_cifs_symlinks(pyzor_t)
+')
 
 optional_policy(`
 	amavis_manage_lib_files(pyzor_t)
@@ -94,23 +111,24 @@
 
 ########################################
 #
-# Pyzor server local policy
+# Daemon local policy
 #
 
-allow pyzord_t self:udp_socket create_socket_perms;
-
+allow pyzord_t pyzor_var_lib_t:dir setattr_dir_perms;
 manage_files_pattern(pyzord_t, pyzor_var_lib_t, pyzor_var_lib_t)
-allow pyzord_t pyzor_var_lib_t:dir setattr;
 files_var_lib_filetrans(pyzord_t, pyzor_var_lib_t, { file dir })
 
-read_files_pattern(pyzord_t, pyzor_etc_t, pyzor_etc_t)
 allow pyzord_t pyzor_etc_t:dir list_dir_perms;
+allow pyzord_t pyzor_etc_t:file read_file_perms;
+allow pyzord_t pyzor_etc_t:lnk_file read_lnk_file_perms;
 
-can_exec(pyzord_t, pyzor_exec_t)
+allow pyzord_t pyzord_log_t:dir setattr_dir_perms;
+append_files_pattern(pyzord_t, pyzord_log_t, pyzord_log_t)
+create_files_pattern(pyzord_t, pyzord_log_t, pyzord_log_t)
+setattr_files_pattern(pyzord_t, pyzord_log_t, pyzord_log_t)
+logging_log_filetrans(pyzord_t, pyzord_log_t, { file dir })
 
-manage_files_pattern(pyzord_t, pyzord_log_t, pyzord_log_t)
-allow pyzord_t pyzord_log_t:dir setattr;
-logging_log_filetrans(pyzord_t, pyzord_log_t, { file dir } )
+can_exec(pyzord_t, pyzor_exec_t)
 
 kernel_read_kernel_sysctls(pyzord_t)
 kernel_read_system_state(pyzord_t)
@@ -123,24 +141,20 @@
 corenet_all_recvfrom_netlabel(pyzord_t)
 corenet_udp_sendrecv_generic_if(pyzord_t)
 corenet_udp_sendrecv_generic_node(pyzord_t)
-corenet_udp_sendrecv_all_ports(pyzord_t)
 corenet_udp_bind_generic_node(pyzord_t)
-corenet_udp_bind_pyzor_port(pyzord_t)
-corenet_sendrecv_pyzor_server_packets(pyzord_t)
 
-files_read_etc_files(pyzord_t)
+corenet_sendrecv_pyzor_server_packets(pyzord_t)
+corenet_udp_bind_pyzor_port(pyzord_t)
+corenet_udp_sendrecv_pyzor_port(pyzord_t)
 
 auth_use_nsswitch(pyzord_t)
 
+logging_send_syslog_msg(pyzord_t)
+
 locallogin_dontaudit_use_fds(pyzord_t)
 
 miscfiles_read_localization(pyzord_t)
 
-# Do not audit attempts to access /root.
 userdom_dontaudit_search_user_home_dirs(pyzord_t)
 
 mta_manage_spool(pyzord_t)
-
-optional_policy(`
-	logging_send_syslog_msg(pyzord_t)
-')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/qemu.fc refpolicy/policy/modules/contrib/qemu.fc
--- refpolicy/policy/modules/contrib/qemu.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/qemu.fc	2012-10-22 20:10:23.842015425 +0200
@@ -1,4 +1,5 @@
-/usr/bin/qemu		--	gen_context(system_u:object_r:qemu_exec_t,s0)
+/usr/bin/qemu	--	gen_context(system_u:object_r:qemu_exec_t,s0)
 /usr/bin/qemu-system-.*	--	gen_context(system_u:object_r:qemu_exec_t,s0)
 /usr/bin/qemu-kvm	--	gen_context(system_u:object_r:qemu_exec_t,s0)
+
 /usr/libexec/qemu.*	--	gen_context(system_u:object_r:qemu_exec_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/qemu.if refpolicy/policy/modules/contrib/qemu.if
--- refpolicy/policy/modules/contrib/qemu.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/qemu.if	2012-10-22 20:10:23.843015425 +0200
@@ -1,21 +1,19 @@
-## <summary>QEMU machine emulator and virtualizer</summary>
+## <summary>QEMU machine emulator and virtualizer.</summary>
 
-########################################
+#######################################
 ## <summary>
-##	Creates types and rules for a basic
-##	qemu process domain.
+##	The template to define a qemu domain.
 ## </summary>
-## <param name="prefix">
+## <param name="domain_prefix">
 ##	<summary>
-##	Prefix for the domain.
+##	Domain prefix to be used.
 ##	</summary>
 ## </param>
 #
 template(`qemu_domain_template',`
-
 	##############################
 	#
-	# Local Policy
+	# Declarations
 	#
 
 	type $1_t;
@@ -26,7 +24,7 @@
 
 	##############################
 	#
-	# Local Policy
+	# Policy
 	#
 
 	allow $1_t self:capability { dac_read_search dac_override };
@@ -98,43 +96,30 @@
 	')
 ')
 
-#######################################
+########################################
 ## <summary>
-##	The per role template for the qemu module.
+##	Role access for qemu.
 ## </summary>
-## <desc>
-##	<p>
-##	This template creates a derived domains which are used
-##	for qemu web browser.
-##	</p>
-##	<p>
-##	This template is invoked automatically for each user, and
-##	generally does not need to be invoked directly
-##	by policy writers.
-##	</p>
-## </desc>
-## <param name="user_role">
+## <param name="role">
 ##	<summary>
-##	The role associated with the user domain.
+##	Role allowed access.
 ##	</summary>
 ## </param>
-## <param name="user_domain">
+## <param name="domain">
 ##	<summary>
-##	The type of the user domain.
+##	User domain for the role.
 ##	</summary>
 ## </param>
 #
 template(`qemu_role',`
 	gen_require(`
-		type qemu_t, qemu_exec_t;
-		type qemu_config_t, qemu_config_exec_t;
+		type qemu_t;
 	')
 
-	role $1 types { qemu_t qemu_config_t };
+	qemu_run($2, $1)
 
-	domtrans_pattern($2, qemu_exec_t, qemu_t)
- 	domtrans_pattern($2, qemu_config_exec_t, qemu_config_t)
-	allow qemu_t $2:process signull;
+	allow $2 qemu_t:process { ptrace signal_perms };
+	ps_process_pattern($2, qemu_t)
 ')
 
 ########################################
@@ -142,9 +127,9 @@
 ##	Execute a domain transition to run qemu.
 ## </summary>
 ## <param name="domain">
-## <summary>
+##	<summary>
 ##	Domain allowed to transition.
-## </summary>
+##	</summary>
 ## </param>
 #
 interface(`qemu_domtrans',`
@@ -152,12 +137,34 @@
 		type qemu_t, qemu_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, qemu_exec_t, qemu_t)
 ')
 
 ########################################
 ## <summary>
-##	Execute qemu in the qemu domain.
+##	Execute a qemu in the caller domain.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`qemu_exec',`
+	gen_require(`
+		type qemu_exec_t;
+	')
+
+	corecmd_search_bin($1)
+	can_exec($1, qemu_exec_t)
+')
+
+########################################
+## <summary>
+##	Execute qemu in the qemu domain,
+##	and allow the specified role the
+##	qemu domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -166,25 +173,23 @@
 ## </param>
 ## <param name="role">
 ##	<summary>
-##	The role to allow the qemu domain.
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <rolecap/>
 #
 interface(`qemu_run',`
 	gen_require(`
-		type qemu_t;
+		attribute_role qemu_roles;
 	')
 
 	qemu_domtrans($1)
-	role $2 types qemu_t;
-	allow qemu_t $1:process signull;
-	allow $1 qemu_t:process signull;
+	roleattribute $2 qemu_roles;
 ')
 
 ########################################
 ## <summary>
-##	Allow the domain to read state files in /proc.
+##	Read qemu process state files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -197,12 +202,15 @@
 		type qemu_t;
 	')
 
-	read_files_pattern($1, qemu_t, qemu_t)
+	kernel_search_proc($1)
+	allow $1 qemu_t:dir list_dir_perms;
+	allow $1 qemu_t:file read_file_perms;
+	allow $1 qemu_t:lnk_file read_lnk_file_perms;
 ')
 
 ########################################
 ## <summary>
-##	Set the schedule on qemu.
+##	Set qemu scheduler.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -220,7 +228,7 @@
 
 ########################################
 ## <summary>
-##	Send a signal to qemu.
+##	Send generic signals to qemu.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -238,7 +246,7 @@
 
 ########################################
 ## <summary>
-##	Send a sigill to qemu
+##	Send kill signals to qemu.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -256,12 +264,13 @@
 
 ########################################
 ## <summary>
-##	Execute a domain transition to run qemu unconfined.
+##	Execute a domain transition to
+##	run qemu unconfined.
 ## </summary>
 ## <param name="domain">
-## <summary>
+##	<summary>
 ##	Domain allowed to transition.
-## </summary>
+##	</summary>
 ## </param>
 #
 interface(`qemu_domtrans_unconfined',`
@@ -269,12 +278,14 @@
 		type unconfined_qemu_t, qemu_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, qemu_exec_t, unconfined_qemu_t)
 ')
 
 ########################################
 ## <summary>
-##	Manage qemu temporary dirs.
+##	Create, read, write, and delete
+##	qemu temporary directories.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -287,12 +298,14 @@
 		type qemu_tmp_t;
 	')
 
+	files_search_tmp($1)
 	manage_dirs_pattern($1, qemu_tmp_t, qemu_tmp_t)
 ')
 
 ########################################
 ## <summary>
-##	Manage qemu temporary files.
+##	Create, read, write, and delete
+##	qemu temporary files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -305,5 +318,59 @@
 		type qemu_tmp_t;
 	')
 
+	files_search_tmp($1)
 	manage_files_pattern($1, qemu_tmp_t, qemu_tmp_t)
 ')
+
+########################################
+## <summary>
+##	Execute qemu in a specified domain.
+## </summary>
+## <desc>
+##	<p>
+##	Execute qemu in a specified domain.
+##	</p>
+##	<p>
+##	No interprocess communication (signals, pipes,
+##	etc.) is provided by this interface since
+##	the domains are not owned by this module.
+##	</p>
+## </desc>
+## <param name="source_domain">
+##	<summary>
+##	Domain allowed to transition.
+##	</summary>
+## </param>
+## <param name="target_domain">
+##	<summary>
+##	Domain to transition to.
+##	</summary>
+## </param>
+#
+interface(`qemu_spec_domtrans',`
+	gen_require(`
+		type qemu_exec_t;
+	')
+
+	corecmd_search_bin($1)
+	domain_auto_trans($1, qemu_exec_t, $2)
+')
+
+######################################
+## <summary>
+##	Make qemu executable files an
+##	entrypoint for the specified domain.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	The domain for which qemu_exec_t is an entrypoint.
+##	</summary>
+## </param>
+#
+interface(`qemu_entry_type',`
+	gen_require(`
+		type qemu_exec_t;
+	')
+
+	domain_entry_file($1, qemu_exec_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/qemu.te refpolicy/policy/modules/contrib/qemu.te
--- refpolicy/policy/modules/contrib/qemu.te	2012-07-25 20:33:05.000000000 +0200
+++ refpolicy/policy/modules/contrib/qemu.te	2012-11-02 19:46:21.236954599 +0100
@@ -1,4 +1,4 @@
-policy_module(qemu, 1.7.0)
+policy_module(qemu, 1.7.3)
 
 ########################################
 #
@@ -6,61 +6,34 @@
 #
 
 ## <desc>
-## <p>
-## Allow qemu to connect fully to the network
-## </p>
+##	<p>
+##	Determine whether qemu has full
+##	access to the network.
+##	</p>
 ## </desc>
 gen_tunable(qemu_full_network, false)
 
-## <desc>
-## <p>
-## Allow qemu to use cifs/Samba file systems
-## </p>
-## </desc>
-gen_tunable(qemu_use_cifs, true)
-
-## <desc>
-## <p>
-## Allow qemu to use serial/parallel communication ports
-## </p>
-## </desc>
-gen_tunable(qemu_use_comm, false)
-
-## <desc>
-## <p>
-## Allow qemu to use nfs file systems
-## </p>
-## </desc>
-gen_tunable(qemu_use_nfs, true)
-
-## <desc>
-## <p>
-## Allow qemu to use usb devices
-## </p>
-## </desc>
-gen_tunable(qemu_use_usb, true)
+attribute_role qemu_roles;
+roleattribute system_r qemu_roles;
 
 type qemu_exec_t;
+application_executable_file(qemu_exec_t)
+
 virt_domain_template(qemu)
-application_domain(qemu_t, qemu_exec_t)
-role system_r types qemu_t;
+role qemu_roles types qemu_t;
 
 ########################################
 #
-# qemu local policy
+# Local policy
 #
 
-can_exec(qemu_t, qemu_exec_t)
-
-storage_raw_write_removable_device(qemu_t)
-storage_raw_read_removable_device(qemu_t)
-
-userdom_search_user_home_content(qemu_t)
-userdom_read_user_tmpfs_files(qemu_t)
+ifdef(`distro_gentoo',`
+	optional_policy(`
+		vde_connect(qemu_t)
+	')
+')
 
 tunable_policy(`qemu_full_network',`
-	allow qemu_t self:udp_socket create_socket_perms;
-
 	corenet_udp_sendrecv_generic_if(qemu_t)
 	corenet_udp_sendrecv_generic_node(qemu_t)
 	corenet_udp_sendrecv_all_ports(qemu_t)
@@ -70,53 +43,9 @@
 	corenet_tcp_connect_all_ports(qemu_t)
 ')
 
-tunable_policy(`qemu_use_cifs',`
-	fs_manage_cifs_dirs(qemu_t)
-	fs_manage_cifs_files(qemu_t)
-')
-
-tunable_policy(`qemu_use_comm',`
-	term_use_unallocated_ttys(qemu_t)
-	dev_rw_printer(qemu_t)
-')
-
-tunable_policy(`qemu_use_nfs',`
-	fs_manage_nfs_dirs(qemu_t)
-	fs_manage_nfs_files(qemu_t)
-')
-
-tunable_policy(`qemu_use_usb',`
-	dev_rw_usbfs(qemu_t)
-	fs_manage_dos_dirs(qemu_t)
-	fs_manage_dos_files(qemu_t)
-')
-
-optional_policy(`
-	dbus_read_lib_files(qemu_t)
-')
-
-optional_policy(`
-	pulseaudio_manage_home_files(qemu_t)
-	pulseaudio_stream_connect(qemu_t)
-')
-
-optional_policy(`
-	virt_manage_images(qemu_t)
-	virt_append_log(qemu_t)
-')
-
-optional_policy(`
-	xen_rw_image_files(qemu_t)
-')
-
-optional_policy(`
-	xserver_read_xdm_pid(qemu_t)
-	xserver_stream_connect(qemu_t)
-')
-
 ########################################
 #
-# Unconfined qemu local policy
+# Unconfined local policy
 #
 
 optional_policy(`
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/qmail.fc refpolicy/policy/modules/contrib/qmail.fc
--- refpolicy/policy/modules/contrib/qmail.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/qmail.fc	2012-10-22 20:11:50.293015610 +0200
@@ -1,6 +1,22 @@
+/etc/qmail(/.*)?	gen_context(system_u:object_r:qmail_etc_t,s0)
 
-/var/qmail/alias		-d	gen_context(system_u:object_r:qmail_alias_home_t,s0)
-/var/qmail/alias(/.*)?			gen_context(system_u:object_r:qmail_alias_home_t,s0)
+/usr/bin/tcp-env	--	gen_context(system_u:object_r:qmail_tcp_env_exec_t,s0)
+
+/usr/sbin/qmail-clean	--	gen_context(system_u:object_r:qmail_clean_exec_t,s0)
+/usr/sbin/qmail-getpw	--	gen_context(system_u:object_r:qmail_exec_t,s0)
+/usr/sbin/qmail-inject	--	gen_context(system_u:object_r:qmail_inject_exec_t,s0)
+/usr/sbin/qmail-local	--	gen_context(system_u:object_r:qmail_local_exec_t,s0)
+/usr/sbin/qmail-lspawn	--	gen_context(system_u:object_r:qmail_lspawn_exec_t,s0)
+/usr/sbin/qmail-queue	--	gen_context(system_u:object_r:qmail_queue_exec_t,s0)
+/usr/sbin/qmail-remote	--	gen_context(system_u:object_r:qmail_remote_exec_t,s0)
+/usr/sbin/qmail-rspawn	--	gen_context(system_u:object_r:qmail_rspawn_exec_t,s0)
+/usr/sbin/qmail-send	--	gen_context(system_u:object_r:qmail_send_exec_t,s0)
+/usr/sbin/qmail-smtpd	--	gen_context(system_u:object_r:qmail_smtpd_exec_t,s0)
+/usr/sbin/qmail-start	--	gen_context(system_u:object_r:qmail_start_exec_t,s0)
+/usr/sbin/splogger	--	gen_context(system_u:object_r:qmail_splogger_exec_t,s0)
+
+/var/qmail/alias	-d	gen_context(system_u:object_r:qmail_alias_home_t,s0)
+/var/qmail/alias(/.*)?	gen_context(system_u:object_r:qmail_alias_home_t,s0)
 
 /var/qmail/bin/qmail-clean	--	gen_context(system_u:object_r:qmail_clean_exec_t,s0)
 /var/qmail/bin/qmail-getpw	--	gen_context(system_u:object_r:qmail_exec_t,s0)
@@ -13,35 +29,9 @@
 /var/qmail/bin/qmail-send	--	gen_context(system_u:object_r:qmail_send_exec_t,s0)
 /var/qmail/bin/qmail-smtpd	--	gen_context(system_u:object_r:qmail_smtpd_exec_t,s0)
 /var/qmail/bin/qmail-start	--	gen_context(system_u:object_r:qmail_start_exec_t,s0)
-/var/qmail/bin/splogger		--	gen_context(system_u:object_r:qmail_splogger_exec_t,s0)
-/var/qmail/bin/tcp-env		--	gen_context(system_u:object_r:qmail_tcp_env_exec_t,s0)
-
-/var/qmail/control(/.*)?		gen_context(system_u:object_r:qmail_etc_t,s0)
-
-/var/qmail/queue(/.*)?			gen_context(system_u:object_r:qmail_spool_t,s0)
-
-ifdef(`distro_debian', `
-/etc/qmail(/.*)?			gen_context(system_u:object_r:qmail_etc_t,s0)
-
-/usr/bin/tcp-env		--	gen_context(system_u:object_r:qmail_tcp_env_exec_t,s0)
-
-#/usr/local/bin/serialmail/.*	--	gen_context(system_u:object_r:qmail_serialmail_exec_t,s0)
-
-/usr/sbin/qmail-clean		--	gen_context(system_u:object_r:qmail_clean_exec_t,s0)
-/usr/sbin/qmail-getpw		--	gen_context(system_u:object_r:qmail_exec_t,s0)
-/usr/sbin/qmail-inject		--	gen_context(system_u:object_r:qmail_inject_exec_t,s0)
-/usr/sbin/qmail-local		--	gen_context(system_u:object_r:qmail_local_exec_t,s0)
-/usr/sbin/qmail-lspawn		--	gen_context(system_u:object_r:qmail_lspawn_exec_t,s0)
-/usr/sbin/qmail-queue		--	gen_context(system_u:object_r:qmail_queue_exec_t,s0)
-/usr/sbin/qmail-remote		--	gen_context(system_u:object_r:qmail_remote_exec_t,s0)
-/usr/sbin/qmail-rspawn		--	gen_context(system_u:object_r:qmail_rspawn_exec_t,s0)
-/usr/sbin/qmail-send		--	gen_context(system_u:object_r:qmail_send_exec_t,s0)
-/usr/sbin/qmail-smtpd		--	gen_context(system_u:object_r:qmail_smtpd_exec_t,s0)
-/usr/sbin/qmail-start		--	gen_context(system_u:object_r:qmail_start_exec_t,s0)
-/usr/sbin/splogger		--	gen_context(system_u:object_r:qmail_splogger_exec_t,s0)
-
-/var/qmail(/.*)?			gen_context(system_u:object_r:qmail_etc_t,s0)
+/var/qmail/bin/splogger	--	gen_context(system_u:object_r:qmail_splogger_exec_t,s0)
+/var/qmail/bin/tcp-env	--	gen_context(system_u:object_r:qmail_tcp_env_exec_t,s0)
 
-/var/spool/qmail(/.*)?			gen_context(system_u:object_r:qmail_spool_t,s0)
-')
+/var/qmail(/.*)?	gen_context(system_u:object_r:qmail_etc_t,s0)
 
+/var/spool/qmail(/.*)?	gen_context(system_u:object_r:qmail_spool_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/qmail.if refpolicy/policy/modules/contrib/qmail.if
--- refpolicy/policy/modules/contrib/qmail.if	2012-05-04 15:16:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/qmail.if	2012-10-22 20:11:50.293015610 +0200
@@ -1,12 +1,12 @@
-## <summary>Qmail Mail Server</summary>
+## <summary>Qmail Mail Server.</summary>
 
 ########################################
 ## <summary>
-##	Template for qmail parent/sub-domain pairs
+##	Template for qmail parent/sub-domain pairs.
 ## </summary>
 ## <param name="child_prefix">
 ##	<summary>
-##	The prefix of the child domain
+##	The prefix of the child domain.
 ##	</summary>
 ## </param>
 ## <param name="parent_domain">
@@ -16,40 +16,35 @@
 ## </param>
 #
 template(`qmail_child_domain_template',`
-	type $1_t;
-	domain_type($1_t)
-	type $1_exec_t;
-	domain_entry_file($1_t, $1_exec_t)
-	domain_auto_trans($2, $1_exec_t, $1_t)
-	role system_r types $1_t;
-
-	allow $1_t self:process signal_perms;
-
-	allow $1_t $2:fd use;
-	allow $1_t $2:fifo_file rw_file_perms;
-	allow $1_t $2:process sigchld;
-
-	allow $1_t qmail_etc_t:dir list_dir_perms;
-	allow $1_t qmail_etc_t:file read_file_perms;
-	allow $1_t qmail_etc_t:lnk_file read_lnk_file_perms;
+	gen_require(`
+		attribute qmail_child_domain;
+	')
 
-	allow $1_t qmail_start_t:fd use;
+	########################################
+	#
+	# Declarations
+	#
 
-	kernel_list_proc($2)
-	kernel_read_proc_symlinks($2)
+	type $1_t, qmail_child_domain;
+	type $1_exec_t;
+	domain_type($1_t)
+	domain_entry_file($1_t, $1_exec_t)
 
-	corecmd_search_bin($1_t)
+	role system_r types $1_t;
 
-	files_search_var($1_t)
+	########################################
+	#
+	# Policy
+	#
 
-	fs_getattr_xattr_fs($1_t)
+	domtrans_pattern($2, $1_exec_t, $1_t)
 
-	miscfiles_read_localization($1_t)
+	kernel_read_system_state($2)
 ')
 
 ########################################
 ## <summary>
-##	Transition to qmail_inject_t
+##	Transition to qmail_inject_t.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -69,13 +64,12 @@
 		corecmd_search_bin($1)
 	',`
 		files_search_var($1)
-		corecmd_search_bin($1)
 	')
 ')
 
 ########################################
 ## <summary>
-##	Transition to qmail_queue_t
+##	Transition to qmail_queue_t.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -95,7 +89,6 @@
 		corecmd_search_bin($1)
 	',`
 		files_search_var($1)
-		corecmd_search_bin($1)
 	')
 ')
 
@@ -115,21 +108,20 @@
 		type qmail_etc_t;
 	')
 
+	files_search_var($1)
 	allow $1 qmail_etc_t:dir list_dir_perms;
 	allow $1 qmail_etc_t:file read_file_perms;
 	allow $1 qmail_etc_t:lnk_file read_lnk_file_perms;
-	files_search_var($1)
 
 	ifdef(`distro_debian',`
-		# handle /etc/qmail
 		files_search_etc($1)
 	')
 ')
 
 ########################################
 ## <summary>
-##	Define the specified domain as a qmail-smtp service. 
-##	Needed by antivirus/antispam filters.
+##	Define the specified domain as a
+##	qmail-smtp service.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/qmail.te refpolicy/policy/modules/contrib/qmail.te
--- refpolicy/policy/modules/contrib/qmail.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/qmail.te	2012-10-22 20:11:50.309015610 +0200
@@ -1,11 +1,11 @@
-policy_module(qmail, 1.5.0)
+policy_module(qmail, 1.5.1)
 
 ########################################
 #
 # Declarations
 #
 
-attribute qmail_user_domains;
+attribute qmail_child_domain;
 
 type qmail_alias_home_t;
 files_type(qmail_alias_home_t)
@@ -18,7 +18,7 @@
 type qmail_exec_t;
 files_type(qmail_exec_t)
 
-type qmail_inject_t, qmail_user_domains;
+type qmail_inject_t;
 type qmail_inject_exec_t;
 domain_type(qmail_inject_t)
 domain_entry_file(qmail_inject_t, qmail_inject_exec_t)
@@ -32,18 +32,14 @@
 mta_mailserver_delivery(qmail_lspawn_t)
 
 qmail_child_domain_template(qmail_queue, qmail_inject_t)
-typeattribute qmail_queue_t qmail_user_domains;
 mta_mailserver_user_agent(qmail_queue_t)
 
 qmail_child_domain_template(qmail_remote, qmail_rspawn_t)
 mta_mailserver_sender(qmail_remote_t)
 
 qmail_child_domain_template(qmail_rspawn, qmail_start_t)
-
 qmail_child_domain_template(qmail_send, qmail_start_t)
-
 qmail_child_domain_template(qmail_smtpd, qmail_tcp_env_t)
-
 qmail_child_domain_template(qmail_splogger, qmail_start_t)
 
 type qmail_spool_t;
@@ -59,8 +55,28 @@
 
 ########################################
 #
-# qmail-clean local policy
-#   this component cleans up the queue directory
+# Common qmail child domain local policy
+#
+
+allow qmail_child_domain self:process signal_perms;
+
+allow qmail_child_domain qmail_etc_t:dir list_dir_perms;
+allow qmail_child_domain qmail_etc_t:file read_file_perms;
+allow qmail_child_domain qmail_etc_t:lnk_file read_lnk_file_perms;
+
+allow qmail_child_domain qmail_start_t:fd use;
+
+corecmd_search_bin(qmail_child_domain)
+
+files_search_var(qmail_child_domain)
+
+fs_getattr_xattr_fs(qmail_child_domain)
+
+miscfiles_read_localization(qmail_child_domain)
+
+########################################
+#
+# Clean local policy
 #
 
 read_files_pattern(qmail_clean_t, qmail_spool_t, qmail_spool_t)
@@ -68,8 +84,7 @@
 
 ########################################
 #
-# qmail-inject local policy
-#   this component preprocesses mail from stdin and invokes qmail-queue
+# Inject local policy
 #
 
 allow qmail_inject_t self:fifo_file write_fifo_file_perms;
@@ -87,13 +102,12 @@
 
 ########################################
 #
-# qmail-local local policy
-#   this component delivers a mail message
+# Local local policy
 #
 
-allow qmail_local_t self:fifo_file write_file_perms;
+allow qmail_local_t self:fifo_file write_fifo_file_perms;
 allow qmail_local_t self:process signal_perms;
-allow qmail_local_t self:unix_stream_socket create_stream_socket_perms;
+allow qmail_local_t self:unix_stream_socket { accept listen };
 
 manage_dirs_pattern(qmail_local_t, qmail_alias_home_t, qmail_alias_home_t)
 manage_files_pattern(qmail_local_t, qmail_alias_home_t, qmail_alias_home_t)
@@ -109,7 +123,6 @@
 corecmd_exec_bin(qmail_local_t)
 corecmd_exec_shell(qmail_local_t)
 
-files_read_etc_files(qmail_local_t)
 files_read_etc_runtime_files(qmail_local_t)
 
 auth_use_nsswitch(qmail_local_t)
@@ -126,8 +139,7 @@
 
 ########################################
 #
-# qmail-lspawn local policy
-#   this component schedules local deliveries
+# Lspawn local policy
 #
 
 allow qmail_lspawn_t self:capability { setuid setgid };
@@ -141,16 +153,13 @@
 
 read_files_pattern(qmail_lspawn_t, qmail_spool_t, qmail_spool_t)
 
-corecmd_search_bin(qmail_lspawn_t)
-
 files_read_etc_files(qmail_lspawn_t)
 files_search_pids(qmail_lspawn_t)
 files_search_tmp(qmail_lspawn_t)
 
 ########################################
 #
-# qmail-queue local policy
-#   this component places a mail in a delivery queue, later to be processed by qmail-send
+# Queue local policy
 #
 
 allow qmail_queue_t qmail_lspawn_t:fd use;
@@ -174,35 +183,28 @@
 
 ########################################
 #
-# qmail-remote local policy
-#   this component sends mail via SMTP
+# Remote local policy
 #
 
-allow qmail_remote_t self:tcp_socket create_socket_perms;
-allow qmail_remote_t self:udp_socket create_socket_perms;
-
 rw_files_pattern(qmail_remote_t, qmail_spool_t, qmail_spool_t)
 
 corenet_all_recvfrom_unlabeled(qmail_remote_t)
 corenet_all_recvfrom_netlabel(qmail_remote_t)
 corenet_tcp_sendrecv_generic_if(qmail_remote_t)
-corenet_udp_sendrecv_generic_if(qmail_remote_t)
 corenet_tcp_sendrecv_generic_node(qmail_remote_t)
-corenet_udp_sendrecv_generic_node(qmail_remote_t)
-corenet_tcp_sendrecv_smtp_port(qmail_remote_t)
-corenet_udp_sendrecv_dns_port(qmail_remote_t)
-corenet_tcp_connect_smtp_port(qmail_remote_t)
+
 corenet_sendrecv_smtp_client_packets(qmail_remote_t)
+corenet_tcp_connect_smtp_port(qmail_remote_t)
+corenet_tcp_sendrecv_smtp_port(qmail_remote_t)
 
 dev_read_rand(qmail_remote_t)
 dev_read_urand(qmail_remote_t)
 
-sysnet_read_config(qmail_remote_t)
+sysnet_dns_name_resolve(qmail_remote_t)
 
 ########################################
 #
-# qmail-rspawn local policy
-#   this component scedules remote deliveries
+# Rspawn local policy
 #
 
 allow qmail_rspawn_t self:process signal_perms;
@@ -212,12 +214,9 @@
 
 rw_files_pattern(qmail_rspawn_t, qmail_spool_t, qmail_spool_t)
 
-corecmd_search_bin(qmail_rspawn_t)
-
 ########################################
 #
-# qmail-send local policy
-#   this component delivers mail messages from the queue
+# Send local policy
 #
 
 allow qmail_send_t self:process signal_perms;
@@ -235,8 +234,7 @@
 
 ########################################
 #
-# qmail-smtpd local policy
-#   this component receives mails via SMTP
+# Smtpd local policy
 #
 
 allow qmail_smtpd_t self:process signal_perms;
@@ -264,8 +262,7 @@
 
 ########################################
 #
-# splogger local policy
-#   this component creates entries in syslog
+# Splogger local policy
 #
 
 allow qmail_splogger_t self:unix_dgram_socket create_socket_perms;
@@ -278,8 +275,7 @@
 
 ########################################
 #
-# qmail-start local policy
-#   this component starts up the mail delivery component
+# Start local policy
 #
 
 allow qmail_start_t self:capability { setgid setuid };
@@ -302,8 +298,7 @@
 
 ########################################
 #
-# tcp-env local policy
-#   this component sets up TCP-related environment variables
+# Tcp-env local policy
 #
 
 allow qmail_tcp_env_t qmail_smtpd_exec_t:file read_file_perms;
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/qpid.fc refpolicy/policy/modules/contrib/qpid.fc
--- refpolicy/policy/modules/contrib/qpid.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/qpid.fc	2012-10-22 20:11:53.036015616 +0200
@@ -1,8 +1,8 @@
 /etc/rc\.d/init\.d/qpidd	--	gen_context(system_u:object_r:qpidd_initrc_exec_t,s0)
 
-/usr/sbin/qpidd			--	gen_context(system_u:object_r:qpidd_exec_t,s0)
+/usr/sbin/qpidd	--	gen_context(system_u:object_r:qpidd_exec_t,s0)
 
-/var/lib/qpidd(/.*)?			gen_context(system_u:object_r:qpidd_var_lib_t,s0)
+/var/lib/qpidd(/.*)?	gen_context(system_u:object_r:qpidd_var_lib_t,s0)
 
-/var/run/qpidd(/.*)?			gen_context(system_u:object_r:qpidd_var_run_t,s0)
-/var/run/qpidd\.pid			gen_context(system_u:object_r:qpidd_var_run_t,s0)
+/var/run/qpidd(/.*)?	gen_context(system_u:object_r:qpidd_var_run_t,s0)
+/var/run/qpidd\.pid	--	gen_context(system_u:object_r:qpidd_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/qpid.if refpolicy/policy/modules/contrib/qpid.if
--- refpolicy/policy/modules/contrib/qpid.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/qpid.if	2012-10-22 20:11:53.036015616 +0200
@@ -15,12 +15,13 @@
 		type qpidd_t, qpidd_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, qpidd_exec_t, qpidd_t)
 ')
 
 #####################################
 ## <summary>
-##	Allow read and write access to qpidd semaphores.
+##	Read and write access qpidd semaphores.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -38,7 +39,7 @@
 
 ########################################
 ## <summary>
-##	Read and write to qpidd shared memory.
+##	Read and write qpidd shared memory.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -56,11 +57,12 @@
 
 ########################################
 ## <summary>
-##	Execute qpidd server in the qpidd domain.
+##	Execute qpidd init script in
+##	the initrc domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
-##	Domain allowed access.
+##	Domain allowed to transition.
 ##	</summary>
 ## </param>
 #
@@ -74,7 +76,7 @@
 
 ########################################
 ## <summary>
-##	Read qpidd PID files.
+##	Read qpidd pid files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -106,8 +108,8 @@
 		type qpidd_var_lib_t;
 	')
 
-	allow $1 qpidd_var_lib_t:dir search_dir_perms;
 	files_search_var_lib($1)
+	allow $1 qpidd_var_lib_t:dir search_dir_perms;
 ')
 
 ########################################
@@ -151,8 +153,8 @@
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate
-##	an qpidd environment
+##	All of the rules required to
+##	administrate an qpidd environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -168,19 +170,21 @@
 #
 interface(`qpidd_admin',`
 	gen_require(`
-		type qpidd_t, qpidd_initrc_exec_t;
+		type qpidd_t, qpidd_initrc_exec_t, qpidd_var_lib_t;
+		type qpidd_var_run_t;
 	')
 
 	allow $1 qpidd_t:process { ptrace signal_perms };
 	ps_process_pattern($1, qpidd_t)
 
-	# Allow qpidd_t to restart the apache service
 	qpidd_initrc_domtrans($1)
 	domain_system_change_exemption($1)
 	role_transition $2 qpidd_initrc_exec_t system_r;
 	allow $2 system_r;
 
+	files_search_var_lib($1(
 	admin_pattern($1, qpidd_var_lib_t)
 
+	files_search_pids($1)
 	admin_pattern($1, qpidd_var_run_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/qpid.te refpolicy/policy/modules/contrib/qpid.te
--- refpolicy/policy/modules/contrib/qpid.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/qpid.te	2012-10-22 20:11:53.037015616 +0200
@@ -1,4 +1,4 @@
-policy_module(qpid, 1.0.0)
+policy_module(qpid, 1.0.1)
 
 ########################################
 #
@@ -12,6 +12,9 @@
 type qpidd_initrc_exec_t;
 init_script_file(qpidd_initrc_exec_t)
 
+type qpidd_tmpfs_t;
+files_tmpfs_file(qpidd_tmpfs_t)
+
 type qpidd_var_lib_t;
 files_type(qpidd_var_lib_t)
 
@@ -20,15 +23,19 @@
 
 ########################################
 #
-# qpidd local policy
+# Local policy
 #
 
 allow qpidd_t self:process { setsched signull };
 allow qpidd_t self:fifo_file rw_fifo_file_perms;
 allow qpidd_t self:sem create_sem_perms;
 allow qpidd_t self:shm create_shm_perms;
-allow qpidd_t self:tcp_socket create_stream_socket_perms;
-allow qpidd_t self:unix_stream_socket create_stream_socket_perms;
+allow qpidd_t self:tcp_socket { accept listen };
+allow qpidd_t self:unix_stream_socket { accept listen };
+
+manage_dirs_pattern(qpidd_t, qpidd_tmpfs_t, qpidd_tmpfs_t)
+manage_files_pattern(qpidd_t, qpidd_tmpfs_t, qpidd_tmpfs_t)
+fs_tmpfs_filetrans(qpidd_t, qpidd_tmpfs_t, { dir file })
 
 manage_dirs_pattern(qpidd_t, qpidd_var_lib_t, qpidd_var_lib_t)
 manage_files_pattern(qpidd_t, qpidd_var_lib_t, qpidd_var_lib_t)
@@ -44,10 +51,13 @@
 corenet_all_recvfrom_netlabel(qpidd_t)
 corenet_tcp_sendrecv_generic_if(qpidd_t)
 corenet_tcp_sendrecv_generic_node(qpidd_t)
-corenet_tcp_sendrecv_all_ports(qpidd_t)
 corenet_tcp_bind_generic_node(qpidd_t)
+
+corenet_sendrecv_amqp_server_packets(qpidd_t)
 corenet_tcp_bind_amqp_port(qpidd_t)
+corenet_tcp_sendrecv_amqp_port(qpidd_t)
 
+dev_read_sysfs(qpidd_t)
 dev_read_urand(qpidd_t)
 
 files_read_etc_files(qpidd_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/quantum.fc refpolicy/policy/modules/contrib/quantum.fc
--- refpolicy/policy/modules/contrib/quantum.fc	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/quantum.fc	2012-09-24 21:23:18.479583470 +0200
@@ -0,0 +1,10 @@
+/etc/rc\.d/init\.d/quantum.*	--	gen_context(system_u:object_r:quantum_initrc_exec_t,s0)
+
+/usr/bin/quantum-server	--	gen_context(system_u:object_r:quantum_exec_t,s0)
+/usr/bin/quantum-openvswitch-agent	--	gen_context(system_u:object_r:quantum_exec_t,s0)
+/usr/bin/quantum-linuxbridge-agent	--	gen_context(system_u:object_r:quantum_exec_t,s0)
+/usr/bin/quantum-ryu-agent	--	gen_context(system_u:object_r:quantum_exec_t,s0)
+
+/var/lib/quantum(/.*)?	gen_context(system_u:object_r:quantum_var_lib_t,s0)
+
+/var/log/quantum(/.*)?	gen_context(system_u:object_r:quantum_log_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/quantum.if refpolicy/policy/modules/contrib/quantum.if
--- refpolicy/policy/modules/contrib/quantum.if	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/quantum.if	2012-09-24 21:23:18.479583470 +0200
@@ -0,0 +1,42 @@
+## <summary>Virtual network service for Openstack.</summary>
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an quantum environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`quantum_admin',`
+	gen_require(`
+		type quantum_t, quantum_initrc_exec_t, quantum_log_t;
+		type quantum_var_lib_t, quantum_tmp_t;
+	')
+
+	allow $1 quantum_t:process { ptrace signal_perms };
+	ps_process_pattern($1, quantum_t)
+
+	init_labeled_script_domtrans($1, quantum_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 quantum_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	logging_search_logs($1)
+	admin_pattern($1, quantum_log_t)
+
+	files_search_var_lib($1)
+	admin_pattern($1, quantum_var_lib_t)
+
+	files_search_tmp($1)
+	admin_pattern($1, quantum_tmp_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/quantum.te refpolicy/policy/modules/contrib/quantum.te
--- refpolicy/policy/modules/contrib/quantum.te	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/quantum.te	2012-10-15 20:33:13.081001983 +0200
@@ -0,0 +1,96 @@
+policy_module(quantum, 1.0.2)
+
+########################################
+#
+# Declarations
+#
+
+type quantum_t;
+type quantum_exec_t;
+init_daemon_domain(quantum_t, quantum_exec_t)
+
+type quantum_initrc_exec_t;
+init_script_file(quantum_initrc_exec_t)
+
+type quantum_log_t;
+logging_log_file(quantum_log_t)
+
+type quantum_tmp_t;
+files_tmp_file(quantum_tmp_t)
+
+type quantum_var_lib_t;
+files_type(quantum_var_lib_t)
+
+########################################
+#
+# Local policy
+#
+
+allow quantum_t self:capability { setgid setuid sys_resource };
+allow quantum_t self:process { setsched setrlimit };
+allow quantum_t self:fifo_file rw_fifo_file_perms;
+allow quantum_t self:key manage_key_perms;
+allow quantum_t self:tcp_socket { accept listen };
+allow quantum_t self:unix_stream_socket { accept listen };
+
+manage_dirs_pattern(quantum_t, quantum_log_t, quantum_log_t)
+append_files_pattern(quantum_t, quantum_log_t, quantum_log_t)
+create_files_pattern(quantum_t, quantum_log_t, quantum_log_t)
+setattr_files_pattern(quantum_t, quantum_log_t, quantum_log_t)
+logging_log_filetrans(quantum_t, quantum_log_t, dir)
+
+manage_files_pattern(quantum_t, quantum_tmp_t, quantum_tmp_t)
+files_tmp_filetrans(quantum_t, quantum_tmp_t, file)
+
+manage_dirs_pattern(quantum_t, quantum_var_lib_t, quantum_var_lib_t)
+manage_files_pattern(quantum_t, quantum_var_lib_t, quantum_var_lib_t)
+files_var_lib_filetrans(quantum_t, quantum_var_lib_t, dir)
+
+can_exec(quantum_t, quantum_tmp_t)
+
+kernel_read_kernel_sysctls(quantum_t)
+kernel_read_system_state(quantum_t)
+
+corecmd_exec_shell(quantum_t)
+corecmd_exec_bin(quantum_t)
+
+corenet_all_recvfrom_unlabeled(quantum_t)
+corenet_all_recvfrom_netlabel(quantum_t)
+corenet_tcp_sendrecv_generic_if(quantum_t)
+corenet_tcp_sendrecv_generic_node(quantum_t)
+corenet_tcp_sendrecv_all_ports(quantum_t)
+corenet_tcp_bind_generic_node(quantum_t)
+
+dev_list_sysfs(quantum_t)
+dev_read_urand(quantum_t)
+
+files_read_usr_files(quantum_t)
+
+auth_use_nsswitch(quantum_t)
+
+libs_exec_ldconfig(quantum_t)
+
+logging_send_audit_msgs(quantum_t)
+logging_send_syslog_msg(quantum_t)
+
+miscfiles_read_localization(quantum_t)
+
+sysnet_domtrans_ifconfig(quantum_t)
+
+optional_policy(`
+	brctl_domtrans(quantum_t)
+')
+
+optional_policy(`
+	mysql_stream_connect(quantum_t)
+	mysql_read_config(quantum_t)
+
+	mysql_tcp_connect(quantum_t)
+')
+
+optional_policy(`
+	postgresql_stream_connect(quantum_t)
+	postgresql_unpriv_client(quantum_t)
+
+	postgresql_tcp_connect(quantum_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/quota.fc refpolicy/policy/modules/contrib/quota.fc
--- refpolicy/policy/modules/contrib/quota.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/quota.fc	2012-10-22 20:11:56.645015623 +0200
@@ -1,19 +1,31 @@
 HOME_ROOT/a?quota\.(user|group)	--	gen_context(system_u:object_r:quota_db_t,s0)
 
+HOME_DIR/a?quota\.(user|group)	--	gen_context(system_u:object_r:quota_db_t,s0)
+
 /a?quota\.(user|group)	--	gen_context(system_u:object_r:quota_db_t,s0)
 
 /boot/a?quota\.(user|group)	--	gen_context(system_u:object_r:quota_db_t,s0)
 
 /etc/a?quota\.(user|group)	--	gen_context(system_u:object_r:quota_db_t,s0)
 
-/sbin/quota(check|on)		--	gen_context(system_u:object_r:quota_exec_t,s0)
+/etc/rc\.d/init\.d/quota_nld	--	gen_context(system_u:object_r:quota_nld_initrc_exec_t,s0)
+
+/sbin/convertquota	--	gen_context(system_u:object_r:quota_exec_t,s0)
+/sbin/quota(check|on)	--	gen_context(system_u:object_r:quota_exec_t,s0)
+
+/usr/sbin/convertquota	--	gen_context(system_u:object_r:quota_exec_t,s0)
+/usr/sbin/quota(check|on)	--	gen_context(system_u:object_r:quota_exec_t,s0)
+/usr/sbin/quota_nld	--	gen_context(system_u:object_r:quota_nld_exec_t,s0)
 
 /var/a?quota\.(user|group)	--	gen_context(system_u:object_r:quota_db_t,s0)
-/var/lib/quota(/.*)?			gen_context(system_u:object_r:quota_flag_t,s0)
-/var/spool/a?quota\.(user|group) --	gen_context(system_u:object_r:quota_db_t,s0)
 
-ifdef(`distro_redhat',`
-/usr/sbin/convertquota		--	gen_context(system_u:object_r:quota_exec_t,s0)
-',`
-/sbin/convertquota		--	gen_context(system_u:object_r:quota_exec_t,s0)
-')
+/var/lib/quota(/.*)?	gen_context(system_u:object_r:quota_flag_t,s0)
+
+/var/run/quota_nld\.pid	--	gen_context(system_u:object_r:quota_nld_var_run_t,s0)
+
+/var/spool/a?quota\.(user|group)	--	gen_context(system_u:object_r:quota_db_t,s0)
+
+/var/spool/imap/a?quota\.(user|group)	--	gen_context(system_u:object_r:quota_db_t,s0)
+/var/spool/(client)?mqueue/a?quota\.(user|group)	--	gen_context(system_u:object_r:quota_db_t,s0)
+/var/spool/mqueue\.in/a?quota\.(user|group)	--	gen_context(system_u:object_r:quota_db_t,s0)
+/var/spool/mail/a?quota\.(user|group)	--	gen_context(system_u:object_r:quota_db_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/quota.if refpolicy/policy/modules/contrib/quota.if
--- refpolicy/policy/modules/contrib/quota.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/quota.if	2012-10-22 20:11:56.646015623 +0200
@@ -1,4 +1,4 @@
-## <summary>File system quota management</summary>
+## <summary>File system quota management.</summary>
 
 ########################################
 ## <summary>
@@ -21,8 +21,9 @@
 
 ########################################
 ## <summary>
-##	Execute quota management tools in the quota domain, and
-##	allow the specified role the quota domain.
+##	Execute quota management tools in
+##	the quota domain, and allow the
+##	specified role the quota domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -38,16 +39,89 @@
 #
 interface(`quota_run',`
 	gen_require(`
-		type quota_t;
+		attribute_role quota_roles;
 	')
 
 	quota_domtrans($1)
-	role $2 types quota_t;
+	roleattribute $2 quota_roles;
+')
+
+#######################################
+## <summary>
+##	Execute quota nld in the quota nld domain.
+## </summary>
+## <param name="domain">
+## <summary>
+##  Domain allowed to transition.
+## </summary>
+## </param>
+#
+interface(`quota_domtrans_nld',`
+	gen_require(`
+		type quota_nld_t, quota_nld_exec_t;
+	')
+
+	corecmd_search_bin($1)
+	domtrans_pattern($1, quota_nld_exec_t, quota_nld_t)
+')
+
+########################################
+## <summary>
+##	Create, read, write, and delete
+##	quota db files.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`quota_manage_db_files',`
+	gen_require(`
+		type quota_db_t;
+	')
+
+	allow $1 quota_db_t:file manage_file_perms;
 ')
 
 ########################################
 ## <summary>
-##	Do not audit attempts to get the attributes
+##	Create specified objects in specified
+##	directories with a type transition to
+##	the quota db file type.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="file_type">
+##	<summary>
+##	Directory to transition on.
+##	</summary>
+## </param>
+## <param name="object">
+##	<summary>
+##	The object class of the object being created.
+##	</summary>
+## </param>
+## <param name="name" optional="true">
+##	<summary>
+##	The name of the object being created.
+##	</summary>
+## </param>
+#
+interface(`quota_spec_filetrans_db',`
+	gen_require(`
+		type quota_db_t;
+	')
+
+	filetrans_pattern($1, $2, quota_db_t, $3, $4)
+')
+
+########################################
+## <summary>
+##	Do not audit attempts to get attributes
 ##	of filesystem quota data files.
 ## </summary>
 ## <param name="domain">
@@ -66,8 +140,8 @@
 
 ########################################
 ## <summary>
-##	Create, read, write, and delete quota
-##	flag files.
+##	Create, read, write, and delete
+##	quota flag files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -83,3 +157,40 @@
 	files_search_var_lib($1)
 	manage_files_pattern($1, quota_flag_t, quota_flag_t)
 ')
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an quota environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`quota_admin',`
+	gen_require(`
+		type quota_nld_t, quota_t, quota_db_t;
+		type quota_nld_initrc_exec_t, quota_flag_t, quota_nld_var_run_t;
+	')
+
+	allow $1 { quota_nld_t quota_t }:process { ptrace signal_perms };
+	ps_process_pattern($1, { quota_nld_t quota_t })
+
+	init_labeled_script_domtrans($1, quota_nld_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 quota_nld_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	files_list_all($1)
+	admin_pattern($1, { quota_db_t quota_flag quota_nld_var_run_t })
+
+	quota_run($1, $2)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/quota.te refpolicy/policy/modules/contrib/quota.te
--- refpolicy/policy/modules/contrib/quota.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/quota.te	2012-10-22 20:11:56.659015623 +0200
@@ -1,13 +1,16 @@
-policy_module(quota, 1.5.0)
+policy_module(quota, 1.5.2)
 
 ########################################
 #
 # Declarations
 #
 
+attribute_role quota_roles;
+
 type quota_t;
 type quota_exec_t;
 init_system_domain(quota_t, quota_exec_t)
+role quota_roles types quota_t;
 
 type quota_db_t;
 files_type(quota_db_t)
@@ -15,6 +18,16 @@
 type quota_flag_t;
 files_type(quota_flag_t)
 
+type quota_nld_t;
+type quota_nld_exec_t;
+init_daemon_domain(quota_nld_t, quota_nld_exec_t)
+
+type quota_nld_initrc_exec_t;
+init_script_file(quota_nld_initrc_exec_t)
+
+type quota_nld_var_run_t;
+files_pid_file(quota_nld_var_run_t)
+
 ########################################
 #
 # Local policy
@@ -24,7 +37,6 @@
 dontaudit quota_t self:capability sys_tty_config;
 allow quota_t self:process signal_perms;
 
-# for /quota.*
 allow quota_t quota_db_t:file { manage_file_perms quotaon };
 files_root_filetrans(quota_t, quota_db_t, file)
 files_boot_filetrans(quota_t, quota_db_t, file)
@@ -34,7 +46,9 @@
 files_usr_filetrans(quota_t, quota_db_t, file)
 files_var_filetrans(quota_t, quota_db_t, file)
 files_spool_filetrans(quota_t, quota_db_t, file)
+userdom_user_home_dir_filetrans(quota_t, quota_db_t, file)
 
+kernel_request_load_module(quota_t)
 kernel_list_proc(quota_t)
 kernel_read_proc_symlinks(quota_t)
 kernel_read_kernel_sysctls(quota_t)
@@ -44,6 +58,14 @@
 dev_getattr_all_blk_files(quota_t)
 dev_getattr_all_chr_files(quota_t)
 
+files_list_all(quota_t)
+files_read_all_files(quota_t)
+files_read_all_symlinks(quota_t)
+files_getattr_all_pipes(quota_t)
+files_getattr_all_sockets(quota_t)
+files_getattr_all_file_type_fs(quota_t)
+files_read_etc_runtime_files(quota_t)
+
 fs_get_xattr_fs_quotas(quota_t)
 fs_set_xattr_fs_quotas(quota_t)
 fs_getattr_xattr_fs(quota_t)
@@ -58,15 +80,6 @@
 
 domain_use_interactive_fds(quota_t)
 
-files_list_all(quota_t)
-files_read_all_files(quota_t)
-files_read_all_symlinks(quota_t)
-files_getattr_all_pipes(quota_t)
-files_getattr_all_sockets(quota_t)
-files_getattr_all_file_type_fs(quota_t)
-# Read /etc/mtab.
-files_read_etc_runtime_files(quota_t)
-
 init_use_fds(quota_t)
 init_use_script_ptys(quota_t)
 
@@ -76,9 +89,43 @@
 userdom_dontaudit_use_unpriv_user_fds(quota_t)
 
 optional_policy(`
+	mta_queue_filetrans(quota_t, quota_db_t, file)
+	mta_spool_filetrans(quota_t, quota_db_t, file)
+')
+
+optional_policy(`
 	seutil_sigchld_newrole(quota_t)
 ')
 
 optional_policy(`
 	udev_read_db(quota_t)
 ')
+
+#######################################
+#
+# Nld local policy
+#
+
+allow quota_nld_t self:fifo_file rw_fifo_file_perms;
+allow quota_nld_t self:netlink_socket create_socket_perms;
+allow quota_nld_t self:unix_stream_socket { accept listen };
+
+manage_files_pattern(quota_nld_t, quota_nld_var_run_t, quota_nld_var_run_t)
+files_pid_filetrans(quota_nld_t, quota_nld_var_run_t, { file })
+
+kernel_read_network_state(quota_nld_t)
+
+auth_use_nsswitch(quota_nld_t)
+
+init_read_utmp(quota_nld_t)
+
+logging_send_syslog_msg(quota_nld_t)
+
+miscfiles_read_localization(quota_nld_t)
+
+userdom_use_user_terminals(quota_nld_t)
+
+optional_policy(`
+	dbus_system_bus_client(quota_nld_t)
+	dbus_connect_system_bus(quota_nld_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/rabbitmq.fc refpolicy/policy/modules/contrib/rabbitmq.fc
--- refpolicy/policy/modules/contrib/rabbitmq.fc	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/rabbitmq.fc	2012-10-22 20:11:58.621015628 +0200
@@ -0,0 +1,10 @@
+/etc/rc\.d/init\.d/rabbitmq-server	--	gen_context(system_u:object_r:rabbitmq_initrc_exec_t,s0)
+
+/usr/lib/erlang/erts.*/bin/beam.*	--	gen_context(system_u:object_r:rabbitmq_beam_exec_t,s0)
+/usr/lib/erlang/erts.*/bin/epmd	--	gen_context(system_u:object_r:rabbitmq_epmd_exec_t,s0)
+
+/var/lib/rabbitmq(/.*)?	gen_context(system_u:object_r:rabbitmq_var_lib_t,s0)
+
+/var/log/rabbitmq(/.*)?	gen_context(system_u:object_r:rabbitmq_var_log_t,s0)
+
+/var/run/rabbitmq(/.*)?	gen_context(system_u:object_r:rabbitmq_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/rabbitmq.if refpolicy/policy/modules/contrib/rabbitmq.if
--- refpolicy/policy/modules/contrib/rabbitmq.if	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/rabbitmq.if	2012-10-22 20:11:58.634015628 +0200
@@ -0,0 +1,61 @@
+## <summary>AMQP server written in Erlang.</summary>
+
+########################################
+## <summary>
+##	Execute rabbitmq in the rabbitmq domain.
+## </summary>
+## <param name="domain">
+## <summary>
+##	Domain allowed to transition.
+## </summary>
+## </param>
+#
+interface(`rabbitmq_domtrans',`
+	gen_require(`
+		type rabbitmq_t, rabbitmq_exec_t;
+	')
+
+	corecmd_search_bin($1)
+	domtrans_pattern($1, rabbitmq_exec_t, rabbitmq_t)
+')
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an rabbitmq environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`rabbitmq_admin',`
+	gen_require(`
+		type rabbitmq_epmd_t, rabbitmq_beam_t, rabbitmq_initrc_exec_t;
+		type rabbitmq_var_lib_t, rabbitmq_var_log_t, rabbitmq_var_run_t;
+	')
+
+	allow $1 { rabbitmq_epmd_t rabbitmq_beam_t }:process { ptrace signal_perms };
+	ps_process_pattern($1, { rabbitmq_epmd_t rabbitmq_beam_t })
+
+	init_labeled_script_domtrans($1, rabbitmq_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 rabbitmq_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	logging_search_logs($1)
+	admin_pattern($1, rabbitmq_var_log_t)
+
+	files_search_var_lib($1)
+	admin_pattern($1, rabbitmq_var_lib_t)
+
+	files_search_pids($1)
+	admin_pattern($1, rabbitmq_var_run_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/rabbitmq.te refpolicy/policy/modules/contrib/rabbitmq.te
--- refpolicy/policy/modules/contrib/rabbitmq.te	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/rabbitmq.te	2012-10-22 20:11:58.644015628 +0200
@@ -0,0 +1,106 @@
+policy_module(rabbitmq, 1.0.0)
+
+########################################
+#
+# Declarations
+#
+
+type rabbitmq_epmd_t;
+type rabbitmq_epmd_exec_t;
+init_daemon_domain(rabbitmq_epmd_t, rabbitmq_epmd_exec_t)
+
+type rabbitmq_beam_t;
+type rabbitmq_beam_exec_t;
+init_daemon_domain(rabbitmq_beam_t, rabbitmq_beam_exec_t)
+
+type rabbitmq_initrc_exec_t;
+init_script_file(rabbitmq_initrc_exec_t)
+
+type rabbitmq_var_lib_t;
+files_type(rabbitmq_var_lib_t)
+
+type rabbitmq_var_log_t;
+logging_log_file(rabbitmq_var_log_t)
+
+type rabbitmq_var_run_t;
+files_pid_file(rabbitmq_var_run_t)
+
+######################################
+#
+# Beam local policy
+#
+
+allow rabbitmq_beam_t self:process { setsched signal signull };
+allow rabbitmq_beam_t self:fifo_file rw_fifo_file_perms;
+allow rabbitmq_beam_t self:tcp_socket { accept listen };
+
+manage_dirs_pattern(rabbitmq_beam_t, rabbitmq_var_lib_t, rabbitmq_var_lib_t)
+manage_files_pattern(rabbitmq_beam_t, rabbitmq_var_lib_t, rabbitmq_var_lib_t)
+
+manage_dirs_pattern(rabbitmq_beam_t, rabbitmq_var_log_t, rabbitmq_var_log_t)
+append_files_pattern(rabbitmq_beam_t, rabbitmq_var_log_t, rabbitmq_var_log_t)
+create_files_pattern(rabbitmq_beam_t, rabbitmq_var_log_t, rabbitmq_var_log_t)
+setattr_files_pattern(rabbitmq_beam_t, rabbitmq_var_log_t, rabbitmq_var_log_t)
+
+manage_dirs_pattern(rabbitmq_beam_t, rabbitmq_var_run_t, rabbitmq_var_run_t)
+manage_files_pattern(rabbitmq_beam_t, rabbitmq_var_run_t, rabbitmq_var_run_t)
+
+can_exec(rabbitmq_beam_t, rabbitmq_beam_exec_t)
+
+domtrans_pattern(rabbitmq_beam_t, rabbitmq_epmd_exec_t, rabbitmq_epmd_t)
+
+kernel_read_system_state(rabbitmq_beam_t)
+
+corecmd_exec_bin(rabbitmq_beam_t)
+corecmd_exec_shell(rabbitmq_beam_t)
+
+corenet_all_recvfrom_unlabeled(rabbitmq_beam_t)
+corenet_all_recvfrom_netlabel(rabbitmq_beam_t)
+corenet_tcp_sendrecv_generic_if(rabbitmq_beam_t)
+corenet_tcp_sendrecv_generic_node(rabbitmq_beam_t)
+corenet_tcp_bind_generic_node(rabbitmq_beam_t)
+
+corenet_sendrecv_amqp_server_packets(rabbitmq_beam_t)
+corenet_tcp_bind_amqp_port(rabbitmq_beam_t)
+corenet_tcp_sendrecv_amqp_port(rabbitmq_beam_t)
+
+corenet_sendrecv_epmd_client_packets(rabbitmq_beam_t)
+corenet_tcp_connect_epmd_port(rabbitmq_beam_t)
+corenet_tcp_sendrecv_epmd_port(rabbitmq_beam_t)
+
+dev_read_sysfs(rabbitmq_beam_t)
+
+files_read_etc_files(rabbitmq_beam_t)
+
+miscfiles_read_localization(rabbitmq_beam_t)
+
+sysnet_dns_name_resolve(rabbitmq_beam_t)
+
+########################################
+#
+# Epmd local policy
+#
+
+
+allow rabbitmq_epmd_t self:process signal;
+allow rabbitmq_epmd_t self:fifo_file rw_fifo_file_perms;
+allow rabbitmq_epmd_t self:tcp_socket create_stream_socket_perms;
+allow rabbitmq_epmd_t self:unix_stream_socket { accept listen };
+
+allow rabbitmq_epmd_t rabbitmq_var_log_t:file append_file_perms;
+
+corenet_all_recvfrom_unlabeled(rabbitmq_epmd_t)
+corenet_all_recvfrom_netlabel(rabbitmq_epmd_t)
+corenet_tcp_sendrecv_generic_if(rabbitmq_epmd_t)
+corenet_tcp_sendrecv_generic_node(rabbitmq_epmd_t)
+corenet_tcp_bind_generic_node(rabbitmq_epmd_t)
+
+corenet_sendrecv_epmd_server_packets(rabbitmq_epmd_t)
+corenet_tcp_bind_epmd_port(rabbitmq_epmd_t)
+corenet_tcp_sendrecv_epmd_port(rabbitmq_epmd_t)
+
+files_read_etc_files(rabbitmq_epmd_t)
+
+logging_send_syslog_msg(rabbitmq_epmd_t)
+
+miscfiles_read_localization(rabbitmq_epmd_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/radius.fc refpolicy/policy/modules/contrib/radius.fc
--- refpolicy/policy/modules/contrib/radius.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/radius.fc	2012-10-22 20:12:21.098015676 +0200
@@ -1,23 +1,23 @@
+/etc/cron\.(daily|monthly)/radiusd	--	gen_context(system_u:object_r:radiusd_exec_t,s0)
+/etc/cron\.(daily|weekly|monthly)/freeradius	--	gen_context(system_u:object_r:radiusd_exec_t,s0)
 
-/etc/cron\.(daily|monthly)/radiusd -- gen_context(system_u:object_r:radiusd_exec_t,s0)
-/etc/cron\.(daily|weekly|monthly)/freeradius -- gen_context(system_u:object_r:radiusd_exec_t,s0)
-/etc/rc\.d/init\.d/radiusd --	gen_context(system_u:object_r:radiusd_initrc_exec_t,s0)
+/etc/rc\.d/init\.d/radiusd	--	gen_context(system_u:object_r:radiusd_initrc_exec_t,s0)
 
-/etc/raddb(/.*)?		gen_context(system_u:object_r:radiusd_etc_t,s0)
+/etc/raddb(/.*)?	gen_context(system_u:object_r:radiusd_etc_t,s0)
 /etc/raddb/db\.daily	--	gen_context(system_u:object_r:radiusd_etc_rw_t,s0)
 
 /usr/sbin/radiusd	--	gen_context(system_u:object_r:radiusd_exec_t,s0)
 /usr/sbin/freeradius	--	gen_context(system_u:object_r:radiusd_exec_t,s0)
 
-/var/lib/radiousd(/.*)?		gen_context(system_u:object_r:radiusd_var_lib_t,s0)
+/var/lib/radiousd(/.*)?	gen_context(system_u:object_r:radiusd_var_lib_t,s0)
 
 /var/log/freeradius(/.*)?	gen_context(system_u:object_r:radiusd_log_t,s0)
-/var/log/radacct(/.*)?		gen_context(system_u:object_r:radiusd_log_t,s0)
-/var/log/radius(/.*)?		gen_context(system_u:object_r:radiusd_log_t,s0)
+/var/log/radacct(/.*)?	gen_context(system_u:object_r:radiusd_log_t,s0)
+/var/log/radius(/.*)?	gen_context(system_u:object_r:radiusd_log_t,s0)
 /var/log/radius\.log.*	--	gen_context(system_u:object_r:radiusd_log_t,s0)
-/var/log/radiusd-freeradius(/.*)? gen_context(system_u:object_r:radiusd_log_t,s0)
-/var/log/radutmp	--	gen_context(system_u:object_r:radiusd_log_t,s0)
+/var/log/radiusd-freeradius(/.*)?	gen_context(system_u:object_r:radiusd_log_t,s0)
+/var/log/radutmp.*	--	gen_context(system_u:object_r:radiusd_log_t,s0)
 /var/log/radwtmp.*	--	gen_context(system_u:object_r:radiusd_log_t,s0)
 
-/var/run/radiusd(/.*)?		gen_context(system_u:object_r:radiusd_var_run_t,s0)
+/var/run/radiusd(/.*)?	gen_context(system_u:object_r:radiusd_var_run_t,s0)
 /var/run/radiusd\.pid	--	gen_context(system_u:object_r:radiusd_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/radius.if refpolicy/policy/modules/contrib/radius.if
--- refpolicy/policy/modules/contrib/radius.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/radius.if	2012-10-22 20:12:21.113015676 +0200
@@ -16,8 +16,8 @@
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate
-##	an radius environment
+##	All of the rules required to
+##	administrate an radius environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -47,13 +47,11 @@
 	allow $2 system_r;
 
 	files_list_etc($1)
-	admin_pattern($1, radiusd_etc_t)
+	admin_pattern($1, { radiusd_etc_t radiusd_etc_rw_t })
 
 	logging_list_logs($1)
 	admin_pattern($1, radiusd_log_t)
 
-	admin_pattern($1, radiusd_etc_rw_t)
-
 	files_list_var_lib($1)
 	admin_pattern($1, radiusd_var_lib_t)
 
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/radius.te refpolicy/policy/modules/contrib/radius.te
--- refpolicy/policy/modules/contrib/radius.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/radius.te	2012-10-22 20:12:21.113015676 +0200
@@ -1,4 +1,4 @@
-policy_module(radius, 1.12.0)
+policy_module(radius, 1.12.1)
 
 ########################################
 #
@@ -32,20 +32,16 @@
 # Local policy
 #
 
-# fsetid is for gzip which needs it when run from scripts
-# gzip also needs chown access to preserve GID for radwtmp files
 allow radiusd_t self:capability { chown dac_override fsetid kill setgid setuid sys_resource sys_tty_config };
 dontaudit radiusd_t self:capability sys_tty_config;
 allow radiusd_t self:process { getsched setrlimit setsched sigkill signal };
 allow radiusd_t self:fifo_file rw_fifo_file_perms;
-allow radiusd_t self:unix_stream_socket create_stream_socket_perms;
-allow radiusd_t self:tcp_socket create_stream_socket_perms;
-allow radiusd_t self:udp_socket create_socket_perms;
+allow radiusd_t self:unix_stream_socket { accept listen };
+allow radiusd_t self:tcp_socket { accept listen };
 
 allow radiusd_t radiusd_etc_t:dir list_dir_perms;
-read_files_pattern(radiusd_t, radiusd_etc_t, radiusd_etc_t)
-read_lnk_files_pattern(radiusd_t, radiusd_etc_t, radiusd_etc_t)
-files_search_etc(radiusd_t)
+allow radiusd_t radiusd_etc_t:file read_file_perms;
+allow radiusd_t radiusd_etc_t:lnk_file read_lnk_file_perms;
 
 manage_dirs_pattern(radiusd_t, radiusd_etc_rw_t, radiusd_etc_rw_t)
 manage_files_pattern(radiusd_t, radiusd_etc_rw_t, radiusd_etc_rw_t)
@@ -53,7 +49,9 @@
 filetrans_pattern(radiusd_t, radiusd_etc_t, radiusd_etc_rw_t, { dir file lnk_file })
 
 manage_dirs_pattern(radiusd_t, radiusd_log_t, radiusd_log_t)
-manage_files_pattern(radiusd_t, radiusd_log_t, radiusd_log_t)
+append_files_pattern(radiusd_t, radiusd_log_t, radiusd_log_t)
+create_files_pattern(radiusd_t, radiusd_log_t, radiusd_log_t)
+setattr_files_pattern(radiusd_t, radiusd_log_t, radiusd_log_t)
 logging_log_filetrans(radiusd_t, radiusd_log_t, { file dir })
 
 manage_files_pattern(radiusd_t, radiusd_var_lib_t, radiusd_var_lib_t)
@@ -75,32 +73,33 @@
 corenet_tcp_sendrecv_all_ports(radiusd_t)
 corenet_udp_sendrecv_all_ports(radiusd_t)
 corenet_udp_bind_generic_node(radiusd_t)
+
+corenet_sendrecv_radacct_server_packets(radiusd_t)
 corenet_udp_bind_radacct_port(radiusd_t)
-corenet_udp_bind_radius_port(radiusd_t)
-corenet_tcp_connect_mysqld_port(radiusd_t)
-corenet_tcp_connect_snmp_port(radiusd_t)
+
 corenet_sendrecv_radius_server_packets(radiusd_t)
-corenet_sendrecv_radacct_server_packets(radiusd_t)
-corenet_sendrecv_mysqld_client_packets(radiusd_t)
+corenet_udp_bind_radius_port(radiusd_t)
+
 corenet_sendrecv_snmp_client_packets(radiusd_t)
-# for RADIUS proxy port
+corenet_tcp_connect_snmp_port(radiusd_t)
+
+corenet_sendrecv_generic_server_packets(radiusd_t)
 corenet_udp_bind_generic_port(radiusd_t)
 corenet_dontaudit_udp_bind_all_ports(radiusd_t)
-corenet_sendrecv_generic_server_packets(radiusd_t)
-
-dev_read_sysfs(radiusd_t)
-
-fs_getattr_all_fs(radiusd_t)
-fs_search_auto_mountpoints(radiusd_t)
 
 corecmd_exec_bin(radiusd_t)
 corecmd_exec_shell(radiusd_t)
 
+dev_read_sysfs(radiusd_t)
+
 domain_use_interactive_fds(radiusd_t)
 
+fs_getattr_all_fs(radiusd_t)
+fs_search_auto_mountpoints(radiusd_t)
+
 files_read_usr_files(radiusd_t)
-files_read_etc_files(radiusd_t)
 files_read_etc_runtime_files(radiusd_t)
+files_dontaudit_list_tmp(radiusd_t)
 
 auth_use_nsswitch(radiusd_t)
 auth_read_shadow(radiusd_t)
@@ -113,6 +112,8 @@
 miscfiles_read_localization(radiusd_t)
 miscfiles_read_generic_certs(radiusd_t)
 
+sysnet_use_ldap(radiusd_t)
+
 userdom_dontaudit_use_unpriv_user_fds(radiusd_t)
 userdom_dontaudit_search_user_home_dirs(radiusd_t)
 
@@ -127,11 +128,11 @@
 optional_policy(`
 	mysql_read_config(radiusd_t)
 	mysql_stream_connect(radiusd_t)
+	mysql_tcp_connect(radiusd_t)
 ')
 
 optional_policy(`
 	samba_domtrans_winbind_helper(radiusd_t)
-	samba_read_var_files(radiusd_t)
 ')
 
 optional_policy(`
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/radvd.fc refpolicy/policy/modules/contrib/radvd.fc
--- refpolicy/policy/modules/contrib/radvd.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/radvd.fc	2012-10-22 20:12:23.477015681 +0200
@@ -1,7 +1,8 @@
 /etc/radvd\.conf	--	gen_context(system_u:object_r:radvd_etc_t,s0)
-/etc/rc\.d/init\.d/radvd --	gen_context(system_u:object_r:radvd_initrc_exec_t,s0)
 
-/usr/sbin/radvd		--	gen_context(system_u:object_r:radvd_exec_t,s0)
+/etc/rc\.d/init\.d/radvd	--	gen_context(system_u:object_r:radvd_initrc_exec_t,s0)
 
+/usr/sbin/radvd	--	gen_context(system_u:object_r:radvd_exec_t,s0)
+
+/var/run/radvd(/.*)?	gen_context(system_u:object_r:radvd_var_run_t,s0)
 /var/run/radvd\.pid	--	gen_context(system_u:object_r:radvd_var_run_t,s0)
-/var/run/radvd(/.*)?		gen_context(system_u:object_r:radvd_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/radvd.if refpolicy/policy/modules/contrib/radvd.if
--- refpolicy/policy/modules/contrib/radvd.if	2012-05-04 15:16:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/radvd.if	2012-10-22 20:12:23.501015679 +0200
@@ -1,9 +1,9 @@
-## <summary>IPv6 router advertisement daemon</summary>
+## <summary>IPv6 router advertisement daemon.</summary>
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate 
-##	an radvd environment
+##	All of the rules required to
+##	administrate an radvd environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -19,8 +19,8 @@
 #
 interface(`radvd_admin',`
 	gen_require(`
-		type radvd_t, radvd_etc_t;
-		type radvd_var_run_t, radvd_initrc_exec_t;
+		type radvd_t, radvd_etc_t, radvd_initrc_exec_t;
+		type radvd_var_run_t;
 	')
 
 	allow $1 radvd_t:process { ptrace signal_perms };
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/radvd.te refpolicy/policy/modules/contrib/radvd.te
--- refpolicy/policy/modules/contrib/radvd.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/radvd.te	2012-10-22 20:12:23.501015679 +0200
@@ -1,4 +1,4 @@
-policy_module(radvd, 1.13.0)
+policy_module(radvd, 1.13.1)
 
 ########################################
 #
@@ -8,28 +8,26 @@
 type radvd_exec_t;
 init_daemon_domain(radvd_t, radvd_exec_t)
 
+type radvd_etc_t;
+files_config_file(radvd_etc_t)
+
 type radvd_initrc_exec_t;
 init_script_file(radvd_initrc_exec_t)
 
 type radvd_var_run_t;
 files_pid_file(radvd_var_run_t)
 
-type radvd_etc_t;
-files_config_file(radvd_etc_t)
-
 ########################################
 #
 # Local policy
 #
+
 allow radvd_t self:capability { kill setgid setuid net_raw net_admin };
 dontaudit radvd_t self:capability sys_tty_config;
-allow radvd_t self:process { fork signal_perms };
-allow radvd_t self:unix_dgram_socket create_socket_perms;
-allow radvd_t self:unix_stream_socket create_socket_perms;
+allow radvd_t self:process signal_perms;
+allow radvd_t self:fifo_file rw_fifo_file_perms;
 allow radvd_t self:rawip_socket create_socket_perms;
-allow radvd_t self:tcp_socket create_stream_socket_perms;
-allow radvd_t self:udp_socket create_socket_perms;
-allow radvd_t self:fifo_file rw_file_perms;
+allow radvd_t self:tcp_socket { accept listen };
 
 allow radvd_t radvd_etc_t:file read_file_perms;
 
@@ -43,8 +41,8 @@
 kernel_read_system_state(radvd_t)
 kernel_request_load_module(radvd_t)
 
-corenet_all_recvfrom_unlabeled(radvd_t)
 corenet_all_recvfrom_netlabel(radvd_t)
+corenet_all_recvfrom_unlabeled(radvd_t)
 corenet_tcp_sendrecv_generic_if(radvd_t)
 corenet_udp_sendrecv_generic_if(radvd_t)
 corenet_raw_sendrecv_generic_if(radvd_t)
@@ -56,14 +54,13 @@
 
 dev_read_sysfs(radvd_t)
 
-fs_getattr_all_fs(radvd_t)
-fs_search_auto_mountpoints(radvd_t)
-
 domain_use_interactive_fds(radvd_t)
 
-files_read_etc_files(radvd_t)
 files_list_usr(radvd_t)
 
+fs_getattr_all_fs(radvd_t)
+fs_search_auto_mountpoints(radvd_t)
+
 auth_use_nsswitch(radvd_t)
 
 logging_send_syslog_msg(radvd_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/raid.fc refpolicy/policy/modules/contrib/raid.fc
--- refpolicy/policy/modules/contrib/raid.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/raid.fc	2012-10-22 20:12:24.504015683 +0200
@@ -1,6 +1,21 @@
-/dev/.mdadm.map		--	gen_context(system_u:object_r:mdadm_map_t,s0)
+/dev/\.mdadm\.map	--	gen_context(system_u:object_r:mdadm_var_run_t,s0)
+/dev/md/.*	--	gen_context(system_u:object_r:mdadm_var_run_t,s0)
 
-/sbin/mdadm		--	gen_context(system_u:object_r:mdadm_exec_t,s0)
-/sbin/mdmpd		--	gen_context(system_u:object_r:mdadm_exec_t,s0)
+/etc/rc\.d/init\.d/mdmonitor	--	gen_context(system_u:object_r:mdadm_initrc_exec_t,s0)
 
-/var/run/mdadm(/.*)?		gen_context(system_u:object_r:mdadm_var_run_t,s0)
+/sbin/iprdump	--	gen_context(system_u:object_r:mdadm_exec_t,s0)
+/sbin/iprinit	--	gen_context(system_u:object_r:mdadm_exec_t,s0)
+/sbin/iprupdate	--	gen_context(system_u:object_r:mdadm_exec_t,s0)
+/sbin/mdadm	--	gen_context(system_u:object_r:mdadm_exec_t,s0)
+/sbin/mdmon	--	gen_context(system_u:object_r:mdadm_exec_t,s0)
+/sbin/mdmpd	--	gen_context(system_u:object_r:mdadm_exec_t,s0)
+/sbin/raid-check	--	gen_context(system_u:object_r:mdadm_exec_t,s0)
+
+/usr/sbin/iprdump	--	gen_context(system_u:object_r:mdadm_exec_t,s0)
+/usr/sbin/iprinit	--	gen_context(system_u:object_r:mdadm_exec_t,s0)
+/usr/sbin/iprupdate	--	gen_context(system_u:object_r:mdadm_exec_t,s0)
+/usr/sbin/mdadm	--	gen_context(system_u:object_r:mdadm_exec_t,s0)
+/usr/sbin/mdmpd	--	gen_context(system_u:object_r:mdadm_exec_t,s0)
+/usr/sbin/raid-check	--	gen_context(system_u:object_r:mdadm_exec_t,s0)
+
+/var/run/mdadm(/.*)?	gen_context(system_u:object_r:mdadm_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/raid.if refpolicy/policy/modules/contrib/raid.if
--- refpolicy/policy/modules/contrib/raid.if	2012-05-04 15:16:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/raid.if	2012-10-22 20:12:24.505015683 +0200
@@ -1,8 +1,9 @@
-## <summary>RAID array management tools</summary>
+## <summary>RAID array management tools.</summary>
 
 ########################################
 ## <summary>
-##	Execute software raid tools in the mdadm domain.
+##	Execute software raid tools in
+##	the mdadm domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -21,42 +22,35 @@
 
 ######################################
 ## <summary>
-##	Execute a domain transition to mdadm_t for the
-##	specified role, allowing it to use the mdadm_t
-##	domain
+##	Execute mdadm in the mdadm
+##	domain, and allow the specified
+##	role the mdadm domain.
 ## </summary>
 ## <param name="role">
 ##	<summary>
-##	Role allowed to access mdadm_t domain
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <param name="domain">
 ##	<summary>
-##	Domain allowed to transition to mdadm_t
+##	Domain allowed to transition.
 ##	</summary>
 ## </param>
 #
 interface(`raid_run_mdadm',`
 	gen_require(`
-		type mdadm_t;
+		attribute_role mdadm_roles;
 	')
 
-	role $1 types mdadm_t;
 	raid_domtrans_mdadm($2)
+	roleattribute $1 mdadm_roles;
 ')
 
 ########################################
 ## <summary>
-##	Create, read, write, and delete the mdadm pid files.
+##	Create, read, write, and delete
+##	mdadm pid files.
 ## </summary>
-## <desc>
-##	<p>
-##	Create, read, write, and delete the mdadm pid files.
-##	</p>
-##	<p>
-##	Added for use in the init module.
-##	</p>
-## </desc>
 ## <param name="domain">
 ##	<summary>
 ##	Domain allowed access.
@@ -68,8 +62,42 @@
 		type mdadm_var_run_t;
 	')
 
-	# FIXME: maybe should have a type_transition.  not
-	# clear what this is doing, from the original
-	# mdadm policy
+	files_search_pids($1)
 	allow $1 mdadm_var_run_t:file manage_file_perms;
 ')
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an mdadm environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`raid_admin_mdadm',`
+	gen_require(`
+		type mdadm_t, mdadm_initrc_exec_t, mdadm_var_run_t;
+	')
+
+	allow $1 mdadm_t:process { ptrace signal_perms };
+	ps_process_pattern($1, mdadm_t)
+
+	init_labeled_script_domtrans($1, mdadm_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 mdadm_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	files_search_pids($1)
+	admin_pattern($1, mdadm_var_run_t)
+
+	raid_run_mdadm($2, $1)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/raid.te refpolicy/policy/modules/contrib/raid.te
--- refpolicy/policy/modules/contrib/raid.te	2012-07-25 20:33:05.000000000 +0200
+++ refpolicy/policy/modules/contrib/raid.te	2012-10-22 20:12:24.505015683 +0200
@@ -1,20 +1,23 @@
-policy_module(raid, 1.12.0)
+policy_module(raid, 1.12.4)
 
 ########################################
 #
 # Declarations
 #
 
+attribute_role mdadm_roles;
+
 type mdadm_t;
 type mdadm_exec_t;
 init_daemon_domain(mdadm_t, mdadm_exec_t)
-role system_r types mdadm_t;
+role mdadm_roles types mdadm_t;
 
-type mdadm_map_t;
-files_type(mdadm_map_t)
+type mdadm_initrc_exec_t;
+init_script_file(mdadm_initrc_exec_t)
 
-type mdadm_var_run_t;
+type mdadm_var_run_t alias mdadm_map_t;
 files_pid_file(mdadm_var_run_t)
+dev_associate(mdadm_var_run_t)
 
 ########################################
 #
@@ -23,34 +26,30 @@
 
 allow mdadm_t self:capability { dac_override sys_admin ipc_lock };
 dontaudit mdadm_t self:capability sys_tty_config;
-allow mdadm_t self:process { sigchld sigkill sigstop signull signal };
+allow mdadm_t self:process { getsched setsched signal_perms };
 allow mdadm_t self:fifo_file rw_fifo_file_perms;
+allow mdadm_t self:netlink_kobject_uevent_socket create_socket_perms;
 
-# create .mdadm files in /dev
-allow mdadm_t mdadm_map_t:file manage_file_perms;
-dev_filetrans(mdadm_t, mdadm_map_t, file)
-
+manage_dirs_pattern(mdadm_t, mdadm_var_run_t, mdadm_var_run_t)
 manage_files_pattern(mdadm_t, mdadm_var_run_t, mdadm_var_run_t)
-files_pid_filetrans(mdadm_t, mdadm_var_run_t, file)
+manage_lnk_files_pattern(mdadm_t, mdadm_var_run_t, mdadm_var_run_t)
+manage_sock_files_pattern(mdadm_t, mdadm_var_run_t, mdadm_var_run_t)
+dev_filetrans(mdadm_t, mdadm_var_run_t, file)
+files_pid_filetrans(mdadm_t, mdadm_var_run_t, { dir file })
 
+kernel_getattr_core_if(mdadm_t)
 kernel_read_system_state(mdadm_t)
 kernel_read_kernel_sysctls(mdadm_t)
+kernel_request_load_module(mdadm_t)
 kernel_rw_software_raid_state(mdadm_t)
-kernel_getattr_core_if(mdadm_t)
 
-# Helper program access
 corecmd_exec_bin(mdadm_t)
 corecmd_exec_shell(mdadm_t)
 
 dev_rw_sysfs(mdadm_t)
-# Ignore attempts to read every device file
 dev_dontaudit_getattr_all_blk_files(mdadm_t)
 dev_dontaudit_getattr_all_chr_files(mdadm_t)
-dev_dontaudit_getattr_generic_files(mdadm_t)
-dev_dontaudit_getattr_generic_chr_files(mdadm_t)
-dev_dontaudit_getattr_generic_blk_files(mdadm_t)
 dev_read_realtime_clock(mdadm_t)
-# unfortunately needed for DMI decoding:
 dev_read_raw_memory(mdadm_t)
 
 domain_use_interactive_fds(mdadm_t)
@@ -59,16 +58,17 @@
 files_read_etc_runtime_files(mdadm_t)
 files_dontaudit_getattr_all_files(mdadm_t)
 
-fs_search_auto_mountpoints(mdadm_t)
+fs_list_auto_mountpoints(mdadm_t)
+fs_list_hugetlbfs(mdadm_t)
 fs_dontaudit_list_tmpfs(mdadm_t)
 
 mls_file_read_all_levels(mdadm_t)
 mls_file_write_all_levels(mdadm_t)
 
-# RAID block device access
-storage_manage_fixed_disk(mdadm_t)
 storage_dev_filetrans_fixed_disk(mdadm_t)
+storage_manage_fixed_disk(mdadm_t)
 storage_read_scsi_generic(mdadm_t)
+storage_write_scsi_generic(mdadm_t)
 
 term_dontaudit_list_ptys(mdadm_t)
 term_dontaudit_use_unallocated_ttys(mdadm_t)
@@ -83,20 +83,22 @@
 userdom_dontaudit_search_user_home_content(mdadm_t)
 userdom_dontaudit_use_user_terminals(mdadm_t)
 
-mta_send_mail(mdadm_t)
+optional_policy(`
+	cron_system_entry(mdadm_t, mdadm_exec_t)
+')
 
 optional_policy(`
 	gpm_dontaudit_getattr_gpmctl(mdadm_t)
 ')
 
 optional_policy(`
-	seutil_sigchld_newrole(mdadm_t)
+	mta_send_mail(mdadm_t)
 ')
 
 optional_policy(`
-	udev_read_db(mdadm_t)
+	seutil_sigchld_newrole(mdadm_t)
 ')
 
 optional_policy(`
-	unconfined_domain(mdadm_t)
+	udev_read_db(mdadm_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/razor.fc refpolicy/policy/modules/contrib/razor.fc
--- refpolicy/policy/modules/contrib/razor.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/razor.fc	2012-10-22 20:12:27.007015688 +0200
@@ -1,8 +1,9 @@
-HOME_DIR/\.razor(/.*)?		gen_context(system_u:object_r:razor_home_t,s0)
+HOME_DIR/\.razor(/.*)?	gen_context(system_u:object_r:razor_home_t,s0)
 
-/etc/razor(/.*)?		gen_context(system_u:object_r:razor_etc_t,s0)
+/etc/razor(/.*)?	gen_context(system_u:object_r:razor_etc_t,s0)
 
 /usr/bin/razor.*	--	gen_context(system_u:object_r:razor_exec_t,s0)
 
-/var/lib/razor(/.*)?		gen_context(system_u:object_r:razor_var_lib_t,s0)
-/var/log/razor-agent\.log --	gen_context(system_u:object_r:razor_log_t,s0)
+/var/lib/razor(/.*)?	gen_context(system_u:object_r:razor_var_lib_t,s0)
+
+/var/log/razor-agent\.log.*	--	gen_context(system_u:object_r:razor_log_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/razor.if refpolicy/policy/modules/contrib/razor.if
--- refpolicy/policy/modules/contrib/razor.if	2012-05-04 15:16:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/razor.if	2012-10-28 18:59:08.900026460 +0100
@@ -1,143 +1,72 @@
 ## <summary>A distributed, collaborative, spam detection and filtering network.</summary>
-## <desc>
-##	<p>
-##	A distributed, collaborative, spam detection and filtering network.
-##	</p>
-##	<p>
-##	This policy will work with either the ATrpms provided config
-##	file in /etc/razor, or with the default of dumping everything into
-##	$HOME/.razor.
-##	</p>
-## </desc>
 
 #######################################
 ## <summary>
-##	Template to create types and rules common to
-##	all razor domains.
+##	The template to define a razor domain.
 ## </summary>
-## <param name="prefix">
+## <param name="domain_prefix">
 ##	<summary>
-##	The prefix of the domain (e.g., user
-##	is the prefix for user_t).
+##	Domain prefix to be used.
 ##	</summary>
 ## </param>
 #
 template(`razor_common_domain_template',`
 	gen_require(`
-		type razor_exec_t, razor_etc_t, razor_log_t, razor_var_lib_t;
+		attribute razor_domain;
+		type razor_exec_t;
 	')
-	type $1_t;
-	domain_type($1_t)
-	domain_entry_file($1_t, razor_exec_t)
 
-	allow $1_t self:process ~{ ptrace setcurrent setexec setfscreate setrlimit execmem execstack execheap };
-	allow $1_t self:fd use;
-	allow $1_t self:fifo_file rw_fifo_file_perms;
-	allow $1_t self:unix_dgram_socket create_socket_perms;
-	allow $1_t self:unix_stream_socket create_stream_socket_perms;
-	allow $1_t self:unix_dgram_socket sendto;
-	allow $1_t self:unix_stream_socket connectto;
-	allow $1_t self:shm create_shm_perms;
-	allow $1_t self:sem create_sem_perms;
-	allow $1_t self:msgq create_msgq_perms;
-	allow $1_t self:msg { send receive };
-	allow $1_t self:tcp_socket create_socket_perms;
-
-	# Read system config file
-	allow $1_t razor_etc_t:dir list_dir_perms;
-	allow $1_t razor_etc_t:file read_file_perms;
-	allow $1_t razor_etc_t:lnk_file { getattr read };
-
-	manage_dirs_pattern($1_t, razor_log_t, razor_log_t)
-	manage_files_pattern($1_t, razor_log_t, razor_log_t)
-	manage_lnk_files_pattern($1_t, razor_log_t, razor_log_t)
-	logging_log_filetrans($1_t, razor_log_t, file)
-
-	manage_dirs_pattern($1_t, razor_var_lib_t, razor_var_lib_t)
-	manage_files_pattern($1_t, razor_var_lib_t, razor_var_lib_t)
-	manage_lnk_files_pattern($1_t, razor_var_lib_t, razor_var_lib_t)
-	files_search_var_lib($1_t)
-
-	# Razor is one executable and several symlinks
-	allow $1_t razor_exec_t:file read_file_perms;
-	allow $1_t razor_exec_t:lnk_file read_lnk_file_perms;
-
-	kernel_read_system_state($1_t)
-	kernel_read_network_state($1_t)
-	kernel_read_software_raid_state($1_t)
-	kernel_getattr_core_if($1_t)
-	kernel_getattr_message_if($1_t)
-	kernel_read_kernel_sysctls($1_t)
-
-	corecmd_exec_bin($1_t)
-
-	corenet_all_recvfrom_unlabeled($1_t)
-	corenet_all_recvfrom_netlabel($1_t)
-	corenet_tcp_sendrecv_generic_if($1_t)
-	corenet_raw_sendrecv_generic_if($1_t)
-	corenet_tcp_sendrecv_generic_node($1_t)
-	corenet_raw_sendrecv_generic_node($1_t)
-	corenet_tcp_sendrecv_razor_port($1_t)
-
-	# mktemp and other randoms
-	dev_read_rand($1_t)
-	dev_read_urand($1_t)
-
-	files_search_pids($1_t)
-	# Allow access to various files in the /etc/directory including mtab
-	# and nsswitch
-	files_read_etc_files($1_t)
-	files_read_etc_runtime_files($1_t)
-
-	fs_search_auto_mountpoints($1_t)
-
-	libs_read_lib_files($1_t)
+	########################################
+	#
+	# Declarations
+	#
 
-	miscfiles_read_localization($1_t)
+	type $1_t, razor_domain;
+	domain_type($1_t)
+	domain_entry_file($1_t, razor_exec_t)
 
-	sysnet_read_config($1_t)
-	sysnet_dns_name_resolve($1_t)
+	########################################
+	#
+	# Declarations
+	#
 
-	optional_policy(`
-		nis_use_ypbind($1_t)
-	')
+	auth_use_nsswitch($1_t)
 ')
 
 ########################################
 ## <summary>
-##	Role access for razor
+##	Role access for razor.
 ## </summary>
 ## <param name="role">
 ##	<summary>
-##	Role allowed access
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <param name="domain">
 ##	<summary>
-##	User domain for the role
+##	User domain for the role.
 ##	</summary>
 ## </param>
 #
 interface(`razor_role',`
 	gen_require(`
+		attribute_role razor_roles;
 		type razor_t, razor_exec_t, razor_home_t;
+		type razor_tmp_t;
 	')
 
-	role $1 types razor_t;
+	roleattribute $1 razor_roles;
 
-	# Transition from the user domain to the derived domain.
 	domtrans_pattern($2, razor_exec_t, razor_t)
 
-	# allow ps to show razor and allow the user to kill it 
 	ps_process_pattern($2, razor_t)
 	allow $2 razor_t:process signal;
 
-	manage_dirs_pattern($2, razor_home_t, razor_home_t)
-	manage_files_pattern($2, razor_home_t, razor_home_t)
-	manage_lnk_files_pattern($2, razor_home_t, razor_home_t)
-	relabel_dirs_pattern($2, razor_home_t, razor_home_t)
-	relabel_files_pattern($2, razor_home_t, razor_home_t)
-	relabel_lnk_files_pattern($2, razor_home_t, razor_home_t)
+	allow $2 { razor_home_t razor_tmp_t }:dir { manage_dir_perms relabel_dir_perms };
+	allow $2 { razor_home_t razor_tmp_t }:file { manage_file_perms relabel_file_perms };
+	allow $2 razor_home_t:lnk_file { manage_lnk_file_perms relabel_lnk_file_perms };
+
+	userdom_user_home_dir_filetrans($2, razor_home_t, dir, ".razor")
 ')
 
 ########################################
@@ -152,8 +81,50 @@
 #
 interface(`razor_domtrans',`
 	gen_require(`
-		type razor_t, razor_exec_t;
+		type system_razor_t, razor_exec_t;
+	')
+
+	corecmd_search_bin($1)
+	domtrans_pattern($1, razor_exec_t, system_razor_t)
+')
+
+########################################
+## <summary>
+##	Create, read, write, and delete
+##	razor home content.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`razor_manage_home_content',`
+	gen_require(`
+		type razor_home_t;
+	')
+
+	userdom_search_user_home_dirs($1)
+	allow $1 razor_home_t:dir manage_dir_perms;
+	allow $1 razor_home_t:file manage_file_perms;
+	allow $1 razor_home_t:lnk_file manage_lnk_file_perms;
+')
+
+########################################
+## <summary>
+##	Read razor lib files.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`razor_read_lib_files',`
+	gen_require(`
+		type razor_var_lib_t;
 	')
 
-	domtrans_pattern($1, razor_exec_t, razor_t)
+	files_search_var_lib($1)
+	read_files_pattern($1, razor_var_lib_t, razor_var_lib_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/razor.te refpolicy/policy/modules/contrib/razor.te
--- refpolicy/policy/modules/contrib/razor.te	2012-05-04 15:16:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/razor.te	2012-10-28 18:59:08.901026460 +0100
@@ -1,10 +1,14 @@
-policy_module(razor, 2.3.0)
+policy_module(razor, 2.3.2)
 
 ########################################
 #
 # Declarations
 #
 
+attribute razor_domain;
+
+attribute_role razor_roles;
+
 type razor_exec_t;
 corecmd_executable_file(razor_exec_t)
 
@@ -27,81 +31,99 @@
 type razor_var_lib_t;
 files_type(razor_var_lib_t)
 
-# these are here due to ordering issues:
 razor_common_domain_template(razor)
 typealias razor_t alias { user_razor_t staff_razor_t sysadm_razor_t };
 typealias razor_t alias { auditadm_razor_t secadm_razor_t };
 userdom_user_application_type(razor_t)
+role razor_roles types razor_t;
 
 razor_common_domain_template(system_razor)
 role system_r types system_razor_t;
 
 ########################################
 #
-# System razor local policy
+# Common razor domain local policy
 #
 
-# this version of razor is invoked typically
-# via the system spam filter
+allow razor_domain self:process ~{ ptrace setcurrent setexec setfscreate setrlimit execmem execstack execheap };
+allow razor_domain self:fd use;
+allow razor_domain self:fifo_file rw_fifo_file_perms;
+allow razor_domain self:unix_dgram_socket sendto;
+allow razor_domain self:unix_stream_socket { accept connectto listen };
 
-allow system_razor_t self:tcp_socket create_socket_perms;
+allow razor_domain razor_etc_t:dir list_dir_perms;
+allow razor_domain razor_etc_t:file read_file_perms;
+allow razor_domain razor_etc_t:lnk_file read_lnk_file_perms;
 
-manage_dirs_pattern(system_razor_t, razor_etc_t, razor_etc_t)
-manage_files_pattern(system_razor_t, razor_etc_t, razor_etc_t)
-manage_lnk_files_pattern(system_razor_t, razor_etc_t, razor_etc_t)
-files_search_etc(system_razor_t)
+allow razor_domain razor_exec_t:file read_file_perms;
+allow razor_domain razor_exec_t:lnk_file read_lnk_file_perms;
 
-allow system_razor_t razor_log_t:file manage_file_perms;
-logging_log_filetrans(system_razor_t, razor_log_t, file)
+kernel_read_system_state(razor_domain)
+kernel_read_network_state(razor_domain)
+kernel_read_software_raid_state(razor_domain)
+kernel_getattr_core_if(razor_domain)
+kernel_getattr_message_if(razor_domain)
+kernel_read_kernel_sysctls(razor_domain)
 
-manage_files_pattern(system_razor_t, razor_var_lib_t, razor_var_lib_t)
-files_var_lib_filetrans(system_razor_t, razor_var_lib_t, file)
+corecmd_exec_bin(razor_domain)
 
-corenet_all_recvfrom_unlabeled(system_razor_t)
-corenet_all_recvfrom_netlabel(system_razor_t)
-corenet_tcp_sendrecv_generic_if(system_razor_t)
-corenet_raw_sendrecv_generic_if(system_razor_t)
-corenet_tcp_sendrecv_generic_node(system_razor_t)
-corenet_raw_sendrecv_generic_node(system_razor_t)
-corenet_tcp_sendrecv_razor_port(system_razor_t)
-corenet_tcp_connect_razor_port(system_razor_t)
-corenet_sendrecv_razor_client_packets(system_razor_t)
+corenet_all_recvfrom_unlabeled(razor_domain)
+corenet_all_recvfrom_netlabel(razor_domain)
+corenet_tcp_sendrecv_generic_if(razor_domain)
+corenet_tcp_sendrecv_generic_node(razor_domain)
 
-sysnet_read_config(system_razor_t)
+corenet_tcp_sendrecv_razor_port(razor_domain)
+corenet_tcp_connect_razor_port(razor_domain)
+corenet_sendrecv_razor_client_packets(razor_domain)
 
-# cjp: this shouldn't be needed
-userdom_use_unpriv_users_fds(system_razor_t)
+dev_read_rand(razor_domain)
+dev_read_urand(razor_domain)
 
-optional_policy(`
-	logging_send_syslog_msg(system_razor_t)
-')
+files_read_etc_runtime_files(razor_domain)
 
-optional_policy(`
-	nscd_socket_use(system_razor_t)
-')
+libs_read_lib_files(razor_domain)
+
+miscfiles_read_localization(razor_domain)
 
 ########################################
 #
-# User razor local policy
+# System local policy
 #
 
-# Allow razor to be run by hand.  Needed by any action other than
-# invocation from a spam filter.
+manage_dirs_pattern(system_razor_t, razor_etc_t, razor_etc_t)
+manage_files_pattern(system_razor_t, razor_etc_t, razor_etc_t)
+manage_lnk_files_pattern(system_razor_t, razor_etc_t, razor_etc_t)
+
+manage_dirs_pattern(system_razor_t, razor_log_t, razor_log_t)
+append_files_pattern(system_razor_t, razor_log_t, razor_log_t)
+create_files_pattern(system_razor_t, razor_log_t, razor_log_t)
+setattr_files_pattern(system_razor_t, razor_log_t, razor_log_t)
+manage_lnk_files_pattern(system_razor_t, razor_log_t, razor_log_t)
+logging_log_filetrans(system_razor_t, razor_log_t, file)
+
+manage_dirs_pattern(system_razor_t, razor_var_lib_t, razor_var_lib_t)
+manage_files_pattern(system_razor_t, razor_var_lib_t, razor_var_lib_t)
+manage_lnk_files_pattern(system_razor_t, razor_var_lib_t, razor_var_lib_t)
+files_var_lib_filetrans(system_razor_t, razor_var_lib_t, file)
 
-allow razor_t self:unix_stream_socket create_stream_socket_perms;
+########################################
+#
+# Session local policy
+#
 
 manage_dirs_pattern(razor_t, razor_home_t, razor_home_t)
 manage_files_pattern(razor_t, razor_home_t, razor_home_t)
 manage_lnk_files_pattern(razor_t, razor_home_t, razor_home_t)
-userdom_user_home_dir_filetrans(razor_t, razor_home_t, dir)
+userdom_user_home_dir_filetrans(razor_t, razor_home_t, dir, ".razor")
 
 manage_dirs_pattern(razor_t, razor_tmp_t, razor_tmp_t)
 manage_files_pattern(razor_t, razor_tmp_t, razor_tmp_t)
 files_tmp_filetrans(razor_t, razor_tmp_t, { file dir })
 
-logging_send_syslog_msg(razor_t)
+fs_getattr_all_fs(razor_t)
+fs_search_auto_mountpoints(razor_t)
 
-userdom_search_user_home_dirs(razor_t)
+userdom_use_unpriv_users_fds(razor_t)
 userdom_use_user_terminals(razor_t)
 
 tunable_policy(`use_nfs_home_dirs',`
@@ -115,7 +137,3 @@
 	fs_manage_cifs_files(razor_t)
 	fs_manage_cifs_symlinks(razor_t)
 ')
-
-optional_policy(`
-	nscd_socket_use(razor_t)
-')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/rdisc.fc refpolicy/policy/modules/contrib/rdisc.fc
--- refpolicy/policy/modules/contrib/rdisc.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/rdisc.fc	2012-10-24 17:01:20.896003096 +0200
@@ -1,2 +1,3 @@
-
 /sbin/rdisc	--	gen_context(system_u:object_r:rdisc_exec_t,s0)
+
+/usr/sbin/rdisc	--	gen_context(system_u:object_r:rdisc_exec_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/rdisc.if refpolicy/policy/modules/contrib/rdisc.if
--- refpolicy/policy/modules/contrib/rdisc.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/rdisc.if	2012-10-24 17:01:20.906003099 +0200
@@ -1,4 +1,4 @@
-## <summary>Network router discovery daemon</summary>
+## <summary>Network router discovery daemon.</summary>
 
 ######################################
 ## <summary>
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/rdisc.te refpolicy/policy/modules/contrib/rdisc.te
--- refpolicy/policy/modules/contrib/rdisc.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/rdisc.te	2012-10-24 17:01:20.906003099 +0200
@@ -17,7 +17,7 @@
 allow rdisc_t self:capability net_raw;
 dontaudit rdisc_t self:capability sys_tty_config;
 allow rdisc_t self:process signal_perms;
-allow rdisc_t self:unix_stream_socket create_stream_socket_perms;
+allow rdisc_t self:unix_stream_socket { accept listen };
 allow rdisc_t self:udp_socket create_socket_perms;
 allow rdisc_t self:rawip_socket create_socket_perms;
 
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/readahead.fc refpolicy/policy/modules/contrib/readahead.fc
--- refpolicy/policy/modules/contrib/readahead.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/readahead.fc	2012-10-24 17:01:22.845003104 +0200
@@ -1,3 +1,7 @@
-/usr/sbin/readahead.*	--	gen_context(system_u:object_r:readahead_exec_t,s0)
 /sbin/readahead.*	--	gen_context(system_u:object_r:readahead_exec_t,s0)
+
+/usr/sbin/readahead.*	--	gen_context(system_u:object_r:readahead_exec_t,s0)
+
 /var/lib/readahead(/.*)?	gen_context(system_u:object_r:readahead_var_lib_t,s0)
+
+/var/run/readahead,*	gen_context(system_u:object_r:readahead_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/readahead.if refpolicy/policy/modules/contrib/readahead.if
--- refpolicy/policy/modules/contrib/readahead.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/readahead.if	2012-10-24 17:01:22.857003102 +0200
@@ -1 +1,21 @@
-## <summary>Readahead, read files into page cache for improved performance</summary>
+## <summary>Read files into page cache for improved performance.</summary>
+
+########################################
+## <summary>
+##	Execute a domain transition
+##	to run readahead.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed to transition.
+##	</summary>
+## </param>
+#
+interface(`readahead_domtrans',`
+	gen_require(`
+		type readahead_t, readahead_exec_t;
+	')
+
+	corecmd_search_bin($1)
+	domtrans_pattern($1, readahead_exec_t, readahead_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/readahead.te refpolicy/policy/modules/contrib/readahead.te
--- refpolicy/policy/modules/contrib/readahead.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/readahead.te	2012-10-24 17:01:22.857003102 +0200
@@ -1,4 +1,4 @@
-policy_module(readahead, 1.12.0)
+policy_module(readahead, 1.12.2)
 
 ########################################
 #
@@ -7,8 +7,7 @@
 
 type readahead_t;
 type readahead_exec_t;
-init_daemon_domain(readahead_t, readahead_exec_t)
-application_domain(readahead_t, readahead_exec_t)
+init_system_domain(readahead_t, readahead_exec_t)
 
 type readahead_var_lib_t;
 files_type(readahead_var_lib_t)
@@ -16,22 +15,23 @@
 
 type readahead_var_run_t;
 files_pid_file(readahead_var_run_t)
+init_daemon_run_dir(readahead_var_run_t, "readahead")
 
 ########################################
 #
 # Local policy
 #
 
-allow readahead_t self:capability { fowner dac_override dac_read_search };
+allow readahead_t self:capability { sys_admin fowner dac_override dac_read_search };
 dontaudit readahead_t self:capability { net_admin sys_tty_config };
 allow readahead_t self:process { setsched signal_perms };
 
 manage_dirs_pattern(readahead_t, readahead_var_lib_t, readahead_var_lib_t)
 manage_files_pattern(readahead_t, readahead_var_lib_t, readahead_var_lib_t)
-files_search_var_lib(readahead_t)
 
+manage_dirs_pattern(readahead_t, readahead_var_run_t, readahead_var_run_t)
 manage_files_pattern(readahead_t, readahead_var_run_t, readahead_var_run_t)
-files_pid_filetrans(readahead_t, readahead_var_run_t, file)
+files_pid_filetrans(readahead_t, readahead_var_run_t, { dir file })
 
 kernel_read_all_sysctls(readahead_t)
 kernel_read_system_state(readahead_t)
@@ -45,16 +45,16 @@
 dev_dontaudit_read_all_blk_files(readahead_t)
 dev_dontaudit_getattr_memory_dev(readahead_t)
 dev_dontaudit_getattr_nvram_dev(readahead_t)
-# Early devtmpfs, before udev relabel
 dev_dontaudit_rw_generic_chr_files(readahead_t)
 
 domain_use_interactive_fds(readahead_t)
 domain_read_all_domains_state(readahead_t)
 
-files_list_non_security(readahead_t)
-files_read_non_security_files(readahead_t)
 files_create_boot_flag(readahead_t)
 files_getattr_all_pipes(readahead_t)
+files_list_non_security(readahead_t)
+files_read_non_security_files(readahead_t)
+files_search_var_lib(readahead_t)
 files_dontaudit_getattr_all_sockets(readahead_t)
 files_dontaudit_getattr_non_security_blk_files(readahead_t)
 
@@ -71,6 +71,8 @@
 fs_dontaudit_read_ramfs_files(readahead_t)
 fs_dontaudit_use_tmpfs_chr_dev(readahead_t)
 
+mcs_file_read_all(readahead_t)
+
 mls_file_read_all_levels(readahead_t)
 
 storage_raw_read_fixed_disk(readahead_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/realmd.fc refpolicy/policy/modules/contrib/realmd.fc
--- refpolicy/policy/modules/contrib/realmd.fc	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/realmd.fc	2012-10-24 17:01:31.547003117 +0200
@@ -0,0 +1 @@
+/usr/lib/realmd/realmd	--	gen_context(system_u:object_r:realmd_exec_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/realmd.if refpolicy/policy/modules/contrib/realmd.if
--- refpolicy/policy/modules/contrib/realmd.if	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/realmd.if	2012-10-24 17:01:31.547003117 +0200
@@ -0,0 +1,41 @@
+## <summary>Dbus system service which manages discovery and enrollment in realms and domains like Active Directory or IPA.</summary>
+
+########################################
+## <summary>
+##	Execute realmd in the realmd domain.
+## </summary>
+## <param name="domain">
+## <summary>
+##	Domain allowed to transition.
+## </summary>
+## </param>
+#
+interface(`realmd_domtrans',`
+	gen_require(`
+		type realmd_t, realmd_exec_t;
+	')
+
+	corecmd_search_bin($1)
+	domtrans_pattern($1, realmd_exec_t, realmd_t)
+')
+
+########################################
+## <summary>
+##	Send and receive messages from
+##	realmd over dbus.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`realmd_dbus_chat',`
+	gen_require(`
+		type realmd_t;
+		class dbus send_msg;
+	')
+
+	allow $1 realmd_t:dbus send_msg;
+	allow realmd_t $1:dbus send_msg;
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/realmd.te refpolicy/policy/modules/contrib/realmd.te
--- refpolicy/policy/modules/contrib/realmd.te	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/realmd.te	2012-10-30 19:32:40.286399586 +0100
@@ -0,0 +1,88 @@
+policy_module(realmd, 1.0.1)
+
+########################################
+#
+# Declarations
+#
+
+type realmd_t;
+type realmd_exec_t;
+init_system_domain(realmd_t, realmd_exec_t)
+
+########################################
+#
+# Local policy
+#
+
+allow realmd_t self:capability sys_nice;
+allow realmd_t self:process setsched;
+
+kernel_read_system_state(realmd_t)
+
+corecmd_exec_bin(realmd_t)
+corecmd_exec_shell(realmd_t)
+
+corenet_all_recvfrom_unlabeled(realmd_t)
+corenet_all_recvfrom_netlabel(realmd_t)
+corenet_tcp_sendrecv_generic_if(realmd_t)
+corenet_tcp_sendrecv_generic_node(realmd_t)
+
+corenet_sendrecv_http_client_packets(realmd_t)
+corenet_tcp_connect_http_port(realmd_t)
+corenet_tcp_sendrecv_http_port(realmd_t)
+
+domain_use_interactive_fds(realmd_t)
+
+dev_read_rand(realmd_t)
+dev_read_urand(realmd_t)
+
+files_read_usr_files(realmd_t)
+
+auth_use_nsswitch(realmd_t)
+
+logging_send_syslog_msg(realmd_t)
+
+optional_policy(`
+	dbus_system_domain(realmd_t, realmd_exec_t)
+
+	optional_policy(`
+		networkmanager_dbus_chat(realmd_t)
+	')
+
+	optional_policy(`
+		policykit_dbus_chat(realmd_t)
+	')
+')
+
+optional_policy(`
+	hostname_exec(realmd_t)
+')
+
+optional_policy(`
+	kerberos_use(realmd_t)
+	kerberos_rw_keytab(realmd_t)
+')
+
+optional_policy(`
+	nis_exec_ypbind(realmd_t)
+	nis_initrc_domtrans(realmd_t)
+')
+
+optional_policy(`
+	gnome_read_generic_home_content(realmd_t)
+')
+
+optional_policy(`
+	samba_domtrans_net(realmd_t)
+	samba_manage_config(realmd_t)
+	samba_getattr_winbind_exec(realmd_t)
+')
+
+optional_policy(`
+	sssd_getattr_exec(realmd_t)
+	sssd_manage_config(realmd_t)
+	sssd_manage_lib_files(realmd_t)
+	sssd_manage_public_files(realmd_t)
+	sssd_read_pid_files(realmd_t)
+	sssd_initrc_domtrans(realmd_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/remotelogin.fc refpolicy/policy/modules/contrib/remotelogin.fc
--- refpolicy/policy/modules/contrib/remotelogin.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/remotelogin.fc	2012-10-24 17:01:23.922003106 +0200
@@ -1,2 +1 @@
-
 # Remote login currently has no file contexts.
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/remotelogin.if refpolicy/policy/modules/contrib/remotelogin.if
--- refpolicy/policy/modules/contrib/remotelogin.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/remotelogin.if	2012-10-24 17:02:04.819003193 +0200
@@ -1,4 +1,4 @@
-## <summary>Policy for rshd, rlogind, and telnetd.</summary>
+## <summary>Rshd, rlogind, and telnetd.</summary>
 
 ########################################
 ## <summary>
@@ -15,12 +15,13 @@
 		type remote_login_t;
 	')
 
+	corecmd_search_bin($1)
 	auth_domtrans_login_program($1, remote_login_t)
 ')
 
 ########################################
 ## <summary>
-##	allow Domain to signal remote login domain.
+##	Send generic signals to remote login.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -35,3 +36,44 @@
 
 	allow $1 remote_login_t:process signal;
 ')
+
+########################################
+## <summary>
+##	Create, read, write, and delete
+##	remote login temporary content.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`remotelogin_manage_tmp_content',`
+	gen_require(`
+		type remote_login_tmp_t;
+	')
+
+	files_search_tmp($1)
+	allow $1 remote_login_tmp_t:dir manage_dir_perms;
+	allow $1 remote_login_tmp_t:file manage_file_perms;
+')
+
+########################################
+## <summary>
+##	Relabel remote login temporary content.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`remotelogin_relabel_tmp_content',`
+	gen_require(`
+		type remote_login_tmp_t;
+	')
+
+	files_search_tmp($1)
+	allow $1 remote_login_tmp_t:dir relabel_dir_perms;
+	allow $1 remote_login_tmp_t:file relabel_file_perms;
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/remotelogin.te refpolicy/policy/modules/contrib/remotelogin.te
--- refpolicy/policy/modules/contrib/remotelogin.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/remotelogin.te	2012-10-24 17:02:04.820003193 +0200
@@ -1,4 +1,4 @@
-policy_module(remotelogin, 1.7.0)
+policy_module(remotelogin, 1.7.2)
 
 ########################################
 #
@@ -15,7 +15,7 @@
 
 ########################################
 #
-# Remote login remote policy
+# Local policy
 #
 
 allow remote_login_t self:capability { dac_override chown fowner fsetid kill setgid setuid net_bind_service sys_nice sys_resource sys_tty_config };
@@ -23,16 +23,8 @@
 allow remote_login_t self:process { setrlimit setexec };
 allow remote_login_t self:fd use;
 allow remote_login_t self:fifo_file rw_fifo_file_perms;
-allow remote_login_t self:sock_file read_sock_file_perms;
-allow remote_login_t self:unix_dgram_socket create_socket_perms;
-allow remote_login_t self:unix_stream_socket create_stream_socket_perms;
 allow remote_login_t self:unix_dgram_socket sendto;
-allow remote_login_t self:unix_stream_socket connectto;
-allow remote_login_t self:shm create_shm_perms;
-allow remote_login_t self:sem create_sem_perms;
-allow remote_login_t self:msgq create_msgq_perms;
-allow remote_login_t self:msg { send receive };
-allow remote_login_t self:key write;
+allow remote_login_t self:unix_stream_socket { accept connectto listen };
 
 manage_dirs_pattern(remote_login_t, remote_login_tmp_t, remote_login_tmp_t)
 manage_files_pattern(remote_login_t, remote_login_tmp_t, remote_login_tmp_t)
@@ -43,28 +35,23 @@
 
 dev_getattr_mouse_dev(remote_login_t)
 dev_setattr_mouse_dev(remote_login_t)
-dev_dontaudit_search_sysfs(remote_login_t)
 
 fs_getattr_xattr_fs(remote_login_t)
-fs_search_auto_mountpoints(remote_login_t)
 
 term_relabel_all_ptys(remote_login_t)
+term_use_all_ptys(remote_login_t)
+term_setattr_all_ptys(remote_login_t)
 
-auth_rw_login_records(remote_login_t)
-auth_rw_faillog(remote_login_t)
 auth_manage_pam_console_data(remote_login_t)
 auth_domtrans_pam_console(remote_login_t)
+auth_rw_login_records(remote_login_t)
+auth_rw_faillog(remote_login_t)
 
 corecmd_list_bin(remote_login_t)
 corecmd_read_bin_symlinks(remote_login_t)
-# cjp: these are probably not needed:
-corecmd_read_bin_files(remote_login_t)
-corecmd_read_bin_pipes(remote_login_t)
-corecmd_read_bin_sockets(remote_login_t)
 
 domain_read_all_entry_files(remote_login_t)
 
-files_read_etc_files(remote_login_t)
 files_read_etc_runtime_files(remote_login_t)
 files_list_home(remote_login_t)
 files_read_usr_files(remote_login_t)
@@ -74,23 +61,15 @@
 files_read_world_readable_pipes(remote_login_t)
 files_read_world_readable_sockets(remote_login_t)
 files_list_mnt(remote_login_t)
-# for when /var/mail is a sym-link
 files_read_var_symlinks(remote_login_t)
 
-sysnet_dns_name_resolve(remote_login_t)
-
 miscfiles_read_localization(remote_login_t)
 
 userdom_use_unpriv_users_fds(remote_login_t)
 userdom_search_user_home_content(remote_login_t)
-# Only permit unprivileged user domains to be entered via rlogin,
-# since very weak authentication is used.
 userdom_signal_unpriv_users(remote_login_t)
 userdom_spec_domtrans_unpriv_users(remote_login_t)
 
-# Search for mail spool file.
-mta_getattr_spool(remote_login_t)
-
 tunable_policy(`use_nfs_home_dirs',`
 	fs_read_nfs_files(remote_login_t)
 	fs_read_nfs_symlinks(remote_login_t)
@@ -106,15 +85,14 @@
 ')
 
 optional_policy(`
-	nis_use_ypbind(remote_login_t)
+	mta_getattr_spool(remote_login_t)
 ')
 
 optional_policy(`
-	nscd_socket_use(remote_login_t)
+	telnet_use_ptys(remote_login_t)
 ')
 
 optional_policy(`
-	unconfined_domain(remote_login_t)
 	unconfined_shell_domtrans(remote_login_t)
 ')
 
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/resmgr.fc refpolicy/policy/modules/contrib/resmgr.fc
--- refpolicy/policy/modules/contrib/resmgr.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/resmgr.fc	2012-10-24 17:01:36.925003134 +0200
@@ -1,7 +1,10 @@
-
 /etc/resmgr\.conf	--	gen_context(system_u:object_r:resmgrd_etc_t,s0)
 
-/sbin/resmgrd		--	gen_context(system_u:object_r:resmgrd_exec_t,s0)
+/etc/rc\.d/init\.d/resmgr	--	gen_context(system_u:object_r:resmgrd_initrc_exec_t,s0)
+
+/sbin/resmgrd	--	gen_context(system_u:object_r:resmgrd_exec_t,s0)
+
+/usr/sbin/resmgrd	--	gen_context(system_u:object_r:resmgrd_exec_t,s0)
 
-/var/run/\.resmgr_socket -s	gen_context(system_u:object_r:resmgrd_var_run_t,s0)
+/var/run/\.resmgr_socket	-s	gen_context(system_u:object_r:resmgrd_var_run_t,s0)
 /var/run/resmgr\.pid	--	gen_context(system_u:object_r:resmgrd_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/resmgr.if refpolicy/policy/modules/contrib/resmgr.if
--- refpolicy/policy/modules/contrib/resmgr.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/resmgr.if	2012-10-24 17:01:26.103003111 +0200
@@ -1,4 +1,4 @@
-## <summary>Resource management daemon</summary>
+## <summary>Resource management daemon.</summary>
 
 ########################################
 ## <summary>
@@ -16,7 +16,44 @@
 		type resmgrd_var_run_t, resmgrd_t;
 	')
 
-	allow $1 resmgrd_t:unix_stream_socket connectto;
-	allow $1 resmgrd_var_run_t:sock_file { getattr write };
 	files_search_pids($1)
+	stream_connect_pattern($1, resmgrd_var_run_t, resmgrd_var_run_t, resmgrd_t)
+')
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an resmgr environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`resmgr_admin',`
+	gen_require(`
+		type resmgrd_t, resmgrd_initrc_exec_t, resmgrd_var_run_t;
+		type resmgrd_etc_t;
+	')
+
+	allow $1 resmgrd_t:process { ptrace signal_perms };
+	ps_process_pattern($1, resmgrd_t)
+
+	init_labeled_script_domtrans($1, resmgrd_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 resmgrd_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	files_search_etc($1)
+	admin_pattern($1, resmgrd_etc_t)
+
+	files_search_pids($1)
+	admin_pattern($1, resmgrd_var_run_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/resmgr.te refpolicy/policy/modules/contrib/resmgr.te
--- refpolicy/policy/modules/contrib/resmgr.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/resmgr.te	2012-10-24 17:01:36.925003134 +0200
@@ -1,4 +1,4 @@
-policy_module(resmgr, 1.2.0)
+policy_module(resmgr, 1.2.2)
 
 ########################################
 #
@@ -9,6 +9,9 @@
 type resmgrd_exec_t;
 init_daemon_domain(resmgrd_t, resmgrd_exec_t)
 
+type resmgrd_initrc_exec_t;
+init_script_file(resmgrd_initrc_exec_t)
+
 type resmgrd_etc_t;
 files_config_file(resmgrd_etc_t)
 
@@ -25,7 +28,6 @@
 allow resmgrd_t self:process signal_perms;
 
 allow resmgrd_t resmgrd_etc_t:file read_file_perms;
-files_search_etc(resmgrd_t)
 
 allow resmgrd_t resmgrd_var_run_t:file manage_file_perms;
 allow resmgrd_t resmgrd_var_run_t:sock_file manage_sock_file_perms;
@@ -47,9 +49,8 @@
 storage_dontaudit_read_fixed_disk(resmgrd_t)
 storage_read_scsi_generic(resmgrd_t)
 storage_raw_read_removable_device(resmgrd_t)
-# not sure if it needs write access, needs to be investigated further...
-storage_write_scsi_generic(resmgrd_t)
 storage_raw_write_removable_device(resmgrd_t)
+storage_write_scsi_generic(resmgrd_t)
 
 logging_send_syslog_msg(resmgrd_t)
 
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/rgmanager.fc refpolicy/policy/modules/contrib/rgmanager.fc
--- refpolicy/policy/modules/contrib/rgmanager.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/rgmanager.fc	2012-10-24 17:01:29.142003118 +0200
@@ -1,7 +1,9 @@
-/usr/sbin/rgmanager			--	gen_context(system_u:object_r:rgmanager_exec_t,s0)
+/etc/rc\.d/init\.d/rgmanager	--	gen_context(system_u:object_r:rgmanager_initrc_exec_t,s0)
 
-/var/log/cluster/rgmanager\.log		--	gen_context(system_u:object_r:rgmanager_var_log_t,s0)
+/usr/sbin/rgmanager	--	gen_context(system_u:object_r:rgmanager_exec_t,s0)
 
-/var/run/cluster/rgmanager\.sk		-s	gen_context(system_u:object_r:rgmanager_var_run_t,s0)
+/var/log/cluster/rgmanager\.log.*	--	gen_context(system_u:object_r:rgmanager_var_log_t,s0)
 
-/var/run/rgmanager\.pid			--	gen_context(system_u:object_r:rgmanager_var_run_t,s0)
+/var/run/cluster/rgmanager\.sk	-s	gen_context(system_u:object_r:rgmanager_var_run_t,s0)
+
+/var/run/rgmanager\.pid	--	gen_context(system_u:object_r:rgmanager_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/rgmanager.if refpolicy/policy/modules/contrib/rgmanager.if
--- refpolicy/policy/modules/contrib/rgmanager.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/rgmanager.if	2012-10-24 17:01:29.142003118 +0200
@@ -1,4 +1,4 @@
-## <summary>rgmanager - Resource Group Manager</summary>
+## <summary>Resource Group Manager.</summary>
 
 #######################################
 ## <summary>
@@ -21,7 +21,8 @@
 
 ########################################
 ## <summary>
-##	Connect to rgmanager over an unix stream socket.
+##	Connect to rgmanager with a unix
+##	domain stream socket.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -40,7 +41,8 @@
 
 ######################################
 ## <summary>
-##	Allow manage rgmanager tmp files.
+##	Create, read, write, and delete
+##	rgmanager tmp files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -59,7 +61,8 @@
 
 ######################################
 ## <summary>
-##	Allow manage rgmanager tmpfs files.
+##	Create, read, write, and delete
+##	rgmanager tmpfs files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -75,3 +78,46 @@
 	fs_search_tmpfs($1)
 	manage_files_pattern($1, rgmanager_tmpfs_t, rgmanager_tmpfs_t)
 ')
+
+######################################
+## <summary>
+##	All of the rules required to
+##	administrate an rgmanager environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`rgmanager_admin',`
+	gen_require(`
+		type rgmanager_t, rgmanager_initrc_exec_t, rgmanager_tmp_t; 
+		type rgmanager_tmpfs_t, rgmanager_var_log_t, rgmanager_var_run_t;
+	')
+
+	allow $1 rgmanager_t:process { ptrace signal_perms };
+	ps_process_pattern($1, rgmanager_t)
+
+	init_labeled_script_domtrans($1, rgmanager_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 rgmanager_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	files_list_tmp($1)
+	admin_pattern($1, rgmanager_tmp_t)
+
+	admin_pattern($1, rgmanager_tmpfs_t)
+
+	logging_list_logs($1)
+	admin_pattern($1, rgmanager_var_log_t)
+
+	files_list_pids($1)
+	admin_pattern($1, rgmanager_var_run_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/rgmanager.te refpolicy/policy/modules/contrib/rgmanager.te
--- refpolicy/policy/modules/contrib/rgmanager.te	2012-07-25 20:33:05.000000000 +0200
+++ refpolicy/policy/modules/contrib/rgmanager.te	2012-10-24 17:01:29.154003118 +0200
@@ -1,4 +1,4 @@
-policy_module(rgmanager, 1.2.0)
+policy_module(rgmanager, 1.2.1)
 
 ########################################
 #
@@ -6,17 +6,20 @@
 #
 
 ## <desc>
-## <p>
-## Allow rgmanager domain to connect to the network using TCP.
-## </p>
+##	<p>
+##	Determine whether rgmanager can
+##	connect to the network using TCP.
+##	</p>
 ## </desc>
 gen_tunable(rgmanager_can_network_connect, false)
 
 type rgmanager_t;
 type rgmanager_exec_t;
-domain_type(rgmanager_t)
 init_daemon_domain(rgmanager_t, rgmanager_exec_t)
 
+type rgmanager_initrc_exec_t;
+init_script_file(rgmanager_initrc_exec_t)
+
 type rgmanager_tmp_t;
 files_tmp_file(rgmanager_tmp_t)
 
@@ -31,18 +34,14 @@
 
 ########################################
 #
-# rgmanager local policy
+# Local policy
 #
 
 allow rgmanager_t self:capability { dac_override net_raw sys_resource sys_admin sys_nice ipc_lock };
-dontaudit rgmanager_t self:capability { sys_ptrace };
 allow rgmanager_t self:process { setsched signal };
-dontaudit rgmanager_t self:process { ptrace };
-
 allow rgmanager_t self:fifo_file rw_fifo_file_perms;
-allow rgmanager_t self:unix_stream_socket { create_stream_socket_perms };
-allow rgmanager_t self:unix_dgram_socket create_socket_perms;
-allow rgmanager_t self:tcp_socket create_stream_socket_perms;
+allow rgmanager_t self:unix_stream_socket { accept listen };
+allow rgmanager_t self:tcp_socket { accept listen };
 
 manage_dirs_pattern(rgmanager_t, rgmanager_tmp_t, rgmanager_tmp_t)
 manage_files_pattern(rgmanager_t, rgmanager_tmp_t, rgmanager_tmp_t)
@@ -52,8 +51,8 @@
 manage_files_pattern(rgmanager_t, rgmanager_tmpfs_t, rgmanager_tmpfs_t)
 fs_tmpfs_filetrans(rgmanager_t, rgmanager_tmpfs_t, { dir file })
 
-manage_files_pattern(rgmanager_t, rgmanager_var_log_t, rgmanager_var_log_t)
-logging_log_filetrans(rgmanager_t, rgmanager_var_log_t, { file })
+allow rgmanager_t rgmanager_var_log_t:file { append_file_perms create_file_perms setattr_file_perms };
+logging_log_filetrans(rgmanager_t, rgmanager_var_log_t, file)
 
 manage_files_pattern(rgmanager_t, rgmanager_var_run_t, rgmanager_var_run_t)
 manage_sock_files_pattern(rgmanager_t, rgmanager_var_run_t, rgmanager_var_run_t)
@@ -65,11 +64,14 @@
 kernel_search_debugfs(rgmanager_t)
 kernel_search_network_state(rgmanager_t)
 
+corenet_all_recvfrom_unlabeled(rgmanager_t)
+corenet_all_recvfrom_netlabel(rgmanager_t)
+corenet_tcp_sendrecv_generic_if(rgmanager_t)
+corenet_tcp_sendrecv_generic_node(rgmanager_t)
+
 corecmd_exec_bin(rgmanager_t)
 corecmd_exec_shell(rgmanager_t)
-consoletype_exec(rgmanager_t)
 
-# need to write to /dev/misc/dlm-control
 dev_rw_dlm_control(rgmanager_t)
 dev_setattr_dlm_control(rgmanager_t)
 dev_search_sysfs(rgmanager_t)
@@ -82,33 +84,38 @@
 files_getattr_all_symlinks(rgmanager_t)
 files_manage_mnt_dirs(rgmanager_t)
 files_manage_isid_type_dirs(rgmanager_t)
+files_read_non_security_files(rgmanager_t)
 
-fs_getattr_xattr_fs(rgmanager_t)
 fs_getattr_all_fs(rgmanager_t)
 
-storage_getattr_fixed_disk_dev(rgmanager_t)
+storage_raw_read_fixed_disk(rgmanager_t)
 
 term_getattr_pty_fs(rgmanager_t)
-#term_use_ptmx(rgmanager_t)
 
-# needed by resources scripts
-files_read_non_auth_files(rgmanager_t)
 auth_dontaudit_getattr_shadow(rgmanager_t)
 auth_use_nsswitch(rgmanager_t)
 
+init_domtrans_script(rgmanager_t)
+
 logging_send_syslog_msg(rgmanager_t)
 
 miscfiles_read_localization(rgmanager_t)
 
-mount_domtrans(rgmanager_t)
-
 tunable_policy(`rgmanager_can_network_connect',`
+	corenet_sendrecv_all_client_packets(rgmanager_t)
 	corenet_tcp_connect_all_ports(rgmanager_t)
+	corenet_tcp_sendrecv_all_ports(rgmanager_t)
 ')
 
-# rgmanager can run resource scripts
 optional_policy(`
 	aisexec_stream_connect(rgmanager_t)
+')
+
+optional_policy(`
+	consoletype_exec(rgmanager_t)
+')
+
+optional_policy(`
 	corosync_stream_connect(rgmanager_t)
 ')
 
@@ -123,6 +130,7 @@
 
 optional_policy(`
 	rhcs_stream_connect_groupd(rgmanager_t)
+	rhcs_stream_connect_gfs_controld(rgmanager_t)
 ')
 
 optional_policy(`
@@ -132,7 +140,6 @@
 optional_policy(`
 	ccs_manage_config(rgmanager_t)
 	ccs_stream_connect(rgmanager_t)
-	rhcs_stream_connect_gfs_controld(rgmanager_t)
 ')
 
 optional_policy(`
@@ -140,6 +147,10 @@
 ')
 
 optional_policy(`
+	mount_domtrans(rgmanager_t)
+')
+
+optional_policy(`
 	mysql_domtrans_mysql_safe(rgmanager_t)
 	mysql_stream_connect(rgmanager_t)
 ')
@@ -163,16 +174,12 @@
 ')
 
 optional_policy(`
-	rpc_initrc_domtrans_nfsd(rgmanager_t)
-	rpc_initrc_domtrans_rpcd(rgmanager_t)
-
 	rpc_domtrans_nfsd(rgmanager_t)
 	rpc_domtrans_rpcd(rgmanager_t)
 	rpc_manage_nfs_state_data(rgmanager_t)
 ')
 
 optional_policy(`
-	samba_initrc_domtrans(rgmanager_t)
 	samba_domtrans_smbd(rgmanager_t)
 	samba_domtrans_nmbd(rgmanager_t)
 	samba_manage_var_files(rgmanager_t)
@@ -194,9 +201,5 @@
 ')
 
 optional_policy(`
-	unconfined_domain(rgmanager_t)
-')
-
-optional_policy(`
 	xen_domtrans_xm(rgmanager_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/rhcs.fc refpolicy/policy/modules/contrib/rhcs.fc
--- refpolicy/policy/modules/contrib/rhcs.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/rhcs.fc	2012-10-24 17:01:49.486003161 +0200
@@ -1,22 +1,29 @@
-/usr/sbin/dlm_controld			--	gen_context(system_u:object_r:dlm_controld_exec_t,s0)
-/usr/sbin/fenced			--	gen_context(system_u:object_r:fenced_exec_t,s0)
-/usr/sbin/fence_node			--	gen_context(system_u:object_r:fenced_exec_t,s0)
-/usr/sbin/gfs_controld			--	gen_context(system_u:object_r:gfs_controld_exec_t,s0)
-/usr/sbin/groupd			--	gen_context(system_u:object_r:groupd_exec_t,s0)
-/usr/sbin/qdiskd			--	gen_context(system_u:object_r:qdiskd_exec_t,s0)
+/etc/rc\.d/init\.d/dlm	--	gen_context(system_u:object_r:dlm_controld_initrc_exec_t,s0)
+/etc/rc\.d/init\.d/foghorn	--	gen_context(system_u:object_r:foghorn_initrc_exec_t,s0)
 
-/var/lock/fence_manual\.lock		--	gen_context(system_u:object_r:fenced_lock_t,s0)
+/usr/sbin/dlm_controld	--	gen_context(system_u:object_r:dlm_controld_exec_t,s0)
+/usr/sbin/fenced	--	gen_context(system_u:object_r:fenced_exec_t,s0)
+/usr/sbin/fence_node	--	gen_context(system_u:object_r:fenced_exec_t,s0)
+/usr/sbin/fence_tool	--	gen_context(system_u:object_r:fenced_exec_t,s0)
+/usr/sbin/foghorn	--	gen_context(system_u:object_r:foghorn_exec_t,s0)
+/usr/sbin/gfs_controld	--	gen_context(system_u:object_r:gfs_controld_exec_t,s0)
+/usr/sbin/groupd	--	gen_context(system_u:object_r:groupd_exec_t,s0)
+/usr/sbin/qdiskd	--	gen_context(system_u:object_r:qdiskd_exec_t,s0)
 
-/var/lib/qdiskd(/.*)?				gen_context(system_u:object_r:qdiskd_var_lib_t,s0)
+/var/lock/fence_manual\.lock	--	gen_context(system_u:object_r:fenced_lock_t,s0)
 
+/var/lib/qdiskd(/.*)?	gen_context(system_u:object_r:qdiskd_var_lib_t,s0)
+
+/var/log/cluster/.*\.*log	<<none>>
 /var/log/cluster/dlm_controld\.log.*	--	gen_context(system_u:object_r:dlm_controld_var_log_t,s0)
-/var/log/cluster/fenced\.log.*		--	gen_context(system_u:object_r:fenced_var_log_t,s0)
+/var/log/cluster/fenced\.log.*	--	gen_context(system_u:object_r:fenced_var_log_t,s0)
 /var/log/cluster/gfs_controld\.log.*	--	gen_context(system_u:object_r:gfs_controld_var_log_t,s0)
-/var/log/cluster/qdiskd\.log.*		--	gen_context(system_u:object_r:qdiskd_var_log_t,s0)
+/var/log/cluster/qdiskd\.log.*	--	gen_context(system_u:object_r:qdiskd_var_log_t,s0)
 
 /var/run/cluster/fenced_override	--	gen_context(system_u:object_r:fenced_var_run_t,s0)
-/var/run/dlm_controld\.pid		--	gen_context(system_u:object_r:dlm_controld_var_run_t,s0)
-/var/run/fenced\.pid			--	gen_context(system_u:object_r:fenced_var_run_t,s0)
-/var/run/gfs_controld\.pid		--	gen_context(system_u:object_r:gfs_controld_var_run_t,s0)
-/var/run/groupd\.pid			--	gen_context(system_u:object_r:groupd_var_run_t,s0)
-/var/run/qdiskd\.pid			--	gen_context(system_u:object_r:qdiskd_var_run_t,s0)
+/var/run/cluster/fence_scsi.*	--	gen_context(system_u:object_r:fenced_var_run_t,s0)
+/var/run/dlm_controld\.pid	--	gen_context(system_u:object_r:dlm_controld_var_run_t,s0)
+/var/run/fenced\.pid	--	gen_context(system_u:object_r:fenced_var_run_t,s0)
+/var/run/gfs_controld\.pid	--	gen_context(system_u:object_r:gfs_controld_var_run_t,s0)
+/var/run/groupd\.pid	--	gen_context(system_u:object_r:groupd_var_run_t,s0)
+/var/run/qdiskd\.pid	--	gen_context(system_u:object_r:qdiskd_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/rhcs.if refpolicy/policy/modules/contrib/rhcs.if
--- refpolicy/policy/modules/contrib/rhcs.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/rhcs.if	2012-10-24 17:01:49.502003161 +0200
@@ -1,19 +1,19 @@
-## <summary>RHCS - Red Hat Cluster Suite</summary>
+## <summary>Red Hat Cluster Suite.</summary>
 
 #######################################
 ## <summary>
-##	Creates types and rules for a basic
-##	rhcs init daemon domain.
+##	The template to define a rhcs domain.
 ## </summary>
-## <param name="prefix">
+## <param name="domain_prefix">
 ##	<summary>
-##	Prefix for the domain.
+##	Domain prefix to be used.
 ##	</summary>
 ## </param>
 #
 template(`rhcs_domain_template',`
 	gen_require(`
-		attribute cluster_domain;
+		attribute cluster_domain, cluster_pid, cluster_tmpfs;
+		attribute cluster_log;
 	')
 
 	##############################
@@ -25,13 +25,13 @@
 	type $1_exec_t;
 	init_daemon_domain($1_t, $1_exec_t)
 
-	type $1_tmpfs_t;
+	type $1_tmpfs_t, cluster_tmpfs;
 	files_tmpfs_file($1_tmpfs_t)
 
-	type $1_var_log_t;
+	type $1_var_log_t, cluster_log;
 	logging_log_file($1_var_log_t)
 
-	type $1_var_run_t;
+	type $1_var_run_t, cluster_pid;
 	files_pid_file($1_var_run_t)
 
 	##############################
@@ -43,20 +43,26 @@
 	manage_files_pattern($1_t, $1_tmpfs_t, $1_tmpfs_t)
 	fs_tmpfs_filetrans($1_t, $1_tmpfs_t, { dir file })
 
-	manage_files_pattern($1_t, $1_var_log_t, $1_var_log_t)
+	append_files_pattern($1_t, $1_var_log_t, $1_var_log_t)
+	create_files_pattern($1_t, $1_var_log_t, $1_var_log_t)
+	setattr_files_pattern($1_t, $1_var_log_t, $1_var_log_t)
 	manage_sock_files_pattern($1_t, $1_var_log_t, $1_var_log_t)
 	logging_log_filetrans($1_t, $1_var_log_t, { file sock_file })
 
 	manage_files_pattern($1_t, $1_var_run_t, $1_var_run_t)
 	manage_fifo_files_pattern($1_t, $1_var_run_t, $1_var_run_t)
 	manage_sock_files_pattern($1_t, $1_var_run_t, $1_var_run_t)
-	files_pid_filetrans($1_t, $1_var_run_t, { file fifo_file })
+	files_pid_filetrans($1_t, $1_var_run_t, { dir file fifo_file })
 
+	optional_policy(`
+		dbus_system_bus_client($1_t)
+	')
 ')
 
 ######################################
 ## <summary>
-##	Execute a domain transition to run dlm_controld.
+##	Execute a domain transition to
+##	run dlm_controld.
 ## </summary>
 ## <param name="domain">
 ## <summary>
@@ -75,8 +81,27 @@
 
 #####################################
 ## <summary>
-##	Connect to dlm_controld over a unix domain
-##	stream socket.
+##	Get attributes of fenced
+##	executable files.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`rhcs_getattr_fenced_exec_files',`
+	gen_require(`
+		type fenced_exec_t;
+	')
+
+	allow $1 fenced_exec_t:file getattr_file_perms;
+')
+
+#####################################
+## <summary>
+##	Connect to dlm_controld with a
+##	unix domain stream socket.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -95,7 +120,7 @@
 
 #####################################
 ## <summary>
-##	Allow read and write access to dlm_controld semaphores.
+##	Read and write dlm_controld semaphores.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -135,7 +160,7 @@
 
 ######################################
 ## <summary>
-##	Allow read and write access to fenced semaphores.
+##	Read and write fenced semaphores.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -154,9 +179,30 @@
 	manage_files_pattern($1, fenced_tmpfs_t, fenced_tmpfs_t)
 ')
 
+####################################
+## <summary>
+##	Connect to all cluster domains
+##	with a unix domain stream socket.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`rhcs_stream_connect_cluster',`
+	gen_require(`
+		attribute cluster_domain, cluster_pid;
+	')
+
+	files_search_pids($1)
+	stream_connect_pattern($1, cluster_pid, cluster_pid, cluster_domain)
+')
+
 ######################################
 ## <summary>
-##	Connect to fenced over an unix domain stream socket.
+##	Connect to fenced with an unix
+##	domain stream socket.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -169,14 +215,14 @@
 		type fenced_var_run_t, fenced_t;
 	')
 
-	allow $1 fenced_t:unix_stream_socket connectto;
-	allow $1 fenced_var_run_t:sock_file { getattr write };
 	files_search_pids($1)
+	stream_connect_pattern($1, fenced_var_run_t, fenced_var_run_t, fenced_t)
 ')
 
 #####################################
 ## <summary>
-##	Execute a domain transition to run gfs_controld.
+##	Execute a domain transition
+##	to run gfs_controld.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -195,7 +241,7 @@
 
 ####################################
 ## <summary>
-##	Allow read and write access to gfs_controld semaphores.
+##	Read and write gfs_controld semaphores.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -216,7 +262,7 @@
 
 ########################################
 ## <summary>
-##	Read and write to gfs_controld_t shared memory.
+##	Read and write gfs_controld_t shared memory.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -237,7 +283,8 @@
 
 #####################################
 ## <summary>
-##	Connect to gfs_controld_t over an unix domain stream socket.
+##	Connect to gfs_controld_t with
+##	a unix domain stream socket.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -275,8 +322,8 @@
 
 #####################################
 ## <summary>
-##	Connect to groupd over a unix domain
-##	stream socket.
+##	Connect to groupd with a unix
+##	domain stream socket.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -293,9 +340,50 @@
 	stream_connect_pattern($1, groupd_var_run_t, groupd_var_run_t, groupd_t)
 ')
 
+########################################
+## <summary>
+##	Read and write all cluster domains
+##	shared memory.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`rhcs_rw_cluster_shm',`
+	gen_require(`
+		attribute cluster_domain, cluster_tmpfs;
+	')
+
+	allow $1 cluster_domain:shm { rw_shm_perms destroy };
+
+	fs_search_tmpfs($1)
+	manage_files_pattern($1, cluster_tmpfs, cluster_tmpfs)
+')
+
+####################################
+## <summary>
+##	Read and write all cluster
+##	domains semaphores.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`rhcs_rw_cluster_semaphores',`
+	gen_require(`
+		attribute cluster_domain;
+	')
+
+	allow $1 cluster_domain:sem { rw_sem_perms destroy };
+')
+
 #####################################
 ## <summary>
-##	Allow read and write access to groupd semaphores.
+##	Read and write groupd semaphores.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -316,7 +404,7 @@
 
 ########################################
 ## <summary>
-##	Read and write to group shared memory.
+##	Read and write groupd shared memory.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -353,3 +441,55 @@
 	corecmd_search_bin($1)
 	domtrans_pattern($1, qdiskd_exec_t, qdiskd_t)
 ')
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an rhcs environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`rhcs_admin',`
+	gen_require(`
+		attribute cluster_domain, cluster_pid, cluster_tmpfs;
+		attribute cluster_log;
+		type dlm_controld_initrc_exec_t, foghorn_initrc_exec_t, fenced_lock_t;
+		type fenced_tmp_t, qdiskd_var_lib_t;
+	')
+
+	allow $1 cluster_domain:process { ptrace signal_perms };
+	ps_process_pattern($1, cluster_domain)
+
+	init_labeled_script_domtrans($1, { dlm_controld_initrc_exec_t foghorn_initrc_exec_t })
+	domain_system_change_exemption($1)
+	role_transition $2 { dlm_controld_initrc_exec_t foghorn_initrc_exec_t } system_r;
+	allow $2 system_r;
+
+	files_search_pids($1)
+	admin_pattern($1, cluster_pid)
+
+	files_search_locks($1)
+	admin_pattern($1, fenced_lock_t)
+
+	files_search_tmp($1)
+	admin_pattern($1, fenced_tmp_t)
+
+	files_search_var_lib($1)
+	admin_pattern($1, qdiskd_var_lib_t)
+
+	fs_search_tmpfs($1)
+	admin_pattern($1, cluster_tmpfs)
+
+	logging_search_logs($1)
+	admin_pattern($1, cluster_log)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/rhcs.te refpolicy/policy/modules/contrib/rhcs.te
--- refpolicy/policy/modules/contrib/rhcs.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/rhcs.te	2012-10-24 17:01:49.503003161 +0200
@@ -1,4 +1,4 @@
-policy_module(rhcs, 1.1.0)
+policy_module(rhcs, 1.1.3)
 
 ########################################
 #
@@ -6,16 +6,30 @@
 #
 
 ## <desc>
-## <p>
-## Allow fenced domain to connect to the network using TCP.
-## </p>
+##	<p>
+##	Determine whether fenced can
+##	connect to the TCP network.
+##	</p>
 ## </desc>
 gen_tunable(fenced_can_network_connect, false)
 
+## <desc>
+##	<p>
+##	Determine whether fenced can use ssh.
+##	</p>
+## </desc>
+gen_tunable(fenced_can_ssh, false)
+
 attribute cluster_domain;
+attribute cluster_log;
+attribute cluster_pid;
+attribute cluster_tmpfs;
 
 rhcs_domain_template(dlm_controld)
 
+type dlm_controld_initrc_exec_t;
+init_script_file(dlm_controld_initrc_exec_t)
+
 rhcs_domain_template(fenced)
 
 type fenced_lock_t;
@@ -24,10 +38,13 @@
 type fenced_tmp_t;
 files_tmp_file(fenced_tmp_t)
 
-rhcs_domain_template(gfs_controld)
+rhcs_domain_template(foghorn)
 
-rhcs_domain_template(groupd)
+type foghorn_initrc_exec_t;
+init_script_file(foghorn_initrc_exec_t)
 
+rhcs_domain_template(gfs_controld)
+rhcs_domain_template(groupd)
 rhcs_domain_template(qdiskd)
 
 type qdiskd_var_lib_t;
@@ -35,17 +52,43 @@
 
 #####################################
 #
+# Common cluster domains local policy
+#
+
+allow cluster_domain self:capability sys_nice;
+allow cluster_domain self:process setsched;
+allow cluster_domain self:sem create_sem_perms;
+allow cluster_domain self:fifo_file rw_fifo_file_perms;
+allow cluster_domain self:unix_stream_socket create_stream_socket_perms;
+allow cluster_domain self:unix_dgram_socket create_socket_perms;
+
+logging_send_syslog_msg(cluster_domain)
+
+miscfiles_read_localization(cluster_domain)
+
+optional_policy(`
+	ccs_stream_connect(cluster_domain)
+')
+
+optional_policy(`
+	corosync_stream_connect(cluster_domain)
+')
+
+#####################################
+#
 # dlm_controld local policy
 #
 
 allow dlm_controld_t self:capability { net_admin sys_admin sys_resource };
-
 allow dlm_controld_t self:netlink_kobject_uevent_socket create_socket_perms;
 
 stream_connect_pattern(dlm_controld_t, fenced_var_run_t, fenced_var_run_t, fenced_t)
 stream_connect_pattern(dlm_controld_t, groupd_var_run_t, groupd_var_run_t, groupd_t)
 
 kernel_read_system_state(dlm_controld_t)
+kernel_rw_net_sysctls(dlm_controld_t)
+
+corecmd_exec_bin(dlm_controld_t)
 
 dev_rw_dlm_control(dlm_controld_t)
 dev_rw_sysfs(dlm_controld_t)
@@ -55,22 +98,15 @@
 
 init_rw_script_tmp_files(dlm_controld_t)
 
-optional_policy(`
-	ccs_stream_connect(dlm_controld_t)
-')
-
 #######################################
 #
 # fenced local policy
 #
 
 allow fenced_t self:capability { sys_rawio sys_resource };
-allow fenced_t self:process getsched;
-
-allow fenced_t self:tcp_socket create_stream_socket_perms;
-allow fenced_t self:udp_socket create_socket_perms;
-
-can_exec(fenced_t, fenced_exec_t)
+allow fenced_t self:process { getsched signal_perms };
+allow fenced_t self:tcp_socket { accept listen };
+allow fenced_t self:unix_stream_socket connectto;
 
 manage_files_pattern(fenced_t, fenced_lock_t, fenced_lock_t)
 files_lock_filetrans(fenced_t, fenced_lock_t, file)
@@ -82,13 +118,38 @@
 
 stream_connect_pattern(fenced_t, groupd_var_run_t, groupd_var_run_t, groupd_t)
 
+can_exec(fenced_t, fenced_exec_t)
+
+kernel_read_system_state(fenced_t)
+
 corecmd_exec_bin(fenced_t)
+corecmd_exec_shell(fenced_t)
+
+corenet_all_recvfrom_unlabeled(fenced_t)
+corenet_all_recvfrom_netlabel(fenced_t)
+corenet_tcp_sendrecv_generic_if(fenced_t)
+corenet_udp_sendrecv_generic_if(fenced_t)
+corenet_tcp_sendrecv_generic_node(fenced_t)
+corenet_udp_sendrecv_generic_node(fenced_t)
+corenet_tcp_bind_generic_node(fenced_t)
+corenet_udp_bind_generic_node(fenced_t)
+
+corenet_sendrecv_ionixnetmon_server_packets(fenced_t)
+corenet_udp_bind_ionixnetmon_port(fenced_t)
+corenet_udp_sendrecv_ionixnetmon_port(fenced_t)
+
+corenet_sendrecv_zented_server_packets(fenced_t)
+corenet_tcp_bind_zented_port(fenced_t)
+corenet_tcp_sendrecv_zented_port(fenced_t)
 
+corenet_sendrecv_http_client_packets(fenced_t)
 corenet_tcp_connect_http_port(fenced_t)
+corenet_tcp_sendrecv_http_port(fenced_t)
 
 dev_read_sysfs(fenced_t)
 dev_read_urand(fenced_t)
 
+files_read_usr_files(fenced_t)
 files_read_usr_symlinks(fenced_t)
 
 storage_raw_read_fixed_disk(fenced_t)
@@ -96,17 +157,40 @@
 storage_raw_read_removable_device(fenced_t)
 
 term_getattr_pty_fs(fenced_t)
+term_use_generic_ptys(fenced_t)
 term_use_ptmx(fenced_t)
 
 auth_use_nsswitch(fenced_t)
 
 tunable_policy(`fenced_can_network_connect',`
+	corenet_sendrecv_all_client_packets(fenced_t)
 	corenet_tcp_connect_all_ports(fenced_t)
+	corenet_tcp_sendrecv_all_ports(fenced_t)
+')
+
+optional_policy(`
+	tunable_policy(`fenced_can_ssh',`
+		allow fenced_t self:capability { setuid setgid };
+
+		corenet_sendrecv_ssh_client_packets(fenced_t)
+		corenet_tcp_connect_ssh_port(fenced_t)
+		corenet_tcp_sendrecv_ssh_port(fenced_t)
+
+		ssh_exec(fenced_t)
+		ssh_read_user_home_files(fenced_t)
+	')
+')
+
+optional_policy(`
+	corosync_exec(fenced_t)
 ')
 
 optional_policy(`
 	ccs_read_config(fenced_t)
-	ccs_stream_connect(fenced_t)
+')
+
+optional_policy(`
+	gnome_read_generic_home_content(fenced_t)
 ')
 
 optional_policy(`
@@ -114,13 +198,48 @@
 	lvm_read_config(fenced_t)
 ')
 
+optional_policy(`
+	snmp_manage_var_lib_files(fenced_t)
+	snmp_manage_var_lib_dirs(fenced_t)
+')
+
+#######################################
+#
+# foghorn local policy
+#
+
+allow foghorn_t self:process signal;
+allow foghorn_t self:tcp_socket create_stream_socket_perms;
+allow foghorn_t self:udp_socket create_socket_perms;
+
+corenet_all_recvfrom_unlabeled(foghorn_t)
+corenet_all_recvfrom_netlabel(foghorn_t)
+corenet_tcp_sendrecv_generic_if(foghorn_t)
+corenet_tcp_sendrecv_generic_node(foghorn_t)
+
+corenet_sendrecv_agentx_client_packets(foghorn_t)
+corenet_tcp_connect_agentx_port(foghorn_t)
+corenet_tcp_sendrecv_agentx_port(foghorn_t)
+
+dev_read_urand(foghorn_t)
+
+files_read_usr_files(foghorn_t)
+
+optional_policy(`
+	dbus_connect_system_bus(foghorn_t)
+')
+
+optional_policy(`
+	snmp_read_snmp_var_lib_files(foghorn_t)
+	snmp_stream_connect(foghorn_t)
+')
+
 ######################################
 #
 # gfs_controld local policy
 #
 
 allow gfs_controld_t self:capability { net_admin sys_resource };
-
 allow gfs_controld_t self:shm create_shm_perms;
 allow gfs_controld_t self:netlink_kobject_uevent_socket create_socket_perms;
 
@@ -139,10 +258,6 @@
 init_rw_script_tmp_files(gfs_controld_t)
 
 optional_policy(`
-	ccs_stream_connect(gfs_controld_t)
-')
-
-optional_policy(`
 	lvm_exec(gfs_controld_t)
 	dev_rw_lvm_control(gfs_controld_t)
 ')
@@ -154,9 +269,10 @@
 
 allow groupd_t self:capability { sys_nice sys_resource };
 allow groupd_t self:process setsched;
-
 allow groupd_t self:shm create_shm_perms;
 
+domtrans_pattern(groupd_t, fenced_exec_t, fenced_t)
+
 dev_list_sysfs(groupd_t)
 
 files_read_etc_files(groupd_t)
@@ -168,10 +284,8 @@
 # qdiskd local policy
 #
 
-allow qdiskd_t self:capability ipc_lock;
-
-allow qdiskd_t self:tcp_socket create_stream_socket_perms;
-allow qdiskd_t self:udp_socket create_socket_perms;
+allow qdiskd_t self:capability { ipc_lock sys_boot };
+allow qdiskd_t self:tcp_socket { accept listen };
 
 manage_files_pattern(qdiskd_t, qdiskd_var_lib_t, qdiskd_var_lib_t)
 manage_dirs_pattern(qdiskd_t, qdiskd_var_lib_t, qdiskd_var_lib_t)
@@ -182,7 +296,7 @@
 kernel_read_software_raid_state(qdiskd_t)
 kernel_getattr_core_if(qdiskd_t)
 
-corecmd_getattr_bin_files(qdiskd_t)
+corecmd_exec_bin(qdiskd_t)
 corecmd_exec_shell(qdiskd_t)
 
 dev_read_sysfs(qdiskd_t)
@@ -197,7 +311,8 @@
 
 files_dontaudit_getattr_all_sockets(qdiskd_t)
 files_dontaudit_getattr_all_pipes(qdiskd_t)
-files_read_etc_files(qdiskd_t)
+
+fs_list_hugetlbfs(qdiskd_t)
 
 storage_raw_read_removable_device(qdiskd_t)
 storage_raw_write_removable_device(qdiskd_t)
@@ -207,34 +322,9 @@
 auth_use_nsswitch(qdiskd_t)
 
 optional_policy(`
-	ccs_stream_connect(qdiskd_t)
-')
-
-optional_policy(`
 	netutils_domtrans_ping(qdiskd_t)
 ')
 
 optional_policy(`
 	udev_read_db(qdiskd_t)
 ')
-
-#####################################
-#
-# rhcs domains common policy
-#
-
-allow cluster_domain self:capability { sys_nice };
-allow cluster_domain self:process setsched;
-
-allow cluster_domain self:sem create_sem_perms;
-allow cluster_domain self:fifo_file rw_fifo_file_perms;
-allow cluster_domain self:unix_stream_socket create_stream_socket_perms;
-allow cluster_domain self:unix_dgram_socket create_socket_perms;
-
-logging_send_syslog_msg(cluster_domain)
-
-miscfiles_read_localization(cluster_domain)
-
-optional_policy(`
-	corosync_stream_connect(cluster_domain)
-')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/rhgb.fc refpolicy/policy/modules/contrib/rhgb.fc
--- refpolicy/policy/modules/contrib/rhgb.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/rhgb.fc	2012-10-24 17:01:52.858003168 +0200
@@ -1,4 +1 @@
-#
-# /usr
-#
-/usr/bin/rhgb		--	gen_context(system_u:object_r:rhgb_exec_t,s0)
+/usr/bin/rhgb	--	gen_context(system_u:object_r:rhgb_exec_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/rhgb.if refpolicy/policy/modules/contrib/rhgb.if
--- refpolicy/policy/modules/contrib/rhgb.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/rhgb.if	2012-10-24 17:01:52.858003168 +0200
@@ -1,4 +1,4 @@
-## <summary> Red Hat Graphical Boot </summary>
+## <summary> Red Hat Graphical Boot.</summary>
 
 ########################################
 ## <summary>
@@ -18,7 +18,7 @@
 
 ########################################
 ## <summary>
-##	Use a rhgb file descriptor.
+##	Inherit and use rhgb file descriptors.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -54,7 +54,7 @@
 
 ########################################
 ## <summary>
-##	Send a signal to rhgb.
+##	Send generic signals to rhgb.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -72,7 +72,8 @@
 
 ########################################
 ## <summary>
-##	Read and write to unix stream sockets.
+##	Read and write inherited rhgb unix
+##	domain stream sockets.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -109,7 +110,8 @@
 
 ########################################
 ## <summary>
-##	Connected to rhgb unix stream socket.
+##	Connected to rhgb with a unix
+##	domain stream socket.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -119,10 +121,11 @@
 #
 interface(`rhgb_stream_connect',`
 	gen_require(`
-		type rhgb_t;
+		type rhgb_t, rhgb_tmpfs_t;
 	')
 
-	allow $1 rhgb_t:unix_stream_socket connectto;
+	fs_search_tmpfs($1)
+	stream_connect_pattern($1, rhgb_tmpfs_t, rhgb_tmpfs_t, rhgb_t)
 ')
 
 ########################################
@@ -145,7 +148,7 @@
 
 ########################################
 ## <summary>
-##	Read from and write to the rhgb devpts.
+##	Read and write rhgb pty devices.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -158,12 +161,14 @@
 		type rhgb_devpts_t;
 	')
 
+	dev_list_all_dev_nodes($1)
 	allow $1 rhgb_devpts_t:chr_file rw_term_perms;
 ')
 
 ########################################
 ## <summary>
-##	dontaudit Read from and write to the rhgb devpts.
+##	Do not audit attempts to read and
+##	write rhgb pty devices.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -181,7 +186,7 @@
 
 ########################################
 ## <summary>
-##	Read and write to rhgb temporary file system.
+##	Read and write to rhgb tmpfs files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -194,5 +199,7 @@
 		type rhgb_tmpfs_t;
 	')
 
+
+	fs_search_tmpfs($1)
 	allow $1 rhgb_tmpfs_t:file rw_file_perms;
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/rhgb.te refpolicy/policy/modules/contrib/rhgb.te
--- refpolicy/policy/modules/contrib/rhgb.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/rhgb.te	2012-10-24 17:01:52.859003168 +0200
@@ -24,13 +24,10 @@
 dontaudit rhgb_t self:capability sys_tty_config;
 allow rhgb_t self:process { setpgid signal_perms };
 allow rhgb_t self:shm create_shm_perms;
-allow rhgb_t self:unix_stream_socket create_stream_socket_perms;
+allow rhgb_t self:unix_stream_socket { accept listen };
 allow rhgb_t self:fifo_file rw_fifo_file_perms;
-allow rhgb_t self:tcp_socket create_socket_perms;
-allow rhgb_t self:udp_socket create_socket_perms;
-allow rhgb_t self:netlink_route_socket r_netlink_socket_perms;
 
-allow rhgb_t rhgb_devpts_t:chr_file { rw_chr_file_perms setattr };
+allow rhgb_t rhgb_devpts_t:chr_file { rw_chr_file_perms setattr_chr_file_perms };
 term_create_pty(rhgb_t, rhgb_devpts_t)
 
 manage_dirs_pattern(rhgb_t, rhgb_tmpfs_t, rhgb_tmpfs_t)
@@ -49,13 +46,11 @@
 corenet_all_recvfrom_unlabeled(rhgb_t)
 corenet_all_recvfrom_netlabel(rhgb_t)
 corenet_tcp_sendrecv_generic_if(rhgb_t)
-corenet_udp_sendrecv_generic_if(rhgb_t)
 corenet_tcp_sendrecv_generic_node(rhgb_t)
-corenet_udp_sendrecv_generic_node(rhgb_t)
 corenet_tcp_sendrecv_all_ports(rhgb_t)
-corenet_udp_sendrecv_all_ports(rhgb_t)
-corenet_tcp_connect_all_ports(rhgb_t)
+
 corenet_sendrecv_all_client_packets(rhgb_t)
+corenet_tcp_connect_all_ports(rhgb_t)
 
 dev_read_sysfs(rhgb_t)
 dev_read_urand(rhgb_t)
@@ -71,14 +66,12 @@
 files_dontaudit_rw_root_dir(rhgb_t)
 files_dontaudit_read_default_files(rhgb_t)
 files_dontaudit_search_pids(rhgb_t)
-# for nscd
 files_dontaudit_search_var(rhgb_t)
 
 fs_search_auto_mountpoints(rhgb_t)
 fs_mount_ramfs(rhgb_t)
 fs_unmount_ramfs(rhgb_t)
 fs_getattr_tmpfs(rhgb_t)
-# for ramfs file systems
 fs_manage_ramfs_dirs(rhgb_t)
 fs_manage_ramfs_files(rhgb_t)
 fs_manage_ramfs_pipes(rhgb_t)
@@ -92,7 +85,6 @@
 
 init_write_initctl(rhgb_t)
 
-# for localization
 libs_read_lib_files(rhgb_t)
 
 logging_send_syslog_msg(rhgb_t)
@@ -104,7 +96,7 @@
 seutil_search_default_contexts(rhgb_t)
 seutil_read_config(rhgb_t)
 
-sysnet_read_config(rhgb_t)
+sysnet_dns_name_resolve(rhgb_t)
 sysnet_domtrans_ifconfig(rhgb_t)
 
 userdom_dontaudit_use_unpriv_user_fds(rhgb_t)
@@ -112,7 +104,6 @@
 
 xserver_read_tmp_files(rhgb_t)
 xserver_kill(rhgb_t)
-# for running setxkbmap
 xserver_read_xkb_libs(rhgb_t)
 xserver_domtrans(rhgb_t)
 xserver_signal(rhgb_t)
@@ -134,9 +125,3 @@
 optional_policy(`
 	udev_read_db(rhgb_t)
 ')
-
-ifdef(`TODO',`
-	#this seems a bit much
-	allow domain rhgb_devpts_t:chr_file { read write };
-	allow initrc_t rhgb_gph_t:fd use;
-')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/rhsmcertd.fc refpolicy/policy/modules/contrib/rhsmcertd.fc
--- refpolicy/policy/modules/contrib/rhsmcertd.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/rhsmcertd.fc	2012-10-24 17:01:54.853003172 +0200
@@ -1,11 +1,11 @@
 /etc/rc\.d/init\.d/rhsmcertd	--	gen_context(system_u:object_r:rhsmcertd_initrc_exec_t,s0)
 
-/usr/bin/rhsmcertd		--	gen_context(system_u:object_r:rhsmcertd_exec_t,s0)
+/usr/bin/rhsmcertd	--	gen_context(system_u:object_r:rhsmcertd_exec_t,s0)
 
-/var/lib/rhsm(/.*)?			gen_context(system_u:object_r:rhsmcertd_var_lib_t,s0)
+/var/lib/rhsm(/.*)?	gen_context(system_u:object_r:rhsmcertd_var_lib_t,s0)
 
 /var/lock/subsys/rhsmcertd	--	gen_context(system_u:object_r:rhsmcertd_lock_t,s0)
 
-/var/log/rhsm(/.*)?			gen_context(system_u:object_r:rhsmcertd_log_t,s0)
+/var/log/rhsm(/.*)?	gen_context(system_u:object_r:rhsmcertd_log_t,s0)
 
-/var/run/rhsm(/.*)?			gen_context(system_u:object_r:rhsmcertd_var_run_t,s0)
+/var/run/rhsm(/.*)?	gen_context(system_u:object_r:rhsmcertd_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/rhsmcertd.if refpolicy/policy/modules/contrib/rhsmcertd.if
--- refpolicy/policy/modules/contrib/rhsmcertd.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/rhsmcertd.if	2012-10-24 17:01:56.180003175 +0200
@@ -1,8 +1,8 @@
-## <summary>Subscription Management Certificate Daemon policy</summary>
+## <summary>Subscription Management Certificate Daemon.</summary>
 
 ########################################
 ## <summary>
-##	Transition to rhsmcertd.
+##	Execute rhsmcertd in the rhsmcertd domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -21,11 +21,12 @@
 
 ########################################
 ## <summary>
-##	Execute rhsmcertd server in the rhsmcertd domain.
+##	Execute rhsmcertd init scripts
+##	in the initrc domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
-##	Domain allowed access.
+##	Domain allowed to transition.
 ##	</summary>
 ## </param>
 #
@@ -39,7 +40,7 @@
 
 ########################################
 ## <summary>
-##	Read rhsmcertd's log files.
+##	Read rhsmcertd log files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -59,7 +60,7 @@
 
 ########################################
 ## <summary>
-##	Append to rhsmcertd log files.
+##	Append rhsmcertd log files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -78,7 +79,8 @@
 
 ########################################
 ## <summary>
-##	Manage rhsmcertd log files
+##	Create, read, write, and delete
+##	rhsmcertd log files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -112,8 +114,8 @@
 		type rhsmcertd_var_lib_t;
 	')
 
-	allow $1 rhsmcertd_var_lib_t:dir search_dir_perms;
 	files_search_var_lib($1)
+	allow $1 rhsmcertd_var_lib_t:dir search_dir_perms;
 ')
 
 ########################################
@@ -137,7 +139,8 @@
 
 ########################################
 ## <summary>
-##	Manage rhsmcertd lib files.
+##	Create, read, write, and delete
+##	rhsmcertd lib files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -156,7 +159,8 @@
 
 ########################################
 ## <summary>
-##	Manage rhsmcertd lib directories.
+##	Create, read, write, and delete
+##	rhsmcertd lib directories.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -175,7 +179,7 @@
 
 ########################################
 ## <summary>
-##	Read rhsmcertd PID files.
+##	Read rhsmcertd pid files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -194,8 +198,8 @@
 
 ####################################
 ## <summary>
-##	Connect to rhsmcertd over a unix domain
-##	stream socket.
+##	Connect to rhsmcertd with a
+##	unix domain stream socket.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -235,12 +239,13 @@
 
 ######################################
 ## <summary>
-##	Dontaudit Send and receive messages from
+##	Do not audit attempts to send
+##	and receive messages from
 ##	rhsmcertd over dbus.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
-##	Domain allowed access.
+##	Domain to not audit.
 ##	</summary>
 ## </param>
 #
@@ -256,8 +261,8 @@
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate
-##	an rhsmcertd environment
+##	All of the rules required to
+##	administrate an rhsmcertd environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -274,10 +279,10 @@
 interface(`rhsmcertd_admin',`
 	gen_require(`
 		type rhsmcertd_t, rhsmcertd_initrc_exec_t, rhsmcertd_log_t;
-		type rhsmcertd_var_lib_t, rhsmcertd_var_run_t;
+		type rhsmcertd_var_lib_t, rhsmcertd_var_run_t, rhsmcertd_lock_t;
 	')
 
-	allow $1 rhsmcertd_t:process signal_perms;
+	allow $1 rhsmcertd_t:process { ptrace signal_perms };
 	ps_process_pattern($1, rhsmcertd_t)
 
 	rhsmcertd_initrc_domtrans($1)
@@ -293,4 +298,7 @@
 
 	files_search_pids($1)
 	admin_pattern($1, rhsmcertd_var_run_t)
+
+	files_search_locks($1)
+	admin_pattern($1, rhsmcertd_lock_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/rhsmcertd.te refpolicy/policy/modules/contrib/rhsmcertd.te
--- refpolicy/policy/modules/contrib/rhsmcertd.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/rhsmcertd.te	2012-10-24 17:01:56.181003175 +0200
@@ -1,4 +1,4 @@
-policy_module(rhsmcertd, 1.0.0)
+policy_module(rhsmcertd, 1.0.1)
 
 ########################################
 #
@@ -26,14 +26,18 @@
 
 ########################################
 #
-# rhsmcertd local policy
+# Local policy
 #
 
+allow rhsmcertd_t self:capability sys_nice;
+allow rhsmcertd_t self:process { signal setsched };
 allow rhsmcertd_t self:fifo_file rw_fifo_file_perms;
 allow rhsmcertd_t self:unix_stream_socket create_stream_socket_perms;
 
 manage_dirs_pattern(rhsmcertd_t, rhsmcertd_log_t, rhsmcertd_log_t)
-manage_files_pattern(rhsmcertd_t, rhsmcertd_log_t, rhsmcertd_log_t)
+append_files_pattern(rhsmcertd_t, rhsmcertd_log_t, rhsmcertd_log_t)
+create_files_pattern(rhsmcertd_t, rhsmcertd_log_t, rhsmcertd_log_t)
+setattr_files_pattern(rhsmcertd_t, rhsmcertd_log_t, rhsmcertd_log_t)
 
 manage_files_pattern(rhsmcertd_t, rhsmcertd_lock_t, rhsmcertd_lock_t)
 files_lock_filetrans(rhsmcertd_t, rhsmcertd_lock_t, file)
@@ -43,13 +47,17 @@
 
 manage_dirs_pattern(rhsmcertd_t, rhsmcertd_var_run_t, rhsmcertd_var_run_t)
 manage_files_pattern(rhsmcertd_t, rhsmcertd_var_run_t, rhsmcertd_var_run_t)
+files_pid_filetrans(rhsmcertd_t, rhsmcertd_var_run_t, { file dir })
 
+kernel_read_network_state(rhsmcertd_t)
 kernel_read_system_state(rhsmcertd_t)
 
 corecmd_exec_bin(rhsmcertd_t)
 
+dev_read_rand(rhsmcertd_t)
 dev_read_urand(rhsmcertd_t)
 
+files_list_tmp(rhsmcertd_t)
 files_read_etc_files(rhsmcertd_t)
 files_read_usr_files(rhsmcertd_t)
 
@@ -57,3 +65,7 @@
 miscfiles_read_generic_certs(rhsmcertd_t)
 
 sysnet_dns_name_resolve(rhsmcertd_t)
+
+optional_policy(`
+	rpm_read_db(rhsmcertd_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/ricci.fc refpolicy/policy/modules/contrib/ricci.fc
--- refpolicy/policy/modules/contrib/ricci.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/ricci.fc	2012-10-24 17:01:58.333003179 +0200
@@ -1,16 +1,18 @@
-/usr/libexec/modcluster		--	gen_context(system_u:object_r:ricci_modcluster_exec_t,s0)
+/etc/rc\.d/init\.d/ricci	--	gen_context(system_u:object_r:ricci_initrc_exec_t,s0)
+
+/usr/libexec/modcluster	--	gen_context(system_u:object_r:ricci_modcluster_exec_t,s0)
 /usr/libexec/ricci-modlog	--	gen_context(system_u:object_r:ricci_modlog_exec_t,s0)
 /usr/libexec/ricci-modrpm	--	gen_context(system_u:object_r:ricci_modrpm_exec_t,s0)
 /usr/libexec/ricci-modservice	--	gen_context(system_u:object_r:ricci_modservice_exec_t,s0)
 /usr/libexec/ricci-modstorage	--	gen_context(system_u:object_r:ricci_modstorage_exec_t,s0)
 
-/usr/sbin/modclusterd		--	gen_context(system_u:object_r:ricci_modclusterd_exec_t,s0)
-/usr/sbin/ricci			--	gen_context(system_u:object_r:ricci_exec_t,s0)
+/usr/sbin/modclusterd	--	gen_context(system_u:object_r:ricci_modclusterd_exec_t,s0)
+/usr/sbin/ricci	--	gen_context(system_u:object_r:ricci_exec_t,s0)
 
-/var/lib/ricci(/.*)?			gen_context(system_u:object_r:ricci_var_lib_t,s0)
+/var/lib/ricci(/.*)?	gen_context(system_u:object_r:ricci_var_lib_t,s0)
 
-/var/log/clumond\.log 		--	gen_context(system_u:object_r:ricci_modcluster_var_log_t,s0)
+/var/log/clumond\.log.*	--	gen_context(system_u:object_r:ricci_modcluster_var_log_t,s0)
 
-/var/run/clumond\.sock 		-s	gen_context(system_u:object_r:ricci_modcluster_var_run_t,s0)
+/var/run/clumond\.sock	-s	gen_context(system_u:object_r:ricci_modcluster_var_run_t,s0)
 /var/run/modclusterd\.pid	--	gen_context(system_u:object_r:ricci_modcluster_var_run_t,s0)
-/var/run/ricci\.pid		--	gen_context(system_u:object_r:ricci_var_run_t,s0)
+/var/run/ricci\.pid	--	gen_context(system_u:object_r:ricci_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/ricci.if refpolicy/policy/modules/contrib/ricci.if
--- refpolicy/policy/modules/contrib/ricci.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/ricci.if	2012-10-27 13:02:16.096002046 +0200
@@ -1,4 +1,4 @@
-## <summary>Ricci cluster management agent</summary>
+## <summary>Ricci cluster management agent.</summary>
 
 ########################################
 ## <summary>
@@ -15,12 +15,14 @@
 		type ricci_t, ricci_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, ricci_exec_t, ricci_t)
 ')
 
 ########################################
 ## <summary>
-##	Execute a domain transition to run ricci_modcluster.
+##	Execute a domain transition to
+##	run ricci modcluster.
 ## </summary>
 ## <param name="domain">
 ## <summary>
@@ -33,13 +35,14 @@
 		type ricci_modcluster_t, ricci_modcluster_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, ricci_modcluster_exec_t, ricci_modcluster_t)
 ')
 
 ########################################
 ## <summary>
 ##	Do not audit attempts to use
-##	ricci_modcluster file descriptors.
+##	ricci modcluster file descriptors.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -58,7 +61,7 @@
 ########################################
 ## <summary>
 ##	Do not audit attempts to read write
-##	ricci_modcluster unamed pipes.
+##	ricci modcluster unamed pipes.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -76,7 +79,8 @@
 
 ########################################
 ## <summary>
-##	Connect to ricci_modclusterd over an unix stream socket.
+##	Connect to ricci_modclusterd with
+##	a unix domain stream socket.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -90,18 +94,18 @@
 	')
 
 	files_search_pids($1)
-	allow $1 ricci_modcluster_var_run_t:sock_file write;
-	allow $1 ricci_modclusterd_t:unix_stream_socket connectto;
+	stream_connect_pattern($1, ricci_modcluster_var_run_t, ricci_modcluster_var_run_t, ricci_modclusterd_t)
 ')
 
 ########################################
 ## <summary>
-##	Execute a domain transition to run ricci_modlog.
+##	Execute a domain transition to
+##	run ricci modlog.
 ## </summary>
 ## <param name="domain">
-## <summary>
+##	<summary>
 ##	Domain allowed to transition.
-## </summary>
+##	</summary>
 ## </param>
 #
 interface(`ricci_domtrans_modlog',`
@@ -109,17 +113,19 @@
 		type ricci_modlog_t, ricci_modlog_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, ricci_modlog_exec_t, ricci_modlog_t)
 ')
 
 ########################################
 ## <summary>
-##	Execute a domain transition to run ricci_modrpm.
+##	Execute a domain transition to
+##	run ricci modrpm.
 ## </summary>
 ## <param name="domain">
-## <summary>
+##	<summary>
 ##	Domain allowed to transition.
-## </summary>
+##	</summary>
 ## </param>
 #
 interface(`ricci_domtrans_modrpm',`
@@ -127,17 +133,19 @@
 		type ricci_modrpm_t, ricci_modrpm_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, ricci_modrpm_exec_t, ricci_modrpm_t)
 ')
 
 ########################################
 ## <summary>
-##	Execute a domain transition to run ricci_modservice.
+##	Execute a domain transition to
+##	run ricci modservice.
 ## </summary>
 ## <param name="domain">
-## <summary>
+##	<summary>
 ##	Domain allowed to transition.
-## </summary>
+##	</summary>
 ## </param>
 #
 interface(`ricci_domtrans_modservice',`
@@ -145,17 +153,19 @@
 		type ricci_modservice_t, ricci_modservice_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, ricci_modservice_exec_t, ricci_modservice_t)
 ')
 
 ########################################
 ## <summary>
-##	Execute a domain transition to run ricci_modstorage.
+##	Execute a domain transition to
+##	run ricci modstorage.
 ## </summary>
 ## <param name="domain">
-## <summary>
+##	<summary>
 ##	Domain allowed to transition.
-## </summary>
+##	</summary>
 ## </param>
 #
 interface(`ricci_domtrans_modstorage',`
@@ -163,5 +173,50 @@
 		type ricci_modstorage_t, ricci_modstorage_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, ricci_modstorage_exec_t, ricci_modstorage_t)
 ')
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an ricci environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`ricci_admin',`
+	gen_require(`
+		type ricci_t, ricci_initrc_exec_t, ricci_tmp_t;
+		type ricci_var_lib_t, ricci_var_log_t, ricci_var_run_t;
+	')
+
+	allow $1 ricci_t:process { ptrace signal_perms };
+	ps_process_pattern($1, ricci_t)
+
+	init_labeled_script_domtrans($1, ricci_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 ricci_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	files_list_tmp($1)
+	admin_pattern($1, ricci_tmp_t)
+
+	files_list_var_lib($1)
+	admin_pattern($1, ricci_var_lib_t)
+
+	logging_list_logs($1)
+	admin_pattern($1, ricci_var_log_t)
+
+	files_list_pids($1)
+	admin_pattern($1, ricci_var_run_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/ricci.te refpolicy/policy/modules/contrib/ricci.te
--- refpolicy/policy/modules/contrib/ricci.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/ricci.te	2012-10-27 13:44:57.307007515 +0200
@@ -1,4 +1,4 @@
-policy_module(ricci, 1.7.0)
+policy_module(ricci, 1.7.3)
 
 ########################################
 #
@@ -7,9 +7,11 @@
 
 type ricci_t;
 type ricci_exec_t;
-domain_type(ricci_t)
 init_daemon_domain(ricci_t, ricci_exec_t)
 
+type ricci_initrc_exec_t;
+init_script_file(ricci_initrc_exec_t)
+
 type ricci_tmp_t;
 files_tmp_file(ricci_tmp_t)
 
@@ -39,9 +41,11 @@
 
 type ricci_modclusterd_t;
 type ricci_modclusterd_exec_t;
-domain_type(ricci_modclusterd_t)
 init_daemon_domain(ricci_modclusterd_t, ricci_modclusterd_exec_t)
 
+type ricci_modclusterd_tmpfs_t;
+files_tmpfs_file(ricci_modclusterd_tmpfs_t)
+
 type ricci_modlog_t;
 type ricci_modlog_exec_t;
 domain_type(ricci_modlog_t)
@@ -71,20 +75,20 @@
 
 ########################################
 #
-# ricci local policy
+# Local policy
 #
 
 allow ricci_t self:capability { setuid sys_nice sys_boot };
 allow ricci_t self:process setsched;
 allow ricci_t self:fifo_file rw_fifo_file_perms;
-allow ricci_t self:unix_stream_socket { create_stream_socket_perms connectto };
-allow ricci_t self:tcp_socket create_stream_socket_perms;
+allow ricci_t self:unix_stream_socket { accept connectto listen };
+allow ricci_t self:tcp_socket { accept listen };
 
-domain_auto_trans(ricci_t, ricci_modcluster_exec_t, ricci_modcluster_t)
-domain_auto_trans(ricci_t, ricci_modlog_exec_t, ricci_modlog_t)
-domain_auto_trans(ricci_t, ricci_modrpm_exec_t, ricci_modrpm_t)
-domain_auto_trans(ricci_t, ricci_modservice_exec_t, ricci_modservice_t)
-domain_auto_trans(ricci_t, ricci_modstorage_exec_t, ricci_modstorage_t)
+domtrans_pattern(ricci_t, ricci_modcluster_exec_t, ricci_modcluster_t)
+domtrans_pattern(ricci_t, ricci_modlog_exec_t, ricci_modlog_t)
+domtrans_pattern(ricci_t, ricci_modrpm_exec_t, ricci_modrpm_t)
+domtrans_pattern(ricci_t, ricci_modservice_exec_t, ricci_modservice_t)
+domtrans_pattern(ricci_t, ricci_modstorage_exec_t, ricci_modstorage_t)
 
 manage_dirs_pattern(ricci_t, ricci_tmp_t, ricci_tmp_t)
 manage_files_pattern(ricci_t, ricci_tmp_t, ricci_tmp_t)
@@ -95,8 +99,10 @@
 manage_sock_files_pattern(ricci_t, ricci_var_lib_t, ricci_var_lib_t)
 files_var_lib_filetrans(ricci_t, ricci_var_lib_t, { file dir sock_file })
 
-allow ricci_t ricci_var_log_t:dir setattr;
-manage_files_pattern(ricci_t, ricci_var_log_t, ricci_var_log_t)
+allow ricci_t ricci_var_log_t:dir setattr_dir_perms;
+append_files_pattern(ricci_t, ricci_var_log_t, ricci_var_log_t)
+create_files_pattern(ricci_t, ricci_var_log_t, ricci_var_log_t)
+setattr_files_pattern(ricci_t, ricci_var_log_t, ricci_var_log_t)
 manage_sock_files_pattern(ricci_t, ricci_var_log_t, ricci_var_log_t)
 logging_log_filetrans(ricci_t, ricci_var_log_t, { sock_file file dir })
 
@@ -105,6 +111,7 @@
 files_pid_filetrans(ricci_t, ricci_var_run_t, { file sock_file })
 
 kernel_read_kernel_sysctls(ricci_t)
+kernel_read_system_state(ricci_t)
 
 corecmd_exec_bin(ricci_t)
 
@@ -112,12 +119,18 @@
 corenet_all_recvfrom_netlabel(ricci_t)
 corenet_tcp_sendrecv_generic_if(ricci_t)
 corenet_tcp_sendrecv_generic_node(ricci_t)
-corenet_tcp_sendrecv_all_ports(ricci_t)
 corenet_tcp_bind_generic_node(ricci_t)
 corenet_udp_bind_generic_node(ricci_t)
+
+corenet_sendrecv_ricci_server_packets(ricci_t)
 corenet_tcp_bind_ricci_port(ricci_t)
+corenet_tcp_sendrecv_ricci_port(ricci_t)
 corenet_udp_bind_ricci_port(ricci_t)
+corenet_udp_sendrecv_ricci_port(ricci_t)
+
+corenet_sendrecv_http_client_packets(ricci_t)
 corenet_tcp_connect_http_port(ricci_t)
+corenet_tcp_sendrecv_http_port(ricci_t)
 
 dev_read_urand(ricci_t)
 
@@ -147,16 +160,15 @@
 optional_policy(`
 	dbus_system_bus_client(ricci_t)
 
-	oddjob_dbus_chat(ricci_t)
+	optional_policy(`
+		oddjob_dbus_chat(ricci_t)
+	')
 ')
 
 optional_policy(`
-	# Needed so oddjob can run halt/reboot on behalf of ricci
 	corecmd_bin_entry_type(ricci_t)
 	term_dontaudit_search_ptys(ricci_t)
 	init_exec(ricci_t)
-	init_telinit(ricci_t)
-	init_rw_utmp(ricci_t)
 
 	oddjob_system_entry(ricci_t, ricci_exec_t)
 ')
@@ -170,6 +182,10 @@
 ')
 
 optional_policy(`
+	shutdown_domtrans(ricci_t)
+')
+
+optional_policy(`
 	unconfined_use_fds(ricci_t)
 ')
 
@@ -179,7 +195,7 @@
 
 ########################################
 #
-# ricci_modcluster local policy
+# Modcluster local policy
 #
 
 allow ricci_modcluster_t self:capability { net_bind_service sys_nice };
@@ -189,19 +205,31 @@
 kernel_read_kernel_sysctls(ricci_modcluster_t)
 kernel_read_system_state(ricci_modcluster_t)
 
-corecmd_exec_shell(ricci_modcluster_t)
 corecmd_exec_bin(ricci_modcluster_t)
+corecmd_exec_shell(ricci_modcluster_t)
 
-corenet_tcp_bind_cluster_port(ricci_modclusterd_t)
-corenet_tcp_bind_reserved_port(ricci_modclusterd_t)
+corenet_all_recvfrom_unlabeled(ricci_modcluster_t)
+corenet_all_recvfrom_netlabel(ricci_modcluster_t)
+corenet_tcp_sendrecv_generic_if(ricci_modcluster_t)
+corenet_tcp_sendrecv_generic_node(ricci_modcluster_t)
+corenet_tcp_sendrecv_all_ports(ricci_modcluster_t)
+corenet_tcp_bind_generic_node(ricci_modcluster_t)
+
+corenet_sendrecv_all_server_packets(ricci_modcluster_t)
+corenet_tcp_bind_all_rpc_ports(ricci_modcluster_t)
+
+corenet_tcp_bind_cluster_port(ricci_modcluster_t)
+corenet_sendrecv_cluster_client_packets(ricci_modcluster_t)
+corenet_tcp_connect_cluster_port(ricci_modcluster_t)
 
 domain_read_all_domains_state(ricci_modcluster_t)
 
 files_search_locks(ricci_modcluster_t)
 files_read_etc_runtime_files(ricci_modcluster_t)
-files_read_etc_files(ricci_modcluster_t)
 files_search_usr(ricci_modcluster_t)
 
+auth_use_nsswitch(ricci_modcluster_t)
+
 init_exec(ricci_modcluster_t)
 init_domtrans_script(ricci_modcluster_t)
 
@@ -209,12 +237,6 @@
 
 miscfiles_read_localization(ricci_modcluster_t)
 
-modutils_domtrans_insmod(ricci_modcluster_t)
-
-mount_domtrans(ricci_modcluster_t)
-
-consoletype_exec(ricci_modcluster_t)
-
 ricci_stream_connect_modclusterd(ricci_modcluster_t)
 
 optional_policy(`
@@ -233,7 +255,15 @@
 ')
 
 optional_policy(`
-	nscd_socket_use(ricci_modcluster_t)
+	modutils_domtrans_insmod(ricci_modcluster_t)
+')
+
+optional_policy(`
+	mount_domtrans(ricci_modcluster_t)
+')
+
+optional_policy(`
+	consoletype_exec(ricci_modcluster_t)
 ')
 
 optional_policy(`
@@ -241,13 +271,12 @@
 ')
 
 optional_policy(`
-	# XXX This has got to go.
-	unconfined_domain(ricci_modcluster_t)
+	rgmanager_stream_connect(ricci_modcluster_t)
 ')
 
 ########################################
 #
-# ricci_modclusterd local policy
+# Modclusterd local policy
 #
 
 allow ricci_modclusterd_t self:capability { sys_nice sys_tty_config };
@@ -255,14 +284,19 @@
 allow ricci_modclusterd_t self:fifo_file rw_fifo_file_perms;
 allow ricci_modclusterd_t self:unix_stream_socket create_stream_socket_perms;
 allow ricci_modclusterd_t self:tcp_socket create_stream_socket_perms;
-# cjp: this needs to be fixed for a specific socket type:
 allow ricci_modclusterd_t self:socket create_socket_perms;
 
 allow ricci_modclusterd_t ricci_modcluster_t:unix_stream_socket connectto;
-allow ricci_modclusterd_t ricci_modcluster_t:fifo_file rw_file_perms;
+allow ricci_modclusterd_t ricci_modcluster_t:fifo_file rw_fifo_file_perms;
 
-allow ricci_modclusterd_t ricci_modcluster_var_log_t:dir setattr;
-manage_files_pattern(ricci_modclusterd_t, ricci_modcluster_var_log_t, ricci_modcluster_var_log_t)
+manage_dirs_pattern(ricci_modclusterd_t, ricci_modclusterd_tmpfs_t, ricci_modclusterd_tmpfs_t)
+manage_files_pattern(ricci_modclusterd_t, ricci_modclusterd_tmpfs_t, ricci_modclusterd_tmpfs_t)
+fs_tmpfs_filetrans(ricci_modclusterd_t, ricci_modclusterd_tmpfs_t, { dir file })
+
+allow ricci_modclusterd_t ricci_modcluster_var_log_t:dir setattr_dir_perms;
+append_files_pattern(ricci_modclusterd_t, ricci_modcluster_var_log_t, ricci_modcluster_var_log_t)
+create_files_pattern(ricci_modclusterd_t, ricci_modcluster_var_log_t, ricci_modcluster_var_log_t)
+setattr_files_pattern(ricci_modclusterd_t, ricci_modcluster_var_log_t, ricci_modcluster_var_log_t)
 manage_sock_files_pattern(ricci_modclusterd_t, ricci_modcluster_var_log_t, ricci_modcluster_var_log_t)
 logging_log_filetrans(ricci_modclusterd_t, ricci_modcluster_var_log_t, { sock_file file dir })
 
@@ -272,18 +306,24 @@
 
 kernel_read_kernel_sysctls(ricci_modclusterd_t)
 kernel_read_system_state(ricci_modclusterd_t)
+kernel_request_load_module(ricci_modclusterd_t)
 
 corecmd_exec_bin(ricci_modclusterd_t)
 
+corenet_all_recvfrom_unlabeled(ricci_modclusterd_t)
+corenet_all_recvfrom_netlabel(ricci_modclusterd_t)
 corenet_tcp_sendrecv_generic_if(ricci_modclusterd_t)
-corenet_tcp_sendrecv_all_ports(ricci_modclusterd_t)
+corenet_tcp_sendrecv_generic_node(ricci_modclusterd_t)
 corenet_tcp_bind_generic_node(ricci_modclusterd_t)
+
+corenet_sendrecv_ricci_modcluster_server_packets(ricci_modclusterd_t)
 corenet_tcp_bind_ricci_modcluster_port(ricci_modclusterd_t)
+corenet_sendrecv_ricci_modcluster_client_packets(ricci_modclusterd_t)
 corenet_tcp_connect_ricci_modcluster_port(ricci_modclusterd_t)
+corenet_tcp_sendrecv_ricci_modcluster_port(ricci_modclusterd_t)
 
 domain_read_all_domains_state(ricci_modclusterd_t)
 
-files_read_etc_files(ricci_modclusterd_t)
 files_read_etc_runtime_files(ricci_modclusterd_t)
 
 fs_getattr_xattr_fs(ricci_modclusterd_t)
@@ -321,7 +361,7 @@
 
 ########################################
 #
-# ricci_modlog local policy
+# Modlog local policy
 #
 
 allow ricci_modlog_t self:capability sys_nice;
@@ -351,7 +391,7 @@
 
 ########################################
 #
-# ricci_modrpm local policy
+# Modrpm local policy
 #
 
 allow ricci_modrpm_t self:fifo_file read_fifo_file_perms;
@@ -375,12 +415,12 @@
 
 ########################################
 #
-# ricci_modservice local policy
+# Modservice local policy
 #
 
 allow ricci_modservice_t self:capability { dac_override sys_nice };
-allow ricci_modservice_t self:fifo_file rw_fifo_file_perms;
 allow ricci_modservice_t self:process setsched;
+allow ricci_modservice_t self:fifo_file rw_fifo_file_perms;
 
 kernel_read_kernel_sysctls(ricci_modservice_t)
 kernel_read_system_state(ricci_modservice_t)
@@ -391,11 +431,8 @@
 files_read_etc_files(ricci_modservice_t)
 files_read_etc_runtime_files(ricci_modservice_t)
 files_search_usr(ricci_modservice_t)
-# Needed for running chkconfig
 files_manage_etc_symlinks(ricci_modservice_t)
 
-consoletype_exec(ricci_modservice_t)
-
 init_domtrans_script(ricci_modservice_t)
 
 miscfiles_read_localization(ricci_modservice_t)
@@ -405,6 +442,10 @@
 ')
 
 optional_policy(`
+	consoletype_exec(ricci_modservice_t)
+')
+
+optional_policy(`
 	nscd_dontaudit_search_pid(ricci_modservice_t)
 ')
 
@@ -414,14 +455,13 @@
 
 ########################################
 #
-# ricci_modstorage local policy
+# Modstorage local policy
 #
 
+allow ricci_modstorage_t self:capability { mknod sys_nice };
 allow ricci_modstorage_t self:process { setsched signal };
 dontaudit ricci_modstorage_t self:process ptrace;
-allow ricci_modstorage_t self:capability { mknod sys_nice };
 allow ricci_modstorage_t self:fifo_file rw_fifo_file_perms;
-allow ricci_modstorage_t self:unix_dgram_socket create_socket_perms;
 
 kernel_read_kernel_sysctls(ricci_modstorage_t)
 kernel_read_system_state(ricci_modstorage_t)
@@ -429,8 +469,8 @@
 create_files_pattern(ricci_modstorage_t, ricci_modstorage_lock_t, ricci_modstorage_lock_t)
 files_lock_filetrans(ricci_modstorage_t, ricci_modstorage_lock_t, file)
 
-corecmd_exec_shell(ricci_modstorage_t)
 corecmd_exec_bin(ricci_modstorage_t)
+corecmd_exec_shell(ricci_modstorage_t)
 
 dev_read_sysfs(ricci_modstorage_t)
 dev_read_urand(ricci_modstorage_t)
@@ -438,7 +478,6 @@
 
 domain_read_all_domains_state(ricci_modstorage_t)
 
-#Needed for editing /etc/fstab
 files_manage_etc_files(ricci_modstorage_t)
 files_read_etc_runtime_files(ricci_modstorage_t)
 files_read_usr_files(ricci_modstorage_t)
@@ -448,18 +487,10 @@
 
 term_dontaudit_use_console(ricci_modstorage_t)
 
-fstools_domtrans(ricci_modstorage_t)
-
 logging_send_syslog_msg(ricci_modstorage_t)
 
 miscfiles_read_localization(ricci_modstorage_t)
 
-modutils_read_module_deps(ricci_modstorage_t)
-
-consoletype_exec(ricci_modstorage_t)
-
-mount_domtrans(ricci_modstorage_t)
-
 optional_policy(`
 	aisexec_stream_connect(ricci_modstorage_t)
 	corosync_stream_connect(ricci_modstorage_t)
@@ -471,12 +502,24 @@
 ')
 
 optional_policy(`
+	consoletype_exec(ricci_modstorage_t)
+')
+
+optional_policy(`
+	fstools_domtrans(ricci_modstorage_t)
+')
+
+optional_policy(`
 	lvm_domtrans(ricci_modstorage_t)
 	lvm_manage_config(ricci_modstorage_t)
 ')
 
 optional_policy(`
-	nscd_socket_use(ricci_modstorage_t)
+	modutils_read_module_deps(ricci_modstorage_t)
+')
+
+optional_policy(`
+	mount_domtrans(ricci_modstorage_t)
 ')
 
 optional_policy(`
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/rlogin.fc refpolicy/policy/modules/contrib/rlogin.fc
--- refpolicy/policy/modules/contrib/rlogin.fc	2012-05-04 16:21:53.000000000 +0200
+++ refpolicy/policy/modules/contrib/rlogin.fc	2012-10-24 17:02:00.340003183 +0200
@@ -1,7 +1,8 @@
-HOME_DIR/\.rlogin		--	gen_context(system_u:object_r:rlogind_home_t,s0)
+HOME_DIR/\.rhosts	--	gen_context(system_u:object_r:rlogind_home_t,s0)
+HOME_DIR/\.rlogin	--	gen_context(system_u:object_r:rlogind_home_t,s0)
 
 /usr/kerberos/sbin/klogind	--	gen_context(system_u:object_r:rlogind_exec_t,s0)
 
-/usr/lib/telnetlogin		--	gen_context(system_u:object_r:rlogind_exec_t,s0)
+/usr/lib/telnetlogin	--	gen_context(system_u:object_r:rlogind_exec_t,s0)
 
-/usr/sbin/in\.rlogind		--	gen_context(system_u:object_r:rlogind_exec_t,s0)
+/usr/sbin/in\.rlogind	--	gen_context(system_u:object_r:rlogind_exec_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/rlogin.if refpolicy/policy/modules/contrib/rlogin.if
--- refpolicy/policy/modules/contrib/rlogin.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/rlogin.if	2012-10-24 17:02:00.341003183 +0200
@@ -1,4 +1,4 @@
-## <summary>Remote login daemon</summary>
+## <summary>Remote login daemon.</summary>
 
 ########################################
 ## <summary>
@@ -21,17 +21,11 @@
 
 ########################################
 ## <summary>
-##	read rlogin homedir content (.config)
+##	Read rlogin user home content.
 ## </summary>
-## <param name="userdomain_prefix">
-##	<summary>
-##	The prefix of the user domain (e.g., user
-##	is the prefix for user_t).
-##	</summary>
-## </param>
-## <param name="user_domain">
+## <param name="domain">
 ##	<summary>
-##	The type of the user domain.
+##	Domain allowed access.
 ##	</summary>
 ## </param>
 #
@@ -45,3 +39,112 @@
 	read_files_pattern($1, rlogind_home_t, rlogind_home_t)
 	read_lnk_files_pattern($1, rlogind_home_t, rlogind_home_t)
 ')
+
+########################################
+## <summary>
+##	Create, read, write, and delete
+##	rlogind home files.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`rlogin_manage_rlogind_home_files',`
+	gen_require(`
+		type rlogind_home_t;
+	')
+
+	userdom_search_user_home_dirs($1)
+	allow $1 rlogind_home_t:file manage_file_perms;
+')
+
+########################################
+## <summary>
+##	Relabel rlogind home files.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`rlogin_relabel_rlogind_home_files',`
+	gen_require(`
+		type rlogind_home_t;
+	')
+
+	userdom_search_user_home_dirs($1)
+	allow $1 rlogind_home_t:file relabel_file_perms;
+')
+
+########################################
+## <summary>
+##	Create objects in user home
+##	directories with the rlogind home type.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="object_class">
+##	<summary>
+##	Class of the object being created.
+##	</summary>
+## </param>
+## <param name="name" optional="true">
+##	<summary>
+##	The name of the object being created.
+##	</summary>
+## </param>
+#
+interface(`rlogin_home_filetrans_logind_home',`
+	gen_require(`
+		type rlogind_home_t;
+	')
+
+	userdom_user_home_dir_filetrans($1, rlogind_home_t, $2, $3)
+')
+
+########################################
+## <summary>
+##	Create, read, write, and delete
+##	rlogind temporary content.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`rlogin_manage_rlogind_tmp_content',`
+	gen_require(`
+		type rlogind_tmp_t;
+	')
+
+	files_search_tmp($1)
+	allow $1 rlogind_tmp_t:dir manage_dir_perms;
+	allow $1 rlogind_tmp_t:file manage_file_perms;
+')
+
+########################################
+## <summary>
+##	Relabel rlogind temporary content.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`rlogin_relabel_rlogind_tmp_content',`
+	gen_require(`
+		type rlogind_tmp_t;
+	')
+
+	files_search_tmp($1)
+	allow $1 rlogind_tmp_t:dir relabel_dir_perms;
+	allow $1 rlogind_tmp_t:file relabel_file_perms;
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/rlogin.te refpolicy/policy/modules/contrib/rlogin.te
--- refpolicy/policy/modules/contrib/rlogin.te	2012-07-25 20:33:05.000000000 +0200
+++ refpolicy/policy/modules/contrib/rlogin.te	2012-10-24 17:02:00.360003183 +0200
@@ -1,4 +1,4 @@
-policy_module(rlogin, 1.10.0)
+policy_module(rlogin, 1.10.1)
 
 ########################################
 #
@@ -7,10 +7,10 @@
 
 type rlogind_t;
 type rlogind_exec_t;
+auth_login_pgm_domain(rlogind_t)
 inetd_service_domain(rlogind_t, rlogind_exec_t)
-role system_r types rlogind_t;
 
-type rlogind_devpts_t; #, userpty_type;
+type rlogind_devpts_t;
 term_login_pty(rlogind_devpts_t)
 
 type rlogind_home_t;
@@ -27,27 +27,25 @@
 # Local policy
 #
 
-allow rlogind_t self:capability { fsetid chown fowner sys_tty_config dac_override };
+allow rlogind_t self:capability { fsetid chown fowner setuid setgid sys_tty_config dac_override };
 allow rlogind_t self:process signal_perms;
 allow rlogind_t self:fifo_file rw_fifo_file_perms;
-allow rlogind_t self:tcp_socket connected_stream_socket_perms;
-# for identd; cjp: this should probably only be inetd_child rules?
-allow rlogind_t self:netlink_tcpdiag_socket r_netlink_socket_perms;
-allow rlogind_t self:capability { setuid setgid };
+allow rlogind_t self:tcp_socket { accept listen };
 
-allow rlogind_t rlogind_devpts_t:chr_file { rw_chr_file_perms setattr };
+allow rlogind_t rlogind_devpts_t:chr_file { rw_chr_file_perms setattr_chr_file_perms };
 term_create_pty(rlogind_t, rlogind_devpts_t)
 
-# for /usr/lib/telnetlogin
-can_exec(rlogind_t, rlogind_exec_t)
+allow rlogind_t rlogind_home_t:file read_file_perms;
 
 manage_dirs_pattern(rlogind_t, rlogind_tmp_t, rlogind_tmp_t)
 manage_files_pattern(rlogind_t, rlogind_tmp_t, rlogind_tmp_t)
-files_tmp_filetrans(rlogind_t, rlogind_tmp_t, { file dir })
+files_tmp_filetrans(rlogind_t, rlogind_tmp_t, { dir file })
 
 manage_files_pattern(rlogind_t, rlogind_var_run_t, rlogind_var_run_t)
 files_pid_filetrans(rlogind_t, rlogind_var_run_t, file)
 
+can_exec(rlogind_t, rlogind_exec_t)
+
 kernel_read_kernel_sysctls(rlogind_t)
 kernel_read_system_state(rlogind_t)
 kernel_read_network_state(rlogind_t)
@@ -65,16 +63,14 @@
 
 domain_interactive_fd(rlogind_t)
 
-fs_getattr_xattr_fs(rlogind_t)
+fs_getattr_all_fs(rlogind_t)
 fs_search_auto_mountpoints(rlogind_t)
 
 auth_domtrans_chk_passwd(rlogind_t)
 auth_rw_login_records(rlogind_t)
 auth_use_nsswitch(rlogind_t)
 
-files_read_etc_files(rlogind_t)
 files_read_etc_runtime_files(rlogind_t)
-files_search_home(rlogind_t)
 files_search_default(rlogind_t)
 
 init_rw_utmp(rlogind_t)
@@ -85,14 +81,9 @@
 
 seutil_read_config(rlogind_t)
 
+userdom_search_user_home_dirs(rlogind_t)
 userdom_setattr_user_ptys(rlogind_t)
-# cjp: this is egregious
-userdom_read_user_home_content_files(rlogind_t)
-
-remotelogin_domtrans(rlogind_t)
-remotelogin_signal(rlogind_t)
-
-rlogin_read_home_content(rlogind_t)
+userdom_use_user_terminals(rlogind_t)
 
 tunable_policy(`use_nfs_home_dirs',`
 	fs_list_nfs(rlogind_t)
@@ -108,9 +99,15 @@
 
 optional_policy(`
 	kerberos_keytab_template(rlogind, rlogind_t)
+	kerberos_tmp_filetrans_host_rcache(rlogind_t, file, "host_0")
 	kerberos_manage_host_rcache(rlogind_t)
 ')
 
 optional_policy(`
+	remotelogin_domtrans(rlogind_t)
+	remotelogin_signal(rlogind_t)
+')
+
+optional_policy(`
 	tcpd_wrapped_domain(rlogind_t, rlogind_exec_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/rngd.fc refpolicy/policy/modules/contrib/rngd.fc
--- refpolicy/policy/modules/contrib/rngd.fc	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/rngd.fc	2012-10-16 19:35:40.451013968 +0200
@@ -0,0 +1,3 @@
+/etc/rc\.d/init\.d/rngd	--	gen_context(system_u:object_r:rngd_initrc_exec_t,s0)
+
+/usr/sbin/rngd	--	gen_context(system_u:object_r:rngd_exec_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/rngd.if refpolicy/policy/modules/contrib/rngd.if
--- refpolicy/policy/modules/contrib/rngd.if	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/rngd.if	2012-10-16 19:35:40.451013968 +0200
@@ -0,0 +1,32 @@
+## <summary>Check and feed random data from hardware device to kernel random device.</summary>
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an rng environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`rngd_admin',`
+	gen_require(`
+		type rngd_t, rngd_initrc_exec_t;
+	')
+
+	allow $1 rngd_t:process { ptrace signal_perms };
+	ps_process_pattern($1, rngd_t)
+
+	init_labeled_script_domtrans($1, rngd_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 rngd_initrc_exec_t system_r;
+	allow $2 system_r;
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/rngd.te refpolicy/policy/modules/contrib/rngd.te
--- refpolicy/policy/modules/contrib/rngd.te	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/rngd.te	2012-10-27 13:03:07.019002157 +0200
@@ -0,0 +1,36 @@
+policy_module(rngd, 1.0.1)
+
+########################################
+#
+# Declarations
+#
+
+type rngd_t;
+type rngd_exec_t;
+init_daemon_domain(rngd_t, rngd_exec_t)
+
+type rngd_initrc_exec_t;
+init_script_file(rngd_initrc_exec_t)
+
+########################################
+#
+# Local policy
+#
+
+allow rngd_t self:capability sys_admin;
+allow rngd_t self:process signal;
+allow rngd_t self:fifo_file rw_fifo_file_perms;
+allow rngd_t self:unix_stream_socket { accept listen };
+
+kernel_read_kernel_sysctls(rngd_t)
+
+dev_read_rand(rngd_t)
+dev_read_urand(rngd_t)
+dev_rw_tpm(rngd_t)
+dev_write_rand(rngd_t)
+
+files_read_etc_files(rngd_t)
+
+logging_send_syslog_msg(rngd_t)
+
+miscfiles_read_localization(rngd_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/roundup.fc refpolicy/policy/modules/contrib/roundup.fc
--- refpolicy/policy/modules/contrib/roundup.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/roundup.fc	2012-10-24 17:02:02.613003188 +0200
@@ -1,11 +1,5 @@
-/etc/rc\.d/init\.d/roundup --	gen_context(system_u:object_r:roundup_initrc_exec_t,s0)
+/etc/rc\.d/init\.d/roundup	--	gen_context(system_u:object_r:roundup_initrc_exec_t,s0)
 
-#
-# /usr
-#
-/usr/bin/roundup-server	 --	gen_context(system_u:object_r:roundup_exec_t,s0)
+/usr/bin/roundup-server	--	gen_context(system_u:object_r:roundup_exec_t,s0)
 
-#
-# /var
-#
 /var/lib/roundup(/.*)?	--	gen_context(system_u:object_r:roundup_var_lib_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/roundup.if refpolicy/policy/modules/contrib/roundup.if
--- refpolicy/policy/modules/contrib/roundup.if	2012-05-04 15:16:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/roundup.if	2012-10-24 17:02:02.613003188 +0200
@@ -1,9 +1,9 @@
-## <summary>Roundup Issue Tracking System policy</summary>
+## <summary>Roundup Issue Tracking System.</summary>
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate 
-##	an roundup environment
+##	All of the rules required to
+##	administrate an roundup environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -12,7 +12,7 @@
 ## </param>
 ## <param name="role">
 ##	<summary>
-##	The role to be allowed to manage the roundup domain.
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <rolecap/>
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/roundup.te refpolicy/policy/modules/contrib/roundup.te
--- refpolicy/policy/modules/contrib/roundup.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/roundup.te	2012-10-24 17:02:02.633003188 +0200
@@ -1,4 +1,4 @@
-policy_module(roundup, 1.7.0)
+policy_module(roundup, 1.7.1)
 
 ########################################
 #
@@ -26,9 +26,8 @@
 allow roundup_t self:capability { setgid setuid };
 dontaudit roundup_t self:capability sys_tty_config;
 allow roundup_t self:process signal_perms;
-allow roundup_t self:unix_stream_socket create_stream_socket_perms;
-allow roundup_t self:tcp_socket create_stream_socket_perms;
-allow roundup_t self:udp_socket create_socket_perms;
+allow roundup_t self:unix_stream_socket { accept listen };
+allow roundup_t self:tcp_socket { accept listen };
 
 manage_files_pattern(roundup_t, roundup_var_lib_t, roundup_var_lib_t)
 files_var_lib_filetrans(roundup_t, roundup_var_lib_t, file)
@@ -40,35 +39,29 @@
 kernel_list_proc(roundup_t)
 kernel_read_proc_symlinks(roundup_t)
 
-dev_read_sysfs(roundup_t)
-
-# execute python
 corecmd_exec_bin(roundup_t)
 
 corenet_all_recvfrom_unlabeled(roundup_t)
 corenet_all_recvfrom_netlabel(roundup_t)
 corenet_tcp_sendrecv_generic_if(roundup_t)
-corenet_udp_sendrecv_generic_if(roundup_t)
-corenet_raw_sendrecv_generic_if(roundup_t)
 corenet_tcp_sendrecv_generic_node(roundup_t)
-corenet_udp_sendrecv_generic_node(roundup_t)
-corenet_raw_sendrecv_generic_node(roundup_t)
-corenet_tcp_sendrecv_all_ports(roundup_t)
-corenet_udp_sendrecv_all_ports(roundup_t)
 corenet_tcp_bind_generic_node(roundup_t)
-corenet_tcp_bind_http_cache_port(roundup_t)
-corenet_tcp_connect_smtp_port(roundup_t)
+
 corenet_sendrecv_http_cache_server_packets(roundup_t)
+corenet_tcp_bind_http_cache_port(roundup_t)
+corenet_tcp_sendrecv_http_cache_port(roundup_t)
+
 corenet_sendrecv_smtp_client_packets(roundup_t)
+corenet_tcp_connect_smtp_port(roundup_t)
+corenet_tcp_sendrecv_smtp_port(roundup_t)
 
-# /usr/share/mysql/charsets/Index.xml
+dev_read_sysfs(roundup_t)
 dev_read_urand(roundup_t)
 
 domain_use_interactive_fds(roundup_t)
 
-# /usr/share/mysql/charsets/Index.xml
-files_read_usr_files(roundup_t)
 files_read_etc_files(roundup_t)
+files_read_usr_files(roundup_t)
 
 fs_getattr_all_fs(roundup_t)
 fs_search_auto_mountpoints(roundup_t)
@@ -77,14 +70,14 @@
 
 miscfiles_read_localization(roundup_t)
 
-sysnet_read_config(roundup_t)
+sysnet_dns_name_resolve(roundup_t)
 
 userdom_dontaudit_use_unpriv_user_fds(roundup_t)
 userdom_dontaudit_search_user_home_dirs(roundup_t)
 
 optional_policy(`
 	mysql_stream_connect(roundup_t)
-	mysql_search_db(roundup_t)
+	mysql_tcp_connect(roundup_t)
 ')
 
 optional_policy(`
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/rpc.fc refpolicy/policy/modules/contrib/rpc.fc
--- refpolicy/policy/modules/contrib/rpc.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/rpc.fc	2012-10-27 13:02:22.867002063 +0200
@@ -1,31 +1,22 @@
-#
-# /etc
-#
-/etc/exports		--	gen_context(system_u:object_r:exports_t,s0)
-/etc/rc\.d/init\.d/nfs	 --	gen_context(system_u:object_r:nfsd_initrc_exec_t,s0)
-/etc/rc\.d/init\.d/nfslock --	gen_context(system_u:object_r:rpcd_initrc_exec_t,s0)
-/etc/rc\.d/init\.d/rpcidmapd --	gen_context(system_u:object_r:rpcd_initrc_exec_t,s0)
+/etc/exports	--	gen_context(system_u:object_r:exports_t,s0)
 
-#
-# /sbin
-#
-/sbin/rpc\..*		--	gen_context(system_u:object_r:rpcd_exec_t,s0)
-/sbin/sm-notify		--	gen_context(system_u:object_r:rpcd_exec_t,s0)
+/etc/rc\.d/init\.d/nfs	--	gen_context(system_u:object_r:nfsd_initrc_exec_t,s0)
+/etc/rc\.d/init\.d/nfslock	--	gen_context(system_u:object_r:rpcd_initrc_exec_t,s0)
+/etc/rc\.d/init\.d/rpcidmapd	--	gen_context(system_u:object_r:rpcd_initrc_exec_t,s0)
 
-#
-# /usr
-#
+/sbin/rpc\..*	--	gen_context(system_u:object_r:rpcd_exec_t,s0)
+/sbin/sm-notify	--	gen_context(system_u:object_r:rpcd_exec_t,s0)
+
+/usr/sbin/rpc\..*	--	gen_context(system_u:object_r:rpcd_exec_t,s0)
 /usr/sbin/rpc\.idmapd	--	gen_context(system_u:object_r:rpcd_exec_t,s0)
 /usr/sbin/rpc\.gssd	--	gen_context(system_u:object_r:gssd_exec_t,s0)
 /usr/sbin/rpc\.mountd	--	gen_context(system_u:object_r:nfsd_exec_t,s0)
 /usr/sbin/rpc\.nfsd	--	gen_context(system_u:object_r:nfsd_exec_t,s0)
 /usr/sbin/rpc\.rquotad	--	gen_context(system_u:object_r:rpcd_exec_t,s0)
 /usr/sbin/rpc\.svcgssd	--	gen_context(system_u:object_r:gssd_exec_t,s0)
+/usr/sbin/sm-notify	--	gen_context(system_u:object_r:rpcd_exec_t,s0)
 
-#
-# /var
-#
-/var/lib/nfs(/.*)?		gen_context(system_u:object_r:var_lib_nfs_t,s0)
+/var/lib/nfs(/.*)?	gen_context(system_u:object_r:var_lib_nfs_t,s0)
 
 /var/run/rpc\.statd(/.*)?	gen_context(system_u:object_r:rpcd_var_run_t,s0)
-/var/run/rpc\.statd\.pid --	gen_context(system_u:object_r:rpcd_var_run_t,s0)
+/var/run/rpc\.statd\.pid	--	gen_context(system_u:object_r:rpcd_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/rpc.if refpolicy/policy/modules/contrib/rpc.if
--- refpolicy/policy/modules/contrib/rpc.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/rpc.if	2012-11-01 22:22:05.446790108 +0100
@@ -1,4 +1,4 @@
-## <summary>Remote Procedure Call Daemon for managment of network based process communication</summary>
+## <summary>Remote Procedure Call Daemon.</summary>
 
 ########################################
 ## <summary>
@@ -20,106 +20,34 @@
 ## <summary>
 ##	The template to define a rpc domain.
 ## </summary>
-## <desc>
-##	<p>
-##	This template creates a domain to be used for
-##	a new rpc daemon.
-##	</p>
-## </desc>
-## <param name="userdomain_prefix">
+## <param name="domain_prefix">
 ##	<summary>
-##	The type of daemon to be used.
+##	Domain prefix to be used.
 ##	</summary>
 ## </param>
 #
-template(`rpc_domain_template', `
+template(`rpc_domain_template',`
+	gen_require(`
+		attribute rpc_domain;
+	')
+
 	########################################
 	#
 	# Declarations
 	#
 
-	type $1_t;
+	type $1_t, rpc_domain;
 	type $1_exec_t;
 	init_daemon_domain($1_t, $1_exec_t)
+
 	domain_use_interactive_fds($1_t)
 
-	####################################
+	########################################
 	#
-	# Local Policy
+	# Policy
 	#
 
-	dontaudit $1_t self:capability { net_admin sys_tty_config };
-	allow $1_t self:capability net_bind_service;
-	allow $1_t self:process signal_perms;
-	allow $1_t self:unix_dgram_socket create_socket_perms;
-	allow $1_t self:unix_stream_socket create_stream_socket_perms;
-	allow $1_t self:tcp_socket create_stream_socket_perms;
-	allow $1_t self:udp_socket create_socket_perms;
-
-	manage_dirs_pattern($1_t, var_lib_nfs_t, var_lib_nfs_t)
-	manage_files_pattern($1_t, var_lib_nfs_t, var_lib_nfs_t)
-
-	kernel_list_proc($1_t)
-	kernel_read_proc_symlinks($1_t)
-	kernel_read_kernel_sysctls($1_t)
-	# bind to arbitary unused ports
-	kernel_rw_rpc_sysctls($1_t)
-
-	dev_read_sysfs($1_t)
-	dev_read_urand($1_t)
-	dev_read_rand($1_t)
-
-	corenet_all_recvfrom_unlabeled($1_t)
-	corenet_all_recvfrom_netlabel($1_t)
-	corenet_tcp_sendrecv_generic_if($1_t)
-	corenet_udp_sendrecv_generic_if($1_t)
-	corenet_tcp_sendrecv_generic_node($1_t)
-	corenet_udp_sendrecv_generic_node($1_t)
-	corenet_tcp_sendrecv_all_ports($1_t)
-	corenet_udp_sendrecv_all_ports($1_t)
-	corenet_tcp_bind_generic_node($1_t)
-	corenet_udp_bind_generic_node($1_t)
-	corenet_tcp_bind_reserved_port($1_t)
-	corenet_tcp_connect_all_ports($1_t)
-	corenet_sendrecv_portmap_client_packets($1_t)
-	# do not log when it tries to bind to a port belonging to another domain
-	corenet_dontaudit_tcp_bind_all_ports($1_t)
-	corenet_dontaudit_udp_bind_all_ports($1_t)
-	# bind to arbitary unused ports
-	corenet_tcp_bind_generic_port($1_t)
-	corenet_udp_bind_generic_port($1_t)
-	corenet_tcp_bind_all_rpc_ports($1_t)
-	corenet_udp_bind_all_rpc_ports($1_t)
-	corenet_sendrecv_generic_server_packets($1_t)
-
-	fs_rw_rpc_named_pipes($1_t)
-	fs_search_auto_mountpoints($1_t)
-
-	files_read_etc_files($1_t)
-	files_read_etc_runtime_files($1_t)
-	files_search_var($1_t)
-	files_search_var_lib($1_t)
-	files_list_home($1_t)
-
 	auth_use_nsswitch($1_t)
-
-	logging_send_syslog_msg($1_t)
-
-	miscfiles_read_localization($1_t)
-
-	userdom_dontaudit_use_unpriv_user_fds($1_t)
-
-	optional_policy(`
-		rpcbind_stream_connect($1_t)
-	')
-
-	optional_policy(`
-		seutil_sigchld_newrole($1_t)
-	')
-
-	optional_policy(`
-		udev_read_db($1_t)
-	')
 ')
 
 ########################################
@@ -138,8 +66,8 @@
 
 ########################################
 ## <summary>
-##	Do not audit attempts to get the attributes
-##	of the NFS export file.
+##	Do not audit attempts to get
+##	attributes of export files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -157,7 +85,7 @@
 
 ########################################
 ## <summary>
-##	Allow read access to exports.
+##	Read export files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -175,7 +103,7 @@
 
 ########################################
 ## <summary>
-##	Allow write access to exports.
+##	Write export files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -193,7 +121,7 @@
 
 ########################################
 ## <summary>
-##	Execute domain in nfsd domain.
+##	Execute nfsd in the nfsd domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -206,12 +134,14 @@
 		type nfsd_t, nfsd_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, nfsd_exec_t, nfsd_t)
 ')
 
 #######################################
 ## <summary>
-##	Execute domain in nfsd domain.
+##	Execute nfsd init scripts in
+##	the initrc domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -229,7 +159,7 @@
 
 ########################################
 ## <summary>
-##	Execute domain in rpcd domain.
+##	Execute rpcd in the rpcd domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -242,13 +172,14 @@
 		type rpcd_t, rpcd_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, rpcd_exec_t, rpcd_t)
-	allow rpcd_t $1:process signal;
 ')
 
 #######################################
 ## <summary>
-##	Execute domain in rpcd domain.
+##	Execute rpcd init scripts in
+##	the initrc domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -266,7 +197,7 @@
 
 ########################################
 ## <summary>
-##	Read NFS exported content.
+##	Read nfs exported content.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -282,12 +213,13 @@
 
 	allow $1 { nfsd_ro_t nfsd_rw_t }:dir list_dir_perms;
 	allow $1 { nfsd_ro_t nfsd_rw_t }:file read_file_perms;
-	allow $1 { nfsd_ro_t nfsd_rw_t }:lnk_file { getattr read };
+	allow $1 { nfsd_ro_t nfsd_rw_t }:lnk_file read_lnk_file_perms;
 ')
 
 ########################################
 ## <summary>
-##	Allow domain to create read and write NFS directories.
+##	Create, read, write, and delete
+##	nfs exported read write content.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -308,7 +240,8 @@
 
 ########################################
 ## <summary>
-##	Allow domain to create read and write NFS directories.
+##	Create, read, write, and delete
+##	nfs exported read only content.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -329,7 +262,7 @@
 
 ########################################
 ## <summary>
-##	Allow domain to read and write to an NFS TCP socket.
+##	Read and write to nfsd tcp sockets.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -347,7 +280,7 @@
 
 ########################################
 ## <summary>
-##	Allow domain to read and write to an NFS UDP socket.
+##	Read and write to nfsd udp sockets.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -379,7 +312,7 @@
 
 ########################################
 ## <summary>
-##	Search NFS state data in /var/lib/nfs.
+##	Search nfs lib directories.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -398,7 +331,7 @@
 
 ########################################
 ## <summary>
-##	Read NFS state data in /var/lib/nfs.
+##	Read nfs lib files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -417,7 +350,8 @@
 
 ########################################
 ## <summary>
-##	Manage NFS state data in /var/lib/nfs.
+##	Create, read, write, and delete
+##	nfs lib files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -432,4 +366,57 @@
 
 	files_search_var_lib($1)
 	manage_files_pattern($1, var_lib_nfs_t, var_lib_nfs_t)
+
+	ifdef(`distro_gentoo',`
+		rw_dirs_pattern($1, var_lib_nfs_t, var_lib_nfs_t)
+	')
+')
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an rpc environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`rpc_admin',`
+	gen_require(`
+		attribute rpc_domain;
+		type nfsd_initrc_exec_t, rpcd_initrc_exec_t, exports_t;
+		type var_lib_nfs_t, rpcd_var_run_t, gssd_tmp_t;
+		type nfsd_ro_t, nfsd_rw_t;
+	')
+
+	allow $1 rpc_domain:process { ptrace signal_perms };
+	ps_process_pattern($1, rpc_domain)
+
+	init_labeled_script_domtrans($1, { nfsd_initrc_exec_t rpcd_initrc_exec_t })
+ 	domain_system_change_exemption($1)
+ 	role_transition $2 { nfsd_initrc_exec_t rpcd_initrc_exec_t } system_r;
+ 	allow $2 system_r;
+
+	files_list_etc($1)
+	admin_pattern($1, exports_t)
+
+	files_list_var_lib($1)
+	admin_pattern($1, var_lib_nfs_t)
+
+	files_list_pids($1)
+	admin_pattern($1, rpcd_var_run_t)
+
+	files_list_all($1)
+	admin_pattern($1, { nfsd_ro_t nfsd_rw_t })
+
+	files_list_tmp($1)
+	admin_pattern($1, gssd_tmp_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/rpc.te refpolicy/policy/modules/contrib/rpc.te
--- refpolicy/policy/modules/contrib/rpc.te	2012-07-25 20:33:05.000000000 +0200
+++ refpolicy/policy/modules/contrib/rpc.te	2012-11-01 22:21:34.250790062 +0100
@@ -1,4 +1,4 @@
-policy_module(rpc, 1.14.0)
+policy_module(rpc, 1.14.4)
 
 ########################################
 #
@@ -6,21 +6,25 @@
 #
 
 ## <desc>
-## <p>
-## Allow gssd to read temp directory.  For access to kerberos tgt.
-## </p>
+##	<p>
+##	Determine whether gssd can read
+##	generic user temporary content.
+##	</p>
 ## </desc>
-gen_tunable(allow_gssd_read_tmp, true)
+gen_tunable(allow_gssd_read_tmp, false)
 
 ## <desc>
-## <p>
-## Allow nfs servers to modify public files
-## used for public file transfer services.  Files/Directories must be
-## labeled public_content_rw_t.
-## </p>
+##	<p>
+##	Determine whether nfs can modify
+##	public files used for public file
+##	transfer services. Directories/Files must
+##	be labeled public_content_rw_t.
+##	</p>
 ## </desc>
 gen_tunable(allow_nfsd_anon_write, false)
 
+attribute rpc_domain;
+
 type exports_t;
 files_config_file(exports_t)
 
@@ -32,8 +36,6 @@
 type rpcd_var_run_t;
 files_pid_file(rpcd_var_run_t)
 
-# rpcd_t is the domain of rpc daemons.
-# rpc_exec_t is the type of rpc daemon programs.
 rpc_domain_template(rpcd)
 
 type rpcd_initrc_exec_t;
@@ -55,23 +57,90 @@
 
 ########################################
 #
-# RPC local policy
+# Common rpc domain local policy
+#
+
+dontaudit rpc_domain self:capability { net_admin sys_tty_config };
+allow rpc_domain self:capability net_bind_service;
+allow rpc_domain self:process signal_perms;
+allow rpc_domain self:unix_stream_socket { accept listen };
+allow rpc_domain self:tcp_socket { accept listen };
+
+manage_dirs_pattern(rpc_domain, var_lib_nfs_t, var_lib_nfs_t)
+manage_files_pattern(rpc_domain, var_lib_nfs_t, var_lib_nfs_t)
+
+kernel_read_system_state(rpc_domain)
+kernel_read_kernel_sysctls(rpc_domain)
+kernel_rw_rpc_sysctls(rpc_domain)
+
+dev_read_sysfs(rpc_domain)
+dev_read_urand(rpc_domain)
+dev_read_rand(rpc_domain)
+
+corenet_all_recvfrom_unlabeled(rpc_domain)
+corenet_all_recvfrom_netlabel(rpc_domain)
+corenet_tcp_sendrecv_generic_if(rpc_domain)
+corenet_udp_sendrecv_generic_if(rpc_domain)
+corenet_tcp_sendrecv_generic_node(rpc_domain)
+corenet_udp_sendrecv_generic_node(rpc_domain)
+corenet_tcp_sendrecv_all_ports(rpc_domain)
+corenet_udp_sendrecv_all_ports(rpc_domain)
+corenet_tcp_bind_generic_node(rpc_domain)
+corenet_udp_bind_generic_node(rpc_domain)
+
+corenet_sendrecv_all_server_packets(rpc_domain)
+corenet_tcp_bind_reserved_port(rpc_domain)
+corenet_tcp_connect_all_ports(rpc_domain)
+corenet_sendrecv_portmap_client_packets(rpc_domain)
+corenet_dontaudit_tcp_bind_all_ports(rpc_domain)
+corenet_dontaudit_udp_bind_all_ports(rpc_domain)
+corenet_tcp_bind_generic_port(rpc_domain)
+corenet_udp_bind_generic_port(rpc_domain)
+corenet_tcp_bind_all_rpc_ports(rpc_domain)
+corenet_udp_bind_all_rpc_ports(rpc_domain)
+
+fs_rw_rpc_named_pipes(rpc_domain)
+fs_search_auto_mountpoints(rpc_domain)
+
+files_read_etc_runtime_files(rpc_domain)
+files_read_usr_files(rpc_domain)
+files_list_home(rpc_domain)
+
+logging_send_syslog_msg(rpc_domain)
+
+miscfiles_read_localization(rpc_domain)
+
+userdom_dontaudit_use_unpriv_user_fds(rpc_domain)
+
+optional_policy(`
+	rpcbind_stream_connect(rpc_domain)
+')
+
+optional_policy(`
+	seutil_sigchld_newrole(rpc_domain)
+')
+
+optional_policy(`
+	udev_read_db(rpc_domain)
+')
+
+########################################
+#
+# Local policy
 #
 
-allow rpcd_t self:capability { sys_admin chown dac_override setgid setuid };
+allow rpcd_t self:capability { setpcap sys_admin chown dac_override setgid setuid };
+allow rpcd_t self:capability2 block_suspend;
 allow rpcd_t self:process { getcap setcap };
 allow rpcd_t self:fifo_file rw_fifo_file_perms;
 
-allow rpcd_t rpcd_var_run_t:dir setattr;
+manage_dirs_pattern(rpcd_t, rpcd_var_run_t, rpcd_var_run_t)
 manage_files_pattern(rpcd_t, rpcd_var_run_t, rpcd_var_run_t)
-files_pid_filetrans(rpcd_t, rpcd_var_run_t, file)
+files_pid_filetrans(rpcd_t, rpcd_var_run_t, { file dir })
 
-# rpc.statd executes sm-notify
 can_exec(rpcd_t, rpcd_exec_t)
 
-kernel_read_system_state(rpcd_t)
 kernel_read_network_state(rpcd_t)
-# for rpc.rquotad
 kernel_read_sysctl(rpcd_t)
 kernel_rw_fs_sysctls(rpcd_t)
 kernel_dontaudit_getattr_core_if(rpcd_t)
@@ -87,6 +156,7 @@
 fs_read_rpc_symlinks(rpcd_t)
 fs_rw_rpc_sockets(rpcd_t)
 fs_get_all_fs_quotas(rpcd_t)
+fs_set_xattr_fs_quotas(rpcd_t)
 fs_getattr_all_fs(rpcd_t)
 
 storage_getattr_fixed_disk_dev(rpcd_t)
@@ -97,6 +167,8 @@
 
 seutil_dontaudit_search_config(rpcd_t)
 
+userdom_signal_all_users(rpcd_t)
+
 optional_policy(`
 	automount_signal(rpcd_t)
 	automount_dontaudit_write_pipes(rpcd_t)
@@ -106,6 +178,18 @@
 	nis_read_ypserv_config(rpcd_t)
 ')
 
+optional_policy(`
+	quota_manage_db_files(rpcd_t)
+')
+
+optional_policy(`
+	rgmanager_manage_tmp_files(rpcd_t)
+')
+
+optional_policy(`
+	unconfined_signal(rpcd_t)
+')
+
 ########################################
 #
 # NFSD local policy
@@ -116,39 +200,40 @@
 allow nfsd_t exports_t:file read_file_perms;
 allow nfsd_t { nfsd_rw_t nfsd_ro_t }:dir list_dir_perms;
 
-# for /proc/fs/nfs/exports - should we have a new type?
-kernel_read_system_state(nfsd_t)
 kernel_read_network_state(nfsd_t)
 kernel_dontaudit_getattr_core_if(nfsd_t)
+kernel_setsched(nfsd_t)
+kernel_request_load_module(nfsd_t)
+# kernel_mounton_proc(nfsd_t)
+
+corenet_sendrecv_nfs_server_packets(nfsd_t)
+corenet_tcp_bind_nfs_port(nfsd_t)
+corenet_udp_bind_nfs_port(nfsd_t)
 
-corenet_tcp_bind_all_rpc_ports(nfsd_t)
-corenet_udp_bind_all_rpc_ports(nfsd_t)
+corecmd_exec_shell(nfsd_t)
 
 dev_dontaudit_getattr_all_blk_files(nfsd_t)
 dev_dontaudit_getattr_all_chr_files(nfsd_t)
 dev_rw_lvm_control(nfsd_t)
 
-# does not really need this, but it is easier to just allow it
-files_search_pids(nfsd_t)
-# for exportfs and rpc.mountd
 files_getattr_tmp_dirs(nfsd_t)
-# cjp: this should really have its own type
 files_manage_mounttab(nfsd_t)
-files_read_etc_runtime_files(nfsd_t)
 
 fs_mount_nfsd_fs(nfsd_t)
-fs_search_nfsd_fs(nfsd_t)
 fs_getattr_all_fs(nfsd_t)
 fs_getattr_all_dirs(nfsd_t)
 fs_rw_nfsd_fs(nfsd_t)
+# fs_manage_nfsd_fs(nfsd_t)
 
 storage_dontaudit_read_fixed_disk(nfsd_t)
 storage_raw_read_removable_device(nfsd_t)
 
-# Read access to public_content_t and public_content_rw_t
 miscfiles_read_public_files(nfsd_t)
 
-# Write access to public_content_t and public_content_rw_t
+ifdef(`distro_gentoo',`
+	allow nfsd_t self:udp_socket listen;
+')
+
 tunable_policy(`allow_nfsd_anon_write',`
 	miscfiles_manage_public_files(nfsd_t)
 ')
@@ -174,6 +259,10 @@
 	files_read_non_auth_files(nfsd_t)
 ')
 
+optional_policy(`
+	mount_exec(nfsd_t)
+')
+
 ########################################
 #
 # GSSD local policy
@@ -181,13 +270,12 @@
 
 allow gssd_t self:capability { dac_override dac_read_search setuid sys_nice };
 allow gssd_t self:process { getsched setsched };
-allow gssd_t self:fifo_file rw_file_perms;
+allow gssd_t self:fifo_file rw_fifo_file_perms;
 
 manage_dirs_pattern(gssd_t, gssd_tmp_t, gssd_tmp_t)
 manage_files_pattern(gssd_t, gssd_tmp_t, gssd_tmp_t)
 files_tmp_filetrans(gssd_t, gssd_tmp_t, { file dir })
 
-kernel_read_system_state(gssd_t)
 kernel_read_network_state(gssd_t)
 kernel_read_network_state_symlinks(gssd_t)
 kernel_request_load_module(gssd_t)
@@ -196,22 +284,19 @@
 
 corecmd_exec_bin(gssd_t)
 
+fs_list_inotifyfs(gssd_t)
 fs_list_rpc(gssd_t)
 fs_rw_rpc_sockets(gssd_t)
 fs_read_rpc_files(gssd_t)
+fs_read_nfs_files(gssd_t)
 
-fs_list_inotifyfs(gssd_t)
 files_list_tmp(gssd_t)
-files_read_usr_symlinks(gssd_t)
 files_dontaudit_write_var_dirs(gssd_t)
 
-auth_use_nsswitch(gssd_t)
 auth_manage_cache(gssd_t)
 
 miscfiles_read_generic_certs(gssd_t)
 
-mount_signal(gssd_t)
-
 userdom_signal_all_users(gssd_t)
 
 tunable_policy(`allow_gssd_read_tmp',`
@@ -226,10 +311,16 @@
 
 optional_policy(`
 	kerberos_keytab_template(gssd, gssd_t)
+	kerberos_manage_host_rcache(gssd_t)
+	kerberos_tmp_filetrans_host_rcache(gssd_t, file, "nfs_0")
+')
+
+optional_policy(`
+	mount_signal(gssd_t)
 ')
 
 optional_policy(`
-	pcscd_read_pub_files(gssd_t)
+	pcscd_read_pid_files(gssd_t)
 ')
 
 optional_policy(`
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/rpcbind.fc refpolicy/policy/modules/contrib/rpcbind.fc
--- refpolicy/policy/modules/contrib/rpcbind.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/rpcbind.fc	2012-10-27 13:02:48.181002117 +0200
@@ -1,9 +1,12 @@
 /etc/rc\.d/init\.d/rpcbind	--	gen_context(system_u:object_r:rpcbind_initrc_exec_t,s0)
 
-/sbin/rpcbind		--	gen_context(system_u:object_r:rpcbind_exec_t,s0)
+/sbin/rpcbind	--	gen_context(system_u:object_r:rpcbind_exec_t,s0)
 
-/var/lib/rpcbind(/.*)?		gen_context(system_u:object_r:rpcbind_var_lib_t,s0)
+/usr/sbin/rpcbind	--	gen_context(system_u:object_r:rpcbind_exec_t,s0)
+
+/var/cache/rpcbind(/.*)?	gen_context(system_u:object_r:rpcbind_var_lib_t,s0)
+
+/var/lib/rpcbind(/.*)?	gen_context(system_u:object_r:rpcbind_var_lib_t,s0)
 
 /var/run/rpc.statd\.pid	--	gen_context(system_u:object_r:rpcbind_var_run_t,s0)
-/var/run/rpcbind\.lock	--	gen_context(system_u:object_r:rpcbind_var_run_t,s0)
-/var/run/rpcbind\.sock	-s	gen_context(system_u:object_r:rpcbind_var_run_t,s0)
+/var/run/rpcbind.*	gen_context(system_u:object_r:rpcbind_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/rpcbind.if refpolicy/policy/modules/contrib/rpcbind.if
--- refpolicy/policy/modules/contrib/rpcbind.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/rpcbind.if	2012-10-27 13:02:48.199002117 +0200
@@ -1,4 +1,4 @@
-## <summary>Universal Addresses to RPC Program Number Mapper</summary>
+## <summary>Universal Addresses to RPC Program Number Mapper.</summary>
 
 ########################################
 ## <summary>
@@ -15,12 +15,14 @@
 		type rpcbind_t, rpcbind_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, rpcbind_exec_t, rpcbind_t)
 ')
 
 ########################################
 ## <summary>
-##	Connect to rpcbindd over an unix stream socket.
+##	Connect to rpcbindd with a
+##	unix domain stream socket.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -34,13 +36,12 @@
 	')
 
 	files_search_pids($1)
-	allow $1 rpcbind_var_run_t:sock_file write;
-	allow $1 rpcbind_t:unix_stream_socket connectto;
+	stream_connect_pattern($1, rpcbind_var_run_t, rpcbind_var_run_t, rpcbind_t)
 ')
 
 ########################################
 ## <summary>
-##	Read rpcbind PID files.
+##	Read rpcbind pid files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -72,8 +73,8 @@
 		type rpcbind_var_lib_t;
 	')
 
-	allow $1 rpcbind_var_lib_t:dir search_dir_perms;
 	files_search_var_lib($1)
+	allow $1 rpcbind_var_lib_t:dir search_dir_perms;
 ')
 
 ########################################
@@ -91,8 +92,8 @@
 		type rpcbind_var_lib_t;
 	')
 
-	read_files_pattern($1, rpcbind_var_lib_t, rpcbind_var_lib_t)
 	files_search_var_lib($1)
+	read_files_pattern($1, rpcbind_var_lib_t, rpcbind_var_lib_t)
 ')
 
 ########################################
@@ -111,14 +112,32 @@
 		type rpcbind_var_lib_t;
 	')
 
-	manage_files_pattern($1, rpcbind_var_lib_t, rpcbind_var_lib_t)
 	files_search_var_lib($1)
+	manage_files_pattern($1, rpcbind_var_lib_t, rpcbind_var_lib_t)
+')
+
+########################################
+## <summary>
+##	Send null signals to rpcbind.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`rpcbind_signull',`
+	gen_require(`
+		type rpcbind_t;
+	')
+
+	allow $1 rpcbind_t:process signull;
 ')
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate
-##	an rpcbind environment
+##	All of the rules required to
+##	administrate an rpcbind environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -127,7 +146,7 @@
 ## </param>
 ## <param name="role">
 ##	<summary>
-##	The role to be allowed to manage the rpcbind domain.
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <rolecap/>
@@ -145,4 +164,10 @@
 	domain_system_change_exemption($1)
 	role_transition $2 rpcbind_initrc_exec_t system_r;
 	allow $2 system_r;
+
+	files_search_pids($1)
+	admin_pattern($1, rpcbind_var_run_t)
+
+	files_search_var_lib($1)
+	admin_pattern($1, rpcbind_var_lib_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/rpcbind.te refpolicy/policy/modules/contrib/rpcbind.te
--- refpolicy/policy/modules/contrib/rpcbind.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/rpcbind.te	2012-10-27 13:02:48.199002117 +0200
@@ -1,4 +1,4 @@
-policy_module(rpcbind, 1.5.0)
+policy_module(rpcbind, 1.5.3)
 
 ########################################
 #
@@ -20,15 +20,13 @@
 
 ########################################
 #
-# rpcbind local policy
+# Local policy
 #
 
 allow rpcbind_t self:capability { dac_override setgid setuid sys_tty_config };
-allow rpcbind_t self:fifo_file rw_file_perms;
-allow rpcbind_t self:unix_stream_socket create_stream_socket_perms;
-allow rpcbind_t self:netlink_route_socket r_netlink_socket_perms;
-allow rpcbind_t self:udp_socket create_socket_perms;
-allow rpcbind_t self:tcp_socket create_stream_socket_perms;
+allow rpcbind_t self:fifo_file rw_fifo_file_perms;
+allow rpcbind_t self:unix_stream_socket { accept listen };
+allow rpcbind_t self:tcp_socket { accept listen };
 
 manage_files_pattern(rpcbind_t, rpcbind_var_run_t, rpcbind_var_run_t)
 manage_sock_files_pattern(rpcbind_t, rpcbind_var_run_t, rpcbind_var_run_t)
@@ -53,10 +51,14 @@
 corenet_udp_sendrecv_all_ports(rpcbind_t)
 corenet_tcp_bind_generic_node(rpcbind_t)
 corenet_udp_bind_generic_node(rpcbind_t)
+
+corenet_sendrecv_all_server_packets(rpcbind_t)
 corenet_tcp_bind_portmap_port(rpcbind_t)
 corenet_udp_bind_portmap_port(rpcbind_t)
 corenet_udp_bind_all_rpc_ports(rpcbind_t)
 
+corecmd_exec_shell(rpcbind_t)
+
 domain_use_interactive_fds(rpcbind_t)
 
 files_read_etc_files(rpcbind_t)
@@ -67,3 +69,7 @@
 miscfiles_read_localization(rpcbind_t)
 
 sysnet_dns_name_resolve(rpcbind_t)
+
+optional_policy(`
+	nis_use_ypbind(rpcbind_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/rpm.fc refpolicy/policy/modules/contrib/rpm.fc
--- refpolicy/policy/modules/contrib/rpm.fc	2012-06-26 16:05:01.000000000 +0200
+++ refpolicy/policy/modules/contrib/rpm.fc	2012-10-27 13:02:51.713002124 +0200
@@ -1,55 +1,61 @@
+/bin/rpm	--	gen_context(system_u:object_r:rpm_exec_t,s0)
 
-/bin/rpm 			--	gen_context(system_u:object_r:rpm_exec_t,s0)
+/etc/rc\.d/init\.d/bcfg2	--	gen_context(system_u:object_r:rpm_initrc_exec_t,s0)
 
-/usr/bin/debuginfo-install	--	gen_context(system_u:object_r:debuginfo_exec_t,s0)
-/usr/bin/rpm 			--	gen_context(system_u:object_r:rpm_exec_t,s0)
-/usr/bin/smart 			--	gen_context(system_u:object_r:rpm_exec_t,s0)
+/sbin/yast2	--	gen_context(system_u:object_r:rpm_exec_t,s0)
 
-/usr/bin/yum 			--	gen_context(system_u:object_r:rpm_exec_t,s0)
+/usr/bin/debuginfo-install	--	gen_context(system_u:object_r:debuginfo_exec_t,s0)
+/usr/bin/fedora-rmdevelrpms	--	gen_context(system_u:object_r:rpm_exec_t,s0)
+/usr/bin/online_update	--	gen_context(system_u:object_r:rpm_exec_t,s0)
+/usr/bin/rpmdev-rmdevelrpms	--	gen_context(system_u:object_r:rpm_exec_t,s0)
+/usr/bin/rpm	--	gen_context(system_u:object_r:rpm_exec_t,s0)
+/usr/bin/smart	--	gen_context(system_u:object_r:rpm_exec_t,s0)
+/usr/bin/yum	--	gen_context(system_u:object_r:rpm_exec_t,s0)
+/usr/bin/zif	--	gen_context(system_u:object_r:rpm_exec_t,s0)
 
 /usr/libexec/packagekitd	--	gen_context(system_u:object_r:rpm_exec_t,s0)
 /usr/libexec/yumDBUSBackend.py	--	gen_context(system_u:object_r:rpm_exec_t,s0)
 
-/usr/sbin/yum-complete-transaction --	gen_context(system_u:object_r:rpm_exec_t,s0)
+/usr/sbin/bcfg2	--	gen_context(system_u:object_r:rpm_exec_t,s0)
+/usr/sbin/pirut	--	gen_context(system_u:object_r:rpm_exec_t,s0)
+/usr/sbin/pup	--	gen_context(system_u:object_r:rpm_exec_t,s0)
+/usr/sbin/rhn_check	--	gen_context(system_u:object_r:rpm_exec_t,s0)
+/usr/sbin/up2date	--	gen_context(system_u:object_r:rpm_exec_t,s0)
+/usr/sbin/yum-complete-transaction	--	gen_context(system_u:object_r:rpm_exec_t,s0)
+/usr/sbin/system-install-packages	--	gen_context(system_u:object_r:rpm_exec_t,s0)
+/usr/sbin/yum-updatesd	--	gen_context(system_u:object_r:rpm_exec_t,s0)
+/usr/sbin/packagekitd	--	gen_context(system_u:object_r:rpm_exec_t,s0)
+
+ifdef(`distro_redhat',`
+/usr/bin/apt-get	--	gen_context(system_u:object_r:rpm_exec_t,s0)
+/usr/bin/apt-shell	--	gen_context(system_u:object_r:rpm_exec_t,s0)
+/usr/bin/aptitude	--	gen_context(system_u:object_r:rpm_exec_t,s0)
+/usr/sbin/synaptic	--	gen_context(system_u:object_r:rpm_exec_t,s0)
+')
 
-/usr/sbin/system-install-packages --	gen_context(system_u:object_r:rpm_exec_t,s0)
-/usr/sbin/yum-updatesd		--	gen_context(system_u:object_r:rpm_exec_t,s0)
-/usr/sbin/packagekitd		--	gen_context(system_u:object_r:rpm_exec_t,s0)
+/usr/share/yumex/yumex-yum-backend	--	gen_context(system_u:object_r:rpm_exec_t,s0)
+/usr/share/yumex/yum_childtask\.py	--	gen_context(system_u:object_r:rpm_exec_t,s0)
 
-/usr/share/yumex/yumex-yum-backend --	gen_context(system_u:object_r:rpm_exec_t,s0)
-/usr/share/yumex/yum_childtask\.py --	gen_context(system_u:object_r:rpm_exec_t,s0)
+/var/cache/bcfg2(/.*)?	gen_context(system_u:object_r:rpm_var_cache_t,s0)
+/var/cache/PackageKit(/.*)?	gen_context(system_u:object_r:rpm_var_cache_t,s0)
+/var/cache/yum(/.*)?	gen_context(system_u:object_r:rpm_var_cache_t,s0)
 
-ifdef(`distro_redhat', `
-/usr/bin/fedora-rmdevelrpms	--	gen_context(system_u:object_r:rpm_exec_t,s0)
-/usr/bin/rpmdev-rmdevelrpms	--	gen_context(system_u:object_r:rpm_exec_t,s0)
-/usr/sbin/pirut			--	gen_context(system_u:object_r:rpm_exec_t,s0)
-/usr/sbin/pup			--	gen_context(system_u:object_r:rpm_exec_t,s0)
-/usr/sbin/rhn_check		--	gen_context(system_u:object_r:rpm_exec_t,s0)
-/usr/sbin/up2date		--	gen_context(system_u:object_r:rpm_exec_t,s0)
-')
+/var/lib/alternatives(/.*)?	gen_context(system_u:object_r:rpm_var_lib_t,s0)
+/var/lib/PackageKit(/.*)?	gen_context(system_u:object_r:rpm_var_lib_t,s0)
+/var/lib/rpm(/.*)?	gen_context(system_u:object_r:rpm_var_lib_t,s0)
+/var/lib/YaST2(/.*)?	gen_context(system_u:object_r:rpm_var_lib_t,s0)
+/var/lib/yum(/.*)?	gen_context(system_u:object_r:rpm_var_lib_t,s0)
 
-/var/cache/PackageKit(/.*)?		gen_context(system_u:object_r:rpm_var_cache_t,s0)
-/var/cache/yum(/.*)?			gen_context(system_u:object_r:rpm_var_cache_t,s0)
+/var/lock/bcfg2\.run	--	gen_context(system_u:object_r:rpm_lock_t,s0)
 
-/var/lib/alternatives(/.*)?		gen_context(system_u:object_r:rpm_var_lib_t,s0)
-/var/lib/PackageKit(/.*)?		gen_context(system_u:object_r:rpm_var_lib_t,s0)
-/var/lib/rpm(/.*)?			gen_context(system_u:object_r:rpm_var_lib_t,s0)
-/var/lib/yum(/.*)?			gen_context(system_u:object_r:rpm_var_lib_t,s0)
-
-/var/log/rpmpkgs.*		--	gen_context(system_u:object_r:rpm_log_t,s0)
-/var/log/yum\.log.*		--	gen_context(system_u:object_r:rpm_log_t,s0)
-
-/var/run/yum.*			--	gen_context(system_u:object_r:rpm_var_run_t,s0)
-/var/run/PackageKit(/.*)?		gen_context(system_u:object_r:rpm_var_run_t,s0)
-
-# SuSE
-ifdef(`distro_suse', `
-/usr/bin/online_update		--	gen_context(system_u:object_r:rpm_exec_t,s0)
-/sbin/yast2			--	gen_context(system_u:object_r:rpm_exec_t,s0)
-/var/lib/YaST2(/.*)?			gen_context(system_u:object_r:rpm_var_lib_t,s0)
-/var/log/YaST2(/.*)?			gen_context(system_u:object_r:rpm_log_t,s0)
-')
+/var/log/YaST2(/.*)?	gen_context(system_u:object_r:rpm_log_t,s0)
+/var/log/yum\.log.*	--	gen_context(system_u:object_r:rpm_log_t,s0)
+
+/var/spool/up2date(/.*)?	gen_context(system_u:object_r:rpm_var_cache_t,s0)
+
+/var/run/yum.*	--	gen_context(system_u:object_r:rpm_var_run_t,s0)
+/var/run/PackageKit(/.*)?	gen_context(system_u:object_r:rpm_var_run_t,s0)
 
 ifdef(`enable_mls',`
-/sbin/cpio			--	gen_context(system_u:object_r:rpm_exec_t,s0)
+/usr/sbin/cpio	--	gen_context(system_u:object_r:rpm_exec_t,s0)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/rpm.if refpolicy/policy/modules/contrib/rpm.if
--- refpolicy/policy/modules/contrib/rpm.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/rpm.if	2012-10-27 13:02:51.722002122 +0200
@@ -1,8 +1,8 @@
-## <summary>Policy for the RPM package manager.</summary>
+## <summary>Redhat package manager.</summary>
 
 ########################################
 ## <summary>
-##	Execute rpm programs in the rpm domain.
+##	Execute rpm in the rpm domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -21,7 +21,8 @@
 
 ########################################
 ## <summary>
-##	Execute debuginfo_install programs in the rpm domain.
+##	Execute debuginfo install
+##	in the rpm domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -40,7 +41,7 @@
 
 ########################################
 ## <summary>
-##	Execute rpm_script programs in the rpm_script domain.
+##	Execute rpm scripts in the rpm script domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -53,16 +54,18 @@
 		type rpm_script_t;
 	')
 
-	# transition to rpm script:
 	corecmd_shell_domtrans($1, rpm_script_t)
+
 	allow rpm_script_t $1:fd use;
-	allow rpm_script_t $1:fifo_file rw_file_perms;
+	allow rpm_script_t $1:fifo_file rw_fifo_file_perms;
 	allow rpm_script_t $1:process sigchld;
 ')
 
 ########################################
 ## <summary>
-##	Execute RPM programs in the RPM domain.
+##	Execute rpm in the rpm domain,
+##	and allow the specified roles the
+##	rpm domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -71,7 +74,7 @@
 ## </param>
 ## <param name="role">
 ##	<summary>
-##	The role to allow the RPM domain.
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <rolecap/>
@@ -87,7 +90,7 @@
 
 ########################################
 ## <summary>
-##	Execute the rpm client in the caller domain.
+##	Execute the rpm in the caller domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -106,7 +109,7 @@
 
 ########################################
 ## <summary>
-##	Send a null signal to rpm.
+##	Send null signals to rpm.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -124,7 +127,7 @@
 
 ########################################
 ## <summary>
-##	Inherit and use file descriptors from RPM.
+##	Inherit and use file descriptors from rpm.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -142,7 +145,7 @@
 
 ########################################
 ## <summary>
-##	Read from an unnamed RPM pipe.
+##	Read rpm unnamed pipes.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -160,7 +163,7 @@
 
 ########################################
 ## <summary>
-##	Read and write an unnamed RPM pipe.
+##	Read and write rpm unnamed pipes.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -221,7 +224,7 @@
 ########################################
 ## <summary>
 ##	Send and receive messages from
-##	rpm_script over dbus.
+##	rpm script over dbus.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -241,7 +244,7 @@
 
 ########################################
 ## <summary>
-##	Search RPM log directory.
+##	Search rpm log directories.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -260,8 +263,7 @@
 
 #####################################
 ## <summary>
-##	Allow the specified domain to append
-##	to rpm log files.
+##	Append rpm log files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -280,7 +282,8 @@
 
 ########################################
 ## <summary>
-##	Create, read, write, and delete the RPM log.
+##	Create, read, write, and delete
+##	rpm log files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -299,7 +302,7 @@
 
 ########################################
 ## <summary>
-##	Inherit and use file descriptors from RPM scripts.
+##	Inherit and use rpm script file descriptors.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -317,8 +320,8 @@
 
 ########################################
 ## <summary>
-##	Create, read, write, and delete RPM
-##	script temporary files.
+##	Create, read, write, and delete
+##	rpm script temporary files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -337,8 +340,7 @@
 
 #####################################
 ## <summary>
-##	Allow the specified domain to append
-##	to rpm tmp files.
+##	Append rpm temporary files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -357,8 +359,8 @@
 
 ########################################
 ## <summary>
-##	Create, read, write, and delete RPM
-##	 temporary files.
+##	Create, read, write, and delete
+##	rpm temporary files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -377,7 +379,7 @@
 
 ########################################
 ## <summary>
-##	Read RPM script temporary files.
+##	Read rpm script temporary files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -397,7 +399,7 @@
 
 ########################################
 ## <summary>
-##	Read the RPM cache.
+##	Read rpm cache content.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -418,7 +420,8 @@
 
 ########################################
 ## <summary>
-##	Create, read, write, and delete the RPM package database.
+##	Create, read, write, and delete
+##	rpm cache content.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -439,7 +442,7 @@
 
 ########################################
 ## <summary>
-##	Read the RPM package database.
+##	Read rpm lib content.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -460,7 +463,7 @@
 
 ########################################
 ## <summary>
-##	Delete the RPM package database.
+##	Delete rpm lib files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -479,7 +482,8 @@
 
 ########################################
 ## <summary>
-##	Create, read, write, and delete the RPM package database.
+##	Create, read, write, and delete
+##	rpm lib files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -500,7 +504,7 @@
 ########################################
 ## <summary>
 ##	Do not audit attempts to create, read,
-##	write, and delete the RPM package database.
+##	write, and delete rpm lib content.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -539,7 +543,8 @@
 
 #####################################
 ## <summary>
-##	Create, read, write, and delete rpm pid files.
+##	Create, read, write, and delete
+##	rpm pid files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -558,7 +563,8 @@
 
 ######################################
 ## <summary>
-##	Create files in /var/run with the rpm pid file type.
+##	Create files in pid directories
+##	with the rpm pid file type.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -567,9 +573,94 @@
 ## </param>
 #
 interface(`rpm_pid_filetrans',`
+	refpolicywarn(`$0($*) has been deprecated, rpm_pid_filetrans_rpm_pid() instead.')
+	rpm_pid_filetrans_rpm_pid($1, file)
+')
+
+########################################
+## <summary>
+##	Create specified objects in pid directories
+##	with the rpm pid file type.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="object_class">
+##	<summary>
+##	Class of the object being created.
+##	</summary>
+## </param>
+## <param name="name" optional="true">
+##	<summary>
+##	The name of the object being created.
+##	</summary>
+## </param>
+#
+interface(`rpm_pid_filetrans_rpm_pid',`
 	gen_require(`
 		type rpm_var_run_t;
 	')
 
-	files_pid_filetrans($1, rpm_var_run_t, file)
+	files_pid_filetrans($1, rpm_var_run_t, $3, $4)
+')
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an rpm environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`rpm_admin',`
+	gen_require(`
+		type rpm_t, rpm_script_t, rpm_initrc_exec_t;
+		type rpm_var_cache_t, rpm_var_lib_t, rpm_lock_t;
+		type rpm_log_t, rpm_tmpfs_t, rpm_tmp_t;
+		type rpm_script_tmp_t, rpm_script_tmpfs_t, rpm_file_t;
+	')
+
+	allow $1 { rpm_t rpm_script_t }:process { ptrace signal_perms };
+	ps_process_pattern($1, { rpm_t rpm_script_t })
+
+	init_labeled_script_domtrans($1, rpm_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 rpm_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	admin_pattern($1, rpm_file_t)
+
+	files_list_var($1)
+	admin_pattern($1, rpm_cache_t)
+
+	files_list_tmp($1)
+	admin_pattern($1, { rpm_tmp_t rpm_script_tmp_t })
+
+	files_list_var_lib($1)
+	admin_pattern($1, rpm_var_lib_t)
+
+	files_search_locks($1)
+	admin_pattern($1, rpm_lock_t)
+
+	logging_list_logs($1)
+	admin_pattern($1, rpm_log_t)
+
+	files_list_pids($1)
+	admin_pattern($1, rpm_var_run_t)
+
+	fs_search_tmpfs($1)
+	admin_pattern($1, { rpm_tmpfs_t rpm_script_tmpfs_t }
+
+	rpm_run($1, $2)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/rpm.te refpolicy/policy/modules/contrib/rpm.te
--- refpolicy/policy/modules/contrib/rpm.te	2012-07-25 20:33:05.000000000 +0200
+++ refpolicy/policy/modules/contrib/rpm.te	2012-10-30 20:17:14.184405293 +0100
@@ -1,4 +1,4 @@
-policy_module(rpm, 1.15.0)
+policy_module(rpm, 1.15.3)
 
 ########################################
 #
@@ -19,6 +19,9 @@
 domain_interactive_fd(rpm_t)
 role rpm_roles types rpm_t;
 
+type rpm_initrc_exec_t;
+init_script_file(rpm_initrc_exec_t)
+
 type rpm_file_t;
 files_type(rpm_file_t)
 
@@ -28,6 +31,9 @@
 type rpm_tmpfs_t;
 files_tmpfs_file(rpm_tmpfs_t)
 
+type rpm_lock_t;
+files_lock_file(rpm_lock_t)
+
 type rpm_log_t;
 logging_log_file(rpm_log_t)
 
@@ -69,25 +75,23 @@
 allow rpm_t self:process { getattr setexec setfscreate setrlimit };
 allow rpm_t self:fd use;
 allow rpm_t self:fifo_file rw_fifo_file_perms;
-allow rpm_t self:unix_dgram_socket create_socket_perms;
-allow rpm_t self:unix_stream_socket rw_stream_socket_perms;
 allow rpm_t self:unix_dgram_socket sendto;
-allow rpm_t self:unix_stream_socket connectto;
-allow rpm_t self:udp_socket { connect };
-allow rpm_t self:udp_socket create_socket_perms;
-allow rpm_t self:tcp_socket create_stream_socket_perms;
+allow rpm_t self:unix_stream_socket { accept connectto listen };
+allow rpm_t self:udp_socket connect;
+allow rpm_t self:tcp_socket { accept listen };
 allow rpm_t self:shm create_shm_perms;
 allow rpm_t self:sem create_sem_perms;
 allow rpm_t self:msgq create_msgq_perms;
 allow rpm_t self:msg { send receive };
+allow rpm_t self:file rw_file_perms;
+allow rpm_t self:netlink_kobject_uevent_socket create_socket_perms;
 
-allow rpm_t rpm_log_t:file manage_file_perms;
+allow rpm_t rpm_log_t:file { append_file_perms create_file_perms setattr_file_perms };
 logging_log_filetrans(rpm_t, rpm_log_t, file)
 
 manage_dirs_pattern(rpm_t, rpm_tmp_t, rpm_tmp_t)
 manage_files_pattern(rpm_t, rpm_tmp_t, rpm_tmp_t)
 files_tmp_filetrans(rpm_t, rpm_tmp_t, { file dir })
-can_exec(rpm_t, rpm_tmp_t)
 
 manage_dirs_pattern(rpm_t, rpm_tmpfs_t, rpm_tmpfs_t)
 manage_files_pattern(rpm_t, rpm_tmpfs_t, rpm_tmpfs_t)
@@ -95,42 +99,68 @@
 manage_fifo_files_pattern(rpm_t, rpm_tmpfs_t, rpm_tmpfs_t)
 manage_sock_files_pattern(rpm_t, rpm_tmpfs_t, rpm_tmpfs_t)
 fs_tmpfs_filetrans(rpm_t, rpm_tmpfs_t, { dir file lnk_file sock_file fifo_file })
-can_exec(rpm_t, rpm_tmpfs_t)
 
 manage_dirs_pattern(rpm_t, rpm_var_cache_t, rpm_var_cache_t)
 manage_files_pattern(rpm_t, rpm_var_cache_t, rpm_var_cache_t)
 files_var_filetrans(rpm_t, rpm_var_cache_t, dir)
 
-# Access /var/lib/rpm files
+manage_files_pattern(rpm_t, rpm_lock_t, rpm_lock_t)
+files_lock_filetrans(rpm_t, rpm_lock_t, file)
+
+manage_dirs_pattern(rpm_t, rpm_var_lib_t, rpm_var_lib_t)
 manage_files_pattern(rpm_t, rpm_var_lib_t, rpm_var_lib_t)
-files_var_lib_filetrans(rpm_t, rpm_var_lib_t, dir)
+files_var_lib_filetrans(rpm_t, rpm_var_lib_t, { dir file })
 
+manage_dirs_pattern(rpm_t, rpm_var_run_t, rpm_var_run_t)
 manage_files_pattern(rpm_t, rpm_var_run_t, rpm_var_run_t)
-files_pid_filetrans(rpm_t, rpm_var_run_t, file)
+files_pid_filetrans(rpm_t, rpm_var_run_t, { dir file })
+
+can_exec(rpm_t, { rpm_tmp_t rpm_tmpfs_t })
 
 kernel_read_crypto_sysctls(rpm_t)
 kernel_read_network_state(rpm_t)
 kernel_read_system_state(rpm_t)
 kernel_read_kernel_sysctls(rpm_t)
+kernel_read_network_state_symlinks(rpm_t)
+kernel_rw_irq_sysctls(rpm_t)
 
 corecmd_exec_all_executables(rpm_t)
 
 corenet_all_recvfrom_unlabeled(rpm_t)
 corenet_all_recvfrom_netlabel(rpm_t)
 corenet_tcp_sendrecv_generic_if(rpm_t)
-corenet_raw_sendrecv_generic_if(rpm_t)
-corenet_udp_sendrecv_generic_if(rpm_t)
 corenet_tcp_sendrecv_generic_node(rpm_t)
-corenet_raw_sendrecv_generic_node(rpm_t)
-corenet_udp_sendrecv_generic_node(rpm_t)
 corenet_tcp_sendrecv_all_ports(rpm_t)
-corenet_udp_sendrecv_all_ports(rpm_t)
-corenet_tcp_connect_all_ports(rpm_t)
+
 corenet_sendrecv_all_client_packets(rpm_t)
+corenet_tcp_connect_all_ports(rpm_t)
 
 dev_list_sysfs(rpm_t)
 dev_list_usbfs(rpm_t)
 dev_read_urand(rpm_t)
+dev_read_raw_memory(rpm_t)
+
+dev_manage_all_dev_nodes(rpm_t)
+dev_relabel_all_dev_nodes(rpm_t)
+
+dev_create_generic_blk_files(rpm_t)
+dev_create_generic_chr_files(rpm_t)
+
+domain_read_all_domains_state(rpm_t)
+domain_getattr_all_domains(rpm_t)
+domain_use_interactive_fds(rpm_t)
+domain_dontaudit_getattr_all_pipes(rpm_t)
+domain_dontaudit_getattr_all_tcp_sockets(rpm_t)
+domain_dontaudit_getattr_all_udp_sockets(rpm_t)
+domain_dontaudit_getattr_all_packet_sockets(rpm_t)
+domain_dontaudit_getattr_all_raw_sockets(rpm_t)
+domain_dontaudit_getattr_all_stream_sockets(rpm_t)
+domain_dontaudit_getattr_all_dgram_sockets(rpm_t)
+domain_signull_all_domains(rpm_t)
+
+files_exec_etc_files(rpm_t)
+files_relabel_non_auth_files(rpm_t)
+files_manage_non_auth_files(rpm_t)
 
 fs_getattr_all_dirs(rpm_t)
 fs_list_inotifyfs(rpm_t)
@@ -153,35 +183,18 @@
 selinux_compute_user_contexts(rpm_t)
 
 storage_raw_write_fixed_disk(rpm_t)
-# for installing kernel packages
 storage_raw_read_fixed_disk(rpm_t)
 
 term_list_ptys(rpm_t)
 
-files_relabel_non_auth_files(rpm_t)
-files_manage_non_auth_files(rpm_t)
 auth_dontaudit_read_shadow(rpm_t)
 auth_use_nsswitch(rpm_t)
 
-# transition to rpm script:
 rpm_domtrans_script(rpm_t)
 
-domain_read_all_domains_state(rpm_t)
-domain_getattr_all_domains(rpm_t)
-domain_dontaudit_ptrace_all_domains(rpm_t)
-domain_use_interactive_fds(rpm_t)
-domain_dontaudit_getattr_all_pipes(rpm_t)
-domain_dontaudit_getattr_all_tcp_sockets(rpm_t)
-domain_dontaudit_getattr_all_udp_sockets(rpm_t)
-domain_dontaudit_getattr_all_packet_sockets(rpm_t)
-domain_dontaudit_getattr_all_raw_sockets(rpm_t)
-domain_dontaudit_getattr_all_stream_sockets(rpm_t)
-domain_dontaudit_getattr_all_dgram_sockets(rpm_t)
-
-files_exec_etc_files(rpm_t)
-
 init_domtrans_script(rpm_t)
 init_use_script_ptys(rpm_t)
+init_signull_script(rpm_t)
 
 libs_exec_ld_so(rpm_t)
 libs_exec_lib_files(rpm_t)
@@ -189,7 +202,6 @@
 
 logging_send_syslog_msg(rpm_t)
 
-# allow compiling and loading new policy
 seutil_manage_src_policy(rpm_t)
 seutil_manage_bin_policy(rpm_t)
 
@@ -211,17 +223,14 @@
 	optional_policy(`
 		networkmanager_dbus_chat(rpm_t)
 	')
-')
 
-optional_policy(`
-	prelink_run(rpm_t, rpm_roles)
+	optional_policy(`
+		unconfined_dbus_chat(rpm_t)
+	')
 ')
 
 optional_policy(`
-	unconfined_domain(rpm_t)
-	# yum-updatesd requires this
-	unconfined_dbus_chat(rpm_t)
-	unconfined_dbus_chat(rpm_script_t)
+	prelink_run(rpm_t, rpm_roles)
 ')
 
 ########################################
@@ -229,20 +238,20 @@
 # rpm-script Local policy
 #
 
-allow rpm_script_t self:capability { chown dac_override dac_read_search fowner fsetid setgid setuid ipc_lock sys_admin sys_chroot sys_ptrace sys_rawio sys_nice mknod kill net_admin };
+allow rpm_script_t self:capability { chown dac_override dac_read_search fowner fsetid setgid setuid ipc_lock sys_admin sys_chroot sys_rawio sys_nice mknod kill net_admin };
 allow rpm_script_t self:process ~{ ptrace setcurrent setexec setfscreate setrlimit execheap };
 allow rpm_script_t self:fd use;
 allow rpm_script_t self:fifo_file rw_fifo_file_perms;
-allow rpm_script_t self:unix_dgram_socket create_socket_perms;
-allow rpm_script_t self:unix_stream_socket rw_stream_socket_perms;
 allow rpm_script_t self:unix_dgram_socket sendto;
-allow rpm_script_t self:unix_stream_socket connectto;
+allow rpm_script_t self:unix_stream_socket { accept connectto listen };
 allow rpm_script_t self:shm create_shm_perms;
 allow rpm_script_t self:sem create_sem_perms;
 allow rpm_script_t self:msgq create_msgq_perms;
 allow rpm_script_t self:msg { send receive };
 allow rpm_script_t self:netlink_kobject_uevent_socket create_socket_perms;
 
+allow rpm_script_t rpm_t:netlink_route_socket { read write };
+
 allow rpm_script_t rpm_tmp_t:file read_file_perms;
 
 allow rpm_script_t rpm_script_tmp_t:dir mounton;
@@ -251,7 +260,6 @@
 manage_blk_files_pattern(rpm_script_t, rpm_script_tmp_t, rpm_script_tmp_t)
 manage_chr_files_pattern(rpm_script_t, rpm_script_tmp_t, rpm_script_tmp_t)
 files_tmp_filetrans(rpm_script_t, rpm_script_tmp_t, { file dir })
-can_exec(rpm_script_t, rpm_script_tmp_t)
 
 manage_dirs_pattern(rpm_script_t, rpm_script_tmpfs_t, rpm_script_tmpfs_t)
 manage_files_pattern(rpm_script_t, rpm_script_tmpfs_t, rpm_script_tmpfs_t)
@@ -259,34 +267,54 @@
 manage_fifo_files_pattern(rpm_script_t, rpm_script_tmpfs_t, rpm_script_tmpfs_t)
 manage_sock_files_pattern(rpm_script_t, rpm_script_tmpfs_t, rpm_script_tmpfs_t)
 fs_tmpfs_filetrans(rpm_script_t, rpm_script_tmpfs_t, { dir file lnk_file sock_file fifo_file })
-can_exec(rpm_script_t, rpm_script_tmpfs_t)
+
+can_exec(rpm_script_t, { rpm_script_tmp_t rpm_script_tmpfs_t })
 
 kernel_read_crypto_sysctls(rpm_script_t)
 kernel_read_kernel_sysctls(rpm_script_t)
 kernel_read_system_state(rpm_script_t)
 kernel_read_network_state(rpm_script_t)
+kernel_list_all_proc(rpm_script_t)
 kernel_read_software_raid_state(rpm_script_t)
 
-dev_list_sysfs(rpm_script_t)
+corenet_all_recvfrom_unlabeled(rpm_script_t)
+corenet_all_recvfrom_netlabel(rpm_script_t)
+corenet_tcp_sendrecv_generic_if(rpm_script_t)
+corenet_tcp_sendrecv_generic_node(rpm_script_t)
+
+corenet_sendrecv_http_client_packets(rpm_script_t)
+corenet_tcp_connect_http_port(rpm_script_t)
+corenet_tcp_sendrecv_http_port(rpm_script_t)
 
-# ideally we would not need this
+corecmd_exec_all_executables(rpm_script_t)
+
+dev_list_sysfs(rpm_script_t)
 dev_manage_generic_blk_files(rpm_script_t)
 dev_manage_generic_chr_files(rpm_script_t)
 dev_manage_all_blk_files(rpm_script_t)
 dev_manage_all_chr_files(rpm_script_t)
 
+domain_read_all_domains_state(rpm_script_t)
+domain_getattr_all_domains(rpm_script_t)
+domain_use_interactive_fds(rpm_script_t)
+domain_signal_all_domains(rpm_script_t)
+domain_signull_all_domains(rpm_script_t)
+
+files_exec_etc_files(rpm_script_t)
+files_exec_usr_files(rpm_script_t)
+files_manage_non_auth_files(rpm_script_t)
+files_relabel_non_auth_files(rpm_script_t)
+
 fs_manage_nfs_files(rpm_script_t)
 fs_getattr_nfs(rpm_script_t)
 fs_search_all(rpm_script_t)
 fs_getattr_all_fs(rpm_script_t)
-# why is this not using mount?
 fs_getattr_xattr_fs(rpm_script_t)
 fs_mount_xattr_fs(rpm_script_t)
 fs_unmount_xattr_fs(rpm_script_t)
 fs_search_auto_mountpoints(rpm_script_t)
 
 mcs_killall(rpm_script_t)
-mcs_ptrace_all(rpm_script_t)
 
 mls_file_read_all_levels(rpm_script_t)
 mls_file_write_all_levels(rpm_script_t)
@@ -307,23 +335,6 @@
 
 auth_dontaudit_getattr_shadow(rpm_script_t)
 auth_use_nsswitch(rpm_script_t)
-# ideally we would not need this
-files_manage_non_auth_files(rpm_script_t)
-auth_relabel_shadow(rpm_script_t)
-
-corecmd_exec_all_executables(rpm_script_t)
-
-domain_read_all_domains_state(rpm_script_t)
-domain_getattr_all_domains(rpm_script_t)
-domain_dontaudit_ptrace_all_domains(rpm_script_t)
-domain_use_interactive_fds(rpm_script_t)
-domain_signal_all_domains(rpm_script_t)
-domain_signull_all_domains(rpm_script_t)
-
-files_exec_etc_files(rpm_script_t)
-files_read_etc_runtime_files(rpm_script_t)
-files_exec_usr_files(rpm_script_t)
-files_relabel_all_files(rpm_script_t)
 
 init_domtrans_script(rpm_script_t)
 init_telinit(rpm_script_t)
@@ -348,6 +359,7 @@
 ifdef(`distro_redhat',`
 	optional_policy(`
 		mta_send_mail(rpm_script_t)
+		mta_system_content(rpm_var_run_t)
 	')
 ')
 
@@ -361,6 +373,10 @@
 
 optional_policy(`
 	dbus_system_bus_client(rpm_script_t)
+
+	optional_policy(`
+		unconfined_dbus_chat(rpm_script_t)
+	')
 ')
 
 optional_policy(`
@@ -381,7 +397,6 @@
 ')
 
 optional_policy(`
-	unconfined_domain(rpm_script_t)
 	unconfined_domtrans(rpm_script_t)
 
 	optional_policy(`
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/rshd.fc refpolicy/policy/modules/contrib/rshd.fc
--- refpolicy/policy/modules/contrib/rshd.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/rshd.fc	2012-10-27 13:02:52.846002127 +0200
@@ -1,4 +1,3 @@
-
 /usr/kerberos/sbin/kshd	--	gen_context(system_u:object_r:rshd_exec_t,s0)
 
 /usr/sbin/in\.rexecd	--	gen_context(system_u:object_r:rshd_exec_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/rshd.if refpolicy/policy/modules/contrib/rshd.if
--- refpolicy/policy/modules/contrib/rshd.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/rshd.if	2012-10-27 13:02:52.853002127 +0200
@@ -2,7 +2,7 @@
 
 ########################################
 ## <summary>
-##	Domain transition to rshd.
+##	Execute rshd in the rshd domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -15,7 +15,6 @@
 		type rshd_exec_t, rshd_t;
 	')
 
-	files_search_usr($1)
 	corecmd_search_bin($1)
 	domtrans_pattern($1, rshd_exec_t, rshd_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/rshd.te refpolicy/policy/modules/contrib/rshd.te
--- refpolicy/policy/modules/contrib/rshd.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/rshd.te	2012-10-27 13:02:52.854002127 +0200
@@ -1,22 +1,22 @@
-policy_module(rshd, 1.7.0)
+policy_module(rshd, 1.7.1)
 
 ########################################
 #
 # Declarations
 #
+
 type rshd_t;
 type rshd_exec_t;
+auth_login_pgm_domain(rshd_t)
 inetd_tcp_service_domain(rshd_t, rshd_exec_t)
-domain_subj_id_change_exemption(rshd_t)
-domain_role_change_exemption(rshd_t)
-role system_r types rshd_t;
 
 ########################################
 #
 # Local policy
 #
+
 allow rshd_t self:capability { kill setuid setgid fowner fsetid chown dac_override };
-allow rshd_t self:process { signal_perms fork setsched setpgid setexec };
+allow rshd_t self:process { signal_perms setsched setpgid setexec };
 allow rshd_t self:fifo_file rw_fifo_file_perms;
 allow rshd_t self:tcp_socket create_stream_socket_perms;
 
@@ -25,48 +25,24 @@
 corenet_all_recvfrom_unlabeled(rshd_t)
 corenet_all_recvfrom_netlabel(rshd_t)
 corenet_tcp_sendrecv_generic_if(rshd_t)
-corenet_udp_sendrecv_generic_if(rshd_t)
 corenet_tcp_sendrecv_generic_node(rshd_t)
-corenet_udp_sendrecv_generic_node(rshd_t)
 corenet_tcp_sendrecv_all_ports(rshd_t)
-corenet_udp_sendrecv_all_ports(rshd_t)
 corenet_tcp_bind_generic_node(rshd_t)
+
+corenet_sendrecv_all_server_packets(rshd_t)
 corenet_tcp_bind_rsh_port(rshd_t)
 corenet_tcp_bind_all_rpc_ports(rshd_t)
 corenet_tcp_connect_all_ports(rshd_t)
 corenet_tcp_connect_all_rpc_ports(rshd_t)
-corenet_sendrecv_rsh_server_packets(rshd_t)
-
-dev_read_urand(rshd_t)
-
-selinux_get_fs_mount(rshd_t)
-selinux_validate_context(rshd_t)
-selinux_compute_access_vector(rshd_t)
-selinux_compute_create_context(rshd_t)
-selinux_compute_relabel_context(rshd_t)
-selinux_compute_user_contexts(rshd_t)
 
 corecmd_read_bin_symlinks(rshd_t)
 
 files_list_home(rshd_t)
-files_read_etc_files(rshd_t)
-files_search_tmp(rshd_t)
 
-auth_login_pgm_domain(rshd_t)
-auth_write_login_records(rshd_t)
-
-init_rw_utmp(rshd_t)
-
-logging_send_syslog_msg(rshd_t)
 logging_search_logs(rshd_t)
 
 miscfiles_read_localization(rshd_t)
 
-seutil_read_config(rshd_t)
-seutil_read_default_contexts(rshd_t)
-
-userdom_search_user_home_content(rshd_t)
-
 tunable_policy(`use_nfs_home_dirs',`
 	fs_read_nfs_files(rshd_t)
 	fs_read_nfs_symlinks(rshd_t)
@@ -80,6 +56,7 @@
 optional_policy(`
 	kerberos_keytab_template(rshd, rshd_t)
 	kerberos_manage_host_rcache(rshd_t)
+	kerberos_tmp_filetrans_host_rcache(rshd_t, file, "host_0")
 ')
 
 optional_policy(`
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/rssh.fc refpolicy/policy/modules/contrib/rssh.fc
--- refpolicy/policy/modules/contrib/rssh.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/rssh.fc	2012-10-27 13:02:56.111002133 +0200
@@ -1 +1,3 @@
 /usr/bin/rssh	--	gen_context(system_u:object_r:rssh_exec_t,s0)
+
+/usr/libexec/rssh_chroot_helper	--	gen_context(system_u:object_r:rssh_chroot_helper_exec_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/rssh.if refpolicy/policy/modules/contrib/rssh.if
--- refpolicy/policy/modules/contrib/rssh.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/rssh.if	2012-10-27 13:02:56.112002133 +0200
@@ -1,35 +1,41 @@
-## <summary>Restricted (scp/sftp) only shell</summary>
+## <summary>Restricted (scp/sftp) only shell.</summary>
 
 ########################################
 ## <summary>
-##	Role access for rssh
+##	Role access for rssh.
 ## </summary>
 ## <param name="role">
 ##	<summary>
-##	Role allowed access
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <param name="domain">
 ##	<summary>
-##	User domain for the role
+##	User domain for the role.
 ##	</summary>
 ## </param>
 #
 interface(`rssh_role',`
 	gen_require(`
-		type rssh_t;
+		attribute_role rssh_roles;
+		type rssh_t, rssh_exec_t, rssh_ro_t;
+		type rssh_rw_t;
 	')
 
-	role $1 types rssh_t;
+	roleattribute $1 rssh_roles;
 
-	# allow ps to show irc
+	domtrans_pattern($2, rssh_exec_t, rssh_t)
+
+	allow $2 rssh_t:process { ptrace signal_perms };
 	ps_process_pattern($2, rssh_t)
-	allow $2 rssh_t:process signal;
+
+	allow $2 { rssh_ro_t rssh_rw_t }:dir { manage_dir_perms relabel_dir_perms };
+	allow $2 { rssh_ro_t rssh_rw_t }:file { manage_file_perms relabel_file_perms };
 ')
 
 ########################################
 ## <summary>
-##	Transition to all user rssh domains.
+##	Execute rssh in the rssh domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -42,6 +48,7 @@
 		type rssh_t, rssh_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	spec_domtrans_pattern($1, rssh_exec_t, rssh_t)
 ')
 
@@ -61,16 +68,18 @@
 		type rssh_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	can_exec($1, rssh_exec_t)
 ')
 
 ########################################
 ## <summary>
-##	Execute a domain transition to run rssh_chroot_helper.
+##	Execute a domain transition to
+##	run rssh chroot helper.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
-##	Domain allowed access.
+##	Domain allowed to transition.
 ##	</summary>
 ## </param>
 #
@@ -79,12 +88,13 @@
 		type rssh_chroot_helper_t, rssh_chroot_helper_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, rssh_chroot_helper_exec_t, rssh_chroot_helper_t)
 ')
 
 ########################################
 ## <summary>
-##	Read all users rssh read-only content.
+##	Read users rssh read-only content.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -98,6 +108,5 @@
 	')
 
 	allow $1 rssh_ro_t:dir list_dir_perms;
-	read_files_pattern($1, rssh_ro_t, rssh_ro_t)
-	read_lnk_files_pattern($1, rssh_ro_t, rssh_ro_t)
+	allow $1 rssh_ro_t:file read_file_perms;
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/rssh.te refpolicy/policy/modules/contrib/rssh.te
--- refpolicy/policy/modules/contrib/rssh.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/rssh.te	2012-10-27 13:02:56.134002131 +0200
@@ -1,10 +1,13 @@
-policy_module(rssh, 2.2.0)
+policy_module(rssh, 2.2.1)
 
 ########################################
 #
 # Declarations
 #
 
+attribute_role rssh_roles;
+roleattribute system_r rssh_roles;
+
 type rssh_t;
 type rssh_exec_t;
 typealias rssh_t alias { user_rssh_t staff_rssh_t sysadm_rssh_t };
@@ -12,7 +15,7 @@
 userdom_user_application_domain(rssh_t, rssh_exec_t)
 domain_user_exemption_target(rssh_t)
 domain_interactive_fd(rssh_t)
-role system_r types rssh_t;
+role rssh_roles types rssh_t;
 
 type rssh_chroot_helper_t;
 type rssh_chroot_helper_exec_t;
@@ -24,12 +27,12 @@
 term_user_pty(rssh_t, rssh_devpts_t)
 ubac_constrained(rssh_devpts_t)
 
-type rssh_ro_t;
+type rssh_ro_t; # customizable
 typealias rssh_ro_t alias { user_rssh_ro_t staff_rssh_ro_t sysadm_rssh_ro_t };
 typealias rssh_ro_t alias { auditadm_rssh_ro_t secadm_rssh_ro_t };
 userdom_user_home_content(rssh_ro_t)
 
-type rssh_rw_t;
+type rssh_rw_t; # customizable
 typealias rssh_rw_t alias { user_rssh_rw_t staff_rssh_rw_t sysadm_rssh_rw_t };
 typealias rssh_rw_t alias { auditadm_rssh_rw_t secadm_rssh_rw_t };
 userdom_user_home_content(rssh_rw_t)
@@ -42,16 +45,10 @@
 allow rssh_t self:process ~{ ptrace setcurrent setexec setfscreate setrlimit execmem execstack execheap };
 allow rssh_t self:fd use;
 allow rssh_t self:fifo_file rw_fifo_file_perms;
-allow rssh_t self:unix_dgram_socket create_socket_perms;
-allow rssh_t self:unix_stream_socket create_stream_socket_perms;
 allow rssh_t self:unix_dgram_socket sendto;
-allow rssh_t self:unix_stream_socket connectto;
-allow rssh_t self:shm create_shm_perms;
-allow rssh_t self:sem create_sem_perms;
-allow rssh_t self:msgq create_msgq_perms;
-allow rssh_t self:msg { send receive };
+allow rssh_t self:unix_stream_socket { accept connectto listen };
 
-allow rssh_t rssh_devpts_t:chr_file { rw_file_perms setattr };
+allow rssh_t rssh_devpts_t:chr_file { rw_chr_file_perms setattr_chr_file_perms };
 term_create_pty(rssh_t, rssh_devpts_t)
 
 allow rssh_t rssh_ro_t:dir list_dir_perms;
@@ -86,17 +83,15 @@
 
 ########################################
 #
-# rssh_chroot_helper local policy
+# Chroot helper local policy
 #
 
 allow rssh_chroot_helper_t self:capability { sys_chroot setuid };
 allow rssh_chroot_helper_t self:fifo_file rw_fifo_file_perms;
-allow rssh_chroot_helper_t self:unix_stream_socket create_stream_socket_perms;
+allow rssh_chroot_helper_t self:unix_stream_socket { accept listen };
 
 domain_use_interactive_fds(rssh_chroot_helper_t)
 
-files_read_etc_files(rssh_chroot_helper_t)
-
 auth_use_nsswitch(rssh_chroot_helper_t)
 
 logging_send_syslog_msg(rssh_chroot_helper_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/rsync.fc refpolicy/policy/modules/contrib/rsync.fc
--- refpolicy/policy/modules/contrib/rsync.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/rsync.fc	2012-10-27 13:03:00.176002142 +0200
@@ -1,7 +1,7 @@
 /etc/rsyncd\.conf	--	gen_context(system_u:object_r:rsync_etc_t, s0)
 
-/usr/bin/rsync		--	gen_context(system_u:object_r:rsync_exec_t,s0)
+/usr/bin/rsync	--	gen_context(system_u:object_r:rsync_exec_t,s0)
 
-/var/log/rsync\.log	--	gen_context(system_u:object_r:rsync_log_t,s0)
+/var/log/rsync\.log.*	--	gen_context(system_u:object_r:rsync_log_t,s0)
 
 /var/run/rsyncd\.lock	--	gen_context(system_u:object_r:rsync_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/rsync.if refpolicy/policy/modules/contrib/rsync.if
--- refpolicy/policy/modules/contrib/rsync.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/rsync.if	2012-10-27 13:03:00.193002142 +0200
@@ -1,16 +1,16 @@
-## <summary>Fast incremental file transfer for synchronization</summary>
+## <summary>Fast incremental file transfer for synchronization.</summary>
 
 ########################################
 ## <summary>
-##	Make rsync an entry point for
-##	the specified domain.
+##	Make rsync executable file an
+##	entry point for the specified domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
-##	The domain for which init scripts are an entrypoint.
+##	The domain for which rsync_exec_t is an entrypoint.
 ##	</summary>
 ## </param>
-# cjp: added for portage
+#
 interface(`rsync_entry_type',`
 	gen_require(`
 		type rsync_exec_t;
@@ -43,13 +43,14 @@
 ##	Domain to transition to.
 ##	</summary>
 ## </param>
-# cjp: added for portage
+#
 interface(`rsync_entry_spec_domtrans',`
 	gen_require(`
 		type rsync_exec_t;
 	')
 
-	domain_trans($1, rsync_exec_t, $2)
+	corecmd_search_bin($1)
+	auto_trans($1, rsync_exec_t, $2)
 ')
 
 ########################################
@@ -76,31 +77,76 @@
 ##	Domain to transition to.
 ##	</summary>
 ## </param>
-# cjp: added for portage
+#
 interface(`rsync_entry_domtrans',`
 	gen_require(`
 		type rsync_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domain_auto_trans($1, rsync_exec_t, $2)
 ')
 
 ########################################
 ## <summary>
-##	Execute rsync in the caller domain domain.
+##	Execute the rsync program in the rsync domain.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed to transition.
+##	</summary>
+## </param>
+#
+interface(`rsync_domtrans',`
+	gen_require(`
+		type rsync_t, rsync_exec_t;
+	')
+
+	corecmd_search_bin($1)
+	domtrans_pattern($1, rsync_exec_t, rsync_t)
+')
+
+########################################
+## <summary>
+##	Execute rsync in the rsync domain, and
+##	allow the specified role the rsync domain.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed to transition.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+#
+interface(`rsync_run',`
+	gen_require(`
+		attribute_role rsync_roles;
+	')
+
+	rsync_domtrans($1)
+	roleattribute $2 rsync_roles;
+')
+
+########################################
+## <summary>
+##	Execute rsync in the caller domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
 ##	Domain allowed access.
 ##	</summary>
 ## </param>
-## <rolecap/>
 #
 interface(`rsync_exec',`
 	gen_require(`
 		type rsync_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	can_exec($1, rsync_exec_t)
 ')
 
@@ -119,13 +165,13 @@
 		type rsync_etc_t;
 	')
 
-	allow $1 rsync_etc_t:file read_file_perms;
 	files_search_etc($1)
+	allow $1 rsync_etc_t:file read_file_perms;
 ')
 
 ########################################
 ## <summary>
-##	Write to rsync config files.
+##	Write rsync config files.
 ## </summary>
 ## <param name="domain">
 ## <summary>
@@ -138,6 +184,98 @@
 		type rsync_etc_t;
 	')
 
-	allow $1 rsync_etc_t:file read_file_perms;
 	files_search_etc($1)
+	allow $1 rsync_etc_t:file write_file_perms;
+')
+
+########################################
+## <summary>
+##	Create, read, write, and delete
+##	rsync config files.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`rsync_manage_config_files',`
+	gen_require(`
+		type rsync_etc_t;
+	')
+
+	files_search_etc($1)
+	manage_files_pattern($1, rsync_etc_t, rsync_etc_t)
+')
+
+########################################
+## <summary>
+##	Create specified objects in etc directories
+##	with rsync etc type.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed to transition.
+##	</summary>
+## </param>
+## <param name="object_class">
+##	<summary>
+##	Class of the object being created.
+##	</summary>
+## </param>
+## <param name="name" optional="true">
+##	<summary>
+##	The name of the object being created.
+##	</summary>
+## </param>
+#
+interface(`rsync_etc_filetrans_config',`
+	gen_require(`
+		type rsync_etc_t;
+	')
+
+	files_etc_filetrans($1, rsync_etc_t, $2, $3)
+')
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an rsync environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`rsync_admin',`
+	gen_require(`
+		type rsync_t, rsync_etc_t, rsync_data_t;
+		type rsync_log_t, rsync_tmp_t. rsync_var_run_t;
+	')
+
+	allow $1 rsync_t:process { ptrace signal_perms };
+	ps_process_pattern($1, rsync_t)
+
+	files_search_etc($1)
+	admin_pattern($1, rsync_etc_t)
+
+	admin_pattern($1, rsync_data_t)
+
+	logging_search_logs($1)
+	admin_pattern($1, rsync_log_t)
+
+	files_search_tmp($1)
+	admin_pattern($1, rsync_tmp_t)
+
+	files_search_pids($1)
+	admin_pattern($1, rsync_var_run_t)
+
+	rsync_run($1, $2)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/rsync.te refpolicy/policy/modules/contrib/rsync.te
--- refpolicy/policy/modules/contrib/rsync.te	2012-07-25 20:33:05.000000000 +0200
+++ refpolicy/policy/modules/contrib/rsync.te	2012-10-27 13:03:00.193002142 +0200
@@ -1,4 +1,4 @@
-policy_module(rsync, 1.12.0)
+policy_module(rsync, 1.12.2)
 
 ########################################
 #
@@ -6,31 +6,67 @@
 #
 
 ## <desc>
-## <p>
-## Allow rsync to export any files/directories read only.
-## </p>
+##	<p>
+##	Determine whether rsync can use
+##	cifs file systems.
+##	</p>
+## </desc>
+gen_tunable(rsync_use_cifs, false)
+
+## <desc>
+##	<p>
+##	Determine whether rsync can
+##	use fuse file systems.
+##	</p>
+## </desc>
+gen_tunable(rsync_use_fusefs, false)
+
+## <desc>
+##	<p>
+##	Determine whether rsync can use
+##	nfs file systems.
+##	</p>
+## </desc>
+gen_tunable(rsync_use_nfs, false)
+
+## <desc>
+##	<p>
+##	Determine whether rsync can
+##	run as a client
+##	</p>
+## </desc>
+gen_tunable(rsync_client, false)
+
+## <desc>
+##	<p>
+##	Determine whether rsync can
+##	export all content read only.
+##	</p>
 ## </desc>
 gen_tunable(rsync_export_all_ro, false)
 
 ## <desc>
-## <p>
-## Allow rsync to modify public files
-## used for public file transfer services.  Files/Directories must be
-## labeled public_content_rw_t.
-## </p>
+##	<p>
+##	Determine whether rsync can modify
+##	public files used for public file
+##	transfer services. Directories/Files must
+##	be labeled public_content_rw_t.
+##	</p>
 ## </desc>
 gen_tunable(allow_rsync_anon_write, false)
 
+attribute_role rsync_roles;
+
 type rsync_t;
 type rsync_exec_t;
 init_daemon_domain(rsync_t, rsync_exec_t)
-application_executable_file(rsync_exec_t)
-role system_r types rsync_t;
+application_domain(rsync_t, rsync_exec_t)
+role rsync_roles types rsync_t;
 
 type rsync_etc_t;
 files_config_file(rsync_etc_t)
 
-type rsync_data_t;
+type rsync_data_t; # customizable
 files_type(rsync_data_t)
 
 type rsync_log_t;
@@ -50,22 +86,15 @@
 allow rsync_t self:capability { chown dac_read_search dac_override fowner fsetid setuid setgid sys_chroot };
 allow rsync_t self:process signal_perms;
 allow rsync_t self:fifo_file rw_fifo_file_perms;
-allow rsync_t self:tcp_socket create_stream_socket_perms;
-allow rsync_t self:udp_socket connected_socket_perms;
-
-# for identd
-# cjp: this should probably only be inetd_child_t rules?
-# search home and kerberos also.
-allow rsync_t self:netlink_tcpdiag_socket r_netlink_socket_perms;
-#end for identd
+allow rsync_t self:tcp_socket { accept listen };
 
 allow rsync_t rsync_etc_t:file read_file_perms;
 
 allow rsync_t rsync_data_t:dir list_dir_perms;
-read_files_pattern(rsync_t, rsync_data_t, rsync_data_t)
-read_lnk_files_pattern(rsync_t, rsync_data_t, rsync_data_t)
+allow rsync_t rsync_data_t:file read_file_perms;
+allow rsync_t rsync_data_t:lnk_file read_lnk_file_perms;
 
-manage_files_pattern(rsync_t, rsync_log_t, rsync_log_t)
+allow rsync_t rsync_log_t:file { append_file_perms create_file_perms setattr_file_perms };
 logging_log_filetrans(rsync_t, rsync_log_t, file)
 
 manage_dirs_pattern(rsync_t, rsync_tmp_t, rsync_tmp_t)
@@ -82,22 +111,21 @@
 corenet_all_recvfrom_unlabeled(rsync_t)
 corenet_all_recvfrom_netlabel(rsync_t)
 corenet_tcp_sendrecv_generic_if(rsync_t)
-corenet_udp_sendrecv_generic_if(rsync_t)
 corenet_tcp_sendrecv_generic_node(rsync_t)
-corenet_udp_sendrecv_generic_node(rsync_t)
-corenet_tcp_sendrecv_all_ports(rsync_t)
-corenet_udp_sendrecv_all_ports(rsync_t)
 corenet_tcp_bind_generic_node(rsync_t)
-corenet_tcp_bind_rsync_port(rsync_t)
+
 corenet_sendrecv_rsync_server_packets(rsync_t)
+corenet_tcp_bind_rsync_port(rsync_t)
+corenet_tcp_sendrecv_rsync_port(rsync_t)
 
 dev_read_urand(rsync_t)
 
-fs_getattr_xattr_fs(rsync_t)
+fs_getattr_all_fs(rsync_t)
+fs_search_auto_mountpoints(rsync_t)
 
-files_read_etc_files(rsync_t)
 files_search_home(rsync_t)
 
+auth_can_read_shadow_passwords(rsync_t)
 auth_use_nsswitch(rsync_t)
 
 logging_send_syslog_msg(rsync_t)
@@ -109,25 +137,62 @@
 	miscfiles_manage_public_files(rsync_t)
 ')
 
-optional_policy(`
-	daemontools_service_domain(rsync_t, rsync_exec_t)
-')
-
-optional_policy(`
-	kerberos_use(rsync_t)
-')
-
-optional_policy(`
-	inetd_service_domain(rsync_t, rsync_exec_t)
+tunable_policy(`rsync_client',`
+	corenet_sendrecv_rsync_client_packets(rsync_t)
+	corenet_tcp_connect_rsync_port(rsync_t)
+
+	corenet_sendrecv_ssh_client_packets(rsync_t)
+	corenet_tcp_connect_ssh_port(rsync_t)
+	corenet_tcp_sendrecv_ssh_port(rsync_t)
+
+	manage_dirs_pattern(rsync_t, rsync_data_t, rsync_data_t)
+	manage_files_pattern(rsync_t, rsync_data_t, rsync_data_t)
+	manage_lnk_files_pattern(rsync_t, rsync_data_t, rsync_data_t)
 ')
 
 tunable_policy(`rsync_export_all_ro',`
 	fs_read_noxattr_fs_files(rsync_t)
 	fs_read_nfs_files(rsync_t)
+	fs_read_fusefs_files(rsync_t)
 	fs_read_cifs_files(rsync_t)
 	files_list_non_auth_dirs(rsync_t)
 	files_read_non_auth_files(rsync_t)
 	files_read_non_auth_symlinks(rsync_t)
 	auth_tunable_read_shadow(rsync_t)
 ')
-auth_can_read_shadow_passwords(rsync_t)
+
+tunable_policy(`rsync_use_cifs',`
+	fs_list_cifs(rsync_t)
+	fs_read_cifs_files(rsync_t)
+	fs_read_cifs_symlinks(rsync_t)
+')
+
+tunable_policy(`rsync_use_fusefs',`
+	fs_search_fusefs(rsync_t)
+	fs_read_fusefs_files(rsync_t)
+	fs_read_fusefs_symlinks(rsync_t)
+')
+
+tunable_policy(`rsync_use_nfs',`
+	fs_list_nfs(rsync_t)
+	fs_read_nfs_files(rsync_t)
+	fs_read_nfs_symlinks(rsync_t)
+')
+
+optional_policy(`
+	tunable_policy(`rsync_client',`
+		ssh_exec(rsync_t)
+	')
+')
+
+optional_policy(`
+	daemontools_service_domain(rsync_t, rsync_exec_t)
+')
+
+optional_policy(`
+	kerberos_use(rsync_t)
+')
+
+optional_policy(`
+	inetd_service_domain(rsync_t, rsync_exec_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/rtkit.fc refpolicy/policy/modules/contrib/rtkit.fc
--- refpolicy/policy/modules/contrib/rtkit.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/rtkit.fc	2012-10-27 13:03:01.870002146 +0200
@@ -1 +1,5 @@
+/etc/rc\.d/init\.d/rtkit-daemon	--	gen_context(system_u:object_r:rtkit_daemon_initrc_exec_t,s0)
+
 /usr/libexec/rtkit-daemon	--	gen_context(system_u:object_r:rtkit_daemon_exec_t,s0)
+
+/usr/lib/rtkit/rtkit-daemon	--	gen_context(system_u:object_r:rtkit_daemon_exec_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/rtkit.if refpolicy/policy/modules/contrib/rtkit.if
--- refpolicy/policy/modules/contrib/rtkit.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/rtkit.if	2012-10-27 13:03:01.871002146 +0200
@@ -15,6 +15,7 @@
 		type rtkit_daemon_t, rtkit_daemon_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, rtkit_daemon_exec_t, rtkit_daemon_t)
 ')
 
@@ -41,7 +42,7 @@
 
 ########################################
 ## <summary>
-##	Allow rtkit to control scheduling for your process
+##	Allow rtkit to control scheduling for your process.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -54,7 +55,42 @@
 		type rtkit_daemon_t;
 	')
 
-	ps_process_pattern(rtkit_daemon_t, $1)
 	allow rtkit_daemon_t $1:process { getsched setsched };
-	rtkit_daemon_dbus_chat($1)
+
+	ps_process_pattern(rtkit_daemon_t, $1)
+
+	optional_policy(`
+		rtkit_daemon_dbus_chat($1)
+	')
+')
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an rtkit environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`rtkit_admin',`
+	gen_require(`
+		type rtkit_daemon_t, rtkit_daemon_initrc_exec_t;
+	')
+
+	allow $1 rtkit_daemon_t:process { ptrace signal_perms };
+	ps_process_pattern($1, rtkit_daemon_t)
+
+	init_labeled_script_domtrans($1, rtkit_daemon_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 rtkit_daemon_initrc_exec_t system_r;
+	allow $2 system_r;
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/rtkit.te refpolicy/policy/modules/contrib/rtkit.te
--- refpolicy/policy/modules/contrib/rtkit.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/rtkit.te	2012-10-27 13:03:01.871002146 +0200
@@ -1,4 +1,4 @@
-policy_module(rtkit, 1.1.0)
+policy_module(rtkit, 1.1.2)
 
 ########################################
 #
@@ -7,11 +7,14 @@
 
 type rtkit_daemon_t;
 type rtkit_daemon_exec_t;
-dbus_system_domain(rtkit_daemon_t, rtkit_daemon_exec_t)
+init_system_domain(rtkit_daemon_t, rtkit_daemon_exec_t)
+
+type rtkit_daemon_initrc_exec_t;
+init_script_file(rtkit_daemon_initrc_exec_t)
 
 ########################################
 #
-# rtkit_daemon local policy
+# Local policy
 #
 
 allow rtkit_daemon_t self:capability { dac_read_search setuid sys_chroot setgid sys_nice sys_ptrace };
@@ -31,5 +34,9 @@
 miscfiles_read_localization(rtkit_daemon_t)
 
 optional_policy(`
-	policykit_dbus_chat(rtkit_daemon_t)
+	dbus_system_domain(rtkit_daemon_t, rtkit_daemon_exec_t)
+
+	optional_policy(`
+		policykit_dbus_chat(rtkit_daemon_t)
+	')
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/rtorrent.fc refpolicy/policy/modules/contrib/rtorrent.fc
--- refpolicy/policy/modules/contrib/rtorrent.fc	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/rtorrent.fc	2012-09-29 18:36:10.562924285 +0200
@@ -0,0 +1,4 @@
+HOME_DIR/.rtorrent.rc	--	gen_context(system_u:object_r:rtorrent_home_t,s0,s0)
+HOME_DIR/.rtsession(/.*)?	gen_context(system_u:object_r:rtorrent_session_t,s0,s0)
+
+/usr/bin/rtorrent	--	gen_context(system_u:object_r:rtorrent_exec_t,s0,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/rtorrent.if refpolicy/policy/modules/contrib/rtorrent.if
--- refpolicy/policy/modules/contrib/rtorrent.if	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/rtorrent.if	2012-09-29 18:35:02.160922704 +0200
@@ -0,0 +1,60 @@
+## <summary>rtorrent torrent client</summary>
+
+#######################################
+## <summary>
+## 	Role access for rtorrent
+## </summary>
+## <param name="user_role">
+##      <summary>
+##      The role associated with the user domain.
+##      </summary>
+## </param>
+## <param name="user_domain">
+##      <summary>
+##      The user domain.
+##      </summary>
+## </param>
+#
+interface(`rtorrent_role',`
+	gen_require(`
+		type rtorrent_t, rtorrent_exec_t, rtorrent_home_t, rtorrent_session_t;
+	')
+
+	role $1 types rtorrent_t;
+
+	domtrans_pattern($2, rtorrent_exec_t, rtorrent_t)
+
+	allow $2 rtorrent_t:process signal_perms;
+
+	manage_files_pattern($2, rtorrent_home_t, rtorrent_home_t)
+
+	read_files_pattern($2, rtorrent_session_t, rtorrent_session_t)
+	list_dirs_pattern($2, rtorrent_session_t, rtorrent_session_t)
+
+	ps_process_pattern($2, rtorrent_t)
+')
+
+#######################################
+## <summary>
+##      Administer the rtorrent application.
+## </summary>
+## <param name="domain">
+##      <summary>
+##      Domain allowed access.
+##      </summary>
+## </param>
+## <param name="role">
+##      <summary>
+##      Role allowed access.
+##      </summary>
+## </param>
+#
+interface(`rtorrent_admin',`
+	gen_require(`
+		type rtorrent_t;
+	')
+
+	allow $1 rtorrent_t:process ptrace;
+
+	rtorrent_role($2, $1)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/rtorrent.te refpolicy/policy/modules/contrib/rtorrent.te
--- refpolicy/policy/modules/contrib/rtorrent.te	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/rtorrent.te	2012-09-29 18:46:09.970938131 +0200
@@ -0,0 +1,87 @@
+policy_module(rtorrent, 1.0.0)
+
+########################################
+#
+# Declarations
+#
+
+## <desc>
+## <p>
+## Allow rtorrent to use dht.
+## The correspondig port must be rtorrent_udp_port_t.
+## </p>
+## </desc>
+gen_tunable(rtorrent_use_dht, true)
+
+## <desc>
+## <p>
+## Allow rtorrent to use rsync, for example in a hook.
+## </p>
+## </desc>
+gen_tunable(rtorrent_use_rsync, false)
+
+
+type rtorrent_t;
+type rtorrent_exec_t;
+userdom_user_application_domain(rtorrent_t, rtorrent_exec_t)
+
+type rtorrent_home_t;
+userdom_user_home_content(rtorrent_home_t)
+
+type rtorrent_session_t;
+userdom_user_home_content(rtorrent_session_t)
+
+########################################
+#
+# rtorrent local policy
+#
+
+allow rtorrent_t self:process signal;
+allow rtorrent_t self:netlink_route_socket r_netlink_socket_perms;
+allow rtorrent_t self:tcp_socket create_stream_socket_perms;
+
+read_files_pattern(rtorrent_t, rtorrent_home_t, rtorrent_home_t)
+
+manage_dirs_pattern(rtorrent_t, rtorrent_session_t, rtorrent_session_t)
+manage_files_pattern(rtorrent_t, rtorrent_session_t, rtorrent_session_t)
+
+corenet_tcp_bind_generic_node(rtorrent_t)
+corenet_tcp_bind_rtorrent_port(rtorrent_t)
+corenet_tcp_connect_all_ports(rtorrent_t)
+corenet_tcp_sendrecv_all_ports(rtorrent_t)
+
+domain_use_interactive_fds(rtorrent_t)
+
+files_list_home(rtorrent_t)
+files_read_etc_files(rtorrent_t)
+
+fs_getattr_xattr_fs(rtorrent_t)
+
+miscfiles_read_localization(rtorrent_t)
+
+sysnet_read_config(rtorrent_t)
+
+userdom_list_user_home_dirs(rtorrent_t)
+userdom_use_user_ptys(rtorrent_t)
+
+tunable_policy(`rtorrent_use_dht',`
+	allow rtorrent_t self:udp_socket create_stream_socket_perms;
+
+	corenet_udp_bind_generic_node(rtorrent_t)
+	corenet_udp_bind_rtorrent_port(rtorrent_t)
+')
+
+tunable_policy(`rtorrent_use_rsync',`
+	allow rtorrent_t self:unix_stream_socket { create connect write read };
+
+	corecmd_search_bin(rtorrent_t)  
+
+	corenet_sendrecv_rsync_client_packets(rtorrent_t)
+	corenet_tcp_connect_rsync_port(rtorrent_t)
+
+	rsync_exec(rtorrent_t)
+')
+
+optional_policy(`
+	xdg_manage_downloads_home(rtorrent_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/rwho.fc refpolicy/policy/modules/contrib/rwho.fc
--- refpolicy/policy/modules/contrib/rwho.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/rwho.fc	2012-10-27 13:03:04.046002150 +0200
@@ -1,7 +1,7 @@
-/etc/rc\.d/init\.d/rwhod --	gen_context(system_u:object_r:rwho_initrc_exec_t,s0)
+/etc/rc\.d/init\.d/rwhod	--	gen_context(system_u:object_r:rwho_initrc_exec_t,s0)
 
-/usr/sbin/rwhod		--	gen_context(system_u:object_r:rwho_exec_t,s0)
+/usr/sbin/rwhod	--	gen_context(system_u:object_r:rwho_exec_t,s0)
 
-/var/spool/rwho(/.*)?		gen_context(system_u:object_r:rwho_spool_t,s0)
+/var/spool/rwho(/.*)?	gen_context(system_u:object_r:rwho_spool_t,s0)
 
-/var/log/rwhod(/.*)?		gen_context(system_u:object_r:rwho_log_t,s0)
+/var/log/rwhod(/.*)?	gen_context(system_u:object_r:rwho_log_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/rwho.if refpolicy/policy/modules/contrib/rwho.if
--- refpolicy/policy/modules/contrib/rwho.if	2012-05-04 15:16:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/rwho.if	2012-10-27 13:03:05.518002153 +0200
@@ -15,6 +15,7 @@
 		type rwho_t, rwho_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, rwho_exec_t, rwho_t)
 ')
 
@@ -33,8 +34,8 @@
 		type rwho_log_t;
 	')
 
-	allow $1 rwho_log_t:dir search_dir_perms;
 	logging_search_logs($1)
+	allow $1 rwho_log_t:dir search_dir_perms;
 ')
 
 ########################################
@@ -52,9 +53,9 @@
 		type rwho_log_t;
 	')
 
-	allow $1 rwho_log_t:file read_file_perms;
-	allow $1 rwho_log_t:dir list_dir_perms;
 	logging_search_logs($1)
+	allow $1 rwho_log_t:dir list_dir_perms;
+	allow $1 rwho_log_t:file read_file_perms;
 ')
 
 ########################################
@@ -72,8 +73,8 @@
 		type rwho_spool_t;
 	')
 
-	allow $1 rwho_spool_t:dir search_dir_perms;
 	files_search_spool($1)
+	allow $1 rwho_spool_t:dir search_dir_perms;
 ')
 
 ########################################
@@ -91,8 +92,8 @@
 		type rwho_spool_t;
 	')
 
-	read_files_pattern($1, rwho_spool_t, rwho_spool_t)
 	files_search_spool($1)
+	read_files_pattern($1, rwho_spool_t, rwho_spool_t)
 ')
 
 ########################################
@@ -111,14 +112,14 @@
 		type rwho_spool_t;
 	')
 
-	manage_files_pattern($1, rwho_spool_t, rwho_spool_t)
 	files_search_spool($1)
+	manage_files_pattern($1, rwho_spool_t, rwho_spool_t)
 ')
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate 
-##	an rwho environment
+##	All of the rules required to
+##	administrate an rwho environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -127,7 +128,7 @@
 ## </param>
 ## <param name="role">
 ##	<summary>
-##	The role allowed access.
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <rolecap/>
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/rwho.te refpolicy/policy/modules/contrib/rwho.te
--- refpolicy/policy/modules/contrib/rwho.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/rwho.te	2012-10-27 13:03:05.534002153 +0200
@@ -1,4 +1,4 @@
-policy_module(rwho, 1.6.0)
+policy_module(rwho, 1.6.1)
 
 ########################################
 #
@@ -20,17 +20,16 @@
 
 ########################################
 #
-# rwho local policy
+# Local policy
 #
 
 allow rwho_t self:capability sys_chroot;
-allow rwho_t self:unix_dgram_socket create;
-allow rwho_t self:fifo_file rw_file_perms;
-allow rwho_t self:unix_stream_socket create_stream_socket_perms;
-allow rwho_t self:udp_socket create_socket_perms;
+allow rwho_t self:process signal;
+allow rwho_t self:fifo_file rw_fifo_file_perms;
+allow rwho_t self:unix_stream_socket { accept listen };
 
 allow rwho_t rwho_log_t:dir manage_dir_perms;
-allow rwho_t rwho_log_t:file manage_file_perms;
+allow rwho_t rwho_log_t:file { append_file_perms create_file_perms setattr_file_perms };
 logging_log_filetrans(rwho_t, rwho_log_t, { file dir })
 
 allow rwho_t rwho_spool_t:dir manage_dir_perms;
@@ -43,10 +42,11 @@
 corenet_all_recvfrom_netlabel(rwho_t)
 corenet_udp_sendrecv_generic_if(rwho_t)
 corenet_udp_sendrecv_generic_node(rwho_t)
-corenet_udp_sendrecv_all_ports(rwho_t)
 corenet_udp_bind_generic_node(rwho_t)
-corenet_udp_bind_rwho_port(rwho_t)
+
 corenet_sendrecv_rwho_server_packets(rwho_t)
+corenet_udp_bind_rwho_port(rwho_t)
+corenet_udp_sendrecv_rwho_port(rwho_t)
 
 domain_use_interactive_fds(rwho_t)
 
@@ -55,6 +55,10 @@
 init_read_utmp(rwho_t)
 init_dontaudit_write_utmp(rwho_t)
 
+logging_send_syslog_msg(rwho_t)
+
 miscfiles_read_localization(rwho_t)
 
 sysnet_dns_name_resolve(rwho_t)
+
+# userdom_getattr_user_terminals(rwho_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/samba.fc refpolicy/policy/modules/contrib/samba.fc
--- refpolicy/policy/modules/contrib/samba.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/samba.fc	2012-10-27 13:03:09.491002162 +0200
@@ -1,45 +1,40 @@
-
-#
-# /etc
-#
-/etc/rc\.d/init\.d/nmb		--	gen_context(system_u:object_r:samba_initrc_exec_t,s0)
-/etc/rc\.d/init\.d/smb		--	gen_context(system_u:object_r:samba_initrc_exec_t,s0)
+/etc/rc\.d/init\.d/nmb	--	gen_context(system_u:object_r:samba_initrc_exec_t,s0)
+/etc/rc\.d/init\.d/smb	--	gen_context(system_u:object_r:samba_initrc_exec_t,s0)
 /etc/rc\.d/init\.d/winbind	--	gen_context(system_u:object_r:samba_initrc_exec_t,s0)
-/etc/samba/MACHINE\.SID		--	gen_context(system_u:object_r:samba_secrets_t,s0)
-/etc/samba/passdb\.tdb		--	gen_context(system_u:object_r:samba_secrets_t,s0)
-/etc/samba/secrets\.tdb		--	gen_context(system_u:object_r:samba_secrets_t,s0)
-/etc/samba/smbpasswd		--	gen_context(system_u:object_r:samba_secrets_t,s0)
-/etc/samba(/.*)?			gen_context(system_u:object_r:samba_etc_t,s0)
-
-#
-# /usr
-#
-/usr/bin/net			--	gen_context(system_u:object_r:samba_net_exec_t,s0)
-/usr/bin/ntlm_auth		--	gen_context(system_u:object_r:winbind_helper_exec_t,s0)
-/usr/bin/smbcontrol		--	gen_context(system_u:object_r:smbcontrol_exec_t,s0)
-/usr/bin/smbmount		--	gen_context(system_u:object_r:smbmount_exec_t,s0)
-/usr/bin/smbmnt			--	gen_context(system_u:object_r:smbmount_exec_t,s0)
-
-/usr/sbin/swat			--	gen_context(system_u:object_r:swat_exec_t,s0)
-/usr/sbin/nmbd			--	gen_context(system_u:object_r:nmbd_exec_t,s0)
-/usr/sbin/smbd			--	gen_context(system_u:object_r:smbd_exec_t,s0)
-/usr/sbin/winbindd		--	gen_context(system_u:object_r:winbind_exec_t,s0)
-
-#
-# /var
-#
-/var/cache/samba(/.*)?			gen_context(system_u:object_r:samba_var_t,s0)
-/var/cache/samba/winbindd_privileged(/.*)? gen_context(system_u:object_r:winbind_var_run_t,s0)
 
-/var/lib/samba(/.*)?			gen_context(system_u:object_r:samba_var_t,s0)
-/var/lib/samba/winbindd_privileged(/.*)? gen_context(system_u:object_r:winbind_var_run_t,s0)
+/etc/samba/MACHINE\.SID	--	gen_context(system_u:object_r:samba_secrets_t,s0)
+/etc/samba/passdb\.tdb	--	gen_context(system_u:object_r:samba_secrets_t,s0)
+/etc/samba/secrets\.tdb	--	gen_context(system_u:object_r:samba_secrets_t,s0)
+/etc/samba/smbpasswd	--	gen_context(system_u:object_r:samba_secrets_t,s0)
+/etc/samba(/.*)?	gen_context(system_u:object_r:samba_etc_t,s0)
+
+/usr/bin/net	--	gen_context(system_u:object_r:samba_net_exec_t,s0)
+/usr/bin/ntlm_auth	--	gen_context(system_u:object_r:winbind_helper_exec_t,s0)
+/usr/bin/smbcontrol	--	gen_context(system_u:object_r:smbcontrol_exec_t,s0)
+/usr/bin/smbmount	--	gen_context(system_u:object_r:smbmount_exec_t,s0)
+/usr/bin/smbmnt	--	gen_context(system_u:object_r:smbmount_exec_t,s0)
+
+/usr/sbin/swat	--	gen_context(system_u:object_r:swat_exec_t,s0)
+/usr/sbin/nmbd	--	gen_context(system_u:object_r:nmbd_exec_t,s0)
+/usr/sbin/smbd	--	gen_context(system_u:object_r:smbd_exec_t,s0)
+/usr/sbin/winbindd	--	gen_context(system_u:object_r:winbind_exec_t,s0)
+
+/var/cache/samba(/.*)?	gen_context(system_u:object_r:samba_var_t,s0)
+/var/cache/samba/winbindd_privileged(/.*)?	gen_context(system_u:object_r:winbind_var_run_t,s0)
+
+/var/lib/samba(/.*)?	gen_context(system_u:object_r:samba_var_t,s0)
+/var/lib/samba/winbindd_privileged(/.*)?	gen_context(system_u:object_r:winbind_var_run_t,s0)
+
+/var/log/samba(/.*)?	gen_context(system_u:object_r:samba_log_t,s0)
 
-/var/log/samba(/.*)?			gen_context(system_u:object_r:samba_log_t,s0)
+/var/run/nmbd(/.*)?	gen_context(system_u:object_r:nmbd_var_run_t,s0)
+/var/run/samba/nmbd(/.*)?	gen_context(system_u:object_r:nmbd_var_run_t,s0)
 
+/var/run/samba(/.*)?	gen_context(system_u:object_r:smbd_var_run_t,s0)
 /var/run/samba/brlock\.tdb	--	gen_context(system_u:object_r:smbd_var_run_t,s0)
 /var/run/samba/connections\.tdb	--	gen_context(system_u:object_r:smbd_var_run_t,s0)
 /var/run/samba/gencache\.tdb	--	gen_context(system_u:object_r:smbd_var_run_t,s0)
-/var/run/samba/locking\.tdb 	--	gen_context(system_u:object_r:smbd_var_run_t,s0)
+/var/run/samba/locking\.tdb --	gen_context(system_u:object_r:smbd_var_run_t,s0)
 /var/run/samba/messages\.tdb	--	gen_context(system_u:object_r:nmbd_var_run_t,s0)
 /var/run/samba/namelist\.debug	--	gen_context(system_u:object_r:nmbd_var_run_t,s0)
 /var/run/samba/nmbd\.pid	--	gen_context(system_u:object_r:nmbd_var_run_t,s0)
@@ -48,6 +43,7 @@
 /var/run/samba/smbd\.pid	--	gen_context(system_u:object_r:smbd_var_run_t,s0)
 /var/run/samba/unexpected\.tdb	--	gen_context(system_u:object_r:nmbd_var_run_t,s0)
 
-/var/run/winbindd(/.*)?			gen_context(system_u:object_r:winbind_var_run_t,s0)
+/var/run/winbindd(/.*)?	gen_context(system_u:object_r:winbind_var_run_t,s0)
+/var/run/samba/winbindd(/.*)?	gen_context(system_u:object_r:winbind_var_run_t,s0)
 
-/var/spool/samba(/.*)?			gen_context(system_u:object_r:samba_var_t,s0)
+/var/spool/samba(/.*)?	gen_context(system_u:object_r:samba_var_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/samba.if refpolicy/policy/modules/contrib/samba.if
--- refpolicy/policy/modules/contrib/samba.if	2012-05-04 15:16:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/samba.if	2012-10-27 13:03:09.502002162 +0200
@@ -1,12 +1,8 @@
-## <summary>
-##	SMB and CIFS client/server programs for UNIX and
-##	name  Service  Switch  daemon for resolving names
-##	from Windows NT servers.
-## </summary>
+## <summary>SMB and CIFS client/server programs.</summary>
 
 ########################################
 ## <summary>
-##	Execute nmbd net in the nmbd_t domain.
+##	Execute nmbd in the nmbd domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -25,7 +21,7 @@
 
 #######################################
 ## <summary>
-##	Allow domain to signal samba
+##	Send generic signals to nmbd.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -42,7 +38,28 @@
 
 ########################################
 ## <summary>
-##	Execute samba server in the samba domain.
+##	Connect to nmbd with a unix domain
+##	stream socket.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`samba_stream_connect_nmbd',`
+	gen_require(`
+		type samba_var_t, nmbd_t, nmbd_var_run_t, smbd_var_run_t;
+	')
+
+	files_search_pids($1)
+	stream_connect_pattern($1, { smbd_var_run_t samba_var_t nmbd_var_run_t }, nmbd_var_run_t, nmbd_t)
+')
+
+########################################
+## <summary>
+##	Execute samba init scripts in
+##	the init script domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -60,7 +77,7 @@
 
 ########################################
 ## <summary>
-##	Execute samba net in the samba_net domain.
+##	Execute samba net in the samba net domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -79,8 +96,9 @@
 
 ########################################
 ## <summary>
-##	Execute samba net in the samba_net domain, and
-##	allow the specified role the samba_net domain.
+##	Execute samba net in the samba net
+##	domain, and allow the specified
+##	role the samba net domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -96,11 +114,11 @@
 #
 interface(`samba_run_net',`
 	gen_require(`
-		type samba_net_t;
+		attribute_role samba_net_roles;
 	')
 
 	samba_domtrans_net($1)
-	role $2 types samba_net_t;
+	roleattribute $2 samba_net_roles;
 ')
 
 ########################################
@@ -124,8 +142,9 @@
 
 ########################################
 ## <summary>
-##	Execute smbmount interactively and do
-##	a domain transition to the smbmount domain.
+##	Execute smbmount in the smbmount
+##	domain, and allow the specified
+##	role the smbmount domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -141,17 +160,16 @@
 #
 interface(`samba_run_smbmount',`
 	gen_require(`
-		type smbmount_t;
+		attribute_role smbmount_roles;
 	')
 
 	samba_domtrans_smbmount($1)
-	role $2 types smbmount_t;
+	roleattribute $2 smbmount_roles;
 ')
 
 ########################################
 ## <summary>
-##	Allow the specified domain to read
-##	samba configuration files.
+##	Read samba configuration files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -171,8 +189,7 @@
 
 ########################################
 ## <summary>
-##	Allow the specified domain to read
-##	and write samba configuration files.
+##	Read and write samba configuration files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -192,8 +209,8 @@
 
 ########################################
 ## <summary>
-##	Allow the specified domain to read
-##	and write samba configuration files.
+##	Create, read, write, and delete
+##	samba configuration files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -214,7 +231,7 @@
 
 ########################################
 ## <summary>
-##	Allow the specified domain to read samba's log files.
+##	Read samba log files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -235,7 +252,7 @@
 
 ########################################
 ## <summary>
-##	Allow the specified domain to append to samba's log files.
+##	Append to samba log files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -256,7 +273,7 @@
 
 ########################################
 ## <summary>
-##	Execute samba log in the caller domain.
+##	Execute samba log files in the caller domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -275,7 +292,7 @@
 
 ########################################
 ## <summary>
-##	Allow the specified domain to read samba's secrets.
+##	Read samba secret files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -294,7 +311,7 @@
 
 ########################################
 ## <summary>
-##	Allow the specified domain to read samba's shares
+##	Read samba share files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -313,8 +330,7 @@
 
 ########################################
 ## <summary>
-##	Allow the specified domain to search
-##	samba /var directories.
+##	Search samba var directories.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -327,15 +343,13 @@
 		type samba_var_t;
 	')
 
-	files_search_var($1)
 	files_search_var_lib($1)
 	allow $1 samba_var_t:dir search_dir_perms;
 ')
 
 ########################################
 ## <summary>
-##	Allow the specified domain to
-##	read samba /var files.
+##	Read samba var files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -348,15 +362,14 @@
 		type samba_var_t;
 	')
 
-	files_search_var($1)
 	files_search_var_lib($1)
 	read_files_pattern($1, samba_var_t, samba_var_t)
 ')
 
 ########################################
 ## <summary>
-##	Do not audit attempts to write samba
-##	/var files.
+##	Do not audit attempts to write
+##	samba var files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -374,8 +387,7 @@
 
 ########################################
 ## <summary>
-##	Allow the specified domain to
-##	read and write samba /var files.
+##	Read and write samba var files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -388,15 +400,14 @@
 		type samba_var_t;
 	')
 
-	files_search_var($1)
 	files_search_var_lib($1)
 	rw_files_pattern($1, samba_var_t, samba_var_t)
 ')
 
 ########################################
 ## <summary>
-##	Allow the specified domain to
-##	read and write samba /var files.
+##	Create, read, write, and delete
+##	samba var files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -409,34 +420,34 @@
 		type samba_var_t;
 	')
 
-	files_search_var($1)
 	files_search_var_lib($1)
 	manage_files_pattern($1, samba_var_t, samba_var_t)
 ')
 
 ########################################
 ## <summary>
-##	Execute a domain transition to run smbcontrol.
+##	Execute smbcontrol in the smbcontrol domain.
 ## </summary>
 ## <param name="domain">
-## <summary>
+##	<summary>
 ##	Domain allowed to transition.
-## </summary>
+##	</summary>
 ## </param>
 #
 interface(`samba_domtrans_smbcontrol',`
 	gen_require(`
-		type smbcontrol_t;
-		type smbcontrol_exec_t;
+		type smbcontrol_t, smbcontrol_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, smbcontrol_exec_t, smbcontrol_t)
 ')
 
 ########################################
 ## <summary>
-##	Execute smbcontrol in the smbcontrol domain, and
-##	allow the specified role the smbcontrol domain.
+##	Execute smbcontrol in the smbcontrol
+##	domain, and allow the specified
+##	role the smbcontrol domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -451,16 +462,16 @@
 #
 interface(`samba_run_smbcontrol',`
 	gen_require(`
-		type smbcontrol_t;
+		attribute_role smbcontrol_roles;
 	')
 
 	samba_domtrans_smbcontrol($1)
-	role $2 types smbcontrol_t;
+	roleattribute $2 smbcontrol_roles;
 ')
 
 ########################################
 ## <summary>
-##	Execute smbd in the smbd_t domain.
+##	Execute smbd in the smbd domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -479,7 +490,7 @@
 
 ######################################
 ## <summary>
-##	Allow domain to signal samba
+##	Send generic signals to smbd.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -496,7 +507,8 @@
 
 ########################################
 ## <summary>
-##	Do not audit attempts to use file descriptors from samba.
+##	Do not audit attempts to inherit
+##	and use smbd file descriptors.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -514,7 +526,7 @@
 
 ########################################
 ## <summary>
-##	Allow the specified domain to write to smbmount tcp sockets.
+##	Write smbmount tcp sockets.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -532,7 +544,7 @@
 
 ########################################
 ## <summary>
-##	Allow the specified domain to read and write to smbmount tcp sockets.
+##	Read and write smbmount tcp sockets.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -550,7 +562,8 @@
 
 ########################################
 ## <summary>
-##	Execute winbind_helper in the winbind_helper domain.
+##	Execute winbind helper in the
+##	winbind helper domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -563,13 +576,33 @@
 		type winbind_helper_t, winbind_helper_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, winbind_helper_exec_t, winbind_helper_t)
 ')
 
+#######################################
+## <summary>
+##	Get attributes of winbind executable files.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`samba_getattr_winbind_exec',`
+	gen_require(`
+		type winbind_exec_t;
+	')
+
+	allow $1 winbind_exec_t:file getattr_file_perms;
+')
+
 ########################################
 ## <summary>
-##	Execute winbind_helper in the winbind_helper domain, and
-##	allow the specified role the winbind_helper domain.
+##	Execute winbind helper in the winbind
+##	helper domain, and allow the specified
+##	role the winbind helper domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -585,16 +618,16 @@
 #
 interface(`samba_run_winbind_helper',`
 	gen_require(`
-		type winbind_helper_t;
+		attribute_role winbind_helper_roles;
 	')
 
 	samba_domtrans_winbind_helper($1)
-	role $2 types winbind_helper_t;
+	roleattribute $2 winbind_helper_roles;
 ')
 
 ########################################
 ## <summary>
-##	Allow the specified domain to read the winbind pid files.
+##	Read winbind pid files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -604,16 +637,17 @@
 #
 interface(`samba_read_winbind_pid',`
 	gen_require(`
-		type winbind_var_run_t;
+		type winbind_var_run_t, smbd_var_run_t;
 	')
 
 	files_search_pids($1)
-	allow $1 winbind_var_run_t:file read_file_perms;
+	read_files_pattern($1, { smbd_var_run_t winbind_var_run_t }, winbind_var_run_t)
 ')
 
 ########################################
 ## <summary>
-##	Connect to winbind.
+##	Connect to winbind with a unix
+##	domain stream socket.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -623,29 +657,17 @@
 #
 interface(`samba_stream_connect_winbind',`
 	gen_require(`
-		type samba_var_t, winbind_t, winbind_var_run_t;
+		type samba_var_t, winbind_t, winbind_var_run_t, smbd_var_run_t;
 	')
 
 	files_search_pids($1)
-	allow $1 samba_var_t:dir search_dir_perms;
-	stream_connect_pattern($1, winbind_var_run_t, winbind_var_run_t, winbind_t)
-
-	ifndef(`distro_redhat',`
-		gen_require(`
-			type winbind_tmp_t;
-		')
-
-		# the default for the socket is (poorly named):
-		# /tmp/.winbindd/pipe
-		files_search_tmp($1)
-		stream_connect_pattern($1, winbind_tmp_t, winbind_tmp_t, winbind_t)
-	')
+	stream_connect_pattern($1, { smbd_var_run_t samba_var_t winbind_var_run_t }, winbind_var_run_t, winbind_t)
 ')
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate 
-##	an samba environment
+##	All of the rules required to
+##	administrate an samba environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -654,77 +676,49 @@
 ## </param>
 ## <param name="role">
 ##	<summary>
-##	The role to be allowed to manage the samba domain.
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <rolecap/>
 #
 interface(`samba_admin',`
 	gen_require(`
-		type nmbd_t, nmbd_var_run_t;
-		type smbd_t, smbd_tmp_t;
-		type smbd_var_run_t;
-		type smbd_spool_t;
-
-		type samba_log_t, samba_var_t;
-		type samba_etc_t, samba_share_t;
-		type samba_secrets_t;
-
-		type swat_var_run_t, swat_tmp_t;
-
+		type nmbd_t, nmbd_var_run_t, smbd_var_run_t;
+		type smbd_t, smbd_tmp_t, smbd_spool_t;
+		type samba_log_t, samba_var_t, samba_secrets_t;
+		type samba_etc_t, samba_share_t, samba_initrc_exec_t;
+		type swat_var_run_t, swat_tmp_t, winbind_log_t;
 		type winbind_var_run_t, winbind_tmp_t;
-		type winbind_log_t;
-
-		type samba_initrc_exec_t;
 	')
 
-	allow $1 smbd_t:process { ptrace signal_perms };
-	ps_process_pattern($1, smbd_t)
-
-	allow $1 nmbd_t:process { ptrace signal_perms };
-	ps_process_pattern($1, nmbd_t)
-
-	samba_run_smbcontrol($1, $2, $3)
-	samba_run_winbind_helper($1, $2, $3)
-	samba_run_smbmount($1, $2, $3)
-	samba_run_net($1, $2, $3)
+	allow $1 { nmbd_t smbd_t }:process { ptrace signal_perms };
+	ps_process_pattern($1, { nmbd_t smbd_t })
 
 	init_labeled_script_domtrans($1, samba_initrc_exec_t)
 	domain_system_change_exemption($1)
 	role_transition $2 samba_initrc_exec_t system_r;
 	allow $2 system_r;
 
-	admin_pattern($1, nmbd_var_run_t)
-
-	admin_pattern($1, samba_etc_t)
 	files_list_etc($1)
+	admin_pattern($1, samba_etc_t)
 
-	admin_pattern($1, samba_log_t)
 	logging_list_logs($1)
+	admin_pattern($1, { samba_log_t winbind_log_t })
 
-	admin_pattern($1, samba_secrets_t)
-
-	admin_pattern($1, samba_share_t)
-
-	admin_pattern($1, samba_var_t)
 	files_list_var($1)
+	admin_pattern($1, { samba_share_t samba_var_t samba_secrets_t })
 
-	admin_pattern($1, smbd_spool_t)
 	files_list_spool($1)
+	admin_pattern($1, smbd_spool_t)
 
-	admin_pattern($1, smbd_var_run_t)
 	files_list_pids($1)
+	admin_pattern($1, { winbind_var_run_t smbd_var_run_t swat_var_run_t nmbd_var_run_t })
 
-	admin_pattern($1, smbd_tmp_t)
 	files_list_tmp($1)
+	admin_pattern($1, { swat_tmp_t smbd_tmp_t winbind_tmp_t })
 
-	admin_pattern($1, swat_var_run_t)
-
-	admin_pattern($1, swat_tmp_t)
-
-	admin_pattern($1, winbind_log_t)
-
-	admin_pattern($1, winbind_tmp_t)
-
-	admin_pattern($1, winbind_var_run_t)
+	samba_run_smbcontrol($1, $2)
+	samba_run_winbind_helper($1, $2)
+	samba_run_smbmount($1, $2)
+	samba_run_net($1, $2)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/samba.te refpolicy/policy/modules/contrib/samba.te
--- refpolicy/policy/modules/contrib/samba.te	2012-07-25 20:33:05.000000000 +0200
+++ refpolicy/policy/modules/contrib/samba.te	2012-11-06 21:18:48.622011596 +0100
@@ -1,4 +1,4 @@
-policy_module(samba, 1.15.0)
+policy_module(samba, 1.15.5)
 
 #################################
 #
@@ -6,72 +6,100 @@
 #
 
 ## <desc>
-## <p>
-## Allow samba to modify public files used for public file
-## transfer services.  Files/Directories must be labeled
-## public_content_rw_t.
-## </p>
+##	<p>
+##	Determine whether samba can modify
+##	public files used for public file
+##	transfer services. Directories/Files must
+##	be labeled public_content_rw_t.
+##	</p>
 ## </desc>
 gen_tunable(allow_smbd_anon_write, false)
 
 ## <desc>
-## <p>
-## Allow samba to create new home directories (e.g. via PAM)
-## </p>
+##	<p>
+##	Determine whether samba can
+##	create home directories via pam.
+##	</p>
 ## </desc>
 gen_tunable(samba_create_home_dirs, false)
 
 ## <desc>
-## <p>
-## Allow samba to act as the domain controller, add users,
-## groups and change passwords.
-##
-## </p>
+##	<p>
+##	Determine whether samba can act as the
+##	domain controller, add users, groups
+##	and change passwords.
+##	</p>
 ## </desc>
 gen_tunable(samba_domain_controller, false)
 
 ## <desc>
-## <p>
-## Allow samba to share users home directories.
-## </p>
+##	<p>
+##	Determine whether samba can
+##	act as a portmapper.
+##	</p>
+## </desc>
+gen_tunable(samba_portmapper, false)
+
+## <desc>
+##	<p>
+##	Determine whether samba can share
+##	users home directories.
+##	</p>
 ## </desc>
 gen_tunable(samba_enable_home_dirs, false)
 
 ## <desc>
-## <p>
-## Allow samba to share any file/directory read only.
-## </p>
+##	<p>
+##	Determine whether samba can share
+##	any content read only.
+##	</p>
 ## </desc>
 gen_tunable(samba_export_all_ro, false)
 
 ## <desc>
-## <p>
-## Allow samba to share any file/directory read/write.
-## </p>
+##	<p>
+##	Determine whether samba can share any
+##	content readable and writable.
+##	</p>
 ## </desc>
 gen_tunable(samba_export_all_rw, false)
 
 ## <desc>
-## <p>
-## Allow samba to run unconfined scripts
-## </p>
+##	<p>
+##	Determine whether samba can
+##	run unconfined scripts.
+##	</p>
 ## </desc>
 gen_tunable(samba_run_unconfined, false)
 
 ## <desc>
-## <p>
-## Allow samba to export NFS volumes.
-## </p>
+##	<p>
+##	Determine whether samba can
+##	use nfs file systems.
+##	</p>
 ## </desc>
 gen_tunable(samba_share_nfs, false)
 
 ## <desc>
-## <p>
-## Allow samba to export ntfs/fusefs volumes.
-## </p>
+##	<p>
+##	Determine whether samba can
+##	use fuse file systems.
+##	</p>
 ## </desc>
 gen_tunable(samba_share_fusefs, false)
 
+attribute_role samba_net_roles;
+roleattribute system_r samba_net_roles;
+
+attribute_role smbcontrol_roles;
+roleattribute system_r smbcontrol_roles;
+
+attribute_role smbmount_roles;
+roleattribute system_r smbmount_roles;
+
+attribute_role winbind_helper_roles;
+roleattribute system_r winbind_helper_roles;
+
 type nmbd_t;
 type nmbd_exec_t;
 init_daemon_domain(nmbd_t, nmbd_exec_t)
@@ -91,7 +119,7 @@
 type samba_net_t;
 type samba_net_exec_t;
 application_domain(samba_net_t, samba_net_exec_t)
-role system_r types samba_net_t;
+role samba_net_roles types samba_net_t;
 
 type samba_net_tmp_t;
 files_tmp_file(samba_net_tmp_t)
@@ -108,7 +136,7 @@
 type smbcontrol_t;
 type smbcontrol_exec_t;
 application_domain(smbcontrol_t, smbcontrol_exec_t)
-role system_r types smbcontrol_t;
+role smbcontrol_roles types smbcontrol_t;
 
 type smbd_t;
 type smbd_exec_t;
@@ -121,10 +149,9 @@
 files_pid_file(smbd_var_run_t)
 
 type smbmount_t;
-domain_type(smbmount_t)
-
 type smbmount_exec_t;
-domain_entry_file(smbmount_t, smbmount_exec_t)
+application_domain(smbmount_t, smbmount_exec_t)
+role smbmount_roles types smbmount_t;
 
 type swat_t;
 type swat_exec_t;
@@ -143,11 +170,9 @@
 init_daemon_domain(winbind_t, winbind_exec_t)
 
 type winbind_helper_t;
-domain_type(winbind_helper_t)
-role system_r types winbind_helper_t;
-
 type winbind_helper_exec_t;
-domain_entry_file(winbind_helper_t, winbind_helper_exec_t)
+application_domain(winbind_helper_t, winbind_helper_exec_t)
+role winbind_helper_roles types winbind_helper_t;
 
 type winbind_log_t;
 logging_log_file(winbind_log_t)
@@ -160,14 +185,12 @@
 
 ########################################
 #
-# Samba net local policy
+# Net local policy
 #
+
 allow samba_net_t self:capability { sys_chroot sys_nice dac_read_search dac_override };
 allow samba_net_t self:process { getsched setsched };
-allow samba_net_t self:unix_dgram_socket create_socket_perms;
-allow samba_net_t self:unix_stream_socket create_stream_socket_perms;
-allow samba_net_t self:udp_socket create_socket_perms;
-allow samba_net_t self:tcp_socket create_socket_perms;
+allow samba_net_t self:unix_stream_socket { accept listen };
 
 allow samba_net_t samba_etc_t:file read_file_perms;
 
@@ -182,28 +205,22 @@
 manage_files_pattern(samba_net_t, samba_var_t, samba_var_t)
 manage_lnk_files_pattern(samba_net_t, samba_var_t, samba_var_t)
 
-kernel_read_proc_symlinks(samba_net_t)
 kernel_read_system_state(samba_net_t)
+kernel_read_network_state(samba_net_t)
 
 corenet_all_recvfrom_unlabeled(samba_net_t)
 corenet_all_recvfrom_netlabel(samba_net_t)
-corenet_tcp_sendrecv_generic_if(samba_net_t)
 corenet_udp_sendrecv_generic_if(samba_net_t)
-corenet_raw_sendrecv_generic_if(samba_net_t)
 corenet_tcp_sendrecv_generic_node(samba_net_t)
-corenet_udp_sendrecv_generic_node(samba_net_t)
-corenet_raw_sendrecv_generic_node(samba_net_t)
-corenet_tcp_sendrecv_all_ports(samba_net_t)
-corenet_udp_sendrecv_all_ports(samba_net_t)
-corenet_tcp_bind_generic_node(samba_net_t)
-corenet_udp_bind_generic_node(samba_net_t)
+
+corenet_sendrecv_smbd_client_packets(samba_net_t)
 corenet_tcp_connect_smbd_port(samba_net_t)
+corenet_tcp_sendrecv_smbd_port(samba_net_t)
 
 dev_read_urand(samba_net_t)
 
 domain_use_interactive_fds(samba_net_t)
 
-files_read_etc_files(samba_net_t)
 files_read_usr_symlinks(samba_net_t)
 
 auth_use_nsswitch(samba_net_t)
@@ -223,43 +240,42 @@
 ')
 
 optional_policy(`
-	pcscd_read_pub_files(samba_net_t)
+	pcscd_read_pid_files(samba_net_t)
 ')
 
 optional_policy(`
 	kerberos_use(samba_net_t)
+	kerberos_etc_filetrans_keytab(samba_net_t, file)
 ')
 
 ########################################
 #
-# smbd Local policy
+# Smbd Local policy
 #
-allow smbd_t self:capability { chown fowner setgid setuid sys_nice sys_resource lease dac_override dac_read_search };
+
+allow smbd_t self:capability { chown fowner kill fsetid setgid setuid sys_chroot sys_nice sys_admin sys_resource lease dac_override dac_read_search };
 dontaudit smbd_t self:capability sys_tty_config;
-allow smbd_t self:process ~{ ptrace setcurrent setexec setfscreate setrlimit execmem execstack execheap };
-allow smbd_t self:process setrlimit;
+allow smbd_t self:process ~{ ptrace setcurrent setexec setfscreate execmem execstack execheap };
 allow smbd_t self:fd use;
 allow smbd_t self:fifo_file rw_fifo_file_perms;
 allow smbd_t self:msg { send receive };
 allow smbd_t self:msgq create_msgq_perms;
 allow smbd_t self:sem create_sem_perms;
 allow smbd_t self:shm create_shm_perms;
-allow smbd_t self:sock_file read_sock_file_perms;
-allow smbd_t self:tcp_socket create_stream_socket_perms;
-allow smbd_t self:udp_socket create_socket_perms;
-allow smbd_t self:unix_dgram_socket { create_socket_perms sendto };
-allow smbd_t self:unix_stream_socket { create_stream_socket_perms connectto };
-
-allow smbd_t nmbd_t:process { signal signull };
+allow smbd_t self:tcp_socket { accept listen };
+allow smbd_t self:unix_dgram_socket sendto;
+allow smbd_t self:unix_stream_socket { accept connectto listen };
 
-allow smbd_t nmbd_var_run_t:file rw_file_perms;
+allow smbd_t { swat_t winbind_t smbcontrol_t nmbd_t }:process { signal signull };
 
-allow smbd_t samba_etc_t:file { rw_file_perms setattr };
+allow smbd_t samba_etc_t:file { rw_file_perms setattr_file_perms };
 
 manage_dirs_pattern(smbd_t, samba_log_t, samba_log_t)
-manage_files_pattern(smbd_t, samba_log_t, samba_log_t)
+append_files_pattern(smbd_t, samba_log_t, samba_log_t)
+create_files_pattern(smbd_t, samba_log_t, samba_log_t)
+setattr_files_pattern(smbd_t, samba_log_t, samba_log_t)
 
-allow smbd_t samba_net_tmp_t:file getattr;
+allow smbd_t samba_net_tmp_t:file getattr_file_perms;
 
 manage_files_pattern(smbd_t, samba_secrets_t, samba_secrets_t)
 filetrans_pattern(smbd_t, samba_etc_t, samba_secrets_t, file)
@@ -267,14 +283,13 @@
 manage_dirs_pattern(smbd_t, samba_share_t, samba_share_t)
 manage_files_pattern(smbd_t, samba_share_t, samba_share_t)
 manage_lnk_files_pattern(smbd_t, samba_share_t, samba_share_t)
-allow smbd_t samba_share_t:filesystem getattr;
+allow smbd_t samba_share_t:filesystem { getattr quotaget };
 
 manage_dirs_pattern(smbd_t, samba_var_t, samba_var_t)
 manage_files_pattern(smbd_t, samba_var_t, samba_var_t)
 manage_lnk_files_pattern(smbd_t, samba_var_t, samba_var_t)
 manage_sock_files_pattern(smbd_t, samba_var_t, samba_var_t)
-
-allow smbd_t smbcontrol_t:process { signal signull };
+files_var_filetrans(smbd_t, samba_var_t, dir)
 
 manage_dirs_pattern(smbd_t, smbd_tmp_t, smbd_tmp_t)
 manage_files_pattern(smbd_t, smbd_tmp_t, smbd_tmp_t)
@@ -283,13 +298,13 @@
 manage_dirs_pattern(smbd_t, smbd_var_run_t, smbd_var_run_t)
 manage_files_pattern(smbd_t, smbd_var_run_t, smbd_var_run_t)
 manage_sock_files_pattern(smbd_t, smbd_var_run_t, smbd_var_run_t)
-files_pid_filetrans(smbd_t, smbd_var_run_t, file)
-
-allow smbd_t swat_t:process signal;
+files_pid_filetrans(smbd_t, smbd_var_run_t, { dir file })
 
-allow smbd_t winbind_var_run_t:sock_file rw_sock_file_perms;
+allow smbd_t winbind_var_run_t:sock_file read_sock_file_perms;
+stream_connect_pattern(smbd_t, winbind_var_run_t, winbind_var_run_t, winbind_t)
 
-allow smbd_t winbind_t:process { signal signull };
+allow smbd_t nmbd_var_run_t:file read_file_perms;
+stream_connect_pattern(smbd_t, nmbd_var_run_t, nmbd_var_run_t, nmbd_t)
 
 kernel_getattr_core_if(smbd_t)
 kernel_getattr_message_if(smbd_t)
@@ -299,56 +314,58 @@
 kernel_read_software_raid_state(smbd_t)
 kernel_read_system_state(smbd_t)
 
-corecmd_exec_shell(smbd_t)
 corecmd_exec_bin(smbd_t)
+corecmd_exec_shell(smbd_t)
 
 corenet_all_recvfrom_unlabeled(smbd_t)
 corenet_all_recvfrom_netlabel(smbd_t)
 corenet_tcp_sendrecv_generic_if(smbd_t)
-corenet_udp_sendrecv_generic_if(smbd_t)
-corenet_raw_sendrecv_generic_if(smbd_t)
 corenet_tcp_sendrecv_generic_node(smbd_t)
-corenet_udp_sendrecv_generic_node(smbd_t)
-corenet_raw_sendrecv_generic_node(smbd_t)
-corenet_tcp_sendrecv_all_ports(smbd_t)
-corenet_udp_sendrecv_all_ports(smbd_t)
 corenet_tcp_bind_generic_node(smbd_t)
-corenet_udp_bind_generic_node(smbd_t)
+
+corenet_sendrecv_smbd_client_packets(smbd_t)
+corenet_tcp_connect_smbd_port(smbd_t)
+corenet_sendrecv_smbd_server_packets(smbd_t)
 corenet_tcp_bind_smbd_port(smbd_t)
+corenet_tcp_sendrecv_smbd_port(smbd_t)
+
+corenet_sendrecv_ipp_client_packets(smbd_t)
 corenet_tcp_connect_ipp_port(smbd_t)
-corenet_tcp_connect_smbd_port(smbd_t)
+corenet_tcp_sendrecv_ipp_port(smbd_t)
 
 dev_read_sysfs(smbd_t)
 dev_read_urand(smbd_t)
 dev_getattr_mtrr_dev(smbd_t)
 dev_dontaudit_getattr_usbfs_dirs(smbd_t)
-# For redhat bug 566984
 dev_getattr_all_blk_files(smbd_t)
 dev_getattr_all_chr_files(smbd_t)
 
+domain_use_interactive_fds(smbd_t)
+domain_dontaudit_list_all_domains_state(smbd_t)
+
+files_list_var_lib(smbd_t)
+files_read_etc_runtime_files(smbd_t)
+files_read_usr_files(smbd_t)
+files_search_spool(smbd_t)
+files_dontaudit_getattr_all_dirs(smbd_t)
+files_dontaudit_list_all_mountpoints(smbd_t)
+files_list_mnt(smbd_t)
+
 fs_getattr_all_fs(smbd_t)
+fs_getattr_all_dirs(smbd_t)
 fs_get_xattr_fs_quotas(smbd_t)
 fs_search_auto_mountpoints(smbd_t)
 fs_getattr_rpc_dirs(smbd_t)
 fs_list_inotifyfs(smbd_t)
+fs_get_all_fs_quotas(smbd_t)
+
+term_use_ptmx(smbd_t)
 
 auth_use_nsswitch(smbd_t)
 auth_domtrans_chk_passwd(smbd_t)
 auth_domtrans_upd_passwd(smbd_t)
 auth_manage_cache(smbd_t)
-
-domain_use_interactive_fds(smbd_t)
-domain_dontaudit_list_all_domains_state(smbd_t)
-
-files_list_var_lib(smbd_t)
-files_read_etc_files(smbd_t)
-files_read_etc_runtime_files(smbd_t)
-files_read_usr_files(smbd_t)
-files_search_spool(smbd_t)
-# smbd seems to getattr all mountpoints
-files_dontaudit_getattr_all_dirs(smbd_t)
-# Allow samba to list mnt_t for potential mounted dirs
-files_list_mnt(smbd_t)
+auth_write_login_records(smbd_t)
 
 init_rw_utmp(smbd_t)
 
@@ -358,15 +375,16 @@
 miscfiles_read_localization(smbd_t)
 miscfiles_read_public_files(smbd_t)
 
+sysnet_use_ldap(smbd_t)
+
 userdom_use_unpriv_users_fds(smbd_t)
-userdom_search_user_home_content(smbd_t)
 userdom_signal_all_users(smbd_t)
+userdom_home_filetrans_user_home_dir(smbd_t)
+userdom_user_home_dir_filetrans_user_home_content(smbd_t, { dir file lnk_file sock_file fifo_file })
 
 usermanage_read_crack_db(smbd_t)
 
-term_use_ptmx(smbd_t)
-
-ifdef(`hide_broken_symptoms', `
+ifdef(`hide_broken_symptoms',`
 	files_dontaudit_getattr_default_dirs(smbd_t)
 	files_dontaudit_getattr_boot_dirs(smbd_t)
 	fs_dontaudit_getattr_tmpfs_dirs(smbd_t)
@@ -376,6 +394,11 @@
 	miscfiles_manage_public_files(smbd_t)
 ')
 
+tunable_policy(`samba_create_home_dirs',`
+	allow smbd_t self:capability chown;
+	userdom_create_user_home_dirs(smbd_t)
+')
+
 tunable_policy(`samba_domain_controller',`
 	gen_require(`
 		class passwd passwd;
@@ -394,10 +417,15 @@
 	userdom_manage_user_home_content_symlinks(smbd_t)
 	userdom_manage_user_home_content_sockets(smbd_t)
 	userdom_manage_user_home_content_pipes(smbd_t)
-	userdom_user_home_dir_filetrans_user_home_content(smbd_t, { dir file lnk_file sock_file fifo_file })
 ')
 
-# Support Samba sharing of NFS mount points
+tunable_policy(`samba_portmapper',`
+	corenet_sendrecv_all_server_packets(smbd_t)
+	corenet_tcp_bind_epmap_port(smbd_t)
+	corenet_tcp_bind_all_unreserved_ports(smbd_t)
+	corenet_tcp_sendrecv_all_ports(smbd_t)
+')
+
 tunable_policy(`samba_share_nfs',`
 	fs_manage_nfs_dirs(smbd_t)
 	fs_manage_nfs_files(smbd_t)
@@ -406,7 +434,6 @@
 	fs_manage_nfs_named_sockets(smbd_t)
 ')
 
-# Support Samba sharing of ntfs/fusefs mount points
 tunable_policy(`samba_share_fusefs',`
 	fs_manage_fusefs_dirs(smbd_t)
 	fs_manage_fusefs_files(smbd_t)
@@ -414,6 +441,26 @@
 	fs_search_fusefs(smbd_t)
 ')
 
+tunable_policy(`samba_export_all_ro',`
+	fs_read_noxattr_fs_files(smbd_t)
+	files_list_non_auth_dirs(smbd_t)
+	files_read_non_auth_files(smbd_t)
+')
+
+tunable_policy(`samba_export_all_rw',`
+	fs_read_noxattr_fs_files(smbd_t)
+	files_manage_non_auth_files(smbd_t)
+')
+
+optional_policy(`
+	ccs_read_config(smbd_t)
+')
+
+optional_policy(`
+	ctdbd_stream_connect(smbd_t)
+	ctdbd_manage_lib_files(smbd_t)
+')
+
 optional_policy(`
 	cups_read_rw_config(smbd_t)
 	cups_stream_connect(smbd_t)
@@ -425,10 +472,6 @@
 ')
 
 optional_policy(`
-	ldap_stream_connect(smbd_t)
-')
-
-optional_policy(`
 	lpd_exec_lpr(smbd_t)
 ')
 
@@ -449,32 +492,9 @@
 	udev_read_db(smbd_t)
 ')
 
-tunable_policy(`samba_create_home_dirs',`
-	allow smbd_t self:capability chown;
-	userdom_create_user_home_dirs(smbd_t)
-	userdom_home_filetrans_user_home_dir(smbd_t)
-')
-
-tunable_policy(`samba_export_all_ro',`
-	fs_read_noxattr_fs_files(smbd_t)
-	files_list_non_auth_dirs(smbd_t)
-	files_read_non_auth_files(smbd_t)
-	fs_read_noxattr_fs_files(nmbd_t)
-	files_list_non_auth_dirs(nmbd_t)
-	files_read_non_auth_files(nmbd_t)
-')
-
-tunable_policy(`samba_export_all_rw',`
-	fs_read_noxattr_fs_files(smbd_t)
-	files_manage_non_auth_files(smbd_t)
-	fs_read_noxattr_fs_files(nmbd_t)
-	files_manage_non_auth_files(nmbd_t)
-	userdom_user_home_dir_filetrans_user_home_content(nmbd_t, { file dir })
-')
-
 ########################################
 #
-# nmbd Local policy
+# Nmbd Local policy
 #
 
 dontaudit nmbd_t self:capability sys_tty_config;
@@ -485,24 +505,31 @@
 allow nmbd_t self:msgq create_msgq_perms;
 allow nmbd_t self:sem create_sem_perms;
 allow nmbd_t self:shm create_shm_perms;
-allow nmbd_t self:sock_file read_sock_file_perms;
-allow nmbd_t self:tcp_socket create_stream_socket_perms;
-allow nmbd_t self:udp_socket create_socket_perms;
-allow nmbd_t self:unix_dgram_socket { create_socket_perms sendto };
-allow nmbd_t self:unix_stream_socket { create_stream_socket_perms connectto };
+allow nmbd_t self:tcp_socket { accept listen };
+allow nmbd_t self:unix_dgram_socket sendto;
+allow nmbd_t self:unix_stream_socket { accept connectto listen };
 
+manage_dirs_pattern(nmbd_t, { smbd_var_run_t nmbd_var_run_t }, nmbd_var_run_t)
 manage_files_pattern(nmbd_t, nmbd_var_run_t, nmbd_var_run_t)
-files_pid_filetrans(nmbd_t, nmbd_var_run_t, file)
+manage_sock_files_pattern(nmbd_t, nmbd_var_run_t, nmbd_var_run_t)
+files_pid_filetrans(nmbd_t, nmbd_var_run_t, { dir file sock_file })
+filetrans_pattern(nmbd_t, smbd_var_run_t, nmbd_var_run_t, dir)
 
 read_files_pattern(nmbd_t, samba_etc_t, samba_etc_t)
 read_lnk_files_pattern(nmbd_t, samba_etc_t, samba_etc_t)
 
 manage_dirs_pattern(nmbd_t, samba_log_t, samba_log_t)
-manage_files_pattern(nmbd_t, samba_log_t, samba_log_t)
+append_files_pattern(nmbd_t, samba_log_t, samba_log_t)
+create_files_pattern(nmbd_t, samba_log_t, samba_log_t)
+setattr_files_pattern(nmbd_t, samba_log_t, samba_log_t)
 
 manage_files_pattern(nmbd_t, samba_var_t, samba_var_t)
+manage_files_pattern(nmbd_t, samba_var_t, samba_var_t)
+manage_lnk_files_pattern(nmbd_t, samba_var_t, samba_var_t)
+manage_sock_files_pattern(nmbd_t, samba_var_t, samba_var_t)
+files_var_filetrans(nmbd_t, samba_var_t, dir)
 
-allow nmbd_t smbcontrol_t:process signal;
+allow nmbd_t { swat_t smbcontrol_t }:process signal;
 
 allow nmbd_t smbd_var_run_t:dir rw_dir_perms;
 
@@ -519,26 +546,27 @@
 corenet_udp_sendrecv_generic_if(nmbd_t)
 corenet_tcp_sendrecv_generic_node(nmbd_t)
 corenet_udp_sendrecv_generic_node(nmbd_t)
-corenet_tcp_sendrecv_all_ports(nmbd_t)
-corenet_udp_sendrecv_all_ports(nmbd_t)
 corenet_udp_bind_generic_node(nmbd_t)
-corenet_udp_bind_nmbd_port(nmbd_t)
+
 corenet_sendrecv_nmbd_server_packets(nmbd_t)
-corenet_sendrecv_nmbd_client_packets(nmbd_t)
+corenet_udp_bind_nmbd_port(nmbd_t)
+corenet_udp_sendrecv_nmbd_port(nmbd_t)
+
+corenet_sendrecv_smbd_client_packets(nmbd_t)
 corenet_tcp_connect_smbd_port(nmbd_t)
+corenet_tcp_sendrecv_smbd_port(nmbd_t)
 
 dev_read_sysfs(nmbd_t)
 dev_getattr_mtrr_dev(nmbd_t)
 
-fs_getattr_all_fs(nmbd_t)
-fs_search_auto_mountpoints(nmbd_t)
-
 domain_use_interactive_fds(nmbd_t)
 
 files_read_usr_files(nmbd_t)
-files_read_etc_files(nmbd_t)
 files_list_var_lib(nmbd_t)
 
+fs_getattr_all_fs(nmbd_t)
+fs_search_auto_mountpoints(nmbd_t)
+
 auth_use_nsswitch(nmbd_t)
 
 logging_search_logs(nmbd_t)
@@ -547,7 +575,18 @@
 miscfiles_read_localization(nmbd_t)
 
 userdom_use_unpriv_users_fds(nmbd_t)
-userdom_dontaudit_search_user_home_dirs(nmbd_t)
+userdom_user_home_dir_filetrans_user_home_content(nmbd_t, { file dir })
+
+tunable_policy(`samba_export_all_ro',`
+	fs_read_noxattr_fs_files(nmbd_t)
+	files_list_non_auth_dirs(nmbd_t)
+	files_read_non_auth_files(nmbd_t)
+')
+
+tunable_policy(`samba_export_all_rw',`
+	fs_read_noxattr_fs_files(nmbd_t)
+	files_manage_non_auth_files(nmbd_t)
+')
 
 optional_policy(`
 	seutil_sigchld_newrole(nmbd_t)
@@ -559,20 +598,16 @@
 
 ########################################
 #
-# smbcontrol local policy
+# Smbcontrol local policy
 #
 
-# internal communication is often done using fifo and unix sockets.
-allow smbcontrol_t self:fifo_file rw_file_perms;
+allow smbcontrol_t self:process signal;
+allow smbcontrol_t self:fifo_file rw_fifo_file_perms;
 allow smbcontrol_t self:unix_stream_socket create_stream_socket_perms;
+allow smbcontrol_t self:process { signal signull };
 
-allow smbcontrol_t nmbd_t:process { signal signull };
-
-allow smbcontrol_t nmbd_var_run_t:file { read lock };
-
-allow smbcontrol_t smbd_t:process signal;
-
-allow smbcontrol_t winbind_t:process { signal signull };
+allow smbcontrol_t { winbind_t nmbd_t smbd_t }:process { signal signull };
+read_files_pattern(smbcontrol_t, { nmbd_var_run_t smbd_var_run_t }, { nmbd_var_run_t smbd_var_run_t })
 
 samba_read_config(smbcontrol_t)
 samba_rw_var_files(smbcontrol_t)
@@ -581,53 +616,67 @@
 
 domain_use_interactive_fds(smbcontrol_t)
 
+dev_read_urand(smbcontrol_t)
+
 files_read_etc_files(smbcontrol_t)
+files_search_var_lib(smbcontrol_t)
+
+term_use_console(smbcontrol_t)
 
 miscfiles_read_localization(smbcontrol_t)
 
+sysnet_use_ldap(smbcontrol_t)
+
 userdom_use_user_terminals(smbcontrol_t)
 
+optional_policy(`
+	ctdbd_stream_connect(smbcontrol_t)
+')
+
 ########################################
 #
-# smbmount Local policy
+# Smbmount Local policy
 #
 
-allow smbmount_t self:capability { sys_rawio sys_admin dac_override chown }; # FIXME: is all of this really necessary?
-allow smbmount_t self:process { fork signal_perms };
-allow smbmount_t self:tcp_socket create_stream_socket_perms;
-allow smbmount_t self:udp_socket connect;
+allow smbmount_t self:capability { sys_rawio sys_admin dac_override chown };
+allow smbmount_t self:process signal_perms;
+allow smbmount_t self:tcp_socket { accept listen };
 allow smbmount_t self:unix_dgram_socket create_socket_perms;
 allow smbmount_t self:unix_stream_socket create_socket_perms;
 
 allow smbmount_t samba_etc_t:dir list_dir_perms;
 allow smbmount_t samba_etc_t:file read_file_perms;
 
-can_exec(smbmount_t, smbmount_exec_t)
-
 allow smbmount_t samba_log_t:dir list_dir_perms;
-allow smbmount_t samba_log_t:file manage_file_perms;
+append_files_pattern(smbmount_t, samba_log_t, samba_log_t)
+create_files_pattern(smbmount_t, samba_log_t, samba_log_t)
+setattr_files_pattern(smbmount_t, samba_log_t, samba_log_t)
 
 allow smbmount_t samba_secrets_t:file manage_file_perms;
 
 manage_files_pattern(smbmount_t, samba_var_t, samba_var_t)
 manage_lnk_files_pattern(smbmount_t, samba_var_t, samba_var_t)
-files_list_var_lib(smbmount_t)
+
+can_exec(smbmount_t, smbmount_exec_t)
 
 kernel_read_system_state(smbmount_t)
 
 corenet_all_recvfrom_unlabeled(smbmount_t)
 corenet_all_recvfrom_netlabel(smbmount_t)
 corenet_tcp_sendrecv_generic_if(smbmount_t)
-corenet_raw_sendrecv_generic_if(smbmount_t)
-corenet_udp_sendrecv_generic_if(smbmount_t)
 corenet_tcp_sendrecv_generic_node(smbmount_t)
-corenet_raw_sendrecv_generic_node(smbmount_t)
-corenet_udp_sendrecv_generic_node(smbmount_t)
-corenet_tcp_sendrecv_all_ports(smbmount_t)
-corenet_udp_sendrecv_all_ports(smbmount_t)
-corenet_tcp_bind_generic_node(smbmount_t)
-corenet_udp_bind_generic_node(smbmount_t)
+
+corenet_sendrecv_all_client_packets(smbmount_t)
 corenet_tcp_connect_all_ports(smbmount_t)
+corenet_tcp_sendrecv_all_ports(smbmount_t)
+
+corecmd_list_bin(smbmount_t)
+
+files_list_mnt(smbmount_t)
+files_list_var_lib(smbmount_t)
+files_mounton_mnt(smbmount_t)
+files_manage_etc_runtime_files(smbmount_t)
+files_etc_filetrans_etc_runtime(smbmount_t, file)
 
 fs_getattr_cifs(smbmount_t)
 fs_mount_cifs(smbmount_t)
@@ -639,14 +688,6 @@
 storage_raw_read_fixed_disk(smbmount_t)
 storage_raw_write_fixed_disk(smbmount_t)
 
-corecmd_list_bin(smbmount_t)
-
-files_list_mnt(smbmount_t)
-files_mounton_mnt(smbmount_t)
-files_manage_etc_runtime_files(smbmount_t)
-files_etc_filetrans_etc_runtime(smbmount_t, file)
-files_read_etc_files(smbmount_t)
-
 auth_use_nsswitch(smbmount_t)
 
 miscfiles_read_localization(smbmount_t)
@@ -666,35 +707,28 @@
 
 ########################################
 #
-# SWAT Local policy
+# Swat Local policy
 #
 
 allow swat_t self:capability { dac_override setuid setgid sys_resource };
 allow swat_t self:process { setrlimit signal_perms };
 allow swat_t self:fifo_file rw_fifo_file_perms;
 allow swat_t self:netlink_tcpdiag_socket r_netlink_socket_perms;
-allow swat_t self:tcp_socket create_stream_socket_perms;
-allow swat_t self:udp_socket create_socket_perms;
+allow swat_t self:tcp_socket { accept listen };
 allow swat_t self:unix_stream_socket connectto;
 
-samba_domtrans_smbd(swat_t)
-allow swat_t smbd_t:process { signal signull };
-
-samba_domtrans_nmbd(swat_t)
-allow swat_t nmbd_t:process { signal signull };
-allow nmbd_t swat_t:process signal;
-
-allow swat_t smbd_var_run_t:file { lock unlink };
-
-allow swat_t smbd_port_t:tcp_socket name_bind;
+allow swat_t { nmbd_t smbd_t }:process { signal signull };
 
-allow swat_t nmbd_port_t:udp_socket name_bind;
+allow swat_t smbd_var_run_t:file read_file_perms;
+allow swat_t smbd_var_run_t:file { lock delete_file_perms };
 
 rw_files_pattern(swat_t, samba_etc_t, samba_etc_t)
 read_lnk_files_pattern(swat_t, samba_etc_t, samba_etc_t)
 
 manage_dirs_pattern(swat_t, samba_log_t, samba_log_t)
-manage_files_pattern(swat_t, samba_log_t, samba_log_t)
+append_files_pattern(swat_t, samba_log_t, samba_log_t)
+create_files_pattern(swat_t, samba_log_t, samba_log_t)
+setattr_files_pattern(swat_t, samba_log_t, samba_log_t)
 
 manage_files_pattern(swat_t, samba_etc_t, samba_secrets_t)
 
@@ -702,9 +736,7 @@
 
 allow swat_t smbd_exec_t:file mmap_file_perms ;
 
-allow swat_t smbd_t:process signull;
-
-allow swat_t smbd_var_run_t:file read_file_perms;
+allow swat_t { winbind_t smbd_t }:process { signal signull };
 
 manage_dirs_pattern(swat_t, swat_tmp_t, swat_tmp_t)
 manage_files_pattern(swat_t, swat_tmp_t, swat_tmp_t)
@@ -713,13 +745,18 @@
 manage_files_pattern(swat_t, swat_var_run_t, swat_var_run_t)
 files_pid_filetrans(swat_t, swat_var_run_t, file)
 
-allow swat_t winbind_exec_t:file mmap_file_perms;
-domtrans_pattern(swat_t, winbind_exec_t, winbind_t)
-allow swat_t winbind_t:process { signal signull };
-
+read_files_pattern(swat_t, winbind_var_run_t, winbind_var_run_t)
 allow swat_t winbind_var_run_t:dir { write add_name remove_name };
 allow swat_t winbind_var_run_t:sock_file { create unlink };
 
+read_files_pattern(swat_t, nmbd_var_run_t, nmbd_var_run_t)
+stream_connect_pattern(swat_t, nmbd_var_run_t, nmbd_var_run_t, nmbd_t)
+
+samba_domtrans_smbd(swat_t)
+samba_domtrans_nmbd(swat_t)
+
+domtrans_pattern(swat_t, winbind_exec_t, winbind_t)
+
 kernel_read_kernel_sysctls(swat_t)
 kernel_read_system_state(swat_t)
 kernel_read_network_state(swat_t)
@@ -730,24 +767,32 @@
 corenet_all_recvfrom_netlabel(swat_t)
 corenet_tcp_sendrecv_generic_if(swat_t)
 corenet_udp_sendrecv_generic_if(swat_t)
-corenet_raw_sendrecv_generic_if(swat_t)
 corenet_tcp_sendrecv_generic_node(swat_t)
 corenet_udp_sendrecv_generic_node(swat_t)
-corenet_raw_sendrecv_generic_node(swat_t)
-corenet_tcp_sendrecv_all_ports(swat_t)
-corenet_udp_sendrecv_all_ports(swat_t)
-corenet_tcp_connect_smbd_port(swat_t)
-corenet_tcp_connect_ipp_port(swat_t)
+corenet_tcp_bind_generic_node(swat_t)
+corenet_udp_bind_generic_node(swat_t)
+
+corenet_sendrecv_nmbd_server_packets(swat_t)
+corenet_udp_bind_nmbd_port(swat_t)
+corenet_udp_sendrecv_nmbd_port(swat_t)
+
 corenet_sendrecv_smbd_client_packets(swat_t)
+corenet_tcp_connect_smbd_port(swat_t)
+corenet_sendrecv_smbd_server_packets(swat_t)
+corenet_tcp_bind_smbd_port(swat_t)
+corenet_tcp_sendrecv_smbd_port(swat_t)
+
 corenet_sendrecv_ipp_client_packets(swat_t)
+corenet_tcp_connect_ipp_port(swat_t)
+corenet_tcp_sendrecv_ipp_port(swat_t)
 
 dev_read_urand(swat_t)
 
 files_list_var_lib(swat_t)
-files_read_etc_files(swat_t)
 files_search_home(swat_t)
 files_read_usr_files(swat_t)
 fs_getattr_xattr_fs(swat_t)
+files_list_var_lib(swat_t)
 
 auth_domtrans_chk_passwd(swat_t)
 auth_use_nsswitch(swat_t)
@@ -761,6 +806,8 @@
 
 miscfiles_read_localization(swat_t)
 
+sysnet_use_ldap(swat_t)
+
 optional_policy(`
 	cups_read_rw_config(swat_t)
 	cups_stream_connect(swat_t)
@@ -783,14 +830,13 @@
 dontaudit winbind_t self:capability sys_tty_config;
 allow winbind_t self:process { signal_perms getsched setsched };
 allow winbind_t self:fifo_file rw_fifo_file_perms;
-allow winbind_t self:unix_dgram_socket create_socket_perms;
-allow winbind_t self:unix_stream_socket create_stream_socket_perms;
-allow winbind_t self:tcp_socket create_stream_socket_perms;
-allow winbind_t self:udp_socket create_socket_perms;
+allow winbind_t self:unix_stream_socket { accept listen };
+allow winbind_t self:tcp_socket { accept listen };
 
 allow winbind_t nmbd_t:process { signal signull };
 
 allow winbind_t nmbd_var_run_t:file read_file_perms;
+stream_connect_pattern(winbind_t, nmbd_var_run_t, nmbd_var_run_t, nmbd_t)
 
 allow winbind_t samba_etc_t:dir list_dir_perms;
 read_files_pattern(winbind_t, samba_etc_t, samba_etc_t)
@@ -800,17 +846,19 @@
 filetrans_pattern(winbind_t, samba_etc_t, samba_secrets_t, file)
 
 manage_dirs_pattern(winbind_t, samba_log_t, samba_log_t)
-manage_files_pattern(winbind_t, samba_log_t, samba_log_t)
+append_files_pattern(winbind_t, samba_log_t, samba_log_t)
+create_files_pattern(winbind_t, samba_log_t, samba_log_t)
+setattr_files_pattern(winbind_t, samba_log_t, samba_log_t)
 manage_lnk_files_pattern(winbind_t, samba_log_t, samba_log_t)
 
 manage_dirs_pattern(winbind_t, samba_var_t, samba_var_t)
 manage_files_pattern(winbind_t, samba_var_t, samba_var_t)
 manage_lnk_files_pattern(winbind_t, samba_var_t, samba_var_t)
-files_list_var_lib(winbind_t)
 
 rw_files_pattern(winbind_t, smbd_tmp_t, smbd_tmp_t)
 
-allow winbind_t winbind_log_t:file manage_file_perms;
+# This needs a file context specification
+allow winbind_t winbind_log_t:file { append_file_perms create_file_perms setattr_file_perms };
 logging_log_filetrans(winbind_t, winbind_log_t, file)
 
 manage_dirs_pattern(winbind_t, winbind_tmp_t, winbind_tmp_t)
@@ -818,10 +866,16 @@
 manage_sock_files_pattern(winbind_t, winbind_tmp_t, winbind_tmp_t)
 files_tmp_filetrans(winbind_t, winbind_tmp_t, { file dir })
 
+manage_dirs_pattern(winbind_t, { smbd_var_run_t winbind_var_run_t }, winbind_var_run_t)
 manage_files_pattern(winbind_t, winbind_var_run_t, winbind_var_run_t)
 manage_sock_files_pattern(winbind_t, winbind_var_run_t, winbind_var_run_t)
-files_pid_filetrans(winbind_t, winbind_var_run_t, file)
+files_pid_filetrans(winbind_t, winbind_var_run_t, { sock_file file dir })
+filetrans_pattern(winbind_t, smbd_var_run_t, winbind_var_run_t, dir)
 
+manage_files_pattern(winbind_t, smbd_var_run_t, smbd_var_run_t)
+manage_sock_files_pattern(winbind_t, smbd_var_run_t, smbd_var_run_t)
+
+kernel_read_network_state(winbind_t)
 kernel_read_kernel_sysctls(winbind_t)
 kernel_read_system_state(winbind_t)
 
@@ -830,15 +884,10 @@
 corenet_all_recvfrom_unlabeled(winbind_t)
 corenet_all_recvfrom_netlabel(winbind_t)
 corenet_tcp_sendrecv_generic_if(winbind_t)
-corenet_udp_sendrecv_generic_if(winbind_t)
-corenet_raw_sendrecv_generic_if(winbind_t)
 corenet_tcp_sendrecv_generic_node(winbind_t)
-corenet_udp_sendrecv_generic_node(winbind_t)
-corenet_raw_sendrecv_generic_node(winbind_t)
 corenet_tcp_sendrecv_all_ports(winbind_t)
-corenet_udp_sendrecv_all_ports(winbind_t)
-corenet_tcp_bind_generic_node(winbind_t)
-corenet_udp_bind_generic_node(winbind_t)
+
+corenet_sendrecv_all_client_packets(winbind_t)
 corenet_tcp_connect_smbd_port(winbind_t)
 corenet_tcp_connect_epmap_port(winbind_t)
 corenet_tcp_connect_all_unreserved_ports(winbind_t)
@@ -846,6 +895,11 @@
 dev_read_sysfs(winbind_t)
 dev_read_urand(winbind_t)
 
+domain_use_interactive_fds(winbind_t)
+
+files_read_usr_symlinks(winbind_t)
+files_list_var_lib(winbind_t)
+
 fs_getattr_all_fs(winbind_t)
 fs_search_auto_mountpoints(winbind_t)
 
@@ -853,14 +907,10 @@
 auth_use_nsswitch(winbind_t)
 auth_manage_cache(winbind_t)
 
-domain_use_interactive_fds(winbind_t)
-
-files_read_etc_files(winbind_t)
-files_read_usr_symlinks(winbind_t)
-
 logging_send_syslog_msg(winbind_t)
 
 miscfiles_read_localization(winbind_t)
+miscfiles_read_generic_certs(winbind_t)
 
 userdom_dontaudit_use_unpriv_user_fds(winbind_t)
 userdom_manage_user_home_content_dirs(winbind_t)
@@ -871,6 +921,11 @@
 userdom_user_home_dir_filetrans_user_home_content(winbind_t, { dir file lnk_file fifo_file sock_file })
 
 optional_policy(`
+	ctdbd_stream_connect(winbind_t)
+	ctdbd_manage_lib_files(winbind_t)
+')
+
+optional_policy(`
 	kerberos_use(winbind_t)
 ')
 
@@ -887,24 +942,24 @@
 # Winbind helper local policy
 #
 
-allow winbind_helper_t self:unix_dgram_socket create_socket_perms;
-allow winbind_helper_t self:unix_stream_socket create_stream_socket_perms;
+allow winbind_helper_t self:unix_stream_socket { accept listen };
 
 allow winbind_helper_t samba_etc_t:dir list_dir_perms;
 read_files_pattern(winbind_helper_t, samba_etc_t, samba_etc_t)
 read_lnk_files_pattern(winbind_helper_t, samba_etc_t, samba_etc_t)
 
 allow winbind_helper_t samba_var_t:dir search_dir_perms;
-files_list_var_lib(winbind_helper_t)
 
 allow winbind_t smbcontrol_t:process signal;
 
 stream_connect_pattern(winbind_helper_t, winbind_var_run_t, winbind_var_run_t, winbind_t)
 
-term_list_ptys(winbind_helper_t)
-
 domain_use_interactive_fds(winbind_helper_t)
 
+files_list_var_lib(winbind_helper_t)
+
+term_list_ptys(winbind_helper_t)
+
 auth_use_nsswitch(winbind_helper_t)
 
 logging_send_syslog_msg(winbind_helper_t)
@@ -925,7 +980,7 @@
 
 ########################################
 #
-# samba_unconfined_script_t local policy
+# Unconfined script local policy
 #
 
 optional_policy(`
@@ -943,5 +998,7 @@
 
 	tunable_policy(`samba_run_unconfined',`
 		domtrans_pattern(smbd_t, samba_unconfined_script_exec_t, samba_unconfined_script_t)
+	',`
+		can_exec(smbd_t, samba_unconfined_script_exec_t)
 	')
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/sambagui.fc refpolicy/policy/modules/contrib/sambagui.fc
--- refpolicy/policy/modules/contrib/sambagui.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/sambagui.fc	2012-10-27 13:03:11.511002166 +0200
@@ -1 +1 @@
-/usr/share/system-config-samba/system-config-samba-mechanism.py		--	gen_context(system_u:object_r:sambagui_exec_t,s0)
+/usr/share/system-config-samba/system-config-samba-mechanism\.py	--	gen_context(system_u:object_r:sambagui_exec_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/sambagui.if refpolicy/policy/modules/contrib/sambagui.if
--- refpolicy/policy/modules/contrib/sambagui.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/sambagui.if	2012-10-27 13:03:11.512002166 +0200
@@ -1,2 +1 @@
-## <summary>system-config-samba dbus service policy</summary>
-
+## <summary>system-config-samba dbus service.</summary>
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/sambagui.te refpolicy/policy/modules/contrib/sambagui.te
--- refpolicy/policy/modules/contrib/sambagui.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/sambagui.te	2012-10-27 13:03:11.512002166 +0200
@@ -1,42 +1,44 @@
-policy_module(sambagui, 1.1.0)
+policy_module(sambagui, 1.1.2)
 
 ########################################
 #
 # Declarations
 #
 
+attribute_role sambagui_roles;
+roleattribute system_r sambagui_roles;
+
 type sambagui_t;
 type sambagui_exec_t;
-dbus_system_domain(sambagui_t, sambagui_exec_t)
+application_domain(sambagui_t, sambagui_exec_t)
+role sambagui_roles types sambagui_t;
 
 ########################################
 #
-# system-config-samba local policy
+# Local policy
 #
 
 allow sambagui_t self:capability dac_override;
 allow sambagui_t self:fifo_file rw_fifo_file_perms;
-allow sambagui_t self:unix_dgram_socket create_socket_perms;
 
-# read meminfo
 kernel_read_system_state(sambagui_t)
 
-# execut apps of system-config-samba
-corecmd_exec_shell(sambagui_t)
 corecmd_exec_bin(sambagui_t)
+corecmd_exec_shell(sambagui_t)
 
 dev_dontaudit_read_urand(sambagui_t)
 
-files_read_etc_files(sambagui_t)
-files_search_var_lib(sambagui_t)
 files_read_usr_files(sambagui_t)
 
 auth_use_nsswitch(sambagui_t)
+auth_dontaudit_read_shadow(sambagui_t)
 
 logging_send_syslog_msg(sambagui_t)
 
 miscfiles_read_localization(sambagui_t)
 
+sysnet_use_ldap(sambagui_t)
+
 optional_policy(`
 	consoletype_exec(sambagui_t)
 ')
@@ -46,11 +48,14 @@
 ')
 
 optional_policy(`
-	policykit_dbus_chat(sambagui_t)
+	dbus_system_domain(sambagui_t, sambagui_exec_t)
+
+	optional_policy(`
+		policykit_dbus_chat(sambagui_t)
+	')
 ')
 
 optional_policy(`
-	# handling with samba conf files
 	samba_append_log(sambagui_t)
 	samba_manage_config(sambagui_t)
 	samba_manage_var_files(sambagui_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/samhain.fc refpolicy/policy/modules/contrib/samhain.fc
--- refpolicy/policy/modules/contrib/samhain.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/samhain.fc	2012-10-27 13:03:40.261002229 +0200
@@ -1,13 +1,13 @@
 /etc/rc\.d/init\.d/samhain	--	gen_context(system_u:object_r:samhain_initrc_exec_t,s0)
 
-/etc/samhainrc			--	gen_context(system_u:object_r:samhain_etc_t,mls_systemhigh)
+/etc/samhainrc	--	gen_context(system_u:object_r:samhain_etc_t,mls_systemhigh)
 
-/usr/sbin/samhain		--	gen_context(system_u:object_r:samhain_exec_t,s0)
+/usr/sbin/samhain	--	gen_context(system_u:object_r:samhain_exec_t,s0)
 /usr/sbin/samhain_setpwd	--	gen_context(system_u:object_r:samhain_exec_t,s0)
 
-/var/lib/samhain(/.*)?			gen_context(system_u:object_r:samhain_db_t,mls_systemhigh)
+/var/lib/samhain(/.*)?	gen_context(system_u:object_r:samhain_db_t,mls_systemhigh)
 
-/var/log/samhain_log		--	gen_context(system_u:object_r:samhain_log_t,mls_systemhigh)
+/var/log/samhain_log.*	--	gen_context(system_u:object_r:samhain_log_t,mls_systemhigh)
 /var/log/samhain_log\.lock	--	gen_context(system_u:object_r:samhain_log_t,mls_systemhigh)
 
-/var/run/samhain\.pid		--	gen_context(system_u:object_r:samhain_var_run_t,mls_systemhigh)
+/var/run/samhain\.pid	--	gen_context(system_u:object_r:samhain_var_run_t,mls_systemhigh)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/samhain.if refpolicy/policy/modules/contrib/samhain.if
--- refpolicy/policy/modules/contrib/samhain.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/samhain.if	2012-10-27 13:03:40.278002228 +0200
@@ -1,94 +1,28 @@
-## <summary>Samhain - check file integrity</summary>
+## <summary>Check file integrity.</summary>
 
 #######################################
 ## <summary>
-##	The template containing the most basic rules
-##	common to the samhain domains.
+##	The template to define a samhain domain.
 ## </summary>
-## <param name="samhaindomain_prefix">
+## <param name="domain_prefix">
 ##	<summary>
-##	The prefix of the samhain domains(e.g., samhain
-##	for the domain of command line access, samhaind
-##	for the domain started by init script).
+##	Domain prefix to be used.
 ##	</summary>
 ## </param>
-## <rolebase/>
 #
 template(`samhain_service_template',`
 	gen_require(`
-		type etc_t, samhain_etc_t, samhain_exec_t;
-		type samhain_log_t, samhain_var_run_t;
+		attribute samhain_domain;
+		type samhain_exec_t;
 	')
 
 	type $1_t;
 	domain_type($1_t)
 	domain_entry_file($1_t, samhain_exec_t)
 
-	allow $1_t self:capability { dac_override dac_read_search fowner ipc_lock };
-	dontaudit $1_t self:capability { sys_resource sys_ptrace };
-	allow $1_t self:fd use;
-	allow $1_t self:process { setsched setrlimit signull };
-
-	allow $1_t samhain_etc_t:file read_file_perms;
-	files_search_etc($1_t)
-
-	manage_files_pattern($1_t, samhain_log_t, samhain_log_t)
-	logging_log_filetrans($1_t, samhain_log_t, file)
-
-	manage_files_pattern($1_t, samhain_var_run_t, samhain_var_run_t)
-	files_pid_filetrans($1_t, samhain_var_run_t, file)
-
-	# Samhain needs to get the attribute of /proc/kcore.
-	kernel_getattr_core_if($1_t)
-
-	corecmd_list_bin($1_t)
-	corecmd_read_bin_symlinks($1_t)
-
-	# To get entropy
-	dev_read_urand($1_t)
-	dev_dontaudit_read_rand($1_t)
-
-	# Get the attributes of all kinds of files in the rootfs.
-	dev_getattr_all_blk_files($1_t)
-	dev_getattr_all_chr_files($1_t)
-	dev_getattr_generic_blk_files($1_t)
-	dev_getattr_generic_chr_files($1_t)
-
-	files_getattr_all_dirs($1_t)
-	files_getattr_all_files($1_t)
-	files_getattr_all_symlinks($1_t)
-	files_getattr_all_pipes($1_t)
-	files_getattr_all_sockets($1_t)
-	files_getattr_all_mountpoints($1_t)
 	files_read_all_files($1_t)
-	files_read_all_symlinks($1_t)
 
-	# Get the attribute of other filesystems mountpoint, such as /selinux
-	# /proc, /sys and /tmp, but not the contents inside, which suggests
-	# that following rules should be set in samhain configuration file:
-	# [Attributes]
-	#    file = /tmp
-	#    file = /proc
-	#    file = /sys
-	#    file = /selinux
-	# [IgnoreALL]
-	#    dir = -1/tmp
-	#    dir = -1/proc
-	#    dir = -1/sys
-	#    dir = -1/selinux
-	fs_getattr_all_dirs($1_t)
-
-	# Samhain pid, log and log.lock files are all in directories of s0,
-	# while samhain daemon is running with the clearance level.
 	mls_file_write_all_levels($1_t)
-
-	# Read from utmp when monitoring login/logout events.
-	auth_read_login_records($1_t)
-
-	# Read from wtmp when monitoring login/logout events.
-	init_read_utmp($1_t)
-
-	logging_send_syslog_msg($1_t)
 ')
 
 ########################################
@@ -112,18 +46,25 @@
 
 ########################################
 ## <summary>
-##	Execute samhain in the samhain domain with the clearance security
-##	level and allow the specifiled role the samhain domain.
+##	Execute samhain in the samhain
+##	domain with the clearance security
+##	level and allow the specifiled role
+##	the samhain domain.
 ## </summary>
 ## <desc>
 ##	<p>
-##	Execute samhain in the samhain domain with the clearance security
-##	level and allow the specifiled role the samhain domain.
+##	Execute samhain in the samhain
+##	domain with the clearance security
+##	level and allow the specifiled role
+##	the samhain domain.
 ##	</p>
 ##	<p>
-##	The range_transition rule used in this interface requires that
-##	the calling domain should have the clearance security level
-##	otherwise the MLS constraint for process transition would fail.
+##	The range_transition rule used in
+##	this interface requires that the
+##	calling domain should have the
+##	clearance security level otherwise
+##	the MLS constraint for process
+##	transition would fail.
 ##	</p>
 ## </desc>
 ## <param name="domain">
@@ -140,11 +81,12 @@
 #
 interface(`samhain_run',`
 	gen_require(`
-		type samhain_t, samhain_exec_t;
+		attribute_role samhain_roles;
+		type samhain_exec_t;
 	')
 
 	samhain_domtrans($1)
-	role $2 types samhain_t;
+	roleattribute $2 samhain_roles;
 
 	ifdef(`enable_mls', `
 		range_transition $1 samhain_exec_t:process mls_systemhigh;
@@ -153,7 +95,8 @@
 
 ########################################
 ## <summary>
-##	Manage samhain configuration files.
+##	Create, read, write, and delete
+##	samhain configuration files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -172,7 +115,8 @@
 
 ########################################
 ## <summary>
-##	Manage samhain database files.
+##	Create, read, write, and delete
+##	samhain database files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -191,7 +135,8 @@
 
 #######################################
 ## <summary>
-##	Manage samhain init script files
+##	Create, read, write, and delete
+##	samhain init script files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -210,7 +155,8 @@
 
 ########################################
 ## <summary>
-##	Manage samhain log and log.lock files.
+##	Create, read, write, and delete
+##	samhain log and log.lock files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -229,7 +175,8 @@
 
 ########################################
 ## <summary>
-##	Manage samhain pid files.
+##	Create, read, write, and delete
+##	samhain pid files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -248,45 +195,48 @@
 
 #######################################
 ## <summary>
-##	All of the rules required to administrate
-##	the samhain environment.
+##	All of the rules required to
+##	administrate the samhain environment.
 ## </summary>
-## <desc>
-##	<p>
-##	This interface assumes that the calling domain has been able to
-##	remove an entry from /var/lib/ or /var/log/ and belongs to the
-##	mlsfilewrite attribute, since samhain files may be of clearance
-##	security level while their parent directories are of s0.
-##	</p>
-## </desc>
 ## <param name="domain">
 ##	<summary>
 ##	Domain allowed access.
 ##	</summary>
 ## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
 #
 interface(`samhain_admin',`
 	gen_require(`
+		attribute samhain_domain;
 		type samhain_t, samhaind_t, samhain_db_t, samhain_etc_t;
 		type samhain_initrc_exec_t, samhain_log_t, samhain_var_run_t;
 	')
 
-	allow $1 samhain_t:process { ptrace signal_perms };
-	ps_process_pattern($1, samhain_t)
+	allow $1 samhain_domain:process { ptrace signal_perms };
+	ps_process_pattern($1, samhain_domain)
 
-	allow $1 samhaind_t:process { ptrace signal_perms };
-	ps_process_pattern($1, samhaind_t)
+	# pending
+	# init_labeled_script_domtrans($1, samhain_initrc_exec_t)
+	# domain_system_change_exemption($1)
+	# role_transition $2 samhain_initrc_exec_t system_r;
+	# allow $2 system_r;
 
 	files_list_var_lib($1)
 	admin_pattern($1, samhain_db_t)
 
 	files_list_etc($1)
-	admin_pattern($1, samhain_etc_t)
-	admin_pattern($1, samhain_initrc_exec_t)
+	admin_pattern($1, { samhain_initrc_exec_t samhain_etc_t })
 
 	logging_list_logs($1)
 	admin_pattern($1, samhain_log_t)
 
 	files_list_pids($1)
 	admin_pattern($1, samhain_var_run_t)
+
+	# samhain_run($1, $2)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/samhain.te refpolicy/policy/modules/contrib/samhain.te
--- refpolicy/policy/modules/contrib/samhain.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/samhain.te	2012-10-27 13:03:40.278002228 +0200
@@ -1,10 +1,15 @@
-policy_module(samhain, 1.1.0)
+policy_module(samhain, 1.1.1)
 
 ########################################
 #
 # Declarations
 #
 
+attribute samhain_domain;
+
+attribute_role samhain_roles;
+roleattribute system_r samhain_roles;
+
 type samhain_etc_t;
 files_config_file(samhain_etc_t)
 
@@ -14,7 +19,6 @@
 type samhain_log_t;
 logging_log_file(samhain_log_t)
 
-# Filesystem signature database
 type samhain_db_t;
 files_type(samhain_db_t)
 
@@ -24,28 +28,71 @@
 type samhain_var_run_t;
 files_pid_file(samhain_var_run_t)
 
-# Domain for command line access
 samhain_service_template(samhain)
 application_domain(samhain_t, samhain_exec_t)
+role samhain_roles types samhain_t;
 
-# Domain for samhain service started by samhain init script
 samhain_service_template(samhaind)
+init_system_domain(samhaind_t, samhain_exec_t)
 
 ifdef(`enable_mcs',`
-	# This is system instead of daemon to work around
-	# a type transition conflict
 	init_ranged_system_domain(samhaind_t, samhain_exec_t, mcs_systemhigh)
 ')
 
 ifdef(`enable_mls',`
-	# This is system instead of daemon to work around
-	# a type transition conflict
 	init_ranged_system_domain(samhaind_t, samhain_exec_t, mls_systemhigh)
 ')
 
 ########################################
 #
-# Samhain local policy
+# Common samhain domain local policy
+#
+
+allow samhain_domain self:capability { dac_override dac_read_search fowner ipc_lock };
+dontaudit samhain_domain self:capability { sys_resource sys_ptrace };
+allow samhain_domain self:fd use;
+allow samhain_domain self:process { setsched setrlimit signull };
+
+allow samhain_domain samhain_etc_t:file read_file_perms;
+
+manage_files_pattern(samhain_domain, samhain_log_t, samhain_log_t)
+logging_log_filetrans(samhain_domain, samhain_log_t, file)
+
+manage_files_pattern(samhain_domain, samhain_var_run_t, samhain_var_run_t)
+files_pid_filetrans(samhain_domain, samhain_var_run_t, file)
+
+kernel_getattr_core_if(samhain_domain)
+
+corecmd_list_bin(samhain_domain)
+corecmd_read_bin_symlinks(samhain_domain)
+
+dev_read_urand(samhain_domain)
+dev_dontaudit_read_rand(samhain_domain)
+dev_getattr_all_blk_files(samhain_domain)
+dev_getattr_all_chr_files(samhain_domain)
+dev_getattr_generic_blk_files(samhain_domain)
+dev_getattr_generic_chr_files(samhain_domain)
+
+files_getattr_all_dirs(samhain_domain)
+files_getattr_all_files(samhain_domain)
+files_getattr_all_symlinks(samhain_domain)
+files_getattr_all_pipes(samhain_domain)
+files_getattr_all_sockets(samhain_domain)
+files_getattr_all_mountpoints(samhain_domain)
+files_read_all_symlinks(samhain_domain)
+files_search_etc(samhain_domain)
+
+fs_getattr_all_dirs(samhain_domain)
+
+auth_read_login_records(samhain_domain)
+
+init_read_utmp(samhain_domain)
+
+logging_send_syslog_msg(samhain_domain)
+
+########################################
+#
+# Client local policy
 #
 
 manage_files_pattern(samhain_t, samhain_db_t, samhain_db_t)
@@ -59,18 +106,13 @@
 
 ########################################
 #
-# Samhaind local policy
+# Server local policy
 #
 
-# Need signal_perms to send SIGABRT/SIGKILL to termiate samhain_t
-# Need signull to get the status of samhain_t
 allow samhaind_t { samhain_t self }:process signal_perms;
 
-# Only needed when starting samhain daemon from its init script.
 can_exec(samhaind_t, samhain_exec_t)
 
 read_files_pattern(samhaind_t, samhain_db_t, samhain_db_t)
 
-# init script ptys are the stdin/out/err
-# when using run_init
 init_use_script_ptys(samhaind_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/sanlock.fc refpolicy/policy/modules/contrib/sanlock.fc
--- refpolicy/policy/modules/contrib/sanlock.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/sanlock.fc	2012-10-27 13:03:43.568002235 +0200
@@ -1,7 +1,7 @@
 /etc/rc\.d/init\.d/sanlock	--	gen_context(system_u:object_r:sanlock_initrc_exec_t,s0)
 
-/var/run/sanlock(/.*)?			gen_context(system_u:object_r:sanlock_var_run_t,s0)
+/usr/sbin/sanlock	--	gen_context(system_u:object_r:sanlock_exec_t,s0)
 
-/var/log/sanlock\.log			gen_context(system_u:object_r:sanlock_log_t,s0)
+/var/run/sanlock(/.*)?	gen_context(system_u:object_r:sanlock_var_run_t,s0)
 
-/usr/sbin/sanlock		--	gen_context(system_u:object_r:sanlock_exec_t,s0)
+/var/log/sanlock\.log.*	--	gen_context(system_u:object_r:sanlock_log_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/sanlock.if refpolicy/policy/modules/contrib/sanlock.if
--- refpolicy/policy/modules/contrib/sanlock.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/sanlock.if	2012-10-27 13:03:43.581002235 +0200
@@ -1,4 +1,4 @@
-## <summary>policy for sanlock</summary>
+## <summary>shared storage lock manager.</summary>
 
 ########################################
 ## <summary>
@@ -15,16 +15,18 @@
 		type sanlock_t, sanlock_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, sanlock_exec_t, sanlock_t)
 ')
 
 ########################################
 ## <summary>
-##	Execute sanlock server in the sanlock domain.
+##	Execute sanlock init scripts in
+##	the initrc domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
-##	The type of the process performing this action.
+##	Domain allowed to transition.
 ##	</summary>
 ## </param>
 #
@@ -38,7 +40,8 @@
 
 ######################################
 ## <summary>
-##	Create, read, write, and delete sanlock PID files.
+##	Create, read, write, and delete
+##	sanlock pid files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -57,7 +60,8 @@
 
 ########################################
 ## <summary>
-##	Connect to sanlock over an unix stream socket.
+##	Connect to sanlock with a unix
+##	domain stream socket.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -76,8 +80,8 @@
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate
-##	an sanlock environment
+##	All of the rules required to
+##	administrate an sanlock environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -93,15 +97,21 @@
 #
 interface(`sanlock_admin',`
 	gen_require(`
-		type sanlock_t;
-		type sanlock_initrc_exec_t;
+		type sanlock_t, sanlock_initrc_exec_t, sanlock_var_run_t;
+		type sanlock_log_t;
 	')
 
-	allow $1 sanlock_t:process signal_perms;
+	allow $1 sanlock_t:process { ptrace signal_perms };
 	ps_process_pattern($1, sanlock_t)
 
 	sanlock_initrc_domtrans($1)
 	domain_system_change_exemption($1)
 	role_transition $2 sanlock_initrc_exec_t system_r;
 	allow $2 system_r;
+
+	files_search_pids($1)
+	admin_pattern($1, sanlock_var_run_t)
+
+	logging_search_logs($1)
+	admin_pattern($1, sanlock_log_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/sanlock.te refpolicy/policy/modules/contrib/sanlock.te
--- refpolicy/policy/modules/contrib/sanlock.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/sanlock.te	2012-11-06 21:18:22.874011541 +0100
@@ -1,4 +1,4 @@
-policy_module(sanlock, 1.0.0)
+policy_module(sanlock, 1.0.2)
 
 ########################################
 #
@@ -6,16 +6,18 @@
 #
 
 ## <desc>
-## <p>
-## Allow confined virtual guests to manage nfs files
-## </p>
+##	<p>
+##	Determine whether sanlock can use
+##	nfs file systems.
+##	</p>
 ## </desc>
 gen_tunable(sanlock_use_nfs, false)
 
 ## <desc>
-## <p>
-## Allow confined virtual guests to manage cifs files
-## </p>
+##	<p>
+##	Determine whether sanlock can use
+##	cifs file systems.
+##	</p>
 ## </desc>
 gen_tunable(sanlock_use_samba, false)
 
@@ -42,14 +44,17 @@
 
 ########################################
 #
-# sanlock local policy
+# Local policy
 #
-allow sanlock_t self:capability { sys_nice ipc_lock };
-allow sanlock_t self:process { setsched signull };
+
+allow sanlock_t self:capability { chown dac_override ipc_lock kill setgid setuid sys_nice sys_resource };
+allow sanlock_t self:process { setrlimit setsched signull signal sigkill };
 allow sanlock_t self:fifo_file rw_fifo_file_perms;
-allow sanlock_t self:unix_stream_socket create_stream_socket_perms;
+allow sanlock_t self:unix_stream_socket { accept listen };
 
-manage_files_pattern(sanlock_t, sanlock_log_t, sanlock_log_t)
+append_files_pattern(sanlock_t, sanlock_log_t, sanlock_log_t)
+create_files_pattern(sanlock_t, sanlock_log_t, sanlock_log_t)
+setattr_files_pattern(sanlock_t, sanlock_log_t, sanlock_log_t)
 logging_log_filetrans(sanlock_t, sanlock_log_t, file)
 
 manage_dirs_pattern(sanlock_t, sanlock_var_run_t, sanlock_var_run_t)
@@ -58,14 +63,16 @@
 files_pid_filetrans(sanlock_t, sanlock_var_run_t, { file dir sock_file })
 
 kernel_read_system_state(sanlock_t)
+kernel_read_kernel_sysctls(sanlock_t)
 
-domain_use_interactive_fds(sanlock_t)
+dev_read_rand(sanlock_t)
+dev_read_urand(sanlock_t)
 
-files_read_etc_files(sanlock_t)
+domain_use_interactive_fds(sanlock_t)
 
 storage_raw_rw_fixed_disk(sanlock_t)
 
-dev_read_urand(sanlock_t)
+auth_use_nsswitch(sanlock_t)
 
 init_read_utmp(sanlock_t)
 init_dontaudit_write_utmp(sanlock_t)
@@ -89,5 +96,11 @@
 ')
 
 optional_policy(`
+	wdmd_stream_connect(sanlock_t)
+')
+
+optional_policy(`
+	virt_kill_all_virt_domains(sanlock_t)
 	virt_manage_lib_files(sanlock_t)
+	virt_signal_all_virt_domains(sanlock_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/sasl.fc refpolicy/policy/modules/contrib/sasl.fc
--- refpolicy/policy/modules/contrib/sasl.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/sasl.fc	2012-10-27 13:03:47.730002244 +0200
@@ -1,12 +1,7 @@
 /etc/rc\.d/init\.d/sasl	--	gen_context(system_u:object_r:saslauthd_initrc_exec_t,s0)
 
-#
-# /usr
-#
 /usr/sbin/saslauthd	--	gen_context(system_u:object_r:saslauthd_exec_t,s0)
 
-#
-# /var
-#
-/var/lib/sasl2(/.*)?		gen_context(system_u:object_r:saslauthd_var_run_t,s0)
+/var/lib/sasl2(/.*)?	gen_context(system_u:object_r:saslauthd_var_run_t,s0)
+
 /var/run/saslauthd(/.*)?	gen_context(system_u:object_r:saslauthd_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/sasl.if refpolicy/policy/modules/contrib/sasl.if
--- refpolicy/policy/modules/contrib/sasl.if	2012-05-04 15:16:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/sasl.if	2012-10-27 13:03:47.730002244 +0200
@@ -1,4 +1,4 @@
-## <summary>SASL authentication server</summary>
+## <summary>SASL authentication server.</summary>
 
 ########################################
 ## <summary>
@@ -21,8 +21,8 @@
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate 
-##	an sasl environment
+##	All of the rules required to
+##	administrate an sasl environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -38,11 +38,10 @@
 #
 interface(`sasl_admin',`
 	gen_require(`
-		type saslauthd_t, saslauthd_tmp_t, saslauthd_var_run_t;
-		type saslauthd_initrc_exec_t;
+		type saslauthd_t, saslauthd_var_run_t, saslauthd_initrc_exec_t;
 	')
 
-	allow $1 saslauthd_t:process { ptrace signal_perms getattr };
+	allow $1 saslauthd_t:process { ptrace signal_perms };
 	ps_process_pattern($1, saslauthd_t)
 
 	init_labeled_script_domtrans($1, saslauthd_initrc_exec_t)
@@ -50,9 +49,6 @@
 	role_transition $2 saslauthd_initrc_exec_t system_r;
 	allow $2 system_r;
 
-	files_list_tmp($1)
-	admin_pattern($1, saslauthd_tmp_t)
-
 	files_list_pids($1)
 	admin_pattern($1, saslauthd_var_run_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/sasl.te refpolicy/policy/modules/contrib/sasl.te
--- refpolicy/policy/modules/contrib/sasl.te	2012-05-04 15:16:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/sasl.te	2012-10-27 13:03:47.748002244 +0200
@@ -1,4 +1,4 @@
-policy_module(sasl, 1.14.0)
+policy_module(sasl, 1.14.3)
 
 ########################################
 #
@@ -6,9 +6,10 @@
 #
 
 ## <desc>
-## <p>
-## Allow sasl to read shadow
-## </p>
+##	<p>
+##	Determine whether sasl can
+##	read shadow files.
+##	</p>
 ## </desc>
 gen_tunable(allow_saslauthd_read_shadow, false)
 
@@ -19,9 +20,6 @@
 type saslauthd_initrc_exec_t;
 init_script_file(saslauthd_initrc_exec_t)
 
-type saslauthd_tmp_t;
-files_tmp_file(saslauthd_tmp_t)
-
 type saslauthd_var_run_t;
 files_pid_file(saslauthd_var_run_t)
 
@@ -30,50 +28,51 @@
 # Local policy
 #
 
-allow saslauthd_t self:capability { setgid setuid };
+allow saslauthd_t self:capability { setgid setuid sys_nice };
 dontaudit saslauthd_t self:capability sys_tty_config;
-allow saslauthd_t self:process signal_perms;
+allow saslauthd_t self:process { setsched signal_perms };
 allow saslauthd_t self:fifo_file rw_fifo_file_perms;
-allow saslauthd_t self:unix_dgram_socket create_socket_perms;
-allow saslauthd_t self:unix_stream_socket create_stream_socket_perms;
-allow saslauthd_t self:tcp_socket create_socket_perms;
-
-allow saslauthd_t saslauthd_tmp_t:dir setattr;
-manage_files_pattern(saslauthd_t, saslauthd_tmp_t, saslauthd_tmp_t)
-files_tmp_filetrans(saslauthd_t, saslauthd_tmp_t, file)
+allow saslauthd_t self:unix_stream_socket { accept listen };
 
+manage_dirs_pattern(saslauthd_t, saslauthd_var_run_t, saslauthd_var_run_t)
 manage_files_pattern(saslauthd_t, saslauthd_var_run_t, saslauthd_var_run_t)
 manage_sock_files_pattern(saslauthd_t, saslauthd_var_run_t, saslauthd_var_run_t)
-files_pid_filetrans(saslauthd_t, saslauthd_var_run_t, file)
+files_pid_filetrans(saslauthd_t, saslauthd_var_run_t, { file dir })
 
 kernel_read_kernel_sysctls(saslauthd_t)
 kernel_read_system_state(saslauthd_t)
+kernel_rw_afs_state(saslauthd_t)
 
 corenet_all_recvfrom_unlabeled(saslauthd_t)
 corenet_all_recvfrom_netlabel(saslauthd_t)
 corenet_tcp_sendrecv_generic_if(saslauthd_t)
 corenet_tcp_sendrecv_generic_node(saslauthd_t)
-corenet_tcp_sendrecv_all_ports(saslauthd_t)
-corenet_tcp_connect_pop_port(saslauthd_t)
-corenet_sendrecv_pop_client_packets(saslauthd_t)
 
-dev_read_urand(saslauthd_t)
+corenet_sendrecv_pop_client_packets(saslauthd_t)
+corenet_tcp_connect_pop_port(saslauthd_t)
+corenet_tcp_sendrecv_pop_port(saslauthd_t)
 
-fs_getattr_all_fs(saslauthd_t)
-fs_search_auto_mountpoints(saslauthd_t)
+corenet_sendrecv_zarafa_client_packets(saslauthd_t)
+corenet_tcp_connect_zarafa_port(saslauthd_t)
+corenet_tcp_sendrecv_zarafa_port(saslauthd_t)
 
-selinux_compute_access_vector(saslauthd_t)
+corecmd_exec_bin(saslauthd_t)
 
-auth_use_pam(saslauthd_t)
+dev_read_urand(saslauthd_t)
 
 domain_use_interactive_fds(saslauthd_t)
 
-files_read_etc_files(saslauthd_t)
 files_dontaudit_read_etc_runtime_files(saslauthd_t)
-files_search_var_lib(saslauthd_t)
 files_dontaudit_getattr_home_dir(saslauthd_t)
 files_dontaudit_getattr_tmp_dirs(saslauthd_t)
 
+fs_getattr_all_fs(saslauthd_t)
+fs_search_auto_mountpoints(saslauthd_t)
+
+selinux_compute_access_vector(saslauthd_t)
+
+auth_use_pam(saslauthd_t)
+
 init_dontaudit_stream_connect_script(saslauthd_t)
 
 logging_send_syslog_msg(saslauthd_t)
@@ -86,19 +85,21 @@
 userdom_dontaudit_use_unpriv_user_fds(saslauthd_t)
 userdom_dontaudit_search_user_home_dirs(saslauthd_t)
 
-# cjp: typeattribute doesnt work in conditionals
 auth_can_read_shadow_passwords(saslauthd_t)
 tunable_policy(`allow_saslauthd_read_shadow',`
+	allow saslauthd_t self:capability dac_override;
 	auth_tunable_read_shadow(saslauthd_t) 
 ')
 
 optional_policy(`
 	kerberos_keytab_template(saslauthd, saslauthd_t)
+	kerberos_manage_host_rcache(saslauthd_t)
+	kerberos_tmp_filetrans_host_rcache(saslauthd_t, file, "host_0")
 ')
 
 optional_policy(`
-	mysql_search_db(saslauthd_t)
 	mysql_stream_connect(saslauthd_t)
+	mysql_tcp_connect(saslauthd_t)
 ')
 
 optional_policy(`
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/sblim.fc refpolicy/policy/modules/contrib/sblim.fc
--- refpolicy/policy/modules/contrib/sblim.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/sblim.fc	2012-10-27 13:42:34.163007209 +0200
@@ -1,5 +1,6 @@
-/usr/sbin/gatherd	--	gen_context(system_u:object_r:sblim_gatherd_exec_t,s0)
+/etc/rc\.d/init\.d/gatherer	--	gen_context(system_u:object_r:sblim_initrc_exec_t,s0)
 
+/usr/sbin/gatherd	--	gen_context(system_u:object_r:sblim_gatherd_exec_t,s0)
 /usr/sbin/reposd	--	gen_context(system_u:object_r:sblim_reposd_exec_t,s0)
 
-/var/run/gather(/.*)?		gen_context(system_u:object_r:sblim_var_run_t,s0)
+/var/run/gather(/.*)?	gen_context(system_u:object_r:sblim_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/sblim.if refpolicy/policy/modules/contrib/sblim.if
--- refpolicy/policy/modules/contrib/sblim.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/sblim.if	2012-10-27 13:42:34.164007209 +0200
@@ -1,8 +1,8 @@
-## <summary> policy for SBLIM Gatherer </summary>
+## <summary>Standards Based Linux Instrumentation for Manageability.</summary>
 
 ########################################
 ## <summary>
-##	Transition to gatherd.
+##	Execute gatherd in the gatherd domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -21,7 +21,7 @@
 
 ########################################
 ## <summary>
-##	Read gatherd PID files.
+##	Read gatherd pid files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -40,8 +40,8 @@
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate
-##	an gatherd environment
+##	All of the rules required to
+##	administrate an sblim environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -57,16 +57,17 @@
 #
 interface(`sblim_admin',`
 	gen_require(`
-		type sblim_gatherd_t;
-		type sblim_reposd_t;
-		type sblim_var_run_t;
+		attribute sblim_domain;
+		type sblim_initrc_exec_t, sblim_var_run_t;
 	')
 
-	allow $1 sblim_gatherd_t:process signal_perms;
-	ps_process_pattern($1, sblim_gatherd_t)
+	allow $1 sblim_domain:process { ptrace signal_perms };
+	ps_process_pattern($1, sblim_domain)
 
-	allow $1 sblim_reposd_t:process signal_perms;
-	ps_process_pattern($1, sblim_reposd_t)
+	init_labeled_script_domtrans($1, sblim_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 sblim_initrc_exec_t system_r;
+	allow $2 system_r;
 
 	files_search_pids($1)
 	admin_pattern($1, sblim_var_run_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/sblim.te refpolicy/policy/modules/contrib/sblim.te
--- refpolicy/policy/modules/contrib/sblim.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/sblim.te	2012-10-27 13:42:34.164007209 +0200
@@ -1,4 +1,4 @@
-policy_module(sblim, 1.0.0)
+policy_module(sblim, 1.0.2)
 
 ########################################
 #
@@ -15,17 +15,51 @@
 type sblim_reposd_exec_t;
 init_daemon_domain(sblim_reposd_t, sblim_reposd_exec_t)
 
+type sblim_initrc_exec_t;
+init_script_file(sblim_initrc_exec_t)
+
 type sblim_var_run_t;
 files_pid_file(sblim_var_run_t)
 
+######################################
+#
+# Common sblim domain local policy
+#
+
+allow sblim_domain self:tcp_socket create_stream_socket_perms;
+
+manage_dirs_pattern(sblim_domain, sblim_var_run_t, sblim_var_run_t)
+manage_files_pattern(sblim_domain, sblim_var_run_t, sblim_var_run_t)
+manage_sock_files_pattern(sblim_domain, sblim_var_run_t, sblim_var_run_t)
+
+kernel_read_network_state(sblim_domain)
+kernel_read_system_state(sblim_domain)
+
+corenet_all_recvfrom_unlabeled(sblim_domain)
+corenet_all_recvfrom_netlabel(sblim_domain)
+corenet_tcp_sendrecv_generic_if(sblim_domain)
+corenet_tcp_sendrecv_generic_node(sblim_domain)
+
+corenet_tcp_sendrecv_repository_port(sblim_domain)
+
+dev_read_sysfs(sblim_domain)
+
+logging_send_syslog_msg(sblim_domain)
+
+files_read_etc_files(sblim_domain)
+
+miscfiles_read_localization(sblim_domain)
+
 ########################################
 #
-# sblim_gatherd local policy
+# Gatherd local policy
 #
 allow sblim_gatherd_t self:capability dac_override;
 allow sblim_gatherd_t self:process signal;
 allow sblim_gatherd_t self:fifo_file rw_fifo_file_perms;
-allow sblim_gatherd_t self:unix_stream_socket create_stream_socket_perms;
+allow sblim_gatherd_t self:unix_stream_socket { accept listen };
+
+domtrans_pattern(sblim_gatherd_t, sblim_reposd_exec_t, sblim_reposd_t)
 
 kernel_read_fs_sysctls(sblim_gatherd_t)
 kernel_read_kernel_sysctls(sblim_gatherd_t)
@@ -33,6 +67,7 @@
 corecmd_exec_bin(sblim_gatherd_t)
 corecmd_exec_shell(sblim_gatherd_t)
 
+corenet_sendrecv_repository_client_packets(sblim_gatherd_t)
 corenet_tcp_connect_repository_port(sblim_gatherd_t)
 
 dev_read_rand(sblim_gatherd_t)
@@ -42,12 +77,12 @@
 
 fs_getattr_all_fs(sblim_gatherd_t)
 
+init_read_utmp(sblim_gatherd_t)
+
 sysnet_dns_name_resolve(sblim_gatherd_t)
 
 term_getattr_pty_fs(sblim_gatherd_t)
 
-init_read_utmp(sblim_gatherd_t)
-
 userdom_signull_unpriv_users(sblim_gatherd_t)
 
 optional_policy(`
@@ -63,6 +98,7 @@
 ')
 
 optional_policy(`
+	virt_getattr_virtd_exec_files(sblim_gatherd_t)
 	virt_stream_connect(sblim_gatherd_t)
 ')
 
@@ -73,32 +109,9 @@
 
 #######################################
 #
-# sblim_reposd local policy
+# Reposd local policy
 #
 
-domtrans_pattern(sblim_gatherd_t, sblim_reposd_exec_t, sblim_reposd_t)
-
-corenet_tcp_bind_all_nodes(sblim_reposd_t)
+corenet_sendrecv_repository_server_packets(sblim_reposd_t)
 corenet_tcp_bind_repository_port(sblim_reposd_t)
-
-######################################
-#
-# sblim_domain local policy
-#
-
-allow sblim_domain self:tcp_socket create_stream_socket_perms;
-
-manage_dirs_pattern(sblim_domain, sblim_var_run_t, sblim_var_run_t)
-manage_files_pattern(sblim_domain, sblim_var_run_t, sblim_var_run_t)
-manage_sock_files_pattern(sblim_domain, sblim_var_run_t, sblim_var_run_t)
-
-kernel_read_network_state(sblim_domain)
-kernel_read_system_state(sblim_domain)
-
-dev_read_sysfs(sblim_domain)
-
-logging_send_syslog_msg(sblim_domain)
-
-files_read_etc_files(sblim_domain)
-
-miscfiles_read_localization(sblim_domain)
+corenet_tcp_bind_generic_node(sblim_domain)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/screen.fc refpolicy/policy/modules/contrib/screen.fc
--- refpolicy/policy/modules/contrib/screen.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/screen.fc	2012-10-27 13:42:40.288007222 +0200
@@ -1,15 +1,8 @@
-#
-# /home
-#
-HOME_DIR/\.screen(/.*)?			gen_context(system_u:object_r:screen_home_t,s0)
-HOME_DIR/\.screenrc		--	gen_context(system_u:object_r:screen_home_t,s0)
+HOME_DIR/\.screen(/.*)?	gen_context(system_u:object_r:screen_home_t,s0)
+HOME_DIR/\.screenrc	--	gen_context(system_u:object_r:screen_home_t,s0)
 
-#
-# /usr
-#
-/usr/bin/screen			--	gen_context(system_u:object_r:screen_exec_t,s0)
+/usr/bin/screen	--	gen_context(system_u:object_r:screen_exec_t,s0)
+/usr/bin/tmux	--	gen_context(system_u:object_r:screen_exec_t,s0)
 
-#
-# /var
-#
-/var/run/screen(/.*)?			gen_context(system_u:object_r:screen_var_run_t,s0)
+/var/run/screen(/.*)?	gen_context(system_u:object_r:screen_var_run_t,s0)
+/var/run/tmux(/.*)?	gen_context(system_u:object_r:screen_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/screen.if refpolicy/policy/modules/contrib/screen.if
--- refpolicy/policy/modules/contrib/screen.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/screen.if	2012-10-27 13:42:40.289007222 +0200
@@ -1,4 +1,4 @@
-## <summary>GNU terminal multiplexer</summary>
+## <summary>GNU terminal multiplexer.</summary>
 
 #######################################
 ## <summary>
@@ -23,6 +23,8 @@
 #
 template(`screen_role_template',`
 	gen_require(`
+		attribute screen_domain;
+		attribute_role screen_roles;
 		type screen_exec_t, screen_tmp_t;
 		type screen_home_t, screen_var_run_t;
 	')
@@ -32,131 +34,56 @@
 	# Declarations
 	#
 
-	type $1_screen_t;
+	type $1_screen_t, screen_domain;
 	userdom_user_application_domain($1_screen_t, screen_exec_t)
 	domain_interactive_fd($1_screen_t)
-	role $2 types $1_screen_t;
+	role screen_roles types $1_screen_t;
+
+	roleattribute $2 screen_roles;
 
 	########################################
 	#
 	# Local policy
 	#
 
-	allow $1_screen_t self:capability { setuid setgid fsetid };
-	allow $1_screen_t self:process signal_perms;
-	allow $1_screen_t self:fifo_file rw_fifo_file_perms;
-	allow $1_screen_t self:tcp_socket create_stream_socket_perms;
-	allow $1_screen_t self:udp_socket create_socket_perms;
-	# Internal screen networking
-	allow $1_screen_t self:fd use;
-	allow $1_screen_t self:unix_stream_socket { create_socket_perms connectto };
-	allow $1_screen_t self:unix_dgram_socket create_socket_perms;
-
-	manage_dirs_pattern($1_screen_t, screen_tmp_t, screen_tmp_t)
-	manage_files_pattern($1_screen_t, screen_tmp_t, screen_tmp_t)
-	manage_fifo_files_pattern($1_screen_t, screen_tmp_t, screen_tmp_t)
-	files_tmp_filetrans($1_screen_t, screen_tmp_t, { file dir })
-
-	# Create fifo
-	manage_fifo_files_pattern($1_screen_t, screen_var_run_t, screen_var_run_t)
-	manage_dirs_pattern($1_screen_t, screen_var_run_t, screen_var_run_t)
-	manage_sock_files_pattern($1_screen_t, screen_var_run_t, screen_var_run_t)
-	files_pid_filetrans($1_screen_t, screen_var_run_t, dir)
-
-	allow $1_screen_t screen_home_t:dir list_dir_perms;
-	manage_dirs_pattern($1_screen_t, screen_home_t, screen_home_t)
-	manage_fifo_files_pattern($1_screen_t, screen_home_t, screen_home_t)
-	userdom_user_home_dir_filetrans($1_screen_t, screen_home_t, dir)
-	read_files_pattern($1_screen_t, screen_home_t, screen_home_t)
-	read_lnk_files_pattern($1_screen_t, screen_home_t, screen_home_t)
+	domtrans_pattern($3, screen_exec_t, $1_screen_t)
 
-	allow $1_screen_t $3:process signal;
+	ps_process_pattern($3, $1_screen_t)
+	allow $3 $1_screen_t:process { ptrace signal_perms };
 
-	domtrans_pattern($3, screen_exec_t, $1_screen_t)
-	allow $3 $1_screen_t:process { signal sigchld };
 	dontaudit $3 $1_screen_t:unix_stream_socket { read write };
 	allow $1_screen_t $3:process signal;
 
-	manage_fifo_files_pattern($3, screen_home_t, screen_home_t)
-	manage_dirs_pattern($3, screen_home_t, screen_home_t)
-	manage_files_pattern($3, screen_home_t, screen_home_t)
-	manage_lnk_files_pattern($3, screen_home_t, screen_home_t)
-	relabel_dirs_pattern($3, screen_home_t, screen_home_t)
-	relabel_files_pattern($3, screen_home_t, screen_home_t)
-	relabel_lnk_files_pattern($3, screen_home_t, screen_home_t)
+	allow $3 screen_tmp_t:dir { manage_dir_perms relabel_dir_perms };
+	allow $3 screen_tmp_t:file { manage_file_perms relabel_file_perms };
+	allow $3 screen_tmp_t:fifo_file { manage_fifo_file_perms relabel_fifo_file_perms };
+
+	allow $3 screen_home_t:dir { manage_dir_perms relabel_dir_perms };
+	allow $3 screen_home_t:file { manage_file_perms relabel_file_perms };
+	allow $3 screen_home_t:fifo_file { manage_fifo_file_perms relabel_fifo_file_perms };
+	allow $3 screen_home_t:lnk_file { manage_lnk_file_perms relabel_lnk_file_perms };
+
+	userdom_user_home_dir_filetrans($3, screen_home_t, dir, ".screen")
+	userdom_user_home_dir_filetrans($3, screen_home_t, file, ".screenrc")
 
 	manage_dirs_pattern($3, screen_var_run_t, screen_var_run_t)
 	manage_files_pattern($3, screen_var_run_t, screen_var_run_t)
 	manage_lnk_files_pattern($3, screen_var_run_t, screen_var_run_t)
 	manage_fifo_files_pattern($3, screen_var_run_t, screen_var_run_t)
 
-	kernel_read_system_state($1_screen_t)
-	kernel_read_kernel_sysctls($1_screen_t)
-
-	corecmd_list_bin($1_screen_t)
-	corecmd_read_bin_files($1_screen_t)
-	corecmd_read_bin_symlinks($1_screen_t)
-	corecmd_read_bin_pipes($1_screen_t)
-	corecmd_read_bin_sockets($1_screen_t)
-	# Revert to the user domain when a shell is executed.
-	corecmd_shell_domtrans($1_screen_t, $3)
 	corecmd_bin_domtrans($1_screen_t, $3)
-
-	corenet_all_recvfrom_unlabeled($1_screen_t)
-	corenet_all_recvfrom_netlabel($1_screen_t)
-	corenet_tcp_sendrecv_generic_if($1_screen_t)
-	corenet_udp_sendrecv_generic_if($1_screen_t)
-	corenet_tcp_sendrecv_generic_node($1_screen_t)
-	corenet_udp_sendrecv_generic_node($1_screen_t)
-	corenet_tcp_sendrecv_all_ports($1_screen_t)
-	corenet_udp_sendrecv_all_ports($1_screen_t)
-	corenet_tcp_connect_all_ports($1_screen_t)
-
-	dev_dontaudit_getattr_all_chr_files($1_screen_t)
-	dev_dontaudit_getattr_all_blk_files($1_screen_t)
-	# for SSP
-	dev_read_urand($1_screen_t)
-
-	domain_use_interactive_fds($1_screen_t)
-
-	files_search_tmp($1_screen_t)
-	files_search_home($1_screen_t)
-	files_list_home($1_screen_t)
-	files_read_usr_files($1_screen_t)
-	files_read_etc_files($1_screen_t)
-
-	fs_search_auto_mountpoints($1_screen_t)
-	fs_getattr_xattr_fs($1_screen_t)
+	corecmd_shell_domtrans($1_screen_t, $3)
 
 	auth_domtrans_chk_passwd($1_screen_t)
 	auth_use_nsswitch($1_screen_t)
-	auth_dontaudit_read_shadow($1_screen_t)
-	auth_dontaudit_exec_utempter($1_screen_t)
-
-	# Write to utmp.
-	init_rw_utmp($1_screen_t)
-
-	logging_send_syslog_msg($1_screen_t)
-
-	miscfiles_read_localization($1_screen_t)
-
-	seutil_read_config($1_screen_t)
 
-	userdom_use_user_terminals($1_screen_t)
-	userdom_create_user_pty($1_screen_t)
 	userdom_user_home_domtrans($1_screen_t, $3)
-	userdom_setattr_user_ptys($1_screen_t)
-	userdom_setattr_user_ttys($1_screen_t)
 
 	tunable_policy(`use_samba_home_dirs',`
 		fs_cifs_domtrans($1_screen_t, $3)
-		fs_read_cifs_symlinks($1_screen_t)
-		fs_list_cifs($1_screen_t)
 	')
 
 	tunable_policy(`use_nfs_home_dirs',`
 		fs_nfs_domtrans($1_screen_t, $3)
-		fs_list_nfs($1_screen_t)
-		fs_read_nfs_symlinks($1_screen_t)
 	')
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/screen.te refpolicy/policy/modules/contrib/screen.te
--- refpolicy/policy/modules/contrib/screen.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/screen.te	2012-10-30 19:33:22.311399676 +0100
@@ -1,10 +1,14 @@
-policy_module(screen, 2.5.0)
+policy_module(screen, 2.5.3)
 
 ########################################
 #
 # Declarations
 #
 
+attribute screen_domain;
+
+attribute_role screen_roles;
+
 type screen_exec_t;
 application_executable_file(screen_exec_t)
 
@@ -23,3 +27,93 @@
 typealias screen_var_run_t alias { auditadm_screen_var_run_t secadm_screen_var_run_t screen_dir_t };
 files_pid_file(screen_var_run_t)
 ubac_constrained(screen_var_run_t)
+
+########################################
+#
+# Common screen domain local policy
+#
+
+allow screen_domain self:capability { setuid setgid fsetid };
+allow screen_domain self:process signal_perms;
+allow screen_domain self:fd use;
+allow screen_domain self:fifo_file rw_fifo_file_perms;
+allow screen_domain self:tcp_socket { accept listen };
+allow screen_domain self:unix_stream_socket connectto;
+
+manage_dirs_pattern(screen_domain, screen_tmp_t, screen_tmp_t)
+manage_files_pattern(screen_domain, screen_tmp_t, screen_tmp_t)
+manage_fifo_files_pattern(screen_domain, screen_tmp_t, screen_tmp_t)
+files_tmp_filetrans(screen_domain, screen_tmp_t, { file dir })
+
+manage_fifo_files_pattern(screen_domain, screen_var_run_t, screen_var_run_t)
+manage_dirs_pattern(screen_domain, screen_var_run_t, screen_var_run_t)
+manage_sock_files_pattern(screen_domain, screen_var_run_t, screen_var_run_t)
+files_pid_filetrans(screen_domain, screen_var_run_t, dir)
+
+manage_dirs_pattern(screen_domain, screen_home_t, screen_home_t)
+read_files_pattern(screen_domain, screen_home_t, screen_home_t)
+manage_fifo_files_pattern(screen_domain, screen_home_t, screen_home_t)
+read_lnk_files_pattern(screen_domain, screen_home_t, screen_home_t)
+userdom_user_home_dir_filetrans(screen_domain, screen_home_t, dir, ".screen")
+
+kernel_read_system_state(screen_domain)
+kernel_read_kernel_sysctls(screen_domain)
+
+corecmd_list_bin(screen_domain)
+corecmd_read_bin_files(screen_domain)
+corecmd_read_bin_symlinks(screen_domain)
+corecmd_read_bin_pipes(screen_domain)
+corecmd_read_bin_sockets(screen_domain)
+
+corenet_all_recvfrom_unlabeled(screen_domain)
+corenet_all_recvfrom_netlabel(screen_domain)
+corenet_tcp_sendrecv_generic_if(screen_domain)
+corenet_tcp_sendrecv_generic_node(screen_domain)
+corenet_tcp_sendrecv_all_ports(screen_domain)
+
+corenet_sendrecv_all_client_packets(screen_domain)
+corenet_tcp_connect_all_ports(screen_domain)
+
+dev_dontaudit_getattr_all_chr_files(screen_domain)
+dev_dontaudit_getattr_all_blk_files(screen_domain)
+dev_read_urand(screen_domain)
+
+domain_use_interactive_fds(screen_domain)
+domain_sigchld_interactive_fds(screen_domain)
+domain_read_all_domains_state(screen_domain)
+
+files_list_home(screen_domain)
+files_read_usr_files(screen_domain)
+
+fs_search_auto_mountpoints(screen_domain)
+fs_getattr_all_fs(screen_domain)
+
+auth_dontaudit_read_shadow(screen_domain)
+auth_dontaudit_exec_utempter(screen_domain)
+
+init_rw_utmp(screen_domain)
+
+logging_send_syslog_msg(screen_domain)
+
+miscfiles_read_localization(screen_domain)
+
+seutil_read_config(screen_domain)
+
+userdom_use_user_terminals(screen_domain)
+userdom_create_user_pty(screen_domain)
+userdom_setattr_user_ptys(screen_domain)
+userdom_setattr_user_ttys(screen_domain)
+
+tunable_policy(`use_samba_home_dirs',`
+	fs_manage_cifs_dirs(screen_domain)
+	fs_read_cifs_files(screen_domain)
+	fs_manage_cifs_named_pipes(screen_domain)
+	fs_read_cifs_symlinks(screen_domain)
+')
+
+tunable_policy(`use_nfs_home_dirs',`
+	fs_manage_nfs_dirs(screen_domain)
+	fs_read_nfs_files(screen_domain)
+	fs_manage_nfs_named_pipes(screen_domain)
+	fs_read_nfs_symlinks(screen_domain)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/sectoolm.fc refpolicy/policy/modules/contrib/sectoolm.fc
--- refpolicy/policy/modules/contrib/sectoolm.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/sectoolm.fc	2012-10-27 13:42:43.974007230 +0200
@@ -1,4 +1,5 @@
 /usr/libexec/sectool-mechanism\.py	--	gen_context(system_u:object_r:sectoolm_exec_t,s0)
 
-/var/lib/sectool(/.*)?				gen_context(system_u:object_r:sectool_var_lib_t,s0)
-/var/log/sectool\.log			--	gen_context(system_u:object_r:sectool_var_log_t,s0)
+/var/lib/sectool(/.*)?	gen_context(system_u:object_r:sectool_var_lib_t,s0)
+
+/var/log/sectool\.log.*	--	gen_context(system_u:object_r:sectool_var_log_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/sectoolm.if refpolicy/policy/modules/contrib/sectoolm.if
--- refpolicy/policy/modules/contrib/sectoolm.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/sectoolm.if	2012-10-27 13:42:43.974007230 +0200
@@ -1,2 +1,24 @@
-## <summary>Sectool security audit tool</summary>
+## <summary>Sectool security audit tool.</summary>
 
+########################################
+## <summary>
+##	Role access for sectoolm.
+## </summary>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <param name="domain">
+##	<summary>
+##	User domain for the role.
+##	</summary>
+## </param>
+#
+interface(`sectoolm_role',`
+	gen_require(`
+		type sectoolm_t;
+	')
+
+	allow sectoolm_t $2:unix_dgram_socket sendto;
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/sectoolm.te refpolicy/policy/modules/contrib/sectoolm.te
--- refpolicy/policy/modules/contrib/sectoolm.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/sectoolm.te	2012-10-27 13:42:43.975007230 +0200
@@ -1,4 +1,4 @@
-policy_module(sectoolm, 1.0.0)
+policy_module(sectoolm, 1.0.1)
 
 ########################################
 #
@@ -7,7 +7,7 @@
 
 type sectoolm_t;
 type sectoolm_exec_t;
-dbus_system_domain(sectoolm_t, sectoolm_exec_t)
+init_system_domain(sectoolm_t, sectoolm_exec_t)
 
 type sectool_var_lib_t;
 files_type(sectool_var_lib_t)
@@ -20,14 +20,14 @@
 
 ########################################
 #
-# sectool local policy
+# Local policy
 #
 
-allow sectoolm_t self:capability { dac_override net_admin sys_nice sys_ptrace };
+allow sectoolm_t self:capability { dac_override net_admin sys_nice };
 allow sectoolm_t self:process { getcap getsched	signull setsched };
 dontaudit sectoolm_t self:process { execstack execmem };
 allow sectoolm_t self:fifo_file rw_fifo_file_perms;
-allow sectoolm_t self:unix_dgram_socket { create_socket_perms sendto };
+allow sectoolm_t self:unix_dgram_socket sendto;
 
 manage_dirs_pattern(sectoolm_t, sectool_tmp_t, sectool_tmp_t)
 manage_files_pattern(sectoolm_t, sectool_tmp_t, sectool_tmp_t)
@@ -37,7 +37,7 @@
 manage_dirs_pattern(sectoolm_t, sectool_var_lib_t, sectool_var_lib_t)
 files_var_lib_filetrans(sectoolm_t, sectool_var_lib_t, { file dir })
 
-manage_files_pattern(sectoolm_t, sectool_var_log_t, sectool_var_log_t)
+allow sectoolm_t sectool_var_log_t:file { append_file_perms create_file_perms setattr_file_perms };
 logging_log_filetrans(sectoolm_t, sectool_var_log_t, file)
 
 kernel_read_net_sysctls(sectoolm_t)
@@ -65,36 +65,38 @@
 
 selinux_validate_context(sectoolm_t)
 
-# tcp_wrappers test
 application_exec_all(sectoolm_t)
 
 auth_use_nsswitch(sectoolm_t)
 
-# tests related to network
-hostname_exec(sectoolm_t)
-
-# tests related to network
-iptables_domtrans(sectoolm_t)
-
 libs_exec_ld_so(sectoolm_t)
 
 logging_send_syslog_msg(sectoolm_t)
 
-# tests related to network
 sysnet_domtrans_ifconfig(sectoolm_t)
 
-userdom_manage_user_tmp_sockets(sectoolm_t)
+userdom_write_user_tmp_sockets(sectoolm_t)
 
 optional_policy(`
 	mount_exec(sectoolm_t)
 ')
 
 optional_policy(`
-	policykit_dbus_chat(sectoolm_t)
+	dbus_system_domain(sectoolm_t, sectoolm_exec_t)
+
+	optional_policy(`
+		policykit_dbus_chat(sectoolm_t)
+	')
+')
+
+optional_policy(`
+	hostname_exec(sectoolm_t)
+')
+
+optional_policy(`
+	iptables_domtrans(sectoolm_t)
 ')
 
-# suid test using
-# rpm -Vf option
 optional_policy(`
 	prelink_domtrans(sectoolm_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/sendmail.fc refpolicy/policy/modules/contrib/sendmail.fc
--- refpolicy/policy/modules/contrib/sendmail.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/sendmail.fc	2012-10-27 13:42:48.605007240 +0200
@@ -1,6 +1,7 @@
+/etc/rc\.d/init\.d/sendmail	--	gen_context(system_u:object_r:sendmail_initrc_exec_t,s0)
 
-/var/log/sendmail\.st		--	gen_context(system_u:object_r:sendmail_log_t,s0)
-/var/log/mail(/.*)?			gen_context(system_u:object_r:sendmail_log_t,s0)
+/var/log/sendmail\.st	--	gen_context(system_u:object_r:sendmail_log_t,s0)
+/var/log/mail(/.*)?	gen_context(system_u:object_r:sendmail_log_t,s0)
 
-/var/run/sendmail\.pid		--	gen_context(system_u:object_r:sendmail_var_run_t,s0)
-/var/run/sm-client\.pid		--	gen_context(system_u:object_r:sendmail_var_run_t,s0)
+/var/run/sendmail\.pid	--	gen_context(system_u:object_r:sendmail_var_run_t,s0)
+/var/run/sm-client\.pid	--	gen_context(system_u:object_r:sendmail_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/sendmail.if refpolicy/policy/modules/contrib/sendmail.if
--- refpolicy/policy/modules/contrib/sendmail.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/sendmail.if	2012-10-27 13:42:48.605007240 +0200
@@ -1,4 +1,4 @@
-## <summary>Policy for sendmail.</summary>
+## <summary>Internetwork email routing facility.</summary>
 
 ########################################
 ## <summary>
@@ -18,8 +18,7 @@
 
 ########################################
 ## <summary>
-##	Allow attempts to read and write to
-##	sendmail unnamed pipes.
+##	Read and write sendmail unnamed pipes.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -37,7 +36,7 @@
 
 ########################################
 ## <summary>
-##	Domain transition to sendmail.
+##	Execute a domain transition to run sendmail.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -50,16 +49,19 @@
 		type sendmail_t;
 	')
 
+	corecmd_search_bin($1)
 	mta_sendmail_domtrans($1, sendmail_t)
 
 	allow sendmail_t $1:fd use;
-	allow sendmail_t $1:fifo_file rw_file_perms;
+	allow sendmail_t $1:fifo_file rw_fifo_file_perms;
 	allow sendmail_t $1:process sigchld;
 ')
 
 ########################################
 ## <summary>
-##	Execute the sendmail program in the sendmail domain.
+##	Execute the sendmail program in the
+##	sendmail domain, and allow the
+##	specified role the sendmail domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -68,18 +70,18 @@
 ## </param>
 ## <param name="role">
 ##	<summary>
-##	The role to allow the sendmail domain.
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <rolecap/>
 #
 interface(`sendmail_run',`
 	gen_require(`
-		type sendmail_t;
+		attribute_role sendmail_roles;
 	')
 
 	sendmail_domtrans($1)
-	role $2 types sendmail_t;
+	roleattribute $2 sendmail_roles;
 ')
 
 ########################################
@@ -139,7 +141,8 @@
 
 ########################################
 ## <summary>
-##	Read and write sendmail unix_stream_sockets.
+##	Read and write sendmail unix
+##	domain stream sockets.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -152,7 +155,7 @@
 		type sendmail_t;
 	')
 
-	allow $1 sendmail_t:unix_stream_socket { getattr read write ioctl };
+	allow $1 sendmail_t:unix_stream_socket rw_socket_perms;
 ')
 
 ########################################
@@ -171,12 +174,12 @@
 		type sendmail_t;
 	')
 
-	dontaudit $1 sendmail_t:unix_stream_socket { getattr read write ioctl };
+	dontaudit $1 sendmail_t:unix_stream_socket rw_socket_perms;
 ')
 
 ########################################
 ## <summary>
-##	Read sendmail logs.
+##	Read sendmail log files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -196,7 +199,8 @@
 
 ########################################
 ## <summary>
-##	Create, read, write, and delete sendmail logs.
+##	Create, read, write, and delete
+##	sendmail log files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -216,7 +220,8 @@
 
 ########################################
 ## <summary>
-##	Create sendmail logs with the correct type.
+##	Create specified objects in generic
+##	log directories sendmail log file type.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -225,16 +230,43 @@
 ## </param>
 #
 interface(`sendmail_create_log',`
+	refpolicywarn(`$0($*) has been deprecated, use sendmail_log_filetrans_sendmail_log() instead.')
+	sendmail_log_filetrans_sendmail_log($1, $2, $3)
+')
+
+########################################
+## <summary>
+##	Create specified objects in generic
+##	log directories sendmail log file type.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="object_class">
+##	<summary>
+##	Class of the object being created.
+##	</summary>
+## </param>
+## <param name="name" optional="true">
+##	<summary>
+##	The name of the object being created.
+##	</summary>
+## </param>
+#
+interface(`sendmail_log_filetrans_sendmail_log',`
 	gen_require(`
 		type sendmail_log_t;
 	')
 
-	logging_log_filetrans($1, sendmail_log_t, file)
+	logging_log_filetrans($1, sendmail_log_t, $2, $3)
 ')
 
 ########################################
 ## <summary>
-##	Manage sendmail tmp files.
+##	Create, read, write, and delete
+##	sendmail tmp files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -267,13 +299,18 @@
 	')
 
 	mta_sendmail_domtrans($1, unconfined_sendmail_t)
+
+	allow unconfined_sendmail_t $1:fd use;
+	allow unconfined_sendmail_t $1:fifo_file rw_fifo_file_perms;
+	allow unconfined_sendmail_t $1:process sigchld;
 ')
 
 ########################################
 ## <summary>
-##	Execute sendmail in the unconfined sendmail domain, and
-##	allow the specified role the unconfined sendmail domain,
-##	and use the caller's terminal.
+##	Execute sendmail in the unconfined
+##	sendmail domain, and allow the
+##	specified role the unconfined
+##	sendmail domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -289,9 +326,52 @@
 #
 interface(`sendmail_run_unconfined',`
 	gen_require(`
-		type unconfined_sendmail_t;
+		attribute_role sendmail_unconfined_roles;
 	')
 
 	sendmail_domtrans_unconfined($1)
-	role $2 types unconfined_sendmail_t;
+	roleattribute $2 sendmail_unconfined_roles;
+')
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an sendmail environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`sendmail_admin',`
+	gen_require(`
+		type sendmail_t, sendmail_initrc_exec_t, sendmail_log_t;
+		type sendmail_tmp_t, sendmail_var_run_t, unconfined_sendmail_t;
+	')
+
+	allow $1 { unconfined_sendmail_t sendmail_t }:process { ptrace signal_perms };
+	ps_process_pattern($1, { unconfined_sendmail_t sendmail_t })
+
+	init_labeled_script_domtrans($1, sendmail_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 sendmail_initrc_exec_t system_r;
+
+	logging_list_logs($1)
+	admin_pattern($1, sendmail_log_t)
+
+	files_list_tmp($1)
+	admin_pattern($1, sendmail_tmp_t)
+
+	files_list_pids($1)
+	admin_pattern($1, sendmail_var_run_t)
+
+	sendmail_run($1, $2)
+	sendmail_run_unconfined($1, $2)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/sendmail.te refpolicy/policy/modules/contrib/sendmail.te
--- refpolicy/policy/modules/contrib/sendmail.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/sendmail.te	2012-10-30 19:32:38.039399581 +0100
@@ -1,10 +1,18 @@
-policy_module(sendmail, 1.11.0)
+policy_module(sendmail, 1.11.3)
 
 ########################################
 #
 # Declarations
 #
 
+attribute_role sendmail_roles;
+
+attribute_role sendmail_unconfined_roles;
+roleattribute system_r sendmail_unconfined_roles;
+
+type sendmail_initrc_exec_t;
+init_script_file(sendmail_initrc_exec_t)
+
 type sendmail_log_t;
 logging_log_file(sendmail_log_t)
 
@@ -18,26 +26,27 @@
 mta_sendmail_mailserver(sendmail_t)
 mta_mailserver_delivery(sendmail_t)
 mta_mailserver_sender(sendmail_t)
+role sendmail_roles types sendmail_t;
 
 type unconfined_sendmail_t;
 application_domain(unconfined_sendmail_t, sendmail_exec_t)
-role system_r types unconfined_sendmail_t;
+role sendmail_unconfined_roles types unconfined_sendmail_t;
 
 ########################################
 #
-# Sendmail local policy
+# Local policy
 #
 
 allow sendmail_t self:capability { dac_override setuid setgid net_bind_service sys_nice chown sys_tty_config };
 allow sendmail_t self:process { setsched setpgid setrlimit signal signull };
 allow sendmail_t self:fifo_file rw_fifo_file_perms;
-allow sendmail_t self:unix_stream_socket create_stream_socket_perms;
-allow sendmail_t self:unix_dgram_socket create_socket_perms;
-allow sendmail_t self:tcp_socket create_stream_socket_perms;
-allow sendmail_t self:udp_socket create_socket_perms;
+allow sendmail_t self:unix_stream_socket { accept listen };
+allow sendmail_t self:tcp_socket { accept listen };
 
-allow sendmail_t sendmail_log_t:dir setattr;
-manage_files_pattern(sendmail_t, sendmail_log_t, sendmail_log_t)
+allow sendmail_t sendmail_log_t:dir setattr_dir_perms;
+append_files_pattern(sendmail_t, sendmail_log_t, sendmail_log_t)
+create_files_pattern(sendmail_t, sendmail_log_t, sendmail_log_t)
+setattr_files_pattern(sendmail_t, sendmail_log_t, sendmail_log_t)
 logging_log_filetrans(sendmail_t, sendmail_log_t, { file dir })
 
 manage_dirs_pattern(sendmail_t, sendmail_tmp_t, sendmail_tmp_t)
@@ -49,7 +58,6 @@
 
 kernel_read_network_state(sendmail_t)
 kernel_read_kernel_sysctls(sendmail_t)
-# for piping mail to a command
 kernel_read_system_state(sendmail_t)
 
 corenet_all_recvfrom_unlabeled(sendmail_t)
@@ -58,13 +66,25 @@
 corenet_tcp_sendrecv_generic_node(sendmail_t)
 corenet_tcp_sendrecv_all_ports(sendmail_t)
 corenet_tcp_bind_generic_node(sendmail_t)
+
+corenet_sendrecv_smtp_server_packets(sendmail_t)
 corenet_tcp_bind_smtp_port(sendmail_t)
+
+corenet_sendrecv_all_client_packets(sendmail_t)
 corenet_tcp_connect_all_ports(sendmail_t)
-corenet_sendrecv_smtp_server_packets(sendmail_t)
-corenet_sendrecv_smtp_client_packets(sendmail_t)
 
-dev_read_urand(sendmail_t)
+corecmd_exec_bin(sendmail_t)
+corecmd_exec_shell(sendmail_t)
+
 dev_read_sysfs(sendmail_t)
+dev_read_urand(sendmail_t)
+
+domain_use_interactive_fds(sendmail_t)
+
+files_read_all_tmp_files(sendmail_t)
+files_read_etc_runtime_files(sendmail_t)
+files_read_usr_files(sendmail_t)
+files_search_spool(sendmail_t)
 
 fs_getattr_all_fs(sendmail_t)
 fs_search_auto_mountpoints(sendmail_t)
@@ -73,27 +93,14 @@
 term_dontaudit_use_console(sendmail_t)
 term_dontaudit_use_generic_ptys(sendmail_t)
 
-# for piping mail to a command
-corecmd_exec_shell(sendmail_t)
-corecmd_exec_bin(sendmail_t)
-
-domain_use_interactive_fds(sendmail_t)
-
-files_read_etc_files(sendmail_t)
-files_read_usr_files(sendmail_t)
-files_search_spool(sendmail_t)
-# for piping mail to a command
-files_read_etc_runtime_files(sendmail_t)
-
 init_use_fds(sendmail_t)
 init_use_script_ptys(sendmail_t)
-# sendmail wants to read /var/run/utmp if the controlling tty is /dev/console
 init_read_utmp(sendmail_t)
 init_dontaudit_write_utmp(sendmail_t)
+init_rw_script_tmp_files(sendmail_t)
 
 auth_use_nsswitch(sendmail_t)
 
-# Read /usr/lib/sasl2/.*
 libs_read_lib_files(sendmail_t)
 
 logging_send_syslog_msg(sendmail_t)
@@ -103,18 +110,21 @@
 miscfiles_read_localization(sendmail_t)
 
 userdom_dontaudit_use_unpriv_user_fds(sendmail_t)
-userdom_dontaudit_search_user_home_dirs(sendmail_t)
 
-mta_read_config(sendmail_t)
-mta_etc_filetrans_aliases(sendmail_t)
-# Write to /etc/aliases and /etc/mail.
+mta_etc_filetrans_aliases(sendmail_t, file, "aliases")
+mta_etc_filetrans_aliases(sendmail_t, file, "aliases.db")
+mta_etc_filetrans_aliases(sendmail_t, file, "aliasesdb-stamp")
 mta_manage_aliases(sendmail_t)
-# Write to /var/spool/mail and /var/spool/mqueue.
 mta_manage_queue(sendmail_t)
 mta_manage_spool(sendmail_t)
+mta_read_config(sendmail_t)
 mta_sendmail_exec(sendmail_t)
 
 optional_policy(`
+	cfengine_dontaudit_write_log_files(sendmail_t)
+')
+
+optional_policy(`
 	cron_read_pipes(sendmail_t)
 ')
 
@@ -128,7 +138,14 @@
 ')
 
 optional_policy(`
+	dovecot_write_inherited_tmp_files(sendmail_t)
+')
+
+optional_policy(`
 	exim_domtrans(sendmail_t)
+	exim_manage_spool_files(sendmail_t)
+	exim_manage_spool_dirs(sendmail_t)
+	exim_read_log(sendmail_t)
 ')
 
 optional_policy(`
@@ -149,7 +166,9 @@
 ')
 
 optional_policy(`
+	postfix_domtrans_postdrop(sendmail_t)
 	postfix_domtrans_master(sendmail_t)
+	postfix_domtrans_postqueue(sendmail_t)
 	postfix_read_config(sendmail_t)
 	postfix_search_spool(sendmail_t)
 ')
@@ -177,11 +196,12 @@
 
 ########################################
 #
-# Unconfined sendmail local policy
-# Allow unconfined domain to run newalias and have transitions work
+# Unconfined local policy
 #
 
 optional_policy(`
-	mta_etc_filetrans_aliases(unconfined_sendmail_t)
+	mta_etc_filetrans_aliases(unconfined_sendmail_t, file, "aliases")
+	mta_etc_filetrans_aliases(unconfined_sendmail_t, file, "aliases.db")
+	mta_etc_filetrans_aliases(unconfined_sendmail_t, file, "aliasesdb-stamp")
 	unconfined_domain(unconfined_sendmail_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/sensord.fc refpolicy/policy/modules/contrib/sensord.fc
--- refpolicy/policy/modules/contrib/sensord.fc	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/sensord.fc	2012-09-08 18:06:09.089552067 +0200
@@ -0,0 +1,5 @@
+/etc/rc\.d/init\.d/sensord	--	gen_context(system_u:object_r:sensord_initrc_exec_t,s0)
+
+/usr/sbin/sensord	--	gen_context(system_u:object_r:sensord_exec_t,s0)
+
+/var/run/sensord\.pid	--	gen_context(system_u:object_r:sensord_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/sensord.if refpolicy/policy/modules/contrib/sensord.if
--- refpolicy/policy/modules/contrib/sensord.if	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/sensord.if	2012-09-08 18:06:09.089552067 +0200
@@ -0,0 +1,35 @@
+## <summary>Sensor information logging daemon.</summary>
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an sensord environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`sensord_admin',`
+	gen_require(`
+		type sensord_t, sensord_initrc_exec_t, sensord_var_run_t;
+	')
+
+	allow $1 sensord_t:process { ptrace signal_perms };
+	ps_process_pattern($1, sensord_t)
+
+	init_labeled_script_domtrans($1, sensord_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 sensord_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	files_search_pids($1)
+	admin_pattern($1, sensord_var_run_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/sensord.te refpolicy/policy/modules/contrib/sensord.te
--- refpolicy/policy/modules/contrib/sensord.te	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/sensord.te	2012-09-08 18:06:09.090552067 +0200
@@ -0,0 +1,35 @@
+policy_module(sensord, 1.0.0)
+
+########################################
+#
+# Declarations
+#
+
+type sensord_t;
+type sensord_exec_t;
+init_daemon_domain(sensord_t, sensord_exec_t)
+
+type sensord_initrc_exec_t;
+init_script_file(sensord_initrc_exec_t)
+
+type sensord_var_run_t;
+files_pid_file(sensord_var_run_t)
+
+########################################
+#
+# Local policy
+#
+
+allow sensord_t self:fifo_file rw_fifo_file_perms;
+allow sensord_t self:unix_stream_socket create_stream_socket_perms;
+
+manage_files_pattern(sensord_t, sensord_var_run_t, sensord_var_run_t)
+files_pid_filetrans(sensord_t, sensord_var_run_t, file)
+
+dev_read_sysfs(sensord_t)
+
+files_read_etc_files(sensord_t)
+
+logging_send_syslog_msg(sensord_t)
+
+miscfiles_read_localization(sensord_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/setroubleshoot.fc refpolicy/policy/modules/contrib/setroubleshoot.fc
--- refpolicy/policy/modules/contrib/setroubleshoot.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/setroubleshoot.fc	2012-10-27 13:43:49.223007370 +0200
@@ -1,9 +1,9 @@
 /usr/sbin/setroubleshootd	--	gen_context(system_u:object_r:setroubleshootd_exec_t,s0)
 
-/usr/share/setroubleshoot/SetroubleshootFixit\.py* -- gen_context(system_u:object_r:setroubleshoot_fixit_exec_t,s0)
+/usr/share/setroubleshoot/SetroubleshootFixit\.py*	--	gen_context(system_u:object_r:setroubleshoot_fixit_exec_t,s0)
 
-/var/run/setroubleshoot(/.*)?		gen_context(system_u:object_r:setroubleshoot_var_run_t,s0)
+/var/run/setroubleshoot(/.*)?	gen_context(system_u:object_r:setroubleshoot_var_run_t,s0)
 
-/var/log/setroubleshoot(/.*)?		gen_context(system_u:object_r:setroubleshoot_var_log_t,s0)
+/var/log/setroubleshoot(/.*)?	gen_context(system_u:object_r:setroubleshoot_var_log_t,s0)
 
-/var/lib/setroubleshoot(/.*)?		gen_context(system_u:object_r:setroubleshoot_var_lib_t,s0)
+/var/lib/setroubleshoot(/.*)?	gen_context(system_u:object_r:setroubleshoot_var_lib_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/setroubleshoot.if refpolicy/policy/modules/contrib/setroubleshoot.if
--- refpolicy/policy/modules/contrib/setroubleshoot.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/setroubleshoot.if	2012-10-27 13:43:51.093007374 +0200
@@ -1,8 +1,9 @@
-## <summary>SELinux troubleshooting service</summary>
+## <summary>SELinux troubleshooting service.</summary>
 
 ########################################
 ## <summary>
-##	Connect to setroubleshootd over an unix stream socket.
+##	Connect to setroubleshootd with a
+##	unix domain stream socket.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -22,8 +23,9 @@
 
 ########################################
 ## <summary>
-##	Dontaudit attempts to connect to setroubleshootd
-##	over an unix stream socket.
+##	Do not audit attempts to connect to
+##	setroubleshootd with a unix
+##	domain stream socket.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -105,8 +107,8 @@
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate
-##	an setroubleshoot environment
+##	All of the rules required to
+##	administrate an setroubleshoot environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -117,15 +119,15 @@
 #
 interface(`setroubleshoot_admin',`
 	gen_require(`
-		type setroubleshootd_t, setroubleshoot_log_t;
+		type setroubleshootd_t, setroubleshoot_var_log_t, setroubleshoot_fixit_t;
 		type setroubleshoot_var_lib_t, setroubleshoot_var_run_t;
 	')
 
-	allow $1 setroubleshootd_t:process { ptrace signal_perms };
-	ps_process_pattern($1, setroubleshootd_t)
+	allow $1 { setroubleshoot_fixit_t setroubleshootd_t }:process { ptrace signal_perms };
+	ps_process_pattern($1, { setroubleshootd_t setroubleshoot_fixit_t })
 
 	logging_list_logs($1)
-	admin_pattern($1, setroubleshoot_log_t)
+	admin_pattern($1, setroubleshoot_var_log_t)
 
 	files_list_var_lib($1)
 	admin_pattern($1, setroubleshoot_var_lib_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/setroubleshoot.te refpolicy/policy/modules/contrib/setroubleshoot.te
--- refpolicy/policy/modules/contrib/setroubleshoot.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/setroubleshoot.te	2012-10-27 13:43:51.094007374 +0200
@@ -1,4 +1,4 @@
-policy_module(setroubleshoot, 1.11.0)
+policy_module(setroubleshoot, 1.11.1)
 
 ########################################
 #
@@ -7,84 +7,85 @@
 
 type setroubleshootd_t alias setroubleshoot_t;
 type setroubleshootd_exec_t;
-domain_type(setroubleshootd_t)
-init_daemon_domain(setroubleshootd_t, setroubleshootd_exec_t)
+init_system_domain(setroubleshootd_t, setroubleshootd_exec_t)
 
 type setroubleshoot_fixit_t;
 type setroubleshoot_fixit_exec_t;
-dbus_system_domain(setroubleshoot_fixit_t, setroubleshoot_fixit_exec_t)
+init_system_domain(setroubleshoot_fixit_t, setroubleshoot_fixit_exec_t)
 
 type setroubleshoot_var_lib_t;
 files_type(setroubleshoot_var_lib_t)
 
-# log files
 type setroubleshoot_var_log_t;
 logging_log_file(setroubleshoot_var_log_t)
 
-# pid files
 type setroubleshoot_var_run_t;
 files_pid_file(setroubleshoot_var_run_t)
 
 ########################################
 #
-# setroubleshootd local policy
+# Local policy
 #
 
-allow setroubleshootd_t self:capability { dac_override sys_nice sys_tty_config };
-allow setroubleshootd_t self:process { getattr getsched setsched sigkill signull signal };
+allow setroubleshootd_t self:capability { dac_override sys_nice sys_ptrace sys_tty_config };
+allow setroubleshootd_t self:process { getattr getsched setsched sigkill signull signal execmem execstack };
 allow setroubleshootd_t self:fifo_file rw_fifo_file_perms;
-allow setroubleshootd_t self:tcp_socket create_stream_socket_perms;
-allow setroubleshootd_t self:unix_stream_socket { create_stream_socket_perms connectto };
-allow setroubleshootd_t self:unix_dgram_socket create_socket_perms;
+allow setroubleshootd_t self:tcp_socket { accept listen };
+allow setroubleshootd_t self:unix_stream_socket { accept connectto listen };
 
-# database files
-allow setroubleshootd_t setroubleshoot_var_lib_t:dir setattr;
+allow setroubleshootd_t setroubleshoot_var_lib_t:dir setattr_dir_perms;
 manage_files_pattern(setroubleshootd_t, setroubleshoot_var_lib_t, setroubleshoot_var_lib_t)
 files_var_lib_filetrans(setroubleshootd_t, setroubleshoot_var_lib_t, { file dir })
 
-# log files
-allow setroubleshootd_t setroubleshoot_var_log_t:dir setattr;
-manage_files_pattern(setroubleshootd_t, setroubleshoot_var_log_t, setroubleshoot_var_log_t)
+allow setroubleshootd_t setroubleshoot_var_log_t:dir setattr_dir_perms;
+append_files_pattern(setroubleshootd_t, setroubleshoot_var_log_t, setroubleshoot_var_log_t)
+create_files_pattern(setroubleshootd_t, setroubleshoot_var_log_t, setroubleshoot_var_log_t)
+setattr_files_pattern(setroubleshootd_t, setroubleshoot_var_log_t, setroubleshoot_var_log_t)
 manage_sock_files_pattern(setroubleshootd_t, setroubleshoot_var_log_t, setroubleshoot_var_log_t)
 logging_log_filetrans(setroubleshootd_t, setroubleshoot_var_log_t, { file dir })
 
-# pid file
+manage_dirs_pattern(setroubleshootd_t, setroubleshoot_var_run_t, setroubleshoot_var_run_t)
 manage_files_pattern(setroubleshootd_t, setroubleshoot_var_run_t, setroubleshoot_var_run_t)
 manage_sock_files_pattern(setroubleshootd_t, setroubleshoot_var_run_t, setroubleshoot_var_run_t)
-files_pid_filetrans(setroubleshootd_t, setroubleshoot_var_run_t, { file sock_file })
+files_pid_filetrans(setroubleshootd_t, setroubleshoot_var_run_t, { file sock_file dir })
 
 kernel_read_kernel_sysctls(setroubleshootd_t)
 kernel_read_system_state(setroubleshootd_t)
 kernel_read_net_sysctls(setroubleshootd_t)
 kernel_read_network_state(setroubleshootd_t)
+kernel_dontaudit_list_all_proc(setroubleshootd_t)
+kernel_read_irq_sysctls(setroubleshootd_t)
+kernel_read_unlabeled_state(setroubleshootd_t)
 
 corecmd_exec_bin(setroubleshootd_t)
 corecmd_exec_shell(setroubleshootd_t)
+corecmd_read_all_executables(setroubleshootd_t)
 
 corenet_all_recvfrom_unlabeled(setroubleshootd_t)
 corenet_all_recvfrom_netlabel(setroubleshootd_t)
 corenet_tcp_sendrecv_generic_if(setroubleshootd_t)
 corenet_tcp_sendrecv_generic_node(setroubleshootd_t)
-corenet_tcp_sendrecv_all_ports(setroubleshootd_t)
-corenet_tcp_bind_generic_node(setroubleshootd_t)
-corenet_tcp_connect_smtp_port(setroubleshootd_t)
+
 corenet_sendrecv_smtp_client_packets(setroubleshootd_t)
+corenet_tcp_connect_smtp_port(setroubleshootd_t)
+corenet_tcp_sendrecv_smtp_port(setroubleshootd_t)
 
 dev_read_urand(setroubleshootd_t)
 dev_read_sysfs(setroubleshootd_t)
 dev_getattr_all_blk_files(setroubleshootd_t)
 dev_getattr_all_chr_files(setroubleshootd_t)
+dev_getattr_mtrr_dev(setroubleshootd_t)
 
 domain_dontaudit_search_all_domains_state(setroubleshootd_t)
 domain_signull_all_domains(setroubleshootd_t)
 
 files_read_usr_files(setroubleshootd_t)
-files_read_etc_files(setroubleshootd_t)
 files_list_all(setroubleshootd_t)
 files_getattr_all_files(setroubleshootd_t)
 files_getattr_all_pipes(setroubleshootd_t)
 files_getattr_all_sockets(setroubleshootd_t)
 files_read_all_symlinks(setroubleshootd_t)
+files_read_mnt_files(setroubleshootd_t)
 
 fs_getattr_all_dirs(setroubleshootd_t)
 fs_getattr_all_files(setroubleshootd_t)
@@ -95,6 +96,7 @@
 
 selinux_get_enforce_mode(setroubleshootd_t)
 selinux_validate_context(setroubleshootd_t)
+selinux_read_policy(setroubleshootd_t)
 
 term_dontaudit_use_all_ptys(setroubleshootd_t)
 term_dontaudit_use_all_ttys(setroubleshootd_t)
@@ -104,7 +106,7 @@
 init_read_utmp(setroubleshootd_t)
 init_dontaudit_write_utmp(setroubleshootd_t)
 
-miscfiles_read_localization(setroubleshootd_t)
+libs_exec_ld_so(setroubleshootd_t)
 
 locallogin_dontaudit_use_fds(setroubleshootd_t)
 
@@ -112,7 +114,7 @@
 logging_send_syslog_msg(setroubleshootd_t)
 logging_stream_connect_dispatcher(setroubleshootd_t)
 
-modutils_read_module_config(setroubleshootd_t)
+miscfiles_read_localization(setroubleshootd_t)
 
 seutil_read_config(setroubleshootd_t)
 seutil_read_file_contexts(setroubleshootd_t)
@@ -125,6 +127,15 @@
 ')
 
 optional_policy(`
+	locate_read_lib_files(setroubleshootd_t)
+')
+
+optional_policy(`
+	modutils_read_module_config(setroubleshootd_t)
+')
+
+optional_policy(`
+	rpm_exec(setroubleshootd_t)
 	rpm_signull(setroubleshootd_t)
 	rpm_read_db(setroubleshootd_t)
 	rpm_dontaudit_manage_db(setroubleshootd_t)
@@ -133,13 +144,12 @@
 
 ########################################
 #
-# setroubleshoot_fixit local policy
+# Fixit local policy
 #
 
 allow setroubleshoot_fixit_t self:capability sys_nice;
 allow setroubleshoot_fixit_t self:process { setsched getsched };
 allow setroubleshoot_fixit_t self:fifo_file rw_fifo_file_perms;
-allow setroubleshoot_fixit_t self:unix_dgram_socket create_socket_perms;
 
 allow setroubleshoot_fixit_t setroubleshootd_t:process signull;
 
@@ -154,7 +164,6 @@
 seutil_domtrans_setfiles(setroubleshoot_fixit_t)
 
 files_read_usr_files(setroubleshoot_fixit_t)
-files_read_etc_files(setroubleshoot_fixit_t)
 files_list_tmp(setroubleshoot_fixit_t)
 
 auth_use_nsswitch(setroubleshoot_fixit_t)
@@ -164,14 +173,20 @@
 
 miscfiles_read_localization(setroubleshoot_fixit_t)
 
+userdom_read_all_users_state(setroubleshoot_fixit_t)
+userdom_signull_unpriv_users(setroubleshoot_fixit_t)
+
+optional_policy(`
+	dbus_system_domain(setroubleshoot_fixit_t, setroubleshoot_fixit_exec_t)
+
+	optional_policy(`
+		policykit_dbus_chat(setroubleshoot_fixit_t)
+	')
+')
+
 optional_policy(`
 	rpm_signull(setroubleshoot_fixit_t)
 	rpm_read_db(setroubleshoot_fixit_t)
 	rpm_dontaudit_manage_db(setroubleshoot_fixit_t)
 	rpm_use_script_fds(setroubleshoot_fixit_t)
 ')
-
-optional_policy(`
-	policykit_dbus_chat(setroubleshoot_fixit_t)
-	userdom_read_all_users_state(setroubleshoot_fixit_t)
-')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/shorewall.fc refpolicy/policy/modules/contrib/shorewall.fc
--- refpolicy/policy/modules/contrib/shorewall.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/shorewall.fc	2012-10-29 15:48:26.915186455 +0100
@@ -1,16 +1,29 @@
-/etc/rc\.d/init\.d/shorewall		--	gen_context(system_u:object_r:shorewall_initrc_exec_t,s0)
-/etc/rc\.d/init\.d/shorewall-lite	--	gen_context(system_u:object_r:shorewall_initrc_exec_t,s0)
+/etc/rc\.d/init\.d/shorewall.*	--	gen_context(system_u:object_r:shorewall_initrc_exec_t,s0)
 
-/etc/shorewall(/.*)?				gen_context(system_u:object_r:shorewall_etc_t,s0)
-/etc/shorewall-lite(/.*)?			gen_context(system_u:object_r:shorewall_etc_t,s0)
+/etc/shorewall(/.*)?	gen_context(system_u:object_r:shorewall_etc_t,s0)
+/etc/shorewall-lite(/.*)?	gen_context(system_u:object_r:shorewall_etc_t,s0)
 
-/sbin/shorewall6?			--	gen_context(system_u:object_r:shorewall_exec_t,s0)
-/sbin/shorewall-lite			--	gen_context(system_u:object_r:shorewall_exec_t,s0)
+/sbin/shorewall6?	--	gen_context(system_u:object_r:shorewall_exec_t,s0)
+/sbin/shorewall-lite	--	gen_context(system_u:object_r:shorewall_exec_t,s0)
 
-/var/lib/shorewall(/.*)?			gen_context(system_u:object_r:shorewall_var_lib_t,s0)
-/var/lib/shorewall6(/.*)?			gen_context(system_u:object_r:shorewall_var_lib_t,s0)
-/var/lib/shorewall-lite(/.*)?			gen_context(system_u:object_r:shorewall_var_lib_t,s0)
+/usr/sbin/shorewall6?	--	gen_context(system_u:object_r:shorewall_exec_t,s0)
+/usr/sbin/shorewall-lite	--	gen_context(system_u:object_r:shorewall_exec_t,s0)
 
-/var/lock/subsys/shorewall		--	gen_context(system_u:object_r:shorewall_lock_t,s0)
+/var/lib/shorewall(/.*)?	gen_context(system_u:object_r:shorewall_var_lib_t,s0)
+/var/lib/shorewall6(/.*)?	gen_context(system_u:object_r:shorewall_var_lib_t,s0)
+/var/lib/shorewall-lite(/.*)?	gen_context(system_u:object_r:shorewall_var_lib_t,s0)
 
-/var/log/shorewall.*				gen_context(system_u:object_r:shorewall_log_t,s0)
+/var/lock/subsys/shorewall	--	gen_context(system_u:object_r:shorewall_lock_t,s0)
+
+/var/log/shorewall.*	gen_context(system_u:object_r:shorewall_log_t,s0)
+
+ifdef(`distro_gentoo',`
+/usr/share/shorewall/compiler\.pl	--	gen_context(system_u:object_r:bin_t,s0)
+/usr/share/shorewall/configpath	--	gen_context(system_u:object_r:bin_t,s0)
+/usr/share/shorewall/getparams	--	gen_context(system_u:object_r:bin_t,s0)
+/usr/share/shorewall/wait4ifup	--	gen_context(system_u:object_r:bin_t,s0)
+/usr/share/shorewall-perl(/.*)?		gen_context(system_u:object_r:bin_t,s0)
+/usr/share/shorewall-shell(/.*)?	gen_context(system_u:object_r:bin_t,s0)
+/usr/share/shorewall-lite(/.*)?		gen_context(system_u:object_r:bin_t,s0)
+/usr/share/shorewall6-lite(/.*)?	gen_context(system_u:object_r:bin_t,s0)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/shorewall.if refpolicy/policy/modules/contrib/shorewall.if
--- refpolicy/policy/modules/contrib/shorewall.if	2012-05-04 15:16:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/shorewall.if	2012-10-27 13:43:53.472007379 +0200
@@ -1,4 +1,4 @@
-## <summary>Shoreline Firewall high-level tool for configuring netfilter</summary>
+## <summary>Shoreline Firewall high-level tool for configuring netfilter.</summary>
 
 ########################################
 ## <summary>
@@ -15,6 +15,7 @@
 		type shorewall_t, shorewall_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, shorewall_exec_t, shorewall_t)
 ')
 
@@ -33,12 +34,13 @@
 		type shorewall_t, shorewall_var_lib_t;
 	')
 
+	files_search_var_lib($1)
 	domtrans_pattern($1, shorewall_var_lib_t, shorewall_t)
 ')
 
 #######################################
 ## <summary>
-##	Read shorewall etc configuration files.
+##	Read shorewall configuration files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -57,7 +59,7 @@
 
 #######################################
 ## <summary>
-##	Read shorewall PID files.
+##	Read shorewall pid files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -76,7 +78,7 @@
 
 #######################################
 ## <summary>
-##	Read and write shorewall PID files.
+##	Read and write shorewall pid files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -95,47 +97,45 @@
 
 ######################################
 ## <summary>
-##      Read shorewall /var/lib files.
+##	Read shorewall lib files.
 ## </summary>
 ## <param name="domain">
-##      <summary>
-##      Domain allowed access.
-##      </summary>
+##	<summary>
+##	Domain allowed access.
+##	</summary>
 ## </param>
 #
 interface(`shorewall_read_lib_files',`
-        gen_require(`
-                type shorewall_t;
-       ')
+	gen_require(`
+		type shorewall_var_lib_t;
+	')
 
-        files_search_var_lib($1)
-        search_dirs_pattern($1, shorewall_var_lib_t, shorewall_var_lib_t)
-        read_files_pattern($1, shorewall_var_lib_t, shorewall_var_lib_t)
+	files_search_var_lib($1)
+	read_files_pattern($1, shorewall_var_lib_t, shorewall_var_lib_t)
 ')
 
 #######################################
 ## <summary>
-##      Read and write shorewall /var/lib files.
+##	Read and write shorewall lib files.
 ## </summary>
 ## <param name="domain">
-##      <summary>
-##      Domain allowed access.
-##      </summary>
+##	<summary>
+##	Domain allowed access.
+##	</summary>
 ## </param>
 #
 interface(`shorewall_rw_lib_files',`
-        gen_require(`
-                type shorewall_var_lib_t;
-       ')
+	gen_require(`
+		type shorewall_var_lib_t;
+	')
 
-        files_search_var_lib($1)
-        search_dirs_pattern($1, shorewall_var_lib_t, shorewall_var_lib_t)
-        rw_files_pattern($1, shorewall_var_lib_t, shorewall_var_lib_t)
+	files_search_var_lib($1)
+	rw_files_pattern($1, shorewall_var_lib_t, shorewall_var_lib_t)
 ')
 
 #######################################
 ## <summary>
-##	Read shorewall tmp files.
+##	Read shorewall temporary files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -154,8 +154,8 @@
 
 #######################################
 ## <summary>
-##	All of the rules required to administrate
-##	an shorewall environment
+##	All of the rules required to
+##	administrate an shorewall environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -164,16 +164,15 @@
 ## </param>
 ## <param name="role">
 ##	<summary>
-##	The role to be allowed to manage the syslog domain.
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <rolecap/>
 #
 interface(`shorewall_admin',`
 	gen_require(`
-		type shorewall_t, shorewall_lock_t;
-		type shorewall_log_t;
-		type shorewall_initrc_exec_t, shorewall_var_lib_t;
+		type shorewall_t, shorewall_lock_t, shorewall_log_t;
+		type shorewall_exec_t, shorewall_initrc_exec_t, shorewall_var_lib_t;
 		type shorewall_tmp_t, shorewall_etc_t;
 	')
 
@@ -185,6 +184,8 @@
 	role_transition $2 shorewall_initrc_exec_t system_r;
 	allow $2 system_r;
 
+	can_exec($1, shorewall_exec_t)
+
 	files_list_etc($1)
 	admin_pattern($1, shorewall_etc_t)
 
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/shorewall.te refpolicy/policy/modules/contrib/shorewall.te
--- refpolicy/policy/modules/contrib/shorewall.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/shorewall.te	2012-10-29 15:48:26.916186455 +0100
@@ -1,4 +1,4 @@
-policy_module(shorewall, 1.3.0)
+policy_module(shorewall, 1.3.3)
 
 ########################################
 #
@@ -12,21 +12,16 @@
 type shorewall_initrc_exec_t;
 init_script_file(shorewall_initrc_exec_t)
 
-# etc files
 type shorewall_etc_t;
 files_config_file(shorewall_etc_t)
 
-# lock files
 type shorewall_lock_t;
 files_lock_file(shorewall_lock_t)
 
-# tmp files
 type shorewall_tmp_t;
 files_tmp_file(shorewall_tmp_t)
 
-# var/lib files
 type shorewall_var_lib_t;
-files_type(shorewall_var_lib_t)
 domain_entry_file(shorewall_t, shorewall_var_lib_t)
 
 type shorewall_log_t;
@@ -34,10 +29,10 @@
 
 ########################################
 #
-# shorewall local policy
+# Local policy
 #
 
-allow shorewall_t self:capability { dac_override net_admin net_raw setuid setgid sys_nice sys_ptrace };
+allow shorewall_t self:capability { dac_override net_admin net_raw setuid setgid sys_nice sys_admin };
 dontaudit shorewall_t self:capability sys_tty_config;
 allow shorewall_t self:fifo_file rw_fifo_file_perms;
 
@@ -47,8 +42,10 @@
 manage_files_pattern(shorewall_t, shorewall_lock_t, shorewall_lock_t)
 files_lock_filetrans(shorewall_t, shorewall_lock_t, file)
 
-manage_files_pattern(shorewall_t, shorewall_log_t, shorewall_log_t)
 manage_dirs_pattern(shorewall_t, shorewall_log_t, shorewall_log_t)
+append_files_pattern(shorewall_t, shorewall_log_t, shorewall_log_t)
+create_files_pattern(shorewall_t, shorewall_log_t, shorewall_log_t)
+setattr_files_pattern(shorewall_t, shorewall_log_t, shorewall_log_t)
 logging_log_filetrans(shorewall_t, shorewall_log_t, { file dir })
 
 manage_dirs_pattern(shorewall_t, shorewall_tmp_t, shorewall_tmp_t)
@@ -75,14 +72,16 @@
 domain_read_all_domains_state(shorewall_t)
 
 files_getattr_kernel_modules(shorewall_t)
-files_read_etc_files(shorewall_t)
 files_read_usr_files(shorewall_t)
 files_search_kernel_modules(shorewall_t)
 
 fs_getattr_all_fs(shorewall_t)
 
+auth_use_nsswitch(shorewall_t)
+
 init_rw_utmp(shorewall_t)
 
+logging_read_generic_logs(shorewall_t)
 logging_send_syslog_msg(shorewall_t)
 
 miscfiles_read_localization(shorewall_t)
@@ -90,6 +89,11 @@
 sysnet_domtrans_ifconfig(shorewall_t)
 
 userdom_dontaudit_list_user_home_dirs(shorewall_t)
+userdom_use_user_terminals(shorewall_t)
+
+optional_policy(`
+	brctl_domtrans(shorewall_t)
+')
 
 optional_policy(`
 	hostname_exec(shorewall_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/shutdown.fc refpolicy/policy/modules/contrib/shutdown.fc
--- refpolicy/policy/modules/contrib/shutdown.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/shutdown.fc	2012-10-27 13:43:55.821007383 +0200
@@ -1,7 +1,11 @@
-/etc/nologin		--	gen_context(system_u:object_r:shutdown_etc_t,s0)
+/etc/nologin	--	gen_context(system_u:object_r:shutdown_etc_t,s0)
 
 /lib/upstart/shutdown	--	gen_context(system_u:object_r:shutdown_exec_t,s0)
 
-/sbin/shutdown		--	gen_context(system_u:object_r:shutdown_exec_t,s0)
+/sbin/shutdown	--	gen_context(system_u:object_r:shutdown_exec_t,s0)
+
+/usr/lib/upstart/shutdown	--	gen_context(system_u:object_r:shutdown_exec_t,s0)
+
+/usr/sbin/shutdown	--	gen_context(system_u:object_r:shutdown_exec_t,s0)
 
 /var/run/shutdown\.pid	--	gen_context(system_u:object_r:shutdown_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/shutdown.if refpolicy/policy/modules/contrib/shutdown.if
--- refpolicy/policy/modules/contrib/shutdown.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/shutdown.if	2012-10-30 19:33:24.022399679 +0100
@@ -1,4 +1,30 @@
-## <summary>System shutdown command</summary>
+## <summary>System shutdown command.</summary>
+
+########################################
+## <summary>
+##	Role access for shutdown.
+## </summary>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <param name="domain">
+##	<summary>
+##	User domain for the role.
+##	</summary>
+## </param>
+#
+interface(`shutdown_role',`
+	gen_require(`
+		type shutdown_t;
+	')
+
+	shutdown_run($2, $1)
+
+	allow $2 shutdown_t:process { ptrace signal_perms };
+	ps_process_pattern($2, shutdown_t)
+')
 
 ########################################
 ## <summary>
@@ -17,17 +43,13 @@
 
 	corecmd_search_bin($1)
 	domtrans_pattern($1, shutdown_exec_t, shutdown_t)
-
-	ifdef(`hide_broken_symptoms', `
-		dontaudit shutdown_t $1:socket_class_set { read write };
-		dontaudit shutdown_t $1:fifo_file { read write };
-	')
 ')
 
 ########################################
 ## <summary>
-##	Execute shutdown in the shutdown domain, and
-##	allow the specified role the shutdown domain.
+##	Execute shutdown in the shutdown
+##	domain, and allow the specified role
+##	the shutdown domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -42,16 +64,34 @@
 #
 interface(`shutdown_run',`
 	gen_require(`
-		type shutdown_t;
+		attribute_role shutdown_roles;
 	')
 
 	shutdown_domtrans($1)
-	role $2 types shutdown_t;
+	roleattribute $2 shutdown_roles;
+')
+
+########################################
+## <summary>
+##	Send generic signals to shutdown.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`shutdown_signal',`
+	gen_require(`
+		type shutdown_t;
+	')
+
+	allow shutdown_t $1:process signal;
 ')
 
 ########################################
 ## <summary>
-##	Get attributes of shutdown executable.
+##	Get attributes of shutdown executable files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/shutdown.te refpolicy/policy/modules/contrib/shutdown.te
--- refpolicy/policy/modules/contrib/shutdown.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/shutdown.te	2012-10-30 19:33:24.023399679 +0100
@@ -1,14 +1,17 @@
-policy_module(shutdown, 1.1.0)
+policy_module(shutdown, 1.1.2)
 
 ########################################
 #
 # Declarations
 #
 
+attribute_role shutdown_roles;
+
 type shutdown_t;
 type shutdown_exec_t;
+init_system_domain(shutdown_t, shutdown_exec_t)
 application_domain(shutdown_t, shutdown_exec_t)
-role system_r types shutdown_t;
+role shutdown_roles types shutdown_t;
 
 type shutdown_etc_t;
 files_config_file(shutdown_etc_t)
@@ -18,12 +21,11 @@
 
 ########################################
 #
-# shutdown local policy
+# Local policy
 #
 
-allow shutdown_t self:capability { dac_override kill setuid sys_tty_config };
-allow shutdown_t self:process { fork signal signull };
-
+allow shutdown_t self:capability { dac_override kill setuid sys_nice sys_tty_config };
+allow shutdown_t self:process { setsched signal signull };
 allow shutdown_t self:fifo_file manage_fifo_file_perms;
 allow shutdown_t self:unix_stream_socket create_stream_socket_perms;
 
@@ -33,18 +35,21 @@
 manage_files_pattern(shutdown_t, shutdown_var_run_t, shutdown_var_run_t)
 files_pid_filetrans(shutdown_t, shutdown_var_run_t, file)
 
+kernel_read_system_state(shutdown_t)
+
 domain_use_interactive_fds(shutdown_t)
 
-files_read_etc_files(shutdown_t)
+files_delete_boot_flag(shutdown_t)
 files_read_generic_pids(shutdown_t)
 
+mls_file_write_to_clearance(shutdown_t)
+
 term_use_all_terms(shutdown_t)
 
 auth_use_nsswitch(shutdown_t)
 auth_write_login_records(shutdown_t)
 
-init_dontaudit_write_utmp(shutdown_t)
-init_read_utmp(shutdown_t)
+init_rw_utmp(shutdown_t)
 init_stream_connect(shutdown_t)
 init_telinit(shutdown_t)
 
@@ -54,10 +59,19 @@
 miscfiles_read_localization(shutdown_t)
 
 optional_policy(`
+	cron_system_entry(shutdown_t, shutdown_exec_t)
+')
+
+optional_policy(`
 	dbus_system_bus_client(shutdown_t)
 	dbus_connect_system_bus(shutdown_t)
 ')
 
 optional_policy(`
+	oddjob_dontaudit_rw_fifo_files(shutdown_t)
+	oddjob_sigchld(shutdown_t)
+')
+
+optional_policy(`
 	xserver_dontaudit_write_log(shutdown_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/skype.fc refpolicy/policy/modules/contrib/skype.fc
--- refpolicy/policy/modules/contrib/skype.fc	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/skype.fc	2012-08-15 11:12:04.923674520 +0200
@@ -0,0 +1,12 @@
+HOME_DIR/\.Skype(/.*)?		gen_context(system_u:object_r:skype_home_t,s0)
+
+#
+# /opt
+#
+/opt/skype/skype	--	gen_context(system_u:object_r:skype_exec_t,s0)
+/opt/bin/skype		--	gen_context(system_u:object_r:skype_exec_t,s0)
+
+#
+# /usr
+#
+/usr/bin/skype		--	gen_context(system_u:object_r:skype_exec_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/skype.if refpolicy/policy/modules/contrib/skype.if
--- refpolicy/policy/modules/contrib/skype.if	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/skype.if	2012-05-05 16:11:33.052762626 +0200
@@ -0,0 +1,39 @@
+## <summary>Skype softphone.</summary>
+
+#######################################
+## <summary>
+##      Role access for the skype module.
+## </summary>
+## <param name="role">
+##      <summary>
+##      The role associated with the user domain.
+##      </summary>
+## </param>
+## <param name="user_domain">
+##      <summary>
+##      The type of the user domain.
+##      </summary>
+## </param>
+#
+interface(`skype_role',`
+	gen_require(`
+		type skype_t, skype_exec_t, skype_tmpfs_t, skype_home_t;
+	')
+	
+	role $1 types skype_t;
+	
+	domtrans_pattern($2, skype_exec_t, skype_t)
+
+	allow $2 skype_t:process { ptrace signal_perms };
+	dontaudit skype_t $2:unix_stream_socket { connectto };
+
+	manage_dirs_pattern($2, skype_home_t, skype_home_t)
+	manage_files_pattern($2, skype_home_t, skype_home_t)
+	manage_lnk_files_pattern($2, skype_home_t, skype_home_t)
+
+	relabel_dirs_pattern($2, skype_home_t, skype_home_t)
+	relabel_files_pattern($2, skype_home_t, skype_home_t)
+	relabel_lnk_files_pattern($2, skype_home_t, skype_home_t)
+
+	ps_process_pattern($2, skype_t)
+')	
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/skype.te refpolicy/policy/modules/contrib/skype.te
--- refpolicy/policy/modules/contrib/skype.te	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/skype.te	2012-10-04 20:03:34.492380413 +0200
@@ -0,0 +1,122 @@
+policy_module(skype, 0.0.2)
+
+############################
+# 
+# Declarations
+#
+
+## <desc>
+## <p>
+##   Be able to manage user files (needed to support sending and receiving files).
+##   Without this boolean set, only files marked as skype_home_t can be used for
+##   sending and receiving.
+## </p>
+## </desc>
+gen_tunable(skype_manage_user_content, false)
+
+type skype_t;
+type skype_exec_t;
+application_domain(skype_t, skype_exec_t)
+
+type skype_home_t;
+userdom_user_home_dir_filetrans(skype_t, skype_home_t, dir)
+userdom_user_home_content(skype_home_t)
+
+type skype_tmp_t;
+files_tmp_file(skype_tmp_t)
+ubac_constrained(skype_tmp_t)
+
+type skype_tmpfs_t;
+files_tmpfs_file(skype_tmpfs_t)
+ubac_constrained(skype_tmpfs_t)
+
+############################
+#
+# Policy
+#
+
+allow skype_t self:process { getsched setsched execmem signal };
+allow skype_t self:fifo_file rw_fifo_file_perms;
+allow skype_t self:unix_stream_socket create_socket_perms;
+allow skype_t self:sem create_sem_perms;
+allow skype_t self:tcp_socket create_stream_socket_perms;
+
+# Allow skype to work with its ~/.skype location
+manage_dirs_pattern(skype_t, skype_home_t, skype_home_t)
+manage_files_pattern(skype_t, skype_home_t, skype_home_t)
+manage_lnk_files_pattern(skype_t, skype_home_t, skype_home_t)
+
+# Needed for supporting X11 & shared memory
+manage_files_pattern(skype_t, skype_tmpfs_t, skype_tmpfs_t)
+manage_lnk_files_pattern(skype_t, skype_tmpfs_t, skype_tmpfs_t)
+manage_fifo_files_pattern(skype_t, skype_tmpfs_t, skype_tmpfs_t)
+manage_sock_files_pattern(skype_t, skype_tmpfs_t, skype_tmpfs_t)
+fs_tmpfs_filetrans(skype_t, skype_tmpfs_t, { file lnk_file sock_file fifo_file })
+
+manage_files_pattern(skype_t, skype_tmp_t, skype_tmp_t)
+manage_sock_files_pattern(skype_t, skype_tmp_t, skype_tmp_t)
+files_tmp_filetrans(skype_t, skype_tmp_t, { file sock_file })
+
+kernel_dontaudit_search_sysctl(skype_t)
+kernel_dontaudit_read_kernel_sysctls(skype_t)
+kernel_read_network_state(skype_t)
+kernel_read_system_state(skype_t)
+
+corecmd_exec_bin(skype_t)
+corecmd_exec_shell(skype_t)
+
+can_exec(skype_t, skype_exec_t)
+
+corenet_all_recvfrom_netlabel(skype_t)
+corenet_all_recvfrom_unlabeled(skype_t)
+corenet_sendrecv_http_client_packets(skype_t)
+corenet_tcp_bind_generic_node(skype_t)
+corenet_tcp_bind_generic_port(skype_t) 
+corenet_tcp_connect_all_unreserved_ports(skype_t)
+corenet_tcp_connect_generic_port(skype_t)
+corenet_tcp_connect_http_port(skype_t)
+corenet_tcp_sendrecv_http_port(skype_t)
+corenet_udp_bind_generic_node(skype_t)
+corenet_udp_bind_generic_port(skype_t) 
+
+dev_dontaudit_search_sysfs(skype_t)
+dev_read_sound(skype_t)
+dev_read_video_dev(skype_t)
+dev_write_sound(skype_t)
+dev_write_video_dev(skype_t)
+
+domain_dontaudit_use_interactive_fds(skype_t)
+
+files_read_etc_files(skype_t)
+files_read_usr_files(skype_t)
+
+fs_dontaudit_getattr_tmpfs(skype_t)
+fs_dontaudit_getattr_xattr_fs(skype_t)
+
+auth_use_nsswitch(skype_t)
+
+miscfiles_dontaudit_setattr_fonts_dirs(skype_t)
+miscfiles_read_localization(skype_t)
+
+userdom_dontaudit_use_user_ttys(skype_t)
+userdom_use_user_ptys(skype_t)
+
+xserver_user_x_domain_template(skype, skype_t, skype_tmpfs_t)
+
+tunable_policy(`skype_manage_user_content',`
+	userdom_manage_user_home_content_dirs(skype_t)
+	userdom_manage_user_home_content_files(skype_t)
+')
+
+optional_policy(`
+	alsa_read_rw_config(skype_t)
+')
+
+optional_policy(`
+	dbus_system_bus_client(skype_t)
+	dbus_all_session_bus_client(skype_t)
+')
+
+optional_policy(`
+	xdg_manage_generic_config_home(skype_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/slocate.fc refpolicy/policy/modules/contrib/slocate.fc
--- refpolicy/policy/modules/contrib/slocate.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/slocate.fc	2012-10-27 13:43:58.778007390 +0200
@@ -1,2 +1,3 @@
-/usr/bin/updatedb		--	gen_context(system_u:object_r:locate_exec_t, s0)
-/var/lib/[sm]locate(/.*)?		gen_context(system_u:object_r:locate_var_lib_t,s0)
+/usr/bin/updatedb	--	gen_context(system_u:object_r:locate_exec_t, s0)
+
+/var/lib/[sm]locate(/.*)?	gen_context(system_u:object_r:locate_var_lib_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/slocate.if refpolicy/policy/modules/contrib/slocate.if
--- refpolicy/policy/modules/contrib/slocate.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/slocate.if	2012-10-27 13:43:58.779007390 +0200
@@ -1,4 +1,4 @@
-## <summary>Update database for mlocate</summary>
+## <summary>Update database for mlocate.</summary>
 
 ########################################
 ## <summary>
@@ -11,13 +11,7 @@
 ## </param>
 #
 interface(`slocate_create_append_log',`
-	gen_require(`
-		type locate_log_t;
-	')
-
-	logging_search_logs($1)
-	create_files_pattern($1, locate_log_t, locate_log_t)
-	append_files_pattern($1, locate_log_t, locate_log_t)
+	refpolicywarn(`$0($*) has been deprecated')
 ')
 
 ########################################
@@ -35,7 +29,7 @@
 		type locate_var_lib_t;
 	')
 
+	files_search_var_lib($1)
 	read_files_pattern($1, locate_var_lib_t, locate_var_lib_t)
 	allow $1 locate_var_lib_t:dir list_dir_perms;
-	files_search_var_lib($1)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/slocate.te refpolicy/policy/modules/contrib/slocate.te
--- refpolicy/policy/modules/contrib/slocate.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/slocate.te	2012-10-27 13:43:58.779007390 +0200
@@ -1,4 +1,4 @@
-policy_module(slocate, 1.11.0)
+policy_module(slocate, 1.11.1)
 
 #################################
 #
@@ -9,9 +9,6 @@
 type locate_exec_t;
 init_system_domain(locate_t, locate_exec_t)
 
-type locate_log_t;
-logging_log_file(locate_log_t)
-
 type locate_var_lib_t;
 files_type(locate_var_lib_t)
 
@@ -43,7 +40,6 @@
 files_getattr_all_pipes(locate_t)
 files_getattr_all_sockets(locate_t)
 files_read_etc_runtime_files(locate_t)
-files_read_etc_files(locate_t)
 
 fs_getattr_all_fs(locate_t)
 fs_getattr_all_files(locate_t)
@@ -55,13 +51,11 @@
 fs_list_inotifyfs(locate_t)
 fs_read_noxattr_fs_symlinks(locate_t)
 
-# getpwnam
 auth_use_nsswitch(locate_t)
 
 miscfiles_read_localization(locate_t)
 
 ifdef(`enable_mls',`
-	# On MLS machines will not be allowed to getattr Anything but SystemLow
 	files_dontaudit_getattr_all_dirs(locate_t)
 ')
 
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/slpd.fc refpolicy/policy/modules/contrib/slpd.fc
--- refpolicy/policy/modules/contrib/slpd.fc	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/slpd.fc	2012-09-24 21:10:42.272581857 +0200
@@ -0,0 +1,7 @@
+/etc/rc\.d/init\.d/slpd	--	gen_context(system_u:object_r:slpd_initrc_exec_t,s0)
+
+/usr/sbin/slpd	--	gen_context(system_u:object_r:slpd_exec_t,s0)
+
+/var/log/slpd\.log.*	--	gen_context(system_u:object_r:slpd_log_t,s0)
+
+/var/run/slpd\.pid	--	gen_context(system_u:object_r:slpd_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/slpd.if refpolicy/policy/modules/contrib/slpd.if
--- refpolicy/policy/modules/contrib/slpd.if	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/slpd.if	2012-09-24 21:10:42.272581857 +0200
@@ -0,0 +1,39 @@
+## <summary>OpenSLP server daemon to dynamically register services.</summary>
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an slpd environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`slpd_admin',`
+	gen_require(`
+		type slpd_t, slpd_initrc_exec_t, slpd_log_t;
+		type slpd_var_run_t;
+	')
+
+	allow $1 slpd_t:process { ptrace signal_perms };
+	ps_process_pattern($1, slpd_t)
+
+	init_labeled_script_domtrans($1, slpd_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 slpd_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	logging_search_logs($1)
+	admin_pattern($1, slpd_log_t)
+
+	files_search_pids($1)
+	admin_pattern($1, slpd_var_run_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/slpd.te refpolicy/policy/modules/contrib/slpd.te
--- refpolicy/policy/modules/contrib/slpd.te	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/slpd.te	2012-10-04 19:30:56.554376235 +0200
@@ -0,0 +1,55 @@
+policy_module(slpd, 1.0.3)
+
+########################################
+#
+# Declarations
+#
+
+type slpd_t;
+type slpd_exec_t;
+init_daemon_domain(slpd_t, slpd_exec_t)
+
+type slpd_initrc_exec_t;
+init_script_file(slpd_initrc_exec_t)
+
+type slpd_log_t;
+logging_log_file(slpd_log_t)
+
+type slpd_var_run_t;
+files_pid_file(slpd_var_run_t)
+
+########################################
+#
+# Local policy
+#
+
+allow slpd_t self:capability { kill setgid setuid };
+allow slpd_t self:process signal;
+allow slpd_t self:fifo_file rw_fifo_file_perms;
+allow slpd_t self:tcp_socket { accept listen };
+allow slpd_t self:unix_stream_socket create_stream_socket_perms;
+
+allow slpd_t slpd_log_t:file { append_file_perms create_file_perms setattr_file_perms };
+logging_log_filetrans(slpd_t, slpd_log_t, file)
+
+manage_files_pattern(slpd_t, slpd_var_run_t, slpd_var_run_t)
+files_pid_filetrans(slpd_t, slpd_var_run_t, file)
+
+corenet_all_recvfrom_unlabeled(slpd_t)
+corenet_all_recvfrom_netlabel(slpd_t)
+corenet_tcp_sendrecv_generic_if(slpd_t)
+corenet_udp_sendrecv_generic_if(slpd_t)
+corenet_tcp_sendrecv_generic_node(slpd_t)
+corenet_udp_sendrecv_generic_node(slpd_t)
+corenet_tcp_sendrecv_all_ports(slpd_t)
+corenet_udp_sendrecv_all_ports(slpd_t)
+corenet_tcp_bind_generic_node(slpd_t)
+corenet_udp_bind_generic_node(slpd_t)
+
+corenet_sendrecv_svrloc_server_packets(slpd_t)
+corenet_tcp_bind_svrloc_port(slpd_t)
+corenet_udp_bind_svrloc_port(slpd_t)
+
+auth_use_nsswitch(slpd_t)
+
+miscfiles_read_localization(slpd_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/slrnpull.fc refpolicy/policy/modules/contrib/slrnpull.fc
--- refpolicy/policy/modules/contrib/slrnpull.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/slrnpull.fc	2012-10-28 18:58:42.473026404 +0100
@@ -1,10 +1,7 @@
-#
-# /usr
-#
-
 /usr/bin/slrnpull	--	gen_context(system_u:object_r:slrnpull_exec_t,s0)
 
-#
-# /var
-#
+/var/log/slrnpull\.log.*	--	gen_context(system_u:object_r:slrnpull_log_t,s0)
+
+/var/run/slrnpull\.pid	--	gen_context(system_u:object_r:slrnpull_var_run_t,s0)
+
 /var/spool/slrnpull(/.*)?	gen_context(system_u:object_r:slrnpull_spool_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/slrnpull.if refpolicy/policy/modules/contrib/slrnpull.if
--- refpolicy/policy/modules/contrib/slrnpull.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/slrnpull.if	2012-10-28 18:58:42.474026404 +0100
@@ -2,9 +2,9 @@
 
 ########################################
 ## <summary>
-##	Allow the domain to search slrnpull spools.
+##	Search slrnpull spool directories.
 ## </summary>
-## <param name="pty_type">
+## <param name="domain">
 ##	<summary>
 ##	Domain allowed access.
 ##	</summary>
@@ -21,10 +21,10 @@
 
 ########################################
 ## <summary>
-##	Allow the domain to create, read,
-##	write, and delete slrnpull spools.
+##	Create, read, write, and delete
+##	slrnpull spool content.
 ## </summary>
-## <param name="pty_type">
+## <param name="domain">
 ##	<summary>
 ##	Domain allowed access.
 ##	</summary>
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/slrnpull.te refpolicy/policy/modules/contrib/slrnpull.te
--- refpolicy/policy/modules/contrib/slrnpull.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/slrnpull.te	2012-10-28 18:58:42.474026404 +0100
@@ -1,4 +1,4 @@
-policy_module(slrnpull, 1.4.0)
+policy_module(slrnpull, 1.4.1)
 
 ########################################
 #
@@ -7,7 +7,7 @@
 
 type slrnpull_t;
 type slrnpull_exec_t;
-init_daemon_domain(slrnpull_t, slrnpull_exec_t)
+init_system_domain(slrnpull_t, slrnpull_exec_t)
 
 type slrnpull_var_run_t;
 files_pid_file(slrnpull_var_run_t)
@@ -26,13 +26,12 @@
 dontaudit slrnpull_t self:capability sys_tty_config;
 allow slrnpull_t self:process signal_perms;
 
-allow slrnpull_t slrnpull_log_t:file manage_file_perms;
+allow slrnpull_t slrnpull_log_t:file { append_file_perms create_file_perms setattr_file_perms };
 logging_log_filetrans(slrnpull_t, slrnpull_log_t, file)
 
 manage_dirs_pattern(slrnpull_t, slrnpull_spool_t, slrnpull_spool_t)
 manage_files_pattern(slrnpull_t, slrnpull_spool_t, slrnpull_spool_t)
 manage_lnk_files_pattern(slrnpull_t, slrnpull_spool_t, slrnpull_spool_t)
-files_search_spool(slrnpull_t)
 
 manage_files_pattern(slrnpull_t, slrnpull_var_run_t, slrnpull_var_run_t)
 files_pid_filetrans(slrnpull_t, slrnpull_var_run_t, file)
@@ -46,6 +45,7 @@
 domain_use_interactive_fds(slrnpull_t)
 
 files_read_etc_files(slrnpull_t)
+files_search_spool(slrnpull_t)
 
 fs_getattr_all_fs(slrnpull_t)
 fs_search_auto_mountpoints(slrnpull_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/smartmon.fc refpolicy/policy/modules/contrib/smartmon.fc
--- refpolicy/policy/modules/contrib/smartmon.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/smartmon.fc	2012-10-30 21:14:33.192412634 +0100
@@ -1,12 +1,8 @@
-/etc/rc\.d/init\.d/smartd --	gen_context(system_u:object_r:fsdaemon_initrc_exec_t,s0)
+/etc/rc\.d/init\.d/smartd	--	gen_context(system_u:object_r:fsdaemon_initrc_exec_t,s0)
+/etc/rc\.d/init\.d/smartmontools	--	gen_context(system_u:object_r:fsdaemon_initrc_exec_t,s0)
 
-#
-# /usr
-#
 /usr/sbin/smartd	--	gen_context(system_u:object_r:fsdaemon_exec_t,s0)
 
-#
-# /var
-#
 /var/run/smartd\.pid	--	gen_context(system_u:object_r:fsdaemon_var_run_t,s0)
 
+/var/lib/smartmontools(/.*)?	gen_context(system_u:object_r:fsdaemon_var_lib_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/smartmon.if refpolicy/policy/modules/contrib/smartmon.if
--- refpolicy/policy/modules/contrib/smartmon.if	2012-05-04 15:16:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/smartmon.if	2012-10-28 18:58:46.234026412 +0100
@@ -1,8 +1,8 @@
-## <summary>Smart disk monitoring daemon policy</summary>
+## <summary>Smart disk monitoring daemon.</summary>
 
 #######################################
 ## <summary>
-##	Allow caller to read smartmon temporary files.
+##	Read smartmon temporary files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -15,13 +15,14 @@
 		type fsdaemon_tmp_t;
 	')
 
+	files_search_tmp($1)
 	allow $1 fsdaemon_tmp_t:file read_file_perms;
 ')
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate 
-##	an smartmon environment
+##	All of the rules required to
+##	administrate an smartmon environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -38,10 +39,10 @@
 interface(`smartmon_admin',`
 	gen_require(`
 		type fsdaemon_t, fsdaemon_tmp_t, fsdaemon_var_run_t;
-		type fsdaemon_initrc_exec_t;
+		type fsdaemon_var_lib_t, fsdaemon_initrc_exec_t;
 	')
 
-	allow $1 fsdaemon_t:process { ptrace signal_perms getattr };
+	allow $1 fsdaemon_t:process { ptrace signal_perms };
 	ps_process_pattern($1, fsdaemon_t)
 
 	init_labeled_script_domtrans($1, fsdaemon_initrc_exec_t)
@@ -54,4 +55,7 @@
 
 	files_list_pids($1)
 	admin_pattern($1, fsdaemon_var_run_t)
+
+	files_list_var_lib($1)
+	admin_pattern($1, fsdaemon_var_lib_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/smartmon.te refpolicy/policy/modules/contrib/smartmon.te
--- refpolicy/policy/modules/contrib/smartmon.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/smartmon.te	2012-10-31 19:03:35.035580277 +0100
@@ -1,4 +1,4 @@
-policy_module(smartmon, 1.11.0)
+policy_module(smartmon, 1.11.3)
 
 ########################################
 #
@@ -6,10 +6,10 @@
 #
 
 ## <desc>
-## <p>
-## Enable additional permissions needed to support
-## devices on 3ware controllers.
-## </p>
+##	<p>
+##	Determine whether smartmon can support
+##	devices on 3ware controllers.
+##	</p>
 ## </desc>
 gen_tunable(smartmon_3ware, false)
 
@@ -23,6 +23,9 @@
 type fsdaemon_var_run_t;
 files_pid_file(fsdaemon_var_run_t)
 
+type fsdaemon_var_lib_t;
+files_type(fsdaemon_var_lib_t)
+
 type fsdaemon_tmp_t;
 files_tmp_file(fsdaemon_tmp_t)
 
@@ -35,14 +38,11 @@
 # Local policy
 #
 
-allow fsdaemon_t self:capability { setpcap setgid sys_rawio sys_admin };
+allow fsdaemon_t self:capability { dac_override kill setpcap setgid sys_rawio sys_admin };
 dontaudit fsdaemon_t self:capability sys_tty_config;
 allow fsdaemon_t self:process { getcap setcap signal_perms };
 allow fsdaemon_t self:fifo_file rw_fifo_file_perms;
-allow fsdaemon_t self:unix_dgram_socket create_socket_perms;
-allow fsdaemon_t self:unix_stream_socket create_stream_socket_perms;
-allow fsdaemon_t self:udp_socket create_socket_perms;
-allow fsdaemon_t self:netlink_route_socket r_netlink_socket_perms;
+allow fsdaemon_t self:unix_stream_socket { accept listen };
 
 manage_dirs_pattern(fsdaemon_t, fsdaemon_tmp_t, fsdaemon_tmp_t)
 manage_files_pattern(fsdaemon_t, fsdaemon_tmp_t, fsdaemon_tmp_t)
@@ -51,41 +51,42 @@
 manage_files_pattern(fsdaemon_t, fsdaemon_var_run_t, fsdaemon_var_run_t)
 files_pid_filetrans(fsdaemon_t, fsdaemon_var_run_t, file)
 
+manage_files_pattern(fsdaemon_t, fsdaemon_var_lib_t, fsdaemon_var_lib_t)
+
 kernel_read_kernel_sysctls(fsdaemon_t)
+kernel_read_network_state(fsdaemon_t)
 kernel_read_software_raid_state(fsdaemon_t)
 kernel_read_system_state(fsdaemon_t)
 
 corecmd_exec_all_executables(fsdaemon_t)
 
-corenet_all_recvfrom_unlabeled(fsdaemon_t)
-corenet_all_recvfrom_netlabel(fsdaemon_t)
-corenet_udp_sendrecv_generic_if(fsdaemon_t)
-corenet_udp_sendrecv_generic_node(fsdaemon_t)
-corenet_udp_sendrecv_all_ports(fsdaemon_t)
-
 dev_read_sysfs(fsdaemon_t)
 dev_read_urand(fsdaemon_t)
 
 domain_use_interactive_fds(fsdaemon_t)
 
 files_exec_etc_files(fsdaemon_t)
+files_read_etc_files(fsdaemon_t)
 files_read_etc_runtime_files(fsdaemon_t)
 files_read_usr_files(fsdaemon_t)
-# for config
-files_read_etc_files(fsdaemon_t)
 
 fs_getattr_all_fs(fsdaemon_t)
 fs_search_auto_mountpoints(fsdaemon_t)
 
 mls_file_read_all_levels(fsdaemon_t)
-#mls_rangetrans_target(fsdaemon_t)
 
 storage_raw_read_fixed_disk(fsdaemon_t)
 storage_raw_write_fixed_disk(fsdaemon_t)
 storage_raw_read_removable_device(fsdaemon_t)
+storage_read_scsi_generic(fsdaemon_t)
+storage_write_scsi_generic(fsdaemon_t)
 
 term_dontaudit_search_ptys(fsdaemon_t)
 
+application_signull(fsdaemon_t)
+
+init_read_utmp(fsdaemon_t)
+
 libs_exec_ld_so(fsdaemon_t)
 libs_exec_lib_files(fsdaemon_t)
 
@@ -93,8 +94,6 @@
 
 miscfiles_read_localization(fsdaemon_t)
 
-seutil_sigchld_newrole(fsdaemon_t)
-
 sysnet_dns_name_resolve(fsdaemon_t)
 
 userdom_dontaudit_use_unpriv_user_fds(fsdaemon_t)
@@ -117,5 +116,9 @@
 ')
 
 optional_policy(`
+	seutil_sigchld_newrole(fsdaemon_t)
+')
+
+optional_policy(`
 	udev_read_db(fsdaemon_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/smokeping.fc refpolicy/policy/modules/contrib/smokeping.fc
--- refpolicy/policy/modules/contrib/smokeping.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/smokeping.fc	2012-10-28 18:58:48.102026416 +0100
@@ -1,9 +1,9 @@
 /etc/rc\.d/init\.d/smokeping	--	gen_context(system_u:object_r:smokeping_initrc_exec_t,s0)
 
-/usr/sbin/smokeping		--	gen_context(system_u:object_r:smokeping_exec_t,s0)
+/usr/sbin/smokeping	--	gen_context(system_u:object_r:smokeping_exec_t,s0)
 
-/usr/share/smokeping/cgi(/.*)?		gen_context(system_u:object_r:httpd_smokeping_cgi_script_exec_t,s0)
+/usr/share/smokeping/cgi(/.*)?	gen_context(system_u:object_r:httpd_smokeping_cgi_script_exec_t,s0)
 
-/var/lib/smokeping(/.*)?		gen_context(system_u:object_r:smokeping_var_lib_t,s0)
+/var/lib/smokeping(/.*)?	gen_context(system_u:object_r:smokeping_var_lib_t,s0)
 
-/var/run/smokeping(/.*)?		gen_context(system_u:object_r:smokeping_var_run_t,s0)
+/var/run/smokeping(/.*)?	gen_context(system_u:object_r:smokeping_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/smokeping.if refpolicy/policy/modules/contrib/smokeping.if
--- refpolicy/policy/modules/contrib/smokeping.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/smokeping.if	2012-10-28 18:58:49.871026420 +0100
@@ -15,12 +15,14 @@
 		type smokeping_t, smokeping_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, smokeping_exec_t, smokeping_t)
 ')
 
 ########################################
 ## <summary>
-##	Execute smokeping server in the smokeping domain.
+##	Execute smokeping init scripts in
+##	the initrc domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -38,7 +40,7 @@
 
 ########################################
 ## <summary>
-##	Read smokeping PID files.
+##	Read smokeping pid files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -57,7 +59,8 @@
 
 ########################################
 ## <summary>
-##	Manage smokeping PID files.
+##	Create, read, write, and delete
+##	smokeping pid files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -89,8 +92,8 @@
 		type smokeping_var_lib_t;
 	')
 
-	getattr_files_pattern($1, smokeping_var_lib_t, smokeping_var_lib_t)
 	files_search_var_lib($1)
+	getattr_files_pattern($1, smokeping_var_lib_t, smokeping_var_lib_t)
 ')
 
 ########################################
@@ -114,7 +117,8 @@
 
 ########################################
 ## <summary>
-##	Manage smokeping lib files.
+##	Create, read, write, and delete
+##	smokeping lib files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -133,8 +137,8 @@
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate
-##	a smokeping environment
+##	All of the rules required to
+##	administrate a smokeping environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -150,7 +154,8 @@
 #
 interface(`smokeping_admin',`
 	gen_require(`
-		type smokeping_t, smokeping_initrc_exec_t;
+		type smokeping_t, smokeping_initrc_exec_t, smokeping_var_lib_t;
+		type smokeping_var_run_t;
 	')
 
 	allow $1 smokeping_t:process { ptrace signal_perms };
@@ -161,7 +166,9 @@
 	role_transition $2 smokeping_initrc_exec_t system_r;
 	allow $2 system_r;
 
-	smokeping_manage_pid_files($1)
+	files_search_var_lib($1)
+	admin_pattern($1, smokeping_var_lib_t)
 
-	smokeping_manage_lib_files($1)
+	files_search_pids($1)
+	admin_pattern($1, smokeping_var_run_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/smokeping.te refpolicy/policy/modules/contrib/smokeping.te
--- refpolicy/policy/modules/contrib/smokeping.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/smokeping.te	2012-10-28 18:58:49.872026420 +0100
@@ -1,4 +1,4 @@
-policy_module(smokeping, 1.1.0)
+policy_module(smokeping, 1.1.2)
 
 ########################################
 #
@@ -20,13 +20,12 @@
 
 ########################################
 #
-# smokeping local policy
+# Local policy
 #
 
 dontaudit smokeping_t self:capability { dac_read_search dac_override };
 allow smokeping_t self:fifo_file rw_fifo_file_perms;
-allow smokeping_t self:udp_socket create_socket_perms;
-allow smokeping_t self:unix_stream_socket create_stream_socket_perms;
+allow smokeping_t self:unix_stream_socket { accept listen };
 
 manage_dirs_pattern(smokeping_t, smokeping_var_run_t, smokeping_var_run_t)
 manage_files_pattern(smokeping_t, smokeping_var_run_t, smokeping_var_run_t)
@@ -34,13 +33,12 @@
 
 manage_dirs_pattern(smokeping_t, smokeping_var_lib_t, smokeping_var_lib_t)
 manage_files_pattern(smokeping_t, smokeping_var_lib_t, smokeping_var_lib_t)
-files_var_lib_filetrans(smokeping_t, smokeping_var_lib_t, { file dir } )
+files_var_lib_filetrans(smokeping_t, smokeping_var_lib_t, { file dir })
 
-corecmd_read_bin_symlinks(smokeping_t)
+corecmd_exec_bin(smokeping_t)
 
 dev_read_urand(smokeping_t)
 
-files_read_etc_files(smokeping_t)
 files_read_usr_files(smokeping_t)
 files_search_tmp(smokeping_t)
 
@@ -57,21 +55,22 @@
 
 #######################################
 #
-# local policy for smokeping cgi scripts
+# Cgi local policy
 #
 
 optional_policy(`
 	apache_content_template(smokeping_cgi)
 
-	allow httpd_smokeping_cgi_script_t self:udp_socket create_socket_perms;
-
 	manage_dirs_pattern(httpd_smokeping_cgi_script_t, smokeping_var_lib_t, smokeping_var_lib_t)
 	manage_files_pattern(httpd_smokeping_cgi_script_t, smokeping_var_lib_t, smokeping_var_lib_t)
 
 	getattr_files_pattern(httpd_smokeping_cgi_script_t, smokeping_var_run_t, smokeping_var_run_t)
 
+	files_read_etc_files(httpd_smokeping_cgi_script_t)
 	files_search_tmp(httpd_smokeping_cgi_script_t)
 	files_search_var_lib(httpd_smokeping_cgi_script_t)
 
 	sysnet_dns_name_resolve(httpd_smokeping_cgi_script_t)
+
+	netutils_domtrans_ping(httpd_smokeping_cgi_script_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/smoltclient.fc refpolicy/policy/modules/contrib/smoltclient.fc
--- refpolicy/policy/modules/contrib/smoltclient.fc	2012-05-04 15:16:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/smoltclient.fc	2012-10-28 18:58:52.014026425 +0100
@@ -1,2 +1 @@
-/usr/share/smolt/client/sendProfile.py	--	gen_context(system_u:object_r:smoltclient_exec_t,s0)	
-
+/usr/share/smolt/client/sendProfile.py	--	gen_context(system_u:object_r:smoltclient_exec_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/smoltclient.if refpolicy/policy/modules/contrib/smoltclient.if
--- refpolicy/policy/modules/contrib/smoltclient.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/smoltclient.if	2012-10-28 18:58:53.100026427 +0100
@@ -1 +1 @@
-## <summary>The Fedora hardware profiler client</summary>
+## <summary>The Fedora hardware profiler client.</summary>
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/smoltclient.te refpolicy/policy/modules/contrib/smoltclient.te
--- refpolicy/policy/modules/contrib/smoltclient.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/smoltclient.te	2012-10-28 18:58:53.101026427 +0100
@@ -1,4 +1,4 @@
-policy_module(smoltclient, 1.1.0)
+policy_module(smoltclient, 1.1.1)
 
 ########################################
 #
@@ -8,7 +8,6 @@
 type smoltclient_t;
 type smoltclient_exec_t;
 application_domain(smoltclient_t, smoltclient_exec_t)
-cron_system_entry(smoltclient_t, smoltclient_exec_t)
 
 type smoltclient_tmp_t;
 files_tmp_file(smoltclient_tmp_t)
@@ -19,16 +18,14 @@
 #
 
 allow smoltclient_t self:process { setsched getsched };
-
 allow smoltclient_t self:fifo_file rw_fifo_file_perms;
-allow smoltclient_t self:tcp_socket create_socket_perms;
-allow smoltclient_t self:udp_socket create_socket_perms;
 
-can_exec(smoltclient_t, smoltclient_tmp_t)
 manage_dirs_pattern(smoltclient_t, smoltclient_tmp_t, smoltclient_tmp_t)
 manage_files_pattern(smoltclient_t, smoltclient_tmp_t, smoltclient_tmp_t)
 files_tmp_filetrans(smoltclient_t, smoltclient_tmp_t, { dir file })
 
+can_exec(smoltclient_t, smoltclient_tmp_t)
+
 kernel_read_system_state(smoltclient_t)
 kernel_read_network_state(smoltclient_t)
 kernel_read_kernel_sysctls(smoltclient_t)
@@ -36,30 +33,47 @@
 corecmd_exec_bin(smoltclient_t)
 corecmd_exec_shell(smoltclient_t)
 
+corenet_all_recvfrom_unlabeled(smoltclient_t)
+corenet_all_recvfrom_netlabel(smoltclient_t)
+corenet_tcp_sendrecv_generic_if(smoltclient_t)
+corenet_tcp_sendrecv_generic_node(smoltclient_t)
+
+corenet_sendrecv_http_client_packets(smoltclient_t)
 corenet_tcp_connect_http_port(smoltclient_t)
+corenet_tcp_sendrecv_http_port(smoltclient_t)
 
 dev_read_sysfs(smoltclient_t)
+dev_read_urand(smoltclient_t)
 
 fs_getattr_all_fs(smoltclient_t)
 fs_getattr_all_dirs(smoltclient_t)
 fs_list_auto_mountpoints(smoltclient_t)
 
 files_getattr_generic_locks(smoltclient_t)
-files_read_etc_files(smoltclient_t)
+files_read_etc_runtime_files(smoltclient_t)
 files_read_usr_files(smoltclient_t)
 
 auth_use_nsswitch(smoltclient_t)
 
 logging_send_syslog_msg(smoltclient_t)
 
+miscfiles_read_hwdata(smoltclient_t)
 miscfiles_read_localization(smoltclient_t)
 
 optional_policy(`
-	dbus_system_bus_client(smoltclient_t)
+	abrt_stream_connect(smoltclient_t)
 ')
 
 optional_policy(`
-	hal_dbus_chat(smoltclient_t)
+	cron_system_entry(smoltclient_t, smoltclient_exec_t)
+')
+
+optional_policy(`
+	dbus_system_bus_client(smoltclient_t)
+
+	optional_policy(`
+		hal_dbus_chat(smoltclient_t)
+	')
 ')
 
 optional_policy(`
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/smstools.fc refpolicy/policy/modules/contrib/smstools.fc
--- refpolicy/policy/modules/contrib/smstools.fc	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/smstools.fc	2012-11-06 21:18:16.953011527 +0100
@@ -0,0 +1,13 @@
+/etc/smsd\.conf	--	gen_context(system_u:object_r:smsd_conf_t,s0)
+
+/etc/rc\.d/init\.d/((smsd)|(smstools))	--	gen_context(system_u:object_r:smsd_initrc_exec_t,s0)
+
+/usr/sbin/smsd	--	gen_context(system_u:object_r:smsd_exec_t,s0)
+
+/var/lib/smstools(/.*)?	gen_context(system_u:object_r:smsd_var_lib_t,s0)
+
+/var/log/smsd(/.*)?	gen_context(system_u:object_r:smsd_log_t,s0)
+
+/var/run/smsd(/.*)?	gen_context(system_u:object_r:smsd_var_run_t,s0)
+
+/var/spool/sms(/.*)?	gen_context(system_u:object_r:smsd_spool_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/smstools.if refpolicy/policy/modules/contrib/smstools.if
--- refpolicy/policy/modules/contrib/smstools.if	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/smstools.if	2012-11-06 21:18:16.953011527 +0100
@@ -0,0 +1,49 @@
+## <summary> Tools to send and receive short messages through GSM modems or mobile phones.</summary>
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an smstools environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`smstools_admin',`
+	gen_require(`
+		type smsd_t, smsd_initrc_exec_t, smsd_conf_t;
+		type smsd_log_t, smsd_var_lib_t, smsd_var_run_t;
+		type smsd_spool_t;
+	')
+
+	allow $1 smsd_t:process { ptrace signal_perms };
+	ps_process_pattern($1, smsd_t)
+
+	init_labeled_script_domtrans($1, smsd_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 smsd_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	files_search_config($1)
+	admin_pattern($1, smsd_conf_t)
+
+	files_search_var_lib($1)
+	admin_pattern($1, smsd_var_lib_t)
+
+	files_search_spool($1)
+	admin_pattern($1, smsd_spool_t)
+
+	files_search_pids($1)
+	admin_pattern($1, smsd_var_run_t)
+
+	logging_search_logs($1)
+	admin_pattern($1, smsd_log_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/smstools.te refpolicy/policy/modules/contrib/smstools.te
--- refpolicy/policy/modules/contrib/smstools.te	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/smstools.te	2012-11-06 21:18:16.953011527 +0100
@@ -0,0 +1,74 @@
+policy_module(smstools, 1.0.0)
+
+########################################
+#
+# Declarations
+#
+
+type smsd_t;
+type smsd_exec_t;
+init_daemon_domain(smsd_t, smsd_exec_t)
+
+type smsd_initrc_exec_t;
+init_script_file(smsd_initrc_exec_t)
+
+type smsd_conf_t;
+files_config_file(smsd_conf_t)
+
+type smsd_log_t;
+logging_log_file(smsd_log_t)
+
+type smsd_var_lib_t;
+files_type(smsd_var_lib_t)
+
+type smsd_var_run_t;
+files_pid_file(smsd_var_run_t)
+
+type smsd_spool_t;
+files_type(smsd_spool_t)
+
+########################################
+#
+# Local policy
+#
+
+allow smsd_t self:capability { kill setgid setuid };
+allow smsd_t self:process signal;
+allow smsd_t self:fifo_file rw_fifo_file_perms;
+allow smsd_t self:unix_stream_socket { accept listen };
+
+allow smsd_t smsd_conf_t:file read_file_perms;
+
+manage_dirs_pattern(smsd_t, smsd_log_t, smsd_log_t)
+create_files_pattern(smsd_t, smsd_log_t, smsd_log_t)
+append_files_pattern(smsd_t, smsd_log_t, smsd_log_t)
+setattr_files_pattern(smsd_t, smsd_log_t, smsd_log_t)
+manage_lnk_files_pattern(smsd_t, smsd_log_t, smsd_log_t)
+logging_log_filetrans(smsd_t, smsd_log_t, { dir file })
+
+manage_dirs_pattern(smsd_t, smsd_var_lib_t, smsd_var_lib_t)
+manage_files_pattern(smsd_t, smsd_var_lib_t, smsd_var_lib_t)
+manage_lnk_files_pattern(smsd_t, smsd_var_lib_t, smsd_var_lib_t)
+
+manage_dirs_pattern(smsd_t, smsd_var_run_t, smsd_var_run_t)
+manage_files_pattern(smsd_t, smsd_var_run_t, smsd_var_run_t)
+manage_lnk_files_pattern(smsd_t, smsd_var_run_t, smsd_var_run_t)
+files_pid_filetrans(smsd_t, smsd_var_run_t, { dir file })
+
+manage_dirs_pattern(smsd_t, smsd_spool_t, smsd_spool_t)
+manage_files_pattern(smsd_t, smsd_spool_t, smsd_spool_t)
+manage_lnk_files_pattern(smsd_t, smsd_spool_t, smsd_spool_t)
+files_spool_filetrans(smsd_t, smsd_spool_t, dir)
+
+kernel_read_kernel_sysctls(smsd_t)
+kernel_read_system_state(smsd_t)
+
+corecmd_exec_shell(smsd_t)
+
+auth_use_nsswitch(smsd_t)
+
+logging_send_syslog_msg(smsd_t)
+
+optional_policy(`
+	mysql_stream_connect(smsd_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/snmp.fc refpolicy/policy/modules/contrib/snmp.fc
--- refpolicy/policy/modules/contrib/snmp.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/snmp.fc	2012-10-28 18:58:56.096026433 +0100
@@ -1,24 +1,18 @@
-/etc/rc\.d/init\.d/snmpd --	gen_context(system_u:object_r:snmpd_initrc_exec_t,s0)
-/etc/rc\.d/init\.d/snmptrapd --	gen_context(system_u:object_r:snmpd_initrc_exec_t,s0)
+/etc/rc\.d/init\.d/((snmpd)|(snmptrapd))	--	gen_context(system_u:object_r:snmpd_initrc_exec_t,s0)
 
-#
-# /usr
-#
-/usr/sbin/snmp(trap)?d	--	gen_context(system_u:object_r:snmpd_exec_t,s0)
+/usr/sbin/snmptrap	--	gen_context(system_u:object_r:snmpd_exec_t,s0)
+/usr/sbin/snmptrapd	--	gen_context(system_u:object_r:snmpd_exec_t,s0)
 
-/usr/share/snmp/mibs/\.index -- gen_context(system_u:object_r:snmpd_var_lib_t,s0)
+/usr/share/snmp/mibs/\.index	--	gen_context(system_u:object_r:snmpd_var_lib_t,s0)
 
-#
-# /var
-#
-/var/agentx(/.*)?		gen_context(system_u:object_r:snmpd_var_lib_t,s0)
+/var/agentx(/.*)?	gen_context(system_u:object_r:snmpd_var_lib_t,s0)
+/var/net-snmp(/.*)	gen_context(system_u:object_r:snmpd_var_lib_t,s0)
 
-/var/lib/net-snmp(/.*)?		gen_context(system_u:object_r:snmpd_var_lib_t,s0)
-/var/lib/snmp(/.*)?		gen_context(system_u:object_r:snmpd_var_lib_t,s0)
+/var/lib/net-snmp(/.*)?	gen_context(system_u:object_r:snmpd_var_lib_t,s0)
+/var/lib/snmp(/.*)?	gen_context(system_u:object_r:snmpd_var_lib_t,s0)
 
-/var/log/snmpd\.log	--	gen_context(system_u:object_r:snmpd_log_t,s0)
+/var/log/snmpd\.log.*	--	gen_context(system_u:object_r:snmpd_log_t,s0)
 
-/var/net-snmp(/.*)		gen_context(system_u:object_r:snmpd_var_lib_t,s0)
-
-/var/run/snmpd(/.*)?		gen_context(system_u:object_r:snmpd_var_run_t,s0)
+/var/run/net-snmpd(/.*)?	gen_context(system_u:object_r:snmpd_var_run_t,s0)
+/var/run/snmpd(/.*)?	gen_context(system_u:object_r:snmpd_var_run_t,s0)
 /var/run/snmpd\.pid	--	gen_context(system_u:object_r:snmpd_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/snmp.if refpolicy/policy/modules/contrib/snmp.if
--- refpolicy/policy/modules/contrib/snmp.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/snmp.if	2012-10-28 18:58:56.096026433 +0100
@@ -1,8 +1,9 @@
-## <summary>Simple network management protocol services</summary>
+## <summary>Simple network management protocol services.</summary>
 
 ########################################
 ## <summary>
-##	Connect to snmpd using a unix domain stream socket.
+##	Connect to snmpd with a unix
+##	domain stream socket.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -11,17 +12,17 @@
 ## </param>
 #
 interface(`snmp_stream_connect',`
-	 gen_require(`
+	gen_require(`
 		type snmpd_t, snmpd_var_lib_t;
-	 ')
+	')
 
-	 files_search_var_lib($1)
-	 stream_connect_pattern($1, snmpd_var_lib_t, snmpd_var_lib_t, snmpd_t)
+	files_search_var_lib($1)
+	stream_connect_pattern($1, snmpd_var_lib_t, snmpd_var_lib_t, snmpd_t)
 ')
 
 ########################################
 ## <summary>
-##	Use snmp over a TCP connection.  (Deprecated)
+##	Connect to snmp over the TCP network.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -30,7 +31,14 @@
 ## </param>
 #
 interface(`snmp_tcp_connect',`
-	refpolicywarn(`$0($*) has been deprecated.')
+	gen_require(`
+		type snmpd_t;
+	')
+
+	corenet_tcp_recvfrom_labeled($1, snmpd_t)
+	corenet_tcp_sendrecv_snmp_port($1)
+	corenet_tcp_connect_snmp_port($1)
+	corenet_sendrecv_snmp_client_packets($1)
 ')
 
 ########################################
@@ -49,7 +57,48 @@
 
 ########################################
 ## <summary>
-##	Read snmpd libraries.
+##	Create, read, write, and delete
+##	snmp lib directories.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`snmp_manage_var_lib_dirs',`
+	gen_require(`
+		type snmpd_var_lib_t;
+	')
+
+	files_search_var_lib($1)
+	allow $1 snmpd_var_lib_t:dir manage_dir_perms;
+')
+
+########################################
+## <summary>
+##	Create, read, write, and delete
+##	snmp lib files.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`snmp_manage_var_lib_files',`
+	gen_require(`
+		type snmpd_var_lib_t;
+	')
+
+	files_search_var_lib($1)
+	allow $1 snmpd_var_lib_t:dir list_dir_perms;
+	manage_files_pattern($1, snmpd_var_lib_t, snmpd_var_lib_t)
+')
+
+########################################
+## <summary>
+##	Read snmpd lib content.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -69,7 +118,8 @@
 
 ########################################
 ## <summary>
-##	dontaudit Read snmpd libraries.
+##	Do not audit attempts to read
+##	snmpd lib content.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -81,14 +131,16 @@
 	gen_require(`
 		type snmpd_var_lib_t;
 	')
+
 	dontaudit $1 snmpd_var_lib_t:dir list_dir_perms;
 	dontaudit $1 snmpd_var_lib_t:file read_file_perms;
-	dontaudit $1 snmpd_var_lib_t:lnk_file { getattr read };
+	dontaudit $1 snmpd_var_lib_t:lnk_file read_lnk_file_perms;
 ')
 
 ########################################
 ## <summary>
-##	dontaudit write snmpd libraries files.
+##	Do not audit attempts to write
+##	snmpd lib files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -106,8 +158,8 @@
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate
-##	an snmp environment
+##	All of the rules required to
+##	administrate an snmp environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -116,19 +168,18 @@
 ## </param>
 ## <param name="role">
 ##	<summary>
-##	The role to be allowed to manage the snmp domain.
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <rolecap/>
 #
 interface(`snmp_admin',`
 	gen_require(`
-		type snmpd_t, snmpd_log_t;
+		type snmpd_t, snmpd_log_t, snmpd_initrc_exec_t;
 		type snmpd_var_lib_t, snmpd_var_run_t;
-		type snmpd_initrc_exec_t;
 	')
 
-	allow $1 snmpd_t:process { ptrace signal_perms getattr };
+	allow $1 snmpd_t:process { ptrace signal_perms };
 	ps_process_pattern($1, snmpd_t)
 
 	init_labeled_script_domtrans($1, snmpd_initrc_exec_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/snmp.te refpolicy/policy/modules/contrib/snmp.te
--- refpolicy/policy/modules/contrib/snmp.te	2012-07-25 20:33:05.000000000 +0200
+++ refpolicy/policy/modules/contrib/snmp.te	2012-10-28 18:58:56.097026433 +0100
@@ -1,9 +1,10 @@
-policy_module(snmp, 1.13.0)
+policy_module(snmp, 1.13.3)
 
 ########################################
 #
 # Declarations
 #
+
 type snmpd_t;
 type snmpd_exec_t;
 init_daemon_domain(snmpd_t, snmpd_exec_t)
@@ -24,16 +25,16 @@
 #
 # Local policy
 #
-allow snmpd_t self:capability { chown dac_override kill ipc_lock sys_ptrace net_admin sys_nice sys_tty_config };
+
+allow snmpd_t self:capability { chown dac_override kill ipc_lock setgid setuid net_admin sys_nice sys_tty_config sys_ptrace };
 dontaudit snmpd_t self:capability { sys_module sys_tty_config };
 allow snmpd_t self:process { signal_perms getsched setsched };
 allow snmpd_t self:fifo_file rw_fifo_file_perms;
-allow snmpd_t self:unix_dgram_socket create_socket_perms;
-allow snmpd_t self:unix_stream_socket create_stream_socket_perms;
-allow snmpd_t self:tcp_socket create_stream_socket_perms;
+allow snmpd_t self:unix_stream_socket { accept connectto listen };
+allow snmpd_t self:tcp_socket { accept listen };
 allow snmpd_t self:udp_socket connected_stream_socket_perms;
 
-allow snmpd_t snmpd_log_t:file manage_file_perms;
+allow snmpd_t snmpd_log_t:file { append_file_perms create_file_perms setattr_file_perms };
 logging_log_filetrans(snmpd_t, snmpd_log_t, file)
 
 manage_dirs_pattern(snmpd_t, snmpd_var_lib_t, snmpd_var_lib_t)
@@ -41,18 +42,18 @@
 manage_sock_files_pattern(snmpd_t, snmpd_var_lib_t, snmpd_var_lib_t)
 files_usr_filetrans(snmpd_t, snmpd_var_lib_t, file)
 files_var_filetrans(snmpd_t, snmpd_var_lib_t, { file dir sock_file })
-files_var_lib_filetrans(snmpd_t, snmpd_var_lib_t, file)
+files_var_lib_filetrans(snmpd_t, snmpd_var_lib_t, { dir file })
 
+manage_dirs_pattern(snmpd_t, snmpd_var_run_t, snmpd_var_run_t)
 manage_files_pattern(snmpd_t, snmpd_var_run_t, snmpd_var_run_t)
-files_pid_filetrans(snmpd_t, snmpd_var_run_t, file)
+files_pid_filetrans(snmpd_t, snmpd_var_run_t, { file dir })
 
 kernel_read_device_sysctls(snmpd_t)
 kernel_read_kernel_sysctls(snmpd_t)
 kernel_read_fs_sysctls(snmpd_t)
 kernel_read_net_sysctls(snmpd_t)
-kernel_read_proc_symlinks(snmpd_t)
-kernel_read_system_state(snmpd_t)
 kernel_read_network_state(snmpd_t)
+kernel_read_system_state(snmpd_t)
 
 corecmd_exec_bin(snmpd_t)
 corecmd_exec_shell(snmpd_t)
@@ -63,16 +64,22 @@
 corenet_udp_sendrecv_generic_if(snmpd_t)
 corenet_tcp_sendrecv_generic_node(snmpd_t)
 corenet_udp_sendrecv_generic_node(snmpd_t)
-corenet_tcp_sendrecv_all_ports(snmpd_t)
-corenet_udp_sendrecv_all_ports(snmpd_t)
 corenet_tcp_bind_generic_node(snmpd_t)
 corenet_udp_bind_generic_node(snmpd_t)
+
+corenet_sendrecv_snmp_server_packets(snmpd_t)
 corenet_tcp_bind_snmp_port(snmpd_t)
 corenet_udp_bind_snmp_port(snmpd_t)
-corenet_sendrecv_snmp_server_packets(snmpd_t)
+corenet_tcp_sendrecv_snmp_port(snmpd_t)
+corenet_udp_sendrecv_snmp_port(snmpd_t)
+
+corenet_sendrecv_snmp_client_packets(snmpd_t)
 corenet_tcp_connect_agentx_port(snmpd_t)
+corenet_sendrecv_snmp_server_packets(snmpd_t)
 corenet_tcp_bind_agentx_port(snmpd_t)
 corenet_udp_bind_agentx_port(snmpd_t)
+corenet_tcp_sendrecv_agentx_port(snmpd_t)
+corenet_udp_sendrecv_agentx_port(snmpd_t)
 
 dev_list_sysfs(snmpd_t)
 dev_read_sysfs(snmpd_t)
@@ -83,23 +90,23 @@
 domain_use_interactive_fds(snmpd_t)
 domain_signull_all_domains(snmpd_t)
 domain_read_all_domains_state(snmpd_t)
-domain_dontaudit_ptrace_all_domains(snmpd_t)
 domain_exec_all_entry_files(snmpd_t)
 
-files_read_etc_files(snmpd_t)
 files_read_usr_files(snmpd_t)
 files_read_etc_runtime_files(snmpd_t)
 files_search_home(snmpd_t)
 
 fs_getattr_all_dirs(snmpd_t)
 fs_getattr_all_fs(snmpd_t)
+files_list_all(snmpd_t)
+files_search_all_mountpoints(snmpd_t)
 fs_search_auto_mountpoints(snmpd_t)
 
 storage_dontaudit_read_fixed_disk(snmpd_t)
 storage_dontaudit_read_removable_device(snmpd_t)
+storage_dontaudit_write_removable_device(snmpd_t)
 
 auth_use_nsswitch(snmpd_t)
-files_list_non_auth_dirs(snmpd_t)
 
 init_read_utmp(snmpd_t)
 init_dontaudit_write_utmp(snmpd_t)
@@ -110,18 +117,9 @@
 
 seutil_dontaudit_search_config(snmpd_t)
 
-sysnet_read_config(snmpd_t)
-
 userdom_dontaudit_use_unpriv_user_fds(snmpd_t)
 userdom_dontaudit_search_user_home_dirs(snmpd_t)
 
-ifdef(`distro_redhat', `
-	optional_policy(`
-		rpm_read_db(snmpd_t)
-		rpm_dontaudit_manage_db(snmpd_t)
-	')
-')
-
 optional_policy(`
 	amanda_dontaudit_read_dumpdates(snmpd_t)
 ')
@@ -131,6 +129,10 @@
 ')
 
 optional_policy(`
+	corosync_stream_connect(snmpd_t)
+')
+
+optional_policy(`
 	cups_read_rw_config(snmpd_t)
 ')
 
@@ -140,10 +142,19 @@
 ')
 
 optional_policy(`
+	ricci_stream_connect_modclusterd(snmpd_t)
+')
+
+optional_policy(`
 	rpc_search_nfs_state_data(snmpd_t)
 ')
 
 optional_policy(`
+	rpm_read_db(snmpd_t)
+	rpm_dontaudit_manage_db(snmpd_t)
+')
+
+optional_policy(`
 	sendmail_read_log(snmpd_t)
 ')
 
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/snort.fc refpolicy/policy/modules/contrib/snort.fc
--- refpolicy/policy/modules/contrib/snort.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/snort.fc	2012-10-28 18:58:59.430026440 +0100
@@ -1,9 +1,12 @@
-/etc/rc\.d/init\.d/snortd --	gen_context(system_u:object_r:snort_initrc_exec_t,s0)
-/etc/snort(/.*)?		gen_context(system_u:object_r:snort_etc_t,s0)
+/etc/rc\.d/init\.d/snortd	--	gen_context(system_u:object_r:snort_initrc_exec_t,s0)
 
-/usr/s?bin/snort	--	gen_context(system_u:object_r:snort_exec_t,s0)
+/etc/snort(/.*)?	gen_context(system_u:object_r:snort_etc_t,s0)
+
+/usr/bin/snort	--	gen_context(system_u:object_r:snort_exec_t,s0)
+
+/usr/sbin/snort	--	gen_context(system_u:object_r:snort_exec_t,s0)
 /usr/sbin/snort-plain	--	gen_context(system_u:object_r:snort_exec_t,s0)
 
-/var/log/snort(/.*)?		gen_context(system_u:object_r:snort_log_t,s0)
+/var/log/snort(/.*)?	gen_context(system_u:object_r:snort_log_t,s0)
 
 /var/run/snort.*	--	gen_context(system_u:object_r:snort_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/snort.if refpolicy/policy/modules/contrib/snort.if
--- refpolicy/policy/modules/contrib/snort.if	2012-05-04 15:16:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/snort.if	2012-10-28 18:58:59.430026440 +0100
@@ -1,4 +1,4 @@
-## <summary>Snort network intrusion detection system</summary>
+## <summary>Snort network intrusion detection system.</summary>
 
 ########################################
 ## <summary>
@@ -15,13 +15,14 @@
 		type snort_t, snort_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, snort_exec_t, snort_t)
 ')
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate 
-##	an snort environment
+##	All of the rules required to
+##	administrate an snort environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -30,7 +31,7 @@
 ## </param>
 ## <param name="role">
 ##	<summary>
-##	The role to be allowed to manage the snort domain.
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <rolecap/>
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/snort.te refpolicy/policy/modules/contrib/snort.te
--- refpolicy/policy/modules/contrib/snort.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/snort.te	2012-10-28 18:58:59.430026440 +0100
@@ -1,4 +1,4 @@
-policy_module(snort, 1.10.0)
+policy_module(snort, 1.10.1)
 
 ########################################
 #
@@ -32,20 +32,20 @@
 allow snort_t self:capability { setgid setuid net_admin net_raw dac_override };
 dontaudit snort_t self:capability sys_tty_config;
 allow snort_t self:process signal_perms;
-allow snort_t self:netlink_route_socket { bind create getattr nlmsg_read read write };
-allow snort_t self:tcp_socket create_stream_socket_perms;
-allow snort_t self:udp_socket create_socket_perms;
+allow snort_t self:netlink_socket create_socket_perms;
+allow snort_t self:tcp_socket { accept listen };
 allow snort_t self:packet_socket create_socket_perms;
 allow snort_t self:socket create_socket_perms;
-# Snort IPS node. unverified.
-allow snort_t self:netlink_firewall_socket { bind create getattr };
+allow snort_t self:netlink_firewall_socket create_socket_perms;
 
 allow snort_t snort_etc_t:dir list_dir_perms;
 allow snort_t snort_etc_t:file read_file_perms;
-allow snort_t snort_etc_t:lnk_file { getattr read };
+allow snort_t snort_etc_t:lnk_file read_lnk_file_perms;
 
-manage_files_pattern(snort_t, snort_log_t, snort_log_t)
-create_dirs_pattern(snort_t, snort_log_t, snort_log_t)
+manage_dirs_pattern(snort_t, snort_log_t, snort_log_t)
+append_files_pattern(snort_t, snort_log_t, snort_log_t)
+create_files_pattern(snort_t, snort_log_t, snort_log_t)
+setattr_files_pattern(snort_t, snort_log_t, snort_log_t)
 logging_log_filetrans(snort_t, snort_log_t, { file dir })
 
 manage_dirs_pattern(snort_t, snort_tmp_t, snort_tmp_t)
@@ -73,14 +73,15 @@
 corenet_raw_sendrecv_generic_node(snort_t)
 corenet_tcp_sendrecv_all_ports(snort_t)
 corenet_udp_sendrecv_all_ports(snort_t)
+
+corenet_sendrecv_prelude_client_packets(snort_t)
 corenet_tcp_connect_prelude_port(snort_t)
+corenet_tcp_sendrecv_prelude_port(snort_t)
 
 dev_read_sysfs(snort_t)
 dev_read_rand(snort_t)
 dev_read_urand(snort_t)
 dev_read_usbmon_dev(snort_t)
-# Red Hat bug 559861: Snort wants read, write, and ioctl on /dev/usbmon
-# Snort uses libpcap, which can also monitor USB traffic. Maybe this is a side effect?
 dev_rw_generic_usb_dev(snort_t)
 
 domain_use_interactive_fds(snort_t)
@@ -97,8 +98,6 @@
 
 miscfiles_read_localization(snort_t)
 
-sysnet_read_config(snort_t)
-# snorts must be able to resolve dns in case it wants to relay to a remote prelude-manager
 sysnet_dns_name_resolve(snort_t)
 
 userdom_dontaudit_use_unpriv_user_fds(snort_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/sosreport.fc refpolicy/policy/modules/contrib/sosreport.fc
--- refpolicy/policy/modules/contrib/sosreport.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/sosreport.fc	2012-10-28 18:59:00.808026443 +0100
@@ -1 +1,3 @@
 /usr/sbin/sosreport	--	gen_context(system_u:object_r:sosreport_exec_t,s0)
+
+/\.ismount-test-file	--	gen_context(system_u:object_r:sosreport_tmp_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/sosreport.if refpolicy/policy/modules/contrib/sosreport.if
--- refpolicy/policy/modules/contrib/sosreport.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/sosreport.if	2012-10-28 18:59:00.808026443 +0100
@@ -1,4 +1,4 @@
-## <summary>sosreport - Generate debugging information for system</summary>
+## <summary>Generate debugging information for system.</summary>
 
 ########################################
 ## <summary>
@@ -15,13 +15,15 @@
 		type sosreport_t, sosreport_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, sosreport_exec_t, sosreport_t)
 ')
 
 ########################################
 ## <summary>
-##	Execute sosreport in the sosreport domain, and
-##	allow the specified role the sosreport domain.
+##	Execute sosreport in the sosreport
+##	domain, and allow the specified
+##	role the sosreport domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -36,25 +38,25 @@
 #
 interface(`sosreport_run',`
 	gen_require(`
-		type sosreport_t;
+		attribute_role sosreport_roles;
 	')
 
 	sosreport_domtrans($1)
-	role $2 types sosreport_t;
+	roleattribute $2 sospreport_roles;
 ')
 
 ########################################
 ## <summary>
-##	Role access for sosreport
+##	Role access for sosreport.
 ## </summary>
 ## <param name="role">
 ##	<summary>
-##	Role allowed access
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <param name="domain">
 ##	<summary>
-##	User domain for the role
+##	User domain for the role.
 ##	</summary>
 ## </param>
 #
@@ -63,18 +65,15 @@
 		type sosreport_t;
 	')
 
-	role $1 types sosreport_t;
-
-	sosreport_domtrans($2)
+	sosreport_run($2, $1)
 
+	allow $2 sosreport_t:process { ptrace signal_perms };
 	ps_process_pattern($2, sosreport_t)
-	allow $2 sosreport_t:process signal;
 ')
 
 ########################################
 ## <summary>
-##	Allow the specified domain to read
-##	sosreport tmp files.
+##	Read sosreport temporary files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -93,7 +92,7 @@
 
 ########################################
 ## <summary>
-##	Append sosreport tmp files.
+##	Append sosreport temporary files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -106,12 +105,13 @@
 		type sosreport_tmp_t;
 	')
 
+	files_search_tmp($1)
 	append_files_pattern($1, sosreport_tmp_t, sosreport_tmp_t)
 ')
 
 ########################################
 ## <summary>
-##	Delete sosreport tmp files.
+##	Delete sosreport temporary files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/sosreport.te refpolicy/policy/modules/contrib/sosreport.te
--- refpolicy/policy/modules/contrib/sosreport.te	2012-07-25 20:33:05.000000000 +0200
+++ refpolicy/policy/modules/contrib/sosreport.te	2012-11-02 20:08:32.415957426 +0100
@@ -1,14 +1,17 @@
-policy_module(sosreport, 1.2.0)
+policy_module(sosreport, 1.2.2)
 
 ########################################
 #
 # Declarations
 #
 
+attribute_role sosreport_roles;
+roleattribute system_r sosreport_roles;
+
 type sosreport_t;
 type sosreport_exec_t;
 application_domain(sosreport_t, sosreport_exec_t)
-role system_r types sosreport_t;
+role sosreport_roles types sosreport_t;
 
 type sosreport_tmp_t;
 files_tmp_file(sosreport_tmp_t)
@@ -16,23 +19,25 @@
 type sosreport_tmpfs_t;
 files_tmpfs_file(sosreport_tmpfs_t)
 
+optional_policy(`
+	pulseaudio_tmpfs_content(sosreport_tmpfs_t)
+')
+
 ########################################
 #
-# sosreport local policy
+# Local policy
 #
 
-allow sosreport_t self:capability { kill net_admin net_raw setuid sys_admin sys_nice sys_ptrace dac_override };
+allow sosreport_t self:capability { kill net_admin net_raw setuid sys_admin sys_nice dac_override };
 allow sosreport_t self:process { setsched signull };
 allow sosreport_t self:fifo_file rw_fifo_file_perms;
-allow sosreport_t self:tcp_socket create_stream_socket_perms;
-allow sosreport_t self:udp_socket create_socket_perms;
-allow sosreport_t self:unix_dgram_socket create_socket_perms;
-allow sosreport_t self:netlink_route_socket r_netlink_socket_perms;
-allow sosreport_t self:unix_stream_socket create_stream_socket_perms;
+allow sosreport_t self:tcp_socket { accept listen };
+allow sosreport_t self:unix_stream_socket { accept listen };
 
 manage_dirs_pattern(sosreport_t, sosreport_tmp_t, sosreport_tmp_t)
 manage_files_pattern(sosreport_t, sosreport_tmp_t, sosreport_tmp_t)
 manage_lnk_files_pattern(sosreport_t, sosreport_tmp_t, sosreport_tmp_t)
+files_root_filetrans(sosreport_t, sosreport_tmp_t, file, ".ismount-test-file")
 files_tmp_filetrans(sosreport_t, sosreport_tmp_t, { file dir })
 
 manage_files_pattern(sosreport_t, sosreport_tmpfs_t, sosreport_tmpfs_t)
@@ -58,29 +63,27 @@
 domain_read_all_domains_state(sosreport_t)
 domain_getattr_all_sockets(sosreport_t)
 domain_getattr_all_pipes(sosreport_t)
-domain_signull_all_domains(sosreport_t)
 
 files_getattr_all_sockets(sosreport_t)
 files_exec_etc_files(sosreport_t)
 files_list_all(sosreport_t)
 files_read_config_files(sosreport_t)
-files_read_etc_files(sosreport_t)
 files_read_generic_tmp_files(sosreport_t)
+files_read_non_auth_files(sosreport_t)
 files_read_usr_files(sosreport_t)
 files_read_var_lib_files(sosreport_t)
 files_read_var_symlinks(sosreport_t)
 files_read_kernel_modules(sosreport_t)
 files_read_all_symlinks(sosreport_t)
-# for blkid.tab
 files_manage_etc_runtime_files(sosreport_t)
 files_etc_filetrans_etc_runtime(sosreport_t, file)
 
 fs_getattr_all_fs(sosreport_t)
 fs_list_inotifyfs(sosreport_t)
 
-# some config files do not have configfile attribute
-# sosreport needs to read various files on system
-files_read_non_auth_files(sosreport_t)
+storage_dontaudit_read_fixed_disk(sosreport_t)
+storage_dontaudit_read_removable_device(sosreport_t)
+
 auth_use_nsswitch(sosreport_t)
 
 init_domtrans_script(sosreport_t)
@@ -92,13 +95,11 @@
 
 miscfiles_read_localization(sosreport_t)
 
-# needed by modinfo
 modutils_read_module_deps(sosreport_t)
 
-sysnet_read_config(sosreport_t)
-
 optional_policy(`
 	abrt_manage_pid_files(sosreport_t)
+	abrt_manage_cache(sosreport_t)
 ')
 
 optional_policy(`
@@ -130,7 +131,7 @@
 ')
 
 optional_policy(`
-	pulseaudio_stream_connect(sosreport_t)
+	pulseaudio_run(sosreport_t, sosreport_roles)
 ')
 
 optional_policy(`
@@ -142,7 +143,3 @@
 optional_policy(`
 	xserver_stream_connect(sosreport_t)
 ')
-
-optional_policy(`
-	unconfined_domain(sosreport_t)
-')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/soundserver.fc refpolicy/policy/modules/contrib/soundserver.fc
--- refpolicy/policy/modules/contrib/soundserver.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/soundserver.fc	2012-10-28 18:59:04.813026452 +0100
@@ -1,13 +1,14 @@
-/etc/nas(/.*)?			gen_context(system_u:object_r:soundd_etc_t,s0)
+/etc/nas(/.*)?	gen_context(system_u:object_r:soundd_etc_t,s0)
+/etc/yiff(/.*)?	gen_context(system_u:object_r:soundd_etc_t,s0)
+
 /etc/rc\.d/init\.d/nasd	--	gen_context(system_u:object_r:soundd_initrc_exec_t,s0)
-/etc/yiff(/.*)?			gen_context(system_u:object_r:soundd_etc_t,s0)
 
-/usr/bin/nasd		--	gen_context(system_u:object_r:soundd_exec_t,s0)
-/usr/bin/gpe-soundserver --	gen_context(system_u:object_r:soundd_exec_t,s0)
+/usr/bin/nasd	--	gen_context(system_u:object_r:soundd_exec_t,s0)
+/usr/bin/gpe-soundserver	--	gen_context(system_u:object_r:soundd_exec_t,s0)
 
-/usr/sbin/yiff		--	gen_context(system_u:object_r:soundd_exec_t,s0)
+/usr/sbin/yiff	--	gen_context(system_u:object_r:soundd_exec_t,s0)
 
-/var/run/nasd(/.*)?		gen_context(system_u:object_r:soundd_var_run_t,s0)
-/var/run/yiff-[0-9]+\.pid --	gen_context(system_u:object_r:soundd_var_run_t,s0)
+/var/run/nasd(/.*)?	gen_context(system_u:object_r:soundd_var_run_t,s0)
+/var/run/yiff-[0-9]+\.pid	--	gen_context(system_u:object_r:soundd_var_run_t,s0)
 
-/var/state/yiff(/.*)?		gen_context(system_u:object_r:soundd_state_t,s0)
+/var/state/yiff(/.*)?	gen_context(system_u:object_r:soundd_state_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/soundserver.if refpolicy/policy/modules/contrib/soundserver.if
--- refpolicy/policy/modules/contrib/soundserver.if	2012-05-04 15:16:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/soundserver.if	2012-10-28 18:59:04.813026452 +0100
@@ -16,8 +16,8 @@
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate 
-##	an soundd environment
+##	All of the rules required to
+##	administrate an soundd environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -26,16 +26,16 @@
 ## </param>
 ## <param name="role">
 ##	<summary>
-##	The role to be allowed to manage the soundd domain.
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <rolecap/>
 #
 interface(`soundserver_admin',`
 	gen_require(`
-		type soundd_t, soundd_etc_t;
-		type soundd_tmp_t, soundd_var_run_t;
-		type soundd_initrc_exec_t;
+		type soundd_t, soundd_etc_t, soundd_initrc_exec_t;
+		type soundd_tmp_t, soundd_var_run_t, soundd_tmpfs_t;
+		type soundd_state_t;
 	')
 
 	allow $1 soundd_t:process { ptrace signal_perms };
@@ -52,6 +52,12 @@
 	files_list_tmp($1)
 	admin_pattern($1, soundd_tmp_t)
 
+	fs_list_tmpfs($1)
+	admin_pattern($1, soundd_tmpfs_t)
+
+	files_list_var($1)
+	admin_pattern($1, soundd_state_t)
+
 	files_list_pids($1)
 	admin_pattern($1, soundd_var_run_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/soundserver.te refpolicy/policy/modules/contrib/soundserver.te
--- refpolicy/policy/modules/contrib/soundserver.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/soundserver.te	2012-10-28 18:59:04.814026452 +0100
@@ -1,4 +1,4 @@
-policy_module(soundserver, 1.8.0)
+policy_module(soundserver, 1.8.1)
 
 ########################################
 #
@@ -21,7 +21,6 @@
 type soundd_tmp_t;
 files_tmp_file(soundd_tmp_t)
 
-# for yiff - probably need some rules for the client support too
 type soundd_tmpfs_t;
 files_tmpfs_file(soundd_tmpfs_t)
 
@@ -36,12 +35,10 @@
 allow soundd_t self:capability dac_override;
 dontaudit soundd_t self:capability sys_tty_config;
 allow soundd_t self:process { setpgid signal_perms };
+allow soundd_t self:shm create_shm_perms;
 allow soundd_t self:tcp_socket create_stream_socket_perms;
 allow soundd_t self:udp_socket create_socket_perms;
-allow soundd_t self:unix_stream_socket { connectto create_stream_socket_perms };
-
-# for yiff
-allow soundd_t self:shm create_shm_perms;
+allow soundd_t self:unix_stream_socket { accept connectto listen };
 
 read_files_pattern(soundd_t, soundd_etc_t, soundd_etc_t)
 read_lnk_files_pattern(soundd_t, soundd_etc_t, soundd_etc_t)
@@ -59,9 +56,9 @@
 manage_sock_files_pattern(soundd_t, soundd_tmpfs_t, soundd_tmpfs_t)
 fs_tmpfs_filetrans(soundd_t, soundd_tmpfs_t, { dir file lnk_file sock_file fifo_file })
 
-manage_sock_files_pattern(soundd_t, soundd_var_run_t, soundd_var_run_t)
 manage_files_pattern(soundd_t, soundd_var_run_t, soundd_var_run_t)
 manage_dirs_pattern(soundd_t, soundd_var_run_t, soundd_var_run_t)
+manage_sock_files_pattern(soundd_t, soundd_var_run_t, soundd_var_run_t)
 files_pid_filetrans(soundd_t, soundd_var_run_t, { file dir })
 
 kernel_read_kernel_sysctls(soundd_t)
@@ -71,14 +68,12 @@
 corenet_all_recvfrom_unlabeled(soundd_t)
 corenet_all_recvfrom_netlabel(soundd_t)
 corenet_tcp_sendrecv_generic_if(soundd_t)
-corenet_udp_sendrecv_generic_if(soundd_t)
 corenet_tcp_sendrecv_generic_node(soundd_t)
-corenet_udp_sendrecv_generic_node(soundd_t)
-corenet_tcp_sendrecv_all_ports(soundd_t)
-corenet_udp_sendrecv_all_ports(soundd_t)
 corenet_tcp_bind_generic_node(soundd_t)
-corenet_tcp_bind_soundd_port(soundd_t)
+
 corenet_sendrecv_soundd_server_packets(soundd_t)
+corenet_tcp_bind_soundd_port(soundd_t)
+corenet_tcp_sendrecv_soundd_port(soundd_t)
 
 dev_read_sysfs(soundd_t)
 dev_read_sound(soundd_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/spamassassin.fc refpolicy/policy/modules/contrib/spamassassin.fc
--- refpolicy/policy/modules/contrib/spamassassin.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/spamassassin.fc	2012-10-28 18:59:08.901026460 +0100
@@ -1,15 +1,31 @@
 HOME_DIR/\.spamassassin(/.*)?	gen_context(system_u:object_r:spamassassin_home_t,s0)
+HOME_DIR/\.spamd(/.*)?	gen_context(system_u:object_r:spamd_home_t,s0)
+
+/etc/rc\.d/init\.d/spamd	--	gen_context(system_u:object_r:spamd_initrc_exec_t,s0)
+/etc/rc\.d/init\.d/spampd	--	gen_context(system_u:object_r:spamd_initrc_exec_t,s0)
+/etc/rc\.d/init\.d/mimedefang.*	--	gen_context(system_u:object_r:spamd_initrc_exec_t,s0)
 
 /usr/bin/sa-learn	--	gen_context(system_u:object_r:spamc_exec_t,s0)
-/usr/bin/spamassassin	--	gen_context(system_u:object_r:spamassassin_exec_t,s0)
-/usr/bin/spamc		--	gen_context(system_u:object_r:spamc_exec_t,s0)
-/usr/bin/spamd		--	gen_context(system_u:object_r:spamd_exec_t,s0)
+/usr/bin/spamassassin	--	gen_context(system_u:object_r:spamc_exec_t,s0)
+/usr/bin/spamc	--	gen_context(system_u:object_r:spamc_exec_t,s0)
+/usr/bin/spamd	--	gen_context(system_u:object_r:spamd_exec_t,s0)
+/usr/bin/sa-update	--	gen_context(system_u:object_r:spamd_update_exec_t,s0)
 
-/usr/sbin/spamd		--	gen_context(system_u:object_r:spamd_exec_t,s0)
+/usr/sbin/spamd	--	gen_context(system_u:object_r:spamd_exec_t,s0)
+/usr/sbin/spampd	--	gen_context(system_u:object_r:spamd_exec_t,s0)
+/usr/bin/mimedefang	--	gen_context(system_u:object_r:spamd_exec_t,s0)
+/usr/bin/mimedefang-multiplexor	--	gen_context(system_u:object_r:spamd_exec_t,s0)
 
 /var/lib/spamassassin(/.*)?	gen_context(system_u:object_r:spamd_var_lib_t,s0)
+/var/lib/spamassassin/compiled(/.*)?	gen_context(system_u:object_r:spamd_compiled_t,s0)
+
+/var/log/spamd\.log.*	--	gen_context(system_u:object_r:spamd_log_t,s0)
+/var/log/mimedefang.*	--	gen_context(system_u:object_r:spamd_log_t,s0)
 
 /var/run/spamassassin(/.*)?	gen_context(system_u:object_r:spamd_var_run_t,s0)
 
 /var/spool/spamassassin(/.*)?	gen_context(system_u:object_r:spamd_spool_t,s0)
-/var/spool/spamd(/.*)?		gen_context(system_u:object_r:spamd_spool_t,s0)
+/var/spool/spamd(/.*)?	gen_context(system_u:object_r:spamd_spool_t,s0)
+/var/spool/spampd(/.*)?	gen_context(system_u:object_r:spamd_spool_t,s0)
+/var/spool/MD-Quarantine(/.*)?	gen_context(system_u:object_r:spamd_var_run_t,s0)
+/var/spool/MIMEDefang(/.*)?	gen_context(system_u:object_r:spamd_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/spamassassin.if refpolicy/policy/modules/contrib/spamassassin.if
--- refpolicy/policy/modules/contrib/spamassassin.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/spamassassin.if	2012-10-29 15:48:25.271186451 +0100
@@ -2,40 +2,39 @@
 
 ########################################
 ## <summary>
-##	Role access for spamassassin
+##	Role access for spamassassin.
 ## </summary>
 ## <param name="role">
 ##	<summary>
-##	Role allowed access
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <param name="domain">
 ##	<summary>
-##	User domain for the role
+##	User domain for the role.
 ##	</summary>
 ## </param>
 #
 interface(`spamassassin_role',`
 	gen_require(`
 		type spamc_t, spamc_exec_t, spamc_tmp_t;
-		type spamassassin_t, spamassassin_exec_t;
+		type spamassassin_t, spamassassin_exec_t, spamd_home_t;
 		type spamassassin_home_t, spamassassin_tmp_t;
 	')
 
 	role $1 types { spamc_t spamassassin_t };
 
 	domtrans_pattern($2, spamassassin_exec_t, spamassassin_t)
-	ps_process_pattern($2, spamassassin_t)
-
 	domtrans_pattern($2, spamc_exec_t, spamc_t)
-	ps_process_pattern($2, spamc_t)
 
-	manage_dirs_pattern($2, spamassassin_home_t, spamassassin_home_t)
-	manage_files_pattern($2, spamassassin_home_t, spamassassin_home_t)
-	manage_lnk_files_pattern($2, spamassassin_home_t, spamassassin_home_t)
-	relabel_dirs_pattern($2, spamassassin_home_t, spamassassin_home_t)
-	relabel_files_pattern($2, spamassassin_home_t, spamassassin_home_t)
-	relabel_lnk_files_pattern($2, spamassassin_home_t, spamassassin_home_t)
+	allow $2 { spamc_t spamassassin_t}:process { ptrace signal_perms };
+	ps_process_pattern($2, { spamc_t spamassassin_t })
+
+	allow $2 { spamc_tmp_t spamd_home_t spamassassin_home_t spamassassin_tmp_t }:dir { manage_dir_perms relabel_dir_perms };
+	allow $2 { spamc_tmp_t spamd_home_t spamassassin_home_t spamassassin_tmp_t }:file { manage_file_perms relabel_file_perms };
+	allow $2 { spamc_tmp_t spamd_home_t spamassassin_home_t spamassassin_tmp_t }:lnk_file { manage_lnk_file_perms relabel_lnk_file_perms };
+	userdom_user_home_dir_filetrans($2, spamassassin_home_t, dir, ".spamassassin")
+	userdom_user_home_dir_filetrans($2, spamd_home_t, dir, ".spamd")
 ')
 
 ########################################
@@ -54,13 +53,13 @@
 		type spamassassin_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	can_exec($1, spamassassin_exec_t)
-
 ')
 
 ########################################
 ## <summary>
-##	Singnal the spam assassin daemon
+##	Send generic signals to spamd.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -78,8 +77,7 @@
 
 ########################################
 ## <summary>
-##	Execute the spamassassin daemon
-##	program in the caller directory.
+##	Execute spamd in the caller domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -92,12 +90,13 @@
 		type spamd_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	can_exec($1, spamd_exec_t)
 ')
 
 ########################################
 ## <summary>
-##	Execute spamassassin client in the spamassassin client domain.
+##	Execute spamc in the spamc domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -110,13 +109,13 @@
 		type spamc_t, spamc_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, spamc_exec_t, spamc_t)
 ')
 
 ########################################
 ## <summary>
-##	Execute the spamassassin client
-##	program in the caller directory.
+##	Execute spamc in the caller domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -129,12 +128,32 @@
 		type spamc_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	can_exec($1, spamc_exec_t)
 ')
 
 ########################################
 ## <summary>
-##	Execute spamassassin standalone client in the user spamassassin domain.
+##	Send kill signals to spamc.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`spamassassin_kill_client',`
+	gen_require(`
+		type spamc_t;
+	')
+
+	allow $1 spamc_t:process sigkill;
+')
+
+########################################
+## <summary>
+##	Execute spamassassin standalone client
+##	in the user spamassassin domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -147,12 +166,85 @@
 		type spamassassin_t, spamassassin_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, spamassassin_exec_t, spamassassin_t)
 ')
 
 ########################################
 ## <summary>
-##	read spamd lib files.
+##	Create, read, write, and delete
+##	spamd home content.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`spamassassin_manage_spamd_home_content',`
+	gen_require(`
+		type spamd_home_t;
+	')
+
+	userdom_search_user_home_dirs($1)
+	allow $1 spamd_home_t:dir manage_dir_perms;
+	allow $1 spamd_home_t:file manage_file_perms;
+	allow $1 spamd_home_t:lnk_file manage_lnk_file_perms;
+')
+
+########################################
+## <summary>
+##	Relabel spamd home content.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`spamassassin_relabel_spamd_home_content',`
+	gen_require(`
+		type spamd_home_t;
+	')
+
+	userdom_search_user_home_dirs($1)
+	allow $1 spamd_home_t:dir relabel_dir_perms;
+	allow $1 spamd_home_t:file relabel_file_perms;
+	allow $1 spamd_home_t:lnk_file relabel_lnk_file_perms;
+')
+
+########################################
+## <summary>
+##	Create objects in user home
+##	directories with the spamd home type.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="object_class">
+##	<summary>
+##	Class of the object being created.
+##	</summary>
+## </param>
+## <param name="name" optional="true">
+##	<summary>
+##	The name of the object being created.
+##	</summary>
+## </param>
+#
+interface(`spamassassin_home_filetrans_spamd_home',`
+	gen_require(`
+		type spamd_home_t;
+	')
+
+	userdom_user_home_dir_filetrans($1, spamd_home_t, $2, $3)
+')
+
+########################################
+## <summary>
+##	Read spamd lib files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -191,7 +283,26 @@
 
 ########################################
 ## <summary>
-##	Read temporary spamd file.
+##	Read spamd pid files.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`spamassassin_read_spamd_pid_files',`
+	gen_require(`
+		type spamd_var_run_t;
+	')
+
+	files_search_pids($1)
+	read_files_pattern($1, spamd_var_run_t, spamd_var_run_t)
+')
+
+########################################
+## <summary>
+##	Read temporary spamd files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -209,8 +320,8 @@
 
 ########################################
 ## <summary>
-##	Do not audit attempts to get attributes of temporary
-##	spamd sockets/
+##	Do not audit attempts to get
+##	attributes of temporary spamd sockets.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -225,3 +336,73 @@
 
 	dontaudit $1 spamd_tmp_t:sock_file getattr;
 ')
+
+########################################
+## <summary>
+##	Connect to spamd with a unix
+##	domain stream socket.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`spamassassin_stream_connect_spamd',`
+	gen_require(`
+		type spamd_t, spamd_var_run_t;
+	')
+
+	files_search_pids($1)
+	stream_connect_pattern($1, spamd_var_run_t, spamd_var_run_t, spamd_t)
+')
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an spamassassin environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`spamassassin_admin',`
+	gen_require(`
+		type spamd_t, spamd_tmp_t, spamd_log_t;
+		type spamd_spool_t, spamd_var_lib_t, spamd_var_run_t;
+		type spamd_initrc_exec_t;
+	')
+
+	allow $1 spamd_t:process { ptrace signal_perms };
+	ps_process_pattern($1, spamd_t)
+
+	init_labeled_script_domtrans($1, spamd_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 spamd_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	files_list_tmp($1)
+	admin_pattern($1, spamd_tmp_t)
+
+	logging_list_logs($1)
+	admin_pattern($1, spamd_log_t)
+
+	files_list_spool($1)
+	admin_pattern($1, spamd_spool_t)
+
+	files_list_var_lib($1)
+	admin_pattern($1, spamd_var_lib_t)
+
+	files_list_pids($1)
+	admin_pattern($1, spamd_var_run_t)
+
+	spamassassin_role($2, $1)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/spamassassin.te refpolicy/policy/modules/contrib/spamassassin.te
--- refpolicy/policy/modules/contrib/spamassassin.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/spamassassin.te	2012-10-29 15:48:25.272186451 +0100
@@ -1,4 +1,4 @@
-policy_module(spamassassin, 2.5.0)
+policy_module(spamassassin, 2.5.7)
 
 ########################################
 #
@@ -6,18 +6,24 @@
 #
 
 ## <desc>
-## <p>
-## Allow user spamassassin clients to use the network.
-## </p>
+##	<p>
+##	Determine whether spamassassin
+##	clients can use the network.
+##	</p>
 ## </desc>
 gen_tunable(spamassassin_can_network, false)
 
 ## <desc>
-## <p>
-## Allow spamd to read/write user home directories.
-## </p>
+##	<p>
+##	Determine whether spamd can manage
+##	generic user home content.
+##	</p>
 ## </desc>
-gen_tunable(spamd_enable_home_dirs, true)
+gen_tunable(spamd_enable_home_dirs, false)
+
+type spamd_update_t;
+type spamd_update_exec_t;
+init_system_domain(spamd_update_t, spamd_update_exec_t)
 
 type spamassassin_t;
 type spamassassin_exec_t;
@@ -50,68 +56,62 @@
 type spamd_exec_t;
 init_daemon_domain(spamd_t, spamd_exec_t)
 
+type spamd_compiled_t;
+files_type(spamd_compiled_t)
+
+type spamd_etc_t;
+files_config_file(spamd_etc_t)
+
+type spamd_home_t;
+userdom_user_home_content(spamd_home_t)
+
+type spamd_initrc_exec_t;
+init_script_file(spamd_initrc_exec_t)
+
+type spamd_log_t;
+logging_log_file(spamd_log_t)
+
 type spamd_spool_t;
 files_type(spamd_spool_t)
 
 type spamd_tmp_t;
 files_tmp_file(spamd_tmp_t)
 
-# var/lib files
 type spamd_var_lib_t;
 files_type(spamd_var_lib_t)
 
 type spamd_var_run_t;
 files_pid_file(spamd_var_run_t)
 
-##############################
+########################################
 #
-# Standalone program local policy
+# Standalone local policy
 #
 
 allow spamassassin_t self:process ~{ ptrace setcurrent setexec setfscreate setrlimit execmem execstack execheap };
 allow spamassassin_t self:fd use;
 allow spamassassin_t self:fifo_file rw_fifo_file_perms;
-allow spamassassin_t self:sock_file read_sock_file_perms;
-allow spamassassin_t self:unix_dgram_socket create_socket_perms;
-allow spamassassin_t self:unix_stream_socket create_stream_socket_perms;
 allow spamassassin_t self:unix_dgram_socket sendto;
-allow spamassassin_t self:unix_stream_socket connectto;
-allow spamassassin_t self:shm create_shm_perms;
-allow spamassassin_t self:sem create_sem_perms;
-allow spamassassin_t self:msgq create_msgq_perms;
-allow spamassassin_t self:msg { send receive };
+allow spamassassin_t self:unix_stream_socket { accept connectto listen };
 
 manage_dirs_pattern(spamassassin_t, spamassassin_home_t, spamassassin_home_t)
 manage_files_pattern(spamassassin_t, spamassassin_home_t, spamassassin_home_t)
 manage_lnk_files_pattern(spamassassin_t, spamassassin_home_t, spamassassin_home_t)
 manage_fifo_files_pattern(spamassassin_t, spamassassin_home_t, spamassassin_home_t)
 manage_sock_files_pattern(spamassassin_t, spamassassin_home_t, spamassassin_home_t)
-userdom_user_home_dir_filetrans(spamassassin_t, spamassassin_home_t, { dir file lnk_file sock_file fifo_file })
+userdom_user_home_dir_filetrans(spamassassin_t, spamassassin_home_t, dir, ".spamassassin")
 
 manage_dirs_pattern(spamassassin_t, spamassassin_tmp_t, spamassassin_tmp_t)
 manage_files_pattern(spamassassin_t, spamassassin_tmp_t, spamassassin_tmp_t)
 files_tmp_filetrans(spamassassin_t, spamassassin_tmp_t, { file dir })
 
-manage_dirs_pattern(spamd_t, spamassassin_home_t, spamassassin_home_t)
-manage_files_pattern(spamd_t, spamassassin_home_t, spamassassin_home_t)
-manage_lnk_files_pattern(spamd_t, spamassassin_home_t, spamassassin_home_t)
-manage_fifo_files_pattern(spamd_t, spamassassin_home_t, spamassassin_home_t)
-manage_sock_files_pattern(spamd_t, spamassassin_home_t, spamassassin_home_t)
-userdom_user_home_dir_filetrans(spamd_t, spamassassin_home_t, { dir file lnk_file sock_file fifo_file })
-
 kernel_read_kernel_sysctls(spamassassin_t)
 
 dev_read_urand(spamassassin_t)
 
+fs_getattr_all_fs(spamassassin_t)
 fs_search_auto_mountpoints(spamassassin_t)
 
-# this should probably be removed
-corecmd_list_bin(spamassassin_t)
-corecmd_read_bin_symlinks(spamassassin_t)
-corecmd_read_bin_files(spamassassin_t)
-corecmd_read_bin_pipes(spamassassin_t)
-corecmd_read_bin_sockets(spamassassin_t)
-
 domain_use_interactive_fds(spamassassin_t)
 
 files_read_etc_files(spamassassin_t)
@@ -124,34 +124,19 @@
 
 miscfiles_read_localization(spamassassin_t)
 
-# cjp: this could probably be removed
-seutil_read_config(spamassassin_t)
-
 sysnet_dns_name_resolve(spamassassin_t)
 
-# set tunable if you have spamassassin do DNS lookups
 tunable_policy(`spamassassin_can_network',`
-	allow spamassassin_t self:tcp_socket create_stream_socket_perms;
-	allow spamassassin_t self:udp_socket create_socket_perms;
+	allow spamassassin_t self:tcp_socket { accept listen };
 
 	corenet_all_recvfrom_unlabeled(spamassassin_t)
 	corenet_all_recvfrom_netlabel(spamassassin_t)
 	corenet_tcp_sendrecv_generic_if(spamassassin_t)
-	corenet_udp_sendrecv_generic_if(spamassassin_t)
 	corenet_tcp_sendrecv_generic_node(spamassassin_t)
-	corenet_udp_sendrecv_generic_node(spamassassin_t)
 	corenet_tcp_sendrecv_all_ports(spamassassin_t)
-	corenet_udp_sendrecv_all_ports(spamassassin_t)
+
 	corenet_tcp_connect_all_ports(spamassassin_t)
 	corenet_sendrecv_all_client_packets(spamassassin_t)
-
-	sysnet_read_config(spamassassin_t)
-')
-
-tunable_policy(`spamd_enable_home_dirs',`
-	userdom_manage_user_home_content_dirs(spamd_t)
-	userdom_manage_user_home_content_files(spamd_t)
-	userdom_manage_user_home_content_symlinks(spamd_t)
 ')
 
 tunable_policy(`use_nfs_home_dirs',`
@@ -167,11 +152,6 @@
 ')
 
 optional_policy(`
-	# Write pid file and socket in ~/.evolution/cache/tmp
-	evolution_home_filetrans(spamd_t, spamd_tmp_t, { file sock_file })
-')
-
-optional_policy(`
 	tunable_policy(`spamassassin_can_network && allow_ypbind',`
 		nis_use_ypbind_uncond(spamassassin_t)
 	')
@@ -187,134 +167,157 @@
 # Client local policy
 #
 
+allow spamc_t self:capability dac_override;
 allow spamc_t self:process ~{ ptrace setcurrent setexec setfscreate setrlimit execmem execstack execheap };
 allow spamc_t self:fd use;
 allow spamc_t self:fifo_file rw_fifo_file_perms;
-allow spamc_t self:sock_file read_sock_file_perms;
-allow spamc_t self:shm create_shm_perms;
-allow spamc_t self:sem create_sem_perms;
-allow spamc_t self:msgq create_msgq_perms;
-allow spamc_t self:msg { send receive };
-allow spamc_t self:unix_dgram_socket create_socket_perms;
-allow spamc_t self:unix_stream_socket create_stream_socket_perms;
 allow spamc_t self:unix_dgram_socket sendto;
-allow spamc_t self:unix_stream_socket connectto;
-allow spamc_t self:tcp_socket create_stream_socket_perms;
-allow spamc_t self:udp_socket create_socket_perms;
+allow spamc_t self:unix_stream_socket { accept connectto listen };
+allow spamc_t self:tcp_socket { accept listen };
 
 manage_dirs_pattern(spamc_t, spamc_tmp_t, spamc_tmp_t)
 manage_files_pattern(spamc_t, spamc_tmp_t, spamc_tmp_t)
 files_tmp_filetrans(spamc_t, spamc_tmp_t, { file dir })
 
-# Allow connecting to a local spamd
-allow spamc_t spamd_t:unix_stream_socket connectto;
-allow spamc_t spamd_tmp_t:sock_file rw_sock_file_perms;
+manage_dirs_pattern(spamc_t, spamassassin_home_t, spamassassin_home_t)
+manage_files_pattern(spamc_t, spamassassin_home_t, spamassassin_home_t)
+manage_lnk_files_pattern(spamc_t, spamassassin_home_t, spamassassin_home_t)
+manage_fifo_files_pattern(spamc_t, spamassassin_home_t, spamassassin_home_t)
+manage_sock_files_pattern(spamc_t, spamassassin_home_t, spamassassin_home_t)
+userdom_user_home_dir_filetrans(spamc_t, spamassassin_home_t, dir, ".spamassassin")
+
+list_dirs_pattern(spamc_t, spamd_var_lib_t, spamd_var_lib_t)
+read_files_pattern(spamc_t, spamd_var_lib_t, spamd_var_lib_t)
+
+stream_connect_pattern(spamc_t, { spamd_var_run_t spamd_tmp_t }, { spamd_var_run_t spamd_tmp_t }, spamd_t)
 
 kernel_read_kernel_sysctls(spamc_t)
+kernel_read_system_state(spamc_t)
 
 corenet_all_recvfrom_unlabeled(spamc_t)
 corenet_all_recvfrom_netlabel(spamc_t)
 corenet_tcp_sendrecv_generic_if(spamc_t)
-corenet_udp_sendrecv_generic_if(spamc_t)
 corenet_tcp_sendrecv_generic_node(spamc_t)
-corenet_udp_sendrecv_generic_node(spamc_t)
 corenet_tcp_sendrecv_all_ports(spamc_t)
-corenet_udp_sendrecv_all_ports(spamc_t)
-corenet_tcp_connect_all_ports(spamc_t)
-corenet_sendrecv_all_client_packets(spamc_t)
 
-fs_search_auto_mountpoints(spamc_t)
+corenet_sendrecv_all_client_packets(spamc_t)
+corenet_tcp_connect_all_ports(spamc_t)
 
-# cjp: these should probably be removed:
-corecmd_list_bin(spamc_t)
-corecmd_read_bin_symlinks(spamc_t)
-corecmd_read_bin_files(spamc_t)
-corecmd_read_bin_pipes(spamc_t)
-corecmd_read_bin_sockets(spamc_t)
+corecmd_exec_bin(spamc_t)
 
 domain_use_interactive_fds(spamc_t)
 
-files_read_etc_files(spamc_t)
+fs_getattr_all_fs(spamc_t)
+fs_search_auto_mountpoints(spamc_t)
+
 files_read_etc_runtime_files(spamc_t)
 files_read_usr_files(spamc_t)
 files_dontaudit_search_var(spamc_t)
-# cjp: this may be removable:
 files_list_home(spamc_t)
+files_list_var_lib(spamc_t)
+
+auth_use_nsswitch(spamc_t)
 
 logging_send_syslog_msg(spamc_t)
 
 miscfiles_read_localization(spamc_t)
 
-# cjp: this should probably be removed:
-seutil_read_config(spamc_t)
+tunable_policy(`use_nfs_home_dirs',`
+	fs_manage_nfs_dirs(spamc_t)
+	fs_manage_nfs_files(spamc_t)
+	fs_manage_nfs_symlinks(spamc_t)
+')
 
-sysnet_read_config(spamc_t)
+tunable_policy(`use_samba_home_dirs',`
+	fs_manage_cifs_dirs(spamc_t)
+	fs_manage_cifs_files(spamc_t)
+	fs_manage_cifs_symlinks(spamc_t)
+')
 
 optional_policy(`
-	# Allow connection to spamd socket above
-	evolution_stream_connect(spamc_t)
+	abrt_stream_connect(spamc_t)
 ')
 
 optional_policy(`
-	# Needed for pyzor/razor called from spamd
-	milter_manage_spamass_state(spamc_t)
+	amavis_manage_spool_files(spamc_t)
 ')
 
 optional_policy(`
-	nis_use_ypbind(spamc_t)
+	evolution_stream_connect(spamc_t)
 ')
 
 optional_policy(`
-	nscd_socket_use(spamc_t)
+	milter_manage_spamass_state(spamc_t)
 ')
 
 optional_policy(`
+	mta_send_mail(spamc_t)
 	mta_read_config(spamc_t)
+	mta_read_queue(spamc_t)
+	sendmail_rw_pipes(spamc_t)
 	sendmail_stub(spamc_t)
 ')
 
+optional_policy(`
+	postfix_domtrans_postdrop(spamc_t)
+	postfix_search_spool(spamc_t)
+	postfix_rw_local_pipes(spamc_t)
+	postfix_rw_master_pipes(spamc_t)
+')
+
 ########################################
 #
-# Server local policy
+# Daemon local policy
 #
 
-# Spamassassin, when run as root and using per-user config files,
-# setuids to the user running spamc.  Comment this if you are not
-# using this ability.
-
-allow spamd_t self:capability { setuid setgid dac_override sys_tty_config };
+allow spamd_t self:capability { kill setuid setgid dac_override sys_tty_config };
 dontaudit spamd_t self:capability sys_tty_config;
 allow spamd_t self:process ~{ ptrace setcurrent setexec setfscreate setrlimit execmem execstack execheap };
 allow spamd_t self:fd use;
 allow spamd_t self:fifo_file rw_fifo_file_perms;
-allow spamd_t self:sock_file read_sock_file_perms;
-allow spamd_t self:shm create_shm_perms;
-allow spamd_t self:sem create_sem_perms;
-allow spamd_t self:msgq create_msgq_perms;
-allow spamd_t self:msg { send receive };
-allow spamd_t self:unix_dgram_socket create_socket_perms;
-allow spamd_t self:unix_stream_socket create_stream_socket_perms;
 allow spamd_t self:unix_dgram_socket sendto;
-allow spamd_t self:unix_stream_socket connectto;
-allow spamd_t self:tcp_socket create_stream_socket_perms;
-allow spamd_t self:udp_socket create_socket_perms;
-allow spamd_t self:netlink_route_socket r_netlink_socket_perms;
+allow spamd_t self:unix_stream_socket { accept connectto listen };
+allow spamd_t self:tcp_socket { accept listen };
+
+manage_dirs_pattern(spamd_t, spamd_home_t, spamd_home_t)
+manage_files_pattern(spamd_t, spamd_home_t, spamd_home_t)
+manage_lnk_files_pattern(spamd_t, spamd_home_t, spamd_home_t)
+manage_fifo_files_pattern(spamd_t, spamd_home_t, spamd_home_t)
+manage_sock_files_pattern(spamd_t, spamd_home_t, spamd_home_t)
+userdom_user_home_dir_filetrans(spamd_t, spamd_home_t, dir, ".spamd")
+
+manage_dirs_pattern(spamd_t, spamassassin_home_t, spamassassin_home_t)
+manage_files_pattern(spamd_t, spamassassin_home_t, spamassassin_home_t)
+manage_lnk_files_pattern(spamd_t, spamassassin_home_t, spamassassin_home_t)
+manage_fifo_files_pattern(spamd_t, spamassassin_home_t, spamassassin_home_t)
+manage_sock_files_pattern(spamd_t, spamassassin_home_t, spamassassin_home_t)
+userdom_user_home_dir_filetrans(spamd_t, spamassassin_home_t, dir, ".spamassassin")
+
+manage_dirs_pattern(spamd_t, spamd_compiled_t, spamd_compiled_t)
+manage_files_pattern(spamd_t, spamd_compiled_t, spamd_compiled_t)
+
+allow spamd_t spamd_log_t:file { append_file_perms create_file_perms setattr_file_perms };
+logging_log_filetrans(spamd_t, spamd_log_t, file)
 
 manage_dirs_pattern(spamd_t, spamd_spool_t, spamd_spool_t)
 manage_files_pattern(spamd_t, spamd_spool_t, spamd_spool_t)
+manage_sock_files_pattern(spamd_t, spamd_spool_t, spamd_spool_t)
 files_spool_filetrans(spamd_t, spamd_spool_t, { file dir })
 
 manage_dirs_pattern(spamd_t, spamd_tmp_t, spamd_tmp_t)
 manage_files_pattern(spamd_t, spamd_tmp_t, spamd_tmp_t)
 files_tmp_filetrans(spamd_t, spamd_tmp_t, { file dir })
 
-# var/lib files for spamd
 allow spamd_t spamd_var_lib_t:dir list_dir_perms;
-read_files_pattern(spamd_t, spamd_var_lib_t, spamd_var_lib_t)
+manage_files_pattern(spamd_t, spamd_var_lib_t, spamd_var_lib_t)
+manage_lnk_files_pattern(spamd_t, spamd_var_lib_t, spamd_var_lib_t)
 
 manage_dirs_pattern(spamd_t, spamd_var_run_t, spamd_var_run_t)
 manage_files_pattern(spamd_t, spamd_var_run_t, spamd_var_run_t)
-files_pid_filetrans(spamd_t, spamd_var_run_t, { dir file })
+manage_sock_files_pattern(spamd_t, spamd_var_run_t, spamd_var_run_t)
+files_pid_filetrans(spamd_t, spamd_var_run_t, { file dir })
+
+can_exec(spamd_t, { spamd_exec_t spamd_compiled_t })
 
 kernel_read_all_sysctls(spamd_t)
 kernel_read_system_state(spamd_t)
@@ -328,58 +331,70 @@
 corenet_tcp_sendrecv_all_ports(spamd_t)
 corenet_udp_sendrecv_all_ports(spamd_t)
 corenet_tcp_bind_generic_node(spamd_t)
+corenet_udp_bind_generic_node(spamd_t)
+
+corenet_sendrecv_spamd_server_packets(spamd_t)
 corenet_tcp_bind_spamd_port(spamd_t)
+
+corenet_sendrecv_razor_client_packets(spamd_t)
 corenet_tcp_connect_razor_port(spamd_t)
+
+corenet_sendrecv_smtp_client_packets(spamd_t)
 corenet_tcp_connect_smtp_port(spamd_t)
-corenet_sendrecv_razor_client_packets(spamd_t)
-corenet_sendrecv_spamd_server_packets(spamd_t)
-# spamassassin 3.1 needs this for its
-# DnsResolver.pm module which binds to
-# random ports >= 1024.
-corenet_udp_bind_generic_node(spamd_t)
+
+corenet_sendrecv_generic_server_packets(spamd_t)
 corenet_udp_bind_generic_port(spamd_t)
+
+corenet_sendrecv_imaze_server_packets(spamd_t)
 corenet_udp_bind_imaze_port(spamd_t)
+
 corenet_dontaudit_udp_bind_all_ports(spamd_t)
-corenet_sendrecv_imaze_server_packets(spamd_t)
-corenet_sendrecv_generic_server_packets(spamd_t)
+
+corecmd_exec_bin(spamd_t)
 
 dev_read_sysfs(spamd_t)
 dev_read_urand(spamd_t)
 
-fs_getattr_all_fs(spamd_t)
-fs_search_auto_mountpoints(spamd_t)
-
-auth_dontaudit_read_shadow(spamd_t)
-
-corecmd_exec_bin(spamd_t)
-
 domain_use_interactive_fds(spamd_t)
 
 files_read_usr_files(spamd_t)
-files_read_etc_files(spamd_t)
 files_read_etc_runtime_files(spamd_t)
-# /var/lib/spamassin
-files_read_var_lib_files(spamd_t)
+
+fs_getattr_all_fs(spamd_t)
+fs_search_auto_mountpoints(spamd_t)
+
+auth_use_nsswitch(spamd_t)
+auth_dontaudit_read_shadow(spamd_t)
 
 init_dontaudit_rw_utmp(spamd_t)
 
+libs_use_ld_so(spamd_t)
+libs_use_shared_libs(spamd_t)
+
 logging_send_syslog_msg(spamd_t)
 
 miscfiles_read_localization(spamd_t)
 
-sysnet_read_config(spamd_t)
 sysnet_use_ldap(spamd_t)
-sysnet_dns_name_resolve(spamd_t)
 
 userdom_use_unpriv_users_fds(spamd_t)
-userdom_search_user_home_dirs(spamd_t)
+
+tunable_policy(`spamd_enable_home_dirs',`
+	userdom_manage_user_home_content_dirs(spamd_t)
+	userdom_manage_user_home_content_files(spamd_t)
+	userdom_manage_user_home_content_symlinks(spamd_t)
+')
 
 tunable_policy(`use_nfs_home_dirs',`
+	fs_manage_nfs_dirs(spamd_t)
 	fs_manage_nfs_files(spamd_t)
+	fs_manage_nfs_symlinks(spamd_t)
 ')
 
 tunable_policy(`use_samba_home_dirs',`
+	fs_manage_cifs_dirs(spamd_t)
 	fs_manage_cifs_files(spamd_t)
+	fs_manage_cifs_symlinks(spamd_t)
 ')
 
 optional_policy(`
@@ -387,6 +402,10 @@
 ')
 
 optional_policy(`
+	clamav_stream_connect(spamd_t)
+')
+
+optional_policy(`
 	cron_system_entry(spamd_t, spamd_exec_t)
 ')
 
@@ -395,24 +414,28 @@
 ')
 
 optional_policy(`
+	dcc_domtrans_cdcc(spamd_t)
 	dcc_domtrans_client(spamd_t)
+	dcc_signal_client(spamd_t)
 	dcc_stream_connect_dccifd(spamd_t)
 ')
 
 optional_policy(`
-	milter_manage_spamass_state(spamd_t)
+	evolution_home_filetrans(spamd_t, spamd_tmp_t, { file sock_file })
 ')
 
 optional_policy(`
-	corenet_tcp_connect_mysqld_port(spamd_t)
-	corenet_sendrecv_mysqld_client_packets(spamd_t)
+	exim_manage_spool_dirs(spamd_t)
+	exim_manage_spool_files(spamd_t)
+')
 
-	mysql_search_db(spamd_t)
-	mysql_stream_connect(spamd_t)
+optional_policy(`
+	milter_manage_spamass_state(spamd_t)
 ')
 
 optional_policy(`
-	nis_use_ypbind(spamd_t)
+	mysql_stream_connect(spamd_t)
+	mysql_tcp_connect(spamd_t)
 ')
 
 optional_policy(`
@@ -420,10 +443,8 @@
 ')
 
 optional_policy(`
-	corenet_tcp_connect_postgresql_port(spamd_t)
-	corenet_sendrecv_postgresql_client_packets(spamd_t)
-
 	postgresql_stream_connect(spamd_t)
+	postgresql_tcp_connect(spamd_t)
 ')
 
 optional_policy(`
@@ -433,6 +454,8 @@
 
 optional_policy(`
 	razor_domtrans(spamd_t)
+	razor_read_lib_files(spamd_t)
+	razor_manage_home_content(spamd_t)
 ')
 
 optional_policy(`
@@ -442,8 +465,68 @@
 optional_policy(`
 	sendmail_stub(spamd_t)
 	mta_read_config(spamd_t)
+	mta_send_mail(spamd_t)
 ')
 
 optional_policy(`
 	udev_read_db(spamd_t)
 ')
+
+########################################
+#
+# Update local policy
+#
+
+dontaudit spamd_update_t self:capability dac_override;
+allow spamd_update_t self:fifo_file manage_fifo_file_perms;
+allow spamd_update_t self:unix_stream_socket create_stream_socket_perms;
+
+manage_dirs_pattern(spamd_update_t, spamd_tmp_t, spamd_tmp_t)
+manage_files_pattern(spamd_update_t, spamd_tmp_t, spamd_tmp_t)
+files_tmp_filetrans(spamd_update_t, spamd_tmp_t, { file dir })
+
+allow spamd_update_t spamd_var_lib_t:dir list_dir_perms;
+manage_files_pattern(spamd_update_t, spamd_var_lib_t, spamd_var_lib_t)
+manage_lnk_files_pattern(spamd_update_t, spamd_var_lib_t, spamd_var_lib_t)
+
+kernel_read_system_state(spamd_update_t)
+
+corenet_all_recvfrom_unlabeled(spamd_update_t)
+corenet_all_recvfrom_netlabel(spamd_update_t)
+corenet_tcp_sendrecv_generic_if(spamd_update_t)
+corenet_tcp_sendrecv_generic_node(spamd_update_t)
+corenet_tcp_sendrecv_all_ports(spamd_update_t)
+
+corenet_sendrecv_http_client_packets(spamd_update_t)
+corenet_tcp_connect_http_port(spamd_update_t)
+corenet_tcp_sendrecv_http_port(spamd_update_t)
+
+corecmd_exec_bin(spamd_update_t)
+corecmd_exec_shell(spamd_update_t)
+
+dev_read_urand(spamd_update_t)
+
+domain_use_interactive_fds(spamd_update_t)
+
+files_read_usr_files(spamd_update_t)
+
+auth_use_nsswitch(spamd_update_t)
+auth_dontaudit_read_shadow(spamd_update_t)
+
+miscfiles_read_localization(spamd_update_t)
+
+userdom_use_user_terminals(spamd_update_t)
+
+optional_policy(`
+	cron_system_entry(spamd_update_t, spamd_update_exec_t)
+')
+
+# probably want a solution same as httpd_use_gpg since this will
+# give spamd_update a path to users gpg keys
+# optional_policy(`
+#	gpg_domtrans(spamd_update_t)
+# ')
+
+optional_policy(`
+	mta_read_config(spamd_update_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/speedtouch.fc refpolicy/policy/modules/contrib/speedtouch.fc
--- refpolicy/policy/modules/contrib/speedtouch.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/speedtouch.fc	2012-10-29 15:48:30.717186463 +0100
@@ -1,2 +1,3 @@
 /usr/sbin/speedmgmt	--	gen_context(system_u:object_r:speedmgmt_exec_t,s0)
 
+/var/run/speedmgmt\.pid	--	gen_context(system_u:object_r:speedmgmt_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/speedtouch.te refpolicy/policy/modules/contrib/speedtouch.te
--- refpolicy/policy/modules/contrib/speedtouch.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/speedtouch.te	2012-10-29 15:48:30.717186463 +0100
@@ -1,8 +1,8 @@
-policy_module(speedtouch, 1.4.0)
+policy_module(speedtouch, 1.4.1)
 
 #######################################
 #
-# Rules for the speedmgmt_t domain.
+# Declarations
 #
 
 type speedmgmt_t;
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/squid.fc refpolicy/policy/modules/contrib/squid.fc
--- refpolicy/policy/modules/contrib/squid.fc	2012-05-04 16:10:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/squid.fc	2012-10-29 15:48:33.850186469 +0100
@@ -1,13 +1,20 @@
-/etc/rc\.d/init\.d/squid --	gen_context(system_u:object_r:squid_initrc_exec_t,s0)
-/etc/squid(/.*)?		gen_context(system_u:object_r:squid_conf_t,s0)
+/etc/squid(/.*)?	gen_context(system_u:object_r:squid_conf_t,s0)
 
-/usr/lib/squid/cachemgr\.cgi -- gen_context(system_u:object_r:httpd_squid_script_exec_t,s0)
-/usr/sbin/squid		--	gen_context(system_u:object_r:squid_exec_t,s0)
-/usr/share/squid(/.*)?		gen_context(system_u:object_r:squid_conf_t,s0)
+/etc/rc\.d/init\.d/squid	--	gen_context(system_u:object_r:squid_initrc_exec_t,s0)
 
-/var/cache/squid(/.*)?		gen_context(system_u:object_r:squid_cache_t,s0)
-/var/log/squid(/.*)?		gen_context(system_u:object_r:squid_log_t,s0)
+/usr/lib/squid/cachemgr\.cgi	--	gen_context(system_u:object_r:httpd_squid_script_exec_t,s0)
+
+/usr/sbin/squid	--	gen_context(system_u:object_r:squid_exec_t,s0)
+
+/usr/share/squid(/.*)?	gen_context(system_u:object_r:squid_conf_t,s0)
+
+/var/cache/squid(/.*)?	gen_context(system_u:object_r:squid_cache_t,s0)
+
+/var/log/squid(/.*)?	gen_context(system_u:object_r:squid_log_t,s0)
 /var/log/squidGuard(/.*)?	gen_context(system_u:object_r:squid_log_t,s0)
+
 /var/run/squid\.pid	--	gen_context(system_u:object_r:squid_var_run_t,s0)
-/var/spool/squid(/.*)?		gen_context(system_u:object_r:squid_cache_t,s0)
-/var/squidGuard(/.*)?		gen_context(system_u:object_r:squid_cache_t,s0)
+
+/var/spool/squid(/.*)?	gen_context(system_u:object_r:squid_cache_t,s0)
+
+/var/squidGuard(/.*)?	gen_context(system_u:object_r:squid_cache_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/squid.if refpolicy/policy/modules/contrib/squid.if
--- refpolicy/policy/modules/contrib/squid.if	2012-05-04 15:16:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/squid.if	2012-10-29 15:48:33.851186469 +0100
@@ -1,4 +1,4 @@
-## <summary>Squid caching http proxy server</summary>
+## <summary>Squid caching http proxy server.</summary>
 
 ########################################
 ## <summary>
@@ -21,7 +21,7 @@
 
 ########################################
 ## <summary>
-##	Execute squid 
+##	Execute squid in the caller domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -34,6 +34,7 @@
 		type squid_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	can_exec($1, squid_exec_t)
 ')
 
@@ -57,8 +58,8 @@
 
 ########################################
 ## <summary>
-##	Allow read and write squid
-##	unix domain stream sockets.
+##	Read and write squid unix
+##	domain stream sockets.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -76,7 +77,8 @@
 
 ########################################
 ## <summary>
-##	Do not audit attempts to search squid cache dirs
+##	Do not audit attempts to search
+##	squid cache directories.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -95,7 +97,7 @@
 
 ########################################
 ## <summary>
-##	Read squid configuration file.
+##	Read squid configuration files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -115,7 +117,7 @@
 
 ########################################
 ## <summary>
-##	Append squid logs.
+##	Read squid log files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -135,7 +137,7 @@
 
 ########################################
 ## <summary>
-##	Append squid logs.
+##	Append squid log files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -155,7 +157,7 @@
 ########################################
 ## <summary>
 ##	Create, read, write, and delete
-##	squid logs.
+##	squid log files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -189,8 +191,8 @@
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate 
-##	an squid environment
+##	All of the rules required to
+##	administrate an squid environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -199,7 +201,7 @@
 ## </param>
 ## <param name="role">
 ##	<summary>
-##	The role to be allowed to manage the squid domain.
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <rolecap/>
@@ -207,8 +209,8 @@
 interface(`squid_admin',`
 	gen_require(`
 		type squid_t, squid_cache_t, squid_conf_t;
-		type squid_log_t, squid_var_run_t;
-		type squid_initrc_exec_t;
+		type squid_log_t, squid_var_run_t, squid_tmpfs_t;
+		type squid_initrc_exec_t, squid_tmp_t;
 	')
 
 	allow $1 squid_t:process { ptrace signal_perms };
@@ -230,4 +232,10 @@
 
 	files_list_pids($1)
 	admin_pattern($1, squid_var_run_t)
+
+	fs_list_tmpfs($1)
+	admin_pattern($1, squid_tmpfs_t)
+
+	files_list_tmp($1)
+	admin_pattern($1, squid_tmp_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/squid.te refpolicy/policy/modules/contrib/squid.te
--- refpolicy/policy/modules/contrib/squid.te	2012-07-25 20:33:05.000000000 +0200
+++ refpolicy/policy/modules/contrib/squid.te	2012-10-29 15:48:33.871186469 +0100
@@ -1,4 +1,4 @@
-policy_module(squid, 1.11.0)
+policy_module(squid, 1.11.1)
 
 ########################################
 #
@@ -6,17 +6,18 @@
 #
 
 ## <desc>
-## <p>
-## Allow squid to connect to all ports, not just
-## HTTP, FTP, and Gopher ports.
-## </p>
+##	<p>
+##	Determine whether squid can
+##	connect to all TCP ports.
+##	</p>
 ## </desc>
 gen_tunable(squid_connect_any, false)
 
 ## <desc>
-## <p>
-## Allow squid to run as a transparent proxy (TPROXY)
-## </p>
+##	<p>
+##	Determine whether squid can run
+##	as a transparent proxy.
+##	</p>
 ## </desc>
 gen_tunable(squid_use_tproxy, false)
 
@@ -24,7 +25,6 @@
 type squid_exec_t;
 init_daemon_domain(squid_t, squid_exec_t)
 
-# type for /var/cache/squid
 type squid_cache_t;
 files_type(squid_cache_t)
 
@@ -37,6 +37,9 @@
 type squid_log_t;
 logging_log_file(squid_log_t)
 
+type squid_tmp_t;
+files_tmp_file(squid_tmp_t)
+
 type squid_tmpfs_t;
 files_tmpfs_file(squid_tmpfs_t)
 
@@ -52,46 +55,46 @@
 dontaudit squid_t self:capability sys_tty_config;
 allow squid_t self:process ~{ ptrace setcurrent setexec setfscreate execmem execstack execheap };
 allow squid_t self:fifo_file rw_fifo_file_perms;
-allow squid_t self:sock_file read_sock_file_perms;
 allow squid_t self:fd use;
 allow squid_t self:shm create_shm_perms;
 allow squid_t self:sem create_sem_perms;
 allow squid_t self:msgq create_msgq_perms;
 allow squid_t self:msg { send receive };
-allow squid_t self:unix_stream_socket create_stream_socket_perms;
-allow squid_t self:unix_dgram_socket create_socket_perms;
 allow squid_t self:unix_dgram_socket sendto;
-allow squid_t self:unix_stream_socket connectto;
-allow squid_t self:tcp_socket create_stream_socket_perms;
-allow squid_t self:udp_socket create_socket_perms;
+allow squid_t self:unix_stream_socket { accept connectto listen };
+allow squid_t self:tcp_socket { accept listen };
 
-# Grant permissions to create, access, and delete cache files.
 manage_dirs_pattern(squid_t, squid_cache_t, squid_cache_t)
 manage_files_pattern(squid_t, squid_cache_t, squid_cache_t)
 manage_lnk_files_pattern(squid_t, squid_cache_t, squid_cache_t)
+files_var_filetrans(squid_t, squid_cache_t, dir, "squid")
 
 allow squid_t squid_conf_t:dir list_dir_perms;
-read_files_pattern(squid_t, squid_conf_t, squid_conf_t)
-read_lnk_files_pattern(squid_t, squid_conf_t, squid_conf_t)
-
-can_exec(squid_t, squid_exec_t)
+allow squid_t squid_conf_t:file read_file_perms;
+allow squid_t squid_conf_t:lnk_file read_lnk_file_perms;
 
 manage_dirs_pattern(squid_t, squid_log_t, squid_log_t)
-manage_files_pattern(squid_t, squid_log_t, squid_log_t)
+append_files_pattern(squid_t, squid_log_t, squid_log_t)
+create_files_pattern(squid_t, squid_log_t, squid_log_t)
+setattr_files_pattern(squid_t, squid_log_t, squid_log_t)
 manage_lnk_files_pattern(squid_t, squid_log_t, squid_log_t)
 logging_log_filetrans(squid_t, squid_log_t, { file dir })
 
-#squid requires the following when run in diskd mode, the recommended setting
+manage_dirs_pattern(squid_t, squid_tmp_t, squid_tmp_t)
+manage_files_pattern(squid_t, squid_tmp_t, squid_tmp_t)
+files_tmp_filetrans(squid_t, squid_tmp_t, { file dir })
+
 manage_files_pattern(squid_t, squid_tmpfs_t, squid_tmpfs_t)
 fs_tmpfs_filetrans(squid_t, squid_tmpfs_t, file)
 
 manage_files_pattern(squid_t, squid_var_run_t, squid_var_run_t)
 files_pid_filetrans(squid_t, squid_var_run_t, file)
 
+can_exec(squid_t, squid_exec_t)
+
 kernel_read_kernel_sysctls(squid_t)
 kernel_read_system_state(squid_t)
-
-files_dontaudit_getattr_boot_dirs(squid_t)
+kernel_read_network_state(squid_t)
 
 corenet_all_recvfrom_unlabeled(squid_t)
 corenet_all_recvfrom_netlabel(squid_t)
@@ -99,63 +102,77 @@
 corenet_udp_sendrecv_generic_if(squid_t)
 corenet_tcp_sendrecv_generic_node(squid_t)
 corenet_udp_sendrecv_generic_node(squid_t)
-corenet_tcp_sendrecv_all_ports(squid_t)
-corenet_udp_sendrecv_all_ports(squid_t)
 corenet_tcp_bind_generic_node(squid_t)
 corenet_udp_bind_generic_node(squid_t)
+
+corenet_sendrecv_http_client_packets(squid_t)
+corenet_tcp_connect_http_port(squid_t)
+corenet_sendrecv_http_server_packets(squid_t)
 corenet_tcp_bind_http_port(squid_t)
+corenet_tcp_sendrecv_http_port(squid_t)
+
+corenet_sendrecv_http_cache_client_packets(squid_t)
+corenet_tcp_connect_http_cache_port(squid_t)
+corenet_sendrecv_http_cache_server_packets(squid_t)
 corenet_tcp_bind_http_cache_port(squid_t)
 corenet_udp_bind_http_cache_port(squid_t)
+corenet_tcp_sendrecv_http_cache_port(squid_t)
+corenet_udp_sendrecv_http_cache_port(squid_t)
+
+corenet_sendrecv_ftp_client_packets(squid_t)
+corenet_tcp_connect_ftp_port(squid_t)
+corenet_sendrecv_ftp_server_packets(squid_t)
 corenet_tcp_bind_ftp_port(squid_t)
+corenet_tcp_sendrecv_ftp_port(squid_t)
+
+corenet_sendrecv_gopher_client_packets(squid_t)
+corenet_tcp_connect_gopher_port(squid_t)
+corenet_sendrecv_gopher_server_packets(squid_t)
 corenet_tcp_bind_gopher_port(squid_t)
 corenet_udp_bind_gopher_port(squid_t)
+corenet_tcp_sendrecv_gopher_port(squid_t)
+corenet_udp_sendrecv_gopher_port(squid_t)
+
+corenet_sendrecv_squid_server_packets(squid_t)
 corenet_tcp_bind_squid_port(squid_t)
 corenet_udp_bind_squid_port(squid_t)
-corenet_udp_bind_wccp_port(squid_t)
-corenet_tcp_connect_ftp_port(squid_t)
-corenet_tcp_connect_gopher_port(squid_t)
-corenet_tcp_connect_http_port(squid_t)
-corenet_tcp_connect_http_cache_port(squid_t)
-corenet_tcp_connect_pgpkeyserver_port(squid_t)
-corenet_sendrecv_ftp_client_packets(squid_t)
-corenet_sendrecv_gopher_client_packets(squid_t)
-corenet_sendrecv_http_client_packets(squid_t)
-corenet_sendrecv_http_server_packets(squid_t)
-corenet_sendrecv_http_cache_server_packets(squid_t)
-corenet_sendrecv_http_cache_client_packets(squid_t)
-corenet_sendrecv_pgpkeyserver_client_packets(squid_t)
-corenet_sendrecv_squid_client_packets(squid_t)
-corenet_sendrecv_squid_server_packets(squid_t)
-corenet_sendrecv_wccp_server_packets(squid_t)
+corenet_tcp_sendrecv_squid_port(squid_t)
+corenet_udp_sendrecv_squid_port(squid_t)
 
-dev_read_sysfs(squid_t)
-dev_read_urand(squid_t)
-
-fs_getattr_all_fs(squid_t)
-fs_search_auto_mountpoints(squid_t)
-fs_list_inotifyfs(squid_t)
-
-selinux_dontaudit_getattr_dir(squid_t)
+corenet_sendrecv_wccp_server_packets(squid_t)
+corenet_udp_bind_wccp_port(squid_t)
+corenet_udp_sendrecv_wccp_port(squid_t)
 
-term_dontaudit_getattr_pty_dirs(squid_t)
+corenet_sendrecv_pgpkeyserver_client_packets(squid_t)
+corenet_tcp_connect_pgpkeyserver_port(squid_t)
+corenet_tcp_sendrecv_pgpkeyserver_port(squid_t)
 
-# to allow running programs from /usr/lib/squid (IE unlinkd)
 corecmd_exec_bin(squid_t)
 corecmd_exec_shell(squid_t)
 
+dev_read_sysfs(squid_t)
+dev_read_urand(squid_t)
+
 domain_use_interactive_fds(squid_t)
 
-files_read_etc_files(squid_t)
 files_read_etc_runtime_files(squid_t)
 files_read_usr_files(squid_t)
 files_search_spool(squid_t)
 files_dontaudit_getattr_tmp_dirs(squid_t)
 files_getattr_home_dir(squid_t)
+files_dontaudit_getattr_boot_dirs(squid_t)
+
+fs_getattr_all_fs(squid_t)
+fs_search_auto_mountpoints(squid_t)
+fs_list_inotifyfs(squid_t)
+
+selinux_dontaudit_getattr_dir(squid_t)
+
+term_dontaudit_getattr_pty_dirs(squid_t)
 
 auth_use_nsswitch(squid_t)
 auth_domtrans_chk_passwd(squid_t)
 
-# to allow running programs from /usr/lib/squid (IE unlinkd)
 libs_exec_lib_files(squid_t)
 
 logging_send_syslog_msg(squid_t)
@@ -170,21 +187,27 @@
 	corenet_tcp_connect_all_ports(squid_t)
 	corenet_tcp_bind_all_ports(squid_t)
 	corenet_sendrecv_all_packets(squid_t)
+	corenet_tcp_sendrecv_all_ports(squid_t)
 ')
 
 tunable_policy(`squid_use_tproxy',`
 	allow squid_t self:capability net_admin;
+	corenet_sendrecv_netport_server_packets(squid_t)
 	corenet_tcp_bind_netport_port(squid_t)
+	corenet_tcp_sendrecv_netport_port(squid_t)
 ')
 
 optional_policy(`
 	apache_content_template(squid)
 
-	allow httpd_squid_script_t self:tcp_socket create_socket_perms;
-
 	corenet_all_recvfrom_unlabeled(httpd_squid_script_t)
 	corenet_all_recvfrom_netlabel(httpd_squid_script_t)
+	corenet_tcp_sendrecv_generic_if(httpd_squid_script_t)
+	corenet_tcp_sendrecv_generic_node(httpd_squid_script_t)
+
+	corenet_sendrecv_http_cache_client_packets(httpd_squid_script_t)
 	corenet_tcp_connect_http_cache_port(httpd_squid_script_t)
+	corenet_tcp_sendrecv_http_cache_port(httpd_squid_script_t)
 
 	sysnet_dns_name_resolve(httpd_squid_script_t)
 
@@ -196,6 +219,11 @@
 ')
 
 optional_policy(`
+	kerberos_manage_host_rcache(squid_t)
+	kerberos_tmp_filetrans_host_rcache(squid_t, file, "host_0")
+')
+
+optional_policy(`
 	samba_domtrans_winbind_helper(squid_t)
 ')
 
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/sssd.fc refpolicy/policy/modules/contrib/sssd.fc
--- refpolicy/policy/modules/contrib/sssd.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/sssd.fc	2012-10-24 17:01:31.567003121 +0200
@@ -1,11 +1,15 @@
 /etc/rc\.d/init\.d/sssd	--	gen_context(system_u:object_r:sssd_initrc_exec_t,s0)
 
-/usr/sbin/sssd		--	gen_context(system_u:object_r:sssd_exec_t,s0)
+/etc/sssd(/.*)?	gen_context(system_u:object_r:sssd_conf_t,s0)
 
-/var/lib/sss(/.*)?		gen_context(system_u:object_r:sssd_var_lib_t,s0)
+/usr/sbin/sssd	--	gen_context(system_u:object_r:sssd_exec_t,s0)
+
+/var/lib/sss(/.*)?	gen_context(system_u:object_r:sssd_var_lib_t,s0)
+
+/var/lib/sss/mc(/.*)?	gen_context(system_u:object_r:sssd_public_t,s0)
 
 /var/lib/sss/pubconf(/.*)?	gen_context(system_u:object_r:sssd_public_t,s0)
 
-/var/log/sssd(/.*)?		gen_context(system_u:object_r:sssd_var_log_t,s0)
+/var/log/sssd(/.*)?	gen_context(system_u:object_r:sssd_var_log_t,s0)
 
-/var/run/sssd.pid	--	gen_context(system_u:object_r:sssd_var_run_t,s0)
+/var/run/sssd\.pid	--	gen_context(system_u:object_r:sssd_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/sssd.if refpolicy/policy/modules/contrib/sssd.if
--- refpolicy/policy/modules/contrib/sssd.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/sssd.if	2012-10-29 15:48:35.599186473 +0100
@@ -1,13 +1,31 @@
-## <summary>System Security Services Daemon</summary>
+## <summary>System Security Services Daemon.</summary>
+
+#######################################
+## <summary>
+##	Get attributes of sssd executable files.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`sssd_getattr_exec',`
+	gen_require(`
+		type sssd_exec_t;
+	')
+
+	allow $1 sssd_exec_t:file getattr_file_perms;
+')
 
 ########################################
 ## <summary>
 ##	Execute a domain transition to run sssd.
 ## </summary>
 ## <param name="domain">
-## <summary>
+##	<summary>
 ##	Domain allowed to transition.
-## </summary>
+##	</summary>
 ## </param>
 #
 interface(`sssd_domtrans',`
@@ -15,12 +33,14 @@
 		type sssd_t, sssd_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, sssd_exec_t, sssd_t)
 ')
 
 ########################################
 ## <summary>
-##	Execute sssd server in the sssd domain.
+##	Execute sssd init scripts in
+##	the initrc domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -36,6 +56,65 @@
 	init_labeled_script_domtrans($1, sssd_initrc_exec_t)
 ')
 
+#######################################
+## <summary>
+##	Read sssd configuration content.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`sssd_read_config',`
+	gen_require(`
+		type sssd_conf_t;
+	')
+
+	files_search_etc($1)
+	list_dirs_pattern($1, sssd_conf_t, sssd_conf_t)
+	read_files_pattern($1, sssd_conf_t, sssd_conf_t)
+')
+
+######################################
+## <summary>
+##	Write sssd configuration files.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`sssd_write_config',`
+	gen_require(`
+		type sssd_conf_t;
+	')
+
+	files_search_etc($1)
+	write_files_pattern($1, sssd_conf_t, sssd_conf_t)
+')
+
+####################################
+## <summary>
+##	Create, read, write, and delete
+##	sssd configuration files.
+## </summary>
+## <param name="domain">
+##  <summary>
+##  Domain allowed access.
+##  </summary>
+## </param>
+#
+interface(`sssd_manage_config',`
+	gen_require(`
+		type sssd_conf_t;
+	')
+
+	files_search_etc($1)
+	manage_files_pattern($1, sssd_conf_t, sssd_conf_t)
+')
+
 ########################################
 ## <summary>
 ##	Read sssd public files.
@@ -55,9 +134,29 @@
 	read_files_pattern($1, sssd_public_t, sssd_public_t)
 ')
 
+#######################################
+## <summary>
+##	Create, read, write, and delete
+##	sssd public files.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`sssd_manage_public_files',`
+	gen_require(`
+		type sssd_public_t;
+	')
+
+	sssd_search_lib($1)
+	manage_files_pattern($1, sssd_public_t, sssd_public_t)
+')
+
 ########################################
 ## <summary>
-##	Read sssd PID files.
+##	Read sssd pid files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -76,7 +175,8 @@
 
 ########################################
 ## <summary>
-##	Manage sssd var_run files.
+##	Create, read, write, and delete
+##	sssd pid content.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -89,6 +189,7 @@
 		type sssd_var_run_t;
 	')
 
+	files_search_pids($1)
 	manage_dirs_pattern($1, sssd_var_run_t, sssd_var_run_t)
 	manage_files_pattern($1, sssd_var_run_t, sssd_var_run_t)
 ')
@@ -114,7 +215,8 @@
 
 ########################################
 ## <summary>
-##	Do not audit attempts to search sssd lib directories.
+##	Do not audit attempts to search
+##	sssd lib directories.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -128,7 +230,6 @@
 	')
 
 	dontaudit $1 sssd_var_lib_t:dir search_dir_perms;
-	files_search_var_lib($1)
 ')
 
 ########################################
@@ -148,6 +249,7 @@
 
 	files_search_var_lib($1)
 	read_files_pattern($1, sssd_var_lib_t, sssd_var_lib_t)
+	read_lnk_files_pattern($1, sssd_var_lib_t, sssd_var_lib_t)
 ')
 
 ########################################
@@ -168,6 +270,7 @@
 
 	files_search_var_lib($1)
 	manage_files_pattern($1, sssd_var_lib_t, sssd_var_lib_t)
+	manage_lnk_files_pattern($1, sssd_var_lib_t, sssd_var_lib_t)
 ')
 
 ########################################
@@ -193,7 +296,8 @@
 
 ########################################
 ## <summary>
-##	Connect to sssd over an unix stream socket.
+##	Connect to sssd with a unix
+##	domain stream socket.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -212,8 +316,8 @@
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate
-##	an sssd environment
+##	All of the rules required to
+##	administrate an sssd environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -222,34 +326,35 @@
 ## </param>
 ## <param name="role">
 ##	<summary>
-##	The role to be allowed to manage the sssd domain.
-##	</summary>
-## </param>
-## <param name="terminal">
-##	<summary>
-##	The type of the user terminal.
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <rolecap/>
 #
 interface(`sssd_admin',`
 	gen_require(`
-		type sssd_t, sssd_public_t;
-		type sssd_initrc_exec_t;
+		type sssd_t, sssd_public_t, sssd_initrc_exec_t;
+		type sssd_var_lib_t, sssd_var_run_t, sssd_conf_t;
+		type sssd_log_t;
 	')
 
-	allow $1 sssd_t:process { ptrace signal_perms getattr };
-	read_files_pattern($1, sssd_t, sssd_t)
+	allow $1 sssd_t:process { ptrace signal_perms };
+	ps_process_pattern($1, sssd_t)
 
-	# Allow sssd_t to restart the apache service
 	sssd_initrc_domtrans($1)
 	domain_system_change_exemption($1)
 	role_transition $2 sssd_initrc_exec_t system_r;
 	allow $2 system_r;
 
-	sssd_manage_pids($1)
+	files_search_etc($1)
+	admin_pattern($1, sssd_conf_t)
 
-	sssd_manage_lib_files($1)
+	files_search_var_lib($1)
+	admin_pattern($1, { sssd_var_lib_t sssd_public_t })
+
+	files_search_pids($1)
+	admin_pattern($1, sssd_var_run_t)
 
-	admin_pattern($1, sssd_public_t)
+	logging_search_logs($1)
+	admin_pattern($1, sssd_log_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/sssd.te refpolicy/policy/modules/contrib/sssd.te
--- refpolicy/policy/modules/contrib/sssd.te	2012-07-10 14:45:57.000000000 +0200
+++ refpolicy/policy/modules/contrib/sssd.te	2012-10-29 15:48:35.599186473 +0100
@@ -1,4 +1,4 @@
-policy_module(sssd, 1.1.0)
+policy_module(sssd, 1.1.3)
 
 ########################################
 #
@@ -12,11 +12,15 @@
 type sssd_initrc_exec_t;
 init_script_file(sssd_initrc_exec_t)
 
+type sssd_conf_t;
+files_config_file(sssd_conf_t)
+
 type sssd_public_t;
 files_pid_file(sssd_public_t)
 
 type sssd_var_lib_t;
 files_type(sssd_var_lib_t)
+mls_trusted_object(sssd_var_lib_t)
 
 type sssd_var_log_t;
 logging_log_file(sssd_var_log_t)
@@ -26,69 +30,100 @@
 
 ########################################
 #
-# sssd local policy
+# Local policy
 #
-allow sssd_t self:capability { dac_read_search dac_override kill sys_nice setgid setuid };
-allow sssd_t self:process { setfscreate setsched sigkill signal getsched };
-allow sssd_t self:fifo_file rw_file_perms;
-allow sssd_t self:unix_stream_socket { create_stream_socket_perms connectto };
+
+allow sssd_t self:capability { chown dac_read_search dac_override kill net_admin sys_nice setgid setuid sys_admin sys_resource };
+allow sssd_t self:capability2 block_suspend;
+allow sssd_t self:process { setfscreate setsched sigkill signal getsched setrlimit };
+allow sssd_t self:fifo_file rw_fifo_file_perms;
+allow sssd_t self:key manage_key_perms;
+allow sssd_t self:unix_stream_socket { accept connectto listen };
+
+read_files_pattern(sssd_t, sssd_conf_t, sssd_conf_t)
 
 manage_dirs_pattern(sssd_t, sssd_public_t, sssd_public_t)
 manage_files_pattern(sssd_t, sssd_public_t, sssd_public_t)
 
 manage_dirs_pattern(sssd_t, sssd_var_lib_t, sssd_var_lib_t)
 manage_files_pattern(sssd_t, sssd_var_lib_t, sssd_var_lib_t)
+manage_lnk_files_pattern(sssd_t, sssd_var_lib_t, sssd_var_lib_t)
 manage_sock_files_pattern(sssd_t, sssd_var_lib_t, sssd_var_lib_t)
-files_var_lib_filetrans(sssd_t, sssd_var_lib_t, { file dir } )
+files_var_lib_filetrans(sssd_t, sssd_var_lib_t, { file dir })
 
-manage_files_pattern(sssd_t, sssd_var_log_t, sssd_var_log_t)
+append_files_pattern(sssd_t, sssd_var_log_t, sssd_var_log_t)
+create_files_pattern(sssd_t, sssd_var_log_t, sssd_var_log_t)
+setattr_files_pattern(sssd_t, sssd_var_log_t, sssd_var_log_t)
 logging_log_filetrans(sssd_t, sssd_var_log_t, file)
 
 manage_dirs_pattern(sssd_t, sssd_var_run_t, sssd_var_run_t)
 manage_files_pattern(sssd_t, sssd_var_run_t, sssd_var_run_t)
 files_pid_filetrans(sssd_t, sssd_var_run_t, { file dir })
 
+kernel_read_network_state(sssd_t)
 kernel_read_system_state(sssd_t)
 
+corenet_all_recvfrom_unlabeled(sssd_t)
+corenet_all_recvfrom_netlabel(sssd_t)
+corenet_udp_sendrecv_generic_if(sssd_t)
+corenet_udp_sendrecv_generic_node(sssd_t)
+corenet_udp_sendrecv_all_ports(sssd_t)
+corenet_udp_bind_generic_node(sssd_t)
+
+corenet_sendrecv_generic_server_packets(sssd_t)
+corenet_udp_bind_generic_port(sssd_t)
+corenet_dontaudit_udp_bind_all_ports(sssd_t)
+
 corecmd_exec_bin(sssd_t)
 
 dev_read_urand(sssd_t)
+dev_read_sysfs(sssd_t)
 
 domain_read_all_domains_state(sssd_t)
 domain_obj_id_change_exemption(sssd_t)
 
 files_list_tmp(sssd_t)
 files_read_etc_files(sssd_t)
+files_read_etc_runtime_files(sssd_t)
 files_read_usr_files(sssd_t)
+files_list_var_lib(sssd_t)
 
 fs_list_inotifyfs(sssd_t)
 
 selinux_validate_context(sssd_t)
 
 seutil_read_file_contexts(sssd_t)
+# sssd wants to write /etc/selinux/<policy>/logins/ for SELinux PAM module
+# seutil_rw_login_config_dirs(sssd_t)
+# seutil_manage_login_config_files(sssd_t)
 
 mls_file_read_to_clearance(sssd_t)
+mls_socket_read_to_clearance(sssd_t)
+mls_socket_write_to_clearance(sssd_t)
+mls_trusted_object(sssd_t)
 
-auth_use_nsswitch(sssd_t)
 auth_domtrans_chk_passwd(sssd_t)
 auth_domtrans_upd_passwd(sssd_t)
+auth_manage_cache(sssd_t)
 
 init_read_utmp(sssd_t)
 
 logging_send_syslog_msg(sssd_t)
 logging_send_audit_msgs(sssd_t)
 
+miscfiles_read_generic_certs(sssd_t)
 miscfiles_read_localization(sssd_t)
 
+sysnet_dns_name_resolve(sssd_t)
+sysnet_use_ldap(sssd_t)
+
 optional_policy(`
 	dbus_system_bus_client(sssd_t)
 	dbus_connect_system_bus(sssd_t)
 ')
 
 optional_policy(`
+	kerberos_read_config(sssd_t)
 	kerberos_manage_host_rcache(sssd_t)
-')
-
-optional_policy(`
-	ldap_stream_connect(sssd_t)
+	kerberos_tmp_filetrans_host_rcache(sssd_t, file, "host_0")
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/stunnel.fc refpolicy/policy/modules/contrib/stunnel.fc
--- refpolicy/policy/modules/contrib/stunnel.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/stunnel.fc	2012-10-29 15:48:37.216186477 +0100
@@ -1,7 +1,7 @@
-/etc/stunnel(/.*)?		gen_context(system_u:object_r:stunnel_etc_t,s0)
+/etc/stunnel(/.*)?	gen_context(system_u:object_r:stunnel_etc_t,s0)
 
 /usr/bin/stunnel	--	gen_context(system_u:object_r:stunnel_exec_t,s0)
 
 /usr/sbin/stunnel	--	gen_context(system_u:object_r:stunnel_exec_t,s0)
 
-/var/run/stunnel(/.*)?		gen_context(system_u:object_r:stunnel_var_run_t,s0)
+/var/run/stunnel(/.*)?	gen_context(system_u:object_r:stunnel_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/stunnel.if refpolicy/policy/modules/contrib/stunnel.if
--- refpolicy/policy/modules/contrib/stunnel.if	2012-05-04 15:16:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/stunnel.if	2012-10-29 15:48:38.929186480 +0100
@@ -1,4 +1,4 @@
-## <summary>SSL Tunneling Proxy</summary>
+## <summary>SSL Tunneling Proxy.</summary>
 
 ########################################
 ## <summary>
@@ -20,6 +20,6 @@
 		type stunnel_t;
 	')
 
-	domtrans_pattern(stunnel_t,$2,$1)
+	domtrans_pattern(stunnel_t, $2, $1)
 	allow $1 stunnel_t:tcp_socket rw_socket_perms;
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/stunnel.te refpolicy/policy/modules/contrib/stunnel.te
--- refpolicy/policy/modules/contrib/stunnel.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/stunnel.te	2012-10-29 15:48:38.930186480 +0100
@@ -1,4 +1,4 @@
-policy_module(stunnel, 1.10.0)
+policy_module(stunnel, 1.10.1)
 
 ########################################
 #
@@ -6,17 +6,8 @@
 #
 
 type stunnel_t;
-domain_type(stunnel_t)
-role system_r types stunnel_t;
-
 type stunnel_exec_t;
-domain_entry_file(stunnel_t, stunnel_exec_t)
-
-ifdef(`distro_gentoo',`
-	init_daemon_domain(stunnel_t, stunnel_exec_t)
-',`
-	inetd_tcp_service_domain(stunnel_t, stunnel_exec_t)
-')
+init_daemon_domain(stunnel_t, stunnel_exec_t)
 
 type stunnel_etc_t;
 files_config_file(stunnel_etc_t)
@@ -33,14 +24,15 @@
 #
 
 allow stunnel_t self:capability { setgid setuid sys_chroot };
+dontaudit stunnel_t self:capability sys_tty_config;
 allow stunnel_t self:process signal_perms;
 allow stunnel_t self:fifo_file rw_fifo_file_perms;
-allow stunnel_t self:tcp_socket create_stream_socket_perms;
-allow stunnel_t self:udp_socket create_socket_perms;
+allow stunnel_t self:tcp_socket { accept listen };
+allow stunnel_t self:netlink_tcpdiag_socket r_netlink_socket_perms;
 
 allow stunnel_t stunnel_etc_t:dir list_dir_perms;
 allow stunnel_t stunnel_etc_t:file read_file_perms;
-allow stunnel_t stunnel_etc_t:lnk_file { getattr read };
+allow stunnel_t stunnel_etc_t:lnk_file read_lnk_file_perms;
 
 manage_dirs_pattern(stunnel_t, stunnel_tmp_t, stunnel_tmp_t)
 manage_files_pattern(stunnel_t, stunnel_tmp_t, stunnel_tmp_t)
@@ -59,15 +51,23 @@
 corenet_all_recvfrom_unlabeled(stunnel_t)
 corenet_all_recvfrom_netlabel(stunnel_t)
 corenet_tcp_sendrecv_generic_if(stunnel_t)
-corenet_udp_sendrecv_generic_if(stunnel_t)
 corenet_tcp_sendrecv_generic_node(stunnel_t)
-corenet_udp_sendrecv_generic_node(stunnel_t)
 corenet_tcp_sendrecv_all_ports(stunnel_t)
-corenet_udp_sendrecv_all_ports(stunnel_t)
 corenet_tcp_bind_generic_node(stunnel_t)
+
+corenet_sendrecv_all_client_packets(stunnel_t)
 corenet_tcp_connect_all_ports(stunnel_t)
 
+dev_read_sysfs(stunnel_t)
+dev_read_urand(stunnel_t)
+
+domain_use_interactive_fds(stunnel_t)
+
+files_read_etc_runtime_files(stunnel_t)
+files_search_home(stunnel_t)
+
 fs_getattr_all_fs(stunnel_t)
+fs_search_auto_mountpoints(stunnel_t)
 
 auth_use_nsswitch(stunnel_t)
 
@@ -75,44 +75,27 @@
 
 miscfiles_read_localization(stunnel_t)
 
-sysnet_read_config(stunnel_t)
-
-ifdef(`distro_gentoo', `
-	dontaudit stunnel_t self:capability sys_tty_config;
-	allow stunnel_t self:udp_socket create_socket_perms;
-
-	dev_read_sysfs(stunnel_t)
+userdom_dontaudit_use_unpriv_user_fds(stunnel_t)
+userdom_dontaudit_search_user_home_dirs(stunnel_t)
 
-	fs_search_auto_mountpoints(stunnel_t)
-
-	domain_use_interactive_fds(stunnel_t)
-
-	userdom_dontaudit_use_unpriv_user_fds(stunnel_t)
-	userdom_dontaudit_search_user_home_dirs(stunnel_t)
-
-	optional_policy(`
-		daemontools_service_domain(stunnel_t, stunnel_exec_t)
-	')
-
-	optional_policy(`
-		seutil_sigchld_newrole(stunnel_t)
-	')
+optional_policy(`
+	daemontools_service_domain(stunnel_t, stunnel_exec_t)
+')
 
-	optional_policy(`
-		udev_read_db(stunnel_t)
-	')
-',`
-	allow stunnel_t self:netlink_tcpdiag_socket r_netlink_socket_perms;
+optional_policy(`
+	inetd_tcp_service_domain(stunnel_t, stunnel_exec_t)
+')
 
-	dev_read_urand(stunnel_t)
+optional_policy(`
+	kerberos_use(stunnel_t)
+')
 
-	files_read_etc_files(stunnel_t)
-	files_read_etc_runtime_files(stunnel_t)
-	files_search_home(stunnel_t)
+optional_policy(`
+	seutil_sigchld_newrole(stunnel_t)
+')
 
-	optional_policy(`
-		kerberos_use(stunnel_t)
-	')
+optional_policy(`
+	udev_read_db(stunnel_t)
 ')
 
 # hack since this port has no interfaces since it doesnt
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/svnserve.fc refpolicy/policy/modules/contrib/svnserve.fc
--- refpolicy/policy/modules/contrib/svnserve.fc	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/svnserve.fc	2012-09-24 21:24:46.727583659 +0200
@@ -0,0 +1,8 @@
+/etc/rc\.d/init\.d/svnserve	--	gen_context(system_u:object_r:svnserve_initrc_exec_t,s0)
+
+/usr/bin/svnserve	--	gen_context(system_u:object_r:svnserve_exec_t,s0)
+
+/var/lib/subversion/repo(/.*)?	gen_context(system_u:object_r:svnserve_content_t,s0)
+
+/var/run/svnserve(/.*)?	gen_context(system_u:object_r:svnserve_var_run_t,s0)
+/var/run/svnserve\.pid	--	gen_context(system_u:object_r:svnserve_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/svnserve.if refpolicy/policy/modules/contrib/svnserve.if
--- refpolicy/policy/modules/contrib/svnserve.if	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/svnserve.if	2012-09-24 21:24:46.727583659 +0200
@@ -0,0 +1,35 @@
+## <summary>Server for the svn repository access method.</summary>
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an svnserve environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`svnserve_admin',`
+	gen_require(`
+		type svnserve_t, svnserve_initrc_exec_t, svnserve_var_run_t;
+	')
+
+	allow $1 svnserve_t:process { ptrace signal_perms };
+	ps_process_pattern($1, svnserve_t)
+
+	init_labeled_script_domtrans($1, svnserve_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 svnserve_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	files_search_pids($1)
+	admin_pattern($1, httpd_var_run_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/svnserve.te refpolicy/policy/modules/contrib/svnserve.te
--- refpolicy/policy/modules/contrib/svnserve.te	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/svnserve.te	2012-09-24 21:24:46.727583659 +0200
@@ -0,0 +1,58 @@
+policy_module(svnserve, 1.0.1)
+
+########################################
+#
+# Declarations
+#
+
+type svnserve_t;
+type svnserve_exec_t;
+init_daemon_domain(svnserve_t, svnserve_exec_t)
+
+type svnserve_initrc_exec_t;
+init_script_file(svnserve_initrc_exec_t)
+
+type svnserve_content_t;
+files_type(svnserve_content_t)
+
+type svnserve_var_run_t;
+files_pid_file(svnserve_var_run_t)
+
+########################################
+#
+# Local policy
+#
+
+allow svnserve_t self:fifo_file rw_fifo_file_perms;
+allow svnserve_t self:unix_stream_socket { listen accept };
+
+manage_dirs_pattern(svnserve_t, svnserve_content_t, svnserve_content_t)
+manage_files_pattern(svnserve_t, svnserve_content_t, svnserve_content_t)
+
+manage_dirs_pattern(svnserve_t, svnserve_var_run_t, svnserve_var_run_t)
+manage_files_pattern(svnserve_t, svnserve_var_run_t, svnserve_var_run_t)
+files_pid_filetrans(svnserve_t, svnserve_var_run_t, { dir file })
+
+files_read_etc_files(svnserve_t)
+files_read_usr_files(svnserve_t)
+
+corenet_all_recvfrom_unlabeled(svnserve_t)
+corenet_all_recvfrom_netlabel(svnserve_t)
+corenet_tcp_sendrecv_generic_if(svnserve_t)
+corenet_udp_sendrecv_generic_if(svnserve_t)
+corenet_tcp_sendrecv_generic_node(svnserve_t)
+corenet_udp_sendrecv_generic_node(svnserve_t)
+corenet_tcp_bind_generic_node(svnserve_t)
+corenet_udp_bind_generic_node(svnserve_t)
+
+corenet_sendrecv_svn_server_packets(svnserve_t)
+corenet_tcp_bind_svn_port(svnserve_t)
+corenet_tcp_sendrecv_svn_port(svnserve_t)
+corenet_udp_bind_svn_port(svnserve_t)
+corenet_udp_sendrecv_svn_port(svnserve_t)
+
+logging_send_syslog_msg(svnserve_t)
+
+miscfiles_read_localization(svnserve_t)
+
+sysnet_dns_name_resolve(svnserve_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/sxid.fc refpolicy/policy/modules/contrib/sxid.fc
--- refpolicy/policy/modules/contrib/sxid.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/sxid.fc	2012-10-29 15:48:41.813186486 +0100
@@ -1,6 +1,7 @@
-/usr/bin/sxid		--	gen_context(system_u:object_r:sxid_exec_t,s0)
-/usr/sbin/checksecurity\.se --	gen_context(system_u:object_r:sxid_exec_t,s0)
+/usr/bin/sxid	--	gen_context(system_u:object_r:sxid_exec_t,s0)
+
+/usr/sbin/checksecurity\.se	--	gen_context(system_u:object_r:sxid_exec_t,s0)
 
 /var/log/setuid.*	--	gen_context(system_u:object_r:sxid_log_t,s0)
-/var/log/setuid\.today.* --	gen_context(system_u:object_r:sxid_log_t,s0)
+/var/log/setuid\.today.*	--	gen_context(system_u:object_r:sxid_log_t,s0)
 /var/log/sxid\.log.*	--	gen_context(system_u:object_r:sxid_log_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/sxid.if refpolicy/policy/modules/contrib/sxid.if
--- refpolicy/policy/modules/contrib/sxid.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/sxid.if	2012-10-29 15:48:41.813186486 +0100
@@ -1,9 +1,8 @@
-## <summary>SUID/SGID program monitoring</summary>
+## <summary>SUID/SGID program monitoring.</summary>
 
 ########################################
 ## <summary>
-##	Allow the specified domain to read
-##	sxid log files.
+##	Read sxid log files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/sxid.te refpolicy/policy/modules/contrib/sxid.te
--- refpolicy/policy/modules/contrib/sxid.te	2012-07-25 20:33:05.000000000 +0200
+++ refpolicy/policy/modules/contrib/sxid.te	2012-10-29 15:48:41.814186486 +0100
@@ -1,4 +1,4 @@
-policy_module(sxid, 1.7.0)
+policy_module(sxid, 1.7.1)
 
 ########################################
 #
@@ -27,7 +27,7 @@
 allow sxid_t self:tcp_socket create_stream_socket_perms;
 allow sxid_t self:udp_socket create_socket_perms;
 
-allow sxid_t sxid_log_t:file manage_file_perms;
+allow sxid_t sxid_log_t:file { append_file_perms create_file_perms setattr_file_perms };
 logging_log_filetrans(sxid_t, sxid_log_t, file)
 
 manage_dirs_pattern(sxid_t, sxid_tmp_t, sxid_tmp_t)
@@ -76,13 +76,17 @@
 
 miscfiles_read_localization(sxid_t)
 
-mount_exec(sxid_t)
-
 sysnet_read_config(sxid_t)
 
 userdom_dontaudit_use_unpriv_user_fds(sxid_t)
 
-cron_system_entry(sxid_t, sxid_exec_t)
+optional_policy(`
+	cron_system_entry(sxid_t, sxid_exec_t)
+')
+
+optional_policy(`
+	mount_exec(sxid_t)
+')
 
 optional_policy(`
 	mta_send_mail(sxid_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/sysstat.fc refpolicy/policy/modules/contrib/sysstat.fc
--- refpolicy/policy/modules/contrib/sysstat.fc	2012-05-04 16:22:01.000000000 +0200
+++ refpolicy/policy/modules/contrib/sysstat.fc	2012-10-29 15:48:44.325186491 +0100
@@ -1,8 +1,11 @@
+/etc/rc\.d/init\.d/sysstat	--	gen_context(system_u:object_r:sysstat_initrc_exec_t,s0)
 
-/usr/lib/atsar/atsa.*		--	gen_context(system_u:object_r:sysstat_exec_t,s0)
-/usr/lib/sa/sa.*		--	gen_context(system_u:object_r:sysstat_exec_t,s0)
-/usr/lib/sysstat/sa.*		--	gen_context(system_u:object_r:sysstat_exec_t,s0)
+/opt/sartest(/.*)?	gen_context(system_u:object_r:sysstat_log_t,s0)
 
-/var/log/atsar(/.*)?			gen_context(system_u:object_r:sysstat_log_t,s0)
-/var/log/sa(/.*)?			gen_context(system_u:object_r:sysstat_log_t,s0)
-/var/log/sysstat(/.*)?			gen_context(system_u:object_r:sysstat_log_t,s0)
+/usr/lib/atsar/atsa.*	--	gen_context(system_u:object_r:sysstat_exec_t,s0)
+/usr/lib/sa/sa.*	--	gen_context(system_u:object_r:sysstat_exec_t,s0)
+/usr/lib/sysstat/sa.*	--	gen_context(system_u:object_r:sysstat_exec_t,s0)
+
+/var/log/atsar(/.*)?	gen_context(system_u:object_r:sysstat_log_t,s0)
+/var/log/sa(/.*)?	gen_context(system_u:object_r:sysstat_log_t,s0)
+/var/log/sysstat(/.*)?	gen_context(system_u:object_r:sysstat_log_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/sysstat.if refpolicy/policy/modules/contrib/sysstat.if
--- refpolicy/policy/modules/contrib/sysstat.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/sysstat.if	2012-10-29 15:48:44.326186491 +0100
@@ -1,8 +1,9 @@
-## <summary>Policy for sysstat. Reports on various system states</summary>
+## <summary>Reports on various system states.</summary>
 
 ########################################
 ## <summary>
-##	Manage sysstat logs.
+##	Create, read, write, and delete
+##	sysstat log files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -19,3 +20,37 @@
 	logging_search_logs($1)
 	manage_files_pattern($1, sysstat_log_t, sysstat_log_t)
 ')
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an sysstat environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`sysstat_admin',`
+	gen_require(`
+		type sysstat_t, sysstat_initrc_exec_t, sysstat_log_t;
+	')
+
+	allow $1 sysstat_t:process { ptrace signal_perms };
+	ps_process_pattern($1, sysstat_t)
+
+	init_labeled_script_domtrans($1, sysstat_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 sysstat_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	logging_search_logs($1)
+	admin_pattern($1, sysstat_log_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/sysstat.te refpolicy/policy/modules/contrib/sysstat.te
--- refpolicy/policy/modules/contrib/sysstat.te	2012-07-25 20:33:05.000000000 +0200
+++ refpolicy/policy/modules/contrib/sysstat.te	2012-10-29 15:48:44.326186491 +0100
@@ -1,4 +1,4 @@
-policy_module(sysstat, 1.7.0)
+policy_module(sysstat, 1.7.1)
 
 ########################################
 #
@@ -8,7 +8,9 @@
 type sysstat_t;
 type sysstat_exec_t;
 init_system_domain(sysstat_t, sysstat_exec_t)
-role system_r types sysstat_t;
+
+type sysstat_initrc_exec_t;
+init_script_file(sysstat_initrc_exec_t)
 
 type sysstat_log_t;
 logging_log_file(sysstat_log_t)
@@ -18,18 +20,18 @@
 # Local policy
 #
 
-allow sysstat_t self:capability { dac_override sys_resource sys_tty_config };
-dontaudit sysstat_t self:capability sys_admin;
+allow sysstat_t self:capability { dac_override sys_admin sys_resource sys_tty_config };
 allow sysstat_t self:fifo_file rw_fifo_file_perms;
 
-can_exec(sysstat_t, sysstat_exec_t)
-
 manage_dirs_pattern(sysstat_t,sysstat_log_t,sysstat_log_t)
-manage_files_pattern(sysstat_t, sysstat_log_t, sysstat_log_t)
+append_files_pattern(sysstat_t, sysstat_log_t, sysstat_log_t)
+create_files_pattern(sysstat_t, sysstat_log_t, sysstat_log_t)
+setattr_files_pattern(sysstat_t, sysstat_log_t, sysstat_log_t)
 manage_lnk_files_pattern(sysstat_t,sysstat_log_t,sysstat_log_t)
 logging_log_filetrans(sysstat_t, sysstat_log_t, { file dir })
 
-# get info from /proc
+can_exec(sysstat_t, sysstat_exec_t)
+
 kernel_read_system_state(sysstat_t)
 kernel_read_network_state(sysstat_t)
 kernel_read_kernel_sysctls(sysstat_t)
@@ -38,14 +40,11 @@
 
 corecmd_exec_bin(sysstat_t)
 
-dev_read_urand(sysstat_t)
 dev_read_sysfs(sysstat_t)
+dev_read_urand(sysstat_t)
 
 files_search_var(sysstat_t)
-# for mtab
 files_read_etc_runtime_files(sysstat_t)
-#for fstab
-files_read_etc_files(sysstat_t)
 
 fs_getattr_xattr_fs(sysstat_t)
 fs_list_inotifyfs(sysstat_t)
@@ -53,10 +52,14 @@
 term_use_console(sysstat_t)
 term_use_all_terms(sysstat_t)
 
+auth_use_nsswitch(sysstat_t)
+
 init_use_fds(sysstat_t)
 
 locallogin_use_fds(sysstat_t)
 
+logging_send_syslog_msg(sysstat_t)
+
 miscfiles_read_localization(sysstat_t)
 
 userdom_dontaudit_list_user_home_dirs(sysstat_t)
@@ -64,7 +67,3 @@
 optional_policy(`
 	cron_system_entry(sysstat_t, sysstat_exec_t)
 ')
-
-optional_policy(`
-	logging_send_syslog_msg(sysstat_t)
-')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/systemtap.fc refpolicy/policy/modules/contrib/systemtap.fc
--- refpolicy/policy/modules/contrib/systemtap.fc	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/systemtap.fc	2012-09-08 18:51:23.395557869 +0200
@@ -0,0 +1,11 @@
+/etc/stap-server(/.*)?	--	gen_context(system_u:object_r:stapserver_conf_t,s0)
+
+/etc/rc\.d/init\.d/stap-server	--	gen_context(system_u:object_r:stapserver_initrc_exec_t,s0)
+
+/usr/bin/stap-server	--	gen_context(system_u:object_r:stapserver_exec_t,s0)
+
+/var/lib/stap-server(/.*)?	gen_context(system_u:object_r:stapserver_var_lib_t,s0)
+
+/var/log/stap-server(/.*)?	gen_context(system_u:object_r:stapserver_log_t,s0)
+
+/var/run/stap-server(/.*)?	gen_context(system_u:object_r:stapserver_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/systemtap.if refpolicy/policy/modules/contrib/systemtap.if
--- refpolicy/policy/modules/contrib/systemtap.if	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/systemtap.if	2012-09-24 21:12:10.171582041 +0200
@@ -0,0 +1,45 @@
+## <summary>instrumentation system for Linux.</summary>
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an stapserver environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`stapserver_admin',`
+	gen_require(`
+		type stapserver_t, stapserver_conf_t, stapserver_log_t;
+		type stap_server_var_run_t, stapserver_initrc_exec_t, stapserver_var_lib_t;
+	')
+
+	allow $1 stapserver_t:process { ptrace signal_perms };
+	ps_process_pattern($1, stapserver_t)
+
+	init_labeled_script_domtrans($1, stapserver_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 stapserver_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	files_search_etc($1)
+	admin_pattern($1, stapserver_conf_t)
+
+	files_search_var_lib($1)
+	admin_pattern($1, stapserver_var_lib_t)
+
+	logging_search_logs($1)
+	admin_pattern($1, stapserver_log_t)
+
+	files_search_pids($1)
+	admin_pattern($1, stapserver_var_run_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/systemtap.te refpolicy/policy/modules/contrib/systemtap.te
--- refpolicy/policy/modules/contrib/systemtap.te	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/systemtap.te	2012-09-24 21:26:52.187583936 +0200
@@ -0,0 +1,101 @@
+policy_module(systemtap, 1.0.2)
+
+########################################
+#
+# Declarations
+#
+
+type stapserver_t;
+type stapserver_exec_t;
+init_daemon_domain(stapserver_t, stapserver_exec_t)
+
+type stapserver_initrc_exec_t;
+init_script_file(stapserver_initrc_exec_t)
+
+type stapserver_conf_t;
+files_config_file(stapserver_conf_t)
+
+type stapserver_var_lib_t;
+files_type(stapserver_var_lib_t)
+
+type stapserver_log_t;
+logging_log_file(stapserver_log_t)
+
+type stapserver_var_run_t;
+files_pid_file(stapserver_var_run_t)
+
+########################################
+#
+# Local policy
+#
+
+allow stapserver_t self:capability { dac_override kill setuid setgid };
+allow stapserver_t self:process { setrlimit setsched signal };
+allow stapserver_t self:fifo_file rw_fifo_file_perms;
+allow stapserver_t self:key write;
+allow stapserver_t self:unix_stream_socket { accept listen };
+allow stapserver_t self:tcp_socket create_stream_socket_perms;
+
+allow stapserver_t stapserver_conf_t:file read_file_perms;
+
+manage_dirs_pattern(stapserver_t, stapserver_var_lib_t, stapserver_var_lib_t)
+manage_files_pattern(stapserver_t, stapserver_var_lib_t, stapserver_var_lib_t)
+files_var_lib_filetrans(stapserver_t, stapserver_var_lib_t, dir)
+
+manage_dirs_pattern(stapserver_t, stapserver_log_t, stapserver_log_t)
+append_files_pattern(stapserver_t, stapserver_log_t, stapserver_log_t)
+create_files_pattern(stapserver_t, stapserver_log_t, stapserver_log_t)
+setattr_files_pattern(stapserver_t, stapserver_log_t, stapserver_log_t)
+logging_log_filetrans(stapserver_t, stapserver_log_t, dir )
+
+manage_dirs_pattern(stapserver_t, stapserver_var_run_t, stapserver_var_run_t)
+manage_files_pattern(stapserver_t, stapserver_var_run_t, stapserver_var_run_t)
+files_pid_filetrans(stapserver_t, stapserver_var_run_t, dir )
+
+kernel_read_kernel_sysctls(stapserver_t)
+kernel_read_system_state(stapserver_t)
+
+corecmd_exec_bin(stapserver_t)
+corecmd_exec_shell(stapserver_t)
+
+domain_read_all_domains_state(stapserver_t)
+
+dev_read_rand(stapserver_t)
+dev_read_sysfs(stapserver_t)
+dev_read_urand(stapserver_t)
+
+files_list_tmp(stapserver_t)
+files_read_usr_files(stapserver_t)
+files_search_kernel_modules(stapserver_t)
+
+auth_use_nsswitch(stapserver_t)
+
+init_read_utmp(stapserver_t)
+
+logging_send_audit_msgs(stapserver_t)
+logging_send_syslog_msg(stapserver_t)
+
+miscfiles_read_localization(stapserver_t)
+miscfiles_read_hwdata(stapserver_t)
+
+userdom_use_user_terminals(stapserver_t)
+
+optional_policy(`
+	consoletype_exec(stapserver_t)
+')
+
+optional_policy(`
+	dbus_system_bus_client(stapserver_t)
+')
+
+optional_policy(`
+	hostname_exec(stapserver_t)
+')
+
+optional_policy(`
+	plymouthd_exec_plymouth(stapserver_t)
+')
+
+optional_policy(`
+	rpm_exec(stapserver_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/tcpd.fc refpolicy/policy/modules/contrib/tcpd.fc
--- refpolicy/policy/modules/contrib/tcpd.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/tcpd.fc	2012-10-29 15:48:46.764186496 +0100
@@ -1,2 +1 @@
-
-/usr/sbin/tcpd		--	gen_context(system_u:object_r:tcpd_exec_t,s0)
+/usr/sbin/tcpd	--	gen_context(system_u:object_r:tcpd_exec_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/tcpd.if refpolicy/policy/modules/contrib/tcpd.if
--- refpolicy/policy/modules/contrib/tcpd.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/tcpd.if	2012-10-29 15:48:46.764186496 +0100
@@ -1,4 +1,4 @@
-## <summary>Policy for TCP daemon.</summary>
+## <summary>TCP daemon.</summary>
 
 ########################################
 ## <summary>
@@ -15,6 +15,7 @@
 		type tcpd_t, tcpd_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, tcpd_exec_t, tcpd_t)
 ')
 
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/tcpd.te refpolicy/policy/modules/contrib/tcpd.te
--- refpolicy/policy/modules/contrib/tcpd.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/tcpd.te	2012-10-29 15:48:46.765186496 +0100
@@ -1,13 +1,13 @@
-policy_module(tcpd, 1.4.0)
+policy_module(tcpd, 1.4.1)
 
 ########################################
 #
 # Declarations
 #
+
 type tcpd_t;
 type tcpd_exec_t;
 inetd_tcp_service_domain(tcpd_t, tcpd_exec_t)
-role system_r types tcpd_t;
 
 type tcpd_tmp_t;
 files_tmp_file(tcpd_tmp_t)
@@ -16,6 +16,7 @@
 #
 # Local policy
 #
+
 allow tcpd_t self:tcp_socket create_stream_socket_perms;
 
 manage_dirs_pattern(tcpd_t, tcpd_tmp_t, tcpd_tmp_t)
@@ -30,11 +31,9 @@
 
 fs_getattr_xattr_fs(tcpd_t)
 
-# Run other daemons in the inetd child domain.
 corecmd_search_bin(tcpd_t)
 
 files_read_etc_files(tcpd_t)
-# no good reason for files_dontaudit_search_var, probably nscd
 files_dontaudit_search_var(tcpd_t)
 
 logging_send_syslog_msg(tcpd_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/tcsd.fc refpolicy/policy/modules/contrib/tcsd.fc
--- refpolicy/policy/modules/contrib/tcsd.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/tcsd.fc	2012-09-28 19:48:30.185028631 +0200
@@ -1,3 +1,6 @@
 /etc/rc\.d/init\.d/tcsd	--	gen_context(system_u:object_r:tcsd_initrc_exec_t,s0)
-/usr/sbin/tcsd		--	gen_context(system_u:object_r:tcsd_exec_t,s0)
-/var/lib/tpm(/.*)?		gen_context(system_u:object_r:tcsd_var_lib_t,s0)
+/etc/rc\.d/init\.d/trousers	--	gen_context(system_u:object_r:tcsd_initrc_exec_t,s0)
+
+/usr/sbin/tcsd	--	gen_context(system_u:object_r:tcsd_exec_t,s0)
+
+/var/lib/tpm(/.*)?	gen_context(system_u:object_r:tcsd_var_lib_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/tcsd.if refpolicy/policy/modules/contrib/tcsd.if
--- refpolicy/policy/modules/contrib/tcsd.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/tcsd.if	2012-10-29 15:48:48.312186500 +0100
@@ -1,13 +1,13 @@
-## <summary>TSS Core Services (TCS) daemon (tcsd) policy</summary>
+## <summary>TSS Core Services daemon.</summary>
 
 ########################################
 ## <summary>
 ##	Execute a domain transition to run tcsd.
 ## </summary>
 ## <param name="domain">
-## <summary>
-##	Domain allowed access.
-## </summary>
+##	<summary>
+##	Domain allowed to transition.
+##	</summary>
 ## </param>
 #
 interface(`tcsd_domtrans',`
@@ -15,16 +15,18 @@
 		type tcsd_t, tcsd_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, tcsd_exec_t, tcsd_t)
 ')
 
 ########################################
 ## <summary>
-##	Execute tcsd server in the tcsd domain.
+##	Execute tcsd init scripts in the
+##	initrc domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
-##	The type of the process performing this action.
+##	Domain allowed to transition.
 ##	</summary>
 ## </param>
 #
@@ -51,13 +53,14 @@
 		type tcsd_var_lib_t;
 	')
 
-	allow $1 tcsd_var_lib_t:dir search_dir_perms;
 	files_search_var_lib($1)
+	allow $1 tcsd_var_lib_t:dir search_dir_perms;
 ')
 
 ########################################
 ## <summary>
-##	Manage tcsd lib dirs files.
+##	Create, read, write, and delete
+##	tcsd lib directories.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -115,8 +118,8 @@
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate
-##	an tcsd environment
+##	All of the rules required to
+##	administrate an tcsd environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -132,9 +135,7 @@
 #
 interface(`tcsd_admin',`
 	gen_require(`
-		type tcsd_t;
-		type tcsd_initrc_exec_t;
-		type tcsd_var_lib_t;
+		type tcsd_t, tcsd_initrc_exec_t, tcsd_var_lib_t;
 	')
 
 	allow $1 tcsd_t:process { ptrace signal_perms };
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/tcsd.te refpolicy/policy/modules/contrib/tcsd.te
--- refpolicy/policy/modules/contrib/tcsd.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/tcsd.te	2012-10-29 15:48:48.330186500 +0100
@@ -1,4 +1,4 @@
-policy_module(tcsd, 1.0.0)
+policy_module(tcsd, 1.0.3)
 
 ########################################
 #
@@ -7,7 +7,6 @@
 
 type tcsd_t;
 type tcsd_exec_t;
-domain_type(tcsd_t)
 init_daemon_domain(tcsd_t, tcsd_exec_t)
 
 type tcsd_initrc_exec_t;
@@ -18,27 +17,30 @@
 
 ########################################
 #
-# tcsd local policy
+# Local policy
 #
 
 allow tcsd_t self:capability { dac_override setuid };
 allow tcsd_t self:process { signal sigkill };
-allow tcsd_t self:tcp_socket create_stream_socket_perms;
+allow tcsd_t self:tcp_socket { accept listen };
 
 manage_dirs_pattern(tcsd_t, tcsd_var_lib_t, tcsd_var_lib_t)
 manage_files_pattern(tcsd_t, tcsd_var_lib_t, tcsd_var_lib_t)
-files_var_lib_filetrans(tcsd_t, tcsd_var_lib_t, { file dir })
+files_var_lib_filetrans(tcsd_t, tcsd_var_lib_t, dir)
 
-# Accept connections on the TCS port over loopback.
 corenet_all_recvfrom_unlabeled(tcsd_t)
+corenet_all_recvfrom_netlabel(tcsd_t)
+corenet_tcp_sendrecv_generic_if(tcsd_t)
+corenet_tcp_sendrecv_generic_node(tcsd_t)
 corenet_tcp_bind_generic_node(tcsd_t)
+
+corenet_sendrecv_tcs_server_packets(tcsd_t)
 corenet_tcp_bind_tcs_port(tcsd_t)
+corenet_tcp_sendrecv_tcs_port(tcsd_t)
 
 dev_read_urand(tcsd_t)
-# Access /dev/tpm0.
 dev_rw_tpm(tcsd_t)
 
-files_read_etc_files(tcsd_t)
 files_read_usr_files(tcsd_t)
 
 auth_use_nsswitch(tcsd_t)
@@ -46,5 +48,3 @@
 logging_send_syslog_msg(tcsd_t)
 
 miscfiles_read_localization(tcsd_t)
-
-sysnet_dns_name_resolve(tcsd_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/telepathy.fc refpolicy/policy/modules/contrib/telepathy.fc
--- refpolicy/policy/modules/contrib/telepathy.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/telepathy.fc	2012-10-29 15:48:52.297186509 +0100
@@ -1,18 +1,34 @@
-HOME_DIR/\.cache/\.mc_connections	--	gen_context(system_u:object_r:telepathy_mission_control_cache_home_t, s0)
-HOME_DIR/\.cache/telepathy/logger/sqlite-data-journal -- gen_context(system_u:object_r:telepathy_logger_cache_home_t,s0)
-HOME_DIR/\.cache/telepathy/gabble(/.*)?		gen_context(system_u:object_r:telepathy_gabble_cache_home_t, s0)
-HOME_DIR/\.cache/wocky(/.*)?			gen_context(system_u:object_r:telepathy_gabble_cache_home_t, s0)
-HOME_DIR/\.mission-control(/.*)?		gen_context(system_u:object_r:telepathy_mission_control_home_t, s0)
-HOME_DIR/\.telepathy-sunshine(/.*)?		gen_context(system_u:object_r:telepathy_sunshine_home_t, s0)
-HOME_DIR/\.local/share/TpLogger(/.*)?		gen_context(system_u:object_r:telepathy_logger_data_home_t,s0)
+HOME_DIR/\.cache/\.mc_connections	--	gen_context(system_u:object_r:telepathy_mission_control_cache_home_t,s0)
+HOME_DIR/\.cache/telepathy(/.*)?	gen_context(system_u:object_r:telepathy_cache_home_t, s0)
+HOME_DIR/\.cache/telepathy/logger(/.*)?	gen_context(system_u:object_r:telepathy_logger_cache_home_t,s0)
+HOME_DIR/\.cache/telepathy/gabble(/.*)?	gen_context(system_u:object_r:telepathy_gabble_cache_home_t,s0)
+HOME_DIR/\.cache/wocky(/.*)?	gen_context(system_u:object_r:telepathy_gabble_cache_home_t,s0)
+HOME_DIR/\.mission-control(/.*)?	gen_context(system_u:object_r:telepathy_mission_control_home_t,s0)
+HOME_DIR/\.local/share/telepathy(/.*)?	gen_context(system_u:object_r:telepathy_data_home_t,s0)
+HOME_DIR/\.local/share/telepathy/mission-control(/.*)?	gen_context(system_u:object_r:telepathy_mission_control_data_home_t,s0)
+HOME_DIR/\.telepathy-sunshine(/.*)?	gen_context(system_u:object_r:telepathy_sunshine_home_t,s0)
+HOME_DIR/\.local/share/TpLogger(/.*)?	gen_context(system_u:object_r:telepathy_logger_data_home_t,s0)
 
-/usr/libexec/mission-control-5		--	gen_context(system_u:object_r:telepathy_mission_control_exec_t, s0)
-/usr/libexec/telepathy-butterfly	--	gen_context(system_u:object_r:telepathy_msn_exec_t, s0)
-/usr/libexec/telepathy-gabble		--	gen_context(system_u:object_r:telepathy_gabble_exec_t, s0)
-/usr/libexec/telepathy-haze		--	gen_context(system_u:object_r:telepathy_msn_exec_t, s0)
-/usr/libexec/telepathy-idle		--	gen_context(system_u:object_r:telepathy_idle_exec_t, s0)
-/usr/libexec/telepathy-logger		--	gen_context(system_u:object_r:telepathy_logger_exec_t,s0)
-/usr/libexec/telepathy-salut		--	gen_context(system_u:object_r:telepathy_salut_exec_t, s0)
-/usr/libexec/telepathy-sofiasip		--	gen_context(system_u:object_r:telepathy_sofiasip_exec_t, s0)
-/usr/libexec/telepathy-stream-engine	--	gen_context(system_u:object_r:telepathy_stream_engine_exec_t, s0)
-/usr/libexec/telepathy-sunshine		--	gen_context(system_u:object_r:telepathy_sunshine_exec_t, s0)
+/usr/lib/telepathy/mission-control-5	--	gen_context(system_u:object_r:telepathy_mission_control_exec_t,s0)
+/usr/lib/telepathy/telepathy-butterfly	--	gen_context(system_u:object_r:telepathy_msn_exec_t,s0)
+/usr/lib/telepathy/telepathy-gabble	--	gen_context(system_u:object_r:telepathy_gabble_exec_t,s0)
+/usr/lib/telepathy/telepathy-haze	--	gen_context(system_u:object_r:telepathy_msn_exec_t,s0)
+/usr/lib/telepathy/telepathy-idle	--	gen_context(system_u:object_r:telepathy_idle_exec_t,s0)
+/usr/lib/telepathy/telepathy-logger	--	gen_context(system_u:object_r:telepathy_logger_exec_t,s0)
+/usr/lib/telepathy/telepathy-salut	--	gen_context(system_u:object_r:telepathy_salut_exec_t,s0)
+/usr/lib/telepathy/telepathy-sofiasip	--	gen_context(system_u:object_r:telepathy_sofiasip_exec_t,s0)
+/usr/lib/telepathy/telepathy-rakia	--	gen_context(system_u:object_r:telepathy_sofiasip_exec_t,s0)
+/usr/lib/telepathy/telepathy-stream-engine	--	gen_context(system_u:object_r:telepathy_stream_engine_exec_t,s0)
+/usr/lib/telepathy/telepathy-sunshine	--	gen_context(system_u:object_r:telepathy_sunshine_exec_t,s0)
+
+/usr/libexec/mission-control-5	--	gen_context(system_u:object_r:telepathy_mission_control_exec_t,s0)
+/usr/libexec/telepathy-butterfly	--	gen_context(system_u:object_r:telepathy_msn_exec_t,s0)
+/usr/libexec/telepathy-gabble	--	gen_context(system_u:object_r:telepathy_gabble_exec_t,s0)
+/usr/libexec/telepathy-haze	--	gen_context(system_u:object_r:telepathy_msn_exec_t,s0)
+/usr/libexec/telepathy-idle	--	gen_context(system_u:object_r:telepathy_idle_exec_t,s0)
+/usr/libexec/telepathy-logger	--	gen_context(system_u:object_r:telepathy_logger_exec_t,s0)
+/usr/libexec/telepathy-salut	--	gen_context(system_u:object_r:telepathy_salut_exec_t, s0)
+/usr/libexec/telepathy-sofiasip	--	gen_context(system_u:object_r:telepathy_sofiasip_exec_t,s0)
+/usr/libexec/telepathy-rakia	--	gen_context(system_u:object_r:telepathy_sofiasip_exec_t,s0)
+/usr/libexec/telepathy-stream-engine	--	gen_context(system_u:object_r:telepathy_stream_engine_exec_t,s0)
+/usr/libexec/telepathy-sunshine	--	gen_context(system_u:object_r:telepathy_sunshine_exec_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/telepathy.if refpolicy/policy/modules/contrib/telepathy.if
--- refpolicy/policy/modules/contrib/telepathy.if	2012-07-10 14:44:44.000000000 +0200
+++ refpolicy/policy/modules/contrib/telepathy.if	2012-10-29 15:48:52.298186509 +0100
@@ -2,38 +2,45 @@
 
 #######################################
 ## <summary>
-##	Creates basic types for telepathy
-##	domain
+##	The template to define a telepathy domain.
 ## </summary>
-## <param name="prefix">
+## <param name="domain_prefix">
 ##	<summary>
-##	Prefix for the domain.
+##	Domain prefix to be used.
 ##	</summary>
 ## </param>
 #
-#
 template(`telepathy_domain_template',`
 	gen_require(`
-		attribute telepathy_domain;
-		attribute telepathy_executable;
+		attribute telepathy_domain, telepathy_executable, telepathy_tmp_content;
 	')
 
 	type telepathy_$1_t, telepathy_domain;
 	type telepathy_$1_exec_t, telepathy_executable;
 	userdom_user_application_domain(telepathy_$1_t, telepathy_$1_exec_t)
 
-	type telepathy_$1_tmp_t;
+	type telepathy_$1_tmp_t, telepathy_tmp_content;
 	userdom_user_tmp_file(telepathy_$1_tmp_t)
 
 	auth_use_nsswitch(telepathy_$1_t)
-
 ')
 
 #######################################
 ## <summary>
-##		Role access for telepathy domains
-###     that executes via dbus-session
+##	The role template for the telepathy module.
 ## </summary>
+## <desc>
+##	<p>
+##	This template creates a derived domains which are used
+##	for window manager applications.
+##	</p>
+## </desc>
+## <param name="role_prefix">
+##	<summary>
+##	The prefix of the user domain (e.g., user
+##	is the prefix for user_t).
+##	</summary>
+## </param>
 ## <param name="user_role">
 ##	<summary>
 ##	The role associated with the user domain.
@@ -45,9 +52,9 @@
 ##	</summary>
 ## </param>
 #
-template(`telepathy_role', `
+template(`telepathy_role_template',`
 	gen_require(`
-		attribute telepathy_domain;
+		attribute telepathy_domain, telepathy_tmp_content;
 		type telepathy_gabble_t, telepathy_sofiasip_t, telepathy_idle_t;
 		type telepathy_mission_control_t, telepathy_salut_t, telepathy_sunshine_t;
 		type telepathy_stream_engine_t, telepathy_msn_t, telepathy_gabble_exec_t;
@@ -56,59 +63,91 @@
 		type telepathy_mission_control_exec_t, telepathy_salut_exec_t;
 		type telepathy_sunshine_exec_t, telepathy_stream_engine_exec_t;
 		type telepathy_msn_exec_t;
+
+		type telepathy_mission_control_cache_home_t, telepathy_cache_home_t, telepathy_logger_cache_home_t;
+		type telepathy_gabble_cache_home_t, telepathy_mission_control_home_t, telepathy_data_home_t;
+		type telepathy_mission_control_data_home_t, telepathy_sunshine_home_t, telepathy_logger_data_home_t;
 	')
 
-	role $1 types telepathy_domain;
+	role $2 types telepathy_domain;
+
+	allow $3 telepathy_domain:process { ptrace signal_perms };
+	ps_process_pattern($3, telepathy_domain)
+
+	telepathy_gabble_stream_connect($3)
+	telepathy_msn_stream_connect($3)
+	telepathy_salut_stream_connect($3)
+
+	dbus_spec_session_domain($1, telepathy_gabble_exec_t, telepathy_gabble_t)
+	dbus_spec_session_domain($1, telepathy_sofiasip_exec_t, telepathy_sofiasip_t)
+	dbus_spec_session_domain($1, telepathy_idle_exec_t, telepathy_idle_t)
+	dbus_spec_session_domain($1, telepathy_logger_exec_t, telepathy_logger_t)
+	dbus_spec_session_domain($1, telepathy_mission_control_exec_t, telepathy_mission_control_t)
+	dbus_spec_session_domain($1, telepathy_salut_exec_t, telepathy_salut_t)
+	dbus_spec_session_domain($1, telepathy_sunshine_exec_t, telepathy_sunshine_t)
+	dbus_spec_session_domain($1, telepathy_stream_engine_exec_t, telepathy_stream_engine_t)
+	dbus_spec_session_domain($1, telepathy_msn_exec_t, telepathy_msn_t)
+
+	allow $3 { telepathy_mission_control_cache_home_t telepathy_cache_home_t telepathy_logger_cache_home_t }:dir { manage_dir_perms relabel_dir_perms };
+	allow $3 { telepathy_gabble_cache_home_t telepathy_mission_control_home_t telepathy_data_home_t }:dir { manage_dir_perms relabel_dir_perms };
+	allow $3 { telepathy_mission_control_data_home_t telepathy_sunshine_home_t telepathy_logger_data_home_t }:dir { manage_dir_perms relabel_dir_perms };
+
+	allow $3 { telepathy_mission_control_cache_home_t telepathy_cache_home_t telepathy_logger_cache_home_t }:file { manage_file_perms relabel_file_perms };
+	allow $3 { telepathy_gabble_cache_home_t telepathy_mission_control_home_t telepathy_data_home_t }:file { manage_file_perms relabel_file_perms };
+	allow $3 { telepathy_mission_control_data_home_t telepathy_sunshine_home_t telepathy_logger_data_home_t }:file { manage_file_perms relabel_file_perms };
+
+	filetrans_pattern($3, telepathy_cache_home_t, telepathy_gabble_cache_home_t, dir, "gabble")
+	# gnome_cache_filetrans($3, telepathy_gabble_cache_home_t, dir, "wocky")
+
+	filetrans_pattern($3, telepathy_cache_home_t, telepathy_logger_cache_home_t, dir, "logger")
+	# gnome_data_filetrans($3, telepathy_logger_data_home_t, dir, "TpLogger")
+
+	userdom_user_home_dir_filetrans($3, telepathy_mission_control_home_t, dir, ".mission-control")
+	filetrans_pattern($3, telepathy_data_home_t, telepathy_mission_control_data_home_t, dir, "mission-control")
+	# gnome_cache_filetrans($3, telepathy_mission_control_cache_home_t, file, ".mc_connections")
 
-	allow $2 telepathy_domain:process signal_perms;
-	ps_process_pattern($2, telepathy_domain)
+	userdom_user_home_dir_filetrans($3, telepathy_sunshine_home_t, dir, ".telepathy-sunshine")
 
-	telepathy_gabble_stream_connect($2)
-	telepathy_msn_stream_connect($2)
-	telepathy_salut_stream_connect($2)
-
-	dbus_session_domain($3, telepathy_gabble_exec_t, telepathy_gabble_t)
-	dbus_session_domain($3, telepathy_sofiasip_exec_t, telepathy_sofiasip_t)
-	dbus_session_domain($3, telepathy_idle_exec_t, telepathy_idle_t)
-	dbus_session_domain($3, telepathy_logger_exec_t, telepathy_logger_t)
-	dbus_session_domain($3, telepathy_mission_control_exec_t, telepathy_mission_control_t)
-	dbus_session_domain($3, telepathy_salut_exec_t, telepathy_salut_t)
-	dbus_session_domain($3, telepathy_sunshine_exec_t, telepathy_sunshine_t)
-	dbus_session_domain($3, telepathy_stream_engine_exec_t, telepathy_stream_engine_t)
-	dbus_session_domain($3, telepathy_msn_exec_t, telepathy_msn_t)
+	# gnome_cache_filetrans($3, telepathy_cache_home_t, dir, "telepathy")
+	# gnome_data_filetrans($3, telepathy_data_home_t, dir, "telepathy")
+
+	allow $3 telepathy_tmp_content:dir { manage_dir_perms relabel_dir_perms };
+	allow $3 telepathy_tmp_content:file { manage_file_perms relabel_file_perms };
+	allow $3 telepathy_tmp_content:sock_file { manage_sock_file_perms relabel_sock_file_perms };
 ')
 
 ########################################
 ## <summary>
-##	Stream connect to Telepathy Gabble
+##	Connect to gabble with a unix
+##	domain stream socket.
 ## </summary>
 ## <param name="domain">
-## 	<summary>
+##	<summary>
 ##	Domain allowed access.
 ##	</summary>
 ## </param>
 #
-interface(`telepathy_gabble_stream_connect', `
+interface(`telepathy_gabble_stream_connect',`
 	gen_require(`
 		type telepathy_gabble_t, telepathy_gabble_tmp_t;
 	')
 
-	stream_connect_pattern($1, telepathy_gabble_tmp_t, telepathy_gabble_tmp_t, telepathy_gabble_t)
 	files_search_tmp($1)
+	stream_connect_pattern($1, telepathy_gabble_tmp_t, telepathy_gabble_tmp_t, telepathy_gabble_t)
 ')
 
 ########################################
 ## <summary>
-##	Send DBus messages to and from
-##	Telepathy Gabble.
+##	Send dbus messages to and from
+##	gabble.
 ## </summary>
 ## <param name="domain">
-## 	<summary>
+##	<summary>
 ##	Domain allowed access.
 ##	</summary>
 ## </param>
 #
-interface(`telepathy_gabble_dbus_chat', `
+interface(`telepathy_gabble_dbus_chat',`
 	gen_require(`
 		type telepathy_gabble_t;
 		class dbus send_msg;
@@ -120,15 +159,10 @@
 
 ########################################
 ## <summary>
-##	Read telepathy mission control state.
+##	Read mission control process state files.
 ## </summary>
-## <param name="role_prefix">
-## 	<summary>
-##	Prefix to be used.
-##	</summary>
-## </param>
 ## <param name="domain">
-## 	<summary>
+##	<summary>
 ##	Domain allowed access.
 ##	</summary>
 ## </param>
@@ -139,12 +173,15 @@
 	')
 
 	kernel_search_proc($1)
-	ps_process_pattern($1, telepathy_mission_control_t)
+	allow $1 telepathy_mission_control_t:dir list_dir_perms;
+	allow $1 telepathy_mission_control_t:file read_file_perms;
+	allow $1 telepathy_mission_control_t:lnk_file read_lnk_file_perms;
 ')
 
 #######################################
 ## <summary>
-##	Stream connect to telepathy MSN managers
+##	Connect to msn with a unix
+##	domain stream socket.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -152,30 +189,31 @@
 ##	</summary>
 ## </param>
 #
-interface(`telepathy_msn_stream_connect', `
+interface(`telepathy_msn_stream_connect',`
 	gen_require(`
 		type telepathy_msn_t, telepathy_msn_tmp_t;
 	')
 
-	stream_connect_pattern($1, telepathy_msn_tmp_t, telepathy_msn_tmp_t, telepathy_msn_t)
 	files_search_tmp($1)
+	stream_connect_pattern($1, telepathy_msn_tmp_t, telepathy_msn_tmp_t, telepathy_msn_t)
 ')
 
 ########################################
 ## <summary>
-##	Stream connect to Telepathy Salut
+##	Connect to salut with a unix
+##	domain stream socket.
 ## </summary>
 ## <param name="domain">
-## 	<summary>
+##	<summary>
 ##	Domain allowed access.
 ##	</summary>
 ## </param>
 #
-interface(`telepathy_salut_stream_connect', `
+interface(`telepathy_salut_stream_connect',`
 	gen_require(`
 		type telepathy_salut_t, telepathy_salut_tmp_t;
 	')
 
-	stream_connect_pattern($1, telepathy_salut_tmp_t, telepathy_salut_tmp_t, telepathy_salut_t)
 	files_search_tmp($1)
+	stream_connect_pattern($1, telepathy_salut_tmp_t, telepathy_salut_tmp_t, telepathy_salut_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/telepathy.te refpolicy/policy/modules/contrib/telepathy.te
--- refpolicy/policy/modules/contrib/telepathy.te	2012-07-25 20:33:05.000000000 +0200
+++ refpolicy/policy/modules/contrib/telepathy.te	2012-10-29 15:48:52.321186509 +0100
@@ -1,37 +1,44 @@
-policy_module(telepathy, 1.3.0)
+policy_module(telepathy, 1.3.5)
 
 ########################################
 #
-# Declarations.
+# Declarations
 #
 
 ## <desc>
-## <p>
-##	Allow the Telepathy connection managers
-##	to connect to any generic TCP port.
-## </p>
+##	<p>
+##	Determine whether telepathy connection
+##	managers can connect to generic tcp ports.
+##	</p>
 ## </desc>
 gen_tunable(telepathy_tcp_connect_generic_network_ports, false)
 
 ## <desc>
-## <p>
-##	Allow the Telepathy connection managers
-##	to connect to any network port.
-## </p>
+##	<p>
+##	Determine whether telepathy connection
+##	managers can connect to any port.
+##	</p>
 ## </desc>
 gen_tunable(telepathy_connect_all_ports, false)
 
 attribute telepathy_domain;
 attribute telepathy_executable;
+attribute telepathy_tmp_content;
 
 telepathy_domain_template(gabble)
 
+type telepathy_cache_home_t;
+userdom_user_home_content(telepathy_cache_home_t)
+
 type telepathy_gabble_cache_home_t;
 userdom_user_home_content(telepathy_gabble_cache_home_t)
 
 telepathy_domain_template(idle)
 telepathy_domain_template(logger)
 
+type telepathy_data_home_t;
+userdom_user_home_content(telepathy_data_home_t)
+
 type telepathy_logger_cache_home_t;
 userdom_user_home_content(telepathy_logger_cache_home_t)
 
@@ -43,6 +50,9 @@
 type telepathy_mission_control_home_t;
 userdom_user_home_content(telepathy_mission_control_home_t)
 
+type telepathy_mission_control_data_home_t;
+userdom_user_home_content(telepathy_mission_control_data_home_t)
+
 type telepathy_mission_control_cache_home_t;
 userdom_user_home_content(telepathy_mission_control_cache_home_t)
 
@@ -57,45 +67,56 @@
 
 #######################################
 #
-# Telepathy Gabble local policy.
+# Gabble local policy
 #
 
-allow telepathy_gabble_t self:tcp_socket create_stream_socket_perms;
+allow telepathy_gabble_t self:tcp_socket { accept listen };
 allow telepathy_gabble_t self:unix_dgram_socket { create_socket_perms sendto };
 
+# ~/.cache/telepathy/gabble/caps-cache.db-journal
+manage_dirs_pattern(telepathy_gabble_t, telepathy_gabble_cache_home_t, telepathy_gabble_cache_home_t)
+manage_files_pattern(telepathy_gabble_t, telepathy_gabble_cache_home_t, telepathy_gabble_cache_home_t)
+filetrans_pattern(telepathy_gabble_t, telepathy_cache_home_t, telepathy_gabble_cache_home_t, dir, "gabble")
+# gnome_cache_filetrans(telepathy_gabble_t, telepathy_gabble_cache_home_t, dir, "wocky")
+
 manage_dirs_pattern(telepathy_gabble_t, telepathy_gabble_tmp_t, telepathy_gabble_tmp_t)
 manage_sock_files_pattern(telepathy_gabble_t, telepathy_gabble_tmp_t, telepathy_gabble_tmp_t)
 files_tmp_filetrans(telepathy_gabble_t, telepathy_gabble_tmp_t, { dir sock_file })
 
-corenet_all_recvfrom_netlabel(telepathy_gabble_t)
 corenet_all_recvfrom_unlabeled(telepathy_gabble_t)
+corenet_all_recvfrom_netlabel(telepathy_gabble_t)
 corenet_tcp_sendrecv_generic_if(telepathy_gabble_t)
 corenet_tcp_sendrecv_generic_node(telepathy_gabble_t)
-corenet_tcp_connect_http_port(telepathy_gabble_t)
-corenet_tcp_connect_jabber_client_port(telepathy_gabble_t)
-corenet_tcp_connect_vnc_port(telepathy_gabble_t)
+
 corenet_sendrecv_http_client_packets(telepathy_gabble_t)
+corenet_tcp_connect_http_port(telepathy_gabble_t)
+corenet_tcp_sendrecv_http_port(telepathy_gabble_t)
+
 corenet_sendrecv_jabber_client_client_packets(telepathy_gabble_t)
+corenet_tcp_connect_jabber_client_port(telepathy_gabble_t)
+corenet_tcp_sendrecv_jabber_client_port(telepathy_gabble_t)
+
 corenet_sendrecv_vnc_client_packets(telepathy_gabble_t)
+corenet_tcp_connect_vnc_port(telepathy_gabble_t)
+corenet_tcp_sendrecv_vnc_port(telepathy_gabble_t)
 
 dev_read_rand(telepathy_gabble_t)
 
 files_read_config_files(telepathy_gabble_t)
 files_read_usr_files(telepathy_gabble_t)
 
-fs_getattr_all_fs(telepathy_gabble_t)
-
 miscfiles_read_all_certs(telepathy_gabble_t)
 
 tunable_policy(`telepathy_connect_all_ports',`
+	corenet_sendrecv_all_client_packets(telepathy_gabble_t)
 	corenet_tcp_connect_all_ports(telepathy_gabble_t)
 	corenet_tcp_sendrecv_all_ports(telepathy_gabble_t)
-	corenet_udp_sendrecv_all_ports(telepathy_gabble_t)
 ')
 
 tunable_policy(`telepathy_tcp_connect_generic_network_ports',`
-	corenet_tcp_connect_generic_port(telepathy_gabble_t)
 	corenet_sendrecv_generic_client_packets(telepathy_gabble_t)
+	corenet_tcp_connect_generic_port(telepathy_gabble_t)
+	corenet_tcp_sendrecv_generic_port(telepathy_gabble_t)
 ')
 
 tunable_policy(`use_nfs_home_dirs',`
@@ -112,52 +133,63 @@
 	dbus_system_bus_client(telepathy_gabble_t)
 ')
 
+# optional_policy(`
+	# ~/.config/dconf/user
+	# gnome_manage_generic_home_content(telepathy_gabble_t)
+# ')
+
 #######################################
 #
-# Telepathy Idle local policy.
+# Idle local policy
 #
 
 corenet_all_recvfrom_netlabel(telepathy_idle_t)
 corenet_all_recvfrom_unlabeled(telepathy_idle_t)
 corenet_tcp_sendrecv_generic_if(telepathy_idle_t)
 corenet_tcp_sendrecv_generic_node(telepathy_idle_t)
+
+corenet_sendrecv_gatekeeper_client_packets(telepathy_idle_t)
 corenet_tcp_connect_gatekeeper_port(telepathy_idle_t)
-corenet_tcp_connect_ircd_port(telepathy_idle_t)
+corenet_tcp_sendrecv_gatekeeper_port(telepathy_idle_t)
+
 corenet_sendrecv_ircd_client_packets(telepathy_idle_t)
+corenet_tcp_connect_ircd_port(telepathy_idle_t)
+corenet_tcp_sendrecv_ircd_port(telepathy_idle_t)
 
 dev_read_rand(telepathy_idle_t)
 
-files_read_etc_files(telepathy_idle_t)
+files_read_usr_files(telepathy_idle_t)
 
 tunable_policy(`telepathy_connect_all_ports',`
+	corenet_sendrecv_all_client_packets(telepathy_idle_t)
 	corenet_tcp_connect_all_ports(telepathy_idle_t)
 	corenet_tcp_sendrecv_all_ports(telepathy_idle_t)
-	corenet_udp_sendrecv_all_ports(telepathy_idle_t)
 ')
 
 tunable_policy(`telepathy_tcp_connect_generic_network_ports',`
-	corenet_tcp_connect_generic_port(telepathy_idle_t)
 	corenet_sendrecv_generic_client_packets(telepathy_idle_t)
+	corenet_tcp_connect_generic_port(telepathy_idle_t)
+	corenet_tcp_sendrecv_generic_port(telepathy_idle_t)
 ')
 
 #######################################
 #
-# Telepathy Logger local policy.
+# Logger local policy
 #
 
 allow telepathy_logger_t self:unix_stream_socket create_socket_perms;
 
+manage_dirs_pattern(telepathy_logger_t, telepathy_logger_cache_home_t, telepathy_logger_cache_home_t)
 manage_files_pattern(telepathy_logger_t, telepathy_logger_cache_home_t, telepathy_logger_cache_home_t)
+filetrans_pattern(telepathy_logger_t, telepathy_cache_home_t, telepathy_logger_cache_home_t, dir, "logger")
 
 manage_dirs_pattern(telepathy_logger_t, telepathy_logger_data_home_t, telepathy_logger_data_home_t)
 manage_files_pattern(telepathy_logger_t, telepathy_logger_data_home_t, telepathy_logger_data_home_t)
+# gnome_data_filetrans(telepathy_logger_t, telepathy_logger_data_home_t, dir, "TpLogger")
 
-files_read_etc_files(telepathy_logger_t)
 files_read_usr_files(telepathy_logger_t)
 files_search_pids(telepathy_logger_t)
 
-fs_getattr_all_fs(telepathy_logger_t)
-
 tunable_policy(`use_nfs_home_dirs',`
 	fs_manage_nfs_dirs(telepathy_logger_t)
 	fs_manage_nfs_files(telepathy_logger_t)
@@ -168,20 +200,32 @@
 	fs_manage_cifs_files(telepathy_logger_t)
 ')
 
+# optional_policy(`
+	# ~/.config/dconf/user
+	# gnome_manage_generic_home_content(telepathy_logger_t)
+# ')
+
 #######################################
 #
-# Telepathy Mission-Control local policy.
+# Mission-Control local policy
 #
 
+allow telepathy_mission_control_t self:process setsched;
+
 manage_dirs_pattern(telepathy_mission_control_t, telepathy_mission_control_home_t, telepathy_mission_control_home_t)
 manage_files_pattern(telepathy_mission_control_t, telepathy_mission_control_home_t, telepathy_mission_control_home_t)
-userdom_user_home_dir_filetrans(telepathy_mission_control_t, telepathy_mission_control_home_t, { dir file })
+userdom_user_home_dir_filetrans(telepathy_mission_control_t, telepathy_mission_control_home_t, dir, ".mission-control")
 
-dev_read_rand(telepathy_mission_control_t)
+manage_dirs_pattern(telepathy_mission_control_t, telepathy_mission_control_data_home_t, telepathy_mission_control_data_home_t)
+manage_files_pattern(telepathy_mission_control_t, telepathy_mission_control_data_home_t, telepathy_mission_control_data_home_t)
+filetrans_pattern(telepathy_mission_control_t, telepathy_data_home_t, telepathy_mission_control_data_home_t, dir, "mission-control")
 
-fs_getattr_all_fs(telepathy_mission_control_t)
+manage_files_pattern(telepathy_mission_control_t, telepathy_mission_control_cache_home_t, telepathy_mission_control_cache_home_t)
+# gnome_cache_filetrans(telepathy_mission_control_t, telepathy_mission_control_cache_home_t, file, ".mc_connections")
+
+dev_read_rand(telepathy_mission_control_t)
 
-files_read_etc_files(telepathy_mission_control_t)
+files_list_tmp(telepathy_mission_control_t)
 files_read_usr_files(telepathy_mission_control_t)
 
 tunable_policy(`use_nfs_home_dirs',`
@@ -194,55 +238,87 @@
 	fs_manage_cifs_files(telepathy_mission_control_t)
 ')
 
+optional_policy(`
+	dbus_system_bus_client(telepathy_mission_control_t)
+
+	optional_policy(`
+		devicekit_dbus_chat_power(telepathy_mission_control_t)
+	')
+	optional_policy(`
+		gnome_dbus_chat_all_gkeyringd(telepathy_mission_control_t)
+	')
+	optional_policy(`
+		networkmanager_dbus_chat(telepathy_mission_control_t)
+	')
+')
+
+# optional_policy(`
+	# ~/.config/dconf/user
+	# gnome_manage_generic_home_content(telepathy_mission_control_t)
+# ')
+
 #######################################
 #
-# Telepathy Butterfly and Haze local policy.
+# Butterfly and Haze local policy
 #
 
 allow telepathy_msn_t self:process setsched;
-allow telepathy_msn_t self:unix_dgram_socket { write create connect };
 
 manage_dirs_pattern(telepathy_msn_t, telepathy_msn_tmp_t, telepathy_msn_tmp_t)
 manage_files_pattern(telepathy_msn_t, telepathy_msn_tmp_t, telepathy_msn_tmp_t)
 manage_sock_files_pattern(telepathy_msn_t, telepathy_msn_tmp_t, telepathy_msn_tmp_t)
 files_tmp_filetrans(telepathy_msn_t, telepathy_msn_tmp_t, { dir file sock_file })
+
 userdom_user_tmp_filetrans(telepathy_msn_t, telepathy_msn_tmp_t, { dir file sock_file })
 
+can_exec(telepathy_msn_t, telepathy_msn_tmp_t)
+
 corenet_all_recvfrom_netlabel(telepathy_msn_t)
 corenet_all_recvfrom_unlabeled(telepathy_msn_t)
 corenet_tcp_sendrecv_generic_if(telepathy_msn_t)
 corenet_tcp_sendrecv_generic_node(telepathy_msn_t)
-corenet_tcp_bind_generic_node(telepathy_msn_t)
+
+corenet_sendrecv_http_client_packets(telepathy_msn_t)
 corenet_tcp_connect_http_port(telepathy_msn_t)
+corenet_tcp_sendrecv_http_port(telepathy_msn_t)
+
+corenet_sendrecv_mmcc_client_packets(telepathy_msn_t)
 corenet_tcp_connect_mmcc_port(telepathy_msn_t)
+corenet_tcp_sendrecv_mmcc_port(telepathy_msn_t)
+
+corenet_sendrecv_msnp_client_packets(telepathy_msn_t)
 corenet_tcp_connect_msnp_port(telepathy_msn_t)
+corenet_tcp_sendrecv_msnp_port(telepathy_msn_t)
+
+corenet_sendrecv_sip_client_packets(telepathy_msn_t)
 corenet_tcp_connect_sip_port(telepathy_msn_t)
-corenet_sendrecv_http_client_packets(telepathy_msn_t)
-corenet_sendrecv_mmcc_client_packets(telepathy_msn_t)
-corenet_sendrecv_msnp_client_packets(telepathy_msn_t)
+corenet_tcp_sendrecv_sip_port(telepathy_msn_t)
 
 corecmd_exec_bin(telepathy_msn_t)
 corecmd_exec_shell(telepathy_msn_t)
-corecmd_read_bin_symlinks(telepathy_msn_t)
 
-files_read_etc_files(telepathy_msn_t)
 files_read_usr_files(telepathy_msn_t)
 
+init_read_state(telepathy_msn_t)
+
 libs_exec_ldconfig(telepathy_msn_t)
 
 logging_send_syslog_msg(telepathy_msn_t)
 
 miscfiles_read_all_certs(telepathy_msn_t)
 
+# userdom_dontaudit_setattr_user_tmp(telepathy_msn_t)
+
 tunable_policy(`telepathy_connect_all_ports',`
+	corenet_sendrecv_all_client_packets(telepathy_msn_t)
 	corenet_tcp_connect_all_ports(telepathy_msn_t)
 	corenet_tcp_sendrecv_all_ports(telepathy_msn_t)
-	corenet_udp_sendrecv_all_ports(telepathy_msn_t)
 ')
 
 tunable_policy(`telepathy_tcp_connect_generic_network_ports',`
-	corenet_tcp_connect_generic_port(telepathy_msn_t)
 	corenet_sendrecv_generic_client_packets(telepathy_msn_t)
+	corenet_tcp_connect_generic_port(telepathy_msn_t)
+	corenet_tcp_sendrecv_generic_port(telepathy_msn_t)
 ')
 
 optional_policy(`
@@ -253,12 +329,17 @@
 	')
 ')
 
+# optional_policy(`
+	# ~/.config/dconf/user
+	# gnome_manage_generic_home_content(telepathy_msn_t)
+# ')
+
 #######################################
 #
-# Telepathy Salut local policy.
+# Salut local policy
 #
 
-allow telepathy_salut_t self:tcp_socket create_stream_socket_perms;
+allow telepathy_salut_t self:tcp_socket { accept listen };
 
 manage_sock_files_pattern(telepathy_salut_t, telepathy_salut_tmp_t, telepathy_salut_tmp_t)
 files_tmp_filetrans(telepathy_salut_t, telepathy_salut_tmp_t, sock_file)
@@ -268,21 +349,23 @@
 corenet_tcp_sendrecv_generic_if(telepathy_salut_t)
 corenet_tcp_sendrecv_generic_node(telepathy_salut_t)
 corenet_tcp_bind_generic_node(telepathy_salut_t)
+
+corenet_sendrecv_presence_server_packets(telepathy_salut_t)
 corenet_tcp_bind_presence_port(telepathy_salut_t)
+corenet_sendrecv_presence_client_packets(telepathy_salut_t)
 corenet_tcp_connect_presence_port(telepathy_salut_t)
-corenet_sendrecv_presence_server_packets(telepathy_salut_t)
-
-files_read_etc_files(telepathy_salut_t)
+corenet_tcp_sendrecv_presence_port(telepathy_salut_t)
 
 tunable_policy(`telepathy_connect_all_ports',`
+	corenet_sendrecv_all_client_packets(telepathy_salut_t)
 	corenet_tcp_connect_all_ports(telepathy_salut_t)
 	corenet_tcp_sendrecv_all_ports(telepathy_salut_t)
-	corenet_udp_sendrecv_all_ports(telepathy_salut_t)
 ')
 
 tunable_policy(`telepathy_tcp_connect_generic_network_ports',`
-	corenet_tcp_connect_generic_port(telepathy_salut_t)
 	corenet_sendrecv_generic_client_packets(telepathy_salut_t)
+	corenet_tcp_connect_generic_port(telepathy_salut_t)
+	corenet_tcp_sendrecv_generic_port(telepathy_salut_t)
 ')
 
 optional_policy(`
@@ -295,11 +378,11 @@
 
 #######################################
 #
-# Telepathy Sofiasip local policy.
+# Sofiasip local policy
 #
 
-allow telepathy_sofiasip_t self:rawip_socket { create_socket_perms listen };
-allow telepathy_sofiasip_t self:tcp_socket create_stream_socket_perms;
+allow telepathy_sofiasip_t self:rawip_socket create_stream_socket_perms;
+allow telepathy_sofiasip_t self:tcp_socket { accept listen };
 
 corenet_all_recvfrom_netlabel(telepathy_sofiasip_t)
 corenet_all_recvfrom_unlabeled(telepathy_sofiasip_t)
@@ -309,43 +392,59 @@
 corenet_tcp_sendrecv_generic_node(telepathy_sofiasip_t)
 corenet_tcp_bind_generic_node(telepathy_sofiasip_t)
 corenet_raw_bind_generic_node(telepathy_sofiasip_t)
+
+corenet_sendrecv_all_server_packets(telepathy_sofiasip_t)
 corenet_tcp_bind_all_unreserved_ports(telepathy_sofiasip_t)
+corenet_tcp_sendrecv_all_ports(telepathy_sofiasip_t)
+
 corenet_dontaudit_tcp_bind_all_ports(telepathy_sofiasip_t)
-corenet_tcp_connect_sip_port(telepathy_sofiasip_t)
+
 corenet_sendrecv_sip_client_packets(telepathy_sofiasip_t)
+corenet_tcp_connect_sip_port(telepathy_sofiasip_t)
+corenet_tcp_sendrecv_sip_port(telepathy_sofiasip_t)
 
 kernel_request_load_module(telepathy_sofiasip_t)
 
 tunable_policy(`telepathy_connect_all_ports',`
+	corenet_sendrecv_all_client_packets(telepathy_sofiasip_t)
 	corenet_tcp_connect_all_ports(telepathy_sofiasip_t)
 	corenet_tcp_sendrecv_all_ports(telepathy_sofiasip_t)
-	corenet_udp_sendrecv_all_ports(telepathy_sofiasip_t)
 ')
 
 tunable_policy(`telepathy_tcp_connect_generic_network_ports',`
-	corenet_tcp_connect_generic_port(telepathy_sofiasip_t)
 	corenet_sendrecv_generic_client_packets(telepathy_sofiasip_t)
+	corenet_tcp_connect_generic_port(telepathy_sofiasip_t)
+	corenet_tcp_sendrecv_generic_port(telepathy_sofiasip_t)
 ')
 
 #######################################
 #
-# Telepathy Sunshine local policy.
+# Sunshine local policy
 #
 
 manage_dirs_pattern(telepathy_sunshine_t, telepathy_sunshine_home_t, telepathy_sunshine_home_t)
 manage_files_pattern(telepathy_sunshine_t, telepathy_sunshine_home_t, telepathy_sunshine_home_t)
-userdom_user_home_dir_filetrans(telepathy_sunshine_t, telepathy_sunshine_home_t, { dir file })
-userdom_search_user_home_dirs(telepathy_sunshine_t)
+userdom_user_home_dir_filetrans(telepathy_sunshine_t, telepathy_sunshine_home_t, dir, ".telepathy-sunshine")
 
 manage_files_pattern(telepathy_sunshine_t, telepathy_sunshine_tmp_t, telepathy_sunshine_tmp_t)
-exec_files_pattern(telepathy_sunshine_t, telepathy_sunshine_tmp_t, telepathy_sunshine_tmp_t)
 files_tmp_filetrans(telepathy_sunshine_t, telepathy_sunshine_tmp_t, file)
 
+can_exec(telepathy_sunshine_t, telepathy_sunshine_tmp_t)
+
 corecmd_exec_bin(telepathy_sunshine_t)
 
-files_read_etc_files(telepathy_sunshine_t)
 files_read_usr_files(telepathy_sunshine_t)
 
+tunable_policy(`use_nfs_home_dirs',`
+	fs_manage_nfs_dirs(telepathy_sunshine_t)
+	fs_manage_nfs_files(telepathy_sunshine_t)
+')
+
+tunable_policy(`use_samba_home_dirs',`
+	fs_manage_cifs_dirs(telepathy_sunshine_t)
+	fs_manage_cifs_files(telepathy_sunshine_t)
+')
+
 optional_policy(`
 	xserver_read_xdm_pid(telepathy_sunshine_t)
 	xserver_stream_connect(telepathy_sunshine_t)
@@ -353,18 +452,23 @@
 
 #######################################
 #
-# telepathy domains common policy
+# Common telepathy domain local policy
 #
 
 allow telepathy_domain self:process { getsched signal sigkill };
 allow telepathy_domain self:fifo_file rw_fifo_file_perms;
-allow telepathy_domain self:tcp_socket create_socket_perms;
-allow telepathy_domain self:udp_socket create_socket_perms;
+
+manage_dirs_pattern(telepathy_domain, telepathy_cache_home_t, telepathy_cache_home_t)
+# gnome_cache_filetrans(telepathy_domain, telepathy_cache_home_t, dir, "telepathy")
+
+manage_dirs_pattern(telepathy_domain, telepathy_data_home_t, telepathy_data_home_t)
+# gnome_data_filetrans(telepathy_domain, telepathy_data_home_t, dir, "telepathy")
 
 dev_read_urand(telepathy_domain)
 
 kernel_read_system_state(telepathy_domain)
 
+fs_getattr_all_fs(telepathy_domain)
 fs_search_auto_mountpoints(telepathy_domain)
 
 miscfiles_read_localization(telepathy_domain)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/telnet.fc refpolicy/policy/modules/contrib/telnet.fc
--- refpolicy/policy/modules/contrib/telnet.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/telnet.fc	2012-10-29 15:48:56.763186518 +0100
@@ -1,4 +1,3 @@
+/usr/sbin/in\.telnetd	--	gen_context(system_u:object_r:telnetd_exec_t,s0)
 
-/usr/sbin/in\.telnetd		--	gen_context(system_u:object_r:telnetd_exec_t,s0)
-
-/usr/kerberos/sbin/telnetd 	--	gen_context(system_u:object_r:telnetd_exec_t,s0)
+/usr/kerberos/sbin/telnetd	--	gen_context(system_u:object_r:telnetd_exec_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/telnet.if refpolicy/policy/modules/contrib/telnet.if
--- refpolicy/policy/modules/contrib/telnet.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/telnet.if	2012-10-24 17:01:23.936003105 +0200
@@ -1 +1,20 @@
-## <summary>Telnet daemon</summary>
+## <summary>Telnet daemon.</summary>
+
+########################################
+## <summary>
+##	Read and write telnetd pty devices.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`telnet_use_ptys',`
+	gen_require(`
+		type telnetd_devpts_t;
+	')
+
+	term_list_ptys($1)
+	allow $1 telnetd_devpts_t:chr_file rw_term_perms;
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/telnet.te refpolicy/policy/modules/contrib/telnet.te
--- refpolicy/policy/modules/contrib/telnet.te	2012-07-13 16:51:36.000000000 +0200
+++ refpolicy/policy/modules/contrib/telnet.te	2012-11-01 21:40:39.299784807 +0100
@@ -1,4 +1,4 @@
-policy_module(telnet, 1.10.0)
+policy_module(telnet, 1.10.2)
 
 ########################################
 #
@@ -8,9 +8,8 @@
 type telnetd_t;
 type telnetd_exec_t;
 inetd_service_domain(telnetd_t, telnetd_exec_t)
-role system_r types telnetd_t;
 
-type telnetd_devpts_t; #, userpty_type;
+type telnetd_devpts_t;
 term_login_pty(telnetd_devpts_t)
 
 type telnetd_tmp_t;
@@ -24,16 +23,11 @@
 # Local policy
 #
 
-allow telnetd_t self:capability { fsetid chown fowner sys_tty_config dac_override };
+allow telnetd_t self:capability { fsetid chown fowner setuid setgid sys_tty_config dac_override };
 allow telnetd_t self:process signal_perms;
 allow telnetd_t self:fifo_file rw_fifo_file_perms;
-allow telnetd_t self:tcp_socket connected_stream_socket_perms;
-allow telnetd_t self:udp_socket create_socket_perms;
-# for identd; cjp: this should probably only be inetd_child rules?
-allow telnetd_t self:netlink_tcpdiag_socket r_netlink_socket_perms;
-allow telnetd_t self:capability { setuid setgid };
 
-allow telnetd_t telnetd_devpts_t:chr_file { rw_chr_file_perms setattr };
+allow telnetd_t telnetd_devpts_t:chr_file { rw_chr_file_perms setattr_chr_file_perms };
 term_create_pty(telnetd_t, telnetd_devpts_t)
 
 manage_dirs_pattern(telnetd_t, telnetd_tmp_t, telnetd_tmp_t)
@@ -56,23 +50,21 @@
 corenet_tcp_sendrecv_all_ports(telnetd_t)
 corenet_udp_sendrecv_all_ports(telnetd_t)
 
+corecmd_search_bin(telnetd_t)
+
 dev_read_urand(telnetd_t)
 
 domain_interactive_fd(telnetd_t)
 
+files_read_usr_files(telnetd_t)
+files_read_etc_runtime_files(telnetd_t)
+files_search_home(telnetd_t)
+
 fs_getattr_xattr_fs(telnetd_t)
 
 auth_rw_login_records(telnetd_t)
 auth_use_nsswitch(telnetd_t)
 
-corecmd_search_bin(telnetd_t)
-
-files_read_usr_files(telnetd_t)
-files_read_etc_files(telnetd_t)
-files_read_etc_runtime_files(telnetd_t)
-# for identd; cjp: this should probably only be inetd_child rules?
-files_search_home(telnetd_t)
-
 init_rw_utmp(telnetd_t)
 
 logging_send_syslog_msg(telnetd_t)
@@ -81,8 +73,6 @@
 
 seutil_read_config(telnetd_t)
 
-remotelogin_domtrans(telnetd_t)
-
 userdom_search_user_home_dirs(telnetd_t)
 userdom_setattr_user_ptys(telnetd_t)
 
@@ -96,5 +86,10 @@
 
 optional_policy(`
 	kerberos_keytab_template(telnetd, telnetd_t)
+	kerberos_tmp_filetrans_host_rcache(telnetd_t, file, "host_0")
 	kerberos_manage_host_rcache(telnetd_t)
 ')
+
+optional_policy(`
+	remotelogin_domtrans(telnetd_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/tftp.fc refpolicy/policy/modules/contrib/tftp.fc
--- refpolicy/policy/modules/contrib/tftp.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/tftp.fc	2012-10-29 15:51:25.054186835 +0100
@@ -1,8 +1,9 @@
+/etc/xinetd\.d/tftp	--	gen_context(system_u:object_r:tftpd_conf_t,s0)
 
 /usr/sbin/atftpd	--	gen_context(system_u:object_r:tftpd_exec_t,s0)
 /usr/sbin/in\.tftpd	--	gen_context(system_u:object_r:tftpd_exec_t,s0)
 
-/tftpboot		-d	gen_context(system_u:object_r:tftpdir_t,s0)
-/tftpboot/.*			gen_context(system_u:object_r:tftpdir_t,s0)
+/tftpboot	-d	gen_context(system_u:object_r:tftpdir_t,s0)
+/tftpboot/.*	gen_context(system_u:object_r:tftpdir_t,s0)
 
-/var/lib/tftpboot(/.*)?		gen_context(system_u:object_r:tftpdir_rw_t,s0)
+/var/lib/tftpboot(/.*)?	gen_context(system_u:object_r:tftpdir_rw_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/tftp.if refpolicy/policy/modules/contrib/tftp.if
--- refpolicy/policy/modules/contrib/tftp.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/tftp.if	2012-10-29 15:51:29.418186843 +0100
@@ -1,8 +1,8 @@
-## <summary>Trivial file transfer protocol daemon</summary>
+## <summary>Trivial file transfer protocol daemon.</summary>
 
 ########################################
 ## <summary>
-##	Read tftp content
+##	Read tftp content files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -15,12 +15,14 @@
 		type tftpdir_t;
 	')
 
+	files_search_var_lib($1)
 	read_files_pattern($1, tftpdir_t, tftpdir_t)
 ')
 
 ########################################
 ## <summary>
-##	Manage tftp /var/lib files.
+##	Create, read, write, and delete
+##	tftp rw content.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -40,8 +42,111 @@
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate
-##	an tftp environment
+##	Read tftpd configuration files.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`tftp_read_config_files',`
+	gen_require(`
+		type tftpd_conf_t;
+	')
+
+	files_search_etc($1)
+	allow $1 tftpd_conf_t:file read_file_perms;
+')
+
+########################################
+## <summary>
+##	Create, read, write, and delete
+##	tftpd configuration files.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`tftp_manage_config_files',`
+	gen_require(`
+		type tftpd_conf_t;
+	')
+
+	files_search_etc($1)
+	allow $1 tftpd_conf_t:file manage_file_perms;
+')
+
+########################################
+## <summary>
+##	Create objects in etc directories
+##	with tftp conf type.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed to transition.
+##	</summary>
+## </param>
+## <param name="object_class">
+##	<summary>
+##	Class of the object being created.
+##	</summary>
+## </param>
+## <param name="name" optional="true">
+##	<summary>
+##	The name of the object being created.
+##	</summary>
+## </param>
+#
+interface(`tftp_etc_filetrans_config',`
+	gen_require(`
+		type tftp_conf_t;
+	')
+
+	files_etc_filetrans($1, tftp_conf_t, $2, $3)
+')
+
+########################################
+## <summary>
+##	Create objects in tftpdir directories
+##	with a private type.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="private_type">
+##	<summary>
+##	Private file type.
+##	</summary>
+## </param>
+## <param name="object_class">
+##	<summary>
+##	Class of the object being created.
+##	</summary>
+## </param>
+## <param name="name" optional="true">
+##	<summary>
+##	The name of the object being created.
+##	</summary>
+## </param>
+#
+interface(`tftp_filetrans_tftpdir',`
+	gen_require(`
+		type tftpdir_rw_t;
+	')
+
+	files_search_var_lib($1)
+	filetrans_pattern($1, tftpdir_rw_t, $2, $3, $4)
+')
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an tftp environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -53,14 +158,17 @@
 interface(`tftp_admin',`
 	gen_require(`
 		type tftpd_t, tftpdir_t, tftpdir_rw_t, tftpd_var_run_t;
+		type tftpd_conf_t;
 	')
 
-	allow $1 tftpd_t:process { ptrace signal_perms getattr };
+	allow $1 tftpd_t:process { ptrace signal_perms };
 	ps_process_pattern($1, tftpd_t)
 
-	admin_pattern($1, tftpdir_rw_t)
+	files_search_etc($1)
+	admin_pattern($1, tftpd_conf_t)
 
-	admin_pattern($1, tftpdir_t)
+	files_search_var_lib($1)
+	admin_pattern($1, { tftpdir_t tftpdir_rw_t })
 
 	files_list_pids($1)
 	admin_pattern($1, tftpd_var_run_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/tftp.te refpolicy/policy/modules/contrib/tftp.te
--- refpolicy/policy/modules/contrib/tftp.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/tftp.te	2012-10-29 15:51:29.437186844 +0100
@@ -1,4 +1,4 @@
-policy_module(tftp, 1.12.0)
+policy_module(tftp, 1.12.3)
 
 ########################################
 #
@@ -6,17 +6,30 @@
 #
 
 ## <desc>
-## <p>
-## Allow tftp to modify public files
-## used for public file transfer services.
-## </p>
+##	<p>
+##	Determine whether tftp can modify
+##	public files used for public file
+##	transfer services. Directories/Files must
+##	be labeled public_content_rw_t.
+##	</p>
 ## </desc>
 gen_tunable(tftp_anon_write, false)
 
+## <desc>
+##	<p>
+##	Determine whether tftp can manage
+##	generic user home content.
+##	</p>
+## </desc>
+gen_tunable(tftp_enable_homedir, false)
+
 type tftpd_t;
 type tftpd_exec_t;
 init_daemon_domain(tftpd_t, tftpd_exec_t)
 
+type tftpd_conf_t;
+files_config_file(tftpd_conf_t)
+
 type tftpd_var_run_t;
 files_pid_file(tftpd_var_run_t)
 
@@ -32,15 +45,15 @@
 #
 
 allow tftpd_t self:capability { setgid setuid sys_chroot };
-allow tftpd_t self:tcp_socket create_stream_socket_perms;
-allow tftpd_t self:udp_socket create_socket_perms;
-allow tftpd_t self:unix_dgram_socket create_socket_perms;
-allow tftpd_t self:unix_stream_socket create_stream_socket_perms;
 dontaudit tftpd_t self:capability sys_tty_config;
+allow tftpd_t self:tcp_socket { accept listen };
+allow tftpd_t self:unix_stream_socket { accept listen };
+
+allow tftpd_t tftpd_conf_t:file read_file_perms;
 
 allow tftpd_t tftpdir_t:dir list_dir_perms;
 allow tftpd_t tftpdir_t:file read_file_perms;
-allow tftpd_t tftpdir_t:lnk_file { getattr read };
+allow tftpd_t tftpdir_t:lnk_file read_lnk_file_perms;
 
 manage_dirs_pattern(tftpd_t, tftpdir_rw_t, tftpdir_rw_t)
 manage_files_pattern(tftpd_t, tftpdir_rw_t, tftpdir_rw_t)
@@ -54,30 +67,26 @@
 
 corenet_all_recvfrom_unlabeled(tftpd_t)
 corenet_all_recvfrom_netlabel(tftpd_t)
-corenet_tcp_sendrecv_generic_if(tftpd_t)
 corenet_udp_sendrecv_generic_if(tftpd_t)
-corenet_tcp_sendrecv_generic_node(tftpd_t)
 corenet_udp_sendrecv_generic_node(tftpd_t)
-corenet_tcp_sendrecv_all_ports(tftpd_t)
-corenet_udp_sendrecv_all_ports(tftpd_t)
-corenet_tcp_bind_generic_node(tftpd_t)
 corenet_udp_bind_generic_node(tftpd_t)
-corenet_udp_bind_tftp_port(tftpd_t)
+
 corenet_sendrecv_tftp_server_packets(tftpd_t)
+corenet_udp_bind_tftp_port(tftpd_t)
+corenet_udp_sendrecv_tftp_port(tftpd_t)
 
 dev_read_sysfs(tftpd_t)
 
-fs_getattr_all_fs(tftpd_t)
-fs_search_auto_mountpoints(tftpd_t)
-
 domain_use_interactive_fds(tftpd_t)
 
-files_read_etc_files(tftpd_t)
 files_read_etc_runtime_files(tftpd_t)
 files_read_var_files(tftpd_t)
 files_read_var_symlinks(tftpd_t)
 files_search_var(tftpd_t)
 
+fs_getattr_all_fs(tftpd_t)
+fs_search_auto_mountpoints(tftpd_t)
+
 auth_use_nsswitch(tftpd_t)
 
 logging_send_syslog_msg(tftpd_t)
@@ -87,12 +96,37 @@
 
 userdom_dontaudit_use_unpriv_user_fds(tftpd_t)
 userdom_dontaudit_use_user_terminals(tftpd_t)
-userdom_dontaudit_search_user_home_dirs(tftpd_t)
+userdom_user_home_dir_filetrans_user_home_content(tftpd_t, { dir file lnk_file })
 
 tunable_policy(`tftp_anon_write',`
 	miscfiles_manage_public_files(tftpd_t)
 ')
 
+tunable_policy(`tftp_enable_homedir',`
+	allow tftpd_t self:capability { dac_override dac_read_search };
+
+	files_list_home(tftpd_t)
+	userdom_manage_user_home_content_dirs(tftpd_t)
+	userdom_manage_user_home_content_files(tftpd_t)
+	userdom_manage_user_home_content_symlinks(tftpd_t)
+')
+
+tunable_policy(`tftp_enable_homedir && use_nfs_home_dirs',`
+	fs_manage_nfs_dirs(tftpd_t)
+	fs_manage_nfs_files(tftpd_t)
+	fs_read_nfs_symlinks(tftpd_t)
+')
+
+tunable_policy(`tftp_enable_homedir && use_samba_home_dirs',`
+	fs_manage_cifs_dirs(tftpd_t)
+	fs_manage_cifs_files(tftpd_t)
+	fs_read_cifs_symlinks(tftpd_t)
+')
+
+optional_policy(`
+	cobbler_read_lib_files(tftpd_t)
+')
+
 optional_policy(`
 	inetd_udp_service_domain(tftpd_t, tftpd_exec_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/tgtd.fc refpolicy/policy/modules/contrib/tgtd.fc
--- refpolicy/policy/modules/contrib/tgtd.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/tgtd.fc	2012-10-29 15:51:31.905186849 +0100
@@ -1,3 +1,7 @@
-/etc/rc\.d/init\.d/tgtd		--	gen_context(system_u:object_r:tgtd_initrc_exec_t,s0)
-/usr/sbin/tgtd			--	gen_context(system_u:object_r:tgtd_exec_t,s0)
-/var/lib/tgtd(/.*)?			gen_context(system_u:object_r:tgtd_var_lib_t,s0)
+/etc/rc\.d/init\.d/tgtd	--	gen_context(system_u:object_r:tgtd_initrc_exec_t,s0)
+
+/usr/sbin/tgtd	--	gen_context(system_u:object_r:tgtd_exec_t,s0)
+
+/var/lib/tgtd(/.*)?	gen_context(system_u:object_r:tgtd_var_lib_t,s0)
+
+/var/run/tgtd.*	-s	gen_context(system_u:object_r:tgtd_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/tgtd.if refpolicy/policy/modules/contrib/tgtd.if
--- refpolicy/policy/modules/contrib/tgtd.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/tgtd.if	2012-10-29 15:51:31.905186849 +0100
@@ -1,17 +1,8 @@
 ## <summary>Linux Target Framework Daemon.</summary>
-## <desc>
-##	<p>
-##	Linux target framework (tgt) aims to simplify various
-##	SCSI target driver (iSCSI, Fibre Channel, SRP, etc) creation
-##	and maintenance. Our key goals are the clean integration into
-##	the scsi-mid layer and implementing a great portion of tgt
-##	in user space.
-##	</p>
-## </desc>
 
 #####################################
 ## <summary>
-##	Allow read and write access to tgtd semaphores.
+##	Read and write tgtd semaphores.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -29,7 +20,8 @@
 
 ######################################
 ## <summary>
-##	Manage tgtd sempaphores.
+##	Create, read, write, and delete
+##	tgtd sempaphores.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -44,3 +36,67 @@
 
 	allow $1 tgtd_t:sem create_sem_perms;
 ')
+
+######################################
+## <summary>
+##	Connect to tgtd with a unix
+##	domain stream socket.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`tgtd_stream_connect',`
+	gen_require(`
+		type tgtd_t, tgtd_var_run_t;
+	')
+
+	files_search_pids($1)
+	stream_connect_pattern($1, tgtd_var_run_t, tgtd_var_run_t, tgtd_t)
+')
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an tgtd environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`tgtd_admin',`
+	gen_require(`
+		type tgtd_t, tgtd_initrc_exec_t, tgtd_var_lib_t;
+		type tgtd_var_run_t, tgtd_tmp_t, tgtd_tmpfs_t;
+	')
+
+	allow $1 tgtd_t:process { ptrace signal_perms };
+	ps_process_pattern($1, tgtd_t)
+
+	init_labeled_script_domtrans($1, tgtd_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 tgtd_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	files_search_var_lib($1)
+	admin_pattern($1, tgtd_var_lib_t)
+
+	files_search_pids($1)
+	admin_pattern($1, tgtd_var_run_t)
+
+	files_search_tmp($1)
+	admin_pattern($1, tgtd_tmp_t)
+
+	files_search_tmpfs($1)
+	admin_pattern($1, tgtd_tmpfs_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/tgtd.te refpolicy/policy/modules/contrib/tgtd.te
--- refpolicy/policy/modules/contrib/tgtd.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/tgtd.te	2012-10-29 15:51:31.906186849 +0100
@@ -1,8 +1,8 @@
-policy_module(tgtd, 1.2.0)
+policy_module(tgtd, 1.2.2)
 
 ########################################
 #
-# TGTD personal declarations.
+# Declarations
 #
 
 type tgtd_t;
@@ -21,23 +21,25 @@
 type tgtd_var_lib_t;
 files_type(tgtd_var_lib_t)
 
+type tgtd_var_run_t;
+files_pid_file(tgtd_var_run_t)
+
 ########################################
 #
-# TGTD personal policy.
+# Local policy
 #
 
 allow tgtd_t self:capability sys_resource;
 allow tgtd_t self:process { setrlimit signal };
 allow tgtd_t self:fifo_file rw_fifo_file_perms;
-allow tgtd_t self:netlink_route_socket { create_socket_perms nlmsg_read };
+allow tgtd_t self:netlink_route_socket r_netlink_socket_perms;
 allow tgtd_t self:shm create_shm_perms;
 allow tgtd_t self:sem create_sem_perms;
 allow tgtd_t self:tcp_socket create_stream_socket_perms;
 allow tgtd_t self:udp_socket create_socket_perms;
-allow tgtd_t self:unix_dgram_socket create_socket_perms;
 
 manage_sock_files_pattern(tgtd_t, tgtd_tmp_t, tgtd_tmp_t)
-files_tmp_filetrans(tgtd_t, tgtd_tmp_t, { sock_file })
+files_tmp_filetrans(tgtd_t, tgtd_tmp_t, sock_file)
 
 manage_files_pattern(tgtd_t, tgtd_tmpfs_t, tgtd_tmpfs_t)
 fs_tmpfs_filetrans(tgtd_t, tgtd_tmpfs_t, file)
@@ -46,21 +48,36 @@
 manage_files_pattern(tgtd_t, tgtd_var_lib_t, tgtd_var_lib_t)
 files_var_lib_filetrans(tgtd_t, tgtd_var_lib_t, { dir file })
 
+manage_dirs_pattern(tgtd_t, tgtd_var_run_t,tgtd_var_run_t)
+manage_files_pattern(tgtd_t, tgtd_var_run_t,tgtd_var_run_t)
+manage_sock_files_pattern(tgtd_t, tgtd_var_run_t,tgtd_var_run_t)
+files_pid_filetrans(tgtd_t,tgtd_var_run_t, { file sock_file })
+
+kernel_read_system_state(tgtd_t)
 kernel_read_fs_sysctls(tgtd_t)
 
 corenet_all_recvfrom_netlabel(tgtd_t)
 corenet_all_recvfrom_unlabeled(tgtd_t)
 corenet_tcp_sendrecv_generic_if(tgtd_t)
 corenet_tcp_sendrecv_generic_node(tgtd_t)
-corenet_tcp_sendrecv_iscsi_port(tgtd_t)
 corenet_tcp_bind_generic_node(tgtd_t)
-corenet_tcp_bind_iscsi_port(tgtd_t)
+
 corenet_sendrecv_iscsi_server_packets(tgtd_t)
+corenet_tcp_bind_iscsi_port(tgtd_t)
+corenet_tcp_sendrecv_iscsi_port(tgtd_t)
+
+dev_read_sysfs(tgtd_t)
 
 files_read_etc_files(tgtd_t)
 
+fs_read_anon_inodefs_files(tgtd_t)
+
 storage_manage_fixed_disk(tgtd_t)
 
 logging_send_syslog_msg(tgtd_t)
 
 miscfiles_read_localization(tgtd_t)
+
+optional_policy(`
+	iscsi_manage_semaphores(tgtd_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/thunderbird.fc refpolicy/policy/modules/contrib/thunderbird.fc
--- refpolicy/policy/modules/contrib/thunderbird.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/thunderbird.fc	2012-10-29 15:51:34.884186856 +0100
@@ -1,6 +1,3 @@
-#
-# /usr
-#
-/usr/bin/thunderbird.*			--	gen_context(system_u:object_r:thunderbird_exec_t,s0)
+HOME_DIR/\.thunderbird(/.*)?	gen_context(system_u:object_r:thunderbird_home_t,s0)
 
-HOME_DIR/\.thunderbird(/.*)?			gen_context(system_u:object_r:thunderbird_home_t,s0)
+/usr/bin/thunderbird.*	--	gen_context(system_u:object_r:thunderbird_exec_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/thunderbird.if refpolicy/policy/modules/contrib/thunderbird.if
--- refpolicy/policy/modules/contrib/thunderbird.if	2012-05-04 15:16:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/thunderbird.if	2012-10-29 15:51:34.884186856 +0100
@@ -1,52 +1,47 @@
-## <summary>Thunderbird email client</summary>
+## <summary>Thunderbird email client.</summary>
 
 ########################################
 ## <summary>
-##	Role access for thunderbird
+##	Role access for thunderbird.
 ## </summary>
 ## <param name="role">
 ##	<summary>
-##	Role allowed access
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <param name="domain">
 ##	<summary>
-##	User domain for the role
+##	User domain for the role.
 ##	</summary>
 ## </param>
 #
 interface(`thunderbird_role',`
 	gen_require(`
-		type thunderbird_t, thunderbird_exec_t;
-		type thunderbird_home_t, thunderbird_tmpfs_t;
+		attribute_role thunderbird_roles;
+		type thunderbird_t, thunderbird_exec_t, thunderbird_home_t;
+		type thunderbird_tmpfs_t;
 	')
 
-	role $1 types thunderbird_t;
+	roleattribute $1 thunderbird_roles;
+
+	domtrans_pattern($2, thunderbird_exec_t, thunderbird_t)
+
+	stream_connect_pattern($2, thunderbird_tmpfs_t, thunderbird_tmpfs_t, thunderbird_t)
 
-	domain_auto_trans($2, thunderbird_exec_t, thunderbird_t)
-	allow $2 thunderbird_t:fd use;
-	allow $2 thunderbird_t:shm { associate getattr };
-	allow $2 thunderbird_t:unix_stream_socket connectto;
-	allow thunderbird_t $2:fd use;
-	allow thunderbird_t $2:process sigchld;
 	allow thunderbird_t $2:unix_stream_socket connectto;
 
-	# allow ps to show thunderbird and allow the user to kill it 
+	allow $2 thunderbird_t:process { ptrace signal_perms };
 	ps_process_pattern($2, thunderbird_t)
-	allow $2 thunderbird_t:process signal;
 
-	# Access ~/.thunderbird
-	manage_dirs_pattern($2, thunderbird_home_t, thunderbird_home_t)
-	manage_files_pattern($2, thunderbird_home_t, thunderbird_home_t)
-	manage_lnk_files_pattern($2, thunderbird_home_t, thunderbird_home_t)
-	relabel_dirs_pattern($2, thunderbird_home_t, thunderbird_home_t)
-	relabel_files_pattern($2, thunderbird_home_t, thunderbird_home_t)
-	relabel_lnk_files_pattern($2, thunderbird_home_t, thunderbird_home_t)
+	allow $2 thunderbird_home_t:dir { manage_dir_perms relabel_dir_perms };
+	allow $2 thunderbird_home_t:file { manage_file_perms relabel_file_perms };
+	allow $2 thunderbird_home_t:lnk_file { manage_lnk_file_perms relabel_lnk_file_perms };
+	userdom_user_home_dir_filetrans($2, thunderbird_home_t, dir, ".thunderbird")
 ')
 
 ########################################
 ## <summary>
-##	Run thunderbird in the user thunderbird domain.
+##	Execute thunderbird in the thunderbird domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -59,5 +54,6 @@
 		type thunderbird_t, thunderbird_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, thunderbird_exec_t, thunderbird_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/thunderbird.te refpolicy/policy/modules/contrib/thunderbird.te
--- refpolicy/policy/modules/contrib/thunderbird.te	2012-05-04 15:16:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/thunderbird.te	2012-10-29 15:51:34.900186856 +0100
@@ -1,15 +1,18 @@
-policy_module(thunderbird, 2.3.0)
+policy_module(thunderbird, 2.3.4)
 
 ########################################
 #
 # Declarations
 #
 
+attribute_role thunderbird_roles;
+
 type thunderbird_t;
 type thunderbird_exec_t;
 typealias thunderbird_t alias { user_thunderbird_t staff_thunderbird_t sysadm_thunderbird_t };
 typealias thunderbird_t alias { auditadm_thunderbird_t secadm_thunderbird_t };
 userdom_user_application_domain(thunderbird_t, thunderbird_exec_t)
+role thunderbird_roles types thunderbird_t;
 
 type thunderbird_home_t;
 typealias thunderbird_home_t alias { user_thunderbird_home_t staff_thunderbird_home_t sysadm_thunderbird_home_t };
@@ -28,17 +31,15 @@
 
 allow thunderbird_t self:capability sys_nice;
 allow thunderbird_t self:process { signal_perms setsched getsched execheap execmem execstack };
-allow thunderbird_t self:fifo_file { ioctl read write getattr };
-allow thunderbird_t self:unix_dgram_socket { create connect };
-allow thunderbird_t self:unix_stream_socket { create accept connect write getattr read listen bind };
-allow thunderbird_t self:tcp_socket create_socket_perms;
-allow thunderbird_t self:shm { read write create destroy unix_read unix_write };
+allow thunderbird_t self:fifo_file rw_fifo_file_perms;
+allow thunderbird_t self:unix_dgram_socket create_socket_perms;
+allow thunderbird_t self:unix_stream_socket create_stream_socket_perms;
+allow thunderbird_t self:shm create_shm_perms;
 
-# Access ~/.thunderbird
 manage_dirs_pattern(thunderbird_t, thunderbird_home_t, thunderbird_home_t)
 manage_files_pattern(thunderbird_t, thunderbird_home_t, thunderbird_home_t)
 manage_lnk_files_pattern(thunderbird_t, thunderbird_home_t, thunderbird_home_t)
-userdom_search_user_home_dirs(thunderbird_t)
+userdom_user_home_dir_filetrans(thunderbird_t, thunderbird_home_t, dir, ".thunderbird")
 
 manage_files_pattern(thunderbird_t, thunderbird_tmpfs_t, thunderbird_tmpfs_t)
 manage_lnk_files_pattern(thunderbird_t, thunderbird_tmpfs_t, thunderbird_tmpfs_t)
@@ -46,43 +47,42 @@
 manage_sock_files_pattern(thunderbird_t, thunderbird_tmpfs_t, thunderbird_tmpfs_t)
 fs_tmpfs_filetrans(thunderbird_t, thunderbird_tmpfs_t,{ dir file lnk_file sock_file fifo_file })
 
-# Allow netstat
 kernel_read_network_state(thunderbird_t)
 kernel_read_net_sysctls(thunderbird_t)
 kernel_read_system_state(thunderbird_t)
 
-# Startup shellscript
 corecmd_exec_shell(thunderbird_t)
 
 corenet_all_recvfrom_unlabeled(thunderbird_t)
 corenet_all_recvfrom_netlabel(thunderbird_t)
 corenet_tcp_sendrecv_generic_if(thunderbird_t)
 corenet_tcp_sendrecv_generic_node(thunderbird_t)
-corenet_tcp_sendrecv_ipp_port(thunderbird_t)
-corenet_tcp_sendrecv_ldap_port(thunderbird_t)
-corenet_tcp_sendrecv_innd_port(thunderbird_t)
-corenet_tcp_sendrecv_smtp_port(thunderbird_t)
-corenet_tcp_sendrecv_pop_port(thunderbird_t)
-corenet_tcp_sendrecv_http_port(thunderbird_t)
-corenet_tcp_connect_ipp_port(thunderbird_t)
-corenet_tcp_connect_ldap_port(thunderbird_t)
-corenet_tcp_connect_innd_port(thunderbird_t)
-corenet_tcp_connect_smtp_port(thunderbird_t)
-corenet_tcp_connect_pop_port(thunderbird_t)
-corenet_tcp_connect_http_port(thunderbird_t)
+
 corenet_sendrecv_ipp_client_packets(thunderbird_t)
-corenet_sendrecv_ldap_client_packets(thunderbird_t)
+corenet_tcp_connect_ipp_port(thunderbird_t)
+corenet_tcp_sendrecv_ipp_port(thunderbird_t)
+
 corenet_sendrecv_innd_client_packets(thunderbird_t)
+corenet_tcp_connect_innd_port(thunderbird_t)
+corenet_tcp_sendrecv_innd_port(thunderbird_t)
+
 corenet_sendrecv_smtp_client_packets(thunderbird_t)
+corenet_tcp_connect_smtp_port(thunderbird_t)
+corenet_tcp_sendrecv_smtp_port(thunderbird_t)
+
 corenet_sendrecv_pop_client_packets(thunderbird_t)
+corenet_tcp_connect_pop_port(thunderbird_t)
+corenet_tcp_sendrecv_pop_port(thunderbird_t)
+
 corenet_sendrecv_http_client_packets(thunderbird_t)
+corenet_tcp_connect_http_port(thunderbird_t)
+corenet_tcp_sendrecv_http_port(thunderbird_t)
 
 dev_read_urand(thunderbird_t)
 dev_dontaudit_search_sysfs(thunderbird_t)
 
 files_list_tmp(thunderbird_t)
 files_read_usr_files(thunderbird_t)
-files_read_etc_files(thunderbird_t)
 files_read_etc_runtime_files(thunderbird_t)
 files_read_var_files(thunderbird_t)
 files_read_var_symlinks(thunderbird_t)
@@ -91,9 +91,8 @@
 files_dontaudit_getattr_lost_found_dirs(thunderbird_t)
 files_dontaudit_search_mnt(thunderbird_t)
 
-fs_getattr_xattr_fs(thunderbird_t)
+fs_getattr_all_fs(thunderbird_t)
 fs_list_inotifyfs(thunderbird_t)
-# Access ~/.thunderbird
 fs_search_auto_mountpoints(thunderbird_t)
 
 auth_use_nsswitch(thunderbird_t)
@@ -101,17 +100,19 @@
 miscfiles_read_fonts(thunderbird_t)
 miscfiles_read_localization(thunderbird_t)
 
+userdom_write_user_tmp_sockets(thunderbird_t)
+
 userdom_manage_user_tmp_dirs(thunderbird_t)
-userdom_read_user_tmp_files(thunderbird_t)
-userdom_manage_user_tmp_sockets(thunderbird_t)
-# .kde/....gtkrc
-userdom_read_user_home_content_files(thunderbird_t)
+userdom_manage_user_tmp_files(thunderbird_t)
+
+userdom_manage_user_home_content_dirs(thunderbird_t)
+userdom_manage_user_home_content_files(thunderbird_t)
+userdom_user_home_dir_filetrans_user_home_content(thunderbird_t, { dir file })
 
 xserver_user_x_domain_template(thunderbird, thunderbird_t, thunderbird_tmpfs_t)
 xserver_read_xdm_tmp_files(thunderbird_t)
 xserver_dontaudit_getattr_xdm_tmp_sockets(thunderbird_t)
 
-# Access ~/.thunderbird
 tunable_policy(`use_nfs_home_dirs',`
 	fs_manage_nfs_dirs(thunderbird_t)
 	fs_manage_nfs_files(thunderbird_t)
@@ -124,73 +125,33 @@
 	fs_manage_cifs_symlinks(thunderbird_t)
 ')
 
-tunable_policy(`mail_read_content && use_nfs_home_dirs',`
-	files_list_home(thunderbird_t)
-
-	fs_list_auto_mountpoints(thunderbird_t)
-	fs_read_nfs_files(thunderbird_t)
-	fs_read_nfs_symlinks(thunderbird_t)
-',`
-	files_dontaudit_list_home(thunderbird_t)
-
-	fs_dontaudit_list_auto_mountpoints(thunderbird_t)
-	fs_dontaudit_list_nfs(thunderbird_t)
-	fs_dontaudit_read_nfs_files(thunderbird_t)
-')
-
-tunable_policy(`mail_read_content && use_samba_home_dirs',`
-	files_list_home(thunderbird_t)
-
-	fs_list_auto_mountpoints(thunderbird_t)
-	fs_read_cifs_files(thunderbird_t)
-	fs_read_cifs_symlinks(thunderbird_t)
-',`
-	files_dontaudit_list_home(thunderbird_t)
-
-	fs_dontaudit_list_auto_mountpoints(thunderbird_t)
-	fs_dontaudit_read_cifs_files(thunderbird_t)
-	fs_dontaudit_list_cifs(thunderbird_t)
-')
-
-tunable_policy(`mail_read_content',`
-	userdom_list_user_tmp(thunderbird_t)
-	userdom_read_user_tmp_files(thunderbird_t)
-	userdom_read_user_tmp_symlinks(thunderbird_t)
-	userdom_search_user_home_dirs(thunderbird_t)
-	userdom_read_user_home_content_files(thunderbird_t)
-
-	ifndef(`enable_mls',`
-		fs_search_removable(thunderbird_t)
-		fs_read_removable_files(thunderbird_t)
-		fs_read_removable_symlinks(thunderbird_t)
-	')
-',`
-	files_dontaudit_list_tmp(thunderbird_t)
-	files_dontaudit_list_home(thunderbird_t)
-
-	fs_dontaudit_list_removable(thunderbird_t)
-	fs_dontaudit_read_removable_files(thunderbird_t)
-
-	userdom_dontaudit_list_user_tmp(thunderbird_t)
-	userdom_dontaudit_read_user_tmp_files(thunderbird_t)
-	userdom_dontaudit_list_user_home_dirs(thunderbird_t)
-	userdom_dontaudit_read_user_home_content_files(thunderbird_t)
+ifndef(`enable_mls',`
+	fs_search_removable(thunderbird_t)
+	fs_read_removable_files(thunderbird_t)
+	fs_read_removable_symlinks(thunderbird_t)
 ')
 
 optional_policy(`
 	dbus_system_bus_client(thunderbird_t)
-	dbus_session_bus_client(thunderbird_t)
+	dbus_all_session_bus_client(thunderbird_t)
+
+	optional_policy(`
+		cups_dbus_chat(thunderbird_t)
+	')
+
+	optional_policy(`
+		mozilla_dbus_chat(thunderbird_t)
+	')
 ')
 
 optional_policy(`
 	cups_read_rw_config(thunderbird_t)
-	cups_dbus_chat(thunderbird_t)
 ')
 
 optional_policy(`
 	gnome_stream_connect_gconf(thunderbird_t)
 	gnome_domtrans_gconfd(thunderbird_t)
-	gnome_manage_config(thunderbird_t)
+	gnome_manage_generic_home_content(thunderbird_t)
 ')
 
 optional_policy(`
@@ -198,11 +159,10 @@
 ')
 
 optional_policy(`
-	lpd_domtrans_lpr(thunderbird_t)
+	lpd_run_lpr(thunderbird_t, thunderbird_roles)
 ')
 
 optional_policy(`
 	mozilla_read_user_home_files(thunderbird_t)
 	mozilla_domtrans(thunderbird_t)
-	mozilla_dbus_chat(thunderbird_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/timidity.fc refpolicy/policy/modules/contrib/timidity.fc
--- refpolicy/policy/modules/contrib/timidity.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/timidity.fc	2012-10-30 19:32:42.946399592 +0100
@@ -1,2 +1 @@
-
 /usr/bin/timidity	--	gen_context(system_u:object_r:timidity_exec_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/timidity.if refpolicy/policy/modules/contrib/timidity.if
--- refpolicy/policy/modules/contrib/timidity.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/timidity.if	2012-10-30 19:32:42.947399592 +0100
@@ -1 +1 @@
-## <summary>MIDI to WAV converter and player configured as a service</summary>
+## <summary>MIDI to WAV converter and player configured as a service.</summary>
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/timidity.te refpolicy/policy/modules/contrib/timidity.te
--- refpolicy/policy/modules/contrib/timidity.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/timidity.te	2012-10-30 19:32:42.947399592 +0100
@@ -1,6 +1,4 @@
-policy_module(timidity, 1.9.0)
-
-# Note: You only need this policy if you want to run timidity as a server
+policy_module(timidity, 1.9.1)
 
 ########################################
 #
@@ -10,7 +8,7 @@
 type timidity_t;
 type timidity_exec_t;
 init_daemon_domain(timidity_t, timidity_exec_t)
-application_domain(timidity_t, timidity_exec_t)
+application_executable_file(timidity_exec_t)
 
 type timidity_tmpfs_t;
 files_tmpfs_file(timidity_tmpfs_t)
@@ -24,7 +22,7 @@
 dontaudit timidity_t self:capability sys_tty_config;
 allow timidity_t self:process { signal_perms getsched };
 allow timidity_t self:shm create_shm_perms;
-allow timidity_t self:unix_stream_socket create_stream_socket_perms;
+allow timidity_t self:unix_stream_socket { accept listen };
 allow timidity_t self:tcp_socket create_stream_socket_perms;
 allow timidity_t self:udp_socket create_socket_perms;
 
@@ -36,7 +34,6 @@
 fs_tmpfs_filetrans(timidity_t, timidity_tmpfs_t, { dir file lnk_file sock_file fifo_file })
 
 kernel_read_kernel_sysctls(timidity_t)
-# read /proc/cpuinfo
 kernel_read_system_state(timidity_t)
 
 corenet_all_recvfrom_unlabeled(timidity_t)
@@ -52,17 +49,14 @@
 dev_read_sound(timidity_t)
 dev_write_sound(timidity_t)
 
-fs_search_auto_mountpoints(timidity_t)
-
 domain_use_interactive_fds(timidity_t)
 
-files_search_tmp(timidity_t)
-# read /usr/share/alsa/alsa.conf
-files_read_usr_files(timidity_t)
-# read /etc/esd.conf
 files_read_etc_files(timidity_t)
+files_read_usr_files(timidity_t)
+files_search_tmp(timidity_t)
+
+fs_search_auto_mountpoints(timidity_t)
 
-# read libartscbackend.la
 libs_read_lib_files(timidity_t)
 
 logging_send_syslog_msg(timidity_t)
@@ -70,10 +64,6 @@
 sysnet_read_config(timidity_t)
 
 userdom_dontaudit_use_unpriv_user_fds(timidity_t)
-
-# stupid timidity won't start if it can't search its current directory.
-# allow this so /etc/init.d/alsasound start works from /root
-# cjp: this should be fixed if possible so this rule can be removed.
 userdom_search_user_home_dirs(timidity_t)
 
 optional_policy(`
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/tmpreaper.fc refpolicy/policy/modules/contrib/tmpreaper.fc
--- refpolicy/policy/modules/contrib/tmpreaper.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/tmpreaper.fc	2012-10-30 19:32:45.456399596 +0100
@@ -1,7 +1,5 @@
-ifdef(`distro_debian',`
-/etc/init\.d/mountall-bootclean.sh --	gen_context(system_u:object_r:tmpreaper_exec_t,s0)
-/etc/init\.d/mountnfs-bootclean.sh --	gen_context(system_u:object_r:tmpreaper_exec_t,s0)
-')
+/etc/rc\.d/init\.d/mountall-bootclean.sh	--	gen_context(system_u:object_r:tmpreaper_exec_t,s0)
+/etc/rc\.d/init\.d/mountnfs-bootclean.sh	--	gen_context(system_u:object_r:tmpreaper_exec_t,s0)
 
-/usr/sbin/tmpreaper		--	gen_context(system_u:object_r:tmpreaper_exec_t,s0)
-/usr/sbin/tmpwatch		--	gen_context(system_u:object_r:tmpreaper_exec_t,s0)
+/usr/sbin/tmpreaper	--	gen_context(system_u:object_r:tmpreaper_exec_t,s0)
+/usr/sbin/tmpwatch	--	gen_context(system_u:object_r:tmpreaper_exec_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/tmpreaper.if refpolicy/policy/modules/contrib/tmpreaper.if
--- refpolicy/policy/modules/contrib/tmpreaper.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/tmpreaper.if	2012-10-30 19:32:45.471399597 +0100
@@ -1,4 +1,4 @@
-## <summary>Manage temporary directory sizes and file ages</summary>
+## <summary>Manage temporary directory sizes and file ages.</summary>
 
 ########################################
 ## <summary>
@@ -15,7 +15,6 @@
 		type tmpreaper_exec_t;
 	')
 
-	files_search_usr($1)
 	corecmd_search_bin($1)
 	can_exec($1, tmpreaper_exec_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/tmpreaper.te refpolicy/policy/modules/contrib/tmpreaper.te
--- refpolicy/policy/modules/contrib/tmpreaper.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/tmpreaper.te	2012-10-30 19:32:45.471399597 +0100
@@ -1,4 +1,4 @@
-policy_module(tmpreaper, 1.6.0)
+policy_module(tmpreaper, 1.6.2)
 
 ########################################
 #
@@ -7,39 +7,41 @@
 
 type tmpreaper_t;
 type tmpreaper_exec_t;
-application_domain(tmpreaper_t, tmpreaper_exec_t)
-role system_r types tmpreaper_t;
+init_system_domain(tmpreaper_t, tmpreaper_exec_t)
 
 ########################################
 #
 # Local Policy
 #
 
-allow tmpreaper_t self:process { fork sigchld };
 allow tmpreaper_t self:capability { dac_override dac_read_search fowner };
 
+kernel_list_unlabeled(tmpreaper_t)
+kernel_read_system_state(tmpreaper_t)
+
 dev_read_urand(tmpreaper_t)
 
 fs_getattr_xattr_fs(tmpreaper_t)
+fs_list_all(tmpreaper_t)
 
-files_read_etc_files(tmpreaper_t)
+files_getattr_all_dirs(tmpreaper_t)
+files_getattr_all_files(tmpreaper_t)
 files_read_var_lib_files(tmpreaper_t)
 files_purge_tmp(tmpreaper_t)
-# why does it need setattr?
 files_setattr_all_tmp_dirs(tmpreaper_t)
-files_getattr_all_dirs(tmpreaper_t)
-files_getattr_all_files(tmpreaper_t)
 
+mcs_file_read_all(tmpreaper_t)
+mcs_file_write_all(tmpreaper_t)
 mls_file_read_all_levels(tmpreaper_t)
 mls_file_write_all_levels(tmpreaper_t)
 
+auth_use_nsswitch(tmpreaper_t)
+
 logging_send_syslog_msg(tmpreaper_t)
 
 miscfiles_read_localization(tmpreaper_t)
 miscfiles_delete_man_pages(tmpreaper_t)
 
-cron_system_entry(tmpreaper_t, tmpreaper_exec_t)
-
 ifdef(`distro_redhat',`
 	userdom_list_user_home_content(tmpreaper_t)
 	userdom_delete_user_home_content_dirs(tmpreaper_t)
@@ -53,22 +55,23 @@
 
 optional_policy(`
 	apache_list_cache(tmpreaper_t)
+	apache_delete_cache_dirs(tmpreaper_t)
 	apache_delete_cache_files(tmpreaper_t)
 	apache_setattr_cache_dirs(tmpreaper_t)
 ')
 
 optional_policy(`
-	kismet_manage_log(tmpreaper_t)
+	cron_system_entry(tmpreaper_t, tmpreaper_exec_t)
 ')
 
 optional_policy(`
-	lpd_manage_spool(tmpreaper_t)
+	kismet_manage_log(tmpreaper_t)
 ')
 
 optional_policy(`
-	rpm_manage_cache(tmpreaper_t)
+	lpd_manage_spool(tmpreaper_t)
 ')
 
 optional_policy(`
-	unconfined_domain(tmpreaper_t)
+	rpm_manage_cache(tmpreaper_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/tor.fc refpolicy/policy/modules/contrib/tor.fc
--- refpolicy/policy/modules/contrib/tor.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/tor.fc	2012-10-30 19:32:48.981399605 +0100
@@ -1,12 +1,14 @@
+/etc/tor(/.*)?	gen_context(system_u:object_r:tor_etc_t,s0)
+
 /etc/rc\.d/init\.d/tor	--	gen_context(system_u:object_r:tor_initrc_exec_t,s0)
-/etc/tor(/.*)?			gen_context(system_u:object_r:tor_etc_t,s0)
 
-/usr/bin/tor		--	gen_context(system_u:object_r:tor_exec_t,s0)
-/usr/sbin/tor		--	gen_context(system_u:object_r:tor_exec_t,s0)
+/usr/bin/tor	--	gen_context(system_u:object_r:tor_exec_t,s0)
+
+/usr/sbin/tor	--	gen_context(system_u:object_r:tor_exec_t,s0)
 
-/var/lib/tor(/.*)?		gen_context(system_u:object_r:tor_var_lib_t,s0)
-/var/lib/tor-data(/.*)?		gen_context(system_u:object_r:tor_var_lib_t,s0)
+/var/lib/tor(/.*)?	gen_context(system_u:object_r:tor_var_lib_t,s0)
+/var/lib/tor-data(/.*)?	gen_context(system_u:object_r:tor_var_lib_t,s0)
 
-/var/log/tor(/.*)?		gen_context(system_u:object_r:tor_var_log_t,s0)
+/var/log/tor(/.*)?	gen_context(system_u:object_r:tor_var_log_t,s0)
 
-/var/run/tor(/.*)?		gen_context(system_u:object_r:tor_var_run_t,s0)
+/var/run/tor(/.*)?	gen_context(system_u:object_r:tor_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/tor.if refpolicy/policy/modules/contrib/tor.if
--- refpolicy/policy/modules/contrib/tor.if	2012-05-04 15:16:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/tor.if	2012-10-30 19:32:48.981399605 +0100
@@ -1,8 +1,8 @@
-## <summary>TOR, the onion router</summary>
+## <summary>The onion router.</summary>
 
 ########################################
 ## <summary>
-##	Execute a domain transition to run TOR.
+##	Execute a domain transition to run tor.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -15,13 +15,14 @@
 		type tor_t, tor_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, tor_exec_t, tor_t)
 ')
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate 
-##	an tor environment
+##	All of the rules required to
+##	administrate an tor environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -30,7 +31,7 @@
 ## </param>
 ## <param name="role">
 ##	<summary>
-##	The role to be allowed to manage the tor domain.
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <rolecap/>
@@ -38,11 +39,10 @@
 interface(`tor_admin',`
 	gen_require(`
 		type tor_t, tor_var_log_t, tor_etc_t;
-		type tor_var_lib_t, tor_var_run_t;
-		type tor_initrc_exec_t;
+		type tor_var_lib_t, tor_var_run_t, tor_initrc_exec_t;
 	')
 
-	allow $1 tor_t:process { ptrace signal_perms getattr };
+	allow $1 tor_t:process { ptrace signal_perms };
 	ps_process_pattern($1, tor_t)
 
 	init_labeled_script_domtrans($1, tor_initrc_exec_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/tor.te refpolicy/policy/modules/contrib/tor.te
--- refpolicy/policy/modules/contrib/tor.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/tor.te	2012-10-30 19:32:48.982399605 +0100
@@ -1,4 +1,4 @@
-policy_module(tor, 1.8.0)
+policy_module(tor, 1.8.3)
 
 ########################################
 #
@@ -6,10 +6,10 @@
 #
 
 ## <desc>
-## <p>
-## Allow tor daemon to bind
-## tcp sockets to all unreserved ports.
-## </p>
+##	<p>
+##	Determine whether tor can bind
+##	tcp sockets to all unreserved ports.
+##	</p>
 ## </desc>
 gen_tunable(tor_bind_all_unreserved_ports, false)
 
@@ -17,91 +17,85 @@
 type tor_exec_t;
 init_daemon_domain(tor_t, tor_exec_t)
 
-# etc/tor
 type tor_etc_t;
 files_config_file(tor_etc_t)
 
 type tor_initrc_exec_t;
 init_script_file(tor_initrc_exec_t)
 
-# var/lib/tor
 type tor_var_lib_t;
 files_type(tor_var_lib_t)
 
-# log files
 type tor_var_log_t;
 logging_log_file(tor_var_log_t)
 
-# pid files
 type tor_var_run_t;
 files_pid_file(tor_var_run_t)
+init_daemon_run_dir(tor_var_run_t, "tor")
 
 ########################################
 #
-# tor local policy
+# Local policy
 #
 
 allow tor_t self:capability { setgid setuid sys_tty_config };
+allow tor_t self:process signal;
 allow tor_t self:fifo_file rw_fifo_file_perms;
-allow tor_t self:unix_stream_socket create_stream_socket_perms;
-allow tor_t self:netlink_route_socket r_netlink_socket_perms;
-allow tor_t self:tcp_socket create_stream_socket_perms;
+allow tor_t self:unix_stream_socket { accept listen };
+allow tor_t self:tcp_socket { accept listen };
 
-# configuration files
 allow tor_t tor_etc_t:dir list_dir_perms;
-read_files_pattern(tor_t, tor_etc_t, tor_etc_t)
-read_lnk_files_pattern(tor_t, tor_etc_t, tor_etc_t)
+allow tor_t tor_etc_t:file read_file_perms;
+allow tor_t tor_etc_t:lnk_file read_lnk_file_perms;
 
-# var/lib/tor files
 manage_dirs_pattern(tor_t, tor_var_lib_t, tor_var_lib_t)
 manage_files_pattern(tor_t, tor_var_lib_t, tor_var_lib_t)
 manage_sock_files_pattern(tor_t, tor_var_lib_t, tor_var_lib_t)
-files_usr_filetrans(tor_t, tor_var_lib_t, file)
-files_var_filetrans(tor_t, tor_var_lib_t, { file dir sock_file })
-files_var_lib_filetrans(tor_t, tor_var_lib_t, file)
-
-# log files
-allow tor_t tor_var_log_t:dir setattr;
-manage_files_pattern(tor_t, tor_var_log_t, tor_var_log_t)
+files_var_lib_filetrans(tor_t, tor_var_lib_t, dir)
+
+allow tor_t tor_var_log_t:dir setattr_dir_perms;
+append_files_pattern(tor_t, tor_var_log_t, tor_var_log_t)
+create_files_pattern(tor_t, tor_var_log_t, tor_var_log_t)
+setattr_files_pattern(tor_t, tor_var_log_t, tor_var_log_t)
 manage_sock_files_pattern(tor_t, tor_var_log_t, tor_var_log_t)
 logging_log_filetrans(tor_t, tor_var_log_t, { sock_file file dir })
 
-# pid file
 manage_dirs_pattern(tor_t, tor_var_run_t, tor_var_run_t)
 manage_files_pattern(tor_t, tor_var_run_t, tor_var_run_t)
 manage_sock_files_pattern(tor_t, tor_var_run_t, tor_var_run_t)
 files_pid_filetrans(tor_t, tor_var_run_t, { dir file sock_file })
 
+kernel_read_net_sysctls(tor_t)
 kernel_read_system_state(tor_t)
 
-# networking basics
 corenet_all_recvfrom_unlabeled(tor_t)
 corenet_all_recvfrom_netlabel(tor_t)
 corenet_tcp_sendrecv_generic_if(tor_t)
 corenet_udp_sendrecv_generic_if(tor_t)
 corenet_tcp_sendrecv_generic_node(tor_t)
 corenet_udp_sendrecv_generic_node(tor_t)
-corenet_tcp_sendrecv_all_ports(tor_t)
-corenet_udp_sendrecv_dns_port(tor_t)
-corenet_tcp_sendrecv_all_reserved_ports(tor_t)
 corenet_tcp_bind_generic_node(tor_t)
 corenet_udp_bind_generic_node(tor_t)
-corenet_tcp_bind_tor_port(tor_t)
+
+corenet_sendrecv_dns_server_packets(tor_t)
 corenet_udp_bind_dns_port(tor_t)
+corenet_udp_sendrecv_dns_port(tor_t)
+
 corenet_sendrecv_tor_server_packets(tor_t)
-corenet_sendrecv_dns_server_packets(tor_t)
-# TOR will need to connect to various ports
-corenet_tcp_connect_all_ports(tor_t)
+corenet_tcp_bind_tor_port(tor_t)
+corenet_tcp_sendrecv_tor_port(tor_t)
+
 corenet_sendrecv_all_client_packets(tor_t)
-# ... especially including port 80 and other privileged ports
+corenet_tcp_connect_all_ports(tor_t)
 corenet_tcp_connect_all_reserved_ports(tor_t)
+corenet_tcp_sendrecv_all_ports(tor_t)
+corenet_tcp_sendrecv_all_reserved_ports(tor_t)
 
-# tor uses crypto and needs random
+dev_read_sysfs(tor_t)
 dev_read_urand(tor_t)
 
 domain_use_interactive_fds(tor_t)
 
-files_read_etc_files(tor_t)
 files_read_etc_runtime_files(tor_t)
 files_read_usr_files(tor_t)
 
@@ -111,7 +105,8 @@
 
 miscfiles_read_localization(tor_t)
 
-tunable_policy(`tor_bind_all_unreserved_ports', `
+tunable_policy(`tor_bind_all_unreserved_ports',`
+	corenet_sendrecv_all_server_packets(tor_t)
 	corenet_tcp_bind_all_unreserved_ports(tor_t)
 ')
 
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/transproxy.fc refpolicy/policy/modules/contrib/transproxy.fc
--- refpolicy/policy/modules/contrib/transproxy.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/transproxy.fc	2012-10-30 19:32:50.636399608 +0100
@@ -1,3 +1,5 @@
+/etc/rc\.d/init\.d/transproxy	--	gen_context(system_u:object_r:transproxy_initrc_exec_t,s0)
+
 /usr/sbin/tproxy	--	gen_context(system_u:object_r:transproxy_exec_t,s0)
 
 /var/run/tproxy\.pid	--	gen_context(system_u:object_r:transproxy_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/transproxy.if refpolicy/policy/modules/contrib/transproxy.if
--- refpolicy/policy/modules/contrib/transproxy.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/transproxy.if	2012-10-30 19:32:50.637399608 +0100
@@ -1 +1,35 @@
-## <summary>HTTP transperant proxy</summary>
+## <summary>Portable Transparent Proxy Solution.</summary>
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an transproxy environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`transproxy_admin',`
+	gen_require(`
+		type transproxy_t, transproxy_initrc_exec_t, transproxy_var_run_t;
+	')
+
+	allow $1 transproxy_t:process { ptrace signal_perms };
+	ps_process_pattern($1, transproxy_t)
+
+	init_labeled_script_domtrans($1, transproxy_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 transproxy_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	files_search_pids($1)
+	admin_pattern($1, transproxy_var_run_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/transproxy.te refpolicy/policy/modules/contrib/transproxy.te
--- refpolicy/policy/modules/contrib/transproxy.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/transproxy.te	2012-10-30 19:32:50.637399608 +0100
@@ -1,4 +1,4 @@
-policy_module(transproxy, 1.7.0)
+policy_module(transproxy, 1.7.1)
 
 ########################################
 #
@@ -9,6 +9,9 @@
 type transproxy_exec_t;
 init_daemon_domain(transproxy_t, transproxy_exec_t)
 
+type transproxy_initrc_exec_t;
+init_script_file(transproxy_initrc_exec_t)
+
 type transproxy_var_run_t;
 files_pid_file(transproxy_var_run_t)
 
@@ -33,10 +36,11 @@
 corenet_all_recvfrom_netlabel(transproxy_t)
 corenet_tcp_sendrecv_generic_if(transproxy_t)
 corenet_tcp_sendrecv_generic_node(transproxy_t)
-corenet_tcp_sendrecv_all_ports(transproxy_t)
 corenet_tcp_bind_generic_node(transproxy_t)
-corenet_tcp_bind_transproxy_port(transproxy_t)
+
 corenet_sendrecv_transproxy_server_packets(transproxy_t)
+corenet_tcp_bind_transproxy_port(transproxy_t)
+corenet_tcp_sendrecv_transproxy_port(transproxy_t)
 
 dev_read_sysfs(transproxy_t)
 
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/tripwire.fc refpolicy/policy/modules/contrib/tripwire.fc
--- refpolicy/policy/modules/contrib/tripwire.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/tripwire.fc	2012-10-30 19:32:53.608399614 +0100
@@ -1,10 +1,9 @@
+/etc/tripwire(/.*)?	gen_context(system_u:object_r:tripwire_etc_t,s0)
 
-/etc/tripwire(/.*)?			gen_context(system_u:object_r:tripwire_etc_t,s0)
+/usr/sbin/siggen	--	gen_context(system_u:object_r:siggen_exec_t,s0)
+/usr/sbin/tripwire	--	gen_context(system_u:object_r:tripwire_exec_t,s0)
+/usr/sbin/twadmin	--	gen_context(system_u:object_r:twadmin_exec_t,s0)
+/usr/sbin/twprint	--	gen_context(system_u:object_r:twprint_exec_t,s0)
 
-/usr/sbin/siggen		--	gen_context(system_u:object_r:siggen_exec_t,s0)
-/usr/sbin/tripwire		--	gen_context(system_u:object_r:tripwire_exec_t,s0)
-/usr/sbin/twadmin		--	gen_context(system_u:object_r:twadmin_exec_t,s0)
-/usr/sbin/twprint		--	gen_context(system_u:object_r:twprint_exec_t,s0)
-
-/var/lib/tripwire(/.*)?			gen_context(system_u:object_r:tripwire_var_lib_t,s0)
-/var/lib/tripwire/report(/.*)?		gen_context(system_u:object_r:tripwire_report_t,s0)
+/var/lib/tripwire(/.*)?	gen_context(system_u:object_r:tripwire_var_lib_t,s0)
+/var/lib/tripwire/report(/.*)?	gen_context(system_u:object_r:tripwire_report_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/tripwire.if refpolicy/policy/modules/contrib/tripwire.if
--- refpolicy/policy/modules/contrib/tripwire.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/tripwire.if	2012-10-30 19:32:53.609399614 +0100
@@ -1,17 +1,4 @@
-## <summary>Tripwire file integrity checker.</summary>
-## <desc>
-##	<p>
-##	Tripwire file integrity checker.
-##	</p>
-##	<p>
-##	NOTE: Tripwire creates temp file in its current working directory.
-##	This policy does not allow write access to home directories, so
-##	users will need to either cd to a directory where they have write
-##	permission, or set the TEMPDIRECTORY variable in the tripwire config
-##	file.  The latter is preferable, as then the file_type_auto_trans
-##	rules will kick in and label the files as private to tripwire.
-##	</p>
-## </desc>
+## <summary>File integrity checker.</summary>
 
 ########################################
 ## <summary>
@@ -28,13 +15,15 @@
 		type tripwire_t, tripwire_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, tripwire_exec_t, tripwire_t)
 ')
 
 ########################################
 ## <summary>
-##	Execute tripwire in the tripwire domain, and
-##	allow the specified role the tripwire domain.
+##	Execute tripwire in the tripwire
+##	domain, and allow the specified
+##	role the tripwire domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -50,11 +39,11 @@
 #
 interface(`tripwire_run_tripwire',`
 	gen_require(`
-		type tripwire_t;
+		attribute_role tripwire_roles;
 	')
 
 	tripwire_domtrans_tripwire($1)
-	role $2 types tripwire_t;
+	roleattribute $2 tripwire_roles;
 ')
 
 ########################################
@@ -72,13 +61,15 @@
 		type twadmin_t, twadmin_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, twadmin_exec_t, twadmin_t)
 ')
 
 ########################################
 ## <summary>
-##	Execute twadmin in the twadmin domain, and
-##	allow the specified role the twadmin domain.
+##	Execute twadmin in the twadmin
+##	domain, and allow the specified
+##	role the twadmin domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -94,11 +85,11 @@
 #
 interface(`tripwire_run_twadmin',`
 	gen_require(`
-		type twadmin_t;
+		attribute_role twadmin_roles;
 	')
 
 	tripwire_domtrans_twadmin($1)
-	role $2 types twadmin_t;
+	roleattribute $2 twadmin_roles;
 ')
 
 ########################################
@@ -116,13 +107,15 @@
 		type twprint_t, twprint_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, twprint_exec_t, twprint_t)
 ')
 
 ########################################
 ## <summary>
-##	Execute twprint in the twprint domain, and
-##	allow the specified role the twprint domain.
+##	Execute twprint in the twprint
+##	domain, and allow the specified
+##	role the twprint domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -138,11 +131,11 @@
 #
 interface(`tripwire_run_twprint',`
 	gen_require(`
-		type twprint_t;
+		attribute_role twprint_roles;
 	')
 
 	tripwire_domtrans_twprint($1)
-	role $2 types twprint_t;
+	roleattribute $2 twprint_roles;
 ')
 
 ########################################
@@ -160,13 +153,15 @@
 		type siggen_t, siggen_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, siggen_exec_t, siggen_t)
 ')
 
 ########################################
 ## <summary>
-##	Execute siggen in the siggen domain, and
-##	allow the specified role the siggen domain.
+##	Execute siggen in the siggen domain,
+##	and allow the specified role
+##	the siggen domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -182,9 +177,9 @@
 #
 interface(`tripwire_run_siggen',`
 	gen_require(`
-		type siggen_t;
+		attribute_role siggen_roles;
 	')
 
 	tripwire_domtrans_siggen($1)
-	role $2 types siggen_t;
+	roleattribute $2 siggen_roles;
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/tripwire.te refpolicy/policy/modules/contrib/tripwire.te
--- refpolicy/policy/modules/contrib/tripwire.te	2012-05-04 15:16:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/tripwire.te	2012-10-30 19:32:53.609399614 +0100
@@ -1,18 +1,24 @@
-policy_module(tripwire, 1.2.0)
+policy_module(tripwire, 1.2.1)
 
 ########################################
 #
 # Declarations
 #
 
+attribute_role siggen_roles;
+attribute_role tripwire_roles;
+attribute_role twadmin_roles;
+attribute_role twprint_roles;
+
 type siggen_t;
 type siggen_exec_t;
 application_domain(siggen_t, siggen_exec_t)
+role siggen_roles types siggen_t;
 
 type tripwire_t;
 type tripwire_exec_t;
 application_domain(tripwire_t, tripwire_exec_t)
-role system_r types tripwire_t;
+role tripwire_roles types tripwire_t;
 
 type tripwire_etc_t;
 files_config_file(tripwire_etc_t)
@@ -29,24 +35,24 @@
 type twadmin_t;
 type twadmin_exec_t;
 application_domain(twadmin_t, twadmin_exec_t)
+role twadmin_roles types twadmin_t;
 
 type twprint_t;
 type twprint_exec_t;
 application_domain(twprint_t, twprint_exec_t)
+role twprint_roles types twprint_t;
 
 ########################################
 #
-# Tripwire local policy
+# Local policy
 #
 
 allow tripwire_t self:capability { setgid setuid dac_override };
 
 allow tripwire_t tripwire_etc_t:dir list_dir_perms;
-read_files_pattern(tripwire_t, tripwire_etc_t, tripwire_etc_t)
-read_lnk_files_pattern(tripwire_t, tripwire_etc_t, tripwire_etc_t)
-files_search_etc(tripwire_t)
+allow tripwire_t tripwire_etc_t:file read_file_perms;
+allow tripwire_t tripwire_etc_t:lnk_file read_lnk_file_perms;
 
-# Tripwire report files
 manage_dirs_pattern(tripwire_t, tripwire_report_t, tripwire_report_t)
 manage_files_pattern(tripwire_t, tripwire_report_t, tripwire_report_t)
 manage_lnk_files_pattern(tripwire_t, tripwire_report_t, tripwire_report_t)
@@ -68,8 +74,8 @@
 kernel_getattr_message_if(tripwire_t)
 kernel_read_kernel_sysctls(tripwire_t)
 
-corecmd_exec_shell(tripwire_t)
 corecmd_exec_bin(tripwire_t)
+corecmd_exec_shell(tripwire_t)
 
 domain_use_interactive_fds(tripwire_t)
 
@@ -91,12 +97,14 @@
 # Twadmin local policy
 #
 
-manage_dirs_pattern(twadmin_t, tripwire_etc_t, tripwire_etc_t)
-manage_files_pattern(twadmin_t, tripwire_etc_t, tripwire_etc_t)
-manage_lnk_files_pattern(twadmin_t, tripwire_etc_t, tripwire_etc_t)
+allow twadmin_t tripwire_etc_t:dir list_dir_perms;
+allow twadmin_t tripwire_etc_t:file read_file_perms;
+allow twadmin_t tripwire_etc_t:lnk_file read_lnk_file_perms;
 
 domain_use_interactive_fds(twadmin_t)
 
+files_search_etc(twadmin_t)
+
 logging_send_syslog_msg(twadmin_t)
 
 miscfiles_read_localization(twadmin_t)
@@ -109,20 +117,22 @@
 #
 
 allow twprint_t tripwire_etc_t:dir list_dir_perms;
-read_files_pattern(twprint_t, tripwire_etc_t, tripwire_etc_t)
-read_lnk_files_pattern(twprint_t, tripwire_etc_t, tripwire_etc_t)
+allow twprint_t tripwire_etc_t:file read_file_perms;
+allow twprint_t tripwire_etc_t:lnk_file read_lnk_file_perms;
 
 allow twprint_t tripwire_report_t:dir list_dir_perms;
-read_files_pattern(twprint_t, tripwire_report_t, tripwire_report_t)
-read_lnk_files_pattern(twprint_t, tripwire_report_t, tripwire_report_t)
+allow twprint_t tripwire_report_t:file read_file_perms;
+allow twprint_t tripwire_report_t:lnk_file read_lnk_file_perms;
 
 allow twprint_t tripwire_var_lib_t:dir list_dir_perms;
-read_files_pattern(twprint_t, tripwire_var_lib_t, tripwire_var_lib_t)
-read_lnk_files_pattern(twprint_t, tripwire_var_lib_t, tripwire_var_lib_t)
-files_search_var_lib(twprint_t)
+allow twprint_t tripwire_var_lib_t:file read_file_perms;
+allow twprint_t tripwire_var_lib_t:lnk_file read_lnk_file_perms;
 
 domain_use_interactive_fds(twprint_t)
 
+files_search_etc(twprint_t)
+files_search_var_lib(twprint_t)
+
 logging_send_syslog_msg(twprint_t)
 
 miscfiles_read_localization(twprint_t)
@@ -136,7 +146,6 @@
 
 domain_use_interactive_fds(siggen_t)
 
-# Need permission to read files
 files_read_all_files(siggen_t)
 
 logging_send_syslog_msg(siggen_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/tuned.fc refpolicy/policy/modules/contrib/tuned.fc
--- refpolicy/policy/modules/contrib/tuned.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/tuned.fc	2012-10-30 19:32:56.505399621 +0100
@@ -1,8 +1,12 @@
 /etc/rc\.d/init\.d/tuned	--	gen_context(system_u:object_r:tuned_initrc_exec_t,s0)
 
-/usr/sbin/tuned			--	gen_context(system_u:object_r:tuned_exec_t,s0)
+/etc/tuned(/.)?	gen_context(system_u:object_r:tuned_etc_t,s0)
+/etc/tuned/active_profile	--	gen_context(system_u:object_r:tuned_rw_etc_t,s0)
 
-/var/log/tuned(/.*)?			gen_context(system_u:object_r:tuned_log_t,s0)
-/var/log/tuned\.log		--	gen_context(system_u:object_r:tuned_log_t,s0)
+/usr/sbin/tuned	--	gen_context(system_u:object_r:tuned_exec_t,s0)
 
-/var/run/tuned\.pid		--	gen_context(system_u:object_r:tuned_var_run_t,s0)
+/var/log/tuned(/.*)?	gen_context(system_u:object_r:tuned_log_t,s0)
+/var/log/tuned\.log.*	--	gen_context(system_u:object_r:tuned_log_t,s0)
+
+/var/run/tuned(/.*)?	gen_context(system_u:object_r:tuned_var_run_t,s0)
+/var/run/tuned\.pid	--	gen_context(system_u:object_r:tuned_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/tuned.if refpolicy/policy/modules/contrib/tuned.if
--- refpolicy/policy/modules/contrib/tuned.if	2012-05-04 15:16:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/tuned.if	2012-10-30 19:32:56.506399621 +0100
@@ -1,13 +1,13 @@
-## <summary>Dynamic adaptive system tuning daemon</summary>
+## <summary>Dynamic adaptive system tuning daemon.</summary>
 
 ########################################
 ## <summary>
 ##	Execute a domain transition to run tuned.
 ## </summary>
 ## <param name="domain">
-## <summary>
+##	<summary>
 ##	Domain allowed to transition.
-## </summary>
+##	</summary>
 ## </param>
 #
 interface(`tuned_domtrans',`
@@ -15,6 +15,7 @@
 		type tuned_t, tuned_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, tuned_exec_t, tuned_t)
 ')
 
@@ -39,7 +40,7 @@
 
 ######################################
 ## <summary>
-##	Read tuned PID files.
+##	Read tuned pid files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -58,7 +59,8 @@
 
 #######################################
 ## <summary>
-##	Manage tuned PID files.
+##	Create, read, write, and delete
+##	tuned pid files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -77,11 +79,12 @@
 
 ########################################
 ## <summary>
-##	Execute tuned server in the tuned domain.
+##	Execute tuned init scripts in
+##	the initrc domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
-##	Domain allowed access.
+##	Domain allowed to transition.
 ##	</summary>
 ## </param>
 #
@@ -95,8 +98,8 @@
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate 
-##	an tuned environment
+##	All of the rules required to
+##	administrate an tuned environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -112,8 +115,8 @@
 #
 interface(`tuned_admin',`
 	gen_require(`
-		type tuned_t, tuned_var_run_t;
-		type tuned_initrc_exec_t;
+		type tuned_t, tuned_var_run_t, tuned_initrc_exec_t;
+		type tuned_etc_t, tuned_rw_etc_t, tuned_log_t;
 	')
 
 	allow $1 tuned_t:process { ptrace signal_perms };
@@ -124,6 +127,12 @@
 	role_transition $2 tuned_initrc_exec_t system_r;
 	allow $2 system_r;
 
+	files_search_etc($1)
+	admin_pattern($1, { tuned_etc_t tuned_rw_etc_t })
+
+	logging_search_logs($1)
+	admin_pattern($1, tuned_log_t)
+
 	files_search_pids($1)
 	admin_pattern($1, tuned_var_run_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/tuned.te refpolicy/policy/modules/contrib/tuned.te
--- refpolicy/policy/modules/contrib/tuned.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/tuned.te	2012-10-30 19:32:56.507399621 +0100
@@ -1,4 +1,4 @@
-policy_module(tuned, 1.1.0)
+policy_module(tuned, 1.1.2)
 
 ########################################
 #
@@ -12,6 +12,12 @@
 type tuned_initrc_exec_t;
 init_script_file(tuned_initrc_exec_t)
 
+type tuned_etc_t;
+files_config_file(tuned_etc_t)
+
+type tuned_rw_etc_t;
+files_config_file(tuned_rw_etc_t)
+
 type tuned_log_t;
 logging_log_file(tuned_log_t)
 
@@ -20,32 +26,49 @@
 
 ########################################
 #
-# tuned local policy
+# Local policy
 #
 
+allow tuned_t self:capability { sys_admin sys_nice };
 dontaudit tuned_t self:capability { dac_override sys_tty_config };
+allow tuned_t self:process { setsched signal };
+allow tuned_t self:fifo_file rw_fifo_file_perms;
+
+read_files_pattern(tuned_t, tuned_etc_t, tuned_etc_t)
+
+manage_files_pattern(tuned_t, tuned_etc_t, tuned_rw_etc_t)
 
 manage_dirs_pattern(tuned_t, tuned_log_t, tuned_log_t)
-manage_files_pattern(tuned_t, tuned_log_t, tuned_log_t)
+append_files_pattern(tuned_t, tuned_log_t, tuned_log_t)
+create_files_pattern(tuned_t, tuned_log_t, tuned_log_t)
+setattr_files_pattern(tuned_t, tuned_log_t, tuned_log_t)
 logging_log_filetrans(tuned_t, tuned_log_t, file)
 
 manage_files_pattern(tuned_t, tuned_var_run_t, tuned_var_run_t)
-files_pid_filetrans(tuned_t, tuned_var_run_t, file)
-
-corecmd_exec_shell(tuned_t)
-corecmd_exec_bin(tuned_t)
+manage_dirs_pattern(tuned_t, tuned_var_run_t, tuned_var_run_t)
+files_pid_filetrans(tuned_t, tuned_var_run_t, { dir file })
 
 kernel_read_system_state(tuned_t)
 kernel_read_network_state(tuned_t)
+kernel_read_kernel_sysctls(tuned_t)
+kernel_rw_kernel_sysctl(tuned_t)
+kernel_rw_hotplug_sysctls(tuned_t)
+kernel_rw_vm_sysctls(tuned_t)
 
+corecmd_exec_bin(tuned_t)
+corecmd_exec_shell(tuned_t)
+
+dev_getattr_all_blk_files(tuned_t)
+dev_getattr_all_chr_files(tuned_t)
 dev_read_urand(tuned_t)
-dev_read_sysfs(tuned_t)
-# to allow cpu tuning
+dev_rw_sysfs(tuned_t)
 dev_rw_netcontrol(tuned_t)
 
-files_read_etc_files(tuned_t)
 files_read_usr_files(tuned_t)
 files_dontaudit_search_home(tuned_t)
+files_dontaudit_list_tmp(tuned_t)
+
+fs_getattr_xattr_fs(tuned_t)
 
 logging_send_syslog_msg(tuned_t)
 
@@ -53,12 +76,14 @@
 
 userdom_dontaudit_search_user_home_dirs(tuned_t)
 
-# to allow disk tuning
 optional_policy(`
 	fstools_domtrans(tuned_t)
 ')
 
-# to allow network interface tuning
+optional_policy(`
+	mount_domtrans(tuned_t)
+')
+
 optional_policy(`
 	sysnet_domtrans_ifconfig(tuned_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/tvtime.fc refpolicy/policy/modules/contrib/tvtime.fc
--- refpolicy/policy/modules/contrib/tvtime.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/tvtime.fc	2012-10-30 19:32:58.780399626 +0100
@@ -1,5 +1,3 @@
-#
-# /usr
-#
-/usr/bin/tvtime		--	gen_context(system_u:object_r:tvtime_exec_t,s0)
+HOME_DIR/\.tvtime(/.*)?	gen_context(system_u:object_r:tvtime_home_t,s0)
 
+/usr/bin/tvtime	--	gen_context(system_u:object_r:tvtime_exec_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/tvtime.if refpolicy/policy/modules/contrib/tvtime.if
--- refpolicy/policy/modules/contrib/tvtime.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/tvtime.if	2012-10-30 19:32:58.780399626 +0100
@@ -1,4 +1,4 @@
-## <summary> tvtime - a high quality television application </summary>
+## <summary>High quality television application.</summary>
 
 ########################################
 ## <summary>
@@ -17,24 +17,22 @@
 #
 interface(`tvtime_role',`
 	gen_require(`
-		type tvtime_t, tvtime_exec_t;
+		attribute_role tvtime_roles;
+		type tvtime_t, tvtime_exec_t, tvtime_tmp_t;
 		type tvtime_home_t, tvtime_tmpfs_t;
 	')
 
-	role $1 types tvtime_t;
+	roleattribute $1 tvtime_roles;
 
-	# Type transition
 	domtrans_pattern($2, tvtime_exec_t, tvtime_t)
 
-	# X access, Home files
-	manage_dirs_pattern($2, tvtime_home_t, tvtime_home_t)
-	manage_files_pattern($2, tvtime_home_t, tvtime_home_t)
-	manage_lnk_files_pattern($2, tvtime_home_t, tvtime_home_t)
-	relabel_dirs_pattern($2, tvtime_home_t, tvtime_home_t)
-	relabel_files_pattern($2, tvtime_home_t, tvtime_home_t)
-	relabel_lnk_files_pattern($2, tvtime_home_t, tvtime_home_t)
-
-	# Allow the user domain to signal/ps.
 	ps_process_pattern($2, tvtime_t)
-	allow $2 tvtime_t:process signal_perms;
+	allow $2 tvtime_t:process { ptrace signal_perms };
+
+	allow $2 { tvtime_home_t tvtime_tmp_t }:dir { manage_dir_perms relabel_dir_perms };
+	allow $2 { tvtime_home_t tvtime_tmpfs_t tvtime_tmp_t }:file { manage_file_perms relabel_file_perms };
+	allow $2 { tvtime_home_t tvtime_tmpfs_t }:lnk_file { manage_lnk_file_perms relabel_lnk_file_perms };
+	allow $2 tvtime_tmpfs_t:fifo_file { manage_fifo_file_perms relabel_fifo_file_perms };
+	allow $2 tvtime_tmpfs_t:sock_file { manage_sock_file_perms relabel_sock_file_perms };
+	userdom_user_home_dir_filetrans($2, tvtime_home_t, dir, ".tvtime")
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/tvtime.te refpolicy/policy/modules/contrib/tvtime.te
--- refpolicy/policy/modules/contrib/tvtime.te	2012-05-04 15:16:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/tvtime.te	2012-10-30 19:32:58.781399626 +0100
@@ -1,15 +1,18 @@
-policy_module(tvtime, 2.2.0)
+policy_module(tvtime, 2.2.1)
 
 ########################################
 #
 # Declarations
 #
 
+attribute_role tvtime_roles;
+
 type tvtime_t;
 type tvtime_exec_t;
 typealias tvtime_t alias { user_tvtime_t staff_tvtime_t sysadm_tvtime_t };
 typealias tvtime_t alias { auditadm_tvtime_t secadm_tvtime_t };
 userdom_user_application_domain(tvtime_t, tvtime_exec_t)
+role tvtime_roles types tvtime_t;
 
 type tvtime_home_t alias tvtime_rw_t;
 typealias tvtime_home_t alias { user_tvtime_home_t staff_tvtime_home_t sysadm_tvtime_home_t };
@@ -36,7 +39,6 @@
 allow tvtime_t self:unix_dgram_socket rw_socket_perms;
 allow tvtime_t self:unix_stream_socket rw_stream_socket_perms;
 
-# X access, Home files
 manage_dirs_pattern(tvtime_t, tvtime_home_t, tvtime_home_t)
 manage_files_pattern(tvtime_t, tvtime_home_t, tvtime_home_t)
 manage_lnk_files_pattern(tvtime_t, tvtime_home_t, tvtime_home_t)
@@ -55,30 +57,28 @@
 kernel_read_all_sysctls(tvtime_t)
 kernel_get_sysvipc_info(tvtime_t)
 
-dev_read_urand(tvtime_t)
 dev_read_realtime_clock(tvtime_t)
 dev_read_sound(tvtime_t)
+dev_read_urand(tvtime_t)
 
 files_read_usr_files(tvtime_t)
-files_search_pids(tvtime_t)
-# Read /etc/tvtime
-files_read_etc_files(tvtime_t)
 
-# X access, Home files
+fs_getattr_all_fs(tvtime_t)
 fs_search_auto_mountpoints(tvtime_t)
 
-miscfiles_read_localization(tvtime_t)
+auth_use_nsswitch(tvtime_t)
+
 miscfiles_read_fonts(tvtime_t)
+miscfiles_read_localization(tvtime_t)
 
 userdom_use_user_terminals(tvtime_t)
-userdom_read_user_home_content_files(tvtime_t)
 
-# X access, Home files
 tunable_policy(`use_nfs_home_dirs',`
 	fs_manage_nfs_dirs(tvtime_t)
 	fs_manage_nfs_files(tvtime_t)
 	fs_manage_nfs_symlinks(tvtime_t)
 ')
+
 tunable_policy(`use_samba_home_dirs',`
 	fs_manage_cifs_dirs(tvtime_t)
 	fs_manage_cifs_files(tvtime_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/tzdata.if refpolicy/policy/modules/contrib/tzdata.if
--- refpolicy/policy/modules/contrib/tzdata.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/tzdata.if	2012-10-30 19:33:00.755399630 +0100
@@ -1,13 +1,13 @@
-## <summary>Time zone updater</summary>
+## <summary>Time zone updater.</summary>
 
 ########################################
 ## <summary>
 ##	Execute a domain transition to run tzdata.
 ## </summary>
 ## <param name="domain">
-## <summary>
+##	<summary>
 ##	Domain allowed to transition.
-## </summary>
+##	</summary>
 ## </param>
 #
 interface(`tzdata_domtrans',`
@@ -21,7 +21,9 @@
 
 ########################################
 ## <summary>
-##	Execute the tzdata program in the tzdata domain.
+##	Execute tzdata in the tzdata domain,
+##	and allow the specified role
+##	the tzdata domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -30,16 +32,16 @@
 ## </param>
 ## <param name="role">
 ##	<summary>
-##	The role to allow the tzdata domain.
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <rolecap/>
 #
 interface(`tzdata_run',`
 	gen_require(`
-		type tzdata_t;
+		attribute_role tzdata_roles;
 	')
 
 	tzdata_domtrans($1)
-	role $2 types tzdata_t;
+	roleattribute $2 tzdata_roles;
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/tzdata.te refpolicy/policy/modules/contrib/tzdata.te
--- refpolicy/policy/modules/contrib/tzdata.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/tzdata.te	2012-10-30 19:33:00.756399630 +0100
@@ -1,21 +1,24 @@
-policy_module(tzdata, 1.4.0)
+policy_module(tzdata, 1.4.1)
 
 ########################################
 #
 # Declarations
 #
 
+attribute_role tzdata_roles;
+
 type tzdata_t;
 type tzdata_exec_t;
 init_daemon_domain(tzdata_t, tzdata_exec_t)
 application_domain(tzdata_t, tzdata_exec_t)
+role tzdata_roles types tzdata_t;
 
 ########################################
 #
-# tzdata local policy
+# Local policy
 #
 
-files_read_etc_files(tzdata_t)
+files_read_config_files(tzdata_t)
 files_search_spool(tzdata_t)
 
 fs_getattr_xattr_fs(tzdata_t)
@@ -30,7 +33,6 @@
 
 userdom_use_user_terminals(tzdata_t)
 
-# tzdata looks for /var/spool/postfix/etc/localtime.
 optional_policy(`
 	postfix_search_spool(tzdata_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/ucspitcp.fc refpolicy/policy/modules/contrib/ucspitcp.fc
--- refpolicy/policy/modules/contrib/ucspitcp.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/ucspitcp.fc	2012-09-24 21:28:19.760584123 +0200
@@ -1,3 +1,2 @@
-
 /usr/bin/rblsmtpd	--	gen_context(system_u:object_r:rblsmtpd_exec_t,s0)
 /usr/bin/tcpserver	--	gen_context(system_u:object_r:ucspitcp_exec_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/ucspitcp.if refpolicy/policy/modules/contrib/ucspitcp.if
--- refpolicy/policy/modules/contrib/ucspitcp.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/ucspitcp.if	2012-10-06 21:08:18.048757535 +0200
@@ -1,9 +1,4 @@
-## <summary>ucspitcp policy</summary>
-## <desc>
-##	<p>
-##	Policy for DJB's ucspi-tcpd
-##	</p>
-## </desc>
+## <summary>UNIX Client-Server Program Interface for TCP.</summary>
 
 ########################################
 ## <summary>
@@ -20,10 +15,9 @@
 ##	</summary>
 ## </param>
 #
-interface(`ucspitcp_service_domain', `
+interface(`ucspitcp_service_domain',`
 	gen_require(`
 		type ucspitcp_t;
-		role system_r;
 	')
 
 	domain_type($1)
@@ -31,8 +25,5 @@
 
 	role system_r types $1;
 
-	domain_auto_trans(ucspitcp_t, $2, $1)
-	allow $1 ucspitcp_t:fd use;
-	allow $1 ucspitcp_t:process sigchld;
-	allow $1 ucspitcp_t:tcp_socket rw_stream_socket_perms;
+	domtrans_pattern(ucspitcp_t, $2, $1)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/ucspitcp.te refpolicy/policy/modules/contrib/ucspitcp.te
--- refpolicy/policy/modules/contrib/ucspitcp.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/ucspitcp.te	2012-10-30 19:33:01.839399632 +0100
@@ -1,4 +1,4 @@
-policy_module(ucspitcp, 1.3.0)
+policy_module(ucspitcp, 1.3.1)
 
 ########################################
 #
@@ -8,16 +8,14 @@
 type rblsmtpd_t;
 type rblsmtpd_exec_t;
 init_system_domain(rblsmtpd_t, rblsmtpd_exec_t)
-role system_r types rblsmtpd_t;
 
 type ucspitcp_t;
 type ucspitcp_exec_t;
 init_system_domain(ucspitcp_t, ucspitcp_exec_t)
-role system_r types ucspitcp_t;
 
 ########################################
 #
-# Local policy for rblsmtpd
+# Smtpd local policy
 #
 
 ucspitcp_service_domain(rblsmtpd_t, rblsmtpd_exec_t)
@@ -44,7 +42,7 @@
 
 ########################################
 #
-# Local policy for tcpserver
+# Tcp local policy
 #
 
 allow ucspitcp_t self:capability { setgid setuid };
@@ -54,7 +52,6 @@
 
 corecmd_search_bin(ucspitcp_t)
 
-# base networking:
 corenet_all_recvfrom_unlabeled(ucspitcp_t)
 corenet_all_recvfrom_netlabel(ucspitcp_t)
 corenet_tcp_sendrecv_generic_if(ucspitcp_t)
@@ -66,24 +63,27 @@
 corenet_tcp_bind_generic_node(ucspitcp_t)
 corenet_udp_bind_generic_node(ucspitcp_t)
 
-# server ports:
+corenet_sendrecv_ftp_server_packets(ucspitcp_t)
 corenet_tcp_bind_ftp_port(ucspitcp_t)
+
+corenet_sendrecv_ftp_data_server_packets(ucspitcp_t)
 corenet_tcp_bind_ftp_data_port(ucspitcp_t)
+
+corenet_sendrecv_http_server_packets(ucspitcp_t)
 corenet_tcp_bind_http_port(ucspitcp_t)
+
+corenet_sendrecv_smtp_server_packets(ucspitcp_t)
 corenet_tcp_bind_smtp_port(ucspitcp_t)
+
+corenet_sendrecv_dns_server_packets(ucspitcp_t)
 corenet_tcp_bind_dns_port(ucspitcp_t)
 corenet_udp_bind_dns_port(ucspitcp_t)
-corenet_udp_bind_generic_port(ucspitcp_t)
 
-# server packets:
-corenet_sendrecv_ftp_server_packets(ucspitcp_t)
-corenet_sendrecv_http_server_packets(ucspitcp_t)
-corenet_sendrecv_smtp_server_packets(ucspitcp_t)
-corenet_sendrecv_dns_server_packets(ucspitcp_t)
 corenet_sendrecv_generic_server_packets(ucspitcp_t)
+corenet_udp_bind_generic_port(ucspitcp_t)
 
-files_search_var(ucspitcp_t)
 files_read_etc_files(ucspitcp_t)
+files_search_var(ucspitcp_t)
 
 sysnet_read_config(ucspitcp_t)
 
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/ulogd.fc refpolicy/policy/modules/contrib/ulogd.fc
--- refpolicy/policy/modules/contrib/ulogd.fc	2012-05-04 15:16:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/ulogd.fc	2012-10-30 19:33:04.897399639 +0100
@@ -1,7 +1,9 @@
+/etc/ulogd\.conf	--	gen_context(system_u:object_r:ulogd_etc_t,s0)
+
 /etc/rc\.d/init\.d/ulogd	--	gen_context(system_u:object_r:ulogd_initrc_exec_t,s0)
-/etc/ulogd.conf			--	gen_context(system_u:object_r:ulogd_etc_t,s0)
 
-/usr/lib/ulogd(/.*)?			gen_context(system_u:object_r:ulogd_modules_t,s0)	
-/usr/sbin/ulogd			--	gen_context(system_u:object_r:ulogd_exec_t,s0)
+/usr/lib/ulogd(/.*)?	gen_context(system_u:object_r:ulogd_modules_t,s0)
+
+/usr/sbin/ulogd	--	gen_context(system_u:object_r:ulogd_exec_t,s0)
 
-/var/log/ulogd(/.*)?			gen_context(system_u:object_r:ulogd_var_log_t,s0)
+/var/log/ulogd(/.*)?	gen_context(system_u:object_r:ulogd_var_log_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/ulogd.if refpolicy/policy/modules/contrib/ulogd.if
--- refpolicy/policy/modules/contrib/ulogd.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/ulogd.if	2012-10-30 19:33:04.898399639 +0100
@@ -15,13 +15,13 @@
 		type ulogd_t, ulogd_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, ulogd_exec_t, ulogd_t)
 ')
 
 ########################################
 ## <summary>
-##	Allow the specified domain to read
-##	ulogd configuration files.
+##	Read ulogd configuration files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -41,7 +41,7 @@
 
 ########################################
 ## <summary>
-##	Allow the specified domain to read ulogd's log files.
+##	Read ulogd log files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -62,7 +62,7 @@
 
 #######################################
 ## <summary>
-##	Allow the specified domain to search ulogd's log files.
+##	Search ulogd log files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -81,7 +81,7 @@
 
 ########################################
 ## <summary>
-##	Allow the specified domain to append to ulogd's log files.
+##	Append to ulogd log files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -102,8 +102,8 @@
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate
-##	an ulogd environment
+##	All of the rules required to
+##	administrate an ulogd environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -112,7 +112,7 @@
 ## </param>
 ## <param name="role">
 ##	<summary>
-##	The role to be allowed to manage the syslog domain.
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <rolecap/>
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/ulogd.te refpolicy/policy/modules/contrib/ulogd.te
--- refpolicy/policy/modules/contrib/ulogd.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/ulogd.te	2012-10-30 19:33:04.898399639 +0100
@@ -1,4 +1,4 @@
-policy_module(ulogd, 1.2.0)
+policy_module(ulogd, 1.2.1)
 
 ########################################
 #
@@ -9,38 +9,37 @@
 type ulogd_exec_t;
 init_daemon_domain(ulogd_t, ulogd_exec_t)
 
-# config files
 type ulogd_etc_t;
-files_type(ulogd_etc_t)
+files_config_file(ulogd_etc_t)
 
 type ulogd_initrc_exec_t;
 init_script_file(ulogd_initrc_exec_t)
 
-# /usr/lib files
 type ulogd_modules_t;
 files_type(ulogd_modules_t)
 
-# log files
 type ulogd_var_log_t;
 logging_log_file(ulogd_var_log_t)
 
 ########################################
 #
-# ulogd local policy
+# Local policy
 #
 
-allow ulogd_t self:capability net_admin;
+allow ulogd_t self:capability { net_admin sys_nice };
+allow ulogd_t self:process setsched;
 allow ulogd_t self:netlink_nflog_socket create_socket_perms;
+allow ulogd_t self:netlink_socket create_socket_perms;
+allow ulogd_t self:tcp_socket create_stream_socket_perms;
 
-# config files
 read_files_pattern(ulogd_t, ulogd_etc_t, ulogd_etc_t)
 
-# modules for ulogd
 list_dirs_pattern(ulogd_t, ulogd_modules_t, ulogd_modules_t)
 mmap_files_pattern(ulogd_t, ulogd_modules_t, ulogd_modules_t)
 
-# log files
-manage_files_pattern(ulogd_t, ulogd_var_log_t, ulogd_var_log_t)
+append_files_pattern(ulogd_t, ulogd_var_log_t, ulogd_var_log_t)
+create_files_pattern(ulogd_t, ulogd_var_log_t, ulogd_var_log_t)
+setattr_files_pattern(ulogd_t, ulogd_var_log_t, ulogd_var_log_t)
 logging_log_filetrans(ulogd_t, ulogd_var_log_t, file)
 
 files_read_etc_files(ulogd_t)
@@ -48,20 +47,14 @@
 
 miscfiles_read_localization(ulogd_t)
 
-optional_policy(`
-	allow ulogd_t self:tcp_socket create_stream_socket_perms;
+sysnet_dns_name_resolve(ulogd_t)
 
+optional_policy(`
 	mysql_stream_connect(ulogd_t)
 	mysql_tcp_connect(ulogd_t)
-
-	sysnet_dns_name_resolve(ulogd_t)
 ')
 
 optional_policy(`
-	allow ulogd_t self:tcp_socket create_stream_socket_perms;
-
 	postgresql_stream_connect(ulogd_t)
 	postgresql_tcp_connect(ulogd_t)
-
-	sysnet_dns_name_resolve(ulogd_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/uml.fc refpolicy/policy/modules/contrib/uml.fc
--- refpolicy/policy/modules/contrib/uml.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/uml.fc	2012-10-30 19:33:07.974399645 +0100
@@ -1,14 +1,5 @@
-#
-# HOME_DIR/
-#
-HOME_DIR/\.uml(/.*)?		gen_context(system_u:object_r:uml_rw_t,s0)
+HOME_DIR/\.uml(/.*)?	gen_context(system_u:object_r:uml_rw_t,s0)
 
-#
-# /usr
-#
 /usr/bin/uml_switch	--	gen_context(system_u:object_r:uml_switch_exec_t,s0)
 
-#
-# /var
-#
 /var/run/uml-utilities(/.*)?	gen_context(system_u:object_r:uml_switch_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/uml.if refpolicy/policy/modules/contrib/uml.if
--- refpolicy/policy/modules/contrib/uml.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/uml.if	2012-10-30 19:33:07.975399645 +0100
@@ -1,69 +1,50 @@
-## <summary>Policy for UML</summary>
+## <summary>User mode linux tools and services.</summary>
 
 ########################################
 ## <summary>
-##	Role access for uml
+##	Role access for uml.
 ## </summary>
 ## <param name="role">
 ##	<summary>
-##	Role allowed access
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <param name="domain">
 ##	<summary>
-##	User domain for the role
+##	User domain for the role.
 ##	</summary>
 ## </param>
 #
 interface(`uml_role',`
 	gen_require(`
+		attribute_role uml_roles;
 		type uml_t, uml_exec_t;
 		type uml_ro_t, uml_rw_t, uml_tmp_t;
 		type uml_devpts_t, uml_tmpfs_t;
 	')
 
-	role $1 types uml_t;
+	roleattribute $1 uml_roles;
 
-	# Transition from the user domain to this domain.
 	domtrans_pattern($2, uml_exec_t, uml_t)
 
-	# for mconsole
-	allow $2 uml_t:unix_dgram_socket sendto;
+	dgram_send_pattern($2, uml_tmpfs_t, uml_tmpfs_t, uml_t)
+
 	allow uml_t $2:unix_dgram_socket sendto;
 
-	# allow ps, ptrace, signal
 	ps_process_pattern($2, uml_t)
 	allow $2 uml_t:process { ptrace signal_perms };
 
-	allow $2 uml_ro_t:dir list_dir_perms;
-	read_files_pattern($2, uml_ro_t, uml_ro_t)
-	read_lnk_files_pattern($2, uml_ro_t, uml_ro_t)
-
-	manage_dirs_pattern($2, { uml_ro_t uml_rw_t }, { uml_ro_t uml_rw_t })
-	manage_files_pattern($2, { uml_ro_t uml_rw_t }, { uml_ro_t uml_rw_t })
-	manage_lnk_files_pattern($2, { uml_ro_t uml_rw_t }, { uml_ro_t uml_rw_t })
-	manage_fifo_files_pattern($2, { uml_ro_t uml_rw_t }, { uml_ro_t uml_rw_t })
-	manage_sock_files_pattern($2, { uml_ro_t uml_rw_t }, { uml_ro_t uml_rw_t })
-	relabel_dirs_pattern($2, { uml_ro_t uml_rw_t }, { uml_ro_t uml_rw_t })
-	relabel_files_pattern($2, { uml_ro_t uml_rw_t }, { uml_ro_t uml_rw_t })
-	relabel_lnk_files_pattern($2, { uml_ro_t uml_rw_t }, { uml_ro_t uml_rw_t })
-	relabel_fifo_files_pattern($2, { uml_ro_t uml_rw_t }, { uml_ro_t uml_rw_t })
-	relabel_sock_files_pattern($2, { uml_ro_t uml_rw_t }, { uml_ro_t uml_rw_t })
-
-	manage_dirs_pattern($2, { uml_ro_t uml_rw_t uml_exec_t }, { uml_ro_t uml_rw_t uml_exec_t })
-	manage_files_pattern($2, { uml_ro_t uml_rw_t uml_exec_t }, { uml_ro_t uml_rw_t uml_exec_t })
-	relabel_dirs_pattern($2, { uml_ro_t uml_rw_t uml_exec_t }, { uml_ro_t uml_rw_t uml_exec_t })
-	relabel_files_pattern($2, { uml_ro_t uml_rw_t uml_exec_t }, { uml_ro_t uml_rw_t uml_exec_t })
-
-	manage_dirs_pattern($2, uml_tmp_t, uml_tmp_t)
-	manage_files_pattern($2, uml_tmp_t, uml_tmp_t)
-	manage_lnk_files_pattern($2, uml_tmp_t, uml_tmp_t)
-	manage_sock_files_pattern($2, uml_tmp_t, uml_tmp_t)
+	allow $2 { uml_ro_t uml_rw_t uml_tmp_t uml_exec_t }:dir { manage_dir_perms relabel_dir_perms };
+	allow $2 { uml_ro_t uml_rw_t uml_tmp_t uml_tmpfs_t uml_exec_t }:file { manage_file_perms relabel_file_perms };
+	allow $2 { uml_ro_t uml_rw_t uml_tmpfs_t }:lnk_file { manage_lnk_file_perms relabel_lnk_file_perms };
+	allow $2 { uml_ro_t uml_rw_t uml_tmpfs_t }:fifo_file { manage_fifo_file_perms relabel_fifo_file_perms };
+	allow $2 { uml_ro_t uml_rw_t uml_tmpfs_t }:sock_file { manage_sock_file_perms relabel_sock_file_perms };
+	userdom_user_home_dir_filetrans($2, uml_rw_t, dir, ".uml")
 ')
 
 ########################################
 ## <summary>
-##	Set attributes on uml utility socket files.
+##	Set attributes of uml pid sock files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -76,12 +57,13 @@
 		type uml_switch_var_run_t;
 	')
 
-	allow $1 uml_switch_var_run_t:sock_file setattr;
+	allow $1 uml_switch_var_run_t:sock_file setattr_sock_file_perms;
 ')
 
 ########################################
 ## <summary>
-##	Manage uml utility files.
+##	Create, read, write, and delete
+##	uml pid files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/uml.te refpolicy/policy/modules/contrib/uml.te
--- refpolicy/policy/modules/contrib/uml.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/uml.te	2012-10-30 19:33:07.975399645 +0100
@@ -1,17 +1,20 @@
-policy_module(uml, 2.2.0)
+policy_module(uml, 2.2.1)
 
 ########################################
 #
 # Declarations
 #
 
+attribute_role uml_roles;
+
 type uml_t;
-type uml_exec_t;
+type uml_exec_t; # customizable
 typealias uml_t alias { user_uml_t staff_uml_t sysadm_uml_t };
 typealias uml_t alias { auditadm_uml_t secadm_uml_t };
 userdom_user_application_domain(uml_t, uml_exec_t)
+role uml_roles types uml_t;
 
-type uml_ro_t;
+type uml_ro_t; # customizable
 typealias uml_ro_t alias { user_uml_ro_t staff_uml_ro_t sysadm_uml_ro_t };
 typealias uml_ro_t alias { auditadm_uml_ro_t secadm_uml_ro_t };
 userdom_user_home_content(uml_ro_t)
@@ -49,93 +52,88 @@
 # Local policy
 #
 
+allow uml_t self:process signal_perms;
 allow uml_t self:fifo_file rw_fifo_file_perms;
-allow uml_t self:process { signal_perms ptrace };
 allow uml_t self:unix_stream_socket create_stream_socket_perms;
-allow uml_t self:unix_dgram_socket create_socket_perms;
-# Use the network.
-allow uml_t self:tcp_socket create_stream_socket_perms;
-allow uml_t self:udp_socket create_socket_perms;
+allow uml_t self:tcp_socket { accept listen };
 allow uml_t self:tun_socket create;
-# for mconsole
-allow uml_t self:unix_dgram_socket sendto;
+allow uml_t self:unix_dgram_socket { create_socket_perms sendto };
 
-# allow the UML thing to happen
-allow uml_t uml_devpts_t:chr_file { rw_file_perms setattr };
+allow uml_t uml_devpts_t:chr_file { rw_file_perms setattr_chr_file_perms };
 term_create_pty(uml_t, uml_devpts_t)
 
 manage_dirs_pattern(uml_t, uml_tmp_t, uml_tmp_t)
 manage_files_pattern(uml_t, uml_tmp_t, uml_tmp_t)
 files_tmp_filetrans(uml_t, uml_tmp_t, { file dir })
-can_exec(uml_t, uml_tmp_t)
 
 manage_files_pattern(uml_t, uml_tmpfs_t, uml_tmpfs_t)
 manage_lnk_files_pattern(uml_t, uml_tmpfs_t, uml_tmpfs_t)
 manage_fifo_files_pattern(uml_t, uml_tmpfs_t, uml_tmpfs_t)
 manage_sock_files_pattern(uml_t, uml_tmpfs_t, uml_tmpfs_t)
 fs_tmpfs_filetrans(uml_t, uml_tmpfs_t, { file lnk_file sock_file fifo_file })
-can_exec(uml_t, uml_tmpfs_t)
 
-# access config files
-allow uml_t { uml_ro_t uml_ro_t }:dir list_dir_perms;
-read_files_pattern(uml_t, { uml_ro_t uml_ro_t }, { uml_ro_t uml_ro_t })
-read_lnk_files_pattern(uml_t, { uml_ro_t uml_ro_t }, { uml_ro_t uml_ro_t })
+allow uml_t uml_ro_t:dir list_dir_perms;
+allow uml_t uml_ro_t:file read_file_perms;
+allow uml_t uml_ro_t:lnk_file read_lnk_file_perms;
 
 manage_dirs_pattern(uml_t, uml_rw_t, uml_rw_t)
 manage_files_pattern(uml_t, uml_rw_t, uml_rw_t)
 manage_lnk_files_pattern(uml_t, uml_rw_t, uml_rw_t)
 manage_fifo_files_pattern(uml_t, uml_rw_t, uml_rw_t)
 manage_sock_files_pattern(uml_t, uml_rw_t, uml_rw_t)
-userdom_user_home_dir_filetrans(uml_t, uml_rw_t, { file lnk_file sock_file fifo_file })
+userdom_user_home_dir_filetrans(uml_t, uml_rw_t, dir, ".uml")
 
-can_exec(uml_t, { uml_exec_t uml_exec_t })
+can_exec(uml_t, { uml_exec_t uml_tmp_t uml_tmpfs_t })
 
 kernel_read_system_state(uml_t)
-# for SKAS - need something better
 kernel_write_proc_files(uml_t)
 
-# for xterm
 corecmd_exec_bin(uml_t)
 
 corenet_all_recvfrom_unlabeled(uml_t)
 corenet_all_recvfrom_netlabel(uml_t)
 corenet_tcp_sendrecv_generic_if(uml_t)
-corenet_udp_sendrecv_generic_if(uml_t)
 corenet_tcp_sendrecv_generic_node(uml_t)
-corenet_udp_sendrecv_generic_node(uml_t)
 corenet_tcp_sendrecv_all_ports(uml_t)
-corenet_udp_sendrecv_all_ports(uml_t)
-corenet_tcp_connect_all_ports(uml_t)
+
 corenet_sendrecv_all_client_packets(uml_t)
+corenet_tcp_connect_all_ports(uml_t)
+
 corenet_rw_tun_tap_dev(uml_t)
 
 domain_use_interactive_fds(uml_t)
 
-# for xterm
-files_read_etc_files(uml_t)
 files_dontaudit_read_etc_runtime_files(uml_t)
-# putting uml data under /var is usual...
-files_search_var(uml_t)
 
-fs_getattr_xattr_fs(uml_t)
+fs_getattr_all_fs(uml_t)
+fs_search_auto_mountpoints(uml_t)
+
+auth_use_nsswitch(uml_t)
 
 init_read_utmp(uml_t)
 init_dontaudit_write_utmp(uml_t)
 
-# for xterm
 libs_exec_lib_files(uml_t)
 
-# Inherit and use descriptors from newrole.
-seutil_use_newrole_fds(uml_t)
-
-# Use the network.
-sysnet_read_config(uml_t)
-
 userdom_use_user_terminals(uml_t)
 userdom_attach_admin_tun_iface(uml_t)
 
+tunable_policy(`use_nfs_home_dirs',`
+	fs_manage_nfs_dirs(uml_t)
+	fs_manage_nfs_files(uml_t)
+	fs_manage_nfs_named_pipes(uml_t)
+	fs_manage_nfs_symlinks(uml_t)
+')
+
+tunable_policy(`use_samba_home_dirs',`
+	fs_manage_cifs_dirs(uml_t)
+	fs_manage_cifs_files(uml_t)
+	fs_manage_cifs_named_pipes(uml_t)
+	fs_manage_cifs_symlinks(uml_t)
+')
+
 optional_policy(`
-	nis_use_ypbind(uml_t)
+	seutil_use_newrole_fds(uml_t)
 ')
 
 optional_policy(`
@@ -144,13 +142,12 @@
 
 ########################################
 #
-# Local policy
+# Switch local policy
 #
 
 dontaudit uml_switch_t self:capability sys_tty_config;
 allow uml_switch_t self:process signal_perms;
-allow uml_switch_t self:unix_dgram_socket create_socket_perms;
-allow uml_switch_t self:unix_stream_socket create_stream_socket_perms;
+allow uml_switch_t self:unix_stream_socket { accept listen };
 
 manage_files_pattern(uml_switch_t, uml_switch_var_run_t, uml_switch_var_run_t)
 manage_sock_files_pattern(uml_switch_t, uml_switch_var_run_t, uml_switch_var_run_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/updfstab.fc refpolicy/policy/modules/contrib/updfstab.fc
--- refpolicy/policy/modules/contrib/updfstab.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/updfstab.fc	2012-10-30 19:33:12.934399656 +0100
@@ -1,3 +1,2 @@
-
 /usr/sbin/fstab-sync	--	gen_context(system_u:object_r:updfstab_exec_t,s0)
 /usr/sbin/updfstab	--	gen_context(system_u:object_r:updfstab_exec_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/updfstab.if refpolicy/policy/modules/contrib/updfstab.if
--- refpolicy/policy/modules/contrib/updfstab.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/updfstab.if	2012-10-30 19:33:12.934399656 +0100
@@ -1,4 +1,4 @@
-## <summary>Red Hat utility to change /etc/fstab.</summary>
+## <summary>Red Hat utility to change fstab.</summary>
 
 ########################################
 ## <summary>
@@ -15,7 +15,6 @@
 		type updfstab_t, updfstab_exec_t;
 	')
 
-	files_search_usr($1)
 	corecmd_search_bin($1)
 	domtrans_pattern($1, updfstab_exec_t, updfstab_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/updfstab.te refpolicy/policy/modules/contrib/updfstab.te
--- refpolicy/policy/modules/contrib/updfstab.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/updfstab.te	2012-10-30 19:33:12.934399656 +0100
@@ -22,14 +22,23 @@
 kernel_use_fds(updfstab_t)
 kernel_read_kernel_sysctls(updfstab_t)
 kernel_dontaudit_write_kernel_sysctl(updfstab_t)
-# for /proc/partitions
 kernel_read_system_state(updfstab_t)
-# cjp: why is this required
 kernel_change_ring_buffer_level(updfstab_t)
 
+corecmd_exec_bin(updfstab_t)
+
 dev_read_sysfs(updfstab_t)
 dev_manage_generic_symlinks(updfstab_t)
 
+domain_use_interactive_fds(updfstab_t)
+
+files_manage_mnt_files(updfstab_t)
+files_manage_mnt_dirs(updfstab_t)
+files_manage_mnt_symlinks(updfstab_t)
+files_manage_etc_files(updfstab_t)
+files_dontaudit_search_home(updfstab_t)
+files_read_etc_runtime_files(updfstab_t)
+
 fs_getattr_xattr_fs(updfstab_t)
 fs_getattr_tmpfs(updfstab_t)
 fs_getattr_tmpfs_dirs(updfstab_t)
@@ -51,23 +60,11 @@
 
 term_dontaudit_use_console(updfstab_t)
 
-corecmd_exec_bin(updfstab_t)
-
-domain_use_interactive_fds(updfstab_t)
-
-files_manage_mnt_files(updfstab_t)
-files_manage_mnt_dirs(updfstab_t)
-files_manage_mnt_symlinks(updfstab_t)
-files_manage_etc_files(updfstab_t)
-files_dontaudit_search_home(updfstab_t)
-# for /etc/mtab
-files_read_etc_runtime_files(updfstab_t)
-
 init_use_fds(updfstab_t)
 init_use_script_ptys(updfstab_t)
 
-logging_send_syslog_msg(updfstab_t)
 logging_search_logs(updfstab_t)
+logging_send_syslog_msg(updfstab_t)
 
 miscfiles_read_localization(updfstab_t)
 
@@ -83,9 +80,13 @@
 ')
 
 optional_policy(`
+	dbus_system_bus_client(updfstab_t)
+
 	init_dbus_chat_script(updfstab_t)
 
-	dbus_system_bus_client(updfstab_t)
+	optional_policy(`
+		hal_dbus_chat(updfstab_t)
+	')
 ')
 
 optional_policy(`
@@ -94,7 +95,6 @@
 
 optional_policy(`
 	hal_stream_connect(updfstab_t)
-	hal_dbus_chat(updfstab_t)
 ')
 
 optional_policy(`
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/uptime.fc refpolicy/policy/modules/contrib/uptime.fc
--- refpolicy/policy/modules/contrib/uptime.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/uptime.fc	2012-10-30 19:33:14.266399659 +0100
@@ -1,6 +1,9 @@
-
 /etc/uptimed\.conf	--	gen_context(system_u:object_r:uptimed_etc_t,s0)
 
+/etc/rc\.d/init\.d/uptimed	--	gen_context(system_u:object_r:uptimed_initrc_exec_t,s0)
+
 /usr/sbin/uptimed	--	gen_context(system_u:object_r:uptimed_exec_t,s0)
 
+/var/run/uptimed\.pid	--	gen_context(system_u:object_r:uptimed_var_run_t,s0)
+
 /var/spool/uptimed(/.*)?	gen_context(system_u:object_r:uptimed_spool_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/uptime.if refpolicy/policy/modules/contrib/uptime.if
--- refpolicy/policy/modules/contrib/uptime.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/uptime.if	2012-10-30 19:33:14.266399659 +0100
@@ -1 +1,42 @@
-## <summary>Uptime daemon</summary>
+## <summary>Daemon to record and keep track of system up times.</summary>
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an uptime environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`uptime_admin',`
+	gen_require(`
+		type uptimed_t, uptimed_initrc_exec_t. uptimed_etc_t;
+		type uptimed_spool_t, uptimed_var_run_t;
+	')
+
+	allow $1 uptimed_t:process { ptrace signal_perms };
+	ps_process_pattern($1, uptimed_t)
+
+	init_labeled_script_domtrans($1, uptimed_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 uptimed_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	files_search_etc($1)
+	admin_pattern($1, uptimed_etc_t)
+
+	files_search_spool($1)
+	admin_pattern($1, uptimed_spool_t)
+
+	files_search_pids($1)
+	admin_pattern($1, uptimed_var_run_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/uptime.te refpolicy/policy/modules/contrib/uptime.te
--- refpolicy/policy/modules/contrib/uptime.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/uptime.te	2012-10-30 19:33:14.267399659 +0100
@@ -1,4 +1,4 @@
-policy_module(uptime, 1.4.0)
+policy_module(uptime, 1.4.1)
 
 ########################################
 #
@@ -12,6 +12,9 @@
 type uptimed_etc_t alias etc_uptimed_t;
 files_config_file(uptimed_etc_t)
 
+type uptimed_initrc_exec_t;
+init_script_file(uptimed_initrc_exec_t)
+
 type uptimed_spool_t;
 files_type(uptimed_spool_t)
 
@@ -25,12 +28,9 @@
 
 dontaudit uptimed_t self:capability sys_tty_config;
 allow uptimed_t self:process signal_perms;
-allow uptimed_t self:fifo_file write_file_perms;
+allow uptimed_t self:fifo_file rw_fifo_file_perms;
 
 allow uptimed_t uptimed_etc_t:file read_file_perms;
-files_search_etc(uptimed_t)
-
-allow uptimed_t uptimed_spool_t:file manage_file_perms;
 
 manage_files_pattern(uptimed_t, uptimed_var_run_t, uptimed_var_run_t)
 files_pid_filetrans(uptimed_t, uptimed_var_run_t, file)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/usbmodules.fc refpolicy/policy/modules/contrib/usbmodules.fc
--- refpolicy/policy/modules/contrib/usbmodules.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/usbmodules.fc	2012-10-30 19:33:16.544399663 +0100
@@ -1,9 +1,3 @@
-#
-# /sbin
-#
-/sbin/usbmodules		--	gen_context(system_u:object_r:usbmodules_exec_t,s0)
+/sbin/usbmodules	--	gen_context(system_u:object_r:usbmodules_exec_t,s0)
 
-#
-# /usr
-#
 /usr/sbin/usbmodules	--	gen_context(system_u:object_r:usbmodules_exec_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/usbmodules.if refpolicy/policy/modules/contrib/usbmodules.if
--- refpolicy/policy/modules/contrib/usbmodules.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/usbmodules.if	2012-10-30 19:33:16.544399663 +0100
@@ -1,4 +1,4 @@
-## <summary>List kernel modules of USB devices</summary>
+## <summary>List kernel modules of USB devices.</summary>
 
 ########################################
 ## <summary>
@@ -15,14 +15,15 @@
 		type usbmodules_t, usbmodules_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, usbmodules_exec_t, usbmodules_t)
 ')
 
 ########################################
 ## <summary>
-##	Execute usbmodules in the usbmodules domain, and
-##	allow the specified role the usbmodules domain,
-##	and use the caller's terminal.
+##	Execute usbmodules in the usbmodules
+##	domain, and allow the specified
+##	role the usbmodules domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -38,9 +39,9 @@
 #
 interface(`usbmodules_run',`
 	gen_require(`
-		type usbmodules_t;
+		attribute_role usbmodules_roles;
 	')
 
 	usbmodules_domtrans($1)
-	role $2 types usbmodules_t;
+	roleattribute $2 usbmodules_roles;
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/usbmodules.te refpolicy/policy/modules/contrib/usbmodules.te
--- refpolicy/policy/modules/contrib/usbmodules.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/usbmodules.te	2012-10-30 19:33:16.545399663 +0100
@@ -1,14 +1,16 @@
-policy_module(usbmodules, 1.2.0)
+policy_module(usbmodules, 1.2.1)
 
 ########################################
 #
 # Declarations
 #
 
+attribute_role usbmodules_roles;
+
 type usbmodules_t;
 type usbmodules_exec_t;
 init_system_domain(usbmodules_t, usbmodules_exec_t)
-role system_r types usbmodules_t;
+role usbmodules_roles types usbmodules_t;
 
 ########################################
 #
@@ -20,18 +22,17 @@
 files_list_kernel_modules(usbmodules_t)
 
 dev_list_usbfs(usbmodules_t)
-# allow usb device access
 dev_rw_usbfs(usbmodules_t)
 
 files_list_etc(usbmodules_t)
-# needs etc_t read access for the hotplug config, maybe should have a new type
-files_read_etc_files(usbmodules_t)
 
 term_read_console(usbmodules_t)
 term_write_console(usbmodules_t)
 
 init_use_fds(usbmodules_t)
 
+logging_send_syslog_msg(usbmodules_t)
+
 miscfiles_read_hwdata(usbmodules_t)
 
 modutils_read_module_deps(usbmodules_t)
@@ -41,7 +42,3 @@
 optional_policy(`
 	hotplug_read_config(usbmodules_t)
 ')
-
-optional_policy(`
-	logging_send_syslog_msg(usbmodules_t)
-')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/usbmuxd.fc refpolicy/policy/modules/contrib/usbmuxd.fc
--- refpolicy/policy/modules/contrib/usbmuxd.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/usbmuxd.fc	2012-10-30 19:33:17.624399666 +0100
@@ -1,3 +1,3 @@
 /usr/sbin/usbmuxd	--	gen_context(system_u:object_r:usbmuxd_exec_t,s0)
 
-/var/run/usbmuxd.*	 	gen_context(system_u:object_r:usbmuxd_var_run_t,s0)
+/var/run/usbmuxd.*	gen_context(system_u:object_r:usbmuxd_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/usbmuxd.if refpolicy/policy/modules/contrib/usbmuxd.if
--- refpolicy/policy/modules/contrib/usbmuxd.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/usbmuxd.if	2012-10-30 19:33:17.625399666 +0100
@@ -1,4 +1,4 @@
-## <summary>USB multiplexing daemon for communicating with Apple iPod Touch and iPhone</summary>
+## <summary>USB multiplexing daemon for communicating with Apple iPod Touch and iPhone.</summary>
 
 ########################################
 ## <summary>
@@ -15,13 +15,14 @@
 		type usbmuxd_t, usbmuxd_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, usbmuxd_exec_t, usbmuxd_t)
 ')
 
 #####################################
 ## <summary>
-##	Connect to usbmuxd over a unix domain
-##	stream socket.
+##	Connect to usbmuxd with a unix
+##	domain stream socket.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/usbmuxd.te refpolicy/policy/modules/contrib/usbmuxd.te
--- refpolicy/policy/modules/contrib/usbmuxd.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/usbmuxd.te	2012-10-30 19:33:17.625399666 +0100
@@ -1,25 +1,28 @@
-policy_module(usbmuxd, 1.1.0)
+policy_module(usbmuxd, 1.1.1)
 
 ########################################
 #
 # Declarations
 #
 
+attribute_role usbmuxd_roles;
+roleattribute system_r usbmuxd_roles;
+
 type usbmuxd_t;
 type usbmuxd_exec_t;
 application_domain(usbmuxd_t, usbmuxd_exec_t)
-role system_r types usbmuxd_t;
+role usbmuxd_roles types usbmuxd_t;
 
 type usbmuxd_var_run_t;
 files_pid_file(usbmuxd_var_run_t)
 
 ########################################
 #
-# usbmuxd local policy
+# Local policy
 #
 
 allow usbmuxd_t self:capability { kill setgid setuid };
-allow usbmuxd_t self:process { fork signal signull };
+allow usbmuxd_t self:process { signal signull };
 allow usbmuxd_t self:fifo_file rw_fifo_file_perms;
 
 manage_dirs_pattern(usbmuxd_t, usbmuxd_var_run_t, usbmuxd_var_run_t)
@@ -33,10 +36,8 @@
 dev_read_sysfs(usbmuxd_t)
 dev_rw_generic_usb_dev(usbmuxd_t)
 
-files_read_etc_files(usbmuxd_t)
+auth_use_nsswitch(usbmuxd_t)
 
 miscfiles_read_localization(usbmuxd_t)
 
-auth_use_nsswitch(usbmuxd_t)
-
 logging_send_syslog_msg(usbmuxd_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/userhelper.fc refpolicy/policy/modules/contrib/userhelper.fc
--- refpolicy/policy/modules/contrib/userhelper.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/userhelper.fc	2012-10-30 19:33:24.023399679 +0100
@@ -1,9 +1,5 @@
-#
-# /etc
-#
-/etc/security/console\.apps(/.*)?		gen_context(system_u:object_r:userhelper_conf_t,s0)
+/etc/security/console\.apps(/.*)?	gen_context(system_u:object_r:userhelper_conf_t,s0)
 
-#
-# /usr
-#
-/usr/sbin/userhelper		--	gen_context(system_u:object_r:userhelper_exec_t,s0)
+/usr/bin/consolehelper	--	gen_context(system_u:object_r:consolehelper_exec_t,s0)
+
+/usr/sbin/userhelper	--	gen_context(system_u:object_r:userhelper_exec_t,s0)
\ No newline at end of file
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/userhelper.if refpolicy/policy/modules/contrib/userhelper.if
--- refpolicy/policy/modules/contrib/userhelper.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/userhelper.if	2012-10-30 19:33:24.024399679 +0100
@@ -1,4 +1,4 @@
-## <summary>SELinux utility to run a shell with a new role</summary>
+## <summary>A wrapper that helps users run system programs.</summary>
 
 #######################################
 ## <summary>
@@ -23,8 +23,9 @@
 #
 template(`userhelper_role_template',`
 	gen_require(`
-		attribute userhelper_type;
-		type userhelper_exec_t, userhelper_conf_t;
+		attribute userhelper_type, consolehelper_type;
+		attribute_role userhelper_roles, consolehelper_roles;
+		type userhelper_exec_t, consolehelper_exec_t, userhelper_conf_t;
 	')
 
 	########################################
@@ -32,133 +33,62 @@
 	# Declarations
 	#
 
+	type $1_consolehelper_t, consolehelper_type;
+	userdom_user_application_domain($1_consolehelper_t, consolehelper_exec_t)
+	
+	role consolehelper_roles types $1_consolehelper_t;
+	roleattribute $2 consolehelper_roles;
+
 	type $1_userhelper_t, userhelper_type;
 	userdom_user_application_domain($1_userhelper_t, userhelper_exec_t)
+
 	domain_role_change_exemption($1_userhelper_t)
 	domain_obj_id_change_exemption($1_userhelper_t)
 	domain_interactive_fd($1_userhelper_t)
 	domain_subj_id_change_exemption($1_userhelper_t)
-	role $2 types $1_userhelper_t;
+	
+	role userhelper_roles types $1_userhelper_t;
+	roleattribute $2 userhelper_roles;
 
 	########################################
 	#
-	# Local policy
+	# Consolehelper local policy
 	#
-	allow $1_userhelper_t self:capability { setuid setgid net_bind_service dac_override chown sys_tty_config };
-	allow $1_userhelper_t self:process ~{ ptrace setcurrent setexec setfscreate setrlimit execmem execstack execheap };
-	allow $1_userhelper_t self:process setexec;
-	allow $1_userhelper_t self:fd use;
-	allow $1_userhelper_t self:fifo_file rw_fifo_file_perms;
-	allow $1_userhelper_t self:shm create_shm_perms;
-	allow $1_userhelper_t self:sem create_sem_perms;
-	allow $1_userhelper_t self:msgq create_msgq_perms;
-	allow $1_userhelper_t self:msg { send receive };
-	allow $1_userhelper_t self:unix_dgram_socket create_socket_perms;
-	allow $1_userhelper_t self:unix_stream_socket create_stream_socket_perms;
-	allow $1_userhelper_t self:unix_dgram_socket sendto;
-	allow $1_userhelper_t self:unix_stream_socket connectto;
-	allow $1_userhelper_t self:sock_file read_sock_file_perms;
 
-	#Transition to the derived domain.
-	domtrans_pattern($3, userhelper_exec_t, $1_userhelper_t)
+	domtrans_pattern($3, consolehelper_exec_t, $1_consolehelper_t)
 
-	allow $1_userhelper_t userhelper_conf_t:dir rw_dir_perms;
-	rw_files_pattern($1_userhelper_t, userhelper_conf_t, userhelper_conf_t)
+	allow $3 $1_consolehelper_t:process { ptrace signal_perms };
+	ps_process_pattern($3, $1_consolehelper_t)
 
-	can_exec($1_userhelper_t, userhelper_exec_t)
+	auth_use_pam($1_consolehelper_t)
 
-	dontaudit $3 $1_userhelper_t:process signal;
+	optional_policy(`
+		dbus_connect_all_session_bus($1_consolehelper_t)
 
-	kernel_read_all_sysctls($1_userhelper_t)
-	kernel_getattr_debugfs($1_userhelper_t)
-	kernel_read_system_state($1_userhelper_t)
-
-	# Execute shells
-	corecmd_exec_shell($1_userhelper_t)
-	# By default, revert to the calling domain when a program is executed
-	corecmd_bin_domtrans($1_userhelper_t, $3)
+		optional_policy(`
+			userhelper_dbus_chat_all_consolehelper($3)
+		')
+	')
 
-	# Inherit descriptors from the current session.
-	domain_use_interactive_fds($1_userhelper_t)
-	# for when the user types "exec userhelper" at the command line
-	domain_sigchld_interactive_fds($1_userhelper_t)
-
-	dev_read_urand($1_userhelper_t)
-	# Read /dev directories and any symbolic links.
-	dev_list_all_dev_nodes($1_userhelper_t)
-
-	files_list_var_lib($1_userhelper_t)
-	# Read the /etc/security/default_type file
-	files_read_etc_files($1_userhelper_t)
-	# Read /var.
-	files_read_var_files($1_userhelper_t)
-	files_read_var_symlinks($1_userhelper_t)
-	# for some PAM modules and for cwd
-	files_search_home($1_userhelper_t)
-
-	fs_search_auto_mountpoints($1_userhelper_t)
-	fs_read_nfs_files($1_userhelper_t)
-	fs_read_nfs_symlinks($1_userhelper_t)
-
-	# Allow $1_userhelper to obtain contexts to relabel TTYs
-	selinux_get_fs_mount($1_userhelper_t)
-	selinux_validate_context($1_userhelper_t)
-	selinux_compute_access_vector($1_userhelper_t)
-	selinux_compute_create_context($1_userhelper_t)
-	selinux_compute_relabel_context($1_userhelper_t)
-	selinux_compute_user_contexts($1_userhelper_t)
-
-	# Read the devpts root directory.
-	term_list_ptys($1_userhelper_t)
-	# Relabel terminals.
-	term_relabel_all_ttys($1_userhelper_t)
-	term_relabel_all_ptys($1_userhelper_t)
-	# Access terminals.
-	term_use_all_ttys($1_userhelper_t)
-	term_use_all_ptys($1_userhelper_t)
+	########################################
+	#
+	# Userhelper local policy
+	#
 
-	auth_domtrans_chk_passwd($1_userhelper_t)
-	auth_manage_pam_pid($1_userhelper_t)
-	auth_manage_var_auth($1_userhelper_t)
-	auth_search_pam_console_data($1_userhelper_t)
-
-	# Inherit descriptors from the current session.
-	init_use_fds($1_userhelper_t)
-	# Write to utmp.
-	init_manage_utmp($1_userhelper_t)
-	init_pid_filetrans_utmp($1_userhelper_t)
+	domtrans_pattern($3, userhelper_exec_t, $1_userhelper_t)
 
-	miscfiles_read_localization($1_userhelper_t)
+	dontaudit $3 $1_userhelper_t:process signal;
 
-	seutil_read_config($1_userhelper_t)
-	seutil_read_default_contexts($1_userhelper_t)
+	corecmd_bin_domtrans($1_userhelper_t, $3)
+
+	auth_domtrans_chk_passwd($1_userhelper_t)
+	auth_use_nsswitch($1_userhelper_t)
 
-	# Allow $1_userhelper_t to transition to user domains.
 	userdom_bin_spec_domtrans_unpriv_users($1_userhelper_t)
 	userdom_entry_spec_domtrans_unpriv_users($1_userhelper_t)
 
-	ifdef(`distro_redhat',`
-		optional_policy(`
-			# Allow transitioning to rpm_t, for up2date
-			rpm_domtrans($1_userhelper_t)
-		')
-	')
-
-	optional_policy(`
-		logging_send_syslog_msg($1_userhelper_t)
-	')
-
-	optional_policy(`
-		nis_use_ypbind($1_userhelper_t)
-	')
-
-	optional_policy(`
-		nscd_socket_use($1_userhelper_t)
-	')
-
 	optional_policy(`
 		tunable_policy(`! secure_mode',`
-			#if we are not in secure mode then we can transition to sysadm_t
 			sysadm_bin_spec_domtrans($1_userhelper_t)
 			sysadm_entry_spec_domtrans($1_userhelper_t)
 		')
@@ -167,7 +97,7 @@
 
 ########################################
 ## <summary>
-##	Search the userhelper configuration directory.
+##	Search userhelper configuration directories.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -186,7 +116,7 @@
 ########################################
 ## <summary>
 ##	Do not audit attempts to search
-##	the userhelper configuration directory.
+##	userhelper configuration directories.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -204,7 +134,28 @@
 
 ########################################
 ## <summary>
-##	Allow domain to use userhelper file descriptor.
+##	Send and receive messages from
+##	consolehelper over dbus.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`userhelper_dbus_chat_all_consolehelper',`
+	gen_require(`
+		attribute consolehelper_type;
+		class dbus send_msg;
+	')
+
+	allow $1 consolehelper_type:dbus send_msg;
+	allow consolehelper_type $1:dbus send_msg;
+')
+
+########################################
+## <summary>
+##	Use userhelper all userhelper file descriptors.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -222,7 +173,7 @@
 
 ########################################
 ## <summary>
-##	Allow domain to send sigchld to userhelper.
+##	Send child terminated signals to all userhelper.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -253,5 +204,6 @@
 		type userhelper_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	can_exec($1, userhelper_exec_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/userhelper.te refpolicy/policy/modules/contrib/userhelper.te
--- refpolicy/policy/modules/contrib/userhelper.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/userhelper.te	2012-10-30 19:33:24.025399679 +0100
@@ -1,14 +1,164 @@
-policy_module(userhelper, 1.7.0)
+policy_module(userhelper, 1.7.1)
 
 ########################################
 #
 # Declarations
 #
 
+attribute consolehelper_type;
 attribute userhelper_type;
 
+attribute_role consolehelper_roles;
+attribute_role userhelper_roles;
+
 type userhelper_conf_t;
-files_type(userhelper_conf_t)
+files_config_file(userhelper_conf_t)
 
 type userhelper_exec_t;
 application_executable_file(userhelper_exec_t)
+
+type consolehelper_exec_t;
+application_executable_file(consolehelper_exec_t)
+
+########################################
+#
+# Common consolehelper domain local policy
+#
+
+allow consolehelper_type self:capability { setgid setuid dac_override };
+allow consolehelper_type self:process signal;
+allow consolehelper_type self:fifo_file rw_fifo_file_perms;
+allow consolehelper_type self:unix_stream_socket create_stream_socket_perms;
+allow consolehelper_type self:shm create_shm_perms;
+
+allow consolehelper_type userhelper_conf_t:file audit_access;
+dontaudit consolehelper_type userhelper_conf_t:file write;
+read_files_pattern(consolehelper_type, userhelper_conf_t, userhelper_conf_t)
+
+domain_use_interactive_fds(consolehelper_type)
+
+kernel_read_system_state(consolehelper_type)
+kernel_read_kernel_sysctls(consolehelper_type)
+
+corecmd_exec_bin(consolehelper_type)
+
+dev_getattr_all_chr_files(consolehelper_type)
+dev_dontaudit_list_all_dev_nodes(consolehelper_type)
+
+files_read_config_files(consolehelper_type)
+files_read_usr_files(consolehelper_type)
+
+fs_getattr_all_dirs(consolehelper_type)
+fs_getattr_all_fs(consolehelper_type)
+fs_search_auto_mountpoints(consolehelper_type)
+files_search_mnt(consolehelper_type)
+
+term_list_ptys(consolehelper_type)
+
+auth_search_pam_console_data(consolehelper_type)
+auth_read_pam_pid(consolehelper_type)
+
+miscfiles_read_localization(consolehelper_type)
+miscfiles_read_fonts(consolehelper_type)
+
+userhelper_exec(consolehelper_type)
+
+userdom_use_user_terminals(consolehelper_type)
+
+# might want to make this consolehelper_tmp_t
+userdom_manage_user_tmp_dirs(consolehelper_type)
+userdom_manage_user_tmp_files(consolehelper_type)
+userdom_tmp_filetrans_user_tmp(consolehelper_type, { dir file })
+
+tunable_policy(`use_nfs_home_dirs',`
+	fs_search_nfs(consolehelper_type)
+')
+
+tunable_policy(`use_samba_home_dirs',`
+	fs_search_cifs(consolehelper_type)
+')
+
+optional_policy(`
+	shutdown_run(consolehelper_type, consolehelper_roles)
+	shutdown_signal(consolehelper_type)
+')
+
+optional_policy(`
+	xserver_domtrans_xauth(consolehelper_type)
+	xserver_read_xdm_pid(consolehelper_type)
+	xserver_stream_connect(consolehelper_type)
+')
+
+########################################
+#
+# Common userhelper domain local policy
+#
+
+allow userhelper_type self:capability { setuid setgid net_bind_service dac_override chown sys_tty_config };
+allow userhelper_type self:process ~{ ptrace setcurrent setfscreate setrlimit execmem execstack execheap };
+allow userhelper_type self:fd use;
+allow userhelper_type self:fifo_file rw_fifo_file_perms;
+allow userhelper_type self:shm create_shm_perms;
+allow userhelper_type self:sem create_sem_perms;
+allow userhelper_type self:msgq create_msgq_perms;
+allow userhelper_type self:msg { send receive };
+allow userhelper_type self:unix_dgram_socket sendto;
+allow userhelper_type self:unix_stream_socket { accept connectto listen };
+
+allow userhelper_type userhelper_conf_t:file audit_access;
+dontaudit userhelper_type userhelper_conf_t:file write;
+read_files_pattern(userhelper_type, userhelper_conf_t, userhelper_conf_t)
+
+can_exec(userhelper_type, userhelper_exec_t)
+
+kernel_read_all_sysctls(userhelper_type)
+kernel_getattr_debugfs(userhelper_type)
+kernel_read_system_state(userhelper_type)
+
+corecmd_exec_shell(userhelper_type)
+
+domain_use_interactive_fds(userhelper_type)
+domain_sigchld_interactive_fds(userhelper_type)
+
+dev_read_urand(userhelper_type)
+dev_list_all_dev_nodes(userhelper_type)
+
+files_list_var_lib(userhelper_type)
+files_read_var_files(userhelper_type)
+files_read_var_symlinks(userhelper_type)
+files_search_home(userhelper_type)
+
+fs_getattr_all_fs(userhelper_type)
+fs_search_auto_mountpoints(userhelper_type)
+
+selinux_get_fs_mount(userhelper_type)
+selinux_validate_context(userhelper_type)
+selinux_compute_access_vector(userhelper_type)
+selinux_compute_create_context(userhelper_type)
+selinux_compute_relabel_context(userhelper_type)
+selinux_compute_user_contexts(userhelper_type)
+
+term_list_ptys(userhelper_type)
+term_relabel_all_ttys(userhelper_type)
+term_relabel_all_ptys(userhelper_type)
+term_use_all_ttys(userhelper_type)
+term_use_all_ptys(userhelper_type)
+
+auth_manage_pam_pid(userhelper_type)
+auth_manage_var_auth(userhelper_type)
+auth_search_pam_console_data(userhelper_type)
+
+init_use_fds(userhelper_type)
+init_manage_utmp(userhelper_type)
+init_pid_filetrans_utmp(userhelper_type)
+
+logging_send_syslog_msg(userhelper_type)
+
+miscfiles_read_localization(userhelper_type)
+
+seutil_read_config(userhelper_type)
+seutil_read_default_contexts(userhelper_type)
+
+optional_policy(`
+	rpm_domtrans(userhelper_type)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/usernetctl.fc refpolicy/policy/modules/contrib/usernetctl.fc
--- refpolicy/policy/modules/contrib/usernetctl.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/usernetctl.fc	2012-10-31 19:04:01.995580333 +0100
@@ -1,2 +1 @@
-
 /usr/sbin/usernetctl	--	gen_context(system_u:object_r:usernetctl_exec_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/usernetctl.if refpolicy/policy/modules/contrib/usernetctl.if
--- refpolicy/policy/modules/contrib/usernetctl.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/usernetctl.if	2012-10-31 19:04:01.996580333 +0100
@@ -1,4 +1,4 @@
-## <summary>User network interface configuration helper</summary>
+## <summary>User network interface configuration helper.</summary>
 
 ########################################
 ## <summary>
@@ -15,13 +15,15 @@
 		type usernetctl_t, usernetctl_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, usernetctl_exec_t, usernetctl_t)
 ')
 
 ########################################
 ## <summary>
-##	Execute usernetctl in the usernetctl domain, and
-##	allow the specified role the usernetctl domain.
+##	Execute usernetctl in the usernetctl
+##	domain, and allow the specified role
+##	the usernetctl domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/usernetctl.te refpolicy/policy/modules/contrib/usernetctl.te
--- refpolicy/policy/modules/contrib/usernetctl.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/usernetctl.te	2012-10-31 19:04:01.997580333 +0100
@@ -1,4 +1,4 @@
-policy_module(usernetctl, 1.6.0)
+policy_module(usernetctl, 1.6.1)
 
 ########################################
 #
@@ -22,14 +22,8 @@
 allow usernetctl_t self:process ~{ ptrace setcurrent setexec setfscreate setrlimit execmem execstack execheap };
 allow usernetctl_t self:fd use;
 allow usernetctl_t self:fifo_file rw_fifo_file_perms;
-allow usernetctl_t self:shm create_shm_perms;
-allow usernetctl_t self:sem create_sem_perms;
-allow usernetctl_t self:msgq create_msgq_perms;
-allow usernetctl_t self:msg { send receive };
-allow usernetctl_t self:unix_dgram_socket create_socket_perms;
-allow usernetctl_t self:unix_stream_socket create_stream_socket_perms;
 allow usernetctl_t self:unix_dgram_socket sendto;
-allow usernetctl_t self:unix_stream_socket connectto;
+allow usernetctl_t self:unix_stream_socket { accept connectto listen };
 
 can_exec(usernetctl_t, usernetctl_exec_t)
 
@@ -42,7 +36,6 @@
 
 domain_dontaudit_read_all_domains_state(usernetctl_t)
 
-files_read_etc_files(usernetctl_t)
 files_exec_etc_files(usernetctl_t)
 files_read_etc_runtime_files(usernetctl_t)
 files_list_pids(usernetctl_t)
@@ -59,7 +52,6 @@
 
 seutil_read_config(usernetctl_t)
 
-sysnet_read_config(usernetctl_t)
 sysnet_run_ifconfig(usernetctl_t, usernetctl_roles)
 sysnet_run_dhcpc(usernetctl_t, usernetctl_roles)
 
@@ -82,9 +74,5 @@
 ')
 
 optional_policy(`
-	nis_use_ypbind(usernetctl_t)
-')
-
-optional_policy(`
 	ppp_run(usernetctl_t, usernetctl_roles)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/uucp.fc refpolicy/policy/modules/contrib/uucp.fc
--- refpolicy/policy/modules/contrib/uucp.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/uucp.fc	2012-10-31 19:04:04.535580340 +0100
@@ -1,11 +1,12 @@
+/etc/rc\.d/init\.d/uucp	--	gen_context(system_u:object_r:uucpd_initrc_exec_t,s0)
 
-/usr/bin/uux 		--	gen_context(system_u:object_r:uux_exec_t,s0)
+/usr/bin/uux	--	gen_context(system_u:object_r:uux_exec_t,s0)
 
 /usr/sbin/uucico	--	gen_context(system_u:object_r:uucpd_exec_t,s0)
 
-/var/spool/uucp(/.*)?		gen_context(system_u:object_r:uucpd_spool_t,s0)
+/var/spool/uucp(/.*)?	gen_context(system_u:object_r:uucpd_spool_t,s0)
 /var/spool/uucppublic(/.*)?	gen_context(system_u:object_r:uucpd_spool_t,s0)
 
-/var/lock/uucp(/.*)?		gen_context(system_u:object_r:uucpd_lock_t,s0)
+/var/lock/uucp(/.*)?	gen_context(system_u:object_r:uucpd_lock_t,s0)
 
-/var/log/uucp(/.*)?		gen_context(system_u:object_r:uucpd_log_t,s0)
+/var/log/uucp(/.*)?	gen_context(system_u:object_r:uucpd_log_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/uucp.if refpolicy/policy/modules/contrib/uucp.if
--- refpolicy/policy/modules/contrib/uucp.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/uucp.if	2012-10-31 19:04:04.535580340 +0100
@@ -1,9 +1,8 @@
-## <summary>Unix to Unix Copy</summary>
+## <summary>Unix to Unix Copy.</summary>
 
 ########################################
 ## <summary>
-##	Execute the uucico program in the
-##	uucpd_t domain.
+##	Execute uucico in the uucpd_t domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -16,13 +15,13 @@
 		type uucpd_t, uucpd_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, uucpd_exec_t, uucpd_t)
 ')
 
 ########################################
 ## <summary>
-##	Allow the specified domain to append
-##	to uucp log files.
+##	Append uucp log files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -42,7 +41,8 @@
 
 ########################################
 ## <summary>
-##	Create, read, write, and delete uucp spool files.
+##	Create, read, write, and delete
+##	uucp spool files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -63,8 +63,7 @@
 
 ########################################
 ## <summary>
-##	Execute the master uux program in the
-##	uux_t domain.
+##	Execute uux in the uux_t domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -77,28 +76,39 @@
 		type uux_t, uux_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, uux_exec_t, uux_t)
 ')
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate
-##	an uucp environment
+##	All of the rules required to
+##	administrate an uucp environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
 ##	Domain allowed access.
 ##	</summary>
 ## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
 ## <rolecap/>
 #
 interface(`uucp_admin',`
 	gen_require(`
 		type uucpd_t, uucpd_tmp_t, uucpd_log_t;
 		type uucpd_spool_t, uucpd_ro_t, uucpd_rw_t;
-		type uucpd_var_run_t;
+		type uucpd_var_run_t, uucpd_initrc_exec_t;
 	')
 
+	init_labeled_script_domtrans($1, uucpd_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 uucpd_initrc_exec_t system_r;
+	allow $2 system_r;
+
 	allow $1 uucpd_t:process { ptrace signal_perms };
 	ps_process_pattern($1, uucpd_t)
 
@@ -108,9 +118,7 @@
 	files_list_spool($1)
 	admin_pattern($1, uucpd_spool_t)
 
-	admin_pattern($1, uucpd_ro_t)
-
-	admin_pattern($1, uucpd_rw_t)
+	admin_pattern($1, { uucpd_rw_t uucpd_ro_t })
 
 	files_list_tmp($1)
 	admin_pattern($1, uucpd_tmp_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/uucp.te refpolicy/policy/modules/contrib/uucp.te
--- refpolicy/policy/modules/contrib/uucp.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/uucp.te	2012-10-31 19:04:04.573580342 +0100
@@ -1,12 +1,19 @@
-policy_module(uucp, 1.12.0)
+policy_module(uucp, 1.12.1)
 
 ########################################
 #
 # Declarations
 #
+
+attribute_role uux_roles;
+roleattribute system_r uux_roles;
+
 type uucpd_t;
 type uucpd_exec_t;
-inetd_tcp_service_domain(uucpd_t, uucpd_exec_t)
+init_daemon_domain(uucpd_t, uucpd_exec_t)
+
+type uucpd_initrc_exec_t;
+init_script_file(uucpd_initrc_exec_t)
 
 type uucpd_lock_t;
 files_lock_file(uucpd_lock_t)
@@ -32,36 +39,39 @@
 type uux_t;
 type uux_exec_t;
 application_domain(uux_t, uux_exec_t)
-role system_r types uux_t;
+role uux_roles types uux_t;
 
 ########################################
 #
-# UUCPd Local policy
+# Local policy
 #
+
 allow uucpd_t self:capability { setuid setgid };
 allow uucpd_t self:process signal_perms;
 allow uucpd_t self:fifo_file rw_fifo_file_perms;
-allow uucpd_t self:tcp_socket connected_stream_socket_perms;
-allow uucpd_t self:udp_socket create_socket_perms;
+allow uucpd_t self:tcp_socket { accept listen };
 allow uucpd_t self:netlink_tcpdiag_socket r_netlink_socket_perms;
 
-allow uucpd_t uucpd_log_t:dir setattr;
-manage_files_pattern(uucpd_t, uucpd_log_t, uucpd_log_t)
+allow uucpd_t uucpd_log_t:dir setattr_dir_perms;
+append_files_pattern(uucpd_t, uucpd_log_t, uucpd_log_t)
+create_files_pattern(uucpd_t, uucpd_log_t, uucpd_log_t)
+setattr_files_pattern(uucpd_t, uucpd_log_t, uucpd_log_t)
 logging_log_filetrans(uucpd_t, uucpd_log_t, { file dir })
 
 allow uucpd_t uucpd_ro_t:dir list_dir_perms;
-read_files_pattern(uucpd_t, uucpd_ro_t, uucpd_ro_t)
-read_lnk_files_pattern(uucpd_t, uucpd_ro_t, uucpd_ro_t)
+allow uucpd_t uucpd_ro_t:file read_file_perms;
+allow uucpd_t uucpd_ro_t:lnk_file read_lnk_file_perms;
 
 manage_dirs_pattern(uucpd_t, uucpd_rw_t, uucpd_rw_t)
 manage_files_pattern(uucpd_t, uucpd_rw_t, uucpd_rw_t)
 manage_lnk_files_pattern(uucpd_t, uucpd_rw_t, uucpd_rw_t)
 
-uucp_manage_spool(uucpd_t)
+manage_dirs_pattern(uucpd_t, uucpd_spool_t, uucpd_spool_t)
+manage_files_pattern(uucpd_t, uucpd_spool_t, uucpd_spool_t)
+manage_lnk_files_pattern(uucpd_t, uucpd_spool_t, uucpd_spool_t)
 
 manage_dirs_pattern(uucpd_t, uucpd_lock_t, uucpd_lock_t)
 manage_files_pattern(uucpd_t, uucpd_lock_t, uucpd_lock_t)
-files_search_locks(uucpd_t)
 
 manage_dirs_pattern(uucpd_t, uucpd_tmp_t, uucpd_tmp_t)
 manage_files_pattern(uucpd_t, uucpd_tmp_t, uucpd_tmp_t)
@@ -77,24 +87,23 @@
 corenet_all_recvfrom_unlabeled(uucpd_t)
 corenet_all_recvfrom_netlabel(uucpd_t)
 corenet_tcp_sendrecv_generic_if(uucpd_t)
-corenet_udp_sendrecv_generic_if(uucpd_t)
 corenet_tcp_sendrecv_generic_node(uucpd_t)
-corenet_udp_sendrecv_generic_node(uucpd_t)
-corenet_tcp_sendrecv_all_ports(uucpd_t)
-corenet_udp_sendrecv_all_ports(uucpd_t)
-corenet_tcp_connect_ssh_port(uucpd_t)
-
-dev_read_urand(uucpd_t)
 
-fs_getattr_xattr_fs(uucpd_t)
+corenet_sendrecv_ssh_client_packets(uucpd_t)
+corenet_tcp_connect_ssh_port(uucpd_t)
+corenet_tcp_sendrecv_ssh_port(uucpd_t)
 
 corecmd_exec_bin(uucpd_t)
 corecmd_exec_shell(uucpd_t)
 
-files_read_etc_files(uucpd_t)
+dev_read_urand(uucpd_t)
+
 files_search_home(uucpd_t)
+files_search_locks(uucpd_t)
 files_search_spool(uucpd_t)
 
+fs_getattr_xattr_fs(uucpd_t)
+
 term_setattr_controlling_term(uucpd_t)
 
 auth_use_nsswitch(uucpd_t)
@@ -103,17 +112,23 @@
 
 miscfiles_read_localization(uucpd_t)
 
-mta_send_mail(uucpd_t)
-
 optional_policy(`
 	cron_system_entry(uucpd_t, uucpd_exec_t)
 ')
 
 optional_policy(`
+	inetd_tcp_service_domain(uucpd_t, uucpd_exec_t)
+')
+
+optional_policy(`
 	kerberos_use(uucpd_t)
 ')
 
 optional_policy(`
+	mta_send_mail(uucpd_t)
+')
+
+optional_policy(`
 	ssh_exec(uucpd_t)
 ')
 
@@ -125,15 +140,24 @@
 allow uux_t self:capability { setuid setgid };
 allow uux_t self:fifo_file write_fifo_file_perms;
 
-uucp_append_log(uux_t)
-uucp_manage_spool(uux_t)
+domtrans_pattern(uux_t, uucpd_exec_t, uucpd_t)
+
+allow uux_t uucpd_log_t:dir list_dir_perms;
+append_files_pattern(uux_t, uucpd_log_t, uucpd_log_t)
+
+manage_dirs_pattern(uux_t, uucpd_spool_t, uucpd_spool_t)
+manage_files_pattern(uux_t, uucpd_spool_t, uucpd_spool_t)
+manage_lnk_files_pattern(uux_t, uucpd_spool_t, uucpd_spool_t)
 
 corecmd_exec_bin(uux_t)
 
-files_read_etc_files(uux_t)
+files_search_spool(uux_t)
 
 fs_rw_anon_inodefs_files(uux_t)
 
+auth_use_nsswitch(uux_t)
+
+logging_search_logs(uux_t)
 logging_send_syslog_msg(uux_t)
 
 miscfiles_read_localization(uux_t)
@@ -143,7 +167,3 @@
 	mta_read_queue(uux_t)
 	sendmail_dontaudit_rw_unix_stream_sockets(uux_t)
 ')
-
-optional_policy(`
-	nscd_socket_use(uux_t)
-')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/uuidd.fc refpolicy/policy/modules/contrib/uuidd.fc
--- refpolicy/policy/modules/contrib/uuidd.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/uuidd.fc	2012-10-31 19:04:07.052580345 +0100
@@ -1,7 +1,7 @@
-/etc/rc\.d/init\.d/uuidd --	gen_context(system_u:object_r:uuidd_initrc_exec_t,s0)
+/etc/rc\.d/init\.d/uuidd	--	gen_context(system_u:object_r:uuidd_initrc_exec_t,s0)
 
-/usr/sbin/uuidd		--	gen_context(system_u:object_r:uuidd_exec_t,s0)
+/usr/sbin/uuidd	--	gen_context(system_u:object_r:uuidd_exec_t,s0)
 
-/var/lib/libuuid(/.*)?		gen_context(system_u:object_r:uuidd_var_lib_t,s0)
+/var/lib/libuuid(/.*)?	gen_context(system_u:object_r:uuidd_var_lib_t,s0)
 
-/var/run/uuidd(/.*)?		gen_context(system_u:object_r:uuidd_var_run_t,s0)
+/var/run/uuidd(/.*)?	gen_context(system_u:object_r:uuidd_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/uuidd.if refpolicy/policy/modules/contrib/uuidd.if
--- refpolicy/policy/modules/contrib/uuidd.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/uuidd.if	2012-10-31 19:04:08.529580348 +0100
@@ -1,13 +1,13 @@
-## <summary>policy for uuidd</summary>
+## <summary>UUID generation daemon.</summary>
 
 ########################################
 ## <summary>
-##	Transition to uuidd.
+##	Execute uuidd in the uuidd domain.
 ## </summary>
 ## <param name="domain">
-## <summary>
+##	<summary>
 ##	Domain allowed to transition.
-## </summary>
+##	</summary>
 ## </param>
 #
 interface(`uuidd_domtrans',`
@@ -21,7 +21,8 @@
 
 ########################################
 ## <summary>
-##	Execute uuidd server in the uuidd domain.
+##	Execute uuidd init scripts in
+##	the initrc domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -52,8 +53,8 @@
 		type uuidd_var_lib_t;
 	')
 
-	allow $1 uuidd_var_lib_t:dir search_dir_perms;
 	files_search_var_lib($1)
+	allow $1 uuidd_var_lib_t:dir search_dir_perms;
 ')
 
 ########################################
@@ -77,7 +78,8 @@
 
 ########################################
 ## <summary>
-##	Manage uuidd lib files.
+##	Create, read, write, and delete
+##	uuidd lib files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -96,7 +98,8 @@
 
 ########################################
 ## <summary>
-##	Manage uuidd lib directories.
+##	Create, read, write, and delete
+##	uuidd lib directories.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -115,7 +118,7 @@
 
 ########################################
 ## <summary>
-##	Read uuidd PID files.
+##	Read uuidd pid files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -134,7 +137,8 @@
 
 ########################################
 ## <summary>
-##	Connect to uuidd over an unix stream socket.
+##	Connect to uuidd with an unix
+##	domain stream socket.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -153,8 +157,8 @@
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate
-##	an uuidd environment
+##	All of the rules required to
+##	administrate an uuidd environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/uuidd.te refpolicy/policy/modules/contrib/uuidd.te
--- refpolicy/policy/modules/contrib/uuidd.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/uuidd.te	2012-10-31 19:04:08.530580348 +0100
@@ -1,4 +1,4 @@
-policy_module(uuidd, 1.0.0)
+policy_module(uuidd, 1.0.1)
 
 ########################################
 #
@@ -20,8 +20,9 @@
 
 ########################################
 #
-# uuidd local policy
+# Local policy
 #
+
 allow uuidd_t self:capability setuid;
 allow uuidd_t self:process signal;
 allow uuidd_t self:fifo_file rw_fifo_file_perms;
@@ -30,10 +31,12 @@
 
 manage_dirs_pattern(uuidd_t, uuidd_var_lib_t, uuidd_var_lib_t)
 manage_files_pattern(uuidd_t, uuidd_var_lib_t, uuidd_var_lib_t)
+files_var_lib_filetrans(uuidd_t, uuidd_var_lib_t, { dir file })
 
 manage_dirs_pattern(uuidd_t, uuidd_var_run_t, uuidd_var_run_t)
 manage_files_pattern(uuidd_t, uuidd_var_run_t, uuidd_var_run_t)
 manage_sock_files_pattern(uuidd_t, uuidd_var_run_t, uuidd_var_run_t)
+files_pid_filetrans(uuidd_t, uuidd_var_run_t, { dir file sock_file })
 
 dev_read_urand(uuidd_t)
 
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/uwimap.fc refpolicy/policy/modules/contrib/uwimap.fc
--- refpolicy/policy/modules/contrib/uwimap.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/uwimap.fc	2012-10-31 19:04:11.639580355 +0100
@@ -1,2 +1,3 @@
+/usr/sbin/imapd	-- 	gen_context(system_u:object_r:imapd_exec_t,s0)
 
-/usr/sbin/imapd		-- 	gen_context(system_u:object_r:imapd_exec_t,s0)
+/var/run/imapd\.pid	--	gen_context(system_u:object_r:imapd_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/uwimap.if refpolicy/policy/modules/contrib/uwimap.if
--- refpolicy/policy/modules/contrib/uwimap.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/uwimap.if	2012-10-31 19:04:11.639580355 +0100
@@ -1,8 +1,8 @@
-## <summary>University of Washington IMAP toolkit POP3 and IMAP mail server</summary>
+## <summary>University of Washington IMAP toolkit POP3 and IMAP mail server.</summary>
 
 ########################################
 ## <summary>
-##	Execute the UW IMAP/POP3 servers with a domain transition.
+##	Execute imapd in the imapd domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/uwimap.te refpolicy/policy/modules/contrib/uwimap.te
--- refpolicy/policy/modules/contrib/uwimap.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/uwimap.te	2012-10-31 19:04:11.640580355 +0100
@@ -1,4 +1,4 @@
-policy_module(uwimap, 1.9.0)
+policy_module(uwimap, 1.9.1)
 
 ########################################
 #
@@ -24,7 +24,7 @@
 dontaudit imapd_t self:capability sys_tty_config;
 allow imapd_t self:process signal_perms;
 allow imapd_t self:fifo_file rw_fifo_file_perms;
-allow imapd_t self:tcp_socket create_stream_socket_perms;
+allow imapd_t self:tcp_socket { accept listen };
 
 manage_dirs_pattern(imapd_t, imapd_tmp_t, imapd_tmp_t)
 manage_files_pattern(imapd_t, imapd_tmp_t, imapd_tmp_t)
@@ -43,19 +43,19 @@
 corenet_tcp_sendrecv_generic_node(imapd_t)
 corenet_tcp_sendrecv_all_ports(imapd_t)
 corenet_tcp_bind_generic_node(imapd_t)
-corenet_tcp_bind_pop_port(imapd_t)
-corenet_tcp_connect_all_ports(imapd_t)
+
 corenet_sendrecv_pop_server_packets(imapd_t)
+corenet_tcp_bind_pop_port(imapd_t)
+
 corenet_sendrecv_all_client_packets(imapd_t)
+corenet_tcp_connect_all_ports(imapd_t)
 
-dev_read_sysfs(imapd_t)
-#urandom, for ssl
 dev_read_rand(imapd_t)
+dev_read_sysfs(imapd_t)
 dev_read_urand(imapd_t)
 
 domain_use_interactive_fds(imapd_t)
 
-#read /etc/ for hostname nsswitch.conf
 files_read_etc_files(imapd_t)
 
 fs_getattr_all_fs(imapd_t)
@@ -67,25 +67,33 @@
 
 miscfiles_read_localization(imapd_t)
 
-sysnet_read_config(imapd_t)
+sysnet_dns_name_resolve(imapd_t)
 
 userdom_dontaudit_use_unpriv_user_fds(imapd_t)
-# cjp: this is excessive, should be limited to the
-# mail directories
-userdom_manage_user_home_content_dirs(imapd_t)
-userdom_manage_user_home_content_files(imapd_t)
-userdom_manage_user_home_content_symlinks(imapd_t)
-userdom_manage_user_home_content_pipes(imapd_t)
-userdom_manage_user_home_content_sockets(imapd_t)
-userdom_user_home_dir_filetrans_user_home_content(imapd_t, { dir file lnk_file fifo_file sock_file })
 
-mta_rw_spool(imapd_t)
+tunable_policy(`use_nfs_home_dirs',`
+	fs_manage_nfs_dirs(imapd_t)
+	fs_manage_nfs_files(imapd_t)
+	fs_manage_nfs_symlinks(imapd_t)
+')
+
+tunable_policy(`use_samba_home_dirs',`
+	fs_manage_cifs_dirs(imapd_t)
+	fs_manage_cifs_files(imapd_t)
+	fs_manage_cifs_symlinks(imapd_t)
+')
 
 optional_policy(`
 	inetd_tcp_service_domain(imapd_t, imapd_exec_t)
 ')
 
 optional_policy(`
+	mta_manage_spool(imapd_t)
+	mta_manage_mail_home_rw_content(imapd_t)
+	mta_home_filetrans_mail_home_rw(imapd_t, dir, "Maildir")
+')
+
+optional_policy(`
 	seutil_sigchld_newrole(imapd_t)
 ')
 
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/varnishd.fc refpolicy/policy/modules/contrib/varnishd.fc
--- refpolicy/policy/modules/contrib/varnishd.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/varnishd.fc	2012-10-31 19:04:13.150580357 +0100
@@ -2,17 +2,17 @@
 /etc/rc\.d/init\.d/varnishlog	--	gen_context(system_u:object_r:varnishlog_initrc_exec_t,s0)
 /etc/rc\.d/init\.d/varnishncsa	--	gen_context(system_u:object_r:varnishlog_initrc_exec_t,s0)
 
-/etc/varnish(/.*)?			gen_context(system_u:object_r:varnishd_etc_t,s0)
+/etc/varnish(/.*)?	gen_context(system_u:object_r:varnishd_etc_t,s0)
 
-/usr/bin/varnishlog		--	gen_context(system_u:object_r:varnishlog_exec_t,s0)
-/usr/bin/varnisncsa		--	gen_context(system_u:object_r:varnishlog_exec_t,s0)
+/usr/bin/varnishlog	--	gen_context(system_u:object_r:varnishlog_exec_t,s0)
+/usr/bin/varnisncsa	--	gen_context(system_u:object_r:varnishlog_exec_t,s0)
 
-/usr/sbin/varnishd		--	gen_context(system_u:object_r:varnishd_exec_t,s0)
+/usr/sbin/varnishd	--	gen_context(system_u:object_r:varnishd_exec_t,s0)
 
-/var/lib/varnish(/.*)?			gen_context(system_u:object_r:varnishd_var_lib_t,s0)
+/var/lib/varnish(/.*)?	gen_context(system_u:object_r:varnishd_var_lib_t,s0)
 
-/var/log/varnish(/.*)?			gen_context(system_u:object_r:varnishlog_log_t,s0)
+/var/log/varnish(/.*)?	gen_context(system_u:object_r:varnishlog_log_t,s0)
 
-/var/run/varnish\.pid		--	gen_context(system_u:object_r:varnishd_var_run_t,s0)
+/var/run/varnish\.pid	--	gen_context(system_u:object_r:varnishd_var_run_t,s0)
 /var/run/varnishlog\.pid	--	gen_context(system_u:object_r:varnishlog_var_run_t,s0)
 /var/run/varnishncsa\.pid	--	gen_context(system_u:object_r:varnishlog_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/varnishd.if refpolicy/policy/modules/contrib/varnishd.if
--- refpolicy/policy/modules/contrib/varnishd.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/varnishd.if	2012-10-31 19:04:14.272580360 +0100
@@ -1,4 +1,4 @@
-## <summary>Varnishd http accelerator daemon</summary>
+## <summary>Varnishd http accelerator daemon.</summary>
 
 #######################################
 ## <summary>
@@ -21,7 +21,7 @@
 
 #######################################
 ## <summary>
-##	Execute varnishd
+##	Execute varnishd in the caller domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -34,12 +34,13 @@
 		type varnishd_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	can_exec($1, varnishd_exec_t)
 ')
 
 ######################################
 ## <summary>
-##	Read varnishd configuration file.
+##	Read varnishd configuration files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -77,7 +78,7 @@
 
 #######################################
 ## <summary>
-##	Read varnish logs.
+##	Read varnish log files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -96,7 +97,7 @@
 
 ######################################
 ## <summary>
-##	Append varnish logs.
+##	Append varnish log files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -115,7 +116,8 @@
 
 #####################################
 ## <summary>
-##	Manage varnish logs.
+##	Create, read, write, and delete
+##	varnish log files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -134,8 +136,8 @@
 
 ######################################
 ## <summary>
-##	All of the rules required to administrate
-##	an varnishlog environment
+##	All of the rules required to
+##	administrate an varnishlog environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -144,7 +146,7 @@
 ## </param>
 ## <param name="role">
 ##	<summary>
-##	The role to be allowed to manage the varnishlog domain.
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <rolecap/>
@@ -172,8 +174,8 @@
 
 #######################################
 ## <summary>
-##	All of the rules required to administrate
-##	an varnishd environment
+##	All of the rules required to
+##	administrate an varnishd environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -182,7 +184,7 @@
 ## </param>
 ## <param name="role">
 ##	<summary>
-##	The role to be allowed to manage the varnishd domain.
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <rolecap/>
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/varnishd.te refpolicy/policy/modules/contrib/varnishd.te
--- refpolicy/policy/modules/contrib/varnishd.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/varnishd.te	2012-10-31 19:04:14.272580360 +0100
@@ -6,9 +6,9 @@
 #
 
 ## <desc>
-## <p>
-## Allow varnishd to connect to all ports,
-## not just HTTP.
+##	<p>
+##	Determine whether varnishd can
+##	use the full TCP network.
 ## </p>
 ## </desc>
 gen_tunable(varnishd_connect_any, false)
@@ -47,24 +47,23 @@
 
 ########################################
 #
-# varnishd local policy
+# Local policy
 #
 
 allow varnishd_t self:capability { kill dac_override ipc_lock setuid setgid };
 dontaudit varnishd_t self:capability sys_tty_config;
 allow varnishd_t self:process signal;
 allow varnishd_t self:fifo_file rw_fifo_file_perms;
-allow varnishd_t self:tcp_socket create_stream_socket_perms;
-allow varnishd_t self:udp_socket create_socket_perms;
+allow varnishd_t self:tcp_socket { accept listen };
 
-read_files_pattern(varnishd_t, varnishd_etc_t, varnishd_etc_t)
-list_dirs_pattern(varnishd_t, varnishd_etc_t, varnishd_etc_t)
+allow varnishd_t varnishd_etc_t:dir list_dir_perms;
+allow varnishd_t varnishd_etc_t:file read_file_perms;
+allow varnishd_t varnishd_etc_t:lnk_file read_lnk_file_perms;
 
 manage_dirs_pattern(varnishd_t, varnishd_tmp_t, varnishd_tmp_t)
 manage_files_pattern(varnishd_t, varnishd_tmp_t, varnishd_tmp_t)
 files_tmp_filetrans(varnishd_t, varnishd_tmp_t, { file dir })
 
-exec_files_pattern(varnishd_t, varnishd_var_lib_t, varnishd_var_lib_t)
 manage_dirs_pattern(varnishd_t, varnishd_var_lib_t, varnishd_var_lib_t)
 manage_files_pattern(varnishd_t, varnishd_var_lib_t, varnishd_var_lib_t)
 files_var_lib_filetrans(varnishd_t, varnishd_var_lib_t, { dir file })
@@ -72,21 +71,40 @@
 manage_files_pattern(varnishd_t, varnishd_var_run_t, varnishd_var_run_t)
 files_pid_filetrans(varnishd_t, varnishd_var_run_t, file)
 
+can_exec(varnishd_t, varnishd_var_lib_t)
+
 kernel_read_system_state(varnishd_t)
 
 corecmd_exec_bin(varnishd_t)
 corecmd_exec_shell(varnishd_t)
 
+corenet_all_recvfrom_unlabeled(varnishd_t)
+corenet_all_recvfrom_netlabel(varnishd_t)
 corenet_tcp_sendrecv_generic_if(varnishd_t)
+corenet_tcp_sendrecv_generic_node(varnishd_t)
+corenet_tcp_sendrecv_all_ports(varnishd_t)
 corenet_tcp_bind_generic_node(varnishd_t)
+
+corenet_sendrecv_http_server_packets(varnishd_t)
 corenet_tcp_bind_http_port(varnishd_t)
+corenet_sendrecv_http_client_packets(varnishd_t)
+corenet_tcp_connect_http_port(varnishd_t)
+corenet_tcp_sendrecv_http_port(varnishd_t)
+
+corenet_sendrecv_http_cache_server_packets(varnishd_t)
 corenet_tcp_bind_http_cache_port(varnishd_t)
-corenet_tcp_bind_varnishd_port(varnishd_t)
+corenet_sendrecv_http_cache_client_packets(varnishd_t)
 corenet_tcp_connect_http_cache_port(varnishd_t)
-corenet_tcp_connect_http_port(varnishd_t)
+corenet_tcp_sendrecv_http_cache_port(varnishd_t)
+
+corenet_sendrecv_varnishd_server_packets(varnishd_t)
+corenet_tcp_bind_varnishd_port(varnishd_t)
+corenet_tcp_sendrecv_varnishd_port(varnishd_t)
 
 dev_read_urand(varnishd_t)
 
+files_read_usr_files(varnishd_t)
+
 fs_getattr_all_fs(varnishd_t)
 
 auth_use_nsswitch(varnishd_t)
@@ -95,24 +113,28 @@
 
 miscfiles_read_localization(varnishd_t)
 
-sysnet_read_config(varnishd_t)
-
 tunable_policy(`varnishd_connect_any',`
+	corenet_sendrecv_all_client_packets(varnishd_t)
 	corenet_tcp_connect_all_ports(varnishd_t)
+	corenet_sendrecv_all_server_packets(varnishd_t)
 	corenet_tcp_bind_all_ports(varnishd_t)
+	corenet_tcp_sendrecv_all_ports(varnishd_t)
 ')
 
 #######################################
 #
-# varnishlog local policy
+# Log local policy
 #
 
 manage_files_pattern(varnishlog_t, varnishlog_var_run_t, varnishlog_var_run_t)
 files_pid_filetrans(varnishlog_t, varnishlog_var_run_t, file)
 
 manage_dirs_pattern(varnishlog_t, varnishlog_log_t, varnishlog_log_t)
-manage_files_pattern(varnishlog_t, varnishlog_log_t, varnishlog_log_t)
+append_files_pattern(varnishlog_t, varnishlog_log_t, varnishlog_log_t)
+create_files_pattern(varnishlog_t, varnishlog_log_t, varnishlog_log_t)
+setattr_files_pattern(varnishlog_t, varnishlog_log_t, varnishlog_log_t)
 logging_log_filetrans(varnishlog_t, varnishlog_log_t, { file dir })
 
-files_search_var_lib(varnishlog_t)
 read_files_pattern(varnishlog_t, varnishd_var_lib_t, varnishd_var_lib_t)
+
+files_search_var_lib(varnishlog_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/vbetool.if refpolicy/policy/modules/contrib/vbetool.if
--- refpolicy/policy/modules/contrib/vbetool.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/vbetool.if	2012-10-31 19:04:15.325580362 +0100
@@ -1,8 +1,8 @@
-## <summary>run real-mode video BIOS code to alter hardware state</summary>
+## <summary>run real-mode video BIOS code to alter hardware state.</summary>
 
 ########################################
 ## <summary>
-##	Execute vbetool application in the vbetool domain.
+##	Execute vbetool in the vbetool domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -21,8 +21,9 @@
 
 ########################################
 ## <summary>
-##	Execute vbetool in the vbetool domain, and
-##	allow the specified role the vbetool domain.
+##	Execute vbetool in the vbetool
+##	domain, and allow the specified
+##	role the vbetool domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -37,9 +38,9 @@
 #
 interface(`vbetool_run',`
 	gen_require(`
-		type vbetool_t;
+		attribute_role vbetool_roles;
 	')
 
 	vbetool_domtrans($1)
-	role $2 types vbetool_t;
+	roleattribute $2 vbetool_roles;
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/vbetool.te refpolicy/policy/modules/contrib/vbetool.te
--- refpolicy/policy/modules/contrib/vbetool.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/vbetool.te	2012-10-31 19:04:15.325580362 +0100
@@ -1,4 +1,4 @@
-policy_module(vbetool, 1.6.0)
+policy_module(vbetool, 1.6.1)
 
 ########################################
 #
@@ -6,15 +6,20 @@
 #
 
 ## <desc>
-## <p>
-##	Ignore vbetool mmap_zero errors.
-## </p>
+##	<p>
+##	Determine whether attempts by
+##	vbetool to mmap low regions should
+##	be silently blocked.
+##	</p>
 ## </desc>
 gen_tunable(vbetool_mmap_zero_ignore, false)
 
+attribute_role vbetool_roles;
+
 type vbetool_t;
 type vbetool_exec_t;
 init_system_domain(vbetool_t, vbetool_exec_t)
+role vbetool_roles types vbetool_t;
 
 ########################################
 #
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/vdagent.fc refpolicy/policy/modules/contrib/vdagent.fc
--- refpolicy/policy/modules/contrib/vdagent.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/vdagent.fc	2012-10-31 19:04:17.328580367 +0100
@@ -1,7 +1,9 @@
+/etc/rc\.d/init\.d/spice-vdagentd	--	gen_context(system_u:object_r:vdagentd_initrc_exec_t,s0)
+
 /usr/sbin/spice-vdagentd	--	gen_context(system_u:object_r:vdagent_exec_t,s0)
 
-/var/log/spice-vdagentd(/.*)?		gen_context(system_u:object_r:vdagent_log_t,s0)
-/var/log/spice-vdagentd\.log	--	gen_context(system_u:object_r:vdagent_log_t,s0)
+/var/log/spice-vdagentd(/.*)?	gen_context(system_u:object_r:vdagent_log_t,s0)
+/var/log/spice-vdagentd\.log.*	--	gen_context(system_u:object_r:vdagent_log_t,s0)
 
-/var/run/spice-vdagentd(/.*)?		gen_context(system_u:object_r:vdagent_var_run_t,s0)
-/var/run/spice-vdagentd.\pid	--	gen_context(system_u:object_r:vdagent_var_run_t,s0)
+/var/run/spice-vdagentd(/.*)?	gen_context(system_u:object_r:vdagent_var_run_t,s0)
+/var/run/spice-vdagentd\.pid	--	gen_context(system_u:object_r:vdagent_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/vdagent.if refpolicy/policy/modules/contrib/vdagent.if
--- refpolicy/policy/modules/contrib/vdagent.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/vdagent.if	2012-10-31 19:04:17.328580367 +0100
@@ -1,4 +1,4 @@
-## <summary>policy for vdagent</summary>
+## <summary>Spice agent for Linux.</summary>
 
 ########################################
 ## <summary>
@@ -15,12 +15,13 @@
 		type vdagent_t, vdagent_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, vdagent_exec_t, vdagent_t)
 ')
 
 #####################################
 ## <summary>
-##	Getattr on vdagent executable.
+##	Get attributes of vdagent executable files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -33,12 +34,12 @@
 		type vdagent_exec_t;
 	')
 
-	allow $1 vdagent_exec_t:file getattr;
+	allow $1 vdagent_exec_t:file getattr_file_perms;
 ')
 
 #######################################
 ## <summary>
-##	Get the attributes of vdagent logs.
+##	Get attributes of vdagent log files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -57,7 +58,7 @@
 
 ########################################
 ## <summary>
-##	Read vdagent PID files.
+##	Read vdagent pid files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -76,8 +77,8 @@
 
 #####################################
 ## <summary>
-##	Connect to vdagent over a unix domain
-##	stream socket.
+##	Connect to vdagent with a unix
+##	domain stream socket.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -96,8 +97,8 @@
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate
-##	an vdagent environment
+##	All of the rules required to
+##	administrate an vdagent environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -113,12 +114,21 @@
 #
 interface(`vdagent_admin',`
 	gen_require(`
-		type vdagent_t, vdagent_var_run_t;
+		type vdagent_t, vdagent_var_run_t, vdagentd_initrc_exec_t;
+		type vdagent_log_t;
 	')
 
 	allow $1 vdagent_t:process signal_perms;
 	ps_process_pattern($1, vdagent_t)
 
+	init_labeled_script_domtrans($1, vdagentd_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 vdagentd_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	logging_search_logs($1)
+	admin_pattern($1, vdagent_log_t)
+
 	files_search_pids($1)
 	admin_pattern($1, vdagent_var_run_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/vdagent.te refpolicy/policy/modules/contrib/vdagent.te
--- refpolicy/policy/modules/contrib/vdagent.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/vdagent.te	2012-10-31 19:04:17.329580367 +0100
@@ -1,4 +1,4 @@
-policy_module(vdagent, 1.0.0)
+policy_module(vdagent, 1.0.2)
 
 ########################################
 #
@@ -9,6 +9,9 @@
 type vdagent_exec_t;
 init_daemon_domain(vdagent_t, vdagent_exec_t)
 
+type vdagentd_initrc_exec_t;
+init_script_file(vdagentd_initrc_exec_t)
+
 type vdagent_var_run_t;
 files_pid_file(vdagent_var_run_t)
 
@@ -17,13 +20,13 @@
 
 ########################################
 #
-# vdagent local policy
+# Local policy
 #
 
 dontaudit vdagent_t self:capability sys_admin;
-
+allow vdagent_t self:process signal;
 allow vdagent_t self:fifo_file rw_fifo_file_perms;
-allow vdagent_t self:unix_stream_socket create_stream_socket_perms;
+allow vdagent_t self:unix_stream_socket { accept listen };
 
 manage_dirs_pattern(vdagent_t, vdagent_var_run_t, vdagent_var_run_t)
 manage_files_pattern(vdagent_t, vdagent_var_run_t, vdagent_var_run_t)
@@ -31,7 +34,9 @@
 files_pid_filetrans(vdagent_t, vdagent_var_run_t, { dir file sock_file })
 
 manage_dirs_pattern(vdagent_t, vdagent_log_t, vdagent_log_t)
-manage_files_pattern(vdagent_t, vdagent_log_t, vdagent_log_t)
+append_files_pattern(vdagent_t, vdagent_log_t, vdagent_log_t)
+create_files_pattern(vdagent_t, vdagent_log_t, vdagent_log_t)
+setattr_files_pattern(vdagent_t, vdagent_log_t, vdagent_log_t)
 logging_log_filetrans(vdagent_t, vdagent_log_t, file)
 
 dev_rw_input_dev(vdagent_t)
@@ -40,12 +45,18 @@
 
 files_read_etc_files(vdagent_t)
 
+init_read_state(vdagent_t)
+
+logging_send_syslog_msg(vdagent_t)
+
 miscfiles_read_localization(vdagent_t)
 
-optional_policy(`
-	consolekit_dbus_chat(vdagent_t)
-')
+userdom_read_all_users_state(vdagent_t)
 
 optional_policy(`
 	dbus_system_bus_client(vdagent_t)
+
+	optional_policy(`
+		consolekit_dbus_chat(vdagent_t)
+	')
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/vde.fc refpolicy/policy/modules/contrib/vde.fc
--- refpolicy/policy/modules/contrib/vde.fc	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/vde.fc	2012-08-09 17:44:46.118883860 +0200
@@ -0,0 +1,5 @@
+/etc/rc\.d/init\.d/vde	--	gen_context(system_u:object_r:vde_initrc_exec_t,s0)
+/usr/bin/vde_switch	--	gen_context(system_u:object_r:vde_exec_t,s0)
+/usr/sbin/vde_tunctl	--	gen_context(system_u:object_r:vde_exec_t,s0)
+/var/run/vde\.ctl(/.*)?		gen_context(system_u:object_r:vde_var_run_t,s0)
+/tmp/vde.[0-9-]*	-s	gen_context(system_u:object_r:vde_tmp_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/vde.if refpolicy/policy/modules/contrib/vde.if
--- refpolicy/policy/modules/contrib/vde.if	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/vde.if	2012-10-06 22:28:26.430767800 +0200
@@ -0,0 +1,61 @@
+## <summary>Virtual Distributed Ethernet switch service</summary>
+
+########################################
+## <summary>
+#    The rules needed to manage the VDE switches
+## </summary>
+## <param name="role">
+##	<summary>
+##	The role to be allowed to manage the vde domain.
+##	</summary>
+## </param>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`vde_role',`
+	gen_require(`
+		type vde_t, vde_tmp_t;
+		type vde_var_run_t;
+		type vde_initrc_exec_t, vde_exec_t;
+	')
+
+	role $1 types vde_t;
+
+	allow $2 vde_t:process { ptrace signal_perms };
+	allow vde_t $2:process { sigchld signull };
+	allow vde_t $2:fd use;
+	allow vde_t $2:tun_socket { relabelfrom };
+	allow vde_t self:tun_socket { relabelfrom relabelto };
+	ps_process_pattern($2, vde_t)
+
+	domain_auto_trans($2, vde_exec_t, vde_t)
+')
+
+########################################
+## <summary>
+#    Allow communication with the VDE service 
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`vde_connect',`
+	gen_require(`
+		type vde_t, vde_var_run_t, vde_tmp_t;
+	')
+	
+	allow $1 vde_var_run_t:sock_file write_sock_file_perms;
+	allow $1 vde_t:unix_stream_socket { connectto };
+	allow $1 vde_t:unix_dgram_socket { sendto };
+	allow vde_t $1:unix_dgram_socket { sendto };
+
+	allow $1 vde_tmp_t:sock_file manage_sock_file_perms;
+	files_tmp_filetrans($1, vde_tmp_t, sock_file)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/vde.te refpolicy/policy/modules/contrib/vde.te
--- refpolicy/policy/modules/contrib/vde.te	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/vde.te	2012-05-05 16:11:35.248762630 +0200
@@ -0,0 +1,49 @@
+policy_module(vde, 0.0.1)
+
+########################################
+#
+# Declarations
+#
+
+type vde_t;
+type vde_exec_t;
+init_daemon_domain(vde_t, vde_exec_t)
+
+type vde_initrc_exec_t;
+init_script_file(vde_initrc_exec_t)
+
+type vde_var_lib_t;
+files_type(vde_var_lib_t)
+
+type vde_var_run_t;
+files_pid_file(vde_var_run_t)
+
+type vde_tmp_t;
+files_tmp_file(vde_tmp_t)
+
+########################################
+#
+# Local policy
+#
+
+allow vde_t self:process { signal_perms getcap setcap };
+allow vde_t self:capability { chown net_admin dac_override fowner fsetid };
+
+allow vde_t vde_tmp_t:sock_file manage_sock_file_perms;
+allow vde_t self:unix_stream_socket {  create_stream_socket_perms connectto };
+allow vde_t self:unix_dgram_socket create_socket_perms;
+files_tmp_filetrans(vde_t, vde_tmp_t, sock_file)
+
+manage_dirs_pattern(vde_t, vde_var_run_t, vde_var_run_t)
+manage_files_pattern(vde_t, vde_var_run_t, vde_var_run_t)
+manage_sock_files_pattern(vde_t, vde_var_run_t, vde_var_run_t)
+files_pid_filetrans(vde_t, vde_var_run_t, { dir file sock_file unix_dgram_socket })
+
+files_read_etc_files(vde_t)
+
+domain_use_interactive_fds(vde_t)
+userdom_use_user_terminals(vde_t)
+miscfiles_read_localization(vde_t)
+corenet_rw_tun_tap_dev(vde_t)
+
+logging_send_syslog_msg(vde_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/vhostmd.fc refpolicy/policy/modules/contrib/vhostmd.fc
--- refpolicy/policy/modules/contrib/vhostmd.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/vhostmd.fc	2012-10-31 19:04:19.737580372 +0100
@@ -1,5 +1,5 @@
-/etc/rc.d/init.d/vhostmd	--	gen_context(system_u:object_r:vhostmd_initrc_exec_t,s0)
+/etc/rc\.d/init\.d/vhostmd	--	gen_context(system_u:object_r:vhostmd_initrc_exec_t,s0)
 
-/usr/sbin/vhostmd		--	gen_context(system_u:object_r:vhostmd_exec_t,s0)
+/usr/sbin/vhostmd	--	gen_context(system_u:object_r:vhostmd_exec_t,s0)
 
-/var/run/vhostmd.pid		--	gen_context(system_u:object_r:vhostmd_var_run_t,s0)
+/var/run/vhostmd.*	gen_context(system_u:object_r:vhostmd_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/vhostmd.if refpolicy/policy/modules/contrib/vhostmd.if
--- refpolicy/policy/modules/contrib/vhostmd.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/vhostmd.if	2012-10-31 19:04:19.738580372 +0100
@@ -1,13 +1,13 @@
-## <summary>Virtual host metrics daemon</summary>
+## <summary>Virtual host metrics daemon.</summary>
 
 ########################################
 ## <summary>
 ##	Execute a domain transition to run vhostmd.
 ## </summary>
 ## <param name="domain">
-## <summary>
+##	<summary>
 ##	Domain allowed to transition.
-## </summary>
+##	</summary>
 ## </param>
 #
 interface(`vhostmd_domtrans',`
@@ -15,12 +15,14 @@
 		type vhostmd_t, vhostmd_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, vhostmd_exec_t, vhostmd_t)
 ')
 
 ########################################
 ## <summary>
-##	Execute vhostmd server in the vhostmd domain.
+##	Execute vhostmd init scripts in
+##	the initrc domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -38,7 +40,7 @@
 
 ########################################
 ## <summary>
-##	Allow domain to read, vhostmd tmpfs files
+##	Read vhostmd tmpfs files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -51,13 +53,13 @@
 		type vhostmd_tmpfs_t;
 	')
 
+	fs_search_tmpfs($1)
 	allow $1 vhostmd_tmpfs_t:file read_file_perms;
-	files_search_tmp($1)
 ')
 
 ########################################
 ## <summary>
-##	Do not audit attempts to read,
+##	Do not audit attempts to read
 ##	vhostmd tmpfs files
 ## </summary>
 ## <param name="domain">
@@ -76,7 +78,7 @@
 
 #######################################
 ## <summary>
-##	Allow domain to read and write vhostmd tmpfs files
+##	Read and write vhostmd tmpfs files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -89,13 +91,14 @@
 		type vhostmd_tmpfs_t;
 	')
 
+	fs_search_tmpfs($1)
 	rw_files_pattern($1, vhostmd_tmpfs_t, vhostmd_tmpfs_t)
-	files_search_tmp($1)
 ')
 
 ########################################
 ## <summary>
-##	Create, read, write, and delete vhostmd tmpfs files.
+##	Create, read, write, and delete
+##	vhostmd tmpfs files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -108,13 +111,13 @@
 		type vhostmd_tmpfs_t;
 	')
 
+	fs_search_tmpfs($1)
 	manage_files_pattern($1, vhostmd_tmpfs_t, vhostmd_tmpfs_t)
-	files_search_tmp($1)
 ')
 
 ########################################
 ## <summary>
-##	Read vhostmd PID files.
+##	Read vhostmd pid files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -133,7 +136,8 @@
 
 ########################################
 ## <summary>
-##	Manage vhostmd var_run files.
+##	Create, read, write, and delete
+##	vhostmd pid files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -146,12 +150,14 @@
 		type vhostmd_var_run_t;
 	')
 
-	 manage_files_pattern($1, vhostmd_var_run_t, vhostmd_var_run_t)
+	files_search_pids($1)
+	manage_files_pattern($1, vhostmd_var_run_t, vhostmd_var_run_t)
 ')
 
 ########################################
 ## <summary>
-##	Connect to vhostmd over an unix domain stream socket.
+##	Connect to vhostmd with a unix
+##	domain stream socket.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -170,8 +176,8 @@
 
 #######################################
 ## <summary>
-##	Dontaudit read and write to vhostmd
-##	over an unix domain stream socket.
+##	Do not audit attempts to read and
+##	write vhostmd unix domain stream sockets.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -189,8 +195,8 @@
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate
-##	an vhostmd environment
+##	All of the rules required to
+##	administrate an vhostmd environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -206,10 +212,11 @@
 #
 interface(`vhostmd_admin',`
 	gen_require(`
-		type vhostmd_t, vhostmd_initrc_exec_t;
+		type vhostmd_t, vhostmd_initrc_exec_t, vhostmd_var_run_t;
+		type vhostmd_tmpfs_t;
 	')
 
-	allow $1 vhostmd_t:process { ptrace signal_perms getattr };
+	allow $1 vhostmd_t:process { ptrace signal_perms };
 	ps_process_pattern($1, vhostmd_t)
 
 	vhostmd_initrc_domtrans($1)
@@ -217,8 +224,9 @@
 	role_transition $2 vhostmd_initrc_exec_t system_r;
 	allow $2 system_r;
 
-	vhostmd_manage_tmpfs_files($1)
-
-	vhostmd_manage_pid_files($1)
+	fs_search_tmpfs($1)
+	admin_pattern($1, vhostmd_tmpfs_t)
 
+	files_search_pids($1)
+	admin_pattern($1, vhostmd_var_run_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/vhostmd.te refpolicy/policy/modules/contrib/vhostmd.te
--- refpolicy/policy/modules/contrib/vhostmd.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/vhostmd.te	2012-10-31 19:04:19.738580372 +0100
@@ -1,4 +1,4 @@
-policy_module(vhostmd, 1.0.0)
+policy_module(vhostmd, 1.0.1)
 
 ########################################
 #
@@ -20,12 +20,12 @@
 
 ########################################
 #
-# vhostmd local policy
+# Local policy
 #
 
-allow vhostmd_t self:capability { dac_override ipc_lock	setuid setgid };
-allow vhostmd_t self:process { setsched getsched };
-allow vhostmd_t self:fifo_file rw_file_perms;
+allow vhostmd_t self:capability { dac_override ipc_lock setuid setgid };
+allow vhostmd_t self:process { setsched getsched signal };
+allow vhostmd_t self:fifo_file rw_fifo_file_perms;
 
 manage_dirs_pattern(vhostmd_t, vhostmd_tmpfs_t, vhostmd_tmpfs_t)
 manage_files_pattern(vhostmd_t, vhostmd_tmpfs_t, vhostmd_tmpfs_t)
@@ -33,8 +33,10 @@
 
 manage_dirs_pattern(vhostmd_t, vhostmd_var_run_t, vhostmd_var_run_t)
 manage_files_pattern(vhostmd_t, vhostmd_var_run_t, vhostmd_var_run_t)
-files_pid_filetrans(vhostmd_t, vhostmd_var_run_t, { file dir })
+manage_sock_files_pattern(vhostmd_t, vhostmd_var_run_t, vhostmd_var_run_t)
+files_pid_filetrans(vhostmd_t, vhostmd_var_run_t, { file dir sock_file })
 
+kernel_read_kernel_sysctls(vhostmd_t)
 kernel_read_system_state(vhostmd_t)
 kernel_read_network_state(vhostmd_t)
 kernel_write_xen_state(vhostmd_t)
@@ -42,13 +44,22 @@
 corecmd_exec_bin(vhostmd_t)
 corecmd_exec_shell(vhostmd_t)
 
-corenet_tcp_connect_soundd_port(vhostmd_t)
+corenet_all_recvfrom_unlabeled(vhostmd_t)
+corenet_all_recvfrom_netlabel(vhostmd_t)
+corenet_tcp_sendrecv_generic_if(vhostmd_t)
+corenet_tcp_sendrecv_generic_node(vhostmd_t)
 
-files_read_etc_files(vhostmd_t)
-files_read_usr_files(vhostmd_t)
+corenet_sendrecv_soundd_client_packets(vhostmd_t)
+corenet_tcp_connect_soundd_port(vhostmd_t)
+corenet_tcp_sendrecv_soundd_port(vhostmd_t)
 
+dev_read_rand(vhostmd_t)
+dev_read_urand(vhostmd_t)
 dev_read_sysfs(vhostmd_t)
 
+files_list_tmp(vhostmd_t)
+files_read_usr_files(vhostmd_t)
+
 auth_use_nsswitch(vhostmd_t)
 
 logging_send_syslog_msg(vhostmd_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/virt.fc refpolicy/policy/modules/contrib/virt.fc
--- refpolicy/policy/modules/contrib/virt.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/virt.fc	2012-10-22 20:10:27.541015426 +0200
@@ -1,29 +1,51 @@
-HOME_DIR/.virtinst(/.*)? 	gen_context(system_u:object_r:virt_content_t,s0)
-HOME_DIR/VirtualMachines(/.*)? 	gen_context(system_u:object_r:virt_image_t,s0)
-HOME_DIR/VirtualMachines/isos(/.*)? gen_context(system_u:object_r:virt_content_t,s0)
+HOME_DIR/\.libvirt(/.*)?	gen_context(system_u:object_r:virt_home_t,s0)
+HOME_DIR/\.libvirt/qemu(/.*)?	gen_context(system_u:object_r:svirt_home_t,s0)
+HOME_DIR/\.virtinst(/.*)?	gen_context(system_u:object_r:virt_home_t,s0)
+HOME_DIR/VirtualMachines(/.*)?	gen_context(system_u:object_r:virt_home_t,s0)
+HOME_DIR/VirtualMachines/isos(/.*)?	gen_context(system_u:object_r:virt_content_t,s0)
 
-/etc/libvirt		-d	gen_context(system_u:object_r:virt_etc_t,s0)
+/etc/libvirt	-d	gen_context(system_u:object_r:virt_etc_t,s0)
 /etc/libvirt/[^/]*	--	gen_context(system_u:object_r:virt_etc_t,s0)
 /etc/libvirt/[^/]*	-d	gen_context(system_u:object_r:virt_etc_rw_t,s0)
-/etc/libvirt/.*/.*		gen_context(system_u:object_r:virt_etc_rw_t,s0)
-/etc/rc\.d/init\.d/libvirtd --	gen_context(system_u:object_r:virtd_initrc_exec_t,s0)
-/etc/xen		-d	gen_context(system_u:object_r:virt_etc_t,s0)
-/etc/xen/[^/]*		--	gen_context(system_u:object_r:virt_etc_t,s0)
-/etc/xen/[^/]*		-d	gen_context(system_u:object_r:virt_etc_rw_t,s0)
-/etc/xen/.*/.*			gen_context(system_u:object_r:virt_etc_rw_t,s0)
+/etc/libvirt/.*/.*	gen_context(system_u:object_r:virt_etc_rw_t,s0)
 
+/etc/rc\.d/init\.d/libvirt-bin	--	gen_context(system_u:object_r:virtd_initrc_exec_t,s0)
+/etc/rc\.d/init\.d/libvirtd	--	gen_context(system_u:object_r:virtd_initrc_exec_t,s0)
+
+/etc/xen	-d	gen_context(system_u:object_r:virt_etc_t,s0)
+/etc/xen/[^/]*	--	gen_context(system_u:object_r:virt_etc_t,s0)
+/etc/xen/[^/]*	-d	gen_context(system_u:object_r:virt_etc_rw_t,s0)
+/etc/xen/.*/.*	gen_context(system_u:object_r:virt_etc_rw_t,s0)
+
+/usr/libexec/libvirt_lxc	--	gen_context(system_u:object_r:virtd_lxc_exec_t,s0)
+/usr/libexec/qemu-bridge-helper	gen_context(system_u:object_r:virt_bridgehelper_exec_t,s0)
+
+/usr/bin/virsh	--	gen_context(system_u:object_r:virsh_exec_t,s0)
+/usr/bin/virt-sandbox-service.*	--	gen_context(system_u:object_r:virsh_exec_t,s0)
+
+/usr/sbin/condor_vm-gahp	--	gen_context(system_u:object_r:virtd_exec_t,s0)
+/usr/sbin/fence_virtd	--	gen_context(system_u:object_r:virsh_exec_t,s0)
+/usr/sbin/libvirt-qmf	--	gen_context(system_u:object_r:virt_qmf_exec_t,s0)
 /usr/sbin/libvirtd	--	gen_context(system_u:object_r:virtd_exec_t,s0)
 
-/var/cache/libvirt(/.*)?	gen_context(system_u:object_r:svirt_cache_t,s0)
+/var/cache/libvirt(/.*)?	gen_context(system_u:object_r:svirt_cache_t,s0-mls_systemhigh)
 
-/var/lib/libvirt(/.*)?		gen_context(system_u:object_r:virt_var_lib_t,s0)
-/var/lib/libvirt/boot(/.*)? 	gen_context(system_u:object_r:virt_content_t,s0)
-/var/lib/libvirt/images(/.*)? 	gen_context(system_u:object_r:virt_image_t,s0)
-/var/lib/libvirt/isos(/.*)? 	gen_context(system_u:object_r:virt_content_t,s0)
-/var/lib/libvirt/qemu(/.*)? 	gen_context(system_u:object_r:svirt_var_run_t,s0)
+/var/lib/libvirt(/.*)?	gen_context(system_u:object_r:virt_var_lib_t,s0)
+/var/lib/libvirt/boot(/.*)?	gen_context(system_u:object_r:virt_content_t,s0)
+/var/lib/libvirt/images(/.*)?	gen_context(system_u:object_r:virt_image_t,s0)
+/var/lib/libvirt/isos(/.*)?	gen_context(system_u:object_r:virt_content_t,s0)
+/var/lib/libvirt/qemu(/.*)?	gen_context(system_u:object_r:svirt_var_run_t,s0-mls_systemhigh)
 
-/var/log/libvirt(/.*)?		gen_context(system_u:object_r:virt_log_t,s0)
-/var/run/libvirt(/.*)?		gen_context(system_u:object_r:virt_var_run_t,s0)
-/var/run/libvirt/qemu(/.*)? 	gen_context(system_u:object_r:svirt_var_run_t,s0)
+/var/log/log(/.*)?	gen_context(system_u:object_r:virt_log_t,s0)
+/var/log/libvirt(/.*)?	gen_context(system_u:object_r:virt_log_t,s0)
+/var/log/vdsm(/.*)?	gen_context(system_u:object_r:virt_log_t,s0)
+
+/var/vdsm(/.*)?		gen_context(system_u:object_r:virt_var_run_t,s0)
 
-/var/vdsm(/.*)?			gen_context(system_u:object_r:virt_var_run_t,s0)
+/var/run/libguestfs(/.*)?	gen_context(system_u:object_r:virt_var_run_t,s0)
+/var/run/libvirt(/.*)?		gen_context(system_u:object_r:virt_var_run_t,s0)
+/var/run/libvirt/lxc(/.*)?	gen_context(system_u:object_r:virtd_lxc_var_run_t,s0)
+/var/run/libvirt-sandbox(/.*)?	gen_context(system_u:object_r:virtd_lxc_var_run_t,s0)
+/var/run/libvirt/qemu(/.*)?	gen_context(system_u:object_r:svirt_var_run_t,s0-mls_systemhigh)
+/var/run/user/[^/]*/libguestfs(/.*)?	gen_context(system_u:object_r:virt_home_t,s0)
+/var/run/vdsm(/.*)?	gen_context(system_u:object_r:virt_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/virt.if refpolicy/policy/modules/contrib/virt.if
--- refpolicy/policy/modules/contrib/virt.if	2012-07-10 14:44:44.000000000 +0200
+++ refpolicy/policy/modules/contrib/virt.if	2012-11-02 20:08:32.415957426 +0100
@@ -1,51 +1,69 @@
-## <summary>Libvirt virtualization API</summary>
+## <summary>Libvirt virtualization API.</summary>
 
-########################################
+#######################################
 ## <summary>
-##	Creates types and rules for a basic
-##	qemu process domain.
+##	The template to define a virt domain.
 ## </summary>
-## <param name="prefix">
+## <param name="domain_prefix">
 ##	<summary>
-##	Prefix for the domain.
+##	Domain prefix to be used.
 ##	</summary>
 ## </param>
 #
 template(`virt_domain_template',`
 	gen_require(`
-		type virtd_t;
-		attribute virt_image_type;
-		attribute virt_domain;
+		attribute_role virt_domain_roles;
+		attribute virt_image_type, virt_domain, virt_tmpfs_type;
+		attribute virt_ptynode, virt_tmp_type;
 	')
 
+	########################################
+	#
+	# Declarations
+	#
+
 	type $1_t, virt_domain;
-	domain_type($1_t)
+	application_type($1_t)
+	qemu_entry_type($1_t)
 	domain_user_exemption_target($1_t)
-	role system_r types $1_t;
+	mls_rangetrans_target($1_t)
+	# FIXME
+	# mcs_untrusted_proc($1_t)
+	role virt_domain_roles types $1_t;
 
-	type $1_devpts_t;
+	type $1_devpts_t, virt_ptynode;
 	term_pty($1_devpts_t)
 
-	type $1_tmp_t;
+	type $1_tmp_t, virt_tmp_type;
 	files_tmp_file($1_tmp_t)
 
-	type $1_tmpfs_t;
+	type $1_tmpfs_t, virt_tmpfs_type;
 	files_tmpfs_file($1_tmpfs_t)
 
+	optional_policy(`
+		pulseaudio_tmpfs_content($1_tmpfs_t)
+	')
+
 	type $1_image_t, virt_image_type;
 	files_type($1_image_t)
 	dev_node($1_image_t)
+	dev_associate_sysfs($1_image_t)
 
-	type $1_var_run_t;
-	files_pid_file($1_var_run_t)
+	########################################
+	#
+	# Policy
+	#
 
-	allow $1_t $1_devpts_t:chr_file { rw_chr_file_perms setattr };
+	allow $1_t $1_devpts_t:chr_file { rw_chr_file_perms setattr_chr_file_perms };
 	term_create_pty($1_t, $1_devpts_t)
 
 	manage_dirs_pattern($1_t, $1_image_t, $1_image_t)
 	manage_files_pattern($1_t, $1_image_t, $1_image_t)
+	manage_fifo_files_pattern($1_t, $1_image_t, $1_image_t)
 	read_lnk_files_pattern($1_t, $1_image_t, $1_image_t)
+	rw_chr_files_pattern($1_t, $1_image_t, $1_image_t)
 	rw_blk_files_pattern($1_t, $1_image_t, $1_image_t)
+	fs_hugetlbfs_filetrans($1_t, $1_image_t, file)
 
 	manage_dirs_pattern($1_t, $1_tmp_t, $1_tmp_t)
 	manage_files_pattern($1_t, $1_tmp_t, $1_tmp_t)
@@ -57,32 +75,49 @@
 	manage_lnk_files_pattern($1_t, $1_tmpfs_t, $1_tmpfs_t)
 	fs_tmpfs_filetrans($1_t, $1_tmpfs_t, { dir file lnk_file })
 
-	stream_connect_pattern(virtd_t, $1_var_run_t, $1_var_run_t, virt_domain)
-	manage_dirs_pattern(virtd_t, $1_var_run_t, $1_var_run_t)
-	manage_files_pattern(virtd_t, $1_var_run_t, $1_var_run_t)
-	manage_sock_files_pattern(virtd_t, $1_var_run_t, $1_var_run_t)
-
-	manage_dirs_pattern($1_t, $1_var_run_t, $1_var_run_t)
-	manage_files_pattern($1_t, $1_var_run_t, $1_var_run_t)
-	manage_sock_files_pattern($1_t, $1_var_run_t, $1_var_run_t)
-	manage_lnk_files_pattern($1_t, $1_var_run_t, $1_var_run_t)
-	files_pid_filetrans($1_t, $1_var_run_t, { dir file })
-	stream_connect_pattern($1_t, $1_var_run_t, $1_var_run_t, virtd_t)
-
 	auth_use_nsswitch($1_t)
 
 	optional_policy(`
+		pulseaudio_run($1_t, virt_domain_roles)
+	')
+
+	optional_policy(`
 		xserver_rw_shm($1_t)
 	')
 ')
 
+#######################################
+## <summary>
+##	The template to define a virt lxc domain.
+## </summary>
+## <param name="domain_prefix">
+##	<summary>
+##	Domain prefix to be used.
+##	</summary>
+## </param>
+#
+template(`virt_lxc_domain_template',`
+	gen_require(`
+		attribute_role svirt_lxc_domain_roles;
+		attribute svirt_lxc_domain;
+	')
+
+	type $1_t, svirt_lxc_domain;
+	domain_type($1_t)
+	domain_user_exemption_target($1_t)
+	mls_rangetrans_target($1_t)
+	# FIXME
+	# mcs_untrusted_proc($1_t)
+	role svirt_lxc_domain_roles types $1_t;
+')
+
 ########################################
 ## <summary>
-##	Make the specified type usable as a virt image
+##	Make the specified type virt image type.
 ## </summary>
 ## <param name="type">
 ##	<summary>
-##	Type to be used as a virtual image
+##	Type to be used as a virtual image.
 ##	</summary>
 ## </param>
 #
@@ -93,19 +128,17 @@
 
 	typeattribute $1 virt_image_type;
 	files_type($1)
-
-	# virt images can be assigned to blk devices
 	dev_node($1)
 ')
 
 ########################################
 ## <summary>
-##	Execute a domain transition to run virt.
+##	Execute a domain transition to run virtd.
 ## </summary>
 ## <param name="domain">
-## <summary>
+##	<summary>
 ##	Domain allowed to transition.
-## </summary>
+##	</summary>
 ## </param>
 #
 interface(`virt_domtrans',`
@@ -113,12 +146,195 @@
 		type virtd_t, virtd_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, virtd_exec_t, virtd_t)
 ')
 
+########################################
+## <summary>
+##	Execute a domain transition to run virt qmf.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed to transition.
+##	</summary>
+## </param>
+#
+interface(`virt_domtrans_qmf',`
+	gen_require(`
+		type virt_qmf_t, virt_qmf_exec_t;
+	')
+
+	corecmd_search_bin($1)
+	domtrans_pattern($1, virt_qmf_exec_t, virt_qmf_t)
+')
+
+########################################
+## <summary>
+##	Execute a domain transition to
+##	run virt bridgehelper.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed to transition.
+##	</summary>
+## </param>
+#
+interface(`virt_domtrans_bridgehelper',`
+	gen_require(`
+		type virt_bridgehelper_t, virt_bridgehelper_exec_t;
+	')
+
+	corecmd_search_bin($1)
+	domtrans_pattern($1, virt_bridgehelper_exec_t, virt_bridgehelper_t)
+')
+
+########################################
+## <summary>
+##	Execute bridgehelper in the bridgehelper
+##	domain, and allow the specified role
+##	the bridgehelper domain.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed to transition.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+#
+interface(`virt_run_bridgehelper',`
+	gen_require(`
+		attribute_role virt_bridgehelper_roles;
+	')
+
+	virt_domtrans_bridgehelper($1)
+	roleattribute $2 virt_bridgehelper_roles;
+')
+
+########################################
+## <summary>
+##	Execute virt domain in the their
+##	domain, and allow the specified
+##	role that virt domain.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed to transition.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+#
+interface(`virt_run_virt_domain',`
+	gen_require(`
+		attribute virt_domain;
+		attribute_role virt_domain_roles;
+	')
+
+	allow $1 virt_domain:process { signal transition };
+	roleattribute $2 virt_domain_roles;
+
+	allow virt_domain $1:fd use;
+	allow virt_domain $1:fifo_file rw_fifo_file_perms;
+	allow virt_domain $1:process sigchld;
+')
+
+########################################
+## <summary>
+##	Send generic signals to all virt domains.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`virt_signal_all_virt_domains',`
+	gen_require(`
+		attribute virt_domain;
+	')
+
+	allow $1 virt_domain:process signal;
+')
+
+########################################
+## <summary>
+##	Send kill signals to all virt domains.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`virt_kill_all_virt_domains',`
+	gen_require(`
+		attribute virt_domain;
+	')
+
+	allow $1 virt_domain:process sigkill;
+')
+
+########################################
+## <summary>
+##	Execute svirt lxc domains in their
+##	domain, and allow the specified
+##	role that svirt lxc domain.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed to transition.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+#
+interface(`virt_run_svirt_lxc_domain',`
+	gen_require(`
+		attribute svirt_lxc_domain;
+		attribute_role svirt_lxc_domain_roles;
+	')
+
+	allow $1 svirt_lxc_domain:process { signal transition };
+	roleattribute $2 svirt_lxc_domain_roles;
+
+	allow svirt_lxc_domain $1:fd use;
+	allow svirt_lxc_domain $1:fifo_file rw_fifo_file_perms;
+	allow svirt_lxc_domain $1:process sigchld;
+')
+
+#######################################
+## <summary>
+##	Get attributes of virtd executable files.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`virt_getattr_virtd_exec_files',`
+	gen_require(`
+		type virtd_exec_t;
+	')
+
+	allow $1 virtd_exec_t:file getattr_file_perms;
+')
+
 #######################################
 ## <summary>
-##	Connect to virt over an unix domain stream socket.
+##	Connect to virt with a unix
+##	domain stream socket.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -137,7 +353,7 @@
 
 ########################################
 ## <summary>
-##	Allow domain to attach to virt TUN devices
+##	Attach to virt tun devices.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -156,7 +372,7 @@
 
 ########################################
 ## <summary>
-##	Read virt config files.
+##	Read virt configuration content.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -166,18 +382,20 @@
 #
 interface(`virt_read_config',`
 	gen_require(`
-		type virt_etc_t;
-		type virt_etc_rw_t;
+		type virt_etc_t, virt_etc_rw_t;
 	')
 
 	files_search_etc($1)
+	allow $1 { virt_etc_t virt_etc_rw_t }:dir list_dir_perms;
 	read_files_pattern($1, virt_etc_t, virt_etc_t)
 	read_files_pattern($1, virt_etc_rw_t, virt_etc_rw_t)
+	read_lnk_files_pattern($1, virt_etc_rw_t, virt_etc_rw_t)
 ')
 
 ########################################
 ## <summary>
-##	manage virt config files.
+##	Create, read, write, and delete
+##	virt configuration content.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -187,18 +405,20 @@
 #
 interface(`virt_manage_config',`
 	gen_require(`
-		type virt_etc_t;
-		type virt_etc_rw_t;
+		type virt_etc_t, virt_etc_rw_t;
 	')
 
 	files_search_etc($1)
+	allow $1 { virt_etc_t virt_etc_rw_t }:dir manage_dir_perms;
 	manage_files_pattern($1, virt_etc_t, virt_etc_t)
 	manage_files_pattern($1, virt_etc_rw_t, virt_etc_rw_t)
+	manage_lnk_files_pattern($1, virt_etc_rw_t, virt_etc_rw_t)
 ')
 
 ########################################
 ## <summary>
-##	Allow domain to manage virt image files
+##	Create, read, write, and delete
+##	virt image files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -233,7 +453,330 @@
 
 ########################################
 ## <summary>
-##	Read virt PID files.
+##	Create, read, write, and delete
+##	virt content.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`virt_manage_virt_content',`
+	gen_require(`
+		type virt_content_t;
+	')
+
+	userdom_search_user_home_dirs($1)
+	allow $1 virt_content_t:dir manage_dir_perms;
+	allow $1 virt_content_t:file manage_file_perms;
+	allow $1 virt_content_t:fifo_file manage_fifo_file_perms;
+	allow $1 virt_content_t:lnk_file manage_lnk_file_perms;
+	allow $1 virt_content_t:sock_file manage_sock_file_perms;
+	allow $1 virt_content_t:blk_file manage_blk_file_perms;
+
+	tunable_policy(`virt_use_nfs',`
+		fs_manage_nfs_dirs($1)
+		fs_manage_nfs_files($1)
+		fs_manage_nfs_symlinks($1)
+	')
+
+	tunable_policy(`virt_use_samba',`
+		fs_manage_cifs_dirs($1)
+		fs_manage_cifs_files($1)
+		fs_manage_cifs_symlinks($1)
+	')
+')
+
+########################################
+## <summary>
+##	Relabel virt content.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`virt_relabel_virt_content',`
+	gen_require(`
+		type virt_content_t;
+	')
+
+	userdom_search_user_home_dirs($1)
+	allow $1 virt_content_t:dir relabel_dir_perms;
+	allow $1 virt_content_t:file relabel_file_perms;
+	allow $1 virt_content_t:fifo_file relabel_fifo_file_perms;
+	allow $1 virt_content_t:lnk_file relabel_lnk_file_perms;
+	allow $1 virt_content_t:sock_file relabel_sock_file_perms;
+	allow $1 virt_content_t:blk_file relabel_blk_file_perms;
+')
+
+########################################
+## <summary>
+##	Create specified objects in user home
+##	directories with the virt content type.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="object_class">
+##	<summary>
+##	Class of the object being created.
+##	</summary>
+## </param>
+## <param name="name" optional="true">
+##	<summary>
+##	The name of the object being created.
+##	</summary>
+## </param>
+#
+interface(`virt_home_filetrans_virt_content',`
+	gen_require(`
+		type virt_content_t;
+	')
+
+	virt_home_filetrans($1, virt_content_t, $2, $3)
+')
+
+########################################
+## <summary>
+##	Create, read, write, and delete
+##	svirt home content.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`virt_manage_svirt_home_content',`
+	gen_require(`
+		type svirt_home_t;
+	')
+
+	userdom_search_user_home_dirs($1)
+	allow $1 svirt_home_t:dir manage_dir_perms;
+	allow $1 svirt_home_t:file manage_file_perms;
+	allow $1 svirt_home_t:fifo_file manage_fifo_file_perms;
+	allow $1 svirt_home_t:lnk_file manage_lnk_file_perms;
+	allow $1 svirt_home_t:sock_file manage_sock_file_perms;
+
+	tunable_policy(`virt_use_nfs',`
+		fs_manage_nfs_dirs($1)
+		fs_manage_nfs_files($1)
+		fs_manage_nfs_symlinks($1)
+	')
+
+	tunable_policy(`virt_use_samba',`
+		fs_manage_cifs_dirs($1)
+		fs_manage_cifs_files($1)
+		fs_manage_cifs_symlinks($1)
+	')
+')
+
+########################################
+## <summary>
+##	Relabel svirt home content.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`virt_relabel_svirt_home_content',`
+	gen_require(`
+		type svirt_home_t;
+	')
+
+	userdom_search_user_home_dirs($1)
+	allow $1 svirt_home_t:dir relabel_dir_perms;
+	allow $1 svirt_home_t:file relabel_file_perms;
+	allow $1 svirt_home_t:fifo_file relabel_fifo_file_perms;
+	allow $1 svirt_home_t:lnk_file relabel_lnk_file_perms;
+	allow $1 svirt_home_t:sock_file relabel_sock_file_perms;
+')
+
+########################################
+## <summary>
+##	Create specified objects in user home
+##	directories with the svirt home type.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="object_class">
+##	<summary>
+##	Class of the object being created.
+##	</summary>
+## </param>
+## <param name="name" optional="true">
+##	<summary>
+##	The name of the object being created.
+##	</summary>
+## </param>
+#
+interface(`virt_home_filetrans_svirt_home',`
+	gen_require(`
+		type svirt_home_t;
+	')
+
+	virt_home_filetrans($1, svirt_home_t, $2, $3)
+')
+
+########################################
+## <summary>
+##	Create specified objects in generic
+##	virt home directories with private
+##	home type.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="private_type">
+##	<summary>
+##	Private file type.
+##	</summary>
+## </param>
+## <param name="object_class">
+##	<summary>
+##	Class of the object being created.
+##	</summary>
+## </param>
+## <param name="name" optional="true">
+##	<summary>
+##	The name of the object being created.
+##	</summary>
+## </param>
+#
+interface(`virt_home_filetrans',`
+	gen_require(`
+		type virt_home_t;
+	')
+
+	userdom_search_user_home_dirs($1)
+	filetrans_pattern($1, virt_home_t, $2, $3, $4)
+')
+
+########################################
+## <summary>
+##	Create, read, write, and delete
+##	virt home files.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`virt_manage_home_files',`
+	gen_require(`
+		type virt_home_t;
+	')
+
+	userdom_search_user_home_dirs($1)
+	manage_files_pattern($1, virt_home_t, virt_home_t)
+')
+
+########################################
+## <summary>
+##	Create, read, write, and delete
+##	virt home content.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`virt_manage_generic_virt_home_content',`
+	gen_require(`
+		type virt_home_t;
+	')
+
+	userdom_search_user_home_dirs($1)
+	allow $1 virt_home_t:dir manage_dir_perms;
+	allow $1 virt_home_t:file manage_file_perms;
+	allow $1 virt_home_t:fifo_file manage_fifo_file_perms;
+	allow $1 virt_home_t:lnk_file manage_lnk_file_perms;
+	allow $1 virt_home_t:sock_file manage_sock_file_perms;
+
+	tunable_policy(`virt_use_nfs',`
+		fs_manage_nfs_dirs($1)
+		fs_manage_nfs_files($1)
+		fs_manage_nfs_symlinks($1)
+	')
+
+	tunable_policy(`virt_use_samba',`
+		fs_manage_cifs_dirs($1)
+		fs_manage_cifs_files($1)
+		fs_manage_cifs_symlinks($1)
+	')
+')
+
+########################################
+## <summary>
+##	Relabel virt home content.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`virt_relabel_generic_virt_home_content',`
+	gen_require(`
+		type virt_home_t;
+	')
+
+	userdom_search_user_home_dirs($1)
+	allow $1 virt_home_t:dir relabel_dir_perms;
+	allow $1 virt_home_t:file relabel_file_perms;
+	allow $1 virt_home_t:fifo_file relabel_fifo_file_perms;
+	allow $1 virt_home_t:lnk_file relabel_lnk_file_perms;
+	allow $1 virt_home_t:sock_file relabel_sock_file_perms;
+')
+
+########################################
+## <summary>
+##	Create specified objects in user home
+##	directories with the generic virt
+##	home type.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="object_class">
+##	<summary>
+##	Class of the object being created.
+##	</summary>
+## </param>
+## <param name="name" optional="true">
+##	<summary>
+##	The name of the object being created.
+##	</summary>
+## </param>
+#
+interface(`virt_home_filetrans_virt_home',`
+	gen_require(`
+		type virt_home_t;
+	')
+
+	userdom_user_home_dir_filetrans($1, virt_home_t, $2, $3)
+')
+
+########################################
+## <summary>
+##	Read virt pid files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -252,7 +795,8 @@
 
 ########################################
 ## <summary>
-##	Manage virt pid files.
+##	Create, read, write, and delete
+##	virt pid files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -284,8 +828,8 @@
 		type virt_var_lib_t;
 	')
 
-	allow $1 virt_var_lib_t:dir search_dir_perms;
 	files_search_var_lib($1)
+	allow $1 virt_var_lib_t:dir search_dir_perms;
 ')
 
 ########################################
@@ -330,7 +874,43 @@
 
 ########################################
 ## <summary>
-##	Allow the specified domain to read virt's log files.
+##	Create objects in virt pid
+##	directories with a private type.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="private type">
+##	<summary>
+##	The type of the object to be created.
+##	</summary>
+## </param>
+## <param name="object">
+##	<summary>
+##	The object class of the object being created.
+##	</summary>
+## </param>
+## <param name="name" optional="true">
+##	<summary>
+##	The name of the object being created.
+##	</summary>
+## </param>
+## <infoflow type="write" weight="10"/>
+#
+interface(`virt_pid_filetrans',`
+	gen_require(`
+		type virt_var_run_t;
+	')
+
+	files_search_pids($1)
+	filetrans_pattern($1, virt_var_run_t, $2, $3, $4)
+')
+
+########################################
+## <summary>
+##	Read virt log files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -350,13 +930,12 @@
 
 ########################################
 ## <summary>
-##	Allow the specified domain to append
-##	virt log files.
+##	Append virt log files.
 ## </summary>
 ## <param name="domain">
-## 	<summary>
+##	<summary>
 ##	Domain allowed access.
-## 	</summary>
+##	</summary>
 ## </param>
 #
 interface(`virt_append_log',`
@@ -370,7 +949,8 @@
 
 ########################################
 ## <summary>
-##	Allow domain to manage virt log files
+##	Create, read, write, and delete
+##	virt log files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -383,6 +963,7 @@
 		type virt_log_t;
 	')
 
+	logging_search_logs($1)
 	manage_dirs_pattern($1, virt_log_t, virt_log_t)
 	manage_files_pattern($1, virt_log_t, virt_log_t)
 	manage_lnk_files_pattern($1, virt_log_t, virt_log_t)
@@ -390,7 +971,26 @@
 
 ########################################
 ## <summary>
-##	Allow domain to read virt image files
+##	Search virt image directories.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`virt_search_images',`
+	gen_require(`
+		attribute virt_image_type;
+	')
+
+	virt_search_lib($1)
+	allow $1 virt_image_type:dir search_dir_perms;
+')
+
+########################################
+## <summary>
+##	Read virt image files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -448,7 +1048,8 @@
 
 ########################################
 ## <summary>
-##	Allow domain to manage virt image files
+##	Create, read, write, and delete
+##	virt image files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -484,8 +1085,8 @@
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate
-##	an virt environment
+##	All of the rules required to
+##	administrate an virt environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -501,20 +1102,50 @@
 #
 interface(`virt_admin',`
 	gen_require(`
-		type virtd_t, virtd_initrc_exec_t;
+		attribute virt_domain, virt_image_type, virt_tmpfs_type;
+		attribute virt_ptynode, svirt_lxc_domain, virt_tmp_type;
+		type virtd_t, virtd_initrc_exec_t, virtd_lxc_t;
+		type virsh_t, virtd_lxc_var_run_t, svirt_lxc_file_t;
+		type virt_bridgehelper_t, virt_qmf_t, virt_var_lib_t;
+		type virt_var_run_t, virt_tmp_t, virt_log_t;
+		type virt_lock_t, svirt_var_run_t, virt_etc_rw_t;
+		type virt_etc_t, svirt_cache_t;
 	')
 
-	allow $1 virtd_t:process { ptrace signal_perms };
-	ps_process_pattern($1, virtd_t)
+	allow $1 { virt_domain svirt_lxc_domain virtd_t }:process { ptrace signal_perms };
+	allow $1 { virtd_lxc_t virsh_t virt_bridgehelper_t virt_qmf_t }:process { ptrace signal_perms };
+	ps_process_pattern($1, { virt_domain svirt_lxc_domain virtd_t })
+	ps_process_pattern($1, { virtd_lxc_t virsh_t virt_bridgehelper_t virt_qmf_t })
 
 	init_labeled_script_domtrans($1, virtd_initrc_exec_t)
 	domain_system_change_exemption($1)
 	role_transition $2 virtd_initrc_exec_t system_r;
 	allow $2 system_r;
 
-	virt_manage_pid_files($1)
+	fs_search_tmpfs($1)
+	admin_pattern($1, virt_tmpfs_type)
+
+	files_search_tmp($1)
+	admin_pattern($1, { virt_tmp_type virt_tmp_t })
+
+	files_search_etc($1)
+	admin_pattern($1, { virt_etc_t virt_etc_rw_t })
+
+	logging_search_logs($1)
+	admin_pattern($1, virt_log_t)
+
+	files_search_pids($1)
+	admin_pattern($1, { virt_var_run_t virtd_lxc_var_run_t svirt_var_run_t })
+
+	files_search_var($1)
+	admin_pattern($1, svirt_cache_t)
+
+	files_search_var_lib($1)
+	admin_pattern($1, { virt_image_type virt_var_lib_t svirt_lxc_file_t })
 
-	virt_manage_lib_files($1)
+	files_search_locks($1)
+	admin_pattern($1, virt_lock_t)
 
-	virt_manage_log($1)
+	dev_list_all_dev_nodes($1)
+	allow $1 virt_ptynode:chr_file rw_term_perms;
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/virt.te refpolicy/policy/modules/contrib/virt.te
--- refpolicy/policy/modules/contrib/virt.te	2012-07-25 20:33:05.000000000 +0200
+++ refpolicy/policy/modules/contrib/virt.te	2012-11-14 20:06:47.633495326 +0100
@@ -1,4 +1,4 @@
-policy_module(virt, 1.5.0)
+policy_module(virt, 1.6.4)
 
 ########################################
 #
@@ -6,55 +6,92 @@
 #
 
 ## <desc>
-## <p>
-## Allow virt to use serial/parallell communication ports
-## </p>
+##	<p>
+##	Determine whether confined virtual guests
+##	can use serial/parallel communication ports.
+##	</p>
 ## </desc>
 gen_tunable(virt_use_comm, false)
 
 ## <desc>
-## <p>
-## Allow virt to read fuse files
-## </p>
+##	<p>
+##	Determine whether confined virtual guests
+##	can use executable memory and can make
+##	their stack executable.
+##	</p>
+## </desc>
+gen_tunable(virt_use_execmem, false)
+
+## <desc>
+##	<p>
+##	Determine whether confined virtual guests
+##	can use fuse file systems.
+##	</p>
 ## </desc>
 gen_tunable(virt_use_fusefs, false)
 
 ## <desc>
-## <p>
-## Allow virt to manage nfs files
-## </p>
+##	<p>
+##	Determine whether confined virtual guests
+##	can use nfs file systems.
+##	</p>
 ## </desc>
 gen_tunable(virt_use_nfs, false)
 
 ## <desc>
-## <p>
-## Allow virt to manage cifs files
-## </p>
+##	<p>
+##	Determine whether confined virtual guests
+##	can use cifs file systems.
+##	</p>
 ## </desc>
 gen_tunable(virt_use_samba, false)
 
 ## <desc>
-## <p>
-## Allow virt to manage device configuration, (pci)
-## </p>
+##	<p>
+##	Determine whether confined virtual guests
+##	can manage device configuration.
+##	</p>
 ## </desc>
 gen_tunable(virt_use_sysfs, false)
 
 ## <desc>
-## <p>
-## Allow virt to use usb devices
-## </p>
+##	<p>
+##	Determine whether confined virtual guests
+##	can use usb devices.
+##	</p>
 ## </desc>
-gen_tunable(virt_use_usb, true)
-
-virt_domain_template(svirt)
-role system_r types svirt_t;
+gen_tunable(virt_use_usb, false)
 
-type svirt_cache_t;
-files_type(svirt_cache_t)
+## <desc>
+##	<p>
+##	Determine whether confined virtual guests
+##	can interact with xserver.
+##	</p>
+## </desc>
+gen_tunable(virt_use_xserver, false)
 
+attribute virt_ptynode;
 attribute virt_domain;
 attribute virt_image_type;
+attribute virt_tmp_type;
+attribute virt_tmpfs_type;
+
+attribute svirt_lxc_domain;
+
+attribute_role virt_domain_roles;
+roleattribute system_r virt_domain_roles;
+
+attribute_role virt_bridgehelper_roles;
+roleattribute system_r virt_bridgehelper_roles;
+
+attribute_role svirt_lxc_domain_roles;
+roleattribute system_r svirt_lxc_domain_roles;
+
+virt_domain_template(svirt)
+virt_domain_template(svirt_prot_exec)
+
+type virt_cache_t alias svirt_cache_t;
+files_type(virt_cache_t)
 
 type virt_etc_t;
 files_config_file(virt_etc_t)
@@ -62,17 +99,30 @@
 type virt_etc_rw_t;
 files_type(virt_etc_rw_t)
 
-# virt Image files
+type virt_home_t;
+userdom_user_home_content(virt_home_t)
+
+type svirt_home_t;
+userdom_user_home_content(svirt_home_t)
+
+type svirt_var_run_t;
+files_pid_file(svirt_var_run_t)
+mls_trusted_object(svirt_var_run_t)
+
 type virt_image_t; # customizable
 virt_image(virt_image_t)
+files_mountpoint(virt_image_t)
 
-# virt Image files
 type virt_content_t; # customizable
 virt_image(virt_content_t)
 userdom_user_home_content(virt_content_t)
 
+type virt_lock_t;
+files_lock_file(virt_lock_t)
+
 type virt_log_t;
 logging_log_file(virt_log_t)
+mls_trusted_object(virt_log_t)
 
 type virt_tmp_t;
 files_tmp_file(virt_tmp_t)
@@ -81,7 +131,7 @@
 files_pid_file(virt_var_run_t)
 
 type virt_var_lib_t;
-files_type(virt_var_lib_t)
+files_mountpoint(virt_var_lib_t)
 
 type virtd_t;
 type virtd_exec_t;
@@ -100,98 +150,293 @@
 	init_ranged_daemon_domain(virtd_t, virtd_exec_t, s0 - mls_systemhigh)
 ')
 
+type virt_qmf_t;
+type virt_qmf_exec_t;
+init_daemon_domain(virt_qmf_t, virt_qmf_exec_t)
+
+type virt_bridgehelper_t;
+type virt_bridgehelper_exec_t;
+domain_type(virt_bridgehelper_t)
+domain_entry_file(virt_bridgehelper_t, virt_bridgehelper_exec_t)
+role virt_bridgehelper_roles types virt_bridgehelper_t;
+
+type virtd_lxc_t;
+type virtd_lxc_exec_t;
+init_system_domain(virtd_lxc_t, virtd_lxc_exec_t)
+
+type virtd_lxc_var_run_t;
+files_pid_file(virtd_lxc_var_run_t)
+
+type svirt_lxc_file_t;
+files_mountpoint(svirt_lxc_file_t)
+
+virt_lxc_domain_template(svirt_lxc_net)
+
+type virsh_t;
+type virsh_exec_t;
+init_system_domain(virsh_t, virsh_exec_t)
+
 ########################################
 #
-# svirt local policy
+# Common virt domain local policy
 #
 
-allow svirt_t self:udp_socket create_socket_perms;
+allow virt_domain self:process { signal getsched signull };
+allow virt_domain self:fifo_file rw_fifo_file_perms;
+allow virt_domain self:shm create_shm_perms;
+allow virt_domain self:unix_stream_socket { accept listen };
+allow virt_domain self:unix_dgram_socket sendto;
+allow virt_domain self:tcp_socket { accept listen };
 
-manage_dirs_pattern(svirt_t, svirt_cache_t, svirt_cache_t)
-manage_files_pattern(svirt_t, svirt_cache_t, svirt_cache_t)
-files_var_filetrans(svirt_t, svirt_cache_t, { file dir })
+allow virt_domain virtd_t:fd use;
+allow virt_domain virtd_t:fifo_file rw_fifo_file_perms;
+allow virt_domain virtd_t:process sigchld;
 
-read_lnk_files_pattern(svirt_t, virt_image_t, virt_image_t)
+dontaudit virt_domain virtd_t:unix_stream_socket { read write };
 
-allow svirt_t svirt_image_t:dir search_dir_perms;
-manage_dirs_pattern(svirt_t, svirt_image_t, svirt_image_t)
-manage_files_pattern(svirt_t, svirt_image_t, svirt_image_t)
-fs_hugetlbfs_filetrans(svirt_t, svirt_image_t, file)
+manage_dirs_pattern(virt_domain, svirt_cache_t, svirt_cache_t)
+manage_files_pattern(virt_domain, svirt_cache_t, svirt_cache_t)
+files_var_filetrans(virt_domain, svirt_cache_t, { file dir })
 
-list_dirs_pattern(svirt_t, virt_content_t, virt_content_t)
-read_files_pattern(svirt_t, virt_content_t, virt_content_t)
-dontaudit svirt_t virt_content_t:file write_file_perms;
-dontaudit svirt_t virt_content_t:dir write;
+manage_dirs_pattern(virt_domain, svirt_var_run_t, svirt_var_run_t)
+manage_files_pattern(virt_domain, svirt_var_run_t, svirt_var_run_t)
+manage_sock_files_pattern(virt_domain, svirt_var_run_t, svirt_var_run_t)
+manage_lnk_files_pattern(virt_domain, svirt_var_run_t, svirt_var_run_t)
+files_pid_filetrans(virt_domain, svirt_var_run_t, { dir file })
 
-corenet_udp_sendrecv_generic_if(svirt_t)
-corenet_udp_sendrecv_generic_node(svirt_t)
-corenet_udp_sendrecv_all_ports(svirt_t)
-corenet_udp_bind_generic_node(svirt_t)
-corenet_udp_bind_all_ports(svirt_t)
-corenet_tcp_bind_all_ports(svirt_t)
-corenet_tcp_connect_all_ports(svirt_t)
+stream_connect_pattern(virt_domain, svirt_var_run_t, svirt_var_run_t, virtd_t)
+
+dontaudit virt_domain virt_tmpfs_type:file { read write };
+
+append_files_pattern(virt_domain, virt_log_t, virt_log_t)
+
+append_files_pattern(virt_domain, virt_var_lib_t, virt_var_lib_t)
+
+kernel_read_system_state(virt_domain)
+
+fs_getattr_xattr_fs(virt_domain)
+
+corecmd_exec_bin(virt_domain)
+corecmd_exec_shell(virt_domain)
+
+corenet_all_recvfrom_unlabeled(virt_domain)
+corenet_all_recvfrom_netlabel(virt_domain)
+corenet_tcp_sendrecv_generic_if(virt_domain)
+corenet_tcp_sendrecv_generic_node(virt_domain)
+corenet_tcp_bind_generic_node(virt_domain)
+
+corenet_sendrecv_vnc_server_packets(virt_domain)
+corenet_tcp_bind_vnc_port(virt_domain)
+corenet_tcp_sendrecv_vnc_port(virt_domain)
+
+corenet_sendrecv_virt_migration_server_packets(virt_domain)
+corenet_tcp_bind_virt_migration_port(virt_domain)
+corenet_sendrecv_virt_migration_client_packets(virt_domain)
+corenet_tcp_connect_virt_migration_port(virt_domain)
+corenet_tcp_sendrecv_virt_migration_port(virt_domain)
+
+corenet_rw_tun_tap_dev(virt_domain)
+
+dev_getattr_fs(virt_domain)
+dev_list_sysfs(virt_domain)
+dev_read_generic_symlinks(virt_domain)
+dev_read_rand(virt_domain)
+dev_read_sound(virt_domain)
+dev_read_urand(virt_domain)
+dev_write_sound(virt_domain)
+dev_rw_ksm(virt_domain)
+dev_rw_kvm(virt_domain)
+dev_rw_qemu(virt_domain)
+dev_rw_vhost(virt_domain)
+
+domain_use_interactive_fds(virt_domain)
+
+files_read_mnt_symlinks(virt_domain)
+files_read_usr_files(virt_domain)
+files_read_var_files(virt_domain)
+files_search_all(virt_domain)
+
+fs_getattr_all_fs(virt_domain)
+fs_rw_anon_inodefs_files(virt_domain)
+fs_rw_tmpfs_files(virt_domain)
+fs_getattr_hugetlbfs(virt_domain)
+
+# fs_rw_inherited_nfs_files(virt_domain)
+# fs_rw_inherited_cifs_files(virt_domain)
+# fs_rw_inherited_noxattr_fs_files(virt_domain)
 
-dev_list_sysfs(svirt_t)
+storage_raw_write_removable_device(virt_domain)
+storage_raw_read_removable_device(virt_domain)
 
-userdom_search_user_home_content(svirt_t)
-userdom_read_user_home_content_symlinks(svirt_t)
-userdom_read_all_users_state(svirt_t)
+term_use_all_terms(virt_domain)
+term_getattr_pty_fs(virt_domain)
+term_use_generic_ptys(virt_domain)
+term_use_ptmx(virt_domain)
+
+logging_send_syslog_msg(virt_domain)
+
+miscfiles_read_localization(virt_domain)
+miscfiles_read_public_files(virt_domain)
+
+userdom_search_user_home_dirs(virt_domain)
+userdom_read_all_users_state(virt_domain)
+
+qemu_exec(virt_domain)
+
+tunable_policy(`virt_use_execmem',`
+	allow virt_domain self:process { execmem execstack };
+')
 
 tunable_policy(`virt_use_comm',`
-	term_use_unallocated_ttys(svirt_t)
-	dev_rw_printer(svirt_t)
+	term_use_unallocated_ttys(virt_domain)
+	dev_rw_printer(virt_domain)
 ')
 
 tunable_policy(`virt_use_fusefs',`
-	fs_read_fusefs_files(svirt_t)
-	fs_read_fusefs_symlinks(svirt_t)
+	fs_manage_fusefs_dirs(virt_domain)
+	fs_manage_fusefs_files(virt_domain)
+	fs_read_fusefs_symlinks(virt_domain)
 ')
 
 tunable_policy(`virt_use_nfs',`
-	fs_manage_nfs_dirs(svirt_t)
-	fs_manage_nfs_files(svirt_t)
-')
-
-tunable_policy(`virt_use_samba',`
-	fs_manage_cifs_dirs(svirt_t)
-	fs_manage_cifs_files(svirt_t)
+	fs_manage_nfs_dirs(virt_domain)
+	fs_manage_nfs_files(virt_domain)
+	fs_manage_nfs_named_sockets(virt_domain)
+	fs_read_nfs_symlinks(virt_domain)
 ')
 
 tunable_policy(`virt_use_sysfs',`
-	dev_rw_sysfs(svirt_t)
+	dev_rw_sysfs(virt_domain)
 ')
 
 tunable_policy(`virt_use_usb',`
-	dev_rw_usbfs(svirt_t)
-	fs_manage_dos_dirs(svirt_t)
-	fs_manage_dos_files(svirt_t)
+	dev_rw_usbfs(virt_domain)
+	dev_read_sysfs(virt_domain)
+	fs_manage_dos_dirs(virt_domain)
+	fs_manage_dos_files(virt_domain)
 ')
 
 optional_policy(`
-	xen_rw_image_files(svirt_t)
+	tunable_policy(`virt_use_samba',`
+		fs_manage_cifs_dirs(virt_domain)
+		fs_manage_cifs_files(virt_domain)
+		fs_manage_cifs_named_sockets(virt_domain)
+		fs_read_cifs_symlinks(virt_domain)
+		samba_domtrans_smbd(virt_domain)
+	')
+')
+
+optional_policy(`
+	tunable_policy(`virt_use_xserver',`
+		xserver_read_xdm_pid(virt_domain)
+		xserver_stream_connect(virt_domain)
+	')
+')
+
+optional_policy(`
+	dbus_read_lib_files(virt_domain)
+')
+
+optional_policy(`
+	virt_run_bridgehelper(virt_domain, virt_domain_roles)
+	virt_read_config(virt_domain)
+	virt_read_lib_files(virt_domain)
+	virt_read_content(virt_domain)
+	virt_stream_connect(virt_domain)
+')
+
+optional_policy(`
+	xen_rw_image_files(virt_domain)
 ')
 
 ########################################
 #
-# virtd local policy
+# svirt local policy
 #
 
-allow virtd_t self:capability { chown dac_override fowner ipc_lock kill mknod net_admin net_raw setpcap setuid setgid sys_admin sys_nice sys_ptrace };
-allow virtd_t self:process { getcap getsched setcap sigkill signal signull execmem setexec setfscreate setsched };
+read_lnk_files_pattern(svirt_t, virt_image_t, virt_image_t)
 
-allow virtd_t self:fifo_file rw_fifo_file_perms;
-allow virtd_t self:unix_stream_socket create_stream_socket_perms;
-allow virtd_t self:tcp_socket create_stream_socket_perms;
-allow virtd_t self:tun_socket create_socket_perms;
+manage_dirs_pattern(svirt_t, svirt_image_t, svirt_image_t)
+manage_files_pattern(svirt_t, svirt_image_t, svirt_image_t)
+manage_fifo_files_pattern(svirt_t, svirt_image_t, svirt_image_t)
+fs_hugetlbfs_filetrans(svirt_t, svirt_image_t, file)
+
+list_dirs_pattern(svirt_t, virt_content_t, virt_content_t)
+read_files_pattern(svirt_t, virt_content_t, virt_content_t)
+
+dontaudit svirt_t virt_content_t:file write_file_perms;
+dontaudit svirt_t virt_content_t:dir rw_dir_perms;
+
+append_files_pattern(svirt_t, virt_home_t, virt_home_t)
+manage_dirs_pattern(svirt_t, svirt_home_t, svirt_home_t)
+manage_files_pattern(svirt_t, svirt_home_t, svirt_home_t)
+manage_sock_files_pattern(svirt_t, svirt_home_t, svirt_home_t)
+
+filetrans_pattern(svirt_t, virt_home_t, svirt_home_t, dir, "qemu")
+
+stream_connect_pattern(svirt_t, svirt_home_t, svirt_home_t, virtd_t)
+
+corenet_udp_sendrecv_generic_if(svirt_t)
+corenet_udp_sendrecv_generic_node(svirt_t)
+corenet_udp_sendrecv_all_ports(svirt_t)
+corenet_udp_bind_generic_node(svirt_t)
+
+corenet_all_recvfrom_unlabeled(svirt_t)
+corenet_all_recvfrom_netlabel(svirt_t)
+corenet_tcp_sendrecv_generic_if(svirt_t)
+corenet_udp_sendrecv_generic_if(svirt_t)
+corenet_tcp_sendrecv_generic_node(svirt_t)
+corenet_udp_sendrecv_generic_node(svirt_t)
+corenet_tcp_sendrecv_all_ports(svirt_t)
+corenet_udp_sendrecv_all_ports(svirt_t)
+corenet_tcp_bind_generic_node(svirt_t)
+corenet_udp_bind_generic_node(svirt_t)
+
+corenet_sendrecv_all_server_packets(svirt_t)
+corenet_udp_bind_all_ports(svirt_t)
+corenet_tcp_bind_all_ports(svirt_t)
+
+corenet_sendrecv_all_client_packets(svirt_t)
+corenet_tcp_connect_all_ports(svirt_t)
+
+########################################
+#
+# virtd local policy
+#
+
+allow virtd_t self:capability { chown dac_override fowner ipc_lock kill mknod net_admin net_raw setpcap setuid setgid sys_admin sys_nice };
+allow virtd_t self:process { getcap getsched setcap sigkill signal signull execmem setexec setfscreate setsockcreate setsched };
+allow virtd_t self:fifo_file { manage_fifo_file_perms relabelfrom relabelto };
+allow virtd_t self:unix_stream_socket { accept connectto listen };
+allow virtd_t self:tcp_socket { accept listen };
+allow virtd_t self:tun_socket { create_socket_perms relabelfrom relabelto };
+allow virtd_t self:rawip_socket create_socket_perms;
+allow virtd_t self:packet_socket create_socket_perms;
 allow virtd_t self:netlink_kobject_uevent_socket create_socket_perms;
+allow virtd_t self:netlink_route_socket nlmsg_write;
+
+allow virtd_t virt_domain:process { getattr getsched setsched transition signal signull sigkill };
+dontaudit virtd_t virt_domain:process { siginh noatsecure rlimitinh };
+
+allow virtd_t svirt_lxc_domain:unix_stream_socket { create_stream_socket_perms connectto };
+allow virtd_t svirt_lxc_domain:process signal_perms;
+
+allow virtd_t virtd_lxc_t:process { signal signull sigkill };
+
+domtrans_pattern(virtd_t, virtd_lxc_exec_t, virtd_lxc_t)
 
 manage_dirs_pattern(virtd_t, svirt_cache_t, svirt_cache_t)
 manage_files_pattern(virtd_t, svirt_cache_t, svirt_cache_t)
 
 manage_dirs_pattern(virtd_t, virt_content_t, virt_content_t)
 manage_files_pattern(virtd_t, virt_content_t, virt_content_t)
+filetrans_pattern(virtd_t, virt_home_t, virt_content_t, dir, "isos")
 
-allow virtd_t virt_domain:process { getattr getsched setsched transition signal signull sigkill };
+allow virtd_t svirt_var_run_t:file relabel_file_perms;
+manage_dirs_pattern(virtd_t, svirt_var_run_t, svirt_var_run_t)
+manage_files_pattern(virtd_t, svirt_var_run_t, svirt_var_run_t)
+manage_sock_files_pattern(virtd_t, svirt_var_run_t, svirt_var_run_t)
+filetrans_pattern(virtd_t, virt_var_run_t, svirt_var_run_t, dir, "qemu")
 
 read_files_pattern(virtd_t, virt_etc_t, virt_etc_t)
 read_lnk_files_pattern(virtd_t, virt_etc_t, virt_etc_t)
@@ -201,19 +446,42 @@
 manage_lnk_files_pattern(virtd_t, virt_etc_rw_t, virt_etc_rw_t)
 filetrans_pattern(virtd_t, virt_etc_t, virt_etc_rw_t, dir)
 
+manage_dirs_pattern(virtd_t, virt_home_t, virt_home_t)
+manage_files_pattern(virtd_t, virt_home_t, virt_home_t)
+manage_sock_files_pattern(virtd_t, virt_home_t, virt_home_t)
+manage_lnk_files_pattern(virtd_t, virt_home_t, virt_home_t)
+
+userdom_user_home_dir_filetrans(virtd_t, virt_home_t, dir, ".libvirt")
+userdom_user_home_dir_filetrans(virtd_t, virt_home_t, dir, ".virtinst")
+userdom_user_home_dir_filetrans(virtd_t, virt_home_t, dir, "VirtualMachines")
+
 manage_files_pattern(virtd_t, virt_image_type, virt_image_type)
+manage_chr_files_pattern(virtd_t, virt_image_type, virt_image_type)
 manage_blk_files_pattern(virtd_t, virt_image_type, virt_image_type)
-allow virtd_t virt_image_type:file { relabelfrom relabelto };
-allow virtd_t virt_image_type:blk_file { relabelfrom relabelto };
+manage_lnk_files_pattern(virtd_t, virt_image_type, virt_image_type)
 
-manage_dirs_pattern(virtd_t, virt_log_t, virt_log_t)
-manage_files_pattern(virtd_t, virt_log_t, virt_log_t)
-logging_log_filetrans(virtd_t, virt_log_t, { file dir })
+allow virtd_t virt_image_type:file relabel_file_perms;
+allow virtd_t virt_image_type:blk_file relabel_blk_file_perms;
+allow virtd_t virt_image_type:chr_file relabel_chr_file_perms;
+allow virtd_t virt_image_type:chr_file relabel_chr_file_perms;
+
+allow virtd_t virt_ptynode:chr_file rw_term_perms;
 
 manage_dirs_pattern(virtd_t, virt_tmp_t, virt_tmp_t)
 manage_files_pattern(virtd_t, virt_tmp_t, virt_tmp_t)
 files_tmp_filetrans(virtd_t, virt_tmp_t, { file dir })
-can_exec(virtd_t, virt_tmp_t)
+
+# This needs a file context specification
+manage_dirs_pattern(virtd_t, virt_lock_t, virt_lock_t)
+manage_files_pattern(virtd_t, virt_lock_t, virt_lock_t)
+manage_lnk_files_pattern(virtd_t, virt_lock_t, virt_lock_t)
+files_lock_filetrans(virtd_t, virt_lock_t, { dir file lnk_file })
+
+manage_dirs_pattern(virtd_t, virt_log_t, virt_log_t)
+append_files_pattern(virtd_t, virt_log_t, virt_log_t)
+create_files_pattern(virtd_t, virt_log_t, virt_log_t)
+setattr_files_pattern(virtd_t, virt_log_t, virt_log_t)
+logging_log_filetrans(virtd_t, virt_log_t, { file dir })
 
 manage_dirs_pattern(virtd_t, virt_var_lib_t, virt_var_lib_t)
 manage_files_pattern(virtd_t, virt_var_lib_t, virt_var_lib_t)
@@ -225,51 +493,89 @@
 manage_sock_files_pattern(virtd_t, virt_var_run_t, virt_var_run_t)
 files_pid_filetrans(virtd_t, virt_var_run_t, { file dir })
 
+manage_dirs_pattern(virtd_t, virtd_lxc_var_run_t, virtd_lxc_var_run_t)
+manage_files_pattern(virtd_t, virtd_lxc_var_run_t, virtd_lxc_var_run_t)
+filetrans_pattern(virtd_t, virt_var_run_t, virtd_lxc_var_run_t, dir, "lxc")
+
+stream_connect_pattern(virtd_t, virtd_lxc_var_run_t, virtd_lxc_var_run_t, virtd_lxc_t)
+stream_connect_pattern(virtd_t, svirt_var_run_t, svirt_var_run_t, virt_domain)
+
+can_exec(virtd_t, virt_tmp_t)
+
 kernel_read_system_state(virtd_t)
 kernel_read_network_state(virtd_t)
 kernel_rw_net_sysctls(virtd_t)
+kernel_read_kernel_sysctls(virtd_t)
 kernel_request_load_module(virtd_t)
 kernel_search_debugfs(virtd_t)
+kernel_setsched(virtd_t)
 
 corecmd_exec_bin(virtd_t)
 corecmd_exec_shell(virtd_t)
 
-corenet_all_recvfrom_unlabeled(virtd_t)
 corenet_all_recvfrom_netlabel(virtd_t)
 corenet_tcp_sendrecv_generic_if(virtd_t)
 corenet_tcp_sendrecv_generic_node(virtd_t)
-corenet_tcp_sendrecv_all_ports(virtd_t)
 corenet_tcp_bind_generic_node(virtd_t)
+
+corenet_sendrecv_virt_server_packets(virtd_t)
 corenet_tcp_bind_virt_port(virtd_t)
+corenet_tcp_sendrecv_virt_port(virtd_t)
+
+corenet_sendrecv_vnc_server_packets(virtd_t)
 corenet_tcp_bind_vnc_port(virtd_t)
+corenet_sendrecv_vnc_client_packets(virtd_t)
 corenet_tcp_connect_vnc_port(virtd_t)
+corenet_tcp_sendrecv_vnc_port(virtd_t)
+
+corenet_sendrecv_soundd_client_packets(virtd_t)
 corenet_tcp_connect_soundd_port(virtd_t)
+corenet_tcp_sendrecv_soundd_port(virtd_t)
+
 corenet_rw_tun_tap_dev(virtd_t)
 
 dev_rw_sysfs(virtd_t)
+dev_read_urand(virtd_t)
 dev_read_rand(virtd_t)
 dev_rw_kvm(virtd_t)
 dev_getattr_all_chr_files(virtd_t)
 dev_rw_mtrr(virtd_t)
+dev_rw_vhost(virtd_t)
+dev_setattr_generic_usb_dev(virtd_t)
+dev_relabel_generic_usb_dev(virtd_t)
 
-# Init script handling
 domain_use_interactive_fds(virtd_t)
 domain_read_all_domains_state(virtd_t)
 
 files_read_usr_files(virtd_t)
-files_read_etc_files(virtd_t)
 files_read_etc_runtime_files(virtd_t)
 files_search_all(virtd_t)
 files_read_kernel_modules(virtd_t)
 files_read_usr_src_files(virtd_t)
-files_manage_etc_files(virtd_t)
+
+# Manages /etc/sysconfig/system-config-firewall
+# files_relabelto_system_conf_files(virtd_t)
+# files_relabelfrom_system_conf_files(virtd_t)
+# files_manage_system_conf_files(virtd_t)
 
 fs_list_auto_mountpoints(virtd_t)
-fs_getattr_xattr_fs(virtd_t)
+fs_getattr_all_fs(virtd_t)
 fs_rw_anon_inodefs_files(virtd_t)
 fs_list_inotifyfs(virtd_t)
 fs_manage_cgroup_dirs(virtd_t)
 fs_rw_cgroup_files(virtd_t)
+fs_manage_hugetlbfs_dirs(virtd_t)
+fs_rw_hugetlbfs_files(virtd_t)
+
+mls_fd_share_all_levels(virtd_t)
+mls_file_read_to_clearance(virtd_t)
+mls_file_write_to_clearance(virtd_t)
+mls_process_read_to_clearance(virtd_t)
+mls_process_write_to_clearance(virtd_t)
+mls_net_write_within_range(virtd_t)
+mls_socket_write_to_clearance(virtd_t)
+mls_socket_read_to_clearance(virtd_t)
+mls_rangetrans_source(virtd_t)
 
 mcs_process_set_categories(virtd_t)
 
@@ -289,21 +595,32 @@
 miscfiles_read_hwdata(virtd_t)
 
 modutils_read_module_deps(virtd_t)
-modutils_read_module_config(virtd_t)
 modutils_manage_module_config(virtd_t)
 
 logging_send_syslog_msg(virtd_t)
+logging_send_audit_msgs(virtd_t)
+
+selinux_validate_context(virtd_t)
 
 seutil_read_config(virtd_t)
 seutil_read_default_contexts(virtd_t)
+seutil_read_file_contexts(virtd_t)
 
+sysnet_signull_ifconfig(virtd_t)
+sysnet_signal_ifconfig(virtd_t)
 sysnet_domtrans_ifconfig(virtd_t)
-sysnet_read_config(virtd_t)
 
-userdom_getattr_all_users(virtd_t)
-userdom_list_user_home_content(virtd_t)
 userdom_read_all_users_state(virtd_t)
-userdom_read_user_home_content_files(virtd_t)
+
+ifdef(`hide_broken_symptoms',`
+	dontaudit virtd_t self:capability { sys_module sys_ptrace };
+')
+
+tunable_policy(`virt_use_fusefs',`
+	fs_manage_fusefs_dirs(virtd_t)
+	fs_manage_fusefs_files(virtd_t)
+	fs_read_fusefs_symlinks(virtd_t)
+')
 
 tunable_policy(`virt_use_nfs',`
 	fs_manage_nfs_dirs(virtd_t)
@@ -312,7 +629,7 @@
 ')
 
 tunable_policy(`virt_use_samba',`
-	fs_manage_nfs_files(virtd_t)
+	fs_manage_cifs_files(virtd_t)
 	fs_manage_cifs_files(virtd_t)
 	fs_read_cifs_symlinks(virtd_t)
 ')
@@ -322,6 +639,10 @@
 ')
 
 optional_policy(`
+	consoletype_exec(virtd_t)
+')
+
+optional_policy(`
 	dbus_system_bus_client(virtd_t)
 
 	optional_policy(`
@@ -333,23 +654,40 @@
 	')
 
 	optional_policy(`
+		firewalld_dbus_chat(virtd_t)
+	')
+
+	optional_policy(`
 		hal_dbus_chat(virtd_t)
 	')
+
+	optional_policy(`
+		networkmanager_dbus_chat(virtd_t)
+	')
+
+	optional_policy(`
+		policykit_dbus_chat(virtd_t)
+	')
+')
+
+optional_policy(`
+	dmidecode_domtrans(virtd_t)
 ')
 
 optional_policy(`
 	dnsmasq_domtrans(virtd_t)
 	dnsmasq_signal(virtd_t)
 	dnsmasq_kill(virtd_t)
-	dnsmasq_read_pid_files(virtd_t)
 	dnsmasq_signull(virtd_t)
+	dnsmasq_create_pid_dirs(virtd_t)
+	dnsmasq_spec_filetrans_pid(virtd_t, virt_var_run_t, dir, "network")
+	dnsmasq_spec_filetrans_pid(virtd_t, virt_var_run_t, file, "dnsmasq.pid")
+	dnsmasq_manage_pid_files(virtd_t)
 ')
 
 optional_policy(`
 	iptables_domtrans(virtd_t)
 	iptables_initrc_domtrans(virtd_t)
-
-	# Manages /etc/sysconfig/system-config-firewall
 	iptables_manage_config(virtd_t)
 ')
 
@@ -362,18 +700,18 @@
 ')
 
 optional_policy(`
-	policykit_dbus_chat(virtd_t)
+	mount_domtrans(virtd_t)
+	mount_signal(virtd_t)
+')
+
+optional_policy(`
 	policykit_domtrans_auth(virtd_t)
 	policykit_domtrans_resolve(virtd_t)
 	policykit_read_lib(virtd_t)
 ')
 
 optional_policy(`
-	qemu_domtrans(virtd_t)
-	qemu_read_state(virtd_t)
-	qemu_signal(virtd_t)
-	qemu_kill(virtd_t)
-	qemu_setsched(virtd_t)
+	qemu_exec(virtd_t)
 ')
 
 optional_policy(`
@@ -384,6 +722,7 @@
 	kernel_read_xen_state(virtd_t)
 	kernel_write_xen_state(virtd_t)
 
+	xen_exec(virtd_t)
 	xen_stream_connect(virtd_t)
 	xen_stream_connect_xenstore(virtd_t)
 	xen_read_image_files(virtd_t)
@@ -394,78 +733,465 @@
 	udev_read_db(virtd_t)
 ')
 
+########################################
+#
+# Virsh local policy
+#
+
+allow virsh_t self:capability { setpcap dac_override ipc_lock sys_nice sys_tty_config };
+allow virsh_t self:process { getcap getsched setsched setcap signal };
+allow virsh_t self:fifo_file rw_fifo_file_perms;
+allow virsh_t self:unix_stream_socket { accept connectto listen };
+allow virsh_t self:tcp_socket { accept listen };
+
+manage_files_pattern(virsh_t, virt_image_type, virt_image_type)
+manage_blk_files_pattern(virsh_t, virt_image_type, virt_image_type)
+manage_lnk_files_pattern(virsh_t, virt_image_type, virt_image_type)
+
+manage_dirs_pattern(virsh_t, svirt_lxc_file_t, svirt_lxc_file_t)
+manage_files_pattern(virsh_t, svirt_lxc_file_t, svirt_lxc_file_t)
+manage_chr_files_pattern(virsh_t, svirt_lxc_file_t, svirt_lxc_file_t)
+manage_lnk_files_pattern(virsh_t, svirt_lxc_file_t, svirt_lxc_file_t)
+manage_sock_files_pattern(virsh_t, svirt_lxc_file_t, svirt_lxc_file_t)
+manage_fifo_files_pattern(virsh_t, svirt_lxc_file_t, svirt_lxc_file_t)
+
+manage_dirs_pattern(virsh_t, virtd_lxc_var_run_t, virtd_lxc_var_run_t)
+manage_files_pattern(virsh_t, virtd_lxc_var_run_t, virtd_lxc_var_run_t)
+filetrans_pattern(virsh_t, virt_var_run_t, virtd_lxc_var_run_t, dir, "lxc")
+
+dontaudit virsh_t virt_var_lib_t:file read_file_perms;
+
+allow virsh_t svirt_lxc_domain:process transition;
+
+can_exec(virsh_t, virsh_exec_t)
+
+virt_domtrans(virsh_t)
+virt_manage_images(virsh_t)
+virt_manage_config(virsh_t)
+virt_stream_connect(virsh_t)
+
+kernel_read_system_state(virsh_t)
+kernel_read_network_state(virsh_t)
+kernel_read_kernel_sysctls(virsh_t)
+kernel_read_sysctl(virsh_t)
+kernel_read_xen_state(virsh_t)
+kernel_write_xen_state(virsh_t)
+
+corecmd_exec_bin(virsh_t)
+corecmd_exec_shell(virsh_t)
+
+corenet_all_recvfrom_unlabeled(virsh_t)
+corenet_all_recvfrom_netlabel(virsh_t)
+corenet_tcp_sendrecv_generic_if(virsh_t)
+corenet_tcp_sendrecv_generic_node(virsh_t)
+corenet_tcp_bind_generic_node(virsh_t)
+
+corenet_sendrecv_soundd_client_packets(virsh_t)
+corenet_tcp_connect_soundd_port(virsh_t)
+corenet_tcp_sendrecv_soundd_port(virsh_t)
+
+dev_read_rand(virsh_t)
+dev_read_urand(virsh_t)
+dev_read_sysfs(virsh_t)
+
+files_read_etc_runtime_files(virsh_t)
+files_read_etc_files(virsh_t)
+files_read_usr_files(virsh_t)
+files_list_mnt(virsh_t)
+files_list_tmp(virsh_t)
+
+fs_getattr_all_fs(virsh_t)
+fs_manage_xenfs_dirs(virsh_t)
+fs_manage_xenfs_files(virsh_t)
+fs_search_auto_mountpoints(virsh_t)
+
+storage_raw_read_fixed_disk(virsh_t)
+
+term_use_all_terms(virsh_t)
+
+init_stream_connect_script(virsh_t)
+init_rw_script_stream_sockets(virsh_t)
+init_use_fds(virsh_t)
+
+logging_send_syslog_msg(virsh_t)
+
+miscfiles_read_localization(virsh_t)
+
+sysnet_dns_name_resolve(virsh_t)
+
+tunable_policy(`virt_use_fusefs',`
+	fs_manage_fusefs_dirs(virsh_t)
+	fs_manage_fusefs_files(virsh_t)
+	fs_read_fusefs_symlinks(virsh_t)
+')
+
+tunable_policy(`virt_use_nfs',`
+	fs_manage_nfs_dirs(virsh_t)
+	fs_manage_nfs_files(virsh_t)
+	fs_read_nfs_symlinks(virsh_t)
+')
+
+tunable_policy(`virt_use_samba',`
+	fs_manage_cifs_files(virsh_t)
+	fs_manage_cifs_files(virsh_t)
+	fs_read_cifs_symlinks(virsh_t)
+')
+
+optional_policy(`
+	cron_system_entry(virsh_t, virsh_exec_t)
+')
+
 optional_policy(`
-	unconfined_domain(virtd_t)
+	rpm_exec(virsh_t)
+')
+
+optional_policy(`
+	xen_manage_image_dirs(virsh_t)
+	xen_append_log(virsh_t)
+	xen_domtrans(virsh_t)
+	xen_read_xenstored_pid_files(virsh_t)
+	xen_stream_connect(virsh_t)
+	xen_stream_connect_xenstore(virsh_t)
+')
+
+optional_policy(`
+	dbus_system_bus_client(virsh_t)
+
+	optional_policy(`
+		hal_dbus_chat(virsh_t)
+	')
+')
+
+optional_policy(`
+	vhostmd_rw_tmpfs_files(virsh_t)
+	vhostmd_stream_connect(virsh_t)
+	vhostmd_dontaudit_rw_stream_connect(virsh_t)
+')
+
+optional_policy(`
+	ssh_basic_client_template(virsh, virsh_t, system_r)
+
+	kernel_read_xen_state(virsh_ssh_t)
+	kernel_write_xen_state(virsh_ssh_t)
+
+	files_search_tmp(virsh_ssh_t)
+
+	fs_manage_xenfs_dirs(virsh_ssh_t)
+	fs_manage_xenfs_files(virsh_ssh_t)
 ')
 
 ########################################
 #
-# virtual domains common policy
+# Lxc local policy
 #
 
-allow virt_domain self:capability { dac_read_search dac_override kill };
-allow virt_domain self:process { execmem execstack signal getsched signull };
-allow virt_domain self:fifo_file rw_file_perms;
-allow virt_domain self:shm create_shm_perms;
-allow virt_domain self:unix_stream_socket create_stream_socket_perms;
-allow virt_domain self:unix_dgram_socket { create_socket_perms sendto };
-allow virt_domain self:tcp_socket create_stream_socket_perms;
+allow virtd_lxc_t self:capability { dac_override net_admin net_raw setpcap chown sys_admin sys_boot sys_resource };
+allow virtd_lxc_t self:process { setexec setrlimit setsched getcap setcap signal_perms };
+allow virtd_lxc_t self:fifo_file rw_fifo_file_perms;
+allow virtd_lxc_t self:netlink_route_socket nlmsg_write;
+allow virtd_lxc_t self:unix_stream_socket { accept listen };
+allow virtd_lxc_t self:packet_socket create_socket_perms;
+
+allow virtd_lxc_t svirt_lxc_domain:process { getattr getsched setsched transition signal signull sigkill };
+
+allow virtd_lxc_t virt_image_type:dir mounton;
+manage_files_pattern(virtd_lxc_t, virt_image_t, virt_image_t)
+
+allow virtd_lxc_t virt_var_run_t:dir search_dir_perms;
+manage_dirs_pattern(virtd_lxc_t, virtd_lxc_var_run_t, virtd_lxc_var_run_t)
+manage_files_pattern(virtd_lxc_t, virtd_lxc_var_run_t, virtd_lxc_var_run_t)
+manage_sock_files_pattern(virtd_lxc_t, virtd_lxc_var_run_t, virtd_lxc_var_run_t)
+files_pid_filetrans(virtd_lxc_t, virtd_lxc_var_run_t, { file dir })
+
+manage_dirs_pattern(virtd_lxc_t, svirt_lxc_file_t, svirt_lxc_file_t)
+manage_files_pattern(virtd_lxc_t, svirt_lxc_file_t, svirt_lxc_file_t)
+manage_chr_files_pattern(virtd_lxc_t, svirt_lxc_file_t, svirt_lxc_file_t)
+manage_lnk_files_pattern(virtd_lxc_t, svirt_lxc_file_t, svirt_lxc_file_t)
+manage_sock_files_pattern(virtd_lxc_t, svirt_lxc_file_t, svirt_lxc_file_t)
+manage_fifo_files_pattern(virtd_lxc_t, svirt_lxc_file_t, svirt_lxc_file_t)
+allow virtd_lxc_t svirt_lxc_file_t:dir_file_class_set { relabelto relabelfrom };
+allow virtd_lxc_t svirt_lxc_file_t:filesystem { relabelto relabelfrom };
+
+storage_manage_fixed_disk(virtd_lxc_t)
+
+kernel_read_all_sysctls(virtd_lxc_t)
+kernel_read_network_state(virtd_lxc_t)
+kernel_read_system_state(virtd_lxc_t)
+
+corecmd_exec_bin(virtd_lxc_t)
+corecmd_exec_shell(virtd_lxc_t)
+
+dev_relabel_all_dev_nodes(virtd_lxc_t)
+dev_rw_sysfs(virtd_lxc_t)
+dev_read_sysfs(virtd_lxc_t)
+dev_read_urand(virtd_lxc_t)
+
+domain_use_interactive_fds(virtd_lxc_t)
+
+files_associate_rootfs(svirt_lxc_file_t)
+files_search_all(virtd_lxc_t)
+files_getattr_all_files(virtd_lxc_t)
+files_read_usr_files(virtd_lxc_t)
+files_relabel_rootfs(virtd_lxc_t)
+files_mounton_non_security(virtd_lxc_t)
+files_mount_all_file_type_fs(virtd_lxc_t)
+files_unmount_all_file_type_fs(virtd_lxc_t)
+files_list_isid_type_dirs(virtd_lxc_t)
+files_root_filetrans(virtd_lxc_t, svirt_lxc_file_t, dir_file_class_set)
+
+fs_getattr_all_fs(virtd_lxc_t)
+fs_manage_tmpfs_dirs(virtd_lxc_t)
+fs_manage_tmpfs_chr_files(virtd_lxc_t)
+fs_manage_tmpfs_symlinks(virtd_lxc_t)
+fs_manage_cgroup_dirs(virtd_lxc_t)
+fs_mounton_tmpfs(virtd_lxc_t)
+fs_remount_all_fs(virtd_lxc_t)
+fs_rw_cgroup_files(virtd_lxc_t)
+fs_unmount_all_fs(virtd_lxc_t)
+fs_relabelfrom_tmpfs(virtd_lxc_t)
+
+selinux_mount_fs(virtd_lxc_t)
+selinux_unmount_fs(virtd_lxc_t)
+selinux_get_enforce_mode(virtd_lxc_t)
+selinux_get_fs_mount(virtd_lxc_t)
+selinux_validate_context(virtd_lxc_t)
+selinux_compute_access_vector(virtd_lxc_t)
+selinux_compute_create_context(virtd_lxc_t)
+selinux_compute_relabel_context(virtd_lxc_t)
+selinux_compute_user_contexts(virtd_lxc_t)
+
+term_use_generic_ptys(virtd_lxc_t)
+term_use_ptmx(virtd_lxc_t)
+term_relabel_pty_fs(virtd_lxc_t)
+
+auth_use_nsswitch(virtd_lxc_t)
+
+logging_send_syslog_msg(virtd_lxc_t)
+
+miscfiles_read_localization(virtd_lxc_t)
+
+seutil_domtrans_setfiles(virtd_lxc_t)
+seutil_read_config(virtd_lxc_t)
+seutil_read_default_contexts(virtd_lxc_t)
 
-append_files_pattern(virt_domain, virt_log_t, virt_log_t)
+sysnet_domtrans_ifconfig(virtd_lxc_t)
 
-append_files_pattern(virt_domain, virt_var_lib_t, virt_var_lib_t)
+########################################
+#
+# Common virt lxc domain local policy
+#
 
-kernel_read_system_state(virt_domain)
+allow svirt_lxc_domain self:capability { kill setuid setgid dac_override sys_boot };
+allow svirt_lxc_domain self:process { execstack execmem getattr signal_perms getsched setsched setcap setpgid };
+allow svirt_lxc_domain self:fifo_file manage_file_perms;
+allow svirt_lxc_domain self:sem create_sem_perms;
+allow svirt_lxc_domain self:shm create_shm_perms;
+allow svirt_lxc_domain self:msgq create_msgq_perms;
+allow svirt_lxc_domain self:unix_stream_socket { create_stream_socket_perms connectto };
+allow svirt_lxc_domain self:unix_dgram_socket { sendto create_socket_perms };
+
+allow svirt_lxc_domain virtd_lxc_t:fd use;
+allow svirt_lxc_domain virtd_lxc_t:fifo_file rw_fifo_file_perms;
+allow svirt_lxc_domain virtd_lxc_t:process sigchld;
+
+allow svirt_lxc_domain virtd_lxc_t:unix_stream_socket { connectto rw_socket_perms };
+
+allow svirt_lxc_domain virsh_t:fd use;
+allow svirt_lxc_domain virsh_t:fifo_file rw_fifo_file_perms;
+allow svirt_lxc_domain virsh_t:process sigchld;
+
+allow svirt_lxc_domain virtd_lxc_var_run_t:dir list_dir_perms;
+allow svirt_lxc_domain virtd_lxc_var_run_t:file read_file_perms;
+
+manage_dirs_pattern(svirt_lxc_domain, svirt_lxc_file_t, svirt_lxc_file_t)
+manage_files_pattern(svirt_lxc_domain, svirt_lxc_file_t, svirt_lxc_file_t)
+manage_lnk_files_pattern(svirt_lxc_domain, svirt_lxc_file_t, svirt_lxc_file_t)
+manage_sock_files_pattern(svirt_lxc_domain, svirt_lxc_file_t, svirt_lxc_file_t)
+manage_fifo_files_pattern(svirt_lxc_domain, svirt_lxc_file_t, svirt_lxc_file_t)
+rw_chr_files_pattern(svirt_lxc_domain, svirt_lxc_file_t, svirt_lxc_file_t)
+rw_blk_files_pattern(svirt_lxc_domain, svirt_lxc_file_t, svirt_lxc_file_t)
+
+allow svirt_lxc_net_t svirt_lxc_file_t:dir mounton;
+allow svirt_lxc_net_t svirt_lxc_file_t:filesystem getattr;
+
+can_exec(svirt_lxc_domain, svirt_lxc_file_t)
+
+kernel_getattr_proc(svirt_lxc_domain)
+kernel_list_all_proc(svirt_lxc_domain)
+kernel_read_kernel_sysctls(svirt_lxc_domain)
+kernel_rw_net_sysctls(svirt_lxc_domain)
+kernel_read_system_state(svirt_lxc_domain)
+kernel_dontaudit_search_kernel_sysctl(svirt_lxc_domain)
+
+corecmd_exec_all_executables(svirt_lxc_domain)
+
+files_read_kernel_modules(svirt_lxc_net_t)
+files_dontaudit_getattr_all_dirs(svirt_lxc_domain)
+files_dontaudit_getattr_all_files(svirt_lxc_domain)
+files_dontaudit_getattr_all_symlinks(svirt_lxc_domain)
+files_dontaudit_getattr_all_pipes(svirt_lxc_domain)
+files_dontaudit_getattr_all_sockets(svirt_lxc_domain)
+files_dontaudit_list_all_mountpoints(svirt_lxc_domain)
+files_dontaudit_write_etc_runtime_files(svirt_lxc_domain)
+# files_entrypoint_all_files(svirt_lxc_domain)
+files_list_var(svirt_lxc_domain)
+files_list_var_lib(svirt_lxc_domain)
+files_search_all(svirt_lxc_domain)
+files_read_config_files(svirt_lxc_domain)
+files_read_usr_files(svirt_lxc_domain)
+files_read_usr_symlinks(svirt_lxc_domain)
+
+fs_getattr_all_fs(svirt_lxc_domain)
+fs_list_inotifyfs(svirt_lxc_domain)
+
+# fs_rw_inherited_tmpfs_files(svirt_lxc_domain)
+# fs_rw_inherited_cifs_files(svirt_lxc_domain)
+# fs_rw_inherited_noxattr_fs_files(svirt_lxc_domain)
+
+auth_dontaudit_read_login_records(svirt_lxc_domain)
+auth_dontaudit_write_login_records(svirt_lxc_domain)
+auth_search_pam_console_data(svirt_lxc_domain)
+
+clock_read_adjtime(svirt_lxc_domain)
+
+init_read_utmp(svirt_lxc_domain)
+init_dontaudit_write_utmp(svirt_lxc_domain)
+
+libs_dontaudit_setattr_lib_files(svirt_lxc_domain)
+
+miscfiles_read_localization(svirt_lxc_domain)
+miscfiles_dontaudit_setattr_fonts_cache_dirs(svirt_lxc_domain)
+miscfiles_read_fonts(svirt_lxc_domain)
 
-corecmd_exec_bin(virt_domain)
-corecmd_exec_shell(virt_domain)
+mta_dontaudit_read_spool_symlinks(svirt_lxc_domain)
 
-corenet_all_recvfrom_unlabeled(virt_domain)
-corenet_all_recvfrom_netlabel(virt_domain)
-corenet_tcp_sendrecv_generic_if(virt_domain)
-corenet_tcp_sendrecv_generic_node(virt_domain)
-corenet_tcp_sendrecv_all_ports(virt_domain)
-corenet_tcp_bind_generic_node(virt_domain)
-corenet_tcp_bind_vnc_port(virt_domain)
-corenet_rw_tun_tap_dev(virt_domain)
-corenet_tcp_bind_virt_migration_port(virt_domain)
-corenet_tcp_connect_virt_migration_port(virt_domain)
+optional_policy(`
+	udev_read_pid_files(svirt_lxc_domain)
+')
 
-dev_read_rand(virt_domain)
-dev_read_sound(virt_domain)
-dev_read_urand(virt_domain)
-dev_write_sound(virt_domain)
-dev_rw_ksm(virt_domain)
-dev_rw_kvm(virt_domain)
-dev_rw_qemu(virt_domain)
+optional_policy(`
+	apache_exec_modules(svirt_lxc_domain)
+	apache_read_sys_content(svirt_lxc_domain)
+')
 
-domain_use_interactive_fds(virt_domain)
+########################################
+#
+# Lxc net local policy
+#
 
-files_read_etc_files(virt_domain)
-files_read_usr_files(virt_domain)
-files_read_var_files(virt_domain)
-files_search_all(virt_domain)
+allow svirt_lxc_net_t self:capability { chown dac_read_search dac_override fowner fsetid net_raw net_admin net_bind_service sys_admin sys_nice sys_ptrace sys_resource setpcap };
+dontaudit svirt_lxc_net_t self:capability2 block_suspend;
+allow svirt_lxc_net_t self:process setrlimit;
+allow svirt_lxc_net_t self:tcp_socket { accept listen };
+allow svirt_lxc_net_t self:netlink_route_socket nlmsg_write;
+allow svirt_lxc_net_t self:packet_socket create_socket_perms;
+allow svirt_lxc_net_t self:socket create_socket_perms;
+allow svirt_lxc_net_t self:rawip_socket create_socket_perms;
+allow svirt_lxc_net_t self:netlink_tcpdiag_socket create_socket_perms;
+allow svirt_lxc_net_t self:netlink_kobject_uevent_socket create_socket_perms;
+
+kernel_read_network_state(svirt_lxc_net_t)
+kernel_read_irq_sysctls(svirt_lxc_net_t)
+
+corenet_all_recvfrom_unlabeled(svirt_lxc_net_t)
+corenet_all_recvfrom_netlabel(svirt_lxc_net_t)
+corenet_tcp_sendrecv_generic_if(svirt_lxc_net_t)
+corenet_udp_sendrecv_generic_if(svirt_lxc_net_t)
+corenet_tcp_sendrecv_generic_node(svirt_lxc_net_t)
+corenet_udp_sendrecv_generic_node(svirt_lxc_net_t)
+corenet_tcp_sendrecv_all_ports(svirt_lxc_net_t)
+corenet_udp_sendrecv_all_ports(svirt_lxc_net_t)
+corenet_tcp_bind_generic_node(svirt_lxc_net_t)
+corenet_udp_bind_generic_node(svirt_lxc_net_t)
+
+corenet_sendrecv_all_server_packets(svirt_lxc_net_t)
+corenet_udp_bind_all_ports(svirt_lxc_net_t)
+corenet_tcp_bind_all_ports(svirt_lxc_net_t)
+
+corenet_sendrecv_all_client_packets(svirt_lxc_net_t)
+corenet_tcp_connect_all_ports(svirt_lxc_net_t)
+
+dev_read_sysfs(svirt_lxc_net_t)
+dev_getattr_mtrr_dev(svirt_lxc_net_t)
+
+fs_noxattr_type(svirt_lxc_file_t)
+
+term_pty(svirt_lxc_file_t)
+
+auth_use_nsswitch(svirt_lxc_net_t)
+
+logging_send_audit_msgs(svirt_lxc_net_t)
+
+userdom_use_user_ptys(svirt_lxc_net_t)
+
+fs_mount_cgroup(svirt_lxc_net_t)
+fs_manage_cgroup_dirs(svirt_lxc_net_t)
+fs_rw_cgroup_files(svirt_lxc_net_t)
 
-fs_getattr_tmpfs(virt_domain)
-fs_rw_anon_inodefs_files(virt_domain)
-fs_rw_tmpfs_files(virt_domain)
+optional_policy(`
+	rpm_read_db(svirt_lxc_net_t)
+')
 
-term_use_all_terms(virt_domain)
-term_getattr_pty_fs(virt_domain)
-term_use_generic_ptys(virt_domain)
-term_use_ptmx(virt_domain)
+#######################################
+#
+# Prot exec local policy
+#
 
-logging_send_syslog_msg(virt_domain)
+allow svirt_prot_exec_t self:process { execmem execstack };
 
-miscfiles_read_localization(virt_domain)
+########################################
+#
+# Qmf local policy
+#
+
+allow virt_qmf_t self:capability { sys_nice sys_tty_config };
+allow virt_qmf_t self:process { setsched signal };
+allow virt_qmf_t self:fifo_file rw_fifo_file_perms;
+allow virt_qmf_t self:unix_stream_socket { accept listen };
+allow virt_qmf_t self:tcp_socket create_stream_socket_perms;
+allow virt_qmf_t self:netlink_route_socket create_netlink_socket_perms;
+
+can_exec(virt_qmf_t, virtd_exec_t)
+
+kernel_read_system_state(virt_qmf_t)
+kernel_read_network_state(virt_qmf_t)
+
+dev_read_sysfs(virt_qmf_t)
+dev_read_rand(virt_qmf_t)
+dev_read_urand(virt_qmf_t)
+
+domain_use_interactive_fds(virt_qmf_t)
+
+logging_send_syslog_msg(virt_qmf_t)
+
+miscfiles_read_localization(virt_qmf_t)
+
+sysnet_read_config(virt_qmf_t)
 
 optional_policy(`
-	ptchown_domtrans(virt_domain)
+	dbus_read_lib_files(virt_qmf_t)
 ')
 
 optional_policy(`
-	virt_read_config(virt_domain)
-	virt_read_lib_files(virt_domain)
-	virt_read_content(virt_domain)
-	virt_stream_connect(virt_domain)
+	virt_stream_connect(virt_qmf_t)
 ')
+
+########################################
+#
+# Bridgehelper local policy
+#
+
+allow virt_bridgehelper_t self:process { setcap getcap };
+allow virt_bridgehelper_t self:capability { setpcap setgid setuid net_admin };
+allow virt_bridgehelper_t self:tcp_socket create_stream_socket_perms;
+allow virt_bridgehelper_t self:tun_socket create_socket_perms;
+allow virt_bridgehelper_t self:unix_dgram_socket create_socket_perms;
+
+manage_files_pattern(virt_bridgehelper_t, svirt_home_t, svirt_home_t)
+
+kernel_read_network_state(virt_bridgehelper_t)
+
+corenet_rw_tun_tap_dev(virt_bridgehelper_t)
+
+userdom_search_user_home_dirs(virt_bridgehelper_t)
+userdom_use_user_ptys(virt_bridgehelper_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/vlock.fc refpolicy/policy/modules/contrib/vlock.fc
--- refpolicy/policy/modules/contrib/vlock.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/vlock.fc	2012-10-31 19:04:21.086580375 +0100
@@ -1 +1,3 @@
+/usr/bin/vlock	--	gen_context(system_u:object_r:vlock_exec_t,s0)
+
 /usr/sbin/vlock-main	--	gen_context(system_u:object_r:vlock_exec_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/vlock.if refpolicy/policy/modules/contrib/vlock.if
--- refpolicy/policy/modules/contrib/vlock.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/vlock.if	2012-10-31 19:04:21.086580375 +0100
@@ -21,8 +21,9 @@
 
 ########################################
 ## <summary>
-##	Execute vlock in the vlock domain, and
-##	allow the specified role the vlock domain.
+##	Execute vlock in the vlock domain,
+##	and allow the specified role
+##	the vlock domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -38,9 +39,9 @@
 #
 interface(`vlock_run',`
 	gen_require(`
-		type vlock_t;
+		attribute_role vlock_roles;
 	')
 
 	vlock_domtrans($1)
-	role $2 types vlock_t;
+	roleattribute $2 vlock_roles;
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/vlock.te refpolicy/policy/modules/contrib/vlock.te
--- refpolicy/policy/modules/contrib/vlock.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/vlock.te	2012-10-31 19:04:21.087580375 +0100
@@ -1,52 +1,43 @@
-policy_module(vlock, 1.1.0)
+policy_module(vlock, 1.1.1)
 
 ########################################
 #
 # Declarations
 #
 
+attribute_role vlock_roles;
+
 type vlock_t;
 type vlock_exec_t;
 application_domain(vlock_t, vlock_exec_t)
+role vlock_roles types vlock_t;
 
 ########################################
 #
 # Local policy
 #
 
-# --enable-pam is recommended when configuring vlock, making it
-# unnecessary to be a setuid program.
 dontaudit vlock_t self:capability { setuid setgid };
 allow vlock_t self:fd use;
 allow vlock_t self:fifo_file rw_fifo_file_perms;
-allow vlock_t self:netlink_audit_socket { create_netlink_socket_perms nlmsg_relay };
-allow vlock_t self:unix_dgram_socket { create connect };
 
 kernel_read_system_state(vlock_t)
 
 corecmd_list_bin(vlock_t)
 corecmd_read_bin_symlinks(vlock_t)
 
-# Must call this interface otherwise PAM session will fail
-# with message of "terminal=? res=failed"
 domain_use_interactive_fds(vlock_t)
 
 files_dontaudit_search_home(vlock_t)
-files_read_etc_files(vlock_t)
 
-# pam_tally2 module could be used by vlock for authentication,
-# /var/log/tallylog's SL is usually s0, while the caller's SL could
-# be higher than s0.
 mls_file_write_all_levels(vlock_t)
 
 selinux_dontaudit_getattr_fs(vlock_t)
 
-auth_domtrans_chk_passwd(vlock_t)
+auth_use_pam(vlock_t)
 
 init_dontaudit_rw_utmp(vlock_t)
 
-logging_send_syslog_msg(vlock_t)
-
 miscfiles_read_localization(vlock_t)
 
 userdom_dontaudit_search_user_home_dirs(vlock_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/vmware.fc refpolicy/policy/modules/contrib/vmware.fc
--- refpolicy/policy/modules/contrib/vmware.fc	2012-05-04 16:10:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/vmware.fc	2012-10-31 19:04:23.776580381 +0100
@@ -1,65 +1,52 @@
-#
-# HOME_DIR/
-#
-HOME_DIR/\.vmware(/.*)?			gen_context(system_u:object_r:vmware_file_t,s0)
+HOME_DIR/\.vmware(/.*)?	gen_context(system_u:object_r:vmware_file_t,s0)
 HOME_DIR/\.vmware[^/]*/.*\.cfg	--	gen_context(system_u:object_r:vmware_conf_t,s0)
-HOME_DIR/vmware(/.*)?			gen_context(system_u:object_r:vmware_file_t,s0)
+HOME_DIR/vmware(/.*)?	gen_context(system_u:object_r:vmware_file_t,s0)
 
-#
-# /etc
-#
-/etc/vmware.*(/.*)?			gen_context(system_u:object_r:vmware_sys_conf_t,s0)
-
-#
-# /usr
-#
-/usr/bin/vmnet-bridge		--	gen_context(system_u:object_r:vmware_host_exec_t,s0)
-/usr/bin/vmnet-dhcpd		--	gen_context(system_u:object_r:vmware_host_exec_t,s0)
-/usr/bin/vmnet-natd		--	gen_context(system_u:object_r:vmware_host_exec_t,s0)
-/usr/bin/vmnet-netifup		--	gen_context(system_u:object_r:vmware_host_exec_t,s0)
-/usr/bin/vmnet-sniffer		--	gen_context(system_u:object_r:vmware_host_exec_t,s0)
-/usr/bin/vmware-network		--	gen_context(system_u:object_r:vmware_host_exec_t,s0)
-/usr/bin/vmware-nmbd		--	gen_context(system_u:object_r:vmware_host_exec_t,s0)
-/usr/bin/vmware-ping		--	gen_context(system_u:object_r:vmware_exec_t,s0)
-/usr/bin/vmware-smbd		--	gen_context(system_u:object_r:vmware_host_exec_t,s0)
+/etc/vmware.*(/.*)?	gen_context(system_u:object_r:vmware_sys_conf_t,s0)
+
+/usr/bin/vmnet-bridge	--	gen_context(system_u:object_r:vmware_host_exec_t,s0)
+/usr/bin/vmnet-dhcpd	--	gen_context(system_u:object_r:vmware_host_exec_t,s0)
+/usr/bin/vmnet-natd	--	gen_context(system_u:object_r:vmware_host_exec_t,s0)
+/usr/bin/vmnet-netifup	--	gen_context(system_u:object_r:vmware_host_exec_t,s0)
+/usr/bin/vmnet-sniffer	--	gen_context(system_u:object_r:vmware_host_exec_t,s0)
+/usr/bin/vmware-network	--	gen_context(system_u:object_r:vmware_host_exec_t,s0)
+/usr/bin/vmware-nmbd	--	gen_context(system_u:object_r:vmware_host_exec_t,s0)
+/usr/bin/vmware-ping	--	gen_context(system_u:object_r:vmware_exec_t,s0)
+/usr/bin/vmware-smbd	--	gen_context(system_u:object_r:vmware_host_exec_t,s0)
 /usr/bin/vmware-smbpasswd	--	gen_context(system_u:object_r:vmware_host_exec_t,s0)
 /usr/bin/vmware-smbpasswd\.bin	--	gen_context(system_u:object_r:vmware_host_exec_t,s0)
-/usr/bin/vmware-vmx		--	gen_context(system_u:object_r:vmware_host_exec_t,s0)
-/usr/bin/vmware-wizard		--	gen_context(system_u:object_r:vmware_exec_t,s0)
-/usr/bin/vmware			--	gen_context(system_u:object_r:vmware_exec_t,s0)
+/usr/bin/vmware-vmx	--	gen_context(system_u:object_r:vmware_host_exec_t,s0)
+/usr/bin/vmware-wizard	--	gen_context(system_u:object_r:vmware_exec_t,s0)
+/usr/bin/vmware	--	gen_context(system_u:object_r:vmware_exec_t,s0)
 
-/usr/lib/vmware/config		--	gen_context(system_u:object_r:vmware_sys_conf_t,s0)
+/usr/lib/vmware/config	--	gen_context(system_u:object_r:vmware_sys_conf_t,s0)
 /usr/lib/vmware/bin/vmplayer	--	gen_context(system_u:object_r:vmware_exec_t,s0)
 /usr/lib/vmware/bin/vmware-mks	--	gen_context(system_u:object_r:vmware_exec_t,s0)
 /usr/lib/vmware/bin/vmware-ui	--	gen_context(system_u:object_r:vmware_exec_t,s0)
 /usr/lib/vmware/bin/vmware-vmx	--	gen_context(system_u:object_r:vmware_host_exec_t,s0)
 
-ifdef(`distro_redhat',`
-/usr/lib/vmware-tools/sbin32/vmware.* -- gen_context(system_u:object_r:vmware_host_exec_t,s0)
-/usr/lib/vmware-tools/sbin64/vmware.* -- gen_context(system_u:object_r:vmware_host_exec_t,s0)
-')
+/usr/lib/vmware-tools/sbin32/vmware.*	--	gen_context(system_u:object_r:vmware_host_exec_t,s0)
+/usr/lib/vmware-tools/sbin64/vmware.*	--	gen_context(system_u:object_r:vmware_host_exec_t,s0)
 
 /usr/sbin/vmware-guest.*	--	gen_context(system_u:object_r:vmware_host_exec_t,s0)
 /usr/sbin/vmware-serverd	--	gen_context(system_u:object_r:vmware_exec_t,s0)
 
-ifdef(`distro_gentoo',`
-/opt/vmware/(workstation|player)/bin/vmnet-bridge --	gen_context(system_u:object_r:vmware_host_exec_t,s0)
-/opt/vmware/(workstation|player)/bin/vmnet-dhcpd --	gen_context(system_u:object_r:vmware_host_exec_t,s0)
+/opt/vmware/(workstation|player)/bin/vmnet-bridge	--	gen_context(system_u:object_r:vmware_host_exec_t,s0)
+/opt/vmware/(workstation|player)/bin/vmnet-dhcpd	--	gen_context(system_u:object_r:vmware_host_exec_t,s0)
 /opt/vmware/(workstation|player)/bin/vmnet-natd	--	gen_context(system_u:object_r:vmware_host_exec_t,s0)
-/opt/vmware/(workstation|player)/bin/vmnet-netifup --	gen_context(system_u:object_r:vmware_host_exec_t,s0)
-/opt/vmware/(workstation|player)/bin/vmnet-sniffer --	gen_context(system_u:object_r:vmware_host_exec_t,s0)
-/opt/vmware/(workstation|player)/bin/vmware-nmbd --	gen_context(system_u:object_r:vmware_host_exec_t,s0)
-/opt/vmware/(workstation|player)/bin/vmware-ping --	gen_context(system_u:object_r:vmware_exec_t,s0)
-/opt/vmware/(workstation|player)/bin/vmware-smbd --	gen_context(system_u:object_r:vmware_host_exec_t,s0)
-/opt/vmware/(workstation|player)/bin/vmware-smbpasswd -- gen_context(system_u:object_r:vmware_host_exec_t,s0)
-/opt/vmware/(workstation|player)/bin/vmware-smbpasswd\.bin -- gen_context(system_u:object_r:vmware_host_exec_t,s0)
-/opt/vmware/(workstation|player)/bin/vmware-wizard --	gen_context(system_u:object_r:vmware_exec_t,s0)
-/opt/vmware/(workstation|player)/bin/vmware --	gen_context(system_u:object_r:vmware_exec_t,s0)
-')
-
-/var/log/vmware.* 		--	gen_context(system_u:object_r:vmware_log_t,s0)
-/var/log/vnetlib.*		--	gen_context(system_u:object_r:vmware_log_t,s0)
-
-/var/run/vmnat.* 		-s	gen_context(system_u:object_r:vmware_var_run_t,s0)
-/var/run/vmnet.*			gen_context(system_u:object_r:vmware_var_run_t,s0)
-/var/run/vmware.* 			gen_context(system_u:object_r:vmware_var_run_t,s0)
+/opt/vmware/(workstation|player)/bin/vmnet-netifup	--	gen_context(system_u:object_r:vmware_host_exec_t,s0)
+/opt/vmware/(workstation|player)/bin/vmnet-sniffer	--	gen_context(system_u:object_r:vmware_host_exec_t,s0)
+/opt/vmware/(workstation|player)/bin/vmware-nmbd	--	gen_context(system_u:object_r:vmware_host_exec_t,s0)
+/opt/vmware/(workstation|player)/bin/vmware-ping	--	gen_context(system_u:object_r:vmware_exec_t,s0)
+/opt/vmware/(workstation|player)/bin/vmware-smbd	--	gen_context(system_u:object_r:vmware_host_exec_t,s0)
+/opt/vmware/(workstation|player)/bin/vmware-smbpasswd	--	gen_context(system_u:object_r:vmware_host_exec_t,s0)
+/opt/vmware/(workstation|player)/bin/vmware-smbpasswd\.bin	--	gen_context(system_u:object_r:vmware_host_exec_t,s0)
+/opt/vmware/(workstation|player)/bin/vmware-wizard	--	gen_context(system_u:object_r:vmware_exec_t,s0)
+/opt/vmware/(workstation|player)/bin/vmware	--	gen_context(system_u:object_r:vmware_exec_t,s0)
+
+/var/log/vmware.*	--	gen_context(system_u:object_r:vmware_log_t,s0)
+/var/log/vnetlib.*	--	gen_context(system_u:object_r:vmware_log_t,s0)
+
+/var/run/vmnat.*	-s	gen_context(system_u:object_r:vmware_var_run_t,s0)
+/var/run/vmnet.*	gen_context(system_u:object_r:vmware_var_run_t,s0)
+/var/run/vmware.*	gen_context(system_u:object_r:vmware_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/vmware.if refpolicy/policy/modules/contrib/vmware.if
--- refpolicy/policy/modules/contrib/vmware.if	2012-05-04 15:16:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/vmware.if	2012-10-31 19:04:23.776580381 +0100
@@ -1,33 +1,40 @@
-## <summary>VMWare Workstation virtual machines</summary>
+## <summary>VMWare Workstation virtual machines.</summary>
 
 ########################################
 ## <summary>
-##	Role access for vmware
+##	Role access for vmware.
 ## </summary>
 ## <param name="role">
 ##	<summary>
-##	Role allowed access
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <param name="domain">
 ##	<summary>
-##	User domain for the role
+##	User domain for the role.
 ##	</summary>
 ## </param>
 #
 interface(`vmware_role',`
 	gen_require(`
-		type vmware_t, vmware_exec_t;
+		type vmware_t, vmware_exec_t, vmware_file_t;
+		type vmware_conf_t, vmware_tmp_t, vmware_tmpfs_t;
 	')
 
 	role $1 types vmware_t;
 
-	# Transition from the user domain to the derived domain.
 	domtrans_pattern($2, vmware_exec_t, vmware_t)
 
-	# allow ps to show vmware and allow the user to kill it 
 	ps_process_pattern($2, vmware_t)
-	allow $2 vmware_t:process signal;
+	allow $2 vmware_t:process { ptrace signal_perms };
+
+	allow $2 { vmware_tmp_t vmware_file_t }:dir { manage_dir_perms relabel_dir_perms };
+	allow $2 { vmware_conf_t vmware_file_t vmware_tmp_t vmware_tmpfs_t }:file { manage_file_perms relabel_file_perms };
+	allow $2 { vmware_tmp_t vmware_tmpfs_t }:sock_file { manage_sock_file_perms relabel_sock_file_perms };
+	allow $2 vmware_tmpfs_t:lnk_file { manage_lnk_file_perms relabel_lnk_file_perms };
+	allow $2 vmware_tmpfs_t:fifo_file { manage_fifo_file_perms relabel_fifo_file_perms };
+	userdom_user_home_dir_filetrans($2, vmware_file_t, dir, ".vmware")
+	userdom_user_home_dir_filetrans($2, vmware_file_t, dir, "vmware")
 ')
 
 ########################################
@@ -45,12 +52,13 @@
 		type vmware_host_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	can_exec($1, vmware_host_exec_t)
 ')
 
 ########################################
 ## <summary>
-##	Read VMWare system configuration files.
+##	Read vmware system configuration files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -63,12 +71,13 @@
 		type vmware_sys_conf_t;
 	')
 
-	allow $1 vmware_sys_conf_t:file { getattr read };
+	files_search_etc($1)
+	allow $1 vmware_sys_conf_t:file read_file_perms;
 ')
 
 ########################################
 ## <summary>
-##	Append to VMWare system configuration files.
+##	Append vmware system configuration files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -81,12 +90,13 @@
 		type vmware_sys_conf_t;
 	')
 
-	allow $1 vmware_sys_conf_t:file append;
+	files_search_etc($1)
+	allow $1 vmware_sys_conf_t:file append_file_perms;
 ')
 
 ########################################
 ## <summary>
-##	Append to VMWare log files.
+##	Append vmware log files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/vmware.te refpolicy/policy/modules/contrib/vmware.te
--- refpolicy/policy/modules/contrib/vmware.te	2012-07-25 20:33:05.000000000 +0200
+++ refpolicy/policy/modules/contrib/vmware.te	2012-10-31 19:04:23.777580381 +0100
@@ -1,11 +1,10 @@
-policy_module(vmware, 2.6.0)
+policy_module(vmware, 2.6.1)
 
 ########################################
 #
 # Declarations
 #
 
-# VMWare user program
 type vmware_t;
 type vmware_exec_t;
 typealias vmware_t alias { user_vmware_t staff_vmware_t sysadm_vmware_t };
@@ -22,7 +21,6 @@
 typealias vmware_file_t alias { auditadm_vmware_file_t secadm_vmware_file_t };
 userdom_user_home_content(vmware_file_t)
 
-# VMWare host programs
 type vmware_host_t;
 type vmware_host_exec_t;
 init_daemon_domain(vmware_host_t, vmware_host_exec_t)
@@ -45,9 +43,8 @@
 files_pid_file(vmware_pid_t)
 ubac_constrained(vmware_pid_t)
 
-# Systemwide configuration files
 type vmware_sys_conf_t;
-files_type(vmware_sys_conf_t)
+files_config_file(vmware_sys_conf_t)
 
 type vmware_tmp_t;
 typealias vmware_tmp_t alias { user_vmware_tmp_t staff_vmware_tmp_t sysadm_vmware_tmp_t };
@@ -65,20 +62,16 @@
 
 ########################################
 #
-# VMWare host local policy
+# Host local policy
 #
 
 allow vmware_host_t self:capability { setgid setuid net_raw sys_nice sys_time sys_ptrace kill dac_override };
 dontaudit vmware_host_t self:capability sys_tty_config;
 allow vmware_host_t self:process { execstack execmem signal_perms };
 allow vmware_host_t self:fifo_file rw_fifo_file_perms;
-allow vmware_host_t self:unix_stream_socket create_stream_socket_perms;
+allow vmware_host_t self:unix_stream_socket { accept listen };
 allow vmware_host_t self:rawip_socket create_socket_perms;
-allow vmware_host_t self:tcp_socket create_socket_perms;
 
-can_exec(vmware_host_t, vmware_host_exec_t)
-
-# cjp: the ro and rw files should be split up
 manage_files_pattern(vmware_host_t, vmware_sys_conf_t, vmware_sys_conf_t)
 manage_lnk_files_pattern(vmware_host_t, vmware_sys_conf_t, vmware_sys_conf_t)
 
@@ -91,8 +84,12 @@
 manage_sock_files_pattern(vmware_host_t, vmware_var_run_t, vmware_var_run_t)
 files_pid_filetrans(vmware_host_t, vmware_var_run_t, { file sock_file })
 
-manage_files_pattern(vmware_host_t, vmware_log_t, vmware_log_t)
-logging_log_filetrans(vmware_host_t, vmware_log_t, { file dir })
+append_files_pattern(vmware_host_t, vmware_log_t, vmware_log_t)
+create_files_pattern(vmware_host_t, vmware_log_t, vmware_log_t)
+setattr_files_pattern(vmware_host_t, vmware_log_t, vmware_log_t)
+logging_log_filetrans(vmware_host_t, vmware_log_t, file)
+
+can_exec(vmware_host_t, vmware_host_exec_t)
 
 kernel_read_kernel_sysctls(vmware_host_t)
 kernel_read_system_state(vmware_host_t)
@@ -107,13 +104,9 @@
 corenet_udp_sendrecv_generic_node(vmware_host_t)
 corenet_raw_sendrecv_generic_node(vmware_host_t)
 corenet_tcp_sendrecv_all_ports(vmware_host_t)
-corenet_udp_sendrecv_all_ports(vmware_host_t)
-corenet_raw_bind_generic_node(vmware_host_t)
-corenet_tcp_bind_generic_node(vmware_host_t)
-corenet_udp_bind_generic_node(vmware_host_t)
-corenet_tcp_connect_all_ports(vmware_host_t)
+
 corenet_sendrecv_all_client_packets(vmware_host_t)
-corenet_sendrecv_all_server_packets(vmware_host_t)
+corenet_tcp_connect_all_ports(vmware_host_t)
 
 corecmd_exec_bin(vmware_host_t)
 corecmd_exec_shell(vmware_host_t)
@@ -184,9 +177,9 @@
 	xserver_read_xdm_pid(vmware_host_t)
 ')
 
-##############################
+########################################
 #
-# VMWare guest local policy
+# Guest local policy
 #
 
 allow vmware_t self:capability { dac_override setgid sys_nice sys_resource setuid sys_admin sys_rawio chown };
@@ -202,16 +195,14 @@
 allow vmware_t self:msgq create_msgq_perms;
 allow vmware_t self:msg { send receive };
 
-can_exec(vmware_t, vmware_exec_t)
-
-# User configuration files
 allow vmware_t vmware_conf_t:file manage_file_perms;
 
-# VMWare disks
+manage_dirs_pattern(vmware_t, vmware_file_t, vmware_file_t)
 manage_files_pattern(vmware_t, vmware_file_t, vmware_file_t)
 manage_lnk_files_pattern(vmware_t, vmware_file_t, vmware_file_t)
+userdom_user_home_dir_filetrans(vmware_t, vmware_file_t, dir, ".vmware")
+userdom_user_home_dir_filetrans(vmware_t, vmware_file_t, dir, "vmware")
 
-allow vmware_t vmware_tmp_t:file execute;
 manage_dirs_pattern(vmware_t, vmware_tmp_t, vmware_tmp_t)
 manage_files_pattern(vmware_t, vmware_tmp_t, vmware_tmp_t)
 manage_sock_files_pattern(vmware_t, vmware_tmp_t, vmware_tmp_t)
@@ -223,7 +214,6 @@
 manage_sock_files_pattern(vmware_t, vmware_tmpfs_t, vmware_tmpfs_t)
 fs_tmpfs_filetrans(vmware_t, vmware_tmpfs_t, { dir file lnk_file sock_file fifo_file })
 
-# Read clobal configuration files
 allow vmware_t vmware_sys_conf_t:dir list_dir_perms;
 read_files_pattern(vmware_t, vmware_sys_conf_t, vmware_sys_conf_t)
 read_lnk_files_pattern(vmware_t, vmware_sys_conf_t, vmware_sys_conf_t)
@@ -234,11 +224,12 @@
 manage_sock_files_pattern(vmware_t, vmware_pid_t, vmware_pid_t)
 files_pid_filetrans(vmware_t, vmware_pid_t, { dir file lnk_file })
 
+can_exec(vmware_t, { vmware_tmp_t vmware_exec_t })
+
 kernel_read_system_state(vmware_t)
 kernel_read_network_state(vmware_t)
 kernel_read_kernel_sysctls(vmware_t)
 
-# startup scripts
 corecmd_exec_bin(vmware_t)
 corecmd_exec_shell(vmware_t)
 
@@ -264,19 +255,26 @@
 storage_raw_read_removable_device(vmware_t)
 storage_raw_write_removable_device(vmware_t)
 
-# startup scripts run ldd
 libs_exec_ld_so(vmware_t)
-# Access X11 config files
 libs_read_lib_files(vmware_t)
 
 miscfiles_read_localization(vmware_t)
 
 userdom_use_user_terminals(vmware_t)
 userdom_list_user_home_dirs(vmware_t)
-# cjp: why?
-userdom_read_user_home_content_files(vmware_t)
 
 sysnet_dns_name_resolve(vmware_t)
-sysnet_read_config(vmware_t)
 
 xserver_user_x_domain_template(vmware, vmware_t, vmware_tmpfs_t)
+
+tunable_policy(`use_nfs_home_dirs',`
+	fs_manage_nfs_dirs(vmware_t)
+	fs_manage_nfs_files(vmware_t)
+	fs_manage_nfs_symlinks(vmware_t)
+')
+
+tunable_policy(`use_samba_home_dirs',`
+	fs_manage_cifs_dirs(vmware_t)
+	fs_manage_cifs_files(vmware_t)
+	fs_manage_cifs_symlinks(vmware_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/vnstatd.fc refpolicy/policy/modules/contrib/vnstatd.fc
--- refpolicy/policy/modules/contrib/vnstatd.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/vnstatd.fc	2012-10-31 19:04:26.307580386 +0100
@@ -1,7 +1,9 @@
-/usr/bin/vnstat		--	gen_context(system_u:object_r:vnstat_exec_t,s0)
+/etc/rc\.d/init\.d/vnstat	--	gen_context(system_u:object_r:vnstatd_initrc_exec_t,s0)
+
+/usr/bin/vnstat	--	gen_context(system_u:object_r:vnstat_exec_t,s0)
 
 /usr/sbin/vnstatd	--	gen_context(system_u:object_r:vnstatd_exec_t,s0)
 
-/var/lib/vnstat(/.*)?		gen_context(system_u:object_r:vnstatd_var_lib_t,s0)
+/var/lib/vnstat(/.*)?	gen_context(system_u:object_r:vnstatd_var_lib_t,s0)
 
-/var/run/vnstat\.pid		gen_context(system_u:object_r:vnstatd_var_run_t,s0)
+/var/run/vnstat.*	gen_context(system_u:object_r:vnstatd_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/vnstatd.if refpolicy/policy/modules/contrib/vnstatd.if
--- refpolicy/policy/modules/contrib/vnstatd.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/vnstatd.if	2012-10-31 19:04:26.307580386 +0100
@@ -15,11 +15,38 @@
 		type vnstat_t, vnstat_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, vnstat_exec_t, vnstat_t)
 ')
 
 ########################################
 ## <summary>
+##	Execute vnstat in the vnstat domain,
+##	and allow the specified role
+##	the vnstat domain.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed to transition.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+#
+interface(`vnstatd_run_vnstat',`
+	gen_require(`
+		attribute_role vnstat_roles;
+	')
+
+	vnstatd_domtrans_vnstat($1)
+	roleattribute $2 vnstat_roles;
+')
+
+########################################
+## <summary>
 ##	Execute a domain transition to run vnstatd.
 ## </summary>
 ## <param name="domain">
@@ -33,6 +60,7 @@
 		type vnstatd_t, vnstatd_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, vnstatd_exec_t, vnstatd_t)
 ')
 
@@ -51,13 +79,14 @@
 		type vnstatd_var_lib_t;
 	')
 
-	allow $1 vnstatd_var_lib_t:dir search_dir_perms;
 	files_search_var_lib($1)
+	allow $1 vnstatd_var_lib_t:dir search_dir_perms;
 ')
 
 ########################################
 ## <summary>
-##	Manage vnstatd lib dirs.
+##	Create, read, write, and delete
+##	vnstatd lib directories.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -115,8 +144,8 @@
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate
-##	an vnstatd environment
+##	All of the rules required to
+##	administrate an vnstatd environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -132,12 +161,23 @@
 #
 interface(`vnstatd_admin',`
 	gen_require(`
-		type vnstatd_t, vnstatd_var_lib_t;
+		type vnstatd_t, vnstatd_var_lib_t, vnstatd_initrc_exec_t;
+		type vnstatd_var_run_t;
 	')
 
 	allow $1 vnstatd_t:process { ptrace signal_perms };
 	ps_process_pattern($1, vnstatd_t)
 
+	init_labeled_script_domtrans($1, vnstatd_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 vnstatd_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	files_search_pids($1)
+	admin_pattern($1, vnstatd_var_run_t)
+
 	files_list_var_lib($1)
 	admin_pattern($1, vnstatd_var_lib_t)
+
+	vnstatd_run_vnstat($1, $2)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/vnstatd.te refpolicy/policy/modules/contrib/vnstatd.te
--- refpolicy/policy/modules/contrib/vnstatd.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/vnstatd.te	2012-10-31 19:04:26.308580386 +0100
@@ -1,18 +1,24 @@
-policy_module(vnstatd, 1.0.0)
+policy_module(vnstatd, 1.0.1)
 
 ########################################
 #
 # Declarations
 #
 
+attribute_role vnstat_roles;
+
 type vnstat_t;
 type vnstat_exec_t;
 application_domain(vnstat_t, vnstat_exec_t)
+role vnstat_roles types vnstat_t;
 
 type vnstatd_t;
 type vnstatd_exec_t;
 init_daemon_domain(vnstatd_t, vnstatd_exec_t)
 
+type vnstatd_initrc_exec_t;
+init_script_file(vnstatd_initrc_exec_t)
+
 type vnstatd_var_lib_t;
 files_type(vnstatd_var_lib_t)
 
@@ -21,12 +27,12 @@
 
 ########################################
 #
-# vnstatd local policy
+# Daemon local policy
 #
 
 allow vnstatd_t self:process signal;
 allow vnstatd_t self:fifo_file rw_fifo_file_perms;
-allow vnstatd_t self:unix_stream_socket create_stream_socket_perms;
+allow vnstatd_t self:unix_stream_socket { accept listen };
 
 manage_dirs_pattern(vnstatd_t, vnstatd_var_lib_t, vnstatd_var_lib_t)
 manage_files_pattern(vnstatd_t, vnstatd_var_lib_t, vnstatd_var_lib_t)
@@ -49,18 +55,14 @@
 
 miscfiles_read_localization(vnstatd_t)
 
-optional_policy(`
-	cron_system_entry(vnstat_t, vnstat_exec_t)
-')
-
 ########################################
 #
-# vnstat local policy
+# Client local policy
 #
 
 allow vnstat_t self:process signal;
 allow vnstat_t self:fifo_file rw_fifo_file_perms;
-allow vnstat_t self:unix_stream_socket create_stream_socket_perms;
+allow vnstat_t self:unix_stream_socket { accept listen };
 
 manage_dirs_pattern(vnstat_t, vnstatd_var_lib_t, vnstatd_var_lib_t)
 manage_files_pattern(vnstat_t, vnstatd_var_lib_t, vnstatd_var_lib_t)
@@ -78,3 +80,7 @@
 logging_send_syslog_msg(vnstat_t)
 
 miscfiles_read_localization(vnstat_t)
+
+optional_policy(`
+	cron_system_entry(vnstat_t, vnstat_exec_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/vpn.fc refpolicy/policy/modules/contrib/vpn.fc
--- refpolicy/policy/modules/contrib/vpn.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/vpn.fc	2012-10-31 19:04:28.422580390 +0100
@@ -1,13 +1,7 @@
-#
-# sbin
-#
-/sbin/vpnc		--	gen_context(system_u:object_r:vpnc_exec_t,s0)
+/sbin/vpnc	--	gen_context(system_u:object_r:vpnc_exec_t,s0)
 
-#
-# /usr
-#
 /usr/bin/openconnect	--	gen_context(system_u:object_r:vpnc_exec_t,s0)
 
-/usr/sbin/vpnc		--	gen_context(system_u:object_r:vpnc_exec_t,s0)
+/usr/sbin/vpnc	--	gen_context(system_u:object_r:vpnc_exec_t,s0)
 
-/var/run/vpnc(/.*)?		gen_context(system_u:object_r:vpnc_var_run_t,s0)
+/var/run/vpnc(/.*)?	gen_context(system_u:object_r:vpnc_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/vpn.if refpolicy/policy/modules/contrib/vpn.if
--- refpolicy/policy/modules/contrib/vpn.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/vpn.if	2012-10-31 19:04:28.423580390 +0100
@@ -1,8 +1,8 @@
-## <summary>Virtual Private Networking client</summary>
+## <summary>Virtual Private Networking client.</summary>
 
 ########################################
 ## <summary>
-##	Execute VPN clients in the vpnc domain.
+##	Execute vpn clients in the vpnc domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -15,13 +15,15 @@
 		type vpnc_t, vpnc_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, vpnc_exec_t, vpnc_t)
 ')
 
 ########################################
 ## <summary>
-##	Execute VPN clients in the vpnc domain, and
-##	allow the specified role the vpnc domain.
+##	Execute vpn clients in the vpnc
+##	domain, and allow the specified
+##	role the vpnc domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -46,7 +48,7 @@
 
 ########################################
 ## <summary>
-##	Send VPN clients the kill signal.
+##	Send kill signals to vpnc.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -64,7 +66,7 @@
 
 ########################################
 ## <summary>
-##	Send generic signals to VPN clients.
+##	Send generic signals to vpnc.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -82,7 +84,7 @@
 
 ########################################
 ## <summary>
-##	Send signull to VPN clients.
+##	Send null signals to vpnc.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -101,7 +103,7 @@
 ########################################
 ## <summary>
 ##	Send and receive messages from
-##	Vpnc over dbus.
+##	vpnc over dbus.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/vpn.te refpolicy/policy/modules/contrib/vpn.te
--- refpolicy/policy/modules/contrib/vpn.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/vpn.te	2012-10-31 19:04:28.424580390 +0100
@@ -1,4 +1,4 @@
-policy_module(vpn, 1.15.0)
+policy_module(vpn, 1.15.1)
 
 ########################################
 #
@@ -6,10 +6,10 @@
 #
 
 attribute_role vpnc_roles;
-roleattribute system_r vpnc_roles;
 
 type vpnc_t;
 type vpnc_exec_t;
+init_system_domain(vpnc_t, vpnc_exec_t)
 application_domain(vpnc_t, vpnc_exec_t)
 role vpnc_roles types vpnc_t;
 
@@ -24,17 +24,13 @@
 # Local policy
 #
 
-allow vpnc_t self:capability { dac_read_search dac_override net_admin ipc_lock net_raw };
+allow vpnc_t self:capability { dac_read_search dac_override net_admin ipc_lock net_raw setuid };
 allow vpnc_t self:process { getsched signal };
 allow vpnc_t self:fifo_file rw_fifo_file_perms;
 allow vpnc_t self:netlink_route_socket rw_netlink_socket_perms;
-allow vpnc_t self:tcp_socket create_stream_socket_perms;
-allow vpnc_t self:udp_socket create_socket_perms;
+allow vpnc_t self:tcp_socket { accept listen };
 allow vpnc_t self:rawip_socket create_socket_perms;
-allow vpnc_t self:unix_dgram_socket create_socket_perms;
-allow vpnc_t self:unix_stream_socket create_socket_perms;
 allow vpnc_t self:tun_socket { create_socket_perms relabelfrom };
-# cjp: this needs to be fixed
 allow vpnc_t self:socket create_socket_perms;
 
 manage_dirs_pattern(vpnc_t, vpnc_tmp_t, vpnc_tmp_t)
@@ -62,36 +58,43 @@
 corenet_tcp_sendrecv_all_ports(vpnc_t)
 corenet_udp_sendrecv_all_ports(vpnc_t)
 corenet_udp_bind_generic_node(vpnc_t)
+
+corenet_sendrecv_all_server_packets(vpnc_t)
 corenet_udp_bind_generic_port(vpnc_t)
+
+corenet_sendrecv_isakmp_server_packets(vpnc_t)
 corenet_udp_bind_isakmp_port(vpnc_t)
+
+corenet_sendrecv_generic_server_packets(vpnc_t)
 corenet_udp_bind_ipsecnat_port(vpnc_t)
-corenet_tcp_connect_all_ports(vpnc_t)
+
 corenet_sendrecv_all_client_packets(vpnc_t)
-corenet_sendrecv_isakmp_server_packets(vpnc_t)
-corenet_sendrecv_generic_server_packets(vpnc_t)
+corenet_tcp_connect_all_ports(vpnc_t)
+
 corenet_rw_tun_tap_dev(vpnc_t)
 
+corecmd_exec_all_executables(vpnc_t)
+
 dev_read_rand(vpnc_t)
 dev_read_urand(vpnc_t)
 dev_read_sysfs(vpnc_t)
 
 domain_use_interactive_fds(vpnc_t)
 
+files_exec_etc_files(vpnc_t)
+files_read_etc_runtime_files(vpnc_t)
+files_dontaudit_search_home(vpnc_t)
+
 fs_getattr_xattr_fs(vpnc_t)
 fs_getattr_tmpfs(vpnc_t)
 
 term_use_all_ptys(vpnc_t)
 term_use_all_ttys(vpnc_t)
 
-corecmd_exec_all_executables(vpnc_t)
-
-files_exec_etc_files(vpnc_t)
-files_read_etc_runtime_files(vpnc_t)
-files_read_etc_files(vpnc_t)
-files_dontaudit_search_home(vpnc_t)
-
 auth_use_nsswitch(vpnc_t)
 
+init_dontaudit_use_fds(vpnc_t)
+
 libs_exec_ld_so(vpnc_t)
 libs_exec_lib_files(vpnc_t)
 
@@ -103,7 +106,6 @@
 miscfiles_read_localization(vpnc_t)
 
 seutil_dontaudit_search_config(vpnc_t)
-seutil_use_newrole_fds(vpnc_t)
 
 sysnet_run_ifconfig(vpnc_t, vpnc_roles)
 sysnet_etc_filetrans_config(vpnc_t)
@@ -123,3 +125,7 @@
 optional_policy(`
 	networkmanager_attach_tun_iface(vpnc_t)
 ')
+
+optional_policy(`
+	seutil_use_newrole_fds(vpnc_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/w3c.fc refpolicy/policy/modules/contrib/w3c.fc
--- refpolicy/policy/modules/contrib/w3c.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/w3c.fc	2012-10-31 19:04:29.428580393 +0100
@@ -1,4 +1,4 @@
-/usr/lib/cgi-bin/check				gen_context(system_u:object_r:httpd_w3c_validator_script_exec_t,s0)
+/usr/lib/cgi-bin/check	gen_context(system_u:object_r:httpd_w3c_validator_script_exec_t,s0)
 
-/usr/share/w3c-markup-validator(/.*)?		gen_context(system_u:object_r:httpd_w3c_validator_content_t,s0)
+/usr/share/w3c-markup-validator(/.*)?	gen_context(system_u:object_r:httpd_w3c_validator_content_t,s0)
 /usr/share/w3c-markup-validator/cgi-bin(/.*)?	gen_context(system_u:object_r:httpd_w3c_validator_script_exec_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/w3c.if refpolicy/policy/modules/contrib/w3c.if
--- refpolicy/policy/modules/contrib/w3c.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/w3c.if	2012-10-31 19:04:30.674580395 +0100
@@ -1 +1 @@
-## <summary>W3C Markup Validator</summary>
+## <summary>W3C Markup Validator.</summary>
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/w3c.te refpolicy/policy/modules/contrib/w3c.te
--- refpolicy/policy/modules/contrib/w3c.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/w3c.te	2012-10-31 19:04:30.675580395 +0100
@@ -1,4 +1,4 @@
-policy_module(w3c, 1.0.0)
+policy_module(w3c, 1.0.1)
 
 ########################################
 #
@@ -12,10 +12,20 @@
 # Local policy
 #
 
+corenet_all_recvfrom_unlabeled(httpd_w3c_validator_script_t)
+corenet_all_recvfrom_netlabel(httpd_w3c_validator_script_t)
+corenet_tcp_sendrecv_generic_if(httpd_w3c_validator_script_t)
+corenet_tcp_sendrecv_generic_node(httpd_w3c_validator_script_t)
+
+corenet_sendrecv_ftp_client_packets(httpd_w3c_validator_script_t)
 corenet_tcp_connect_ftp_port(httpd_w3c_validator_script_t)
 corenet_tcp_sendrecv_ftp_port(httpd_w3c_validator_script_t)
+
+corenet_sendrecv_http_client_packets(httpd_w3c_validator_script_t)
 corenet_tcp_connect_http_port(httpd_w3c_validator_script_t)
 corenet_tcp_sendrecv_http_port(httpd_w3c_validator_script_t)
+
+corenet_sendrecv_http_cache_client_packets(httpd_w3c_validator_script_t)
 corenet_tcp_connect_http_cache_port(httpd_w3c_validator_script_t)
 corenet_tcp_sendrecv_http_cache_port(httpd_w3c_validator_script_t)
 
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/watchdog.fc refpolicy/policy/modules/contrib/watchdog.fc
--- refpolicy/policy/modules/contrib/watchdog.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/watchdog.fc	2012-10-31 19:04:33.441580401 +0100
@@ -1,5 +1,7 @@
+/etc/rc\.d/init\.d/watchdog	--	gen_context(system_u:object_r:watchdog_initrc_exec_t,s0)
+
 /usr/sbin/watchdog	--	gen_context(system_u:object_r:watchdog_exec_t,s0)
 
-/var/log/watchdog(/.*)?		gen_context(system_u:object_r:watchdog_log_t,s0)
+/var/log/watchdog.*	gen_context(system_u:object_r:watchdog_log_t,s0)
 
 /var/run/watchdog\.pid	--	gen_context(system_u:object_r:watchdog_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/watchdog.if refpolicy/policy/modules/contrib/watchdog.if
--- refpolicy/policy/modules/contrib/watchdog.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/watchdog.if	2012-10-31 19:04:33.441580401 +0100
@@ -1 +1,39 @@
-## <summary>Software watchdog</summary>
+## <summary>Software watchdog.</summary>
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an watchdog environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`watchdog_admin',`
+	gen_require(`
+		type watchdog_t, watchdog_initrc_exec_t, watchdog_log_t;
+		type watchdog_var_run_t;
+	')
+
+	allow $1 watchdog_t:process { ptrace signal_perms };
+	ps_process_pattern($1, watchdog_t)
+
+	init_labeled_script_domtrans($1, watchdog_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 watchdog_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	logging_search_logs($1)
+	admin_pattern($1, watchdog_log_t)
+
+	files_search_pids($1)
+	admin_pattern($1, watchdog_var_run_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/watchdog.te refpolicy/policy/modules/contrib/watchdog.te
--- refpolicy/policy/modules/contrib/watchdog.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/watchdog.te	2012-10-31 19:04:33.442580401 +0100
@@ -1,14 +1,17 @@
-policy_module(watchdog, 1.7.0)
+policy_module(watchdog, 1.7.1)
 
 #################################
 #
-# Rules for the watchdog_t domain.
+# Declarations
 #
 
 type watchdog_t;
 type watchdog_exec_t;
 init_daemon_domain(watchdog_t, watchdog_exec_t)
 
+type watchdog_initrc_exec_t;
+init_script_file(watchdog_initrc_exec_t)
+
 type watchdog_log_t;
 logging_log_file(watchdog_log_t)
 
@@ -17,18 +20,16 @@
 
 ########################################
 #
-# Declarations
+# Local policy
 #
 
 allow watchdog_t self:capability { sys_admin net_admin sys_boot ipc_lock sys_pacct sys_nice sys_resource };
 dontaudit watchdog_t self:capability sys_tty_config;
 allow watchdog_t self:process { setsched signal_perms };
 allow watchdog_t self:fifo_file rw_fifo_file_perms;
-allow watchdog_t self:unix_stream_socket create_socket_perms;
-allow watchdog_t self:tcp_socket create_stream_socket_perms;
-allow watchdog_t self:udp_socket create_socket_perms;
+allow watchdog_t self:tcp_socket { accept listen };
 
-allow watchdog_t watchdog_log_t:file manage_file_perms;
+allow watchdog_t watchdog_log_t:file { append_file_perms create_file_perms setattr_file_perms };
 logging_log_filetrans(watchdog_t, watchdog_log_t, file)
 
 manage_files_pattern(watchdog_t, watchdog_var_run_t, watchdog_var_run_t)
@@ -38,24 +39,19 @@
 kernel_read_kernel_sysctls(watchdog_t)
 kernel_unmount_proc(watchdog_t)
 
-# for orderly shutdown
 corecmd_exec_shell(watchdog_t)
 
-# cjp: why networking?
 corenet_all_recvfrom_unlabeled(watchdog_t)
 corenet_all_recvfrom_netlabel(watchdog_t)
 corenet_tcp_sendrecv_generic_if(watchdog_t)
-corenet_udp_sendrecv_generic_if(watchdog_t)
 corenet_tcp_sendrecv_generic_node(watchdog_t)
-corenet_udp_sendrecv_generic_node(watchdog_t)
 corenet_tcp_sendrecv_all_ports(watchdog_t)
-corenet_udp_sendrecv_all_ports(watchdog_t)
-corenet_tcp_connect_all_ports(watchdog_t)
+
 corenet_sendrecv_all_client_packets(watchdog_t)
+corenet_tcp_connect_all_ports(watchdog_t)
 
 dev_read_sysfs(watchdog_t)
 dev_write_watchdog(watchdog_t)
-# do not care about saving the random seed
 dev_dontaudit_read_rand(watchdog_t)
 dev_dontaudit_read_urand(watchdog_t)
 
@@ -68,7 +64,6 @@
 domain_kill_all_domains(watchdog_t)
 
 files_read_etc_files(watchdog_t)
-# for updating mtab on umount
 files_manage_etc_runtime_files(watchdog_t)
 files_etc_filetrans_etc_runtime(watchdog_t, file)
 
@@ -76,14 +71,13 @@
 fs_getattr_all_fs(watchdog_t)
 fs_search_auto_mountpoints(watchdog_t)
 
-# record the fact that we are going down
 auth_append_login_records(watchdog_t)
 
 logging_send_syslog_msg(watchdog_t)
 
 miscfiles_read_localization(watchdog_t)
 
-sysnet_read_config(watchdog_t)
+sysnet_dns_name_resolve(watchdog_t)
 
 userdom_dontaudit_use_unpriv_user_fds(watchdog_t)
 userdom_dontaudit_search_user_home_dirs(watchdog_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/wdmd.fc refpolicy/policy/modules/contrib/wdmd.fc
--- refpolicy/policy/modules/contrib/wdmd.fc	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/wdmd.fc	2012-10-31 19:04:34.961580405 +0100
@@ -0,0 +1,5 @@
+/etc/rc\.d/init\.d/wdmd	--	gen_context(system_u:object_r:wdmd_initrc_exec_t,s0)
+
+/usr/sbin/wdmd	--	gen_context(system_u:object_r:wdmd_exec_t,s0)
+
+/var/run/wdmd(/.*)?	gen_context(system_u:object_r:wdmd_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/wdmd.if refpolicy/policy/modules/contrib/wdmd.if
--- refpolicy/policy/modules/contrib/wdmd.if	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/wdmd.if	2012-10-27 13:03:43.623002232 +0200
@@ -0,0 +1,55 @@
+## <summary>Watchdog multiplexing daemon.</summary>
+
+########################################
+## <summary>
+##	Connect to wdmd with a unix
+##	domain stream socket.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`wdmd_stream_connect',`
+	gen_require(`
+		type wdmd_t, wdmd_var_run_t;
+	')
+
+	files_search_pids($1)
+	stream_connect_pattern($1, wdmd_var_run_t, wdmd_var_run_t, wdmd_t)
+')
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an wdmd environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`wdmd_admin',`
+	gen_require(`
+		type wdmd_t, wdmd_initrc_exec_t, wdmd_var_run_t;
+	')
+
+	allow $1 wdmd_t:process { ptrace signal_perms };
+	ps_process_pattern($1, wdmd_t)
+
+	init_labeled_script_domtrans($1, wdmd_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 wdmd_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	files_search_pids($1)
+	admin_pattern($1, wdmd_var_run_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/wdmd.te refpolicy/policy/modules/contrib/wdmd.te
--- refpolicy/policy/modules/contrib/wdmd.te	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/wdmd.te	2012-10-31 19:04:34.983580405 +0100
@@ -0,0 +1,49 @@
+policy_module(wdmd, 1.0.2)
+
+########################################
+#
+# Declarations
+#
+
+type wdmd_t;
+type wdmd_exec_t;
+init_daemon_domain(wdmd_t, wdmd_exec_t)
+
+type wdmd_initrc_exec_t;
+init_script_file(wdmd_initrc_exec_t)
+
+type wdmd_tmpfs_t;
+files_tmpfs_file(wdmd_tmpfs_t)
+
+type wdmd_var_run_t;
+files_pid_file(wdmd_var_run_t)
+
+########################################
+#
+# Local policy
+#
+
+allow wdmd_t self:capability { chown sys_nice ipc_lock };
+allow wdmd_t self:process { setsched signal };
+allow wdmd_t self:fifo_file rw_fifo_file_perms;
+allow wdmd_t self:unix_stream_socket { accept listen };
+
+manage_dirs_pattern(wdmd_t, wdmd_var_run_t, wdmd_var_run_t)
+manage_files_pattern(wdmd_t, wdmd_var_run_t, wdmd_var_run_t)
+manage_sock_files_pattern(wdmd_t, wdmd_var_run_t, wdmd_var_run_t)
+files_pid_filetrans(wdmd_t, wdmd_var_run_t, { file dir sock_file })
+
+manage_dirs_pattern(wdmd_t, wdmd_tmpfs_t, wdmd_tmpfs_t)
+manage_files_pattern(wdmd_t, wdmd_tmpfs_t, wdmd_tmpfs_t)
+fs_tmpfs_filetrans(wdmd_t, wdmd_tmpfs_t, { dir file })
+
+dev_read_watchdog(wdmd_t)
+dev_write_watchdog(wdmd_t)
+
+fs_read_anon_inodefs_files(wdmd_t)
+
+auth_use_nsswitch(wdmd_t)
+
+logging_send_syslog_msg(wdmd_t)
+
+miscfiles_read_localization(wdmd_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/webadm.if refpolicy/policy/modules/contrib/webadm.if
--- refpolicy/policy/modules/contrib/webadm.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/webadm.if	2012-10-31 19:04:36.981580409 +0100
@@ -1,4 +1,4 @@
-## <summary>Web administrator role</summary>
+## <summary>Web administrator role.</summary>
 
 ########################################
 ## <summary>
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/webadm.te refpolicy/policy/modules/contrib/webadm.te
--- refpolicy/policy/modules/contrib/webadm.te	2012-05-04 15:16:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/webadm.te	2012-10-31 19:04:36.982580409 +0100
@@ -1,4 +1,4 @@
-policy_module(webadm, 1.1.0)
+policy_module(webadm, 1.1.1)
 
 ########################################
 #
@@ -6,16 +6,18 @@
 #
 
 ## <desc>
-## <p>
-## Allow webadm to manage files in users home directories
-## </p>
+##	<p>
+##	Determine whether webadm can
+##	manage generic user files.
+##	</p>
 ## </desc>
 gen_tunable(webadm_manage_user_files, false)
 
 ## <desc>
-## <p>
-## Allow webadm to read files in users home directories
-## </p>   
+##	<p>
+##	Determine whether webadm can
+##	read generic user files.
+##	</p>
 ## </desc>
 gen_tunable(webadm_read_user_files, false)
 
@@ -25,18 +27,18 @@
 
 ########################################
 #
-# webadmin local policy
+# Local policy
 #
 
-allow webadm_t self:capability { dac_override dac_read_search kill sys_ptrace sys_nice };
+allow webadm_t self:capability { dac_override dac_read_search kill sys_nice };
 
 files_dontaudit_search_all_dirs(webadm_t)
-files_manage_generic_locks(webadm_t)
 files_list_var(webadm_t)
 
 selinux_get_enforce_mode(webadm_t)
 seutil_domtrans_setfiles(webadm_t)
 
+logging_send_audit_msgs(webadm_t)
 logging_send_syslog_msg(webadm_t)
 
 userdom_dontaudit_search_user_home_dirs(webadm_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/webalizer.fc refpolicy/policy/modules/contrib/webalizer.fc
--- refpolicy/policy/modules/contrib/webalizer.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/webalizer.fc	2012-10-31 19:04:39.128580413 +0100
@@ -1,11 +1,9 @@
+/etc/webalizer\.conf	--	gen_context(system_u:object_r:webalizer_etc_t,s0)
 
-#
-# /usr
-#
 /usr/bin/awffull	--	gen_context(system_u:object_r:webalizer_exec_t,s0)
 /usr/bin/webalizer	--	gen_context(system_u:object_r:webalizer_exec_t,s0)
+/usr/bin/webazolver	--	gen_context(system_u:object_r:webalizer_exec_t,s0)
 
-#
-# /var
-#
 /var/lib/webalizer(/.*)?	gen_context(system_u:object_r:webalizer_var_lib_t,s0)
+
+/var/www/usage(/.*)?	gen_context(system_u:object_r:httpd_webalizer_content_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/webalizer.if refpolicy/policy/modules/contrib/webalizer.if
--- refpolicy/policy/modules/contrib/webalizer.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/webalizer.if	2012-10-31 19:04:39.128580413 +0100
@@ -1,4 +1,4 @@
-## <summary>Web server log analysis</summary>
+## <summary>Web server log analysis.</summary>
 
 ########################################
 ## <summary>
@@ -15,13 +15,15 @@
 		type webalizer_t, webalizer_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, webalizer_exec_t, webalizer_t)
 ')
 
 ########################################
 ## <summary>
-##	Execute webalizer in the webalizer domain, and
-##	allow the specified role the webalizer domain.
+##	Execute webalizer in the webalizer
+##	domain, and allow the specified
+##	role the webalizer domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -37,9 +39,9 @@
 #
 interface(`webalizer_run',`
 	gen_require(`
-		type webalizer_t;
+		attribute_role webalizer_roles;
 	')
 
 	webalizer_domtrans($1)
-	role $2 types webalizer_t;
+	roleattribute $2 webalizer_roles;
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/webalizer.te refpolicy/policy/modules/contrib/webalizer.te
--- refpolicy/policy/modules/contrib/webalizer.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/webalizer.te	2012-11-01 22:37:09.082792043 +0100
@@ -1,14 +1,17 @@
-policy_module(webalizer, 1.12.0)
+policy_module(webalizer, 1.12.1)
 
 ########################################
 #
 # Declarations
 #
 
+attribute_role webalizer_roles;
+roleattribute system_r webalizer_roles;
+
 type webalizer_t;
 type webalizer_exec_t;
 application_domain(webalizer_t, webalizer_exec_t)
-role system_r types webalizer_t;
+role webalizer_roles types webalizer_t;
 
 type webalizer_etc_t;
 files_config_file(webalizer_etc_t)
@@ -34,18 +37,9 @@
 allow webalizer_t self:process ~{ ptrace setcurrent setexec setfscreate setrlimit execmem execstack execheap };
 allow webalizer_t self:fd use;
 allow webalizer_t self:fifo_file rw_fifo_file_perms;
-allow webalizer_t self:sock_file read_sock_file_perms;
-allow webalizer_t self:shm create_shm_perms;
-allow webalizer_t self:sem create_sem_perms;
-allow webalizer_t self:msgq create_msgq_perms;
-allow webalizer_t self:msg { send receive };
-allow webalizer_t self:unix_dgram_socket create_socket_perms;
-allow webalizer_t self:unix_stream_socket create_stream_socket_perms;
 allow webalizer_t self:unix_dgram_socket sendto;
-allow webalizer_t self:unix_stream_socket connectto;
-allow webalizer_t self:tcp_socket connected_stream_socket_perms;
-allow webalizer_t self:udp_socket { connect connected_socket_perms };
-allow webalizer_t self:netlink_route_socket r_netlink_socket_perms;
+allow webalizer_t self:unix_stream_socket { accept connectto listen };
+allow webalizer_t self:tcp_socket { accept listen };
 
 allow webalizer_t webalizer_etc_t:file read_file_perms;
 
@@ -56,21 +50,18 @@
 manage_files_pattern(webalizer_t, webalizer_var_lib_t, webalizer_var_lib_t)
 files_var_lib_filetrans(webalizer_t, webalizer_var_lib_t, file)
 
+can_exec(webalizer_t, webalizer_exec_t)
+
 kernel_read_kernel_sysctls(webalizer_t)
 kernel_read_system_state(webalizer_t)
 
-corenet_all_recvfrom_unlabeled(webalizer_t)
-corenet_all_recvfrom_netlabel(webalizer_t)
-corenet_tcp_sendrecv_generic_if(webalizer_t)
-corenet_tcp_sendrecv_generic_node(webalizer_t)
-corenet_tcp_sendrecv_all_ports(webalizer_t)
+files_read_etc_runtime_files(webalizer_t)
 
 fs_search_auto_mountpoints(webalizer_t)
 fs_getattr_xattr_fs(webalizer_t)
 fs_rw_anon_inodefs_files(webalizer_t)
 
-files_read_etc_files(webalizer_t)
-files_read_etc_runtime_files(webalizer_t)
+auth_use_nsswitch(webalizer_t)
 
 logging_list_logs(webalizer_t)
 logging_send_syslog_msg(webalizer_t)
@@ -78,30 +69,29 @@
 miscfiles_read_localization(webalizer_t)
 miscfiles_read_public_files(webalizer_t)
 
-sysnet_dns_name_resolve(webalizer_t)
-sysnet_read_config(webalizer_t)
-
 userdom_use_user_terminals(webalizer_t)
 userdom_use_unpriv_users_fds(webalizer_t)
 userdom_dontaudit_search_user_home_content(webalizer_t)
 
-apache_read_log(webalizer_t)
-apache_manage_sys_content(webalizer_t)
-
-optional_policy(`
-	cron_system_entry(webalizer_t, webalizer_exec_t)
+ifdef(`distro_gentoo',`
+	optional_policy(`
+		nscd_socket_use(webalizer_t)
+	')
 ')
 
 optional_policy(`
-	ftp_read_log(webalizer_t)
+	apache_read_log(webalizer_t)
+	apache_content_template(webalizer)
+	manage_dirs_pattern(webalizer_t, httpd_webalizer_content_t, httpd_webalizer_content_t)
+	manage_files_pattern(webalizer_t, httpd_webalizer_content_t, httpd_webalizer_content_t)
 ')
 
 optional_policy(`
-	nis_use_ypbind(webalizer_t)
+	cron_system_entry(webalizer_t, webalizer_exec_t)
 ')
 
 optional_policy(`
-	nscd_socket_use(webalizer_t)
+	ftp_read_log(webalizer_t)
 ')
 
 optional_policy(`
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/wine.fc refpolicy/policy/modules/contrib/wine.fc
--- refpolicy/policy/modules/contrib/wine.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/wine.fc	2012-10-31 19:06:40.466580672 +0100
@@ -1,21 +1,24 @@
+HOME_DIR/\.wine(/.*)?	gen_context(system_u:object_r:wine_home_t,s0)
 HOME_DIR/cxoffice/bin/wine.+	--	gen_context(system_u:object_r:wine_exec_t,s0)
 
 /opt/cxoffice/bin/wine.*	--	gen_context(system_u:object_r:wine_exec_t,s0)
 
-/opt/google/picasa(/.*)?/bin/msiexec --	gen_context(system_u:object_r:wine_exec_t,s0)
-/opt/google/picasa(/.*)?/bin/notepad --	gen_context(system_u:object_r:wine_exec_t,s0)
-/opt/google/picasa(/.*)?/bin/progman --	gen_context(system_u:object_r:wine_exec_t,s0)
-/opt/google/picasa(/.*)?/bin/regsvr32 -- gen_context(system_u:object_r:wine_exec_t,s0)
-/opt/google/picasa(/.*)?/bin/regedit --	gen_context(system_u:object_r:wine_exec_t,s0)
-/opt/google/picasa(/.*)?/bin/uninstaller -- gen_context(system_u:object_r:wine_exec_t,s0)
-/opt/google/picasa(/.*)?/bin/wdi --	gen_context(system_u:object_r:wine_exec_t,s0)
-/opt/google/picasa(/.*)?/bin/wine.* --	gen_context(system_u:object_r:wine_exec_t,s0)
+/opt/google/picasa(/.*)?/Picasa3/.*exe	--	gen_context(system_u:object_r:wine_exec_t,s0)
+/opt/google/picasa(/.*)?/bin/msiexec	--	gen_context(system_u:object_r:wine_exec_t,s0)
+/opt/google/picasa(/.*)?/bin/notepad	--	gen_context(system_u:object_r:wine_exec_t,s0)
+/opt/google/picasa(/.*)?/bin/progman	--	gen_context(system_u:object_r:wine_exec_t,s0)
+/opt/google/picasa(/.*)?/bin/regsvr32	--	gen_context(system_u:object_r:wine_exec_t,s0)
+/opt/google/picasa(/.*)?/bin/regedit	--	gen_context(system_u:object_r:wine_exec_t,s0)
+/opt/google/picasa(/.*)?/bin/uninstaller	--	gen_context(system_u:object_r:wine_exec_t,s0)
+/opt/google/picasa(/.*)?/bin/wdi	--	gen_context(system_u:object_r:wine_exec_t,s0)
+/opt/google/picasa(/.*)?/bin/wine.*	--	gen_context(system_u:object_r:wine_exec_t,s0)
+/opt/teamviewer(/.*)?/bin/wine.*	--	gen_context(system_u:object_r:wine_exec_t,s0)
 
 /opt/picasa/wine/bin/wine.*	--	gen_context(system_u:object_r:wine_exec_t,s0)
 
-/usr/bin/msiexec		--	gen_context(system_u:object_r:wine_exec_t,s0)
-/usr/bin/notepad		--	gen_context(system_u:object_r:wine_exec_t,s0)
-/usr/bin/regsvr32		--	gen_context(system_u:object_r:wine_exec_t,s0)
-/usr/bin/regedit		--	gen_context(system_u:object_r:wine_exec_t,s0)
-/usr/bin/uninstaller		--	gen_context(system_u:object_r:wine_exec_t,s0)
-/usr/bin/wine.*			--	gen_context(system_u:object_r:wine_exec_t,s0)
+/usr/bin/msiexec	--	gen_context(system_u:object_r:wine_exec_t,s0)
+/usr/bin/notepad	--	gen_context(system_u:object_r:wine_exec_t,s0)
+/usr/bin/regsvr32	--	gen_context(system_u:object_r:wine_exec_t,s0)
+/usr/bin/regedit	--	gen_context(system_u:object_r:wine_exec_t,s0)
+/usr/bin/uninstaller	--	gen_context(system_u:object_r:wine_exec_t,s0)
+/usr/bin/wine.*	--	gen_context(system_u:object_r:wine_exec_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/wine.if refpolicy/policy/modules/contrib/wine.if
--- refpolicy/policy/modules/contrib/wine.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/wine.if	2012-10-31 19:06:40.467580672 +0100
@@ -1,60 +1,46 @@
-## <summary>Wine Is Not an Emulator.  Run Windows programs in Linux.</summary>
+## <summary>Run Windows programs in Linux.</summary>
 
-#######################################
+########################################
 ## <summary>
-##	The per role template for the wine module.
+##	Role access for wine.
 ## </summary>
-## <desc>
-##	<p>
-##	This template creates a derived domains which are used
-##	for wine applications.
-##	</p>
-## </desc>
-## <param name="userdomain_prefix">
-##	<summary>
-##	The prefix of the user domain (e.g., user
-##	is the prefix for user_t).
-##	</summary>
-## </param>
-## <param name="user_domain">
+## <param name="role">
 ##	<summary>
-##	The type of the user domain.
+##	Role allowed access.
 ##	</summary>
 ## </param>
-## <param name="user_role">
+## <param name="domain">
 ##	<summary>
-##	The role associated with the user domain.
+##	User domain for the role.
 ##	</summary>
 ## </param>
 #
-template(`wine_role',`
+interface(`wine_role',`
 	gen_require(`
-		type wine_exec_t;
+		attribute_role wine_roles;
+		type wine_exec_t, wine_t, wine_tmp_t;
+		type wine_home_t;
 	')
 
-	role $1 types wine_t;
+	roleattribute $1 wine_roles;
+
+	domtrans_pattern($2, wine_exec_t, wine_t)
 
-	domain_auto_trans($2, wine_exec_t, wine_t)
-	allow wine_t $2:fd use;
-	allow wine_t $2:process { sigchld signull };
 	allow wine_t $2:unix_stream_socket connectto;
+	allow wine_t $2:process signull;
 
-	# Allow the user domain to signal/ps.
 	ps_process_pattern($2, wine_t)
-	allow $2 wine_t:process signal_perms;
+	allow $2 wine_t:process { ptrace signal_perms };
 
 	allow $2 wine_t:fd use;
 	allow $2 wine_t:shm { associate getattr };
-	allow $2 wine_t:shm { unix_read unix_write };
+	allow $2 wine_t:shm rw_shm_perms;
 	allow $2 wine_t:unix_stream_socket connectto;
 
-	# X access, Home files
-	manage_dirs_pattern($2, wine_home_t, wine_home_t)
-	manage_files_pattern($2, wine_home_t, wine_home_t)
-	manage_lnk_files_pattern($2, wine_home_t, wine_home_t)
-	relabel_dirs_pattern($2, wine_home_t, wine_home_t)
-	relabel_files_pattern($2, wine_home_t, wine_home_t)
-	relabel_lnk_files_pattern($2, wine_home_t, wine_home_t)
+	allow $2 { wine_tmp_t wine_home_t }:dir { manage_dir_perms relabel_dir_perms };
+	allow $2 { wine_tmp_t wine_home_t }:file { manage_file_perms relabel_file_perms };
+	allow $2 wine_home_t:lnk_file { manage_lnk_file_perms relabel_lnk_file_perms };
+	userdom_user_home_dir_filetrans($2, wine_home_t, dir, ".wine")
 ')
 
 #######################################
@@ -90,15 +76,17 @@
 	')
 
 	type $1_wine_t;
-	domain_type($1_wine_t)
-	domain_entry_file($1_wine_t, wine_exec_t)
-	ubac_constrained($1_wine_t)
+	userdom_user_application_domain($1_wine_t, wine_exec_t)
 	role $2 types $1_wine_t;
 
 	allow $1_wine_t self:process { execmem execstack };
-	allow $3 $1_wine_t:process { getattr ptrace noatsecure signal_perms };
+
+	allow $3 $1_wine_t:process { ptrace noatsecure signal_perms };
+	ps_process_pattern($3, $1_wine_t)
+
 	domtrans_pattern($3, wine_exec_t, $1_wine_t)
-	corecmd_bin_domtrans($1_wine_t, $1_t)
+
+	corecmd_bin_domtrans($1_wine_t, $3)
 
 	userdom_unpriv_usertype($1, $1_wine_t)
 	userdom_manage_user_tmpfs_files($1_wine_t)
@@ -135,8 +123,9 @@
 
 ########################################
 ## <summary>
-##	Execute wine in the wine domain, and
-##	allow the specified role the wine domain.
+##	Execute wine in the wine domain,
+##	and allow the specified role
+##	the wine domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -151,11 +140,11 @@
 #
 interface(`wine_run',`
 	gen_require(`
-		type wine_t;
+		attribute_role wine_roles;
 	')
 
 	wine_domtrans($1)
-	role $2 types wine_t;
+	roleattribute $2 wine_roles;
 ')
 
 ########################################
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/wine.te refpolicy/policy/modules/contrib/wine.te
--- refpolicy/policy/modules/contrib/wine.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/wine.te	2012-10-31 19:06:40.468580672 +0100
@@ -1,4 +1,4 @@
-policy_module(wine, 1.10.0)
+policy_module(wine, 1.10.1)
 
 ########################################
 #
@@ -6,16 +6,24 @@
 #
 
 ## <desc>
-## <p>
-##	Ignore wine mmap_zero errors.
-## </p>
+##	<p>
+##	Determine whether attempts by
+##	wine to mmap low regions should
+##	be silently blocked.
+##	</p>
 ## </desc>
 gen_tunable(wine_mmap_zero_ignore, false)
 
+attribute_role wine_roles;
+roleattribute system_r wine_roles;
+
 type wine_t;
 type wine_exec_t;
 userdom_user_application_domain(wine_t, wine_exec_t)
-role system_r types wine_t;
+role wine_roles types wine_t;
+
+type wine_home_t;
+userdom_user_home_content(wine_home_t)
 
 type wine_tmp_t;
 userdom_user_tmp_file(wine_tmp_t)
@@ -30,6 +38,8 @@
 
 can_exec(wine_t, wine_exec_t)
 
+userdom_user_home_dir_filetrans(wine_t, wine_home_t, dir, ".wine")
+
 manage_dirs_pattern(wine_t, wine_tmp_t, wine_tmp_t)
 manage_files_pattern(wine_t, wine_tmp_t, wine_tmp_t)
 files_tmp_filetrans(wine_t, wine_tmp_t, { file dir })
@@ -45,11 +55,19 @@
 ')
 
 optional_policy(`
-	hal_dbus_chat(wine_t)
+	dbus_system_bus_client(wine_t)
+
+	optional_policy(`
+		hal_dbus_chat(wine_t)
+	')
+
+	optional_policy(`
+		policykit_dbus_chat(wine_t)
+	')
 ')
 
 optional_policy(`
-	policykit_dbus_chat(wine_t)
+	rtkit_scheduled(wine_t)
 ')
 
 optional_policy(`
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/wireshark.fc refpolicy/policy/modules/contrib/wireshark.fc
--- refpolicy/policy/modules/contrib/wireshark.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/wireshark.fc	2012-10-31 19:06:42.311580676 +0100
@@ -1,3 +1,3 @@
-HOME_DIR/\.wireshark(/.*)? 		gen_context(system_u:object_r:wireshark_home_t,s0)
+HOME_DIR/\.wireshark(/.*)?	gen_context(system_u:object_r:wireshark_home_t,s0)
 
-/usr/bin/wireshark		--	gen_context(system_u:object_r:wireshark_exec_t,s0)
+/usr/bin/wireshark	--	gen_context(system_u:object_r:wireshark_exec_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/wireshark.if refpolicy/policy/modules/contrib/wireshark.if
--- refpolicy/policy/modules/contrib/wireshark.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/wireshark.if	2012-10-31 19:06:43.504580679 +0100
@@ -2,43 +2,44 @@
 
 ############################################################
 ## <summary>
-##	Role access for wireshark
+##	Role access for wireshark.
 ## </summary>
 ## <param name="role">
 ##	<summary>
-##	Role allowed access
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <param name="domain">
 ##	<summary>
-##	User domain for the role
+##	User domain for the role.
 ##	</summary>
 ## </param>
 #
 interface(`wireshark_role',`
 	gen_require(`
-		type wireshark_t, wireshark_exec_t;
-		type wireshark_home_t, wireshark_tmp_t;
-		type wireshark_tmpfs_t;
+		attribute_role wireshark_roles;
+		type wireshark_t, wireshark_exec_t, wireshark_home_t;
+		type wireshark_tmp_t, wireshark_tmpfs_t;
 	')
 
-	role $1 types wireshark_t;
+	roleattribute $1 wireshark_roles;
+
+	domtrans_pattern($2, wireshark_exec_t, wireshark_t)
+
+	allow $2 wireshark_t:process { ptrace signal_perms };
+	ps_process_pattern($2, wireshark_t)
 
-	domain_auto_trans($2, wireshark_exec_t, wireshark_t)
-	allow wireshark_t $2:fd use;
-	allow wireshark_t $2:process sigchld;
-
-	manage_dirs_pattern($2, wireshark_home_t, wireshark_home_t)
-	manage_files_pattern($2, wireshark_home_t, wireshark_home_t)
-	manage_lnk_files_pattern($2, wireshark_home_t, wireshark_home_t)
-	relabel_dirs_pattern($2, wireshark_home_t, wireshark_home_t)
-	relabel_files_pattern($2, wireshark_home_t, wireshark_home_t)
-	relabel_lnk_files_pattern($2, wireshark_home_t, wireshark_home_t)
+	allow $2 { wireshark_tmp_t wireshark_home_t wireshark_tmpfs_t }:dir { manage_dir_perms relabel_dir_perms };
+	allow $2 { wireshark_tmp_t wireshark_home_t wireshark_tmpfs_t }:file { manage_file_perms relabel_file_perms };
+	allow $2 { wireshark_home_t wireshark_tmpfs_t }:lnk_file { manage_lnk_file_perms relabel_lnk_file_perms };
+	allow $2 wireshark_tmpfs_t:sock_file { manage_sock_file_perms relabel_sock_file_perms };
+	allow $2 wireshark_tmpfs_t:fifo_file { manage_fifo_file_perms relabel_fifo_file_perms };
+	userdom_user_home_dir_filetrans($2, wireshark_home_t, dir, ".wireshark")
 ')
 
 ########################################
 ## <summary>
-##	Run wireshark in wireshark domain.
+##	Execute wireshark in wireshark domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -51,5 +52,6 @@
 		type wireshark_t, wireshark_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, wireshark_exec_t, wireshark_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/wireshark.te refpolicy/policy/modules/contrib/wireshark.te
--- refpolicy/policy/modules/contrib/wireshark.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/wireshark.te	2012-10-31 19:06:43.504580679 +0100
@@ -1,15 +1,18 @@
-policy_module(wireshark, 2.3.0)
+policy_module(wireshark, 2.3.1)
 
 ########################################
 #
 # Declarations
 #
 
+attribute_role wireshark_roles;
+
 type wireshark_t;
 type wireshark_exec_t;
 typealias wireshark_t alias { user_wireshark_t staff_wireshark_t sysadm_wireshark_t };
 typealias wireshark_t alias { auditadm_wireshark_t secadm_wireshark_t };
 userdom_user_application_domain(wireshark_t, wireshark_exec_t)
+role wireshark_roles types wireshark_t;
 
 type wireshark_home_t;
 typealias wireshark_home_t alias { user_wireshark_home_t staff_wireshark_home_t sysadm_wireshark_home_t };
@@ -33,24 +36,15 @@
 
 allow wireshark_t self:capability { net_admin net_raw setgid };
 allow wireshark_t self:process { signal getsched };
-allow wireshark_t self:fifo_file { getattr read write };
-allow wireshark_t self:shm destroy;
+allow wireshark_t self:fifo_file rw_fifo_file_perms;
 allow wireshark_t self:shm create_shm_perms;
-allow wireshark_t self:netlink_route_socket { nlmsg_read create_socket_perms };
-allow wireshark_t self:packet_socket { setopt bind ioctl getopt create read write };
-allow wireshark_t self:tcp_socket create_socket_perms;
-allow wireshark_t self:udp_socket create_socket_perms;
-
-# Re-execute itself (why?)
-can_exec(wireshark_t, wireshark_exec_t)
+allow wireshark_t self:packet_socket create_socket_perms;
 
-# /home/.wireshark
 manage_dirs_pattern(wireshark_t, wireshark_home_t, wireshark_home_t)
 manage_files_pattern(wireshark_t, wireshark_home_t, wireshark_home_t)
 manage_lnk_files_pattern(wireshark_t, wireshark_home_t, wireshark_home_t)
-userdom_user_home_dir_filetrans(wireshark_t, wireshark_home_t, dir)
+userdom_user_home_dir_filetrans(wireshark_t, wireshark_home_t, dir, ".wireshark")
 
-# Store temporary files
 manage_dirs_pattern(wireshark_t, wireshark_tmp_t, wireshark_tmp_t)
 manage_files_pattern(wireshark_t, wireshark_tmp_t, wireshark_tmp_t)
 files_tmp_filetrans(wireshark_t, wireshark_tmp_t, { dir file })
@@ -62,37 +56,49 @@
 manage_fifo_files_pattern(wireshark_t, wireshark_tmpfs_t, wireshark_tmpfs_t)
 fs_tmpfs_filetrans(wireshark_t, wireshark_tmpfs_t, { dir file lnk_file sock_file fifo_file })
 
+can_exec(wireshark_t, wireshark_exec_t)
+
 kernel_read_kernel_sysctls(wireshark_t)
 kernel_read_system_state(wireshark_t)
 kernel_read_sysctl(wireshark_t)
 
 corecmd_exec_bin(wireshark_t)
-corecmd_search_bin(wireshark_t)
 
-corenet_tcp_connect_generic_port(wireshark_t)
+corenet_all_recvfrom_unlabeled(wireshark_t)
+corenet_all_recvfrom_netlabel(wireshark_t)
 corenet_tcp_sendrecv_generic_if(wireshark_t)
+corenet_udp_sendrecv_generic_if(wireshark_t)
+corenet_raw_sendrecv_generic_if(wireshark_t)
+corenet_tcp_sendrecv_generic_node(wireshark_t)
+corenet_udp_sendrecv_generic_node(wireshark_t)
+corenet_raw_sendrecv_generic_node(wireshark_t)
+corenet_tcp_sendrecv_all_ports(wireshark_t)
+corenet_udp_sendrecv_all_ports(wireshark_t)
+
+corenet_sendrecv_generic_client_packets(wireshark_t)
+corenet_tcp_connect_generic_port(wireshark_t)
 
 dev_read_rand(wireshark_t)
 dev_read_sysfs(wireshark_t)
 dev_read_urand(wireshark_t)
 
-files_read_etc_files(wireshark_t)
 files_read_usr_files(wireshark_t)
 
+fs_getattr_all_fs(wireshark_t)
 fs_list_inotifyfs(wireshark_t)
 fs_search_auto_mountpoints(wireshark_t)
 
+auth_use_nsswitch(wireshark_t)
+
 libs_read_lib_files(wireshark_t)
 
 miscfiles_read_fonts(wireshark_t)
 miscfiles_read_localization(wireshark_t)
 
-seutil_use_newrole_fds(wireshark_t)
-
-sysnet_read_config(wireshark_t)
+userdom_use_user_terminals(wireshark_t)
 
 userdom_manage_user_home_content_files(wireshark_t)
-userdom_use_user_ptys(wireshark_t)
+userdom_user_home_dir_filetrans_user_home_content(wireshark_t, file)
 
 tunable_policy(`use_nfs_home_dirs',`
 	fs_manage_nfs_dirs(wireshark_t)
@@ -107,10 +113,9 @@
 ')
 
 optional_policy(`
-	nscd_socket_use(wireshark_t)
+	seutil_use_newrole_fds(wireshark_t)
 ')
 
-# Manual transition from userhelper
 optional_policy(`
 	userhelper_use_fd(wireshark_t)
 	userhelper_sigchld(wireshark_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/wm.fc refpolicy/policy/modules/contrib/wm.fc
--- refpolicy/policy/modules/contrib/wm.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/wm.fc	2012-10-31 19:06:47.806580688 +0100
@@ -1,4 +1,4 @@
 /usr/bin/gnome-shell	--	gen_context(system_u:object_r:wm_exec_t,s0)
 /usr/bin/openbox	--	gen_context(system_u:object_r:wm_exec_t,s0)
 /usr/bin/metacity	--	gen_context(system_u:object_r:wm_exec_t,s0)
-/usr/bin/twm		--	gen_context(system_u:object_r:wm_exec_t,s0)
+/usr/bin/twm	--	gen_context(system_u:object_r:wm_exec_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/wm.if refpolicy/policy/modules/contrib/wm.if
--- refpolicy/policy/modules/contrib/wm.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/wm.if	2012-11-02 20:08:32.417957427 +0100
@@ -1,4 +1,4 @@
-## <summary>X Window Managers</summary>
+## <summary>X Window Managers.</summary>
 
 #######################################
 ## <summary>
@@ -29,41 +29,37 @@
 #
 template(`wm_role_template',`
 	gen_require(`
+		attribute wm_domain;
 		type wm_exec_t;
-		class dbus send_msg;
 	')
 
-	type $1_wm_t;
-	domain_type($1_wm_t)
-	domain_entry_file($1_wm_t, wm_exec_t)
+	########################################
+	#
+	# Declarations
+	#
+
+	type $1_wm_t, wm_domain;
+	userdom_user_application_domain($1_wm_t, wm_exec_t)
 	role $2 types $1_wm_t;
 
-	allow $1_wm_t self:fifo_file rw_fifo_file_perms;
-	allow $1_wm_t self:process getsched;
-	allow $1_wm_t self:shm create_shm_perms;
+	########################################
+	#
+	# Policy
+	#
 
 	allow $1_wm_t $3:unix_stream_socket connectto;
 	allow $3 $1_wm_t:unix_stream_socket connectto;
-	allow $3 $1_wm_t:process { signal sigchld signull };
-	allow $1_wm_t $3:process { signull sigkill };
 
-	allow $1_wm_t $3:dbus send_msg;
-	allow $3 $1_wm_t:dbus send_msg;
+	allow $3 $1_wm_t:process { ptrace signal_perms };
+	ps_process_pattern($3, $1_wm_t)
 
-	domtrans_pattern($3, wm_exec_t, $1_wm_t)
+	allow $1_wm_t $3:process { signull sigkill };
 
-	kernel_read_system_state($1_wm_t)
+	domtrans_pattern($3, wm_exec_t, $1_wm_t)
 
 	corecmd_bin_domtrans($1_wm_t, $3)
 	corecmd_shell_domtrans($1_wm_t, $3)
 
-	dev_read_urand($1_wm_t)
-
-	files_read_etc_files($1_wm_t)
-	files_read_usr_files($1_wm_t)
-
-	fs_getattr_tmpfs($1_wm_t)
-
 	mls_file_read_all_levels($1_wm_t)
 	mls_file_write_all_levels($1_wm_t)
 	mls_xwin_read_all_levels($1_wm_t)
@@ -72,18 +68,17 @@
 
 	auth_use_nsswitch($1_wm_t)
 
-	application_signull($1_wm_t)
-
-	miscfiles_read_fonts($1_wm_t)
-	miscfiles_read_localization($1_wm_t)
-
 	optional_policy(`
 		dbus_system_bus_client($1_wm_t)
-		dbus_session_bus_client($1_wm_t)
+		dbus_spec_session_bus_client($1, $1_wm_t)
+
+		optional_policy(`
+			wm_dbus_chat($1, $3)
+		')
 	')
 
 	optional_policy(`
-		pulseaudio_stream_connect($1_wm_t)
+		pulseaudio_run($1_wm_t, $2)
 	')
 
 	optional_policy(`
@@ -94,7 +89,7 @@
 
 ########################################
 ## <summary>
-##	Execute the wm program in the wm domain.
+##	Execute wm in the caller domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -107,5 +102,33 @@
 		type wm_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	can_exec($1, wm_exec_t)
 ')
+
+########################################
+## <summary>
+##	Send and receive messages from
+##	specified wm over dbus.
+## </summary>
+## <param name="role_prefix">
+##	<summary>
+##	The prefix of the user domain (e.g., user
+##	is the prefix for user_t).
+##	</summary>
+## </param>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`wm_dbus_chat',`
+	gen_require(`
+		type $1_wm_t;
+		class dbus send_msg;
+	')
+
+	allow $2 $1_wm_t:dbus send_msg;
+	allow $1_wm_t $2:dbus send_msg;
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/wm.te refpolicy/policy/modules/contrib/wm.te
--- refpolicy/policy/modules/contrib/wm.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/wm.te	2012-11-02 20:08:32.417957427 +0100
@@ -1,9 +1,36 @@
-policy_module(wm, 1.2.0)
+policy_module(wm, 1.2.4)
 
 ########################################
 #
 # Declarations
 #
 
+attribute wm_domain;
+
 type wm_exec_t;
-corecmd_executable_file(wm_exec_t)
+application_executable_file(wm_exec_t)
+
+########################################
+#
+# Common wm domain local policy
+#
+
+allow wm_domain self:fifo_file rw_fifo_file_perms;
+allow wm_domain self:process getsched;
+allow wm_domain self:shm create_shm_perms;
+
+kernel_read_system_state(wm_domain)
+
+dev_read_urand(wm_domain)
+
+files_read_usr_files(wm_domain)
+
+miscfiles_read_fonts(wm_domain)
+miscfiles_read_localization(wm_domain)
+
+userdom_manage_user_tmp_sockets(wm_domain)
+userdom_tmp_filetrans_user_tmp(wm_domain, sock_file)
+
+userdom_manage_user_home_content_dirs(wm_domain)
+userdom_manage_user_home_content_files(wm_domain)
+userdom_user_home_dir_filetrans_user_home_content(wm_domain, { dir file })
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/xdg.fc refpolicy/policy/modules/contrib/xdg.fc
--- refpolicy/policy/modules/contrib/xdg.fc	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/xdg.fc	2012-05-05 16:11:35.857762632 +0200
@@ -0,0 +1,8 @@
+HOME_DIR/\.cache(/.*)?		gen_context(system_u:object_r:xdg_cache_home_t,s0)
+HOME_DIR/\.config(/.*)?		gen_context(system_u:object_r:xdg_config_home_t,s0)
+HOME_DIR/\.local(/.*)?		gen_context(system_u:object_r:xdg_data_home_t,s0)
+
+#
+# /run
+#
+/run/user/USER(/.*)?			gen_context(system_u:object_r:xdg_runtime_home_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/xdg.if refpolicy/policy/modules/contrib/xdg.if
--- refpolicy/policy/modules/contrib/xdg.if	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/xdg.if	2012-07-29 09:03:22.574423958 +0200
@@ -0,0 +1,816 @@
+## <summary>
+##	XDG Desktop Standard locations
+## </summary>
+
+
+########################################
+## <summary>
+##	Mark the selected type as an xdg_cache_home_type
+## </summary>
+## <param name="type">
+##	<summary>
+##	Type to give the xdg_cache_home_type attribute to
+##	</summary>
+## </param>
+#
+interface(`xdg_cache_home_content',`
+	gen_require(`
+		attribute xdg_cache_home_type;
+	')
+
+	typeattribute $1 xdg_cache_home_type;
+
+	userdom_user_home_content($1)
+')
+
+########################################
+## <summary>
+##	Mark the selected type as an xdg_config_home_type
+## </summary>
+## <param name="type">
+##	<summary>
+##	Type to give the xdg_config_home_type attribute to
+##	</summary>
+## </param>
+#
+interface(`xdg_config_home_content',`
+	gen_require(`
+		attribute xdg_config_home_type;
+	')
+
+	typeattribute $1 xdg_config_home_type;
+
+	userdom_user_home_content($1)
+')
+
+########################################
+## <summary>
+##	Mark the selected type as an xdg_data_home_type
+## </summary>
+## <param name="type">
+##	<summary>
+##	Type to give the xdg_data_home_type attribute to
+##	</summary>
+## </param>
+#
+interface(`xdg_data_home_content',`
+	gen_require(`
+		attribute xdg_data_home_type;
+	')
+
+	typeattribute $1 xdg_data_home_type;
+
+	userdom_user_home_content($1)
+')
+
+########################################
+## <summary>
+##	Mark the selected type as an xdg_runtime_home_type
+## </summary>
+## <param name="type">
+##	<summary>
+##	Type to give the xdg_runtime_home_type attribute to
+##	</summary>
+## </param>
+#
+interface(`xdg_runtime_home_content',`
+	gen_require(`
+		attribute xdg_runtime_home_type;
+	')
+
+	typeattribute $1 xdg_runtime_home_type;
+
+	userdom_user_home_content($1)
+')
+
+########################################
+## <summary>
+##	Read the xdg cache home files
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`xdg_read_generic_cache_home_files',`
+	gen_require(`
+		type xdg_cache_home_t;
+	')
+
+	read_files_pattern($1, xdg_cache_home_t, xdg_cache_home_t)
+	list_dirs_pattern($1, xdg_cache_home_t, xdg_cache_home_t)
+
+	userdom_search_user_home_dirs($1)
+')
+
+########################################
+## <summary>
+##	Read all xdg_cache_home_type files
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`xdg_read_all_cache_home_files',`
+	gen_require(`
+		attribute xdg_cache_home_type;
+	')
+
+	read_files_pattern($1, xdg_cache_home_type, xdg_cache_home_type)
+
+	userdom_search_user_home_dirs($1)
+')
+
+########################################
+## <summary>
+##	Create objects in an xdg_cache_home directory
+##	with an automatic type transition to
+##	a specified private type.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="private_type">
+##	<summary>
+##	The type of the object to create.
+##	</summary>
+## </param>
+## <param name="object_class">
+##	<summary>
+##	The class of the object to be created.
+##	</summary>
+## </param>
+## <param name="filename" optional="true">
+##	<summary>
+##	Name of the file or directory created
+##	</summary>
+## </param>
+#
+interface(`xdg_cache_home_filetrans',`
+	gen_require(`
+		type xdg_cache_home_t;
+	')
+
+	userdom_search_user_home_dirs($1)
+
+	filetrans_pattern($1, xdg_cache_home_t, $2, $3, $4)
+')
+
+########################################
+## <summary>
+##	Manage the xdg cache home files
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`xdg_manage_generic_cache_home',`
+	gen_require(`
+		type xdg_cache_home_t;
+	')
+
+	manage_dirs_pattern($1, xdg_cache_home_t, xdg_cache_home_t)
+	manage_files_pattern($1, xdg_cache_home_t, xdg_cache_home_t)
+	manage_lnk_files_pattern($1, xdg_cache_home_t, xdg_cache_home_t)
+	manage_fifo_files_pattern($1, xdg_cache_home_t, xdg_cache_home_t)
+	manage_sock_files_pattern($1, xdg_cache_home_t, xdg_cache_home_t)
+
+	userdom_search_user_home_dirs($1)
+')
+
+########################################
+## <summary>
+##	Manage all the xdg cache home files regardless of their specific type
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`xdg_manage_all_cache_home',`
+	gen_require(`
+		attribute xdg_cache_home_type;
+	')
+
+	manage_dirs_pattern($1, xdg_cache_home_type, xdg_cache_home_type)
+	manage_files_pattern($1, xdg_cache_home_type, xdg_cache_home_type)
+	manage_lnk_files_pattern($1, xdg_cache_home_type, xdg_cache_home_type)
+	manage_fifo_files_pattern($1, xdg_cache_home_type, xdg_cache_home_type)
+	manage_sock_files_pattern($1, xdg_cache_home_type, xdg_cache_home_type)
+
+	userdom_search_user_home_dirs($1)
+')
+
+########################################
+## <summary>
+##	Allow relabeling the xdg cache home files
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`xdg_relabel_generic_cache_home',`
+	gen_require(`
+		type xdg_cache_home_t;
+	')
+
+	relabel_dirs_pattern($1, xdg_cache_home_t, xdg_cache_home_t)
+	relabel_files_pattern($1, xdg_cache_home_t, xdg_cache_home_t)
+	relabel_lnk_files_pattern($1, xdg_cache_home_t, xdg_cache_home_t)
+	relabel_fifo_files_pattern($1, xdg_cache_home_t, xdg_cache_home_t)
+	relabel_sock_files_pattern($1, xdg_cache_home_t, xdg_cache_home_t)
+
+	userdom_search_user_home_dirs($1)
+')
+
+########################################
+## <summary>
+##	Allow relabeling the xdg cache home files, regardless of their specific type
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`xdg_relabel_all_cache_home',`
+	gen_require(`
+		attribute xdg_cache_home_type;
+	')
+
+	relabel_dirs_pattern($1, xdg_cache_home_type, xdg_cache_home_type)
+	relabel_files_pattern($1, xdg_cache_home_type, xdg_cache_home_type)
+	relabel_lnk_files_pattern($1, xdg_cache_home_type, xdg_cache_home_type)
+	relabel_fifo_files_pattern($1, xdg_cache_home_type, xdg_cache_home_type)
+	relabel_sock_files_pattern($1, xdg_cache_home_type, xdg_cache_home_type)
+
+	userdom_search_user_home_dirs($1)
+')
+
+########################################
+## <summary>
+##	Read the xdg config home files
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`xdg_read_generic_config_home_files',`
+	gen_require(`
+		type xdg_config_home_t;
+	')
+
+	read_files_pattern($1, xdg_config_home_t, xdg_config_home_t)
+	list_dirs_pattern($1, xdg_config_home_t, xdg_config_home_t)
+
+	userdom_search_user_home_dirs($1)
+')
+
+########################################
+## <summary>
+##	Read all xdg_config_home_type files
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`xdg_read_all_config_home_files',`
+	gen_require(`
+		attribute xdg_config_home_type;
+	')
+
+	read_files_pattern($1, xdg_config_home_type, xdg_config_home_type)
+
+	userdom_search_user_home_dirs($1)
+')
+
+########################################
+## <summary>
+##	Create objects in an xdg_config_home directory
+##	with an automatic type transition to
+##	a specified private type.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="private_type">
+##	<summary>
+##	The type of the object to create.
+##	</summary>
+## </param>
+## <param name="object_class">
+##	<summary>
+##	The class of the object to be created.
+##	</summary>
+## </param>
+## <param name="filename" optional="true">
+##	<summary>
+##	Name of the file or directory created
+##	</summary>
+## </param>
+#
+interface(`xdg_config_home_filetrans',`
+	gen_require(`
+		type xdg_config_home_t;
+	')
+
+	userdom_search_user_home_dirs($1)
+
+	filetrans_pattern($1, xdg_config_home_t, $2, $3, $4)
+')
+
+########################################
+## <summary>
+##	Manage the xdg config home files
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`xdg_manage_generic_config_home',`
+	gen_require(`
+		type xdg_config_home_t;
+	')
+
+	manage_dirs_pattern($1, xdg_config_home_t, xdg_config_home_t)
+	manage_files_pattern($1, xdg_config_home_t, xdg_config_home_t)
+	manage_lnk_files_pattern($1, xdg_config_home_t, xdg_config_home_t)
+	manage_fifo_files_pattern($1, xdg_config_home_t, xdg_config_home_t)
+	manage_sock_files_pattern($1, xdg_config_home_t, xdg_config_home_t)
+
+	userdom_search_user_home_dirs($1)
+')
+
+########################################
+## <summary>
+##	Manage all the xdg config home files regardless of their specific type
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`xdg_manage_all_config_home',`
+	gen_require(`
+		attribute xdg_config_home_type;
+	')
+
+	manage_dirs_pattern($1, xdg_config_home_type, xdg_config_home_type)
+	manage_files_pattern($1, xdg_config_home_type, xdg_config_home_type)
+	manage_lnk_files_pattern($1, xdg_config_home_type, xdg_config_home_type)
+	manage_fifo_files_pattern($1, xdg_config_home_type, xdg_config_home_type)
+	manage_sock_files_pattern($1, xdg_config_home_type, xdg_config_home_type)
+
+	userdom_search_user_home_dirs($1)
+')
+
+########################################
+## <summary>
+##	Allow relabeling the xdg config home files
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`xdg_relabel_generic_config_home',`
+	gen_require(`
+		type xdg_config_home_t;
+	')
+
+	relabel_dirs_pattern($1, xdg_config_home_t, xdg_config_home_t)
+	relabel_files_pattern($1, xdg_config_home_t, xdg_config_home_t)
+	relabel_lnk_files_pattern($1, xdg_config_home_t, xdg_config_home_t)
+	relabel_fifo_files_pattern($1, xdg_config_home_t, xdg_config_home_t)
+	relabel_sock_files_pattern($1, xdg_config_home_t, xdg_config_home_t)
+
+	userdom_search_user_home_dirs($1)
+')
+
+########################################
+## <summary>
+##	Allow relabeling the xdg config home files, regardless of their specific type
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`xdg_relabel_all_config_home',`
+	gen_require(`
+		attribute xdg_config_home_type;
+	')
+
+	relabel_dirs_pattern($1, xdg_config_home_type, xdg_config_home_type)
+	relabel_files_pattern($1, xdg_config_home_type, xdg_config_home_type)
+	relabel_lnk_files_pattern($1, xdg_config_home_type, xdg_config_home_type)
+	relabel_fifo_files_pattern($1, xdg_config_home_type, xdg_config_home_type)
+	relabel_sock_files_pattern($1, xdg_config_home_type, xdg_config_home_type)
+
+	userdom_search_user_home_dirs($1)
+')
+
+########################################
+## <summary>
+##	Read the xdg data home files
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`xdg_read_generic_data_home_files',`
+	gen_require(`
+		type xdg_data_home_t;
+	')
+
+	read_files_pattern($1, xdg_data_home_t, xdg_data_home_t)
+	list_dirs_pattern($1, xdg_data_home_t, xdg_data_home_t)
+
+	userdom_search_user_home_dirs($1)
+')
+
+########################################
+## <summary>
+##	Read all xdg_data_home_type files
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`xdg_read_all_data_home_files',`
+	gen_require(`
+		attribute xdg_data_home_type;
+	')
+
+	read_files_pattern($1, xdg_data_home_type, xdg_data_home_type)
+
+	userdom_search_user_home_dirs($1)
+')
+
+########################################
+## <summary>
+##	Create objects in an xdg_data_home directory
+##	with an automatic type transition to
+##	a specified private type.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="private_type">
+##	<summary>
+##	The type of the object to create.
+##	</summary>
+## </param>
+## <param name="object_class">
+##	<summary>
+##	The class of the object to be created.
+##	</summary>
+## </param>
+## <param name="filename" optional="true">
+##	<summary>
+##	Optional name of the file or directory created
+##	</summary>
+## </param>
+#
+interface(`xdg_data_home_filetrans',`
+	gen_require(`
+		type xdg_data_home_t;
+	')
+
+	userdom_search_user_home_dirs($1)
+
+	filetrans_pattern($1, xdg_data_home_t, $2, $3, $4)
+')
+
+########################################
+## <summary>
+##	Manage the xdg data home files
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`xdg_manage_generic_data_home',`
+	gen_require(`
+		type xdg_data_home_t;
+	')
+
+	manage_dirs_pattern($1, xdg_data_home_t, xdg_data_home_t)
+	manage_files_pattern($1, xdg_data_home_t, xdg_data_home_t)
+	manage_lnk_files_pattern($1, xdg_data_home_t, xdg_data_home_t)
+	manage_fifo_files_pattern($1, xdg_data_home_t, xdg_data_home_t)
+	manage_sock_files_pattern($1, xdg_data_home_t, xdg_data_home_t)
+
+	userdom_search_user_home_dirs($1)
+')
+
+########################################
+## <summary>
+##	Manage all the xdg data home files, regardless of their specific type
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`xdg_manage_all_data_home',`
+	gen_require(`
+		attribute xdg_data_home_type;
+	')
+
+	manage_dirs_pattern($1, xdg_data_home_type, xdg_data_home_type)
+	manage_files_pattern($1, xdg_data_home_type, xdg_data_home_type)
+	manage_lnk_files_pattern($1, xdg_data_home_type, xdg_data_home_type)
+	manage_fifo_files_pattern($1, xdg_data_home_type, xdg_data_home_type)
+	manage_sock_files_pattern($1, xdg_data_home_type, xdg_data_home_type)
+
+	userdom_search_user_home_dirs($1)
+')
+
+########################################
+## <summary>
+##	Allow relabeling the xdg data home files
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`xdg_relabel_generic_data_home',`
+	gen_require(`
+		type xdg_data_home_t;
+	')
+
+	relabel_dirs_pattern($1, xdg_data_home_t, xdg_data_home_t)
+	relabel_files_pattern($1, xdg_data_home_t, xdg_data_home_t)
+	relabel_lnk_files_pattern($1, xdg_data_home_t, xdg_data_home_t)
+	relabel_fifo_files_pattern($1, xdg_data_home_t, xdg_data_home_t)
+	relabel_sock_files_pattern($1, xdg_data_home_t, xdg_data_home_t)
+
+	userdom_search_user_home_dirs($1)
+')
+
+########################################
+## <summary>
+##	Allow relabeling the xdg data home files, regardless of their type
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`xdg_relabel_all_data_home',`
+	gen_require(`
+		attribute xdg_data_home_type;
+	')
+
+	relabel_dirs_pattern($1, xdg_data_home_type, xdg_data_home_type)
+	relabel_files_pattern($1, xdg_data_home_type, xdg_data_home_type)
+	relabel_lnk_files_pattern($1, xdg_data_home_type, xdg_data_home_type)
+	relabel_fifo_files_pattern($1, xdg_data_home_type, xdg_data_home_type)
+	relabel_sock_files_pattern($1, xdg_data_home_type, xdg_data_home_type)
+
+	userdom_search_user_home_dirs($1)
+')
+#########################################
+## <summary>
+##	Manage downloaded content
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access
+##	</summary>
+## </param>
+#
+interface(`xdg_manage_downloads_home',`
+	gen_require(`
+		type xdg_downloads_home_t;
+	')
+
+	manage_dirs_pattern($1, xdg_downloads_home_t, xdg_downloads_home_t)
+	manage_files_pattern($1, xdg_downloads_home_t, xdg_downloads_home_t)
+')
+
+########################################
+## <summary>
+##	Read the xdg runtime home files
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`xdg_read_generic_runtime_home_files',`
+	gen_require(`
+		type xdg_runtime_home_t;
+	')
+
+	read_files_pattern($1, xdg_runtime_home_t, xdg_runtime_home_t)
+	list_dirs_pattern($1, xdg_runtime_home_t, xdg_runtime_home_t)
+
+	files_search_pids($1)
+')
+
+########################################
+## <summary>
+##	Read all xdg_runtime_home_type files
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`xdg_read_all_runtime_home_files',`
+	gen_require(`
+		attribute xdg_runtime_home_type;
+	')
+
+	read_files_pattern($1, xdg_runtime_home_type, xdg_runtime_home_type)
+
+	files_search_pids($1)
+')
+
+########################################
+## <summary>
+##	Create objects in an xdg_runtime_home directory
+##	with an automatic type transition to
+##	a specified private type.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="private_type">
+##	<summary>
+##	The type of the object to create.
+##	</summary>
+## </param>
+## <param name="object_class">
+##	<summary>
+##	The class of the object to be created.
+##	</summary>
+## </param>
+## <param name="filename" optional="true">
+##	<summary>
+##	Name of the file or directory created
+##	</summary>
+## </param>
+#
+interface(`xdg_runtime_home_filetrans',`
+	gen_require(`
+		type xdg_runtime_home_t;
+	')
+
+	files_search_pids($1)
+
+	filetrans_pattern($1, xdg_runtime_home_t, $2, $3)
+')
+
+########################################
+## <summary>
+##	Manage the xdg runtime home files
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`xdg_manage_generic_runtime_home',`
+	gen_require(`
+		type xdg_runtime_home_t;
+	')
+
+	manage_dirs_pattern($1, xdg_runtime_home_t, xdg_runtime_home_t)
+	manage_files_pattern($1, xdg_runtime_home_t, xdg_runtime_home_t)
+	manage_lnk_files_pattern($1, xdg_runtime_home_t, xdg_runtime_home_t)
+	manage_fifo_files_pattern($1, xdg_runtime_home_t, xdg_runtime_home_t)
+	manage_sock_files_pattern($1, xdg_runtime_home_t, xdg_runtime_home_t)
+
+	files_search_pids($1)
+')
+
+########################################
+## <summary>
+##	Manage all the xdg runtime home files, regardless of their specific type
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`xdg_manage_all_runtime_home',`
+	gen_require(`
+		attribute xdg_runtime_home_type;
+	')
+
+	manage_dirs_pattern($1, xdg_runtime_home_type, xdg_runtime_home_type)
+	manage_files_pattern($1, xdg_runtime_home_type, xdg_runtime_home_type)
+	manage_lnk_files_pattern($1, xdg_runtime_home_type, xdg_runtime_home_type)
+	manage_fifo_files_pattern($1, xdg_runtime_home_type, xdg_runtime_home_type)
+	manage_sock_files_pattern($1, xdg_runtime_home_type, xdg_runtime_home_type)
+
+	files_search_pids($1)
+')
+
+########################################
+## <summary>
+##	Allow relabeling the xdg runtime home files
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`xdg_relabel_generic_runtime_home',`
+	gen_require(`
+		type xdg_runtime_home_t;
+	')
+
+	relabel_dirs_pattern($1, xdg_runtime_home_t, xdg_runtime_home_t)
+	relabel_files_pattern($1, xdg_runtime_home_t, xdg_runtime_home_t)
+	relabel_lnk_files_pattern($1, xdg_runtime_home_t, xdg_runtime_home_t)
+	relabel_fifo_files_pattern($1, xdg_runtime_home_t, xdg_runtime_home_t)
+	relabel_sock_files_pattern($1, xdg_runtime_home_t, xdg_runtime_home_t)
+
+	files_search_pids($1)
+')
+
+########################################
+## <summary>
+##	Allow relabeling the xdg runtime home files, regardless of the specific type
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`xdg_relabel_all_runtime_home',`
+	gen_require(`
+		attribute xdg_runtime_home_type;
+	')
+
+	relabel_dirs_pattern($1, xdg_runtime_home_type, xdg_runtime_home_type)
+	relabel_files_pattern($1, xdg_runtime_home_type, xdg_runtime_home_type)
+	relabel_lnk_files_pattern($1, xdg_runtime_home_type, xdg_runtime_home_type)
+	relabel_fifo_files_pattern($1, xdg_runtime_home_type, xdg_runtime_home_type)
+	relabel_sock_files_pattern($1, xdg_runtime_home_type, xdg_runtime_home_type)
+
+	files_search_pids($1)
+')
+#########################################
+## <summary>
+##	Manage video content
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access
+##	</summary>
+## </param>
+#
+interface(`xdg_manage_videos_home',`
+	gen_require(`
+		type xdg_videos_home_t;
+	')
+
+	manage_dirs_pattern($1, xdg_videos_home_t, xdg_videos_home_t)
+	manage_files_pattern($1, xdg_videos_home_t, xdg_videos_home_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/xdg.te refpolicy/policy/modules/contrib/xdg.te
--- refpolicy/policy/modules/contrib/xdg.te	1970-01-01 01:00:00.000000000 +0100
+++ refpolicy/policy/modules/contrib/xdg.te	2012-07-27 10:30:11.351066246 +0200
@@ -0,0 +1,42 @@
+policy_module(xdg, 1.0.0)
+
+########################################
+#
+# Declarations
+#
+
+attribute xdg_data_home_type;
+
+attribute xdg_config_home_type;
+
+attribute xdg_cache_home_type;
+
+attribute xdg_runtime_home_type;
+
+type xdg_data_home_t;
+xdg_data_home_content(xdg_data_home_t)
+
+type xdg_config_home_t;
+xdg_config_home_content(xdg_config_home_t)
+
+type xdg_cache_home_t;
+xdg_cache_home_content(xdg_cache_home_t)
+
+type xdg_runtime_home_t;
+xdg_runtime_home_content(xdg_runtime_home_t)
+
+# Various user location types (see ~/.config/user-dirs.dirs)
+type xdg_downloads_home_t; # customizable
+userdom_user_home_content(xdg_downloads_home_t)
+
+type xdg_documents_home_t; # customizable
+userdom_user_home_content(xdg_documents_home_t)
+
+type xdg_music_home_t; # customizable
+userdom_user_home_content(xdg_documents_home_t)
+
+type xdg_pictures_home_t; # customizable
+userdom_user_home_content(xdg_pictures_home_t)
+
+type xdg_videos_home_t; # customizable
+userdom_user_home_content(xdg_videos_home_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/xen.fc refpolicy/policy/modules/contrib/xen.fc
--- refpolicy/policy/modules/contrib/xen.fc	2012-05-04 16:10:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/xen.fc	2012-11-02 20:08:08.193957375 +0100
@@ -1,43 +1,38 @@
 /dev/xen/tapctrl.*	-p	gen_context(system_u:object_r:xenctl_t,s0)
 
-/usr/bin/virsh		--	gen_context(system_u:object_r:xm_exec_t,s0)
+/usr/lib/xen-[^/]*/bin/xenconsoled	--	gen_context(system_u:object_r:xenconsoled_exec_t,s0)
+/usr/lib/xen-[^/]*/bin/xend	--	gen_context(system_u:object_r:xend_exec_t,s0)
+/usr/lib/xen-[^/]*/bin/xenstored	--	gen_context(system_u:object_r:xenstored_exec_t,s0)
+/usr/lib/xen-[^/]*/bin/xl	--	gen_context(system_u:object_r:xm_exec_t,s0)
+/usr/lib/xen-[^/]*/bin/xm	--	gen_context(system_u:object_r:xm_exec_t,s0)
 
 /usr/sbin/blktapctrl	--	gen_context(system_u:object_r:blktap_exec_t,s0)
 /usr/sbin/evtchnd	--	gen_context(system_u:object_r:evtchnd_exec_t,s0)
 /usr/sbin/tapdisk	--	gen_context(system_u:object_r:blktap_exec_t,s0)
-
-/usr/lib/xen/bin/qemu-dm	-- gen_context(system_u:object_r:qemu_dm_exec_t,s0)
-
-ifdef(`distro_debian',`
-/usr/lib/xen-[^/]*/bin/xenconsoled -- gen_context(system_u:object_r:xenconsoled_exec_t,s0)
-/usr/lib/xen-[^/]*/bin/xend --	gen_context(system_u:object_r:xend_exec_t,s0)
-/usr/lib/xen-[^/]*/bin/xenstored -- gen_context(system_u:object_r:xenstored_exec_t,s0)
-/usr/lib/xen-[^/]*/bin/xm --	gen_context(system_u:object_r:xm_exec_t,s0)
-',`
 /usr/sbin/xenconsoled	--	gen_context(system_u:object_r:xenconsoled_exec_t,s0)
-/usr/sbin/xend		--	gen_context(system_u:object_r:xend_exec_t,s0)
+/usr/sbin/xend	--	gen_context(system_u:object_r:xend_exec_t,s0)
 /usr/sbin/xenstored	--	gen_context(system_u:object_r:xenstored_exec_t,s0)
-/usr/sbin/xm		--	gen_context(system_u:object_r:xm_exec_t,s0)
-')
+/usr/sbin/xl	--	gen_context(system_u:object_r:xm_exec_t,s0)
+/usr/sbin/xm	--	gen_context(system_u:object_r:xm_exec_t,s0)
 
-/var/lib/xen(/.*)?		gen_context(system_u:object_r:xend_var_lib_t,s0)
+/var/lib/xen(/.*)?	gen_context(system_u:object_r:xend_var_lib_t,s0)
 /var/lib/xen/images(/.*)?	gen_context(system_u:object_r:xen_image_t,s0)
-/var/lib/xend(/.*)?		gen_context(system_u:object_r:xend_var_lib_t,s0)
+/var/lib/xend(/.*)?	gen_context(system_u:object_r:xend_var_lib_t,s0)
 /var/lib/xenstored(/.*)?	gen_context(system_u:object_r:xenstored_var_lib_t,s0)
 
-/var/log/evtchnd\.log	--	gen_context(system_u:object_r:evtchnd_var_log_t,s0)
-/var/log/xen(/.*)?		gen_context(system_u:object_r:xend_var_log_t,s0)
-/var/log/xen-hotplug\.log --	gen_context(system_u:object_r:xend_var_log_t,s0)
-/var/log/xend\.log	--	gen_context(system_u:object_r:xend_var_log_t,s0)
-/var/log/xend-debug\.log --	gen_context(system_u:object_r:xend_var_log_t,s0)
+/var/log/evtchnd\.log.*	--	gen_context(system_u:object_r:evtchnd_var_log_t,s0)
+/var/log/xen(/.*)?	gen_context(system_u:object_r:xend_var_log_t,s0)
+/var/log/xen-hotplug\.log.*	--	gen_context(system_u:object_r:xend_var_log_t,s0)
+/var/log/xend\.log.*	--	gen_context(system_u:object_r:xend_var_log_t,s0)
+/var/log/xend-debug\.log.*	--	gen_context(system_u:object_r:xend_var_log_t,s0)
 
 /var/run/evtchnd	-s	gen_context(system_u:object_r:evtchnd_var_run_t,s0)
 /var/run/evtchnd\.pid	--	gen_context(system_u:object_r:evtchnd_var_run_t,s0)
-/var/run/xenconsoled\.pid --	gen_context(system_u:object_r:xenconsoled_var_run_t,s0)
-/var/run/xend(/.*)?		gen_context(system_u:object_r:xend_var_run_t,s0)
+/var/run/xenconsoled\.pid	--	gen_context(system_u:object_r:xenconsoled_var_run_t,s0)
+/var/run/xend(/.*)?	gen_context(system_u:object_r:xend_var_run_t,s0)
 /var/run/xend\.pid	--	gen_context(system_u:object_r:xend_var_run_t,s0)
-/var/run/xenner(/.*)?		gen_context(system_u:object_r:xend_var_run_t,s0)
+/var/run/xenner(/.*)?	gen_context(system_u:object_r:xend_var_run_t,s0)
 /var/run/xenstore\.pid	--	gen_context(system_u:object_r:xenstored_var_run_t,s0)
 /var/run/xenstored(/.*)?	gen_context(system_u:object_r:xenstored_var_run_t,s0)
 
-/xen(/.*)?			gen_context(system_u:object_r:xen_image_t,s0)
+/xen(/.*)?	gen_context(system_u:object_r:xen_image_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/xen.if refpolicy/policy/modules/contrib/xen.if
--- refpolicy/policy/modules/contrib/xen.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/xen.if	2012-11-02 20:08:08.193957375 +0100
@@ -1,13 +1,13 @@
-## <summary>Xen hypervisor</summary>
+## <summary>Xen hypervisor.</summary>
 
 ########################################
 ## <summary>
 ##	Execute a domain transition to run xend.
 ## </summary>
 ## <param name="domain">
-## 	<summary>
+##	<summary>
 ##	Domain allowed to transition.
-## 	</summary>
+##	</summary>
 ## </param>
 #
 interface(`xen_domtrans',`
@@ -15,11 +15,31 @@
 		type xend_t, xend_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, xend_exec_t, xend_t)
 ')
 
 ########################################
 ## <summary>
+##	Execute xend in the caller domain.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`xen_exec',`
+	gen_require(`
+		type xend_exec_t;
+	')
+
+	corecmd_search_bin($1)
+	can_exec($1, xend_exec_t)
+')
+
+########################################
+## <summary>
 ##	Inherit and use xen file descriptors.
 ## </summary>
 ## <param name="domain">
@@ -57,12 +77,32 @@
 
 ########################################
 ## <summary>
+##	Create, read, write, and delete
+##	xend image directories.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`xen_manage_image_dirs',`
+	gen_require(`
+		type xend_var_lib_t;
+	')
+
+	files_search_var_lib($1)
+	manage_dirs_pattern($1, xend_var_lib_t, xend_var_lib_t)
+')
+
+########################################
+## <summary>
 ##	Read xend image files.
 ## </summary>
 ## <param name="domain">
-## 	<summary>
+##	<summary>
 ##	Domain allowed access.
-## 	</summary>
+##	</summary>
 ## </param>
 #
 interface(`xen_read_image_files',`
@@ -71,20 +111,18 @@
 	')
 
 	files_list_var_lib($1)
-
 	list_dirs_pattern($1, xend_var_lib_t, xend_var_lib_t)
 	read_files_pattern($1, { xend_var_lib_t xen_image_t }, xen_image_t)
 ')
 
 ########################################
 ## <summary>
-##	Allow the specified domain to read/write
-##	xend image files.
+##	Read and write xend image files.
 ## </summary>
 ## <param name="domain">
-## 	<summary>
+##	<summary>
 ##	Domain allowed access.
-## 	</summary>
+##	</summary>
 ## </param>
 #
 interface(`xen_rw_image_files',`
@@ -99,8 +137,7 @@
 
 ########################################
 ## <summary>
-##	Allow the specified domain to append
-##	xend log files.
+##	Append xend log files.
 ## </summary>
 ## <param name="domain">
 ## 	<summary>
@@ -120,13 +157,13 @@
 
 ########################################
 ## <summary>
-##	Create, read, write, and delete the
+##	Create, read, write, and delete
 ##	xend log files.
 ## </summary>
 ## <param name="domain">
-## 	<summary>
+##	<summary>
 ##	Domain allowed access.
-## 	</summary>
+##	</summary>
 ## </param>
 #
 interface(`xen_manage_log',`
@@ -139,11 +176,29 @@
 	manage_files_pattern($1, xend_var_log_t, xend_var_log_t)
 ')
 
+#######################################
+## <summary>
+##	Read xenstored pid files.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`xen_read_xenstored_pid_files',`
+	gen_require(`
+		type xenstored_var_run_t;
+	')
+
+	files_search_pids($1)
+	read_files_pattern($1, xenstored_var_run_t, xenstored_var_run_t)
+')
+
 ########################################
 ## <summary>
 ##	Do not audit attempts to read and write
-##	Xen unix domain stream sockets.  These
-##	are leaked file descriptors.
+##	Xen unix domain stream sockets.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -161,7 +216,8 @@
 
 ########################################
 ## <summary>
-##	Connect to xenstored over an unix stream socket.
+##	Connect to xenstored with a unix
+##	domain stream socket.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -180,7 +236,8 @@
 
 ########################################
 ## <summary>
-##	Connect to xend over an unix domain stream socket.
+##	Connect to xend with a unix
+##	domain stream socket.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -215,12 +272,14 @@
 		type xm_t, xm_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, xm_exec_t, xm_t)
 ')
 
 ########################################
 ## <summary>
-##	Connect to xm over an unix stream socket.
+##	Connect to xm with a unix
+##	domain stream socket.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/xen.te refpolicy/policy/modules/contrib/xen.te
--- refpolicy/policy/modules/contrib/xen.te	2012-07-25 20:33:05.000000000 +0200
+++ refpolicy/policy/modules/contrib/xen.te	2012-11-02 20:08:08.209957370 +0100
@@ -1,4 +1,4 @@
-policy_module(xen, 1.12.0)
+policy_module(xen, 1.12.3)
 
 ########################################
 #
@@ -6,28 +6,37 @@
 #
 
 ## <desc>
-## <p>
-## Allow xend to run blktapctrl/tapdisk.
-## Not required if using dedicated logical volumes for disk images.
+##	<p>
+##	Determine whether xend can
+##	run blktapctrl and tapdisk.
 ## </p>
 ## </desc>
-gen_tunable(xend_run_blktap, true)
+gen_tunable(xend_run_blktap, false)
 
 ## <desc>
-## <p>
-## Allow xend to run qemu-dm.
-## Not required if using paravirt and no vfb.
-## </p>
+##	<p>
+##	Determine whether xen can
+##	use fusefs file systems.
+##	</p>
 ## </desc>
-gen_tunable(xend_run_qemu, true)
+gen_tunable(xen_use_fusefs, false)
 
 ## <desc>
-## <p>
-## Allow xen to manage nfs files
-## </p>
+##	<p>
+##	Determine whether xen can
+##	use nfs file systems.
+##	</p>
 ## </desc>
 gen_tunable(xen_use_nfs, false)
 
+## <desc>
+##	<p>
+##	Determine whether xen can
+##	use samba file systems.
+##	</p>
+## </desc>
+gen_tunable(xen_use_samba, false)
+
 type blktap_t;
 type blktap_exec_t;
 domain_type(blktap_t)
@@ -41,54 +50,41 @@
 type evtchnd_exec_t;
 init_daemon_domain(evtchnd_t, evtchnd_exec_t)
 
-# log files
 type evtchnd_var_log_t;
 logging_log_file(evtchnd_var_log_t)
 
-# pid files
 type evtchnd_var_run_t;
 files_pid_file(evtchnd_var_run_t)
 
-type qemu_dm_t;
-type qemu_dm_exec_t;
-domain_type(qemu_dm_t)
-domain_entry_file(qemu_dm_t, qemu_dm_exec_t)
-role system_r types qemu_dm_t;
-
-# console ptys
 type xen_devpts_t;
 term_pty(xen_devpts_t)
 files_type(xen_devpts_t)
 
-# Xen Image files
 type xen_image_t; # customizable
 files_type(xen_image_t)
-# xen_image_t can be assigned to blk devices
 dev_node(xen_image_t)
 
+optional_policy(`
+	virt_image(xen_image_t)
+')
+
 type xenctl_t;
 files_type(xenctl_t)
 
 type xend_t;
 type xend_exec_t;
-domain_type(xend_t)
 init_daemon_domain(xend_t, xend_exec_t)
 
-# tmp files
 type xend_tmp_t;
 files_tmp_file(xend_tmp_t)
 
-# var/lib files
 type xend_var_lib_t;
 files_type(xend_var_lib_t)
-# for mounting an NFS store
 files_mountpoint(xend_var_lib_t)
 
-# log files
 type xend_var_log_t;
 logging_log_file(xend_var_log_t)
 
-# pid files
 type xend_var_run_t;
 files_pid_file(xend_var_run_t)
 files_mountpoint(xend_var_run_t)
@@ -100,16 +96,13 @@
 type xenstored_tmp_t;
 files_tmp_file(xenstored_tmp_t)
 
-# var/lib files
 type xenstored_var_lib_t;
 files_type(xenstored_var_lib_t)
 files_mountpoint(xenstored_var_lib_t)
 
-# log files
 type xenstored_var_log_t;
 logging_log_file(xenstored_var_log_t)
 
-# pid files
 type xenstored_var_run_t;
 files_pid_file(xenstored_var_run_t)
 
@@ -117,22 +110,19 @@
 type xenconsoled_exec_t;
 init_daemon_domain(xenconsoled_t, xenconsoled_exec_t)
 
-# pid files
 type xenconsoled_var_run_t;
 files_pid_file(xenconsoled_var_run_t)
 
 type xm_t;
 type xm_exec_t;
-domain_type(xm_t)
 init_system_domain(xm_t, xm_exec_t)
 
 ########################################
 #
 # blktap local policy
 #
-# Do we need to allow execution of blktap?
+
 tunable_policy(`xend_run_blktap',`
-        # If yes, transition to its own domain.
 	domtrans_pattern(xend_t, blktap_exec_t, blktap_t)
 
 	allow blktap_t self:fifo_file { read write };
@@ -148,7 +138,6 @@
 
 	xen_stream_connect_xenstore(blktap_t)
 ',`
-        # If no, then silently refuse to run it.
 	dontaudit xend_t blktap_exec_t:file { execute execute_no_trans };
 ')
 
@@ -158,7 +147,9 @@
 #
 
 manage_dirs_pattern(evtchnd_t, evtchnd_var_log_t, evtchnd_var_log_t)
-manage_files_pattern(evtchnd_t, evtchnd_var_log_t, evtchnd_var_log_t)
+append_files_pattern(evtchnd_t, evtchnd_var_log_t, evtchnd_var_log_t)
+create_files_pattern(evtchnd_t, evtchnd_var_log_t, evtchnd_var_log_t)
+setattr_files_pattern(evtchnd_t, evtchnd_var_log_t, evtchnd_var_log_t)
 logging_log_filetrans(evtchnd_t, evtchnd_var_log_t, { file dir })
 
 manage_dirs_pattern(evtchnd_t, evtchnd_var_run_t, evtchnd_var_run_t)
@@ -168,57 +159,18 @@
 
 ########################################
 #
-# qemu-dm local policy
-#
-# Do we need to allow execution of qemu-dm?
-tunable_policy(`xend_run_qemu',`
-	allow qemu_dm_t self:capability sys_resource;
-	allow qemu_dm_t self:process setrlimit;
-	allow qemu_dm_t self:fifo_file { read write };
-	allow qemu_dm_t self:tcp_socket create_stream_socket_perms;
-
-	# If yes, transition to its own domain.
-	domtrans_pattern(xend_t, qemu_dm_exec_t, qemu_dm_t)
-
-	append_files_pattern(qemu_dm_t, xend_var_log_t, xend_var_log_t)
-
-	rw_fifo_files_pattern(qemu_dm_t, xend_var_run_t, xend_var_run_t)
-
-	corenet_tcp_bind_generic_node(qemu_dm_t)
-	corenet_tcp_bind_vnc_port(qemu_dm_t)
-
-	dev_rw_xen(qemu_dm_t)
-
-	files_read_etc_files(qemu_dm_t)
-	files_read_usr_files(qemu_dm_t)
-
-	fs_manage_xenfs_dirs(qemu_dm_t)
-	fs_manage_xenfs_files(qemu_dm_t)
-
-	miscfiles_read_localization(qemu_dm_t)
-
-	xen_stream_connect_xenstore(qemu_dm_t)
-',`
-        # If no, then silently refuse to run it.
-	dontaudit xend_t qemu_dm_exec_t:file { execute execute_no_trans };
-')
-
-########################################
-#
 # xend local policy
 #
 
-allow xend_t self:capability { dac_override ipc_lock net_admin setuid sys_nice sys_tty_config net_raw };
+allow xend_t self:capability { dac_override ipc_lock net_admin setuid sys_admin sys_nice sys_tty_config net_raw sys_resource };
 dontaudit xend_t self:capability { sys_ptrace };
-allow xend_t self:process { signal sigkill };
+allow xend_t self:process { setrlimit signal sigkill };
 dontaudit xend_t self:process ptrace;
-# internal communication is often done using fifo and unix sockets.
 allow xend_t self:fifo_file rw_fifo_file_perms;
-allow xend_t self:unix_stream_socket create_stream_socket_perms;
-allow xend_t self:unix_dgram_socket create_socket_perms;
-allow xend_t self:netlink_route_socket r_netlink_socket_perms;
-allow xend_t self:tcp_socket create_stream_socket_perms;
+allow xend_t self:unix_stream_socket { accept listen };
+allow xend_t self:tcp_socket { accept listen };
 allow xend_t self:packet_socket create_socket_perms;
+allow xend_t self:tun_socket create_socket_perms;
 
 allow xend_t xen_image_t:dir list_dir_perms;
 manage_dirs_pattern(xend_t, xen_image_t, xen_image_t)
@@ -233,37 +185,33 @@
 manage_dirs_pattern(xend_t, xend_tmp_t, xend_tmp_t)
 files_tmp_filetrans(xend_t, xend_tmp_t, { file dir })
 
-# pid file
 manage_dirs_pattern(xend_t, xend_var_run_t, xend_var_run_t)
 manage_files_pattern(xend_t, xend_var_run_t, xend_var_run_t)
 manage_sock_files_pattern(xend_t, xend_var_run_t, xend_var_run_t)
 manage_fifo_files_pattern(xend_t, xend_var_run_t, xend_var_run_t)
 files_pid_filetrans(xend_t, xend_var_run_t, { file sock_file fifo_file dir })
 
-# log files
 manage_dirs_pattern(xend_t, xend_var_log_t, xend_var_log_t)
-manage_files_pattern(xend_t, xend_var_log_t, xend_var_log_t)
+append_files_pattern(xend_t, xend_var_log_t, xend_var_log_t)
+create_files_pattern(xend_t, xend_var_log_t, xend_var_log_t)
+setattr_files_pattern(xend_t, xend_var_log_t, xend_var_log_t)
 manage_sock_files_pattern(xend_t, xend_var_log_t, xend_var_log_t)
 logging_log_filetrans(xend_t, xend_var_log_t, { sock_file file dir })
 
-# var/lib files for xend
 manage_dirs_pattern(xend_t, xend_var_lib_t, xend_var_lib_t)
 manage_files_pattern(xend_t, xend_var_lib_t, xend_var_lib_t)
 manage_sock_files_pattern(xend_t, xend_var_lib_t, xend_var_lib_t)
 manage_fifo_files_pattern(xend_t, xend_var_lib_t, xend_var_lib_t)
 files_var_lib_filetrans(xend_t, xend_var_lib_t, { file dir })
 
-# transition to store
-domtrans_pattern(xend_t, xenstored_exec_t, xenstored_t)
-
-# manage xenstored pid file
 manage_files_pattern(xend_t, xenstored_var_run_t, xenstored_var_run_t)
 
-# mount tmpfs on /var/lib/xenstored
-allow xend_t xenstored_var_lib_t:dir read;
+allow xend_t xenstored_var_lib_t:dir list_dir_perms;
 
-# transition to console
 domtrans_pattern(xend_t, xenconsoled_exec_t, xenconsoled_t)
+domtrans_pattern(xend_t, xenstored_exec_t, xenstored_t)
+
+xen_stream_connect_xenstore(xend_t)
 
 kernel_read_kernel_sysctls(xend_t)
 kernel_read_system_state(xend_t)
@@ -281,18 +229,28 @@
 corenet_tcp_sendrecv_generic_node(xend_t)
 corenet_tcp_sendrecv_all_ports(xend_t)
 corenet_tcp_bind_generic_node(xend_t)
+
+corenet_sendrecv_xen_server_packets(xend_t)
 corenet_tcp_bind_xen_port(xend_t)
+
+corenet_sendrecv_soundd_server_packets(xend_t)
 corenet_tcp_bind_soundd_port(xend_t)
+
+corenet_sendrecv_generic_server_packets(xend_t)
 corenet_tcp_bind_generic_port(xend_t)
+
+corenet_sendrecv_vnc_server_packets(xend_t)
 corenet_tcp_bind_vnc_port(xend_t)
-corenet_tcp_connect_xserver_port(xend_t)
-corenet_tcp_connect_xen_port(xend_t)
+
 corenet_sendrecv_xserver_client_packets(xend_t)
-corenet_sendrecv_xen_server_packets(xend_t)
+corenet_tcp_connect_xserver_port(xend_t)
+
 corenet_sendrecv_xen_client_packets(xend_t)
-corenet_sendrecv_soundd_server_packets(xend_t)
+corenet_tcp_connect_xen_port(xend_t)
+
 corenet_rw_tun_tap_dev(xend_t)
 
+dev_getattr_all_chr_files(xend_t)
 dev_read_urand(xend_t)
 dev_filetrans_xen(xend_t)
 dev_rw_sysfs(xend_t)
@@ -308,8 +266,17 @@
 files_etc_filetrans_etc_runtime(xend_t, file)
 files_read_usr_files(xend_t)
 files_read_default_symlinks(xend_t)
+files_search_mnt(xend_t)
+
+fs_getattr_all_fs(xend_t)
+fs_list_auto_mountpoints(xend_t)
+fs_read_dos_files(xend_t)
+fs_manage_xenfs_dirs(xend_t)
+fs_manage_xenfs_files(xend_t)
 
+term_setattr_generic_ptys(xend_t)
 term_getattr_all_ptys(xend_t)
+term_setattr_all_ptys(xend_t)
 term_use_generic_ptys(xend_t)
 term_use_ptmx(xend_t)
 term_getattr_pty_fs(xend_t)
@@ -320,13 +287,9 @@
 
 logging_send_syslog_msg(xend_t)
 
-lvm_domtrans(xend_t)
-
 miscfiles_read_localization(xend_t)
 miscfiles_read_hwdata(xend_t)
 
-mount_domtrans(xend_t)
-
 sysnet_domtrans_dhcpc(xend_t)
 sysnet_signal_dhcpc(xend_t)
 sysnet_domtrans_ifconfig(xend_t)
@@ -337,9 +300,23 @@
 
 userdom_dontaudit_search_user_home_dirs(xend_t)
 
-xen_stream_connect_xenstore(xend_t)
+tunable_policy(`xen_use_fusefs',`
+	fs_manage_fusefs_dirs(xend_t)
+	fs_manage_fusefs_files(xend_t)
+	fs_read_fusefs_symlinks(xend_t)
+')
+
+tunable_policy(`xen_use_nfs',`
+	fs_manage_nfs_dirs(xend_t)
+	fs_manage_nfs_files(xend_t)
+	fs_read_nfs_symlinks(xend_t)
+')
 
-netutils_domtrans(xend_t)
+tunable_policy(`xen_use_samba',`
+	fs_manage_cifs_files(xend_t)
+	fs_manage_cifs_files(xend_t)
+	fs_read_cifs_symlinks(xend_t)
+')
 
 optional_policy(`
 	brctl_domtrans(xend_t)
@@ -349,6 +326,27 @@
 	consoletype_exec(xend_t)
 ')
 
+optional_policy(`
+	lvm_domtrans(xend_t)
+')
+
+optional_policy(`
+	mount_domtrans(xend_t)
+')
+
+optional_policy(`
+	netutils_domtrans(xend_t)
+')
+
+optional_policy(`
+	ptchown_exec(xend_t)
+')
+
+optional_policy(`
+	virt_search_images(xend_t)
+	virt_read_config(xend_t)
+')
+
 ########################################
 #
 # Xen console local policy
@@ -361,7 +359,11 @@
 
 allow xenconsoled_t xen_devpts_t:chr_file rw_term_perms;
 
-# pid file
+manage_dirs_pattern(xenconsoled_t, xend_var_log_t, xend_var_log_t)
+append_files_pattern(xenconsoled_t, xend_var_log_t, xend_var_log_t)
+create_files_pattern(xenconsoled_t, xend_var_log_t, xend_var_log_t)
+setattr_files_pattern(xenconsoled_t, xend_var_log_t, xend_var_log_t)
+
 manage_files_pattern(xenconsoled_t, xenconsoled_var_run_t, xenconsoled_var_run_t)
 manage_sock_files_pattern(xenconsoled_t, xenconsoled_var_run_t, xenconsoled_var_run_t)
 files_pid_filetrans(xenconsoled_t, xenconsoled_var_run_t, { file sock_file })
@@ -390,9 +392,10 @@
 init_use_fds(xenconsoled_t)
 init_use_script_ptys(xenconsoled_t)
 
+logging_search_logs(xenconsoled_t)
+
 miscfiles_read_localization(xenconsoled_t)
 
-xen_manage_log(xenconsoled_t)
 xen_stream_connect_xenstore(xenconsoled_t)
 
 optional_policy(`
@@ -405,25 +408,24 @@
 #
 
 allow xenstored_t self:capability { dac_override ipc_lock sys_resource };
-allow xenstored_t self:unix_stream_socket create_stream_socket_perms;
-allow xenstored_t self:unix_dgram_socket create_socket_perms;
+allow xenstored_t self:unix_stream_socket { accept listen };
 
 manage_files_pattern(xenstored_t, xenstored_tmp_t, xenstored_tmp_t)
 manage_dirs_pattern(xenstored_t, xenstored_tmp_t, xenstored_tmp_t)
 files_tmp_filetrans(xenstored_t, xenstored_tmp_t, { file dir })
 
-# pid file
+manage_dirs_pattern(xenstored_t, xenstored_var_run_t, xenstored_var_run_t)
 manage_files_pattern(xenstored_t, xenstored_var_run_t, xenstored_var_run_t)
 manage_sock_files_pattern(xenstored_t, xenstored_var_run_t, xenstored_var_run_t)
-files_pid_filetrans(xenstored_t, xenstored_var_run_t, { file sock_file })
+files_pid_filetrans(xenstored_t, xenstored_var_run_t, { file sock_file dir })
 
-# log files
 manage_dirs_pattern(xenstored_t, xenstored_var_log_t, xenstored_var_log_t)
-manage_files_pattern(xenstored_t, xenstored_var_log_t, xenstored_var_log_t)
+append_files_pattern(xenstored_t, xenstored_var_log_t, xenstored_var_log_t)
+create_files_pattern(xenstored_t, xenstored_var_log_t, xenstored_var_log_t)
+setattr_files_pattern(xenstored_t, xenstored_var_log_t, xenstored_var_log_t)
 manage_sock_files_pattern(xenstored_t, xenstored_var_log_t, xenstored_var_log_t)
 logging_log_filetrans(xenstored_t, xenstored_var_log_t, { sock_file file dir })
 
-# var/lib files for xenstored
 manage_dirs_pattern(xenstored_t, xenstored_var_lib_t, xenstored_var_lib_t)
 manage_files_pattern(xenstored_t, xenstored_var_lib_t, xenstored_var_lib_t)
 manage_sock_files_pattern(xenstored_t, xenstored_var_lib_t, xenstored_var_lib_t)
@@ -439,9 +441,9 @@
 dev_read_sysfs(xenstored_t)
 
 files_read_etc_files(xenstored_t)
-
 files_read_usr_files(xenstored_t)
 
+fs_search_xenfs(xenstored_t)
 fs_manage_xenfs_files(xenstored_t)
 
 term_use_generic_ptys(xenstored_t)
@@ -460,24 +462,32 @@
 # xm local policy
 #
 
-allow xm_t self:capability { dac_override ipc_lock sys_tty_config };
-allow xm_t self:process { getsched signal };
-
-# internal communication is often done using fifo and unix sockets.
+allow xm_t self:capability { setpcap dac_override ipc_lock sys_nice sys_tty_config };
+allow xm_t self:process { getcap getsched setsched setcap signal };
 allow xm_t self:fifo_file rw_fifo_file_perms;
-allow xm_t self:unix_stream_socket { create_stream_socket_perms connectto };
-allow xm_t self:tcp_socket create_stream_socket_perms;
+allow xm_t self:unix_stream_socket { accept connectto listen };
+allow xm_t self:tcp_socket { accept listen };
 
 manage_files_pattern(xm_t, xend_var_lib_t, xend_var_lib_t)
 manage_fifo_files_pattern(xm_t, xend_var_lib_t, xend_var_lib_t)
 manage_sock_files_pattern(xm_t, xend_var_lib_t, xend_var_lib_t)
-files_search_var_lib(xm_t)
 
 allow xm_t xen_image_t:dir rw_dir_perms;
 allow xm_t xen_image_t:file read_file_perms;
 allow xm_t xen_image_t:blk_file read_blk_file_perms;
 
+read_files_pattern(xm_t, xenstored_var_run_t, xenstored_var_run_t)
+
+xen_manage_image_dirs(xm_t)
+xen_append_log(xm_t)
+xen_domtrans(xm_t)
+xen_stream_connect(xm_t)
+xen_stream_connect_xenstore(xm_t)
+
+can_exec(xm_t, xm_exec_t)
+
 kernel_read_system_state(xm_t)
+kernel_read_network_state(xm_t)
 kernel_read_kernel_sysctls(xm_t)
 kernel_read_sysctl(xm_t)
 kernel_read_xen_state(xm_t)
@@ -486,22 +496,33 @@
 corecmd_exec_bin(xm_t)
 corecmd_exec_shell(xm_t)
 
+corenet_all_recvfrom_unlabeled(xm_t)
+corenet_all_recvfrom_netlabel(xm_t)
 corenet_tcp_sendrecv_generic_if(xm_t)
 corenet_tcp_sendrecv_generic_node(xm_t)
+
+corenet_sendrecv_soundd_client_packets(xm_t)
 corenet_tcp_connect_soundd_port(xm_t)
+corenet_tcp_sendrecv_soundd_port(xm_t)
 
+dev_read_rand(xm_t)
 dev_read_urand(xm_t)
 dev_read_sysfs(xm_t)
 
 files_read_etc_runtime_files(xm_t)
+files_read_etc_files(xm_t)
 files_read_usr_files(xm_t)
+files_search_pids(xm_t)
+files_search_var_lib(xm_t)
 files_list_mnt(xm_t)
-# Some common macros (you might be able to remove some)
-files_read_etc_files(xm_t)
+files_list_tmp(xm_t)
 
 fs_getattr_all_fs(xm_t)
 fs_manage_xenfs_dirs(xm_t)
 fs_manage_xenfs_files(xm_t)
+fs_search_auto_mountpoints(xm_t)
+
+storage_raw_read_fixed_disk(xm_t)
 
 term_use_all_terms(xm_t)
 
@@ -509,13 +530,33 @@
 init_rw_script_stream_sockets(xm_t)
 init_use_fds(xm_t)
 
+logging_send_syslog_msg(xm_t)
+
 miscfiles_read_localization(xm_t)
 
 sysnet_dns_name_resolve(xm_t)
 
-xen_append_log(xm_t)
-xen_stream_connect(xm_t)
-xen_stream_connect_xenstore(xm_t)
+tunable_policy(`xen_use_fusefs',`
+	fs_manage_fusefs_dirs(xm_t)
+	fs_manage_fusefs_files(xm_t)
+	fs_read_fusefs_symlinks(xm_t)
+')
+
+tunable_policy(`xen_use_nfs',`
+	fs_manage_nfs_dirs(xm_t)
+	fs_manage_nfs_files(xm_t)
+	fs_read_nfs_symlinks(xm_t)
+')
+
+tunable_policy(`xen_use_samba',`
+	fs_manage_cifs_files(xm_t)
+	fs_manage_cifs_files(xm_t)
+	fs_read_cifs_symlinks(xm_t)
+')
+
+optional_policy(`
+	cron_system_entry(xm_t, xm_exec_t)
+')
 
 optional_policy(`
 	dbus_system_bus_client(xm_t)
@@ -526,16 +567,22 @@
 ')
 
 optional_policy(`
+	rpm_exec(xm_t)
+')
+
+optional_policy(`
+	vhostmd_rw_tmpfs_files(xm_t)
+	vhostmd_stream_connect(xm_t)
+	vhostmd_dontaudit_rw_stream_connect(xm_t)
+')
+
+optional_policy(`
 	virt_domtrans(xm_t)
 	virt_manage_images(xm_t)
 	virt_manage_config(xm_t)
 	virt_stream_connect(xm_t)
 ')
 
-########################################
-#
-# SSH component local policy
-#
 optional_policy(`
 	ssh_basic_client_template(xm, xm_t, system_r)
 
@@ -546,21 +593,4 @@
 
 	fs_manage_xenfs_dirs(xm_ssh_t)
 	fs_manage_xenfs_files(xm_ssh_t)
-
-	#Should have a boolean wrapping these
-	fs_list_auto_mountpoints(xend_t)
-	files_search_mnt(xend_t)
-	fs_getattr_all_fs(xend_t)
-	fs_read_dos_files(xend_t)
-	fs_manage_xenfs_dirs(xend_t)
-	fs_manage_xenfs_files(xend_t)
-
-	tunable_policy(`xen_use_nfs',`
-		fs_manage_nfs_files(xend_t)
-		fs_read_nfs_symlinks(xend_t)
-	')
-
-	optional_policy(`
-		unconfined_domain(xend_t)
-	')
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/xfs.fc refpolicy/policy/modules/contrib/xfs.fc
--- refpolicy/policy/modules/contrib/xfs.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/xfs.fc	2012-11-02 20:08:11.882957383 +0100
@@ -1,8 +1,11 @@
+/etc/rc\.d/init\.d/xfs	--	gen_context(system_u:object_r:xfs_initrc_exec_t,s0)
 
-/tmp/\.font-unix(/.*)?		gen_context(system_u:object_r:xfs_tmp_t,s0)
+/tmp/\.font-unix(/.*)?	gen_context(system_u:object_r:xfs_tmp_t,s0)
 
-/usr/bin/xfs		--	gen_context(system_u:object_r:xfs_exec_t,s0)
-/usr/bin/xfstt		--	gen_context(system_u:object_r:xfs_exec_t,s0)
+/usr/bin/xfs	--	gen_context(system_u:object_r:xfs_exec_t,s0)
+/usr/bin/xfstt	--	gen_context(system_u:object_r:xfs_exec_t,s0)
 
 /usr/X11R6/bin/xfs	--	gen_context(system_u:object_r:xfs_exec_t,s0)
 /usr/X11R6/bin/xfs-xtt	--	gen_context(system_u:object_r:xfs_exec_t,s0)
+
+/var/run/xfs.*	--	gen_context(system_u:object_r:xfs_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/xfs.if refpolicy/policy/modules/contrib/xfs.if
--- refpolicy/policy/modules/contrib/xfs.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/xfs.if	2012-11-02 20:08:11.882957383 +0100
@@ -1,8 +1,8 @@
-## <summary>X Windows Font Server </summary>
+## <summary>X Windows Font Server.</summary>
 
 ########################################
 ## <summary>
-##	Read a X font server named socket.
+##	Read xfs temporary sock files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -21,8 +21,8 @@
 
 ########################################
 ## <summary>
-##	Connect to a X font server over
-##	a unix domain stream socket.
+##	Connect to xfs with a unix
+##	domain stream socket.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -41,8 +41,7 @@
 
 ########################################
 ## <summary>
-##	Allow the specified domain to execute xfs
-##	in the caller domain.
+##	Execute xfs in the caller domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -55,5 +54,44 @@
 		type xfs_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	can_exec($1, xfs_exec_t)
 ')
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an xfs environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`xfs_admin',`
+	gen_require(`
+		type xfs_t, xfs_initrc_exec_t, xfs_var_run_t;
+		type xfs_tmp_t;
+	')
+
+	allow $1 xfs_t:process { ptrace signal_perms };
+	ps_process_pattern($1, xfs_t)
+
+	init_labeled_script_domtrans($1, xfs_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 xfs_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	files_search_pids($1)
+	admin_pattern($1, xfs_var_run_t)
+
+	files_search_tmp($1)
+	admin_pattern($1, xfs_tmp_t)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/xfs.te refpolicy/policy/modules/contrib/xfs.te
--- refpolicy/policy/modules/contrib/xfs.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/xfs.te	2012-11-02 20:08:11.883957383 +0100
@@ -1,4 +1,4 @@
-policy_module(xfs, 1.6.0)
+policy_module(xfs, 1.6.1)
 
 ########################################
 #
@@ -9,6 +9,9 @@
 type xfs_exec_t;
 init_daemon_domain(xfs_t, xfs_exec_t)
 
+type xfs_initrc_exec_t;
+init_script_file(xfs_initrc_exec_t)
+
 type xfs_tmp_t;
 files_tmp_file(xfs_tmp_t)
 
@@ -23,9 +26,8 @@
 allow xfs_t self:capability { dac_override setgid setuid };
 dontaudit xfs_t self:capability sys_tty_config;
 allow xfs_t self:process { signal_perms setpgid };
-allow xfs_t self:unix_stream_socket create_stream_socket_perms;
-allow xfs_t self:unix_dgram_socket create_socket_perms;
-allow xfs_t self:tcp_socket create_stream_socket_perms;
+allow xfs_t self:unix_stream_socket { accept listen };
+allow xfs_t self:tcp_socket { accept listen };
 
 manage_dirs_pattern(xfs_t, xfs_tmp_t, xfs_tmp_t)
 manage_sock_files_pattern(xfs_t, xfs_tmp_t, xfs_tmp_t)
@@ -34,6 +36,8 @@
 manage_files_pattern(xfs_t, xfs_var_run_t, xfs_var_run_t)
 files_pid_filetrans(xfs_t, xfs_var_run_t, file)
 
+can_exec(xfs_t, xfs_exec_t)
+
 kernel_read_kernel_sysctls(xfs_t)
 kernel_read_system_state(xfs_t)
 
@@ -41,10 +45,11 @@
 corenet_all_recvfrom_netlabel(xfs_t)
 corenet_tcp_sendrecv_generic_if(xfs_t)
 corenet_tcp_sendrecv_generic_node(xfs_t)
-corenet_tcp_sendrecv_all_ports(xfs_t)
 corenet_tcp_bind_generic_node(xfs_t)
-corenet_tcp_bind_xfs_port(xfs_t)
+
 corenet_sendrecv_xfs_server_packets(xfs_t)
+corenet_tcp_bind_xfs_port(xfs_t)
+corenet_tcp_sendrecv_xfs_port(xfs_t)
 
 corecmd_list_bin(xfs_t)
 
@@ -57,12 +62,13 @@
 
 domain_use_interactive_fds(xfs_t)
 
-files_read_etc_files(xfs_t)
 files_read_etc_runtime_files(xfs_t)
 files_read_usr_files(xfs_t)
 
 auth_use_nsswitch(xfs_t)
 
+init_script_tmp_filetrans(xfs_t, xfs_tmp_t, sock_file, "fs7100")
+
 logging_send_syslog_msg(xfs_t)
 
 miscfiles_read_localization(xfs_t)
@@ -71,13 +77,6 @@
 userdom_dontaudit_use_unpriv_user_fds(xfs_t)
 userdom_dontaudit_search_user_home_dirs(xfs_t)
 
-xfs_exec(xfs_t)
-
-ifdef(`distro_debian',`
-	# for /tmp/.font-unix/fs7100
-	init_script_tmp_filetrans(xfs_t, xfs_tmp_t, sock_file)
-')
-
 optional_policy(`
 	seutil_sigchld_newrole(xfs_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/xguest.if refpolicy/policy/modules/contrib/xguest.if
--- refpolicy/policy/modules/contrib/xguest.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/xguest.if	2012-11-02 20:08:13.378957387 +0100
@@ -1,4 +1,4 @@
-## <summary>Least privledge xwindows user role</summary>
+## <summary>Least privledge xwindows user role.</summary>
 
 ########################################
 ## <summary>
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/xguest.te refpolicy/policy/modules/contrib/xguest.te
--- refpolicy/policy/modules/contrib/xguest.te	2012-05-04 15:16:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/xguest.te	2012-11-02 20:08:13.404957386 +0100
@@ -1,4 +1,4 @@
-policy_module(xguest, 1.1.0)
+policy_module(xguest, 1.1.2)
 
 ########################################
 #
@@ -6,25 +6,28 @@
 #
 
 ## <desc>
-## <p>
-## Allow xguest users to mount removable media
-## </p>
+##	<p>
+##	Determine whether xguest can
+##	mount removable media.
+##	</p>
 ## </desc>
-gen_tunable(xguest_mount_media, true)
+gen_tunable(xguest_mount_media, false)
 
 ## <desc>
-## <p>
-## Allow xguest to configure Network Manager
-## </p>
+##	<p>
+##	Determine whether xguest can
+##	configure network manager.
+##	</p>
 ## </desc>
-gen_tunable(xguest_connect_network, true)
+gen_tunable(xguest_connect_network, false)
 
 ## <desc>
-## <p>
-## Allow xguest to use blue tooth devices
-## </p>
+##	<p>
+##	Determine whether xguest can
+##	use blue tooth devices.
+##	</p>
 ## </desc>
-gen_tunable(xguest_use_bluetooth, true)
+gen_tunable(xguest_use_bluetooth, false)
 
 role xguest_r;
 
@@ -35,13 +38,14 @@
 # Local policy
 #
 
+kernel_dontaudit_request_load_module(xguest_t)
+
 ifndef(`enable_mls',`
 	fs_exec_noxattr(xguest_t)
 
 	tunable_policy(`user_rw_noexattrfile',`
 		fs_manage_noxattr_fs_files(xguest_t)
 		fs_manage_noxattr_fs_dirs(xguest_t)
-		# Write floppies 
 		storage_raw_read_removable_device(xguest_t)
 		storage_raw_write_removable_device(xguest_t)
 	',`
@@ -49,7 +53,6 @@
 	')
 ')
 
-# Allow mounting of file systems
 optional_policy(`
 	tunable_policy(`xguest_mount_media',`
 		kernel_read_fs_sysctls(xguest_t)
@@ -76,6 +79,20 @@
 ')
 
 optional_policy(`
+	tunable_policy(`xguest_use_bluetooth',`
+		blueman_dbus_chat(xguest_t)
+	')
+')
+
+optional_policy(`
+	apache_role(xguest_r, xguest_t)
+')
+
+optional_policy(`
+	gnomeclock_dontaudit_dbus_chat(xguest_t)
+')
+
+optional_policy(`
 	hal_dbus_chat(xguest_t)
 ')
 
@@ -89,10 +106,66 @@
 
 optional_policy(`
 	tunable_policy(`xguest_connect_network',`
+		kernel_read_network_state(xguest_t)
+
 		networkmanager_dbus_chat(xguest_t)
+		networkmanager_read_lib_files(xguest_t)
+
+		corenet_all_recvfrom_unlabeled(xguest_t)
+		corenet_all_recvfrom_netlabel(xguest_t)
+		corenet_tcp_sendrecv_generic_if(xguest_t)
+		corenet_raw_sendrecv_generic_if(xguest_t)
+		corenet_tcp_sendrecv_generic_node(xguest_t)
+		corenet_raw_sendrecv_generic_node(xguest_t)
+
+		corenet_sendrecv_pulseaudio_client_packets(xguest_t)
 		corenet_tcp_connect_pulseaudio_port(xguest_t)
+		corenet_tcp_sendrecv_pulseaudio_port(xguest_t)
+
+		corenet_sendrecv_http_client_packets(xguest_t)
+		corenet_tcp_connect_http_port(xguest_t)
+		corenet_tcp_sendrecv_http_port(xguest_t)
+
+		corenet_sendrecv_http_cache_client_packets(xguest_t)
+		corenet_tcp_connect_http_cache_port(xguest_t)
+		corenet_tcp_sendrecv_http_cache_port(xguest_t)
+
+		corenet_sendrecv_squid_client_packets(xguest_t)
+		corenet_tcp_connect_squid_port(xguest_t)
+		corenet_tcp_sendrecv_squid_port(xguest_t)
+
+		corenet_sendrecv_ftp_client_packets(xguest_t)
+		corenet_tcp_connect_ftp_port(xguest_t)
+		corenet_tcp_sendrecv_ftp_port(xguest_t)
+
+		corenet_sendrecv_ipp_client_packets(xguest_t)
 		corenet_tcp_connect_ipp_port(xguest_t)
+		corenet_tcp_sendrecv_ipp_port(xguest_t)
+
+		corenet_sendrecv_generic_client_packets(xguest_t)
+		corenet_tcp_connect_generic_port(xguest_t)
+		corenet_tcp_sendrecv_generic_port(xguest_t)
+
+		corenet_sendrecv_soundd_client_packets(xguest_t)
+		corenet_tcp_connect_soundd_port(xguest_t)
+		corenet_tcp_sendrecv_soundd_port(xguest_t)
+
+		corenet_sendrecv_speech_client_packets(xguest_t)
+		corenet_tcp_connect_speech_port(xguest_t)
+		corenet_tcp_sendrecv_speech_port(xguest_t)
+
+		corenet_sendrecv_transproxy_client_packets(xguest_t)
+		corenet_tcp_connect_transproxy_port(xguest_t)
+		corenet_tcp_sendrecv_transproxy_port(xguest_t)
+
+		corenet_dontaudit_tcp_sendrecv_generic_port(xguest_t)
+		corenet_dontaudit_tcp_bind_generic_port(xguest_t)
 	')
 ')
 
+optional_policy(`
+	pcscd_read_pid_files(xguest_t)
+	pcscd_stream_connect(xguest_t)
+')
+
 #gen_user(xguest_u,, xguest_r, s0, s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/xprint.if refpolicy/policy/modules/contrib/xprint.if
--- refpolicy/policy/modules/contrib/xprint.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/xprint.if	2012-11-02 20:08:14.460957389 +0100
@@ -1 +1 @@
-## <summary>X print server</summary>
+## <summary>A X11-based print system and API.</summary>
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/xprint.te refpolicy/policy/modules/contrib/xprint.te
--- refpolicy/policy/modules/contrib/xprint.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/xprint.te	2012-11-02 20:08:14.460957389 +0100
@@ -19,7 +19,7 @@
 
 dontaudit xprint_t self:capability sys_tty_config;
 allow xprint_t self:process signal_perms;
-allow xprint_t self:fifo_file rw_file_perms;
+allow xprint_t self:fifo_file rw_fifo_file_perms;
 allow xprint_t self:tcp_socket create_stream_socket_perms;
 allow xprint_t self:udp_socket create_socket_perms;
 
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/xscreensaver.if refpolicy/policy/modules/contrib/xscreensaver.if
--- refpolicy/policy/modules/contrib/xscreensaver.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/xscreensaver.if	2012-11-02 20:08:15.535957391 +0100
@@ -1,30 +1,33 @@
-## <summary>X Screensaver</summary>
+## <summary>Modular screen saver and locker for X11.</summary>
 
 ########################################
 ## <summary>
-##	Role access for xscreensaver
+##	Role access for xscreensaver.
 ## </summary>
 ## <param name="role">
 ##	<summary>
-##	Role allowed access
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <param name="domain">
 ##	<summary>
-##	User domain for the role
+##	User domain for the role.
 ##	</summary>
 ## </param>
 #
 interface(`xscreensaver_role',`
 	gen_require(`
-		type xscreensaver_t, xscreensaver_exec_t;
+		attribute_role xscreensaver_roles;
+		type xscreensaver_t, xscreensaver_exec_t, xscreensaver_tmpfs_t;
 	')
 
-	role $1 types xscreensaver_t;
+	roleattribute $1 xscreensaver_roles;
 
 	domtrans_pattern($2, xscreensaver_exec_t, xscreensaver_t)
 
-	# Allow the user domain to signal/ps.
+	allow $2 xscreensaver_t:process { ptrace signal_perms };
 	ps_process_pattern($2, xscreensaver_t)
-	allow $2 xscreensaver_t:process signal_perms;
+
+	allow $2 xscreensaver_tmpfs_t:dir { manage_dir_perms relabel_dir_perms };
+	allow $2 xscreensaver_tmpfs_t:file { manage_file_perms relabel_file_perms };
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/xscreensaver.te refpolicy/policy/modules/contrib/xscreensaver.te
--- refpolicy/policy/modules/contrib/xscreensaver.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/xscreensaver.te	2012-11-02 20:08:15.535957391 +0100
@@ -1,13 +1,16 @@
-policy_module(xscreensaver, 1.1.0)
+policy_module(xscreensaver, 1.1.1)
 
 ########################################
 #
 # Declarations
 #
 
+attribute_role xscreensaver_roles;
+
 type xscreensaver_t;
 type xscreensaver_exec_t;
 userdom_user_application_domain(xscreensaver_t, xscreensaver_exec_t)
+role xscreensaver_roles types xscreensaver_t;
 
 type xscreensaver_tmpfs_t;
 userdom_user_tmpfs_file(xscreensaver_tmpfs_t)
@@ -17,8 +20,8 @@
 # Local policy
 #
 
-allow xscreensaver_t self:fifo_file rw_fifo_file_perms;
 allow xscreensaver_t self:process signal;
+allow xscreensaver_t self:fifo_file rw_fifo_file_perms;
 
 kernel_read_system_state(xscreensaver_t)
 
@@ -27,7 +30,6 @@
 auth_use_nsswitch(xscreensaver_t)
 auth_domtrans_chk_passwd(xscreensaver_t)
 
-#/var/run/utmp
 init_read_utmp(xscreensaver_t)
 
 logging_send_audit_msgs(xscreensaver_t)
@@ -35,8 +37,7 @@
 
 miscfiles_read_localization(xscreensaver_t)
 
-userdom_use_user_ptys(xscreensaver_t)
-#access to .icons and ~/.xscreensaver
+userdom_use_user_terminals(xscreensaver_t)
 userdom_read_user_home_content_files(xscreensaver_t)
 
 xserver_user_x_domain_template(xscreensaver, xscreensaver_t, xscreensaver_tmpfs_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/yam.fc refpolicy/policy/modules/contrib/yam.fc
--- refpolicy/policy/modules/contrib/yam.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/yam.fc	2012-11-02 20:08:16.608957393 +0100
@@ -1,6 +1,6 @@
-/etc/yam\.conf		--	gen_context(system_u:object_r:yam_etc_t,s0)
+/etc/yam\.conf	--	gen_context(system_u:object_r:yam_etc_t,s0)
 
-/usr/bin/yam		--	gen_context(system_u:object_r:yam_exec_t,s0)
+/usr/bin/yam	--	gen_context(system_u:object_r:yam_exec_t,s0)
 
-/var/yam(/.*)?			gen_context(system_u:object_r:yam_content_t,s0)
-/var/www/yam(/.*)?		gen_context(system_u:object_r:yam_content_t,s0)
+/var/yam(/.*)?	gen_context(system_u:object_r:yam_content_t,s0)
+/var/www/yam(/.*)?	gen_context(system_u:object_r:yam_content_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/yam.if refpolicy/policy/modules/contrib/yam.if
--- refpolicy/policy/modules/contrib/yam.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/yam.if	2012-11-02 20:08:17.678957395 +0100
@@ -1,4 +1,4 @@
-## <summary>Yum/Apt Mirroring</summary>
+## <summary>Yum/Apt Mirroring.</summary>
 
 ########################################
 ## <summary>
@@ -38,11 +38,11 @@
 #
 interface(`yam_run',`
 	gen_require(`
-		type yam_t;
+		attribute_role yam_roles;
 	')
 
 	yam_domtrans($1)
-	role $2 types yam_t;
+	roleattribute $2 yam_roles;
 ')
 
 ########################################
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/yam.te refpolicy/policy/modules/contrib/yam.te
--- refpolicy/policy/modules/contrib/yam.te	2012-05-04 15:16:28.000000000 +0200
+++ refpolicy/policy/modules/contrib/yam.te	2012-11-02 20:08:17.678957395 +0100
@@ -1,13 +1,16 @@
-policy_module(yam, 1.4.0)
+policy_module(yam, 1.4.1)
 
 ########################################
 #
 # Declarations
 #
 
+attribute_role yam_roles;
+
 type yam_t alias yam_crond_t;
 type yam_exec_t;
 application_domain(yam_t, yam_exec_t)
+role yam_roles types yam_t;
 
 type yam_content_t;
 files_mountpoint(yam_content_t)
@@ -24,83 +27,60 @@
 #
 
 allow yam_t self:capability { chown fowner fsetid dac_override };
-allow yam_t self:process ~{ ptrace setcurrent setexec setfscreate setrlimit execmem execstack execheap };
-allow yam_t self:process execmem;
+allow yam_t self:process ~{ ptrace setcurrent setexec setfscreate setrlimit execstack execheap };
 allow yam_t self:fd use;
 allow yam_t self:fifo_file rw_fifo_file_perms;
-allow yam_t self:unix_stream_socket { create_stream_socket_perms connectto };
-allow yam_t self:unix_dgram_socket { create_socket_perms sendto };
-allow yam_t self:shm create_shm_perms;
-allow yam_t self:sem create_sem_perms;
-allow yam_t self:msgq create_msgq_perms;
-allow yam_t self:msg { send receive };
-allow yam_t self:tcp_socket create_socket_perms;
+allow yam_t self:unix_stream_socket { accept connectto listen };
+allow yam_t self:unix_dgram_socket sendto;
 
-# Update the content being managed by yam.
 manage_dirs_pattern(yam_t, yam_content_t, yam_content_t)
 manage_files_pattern(yam_t, yam_content_t, yam_content_t)
 manage_lnk_files_pattern(yam_t, yam_content_t, yam_content_t)
 
 allow yam_t yam_etc_t:file read_file_perms;
-files_search_etc(yam_t)
 
 manage_files_pattern(yam_t, yam_tmp_t, yam_tmp_t)
 manage_dirs_pattern(yam_t, yam_tmp_t, yam_tmp_t)
 files_tmp_filetrans(yam_t, yam_tmp_t, { file dir })
 
-kernel_read_kernel_sysctls(yam_t)
-kernel_read_proc_symlinks(yam_t)
-# Python works fine without reading /proc/meminfo
-kernel_dontaudit_read_system_state(yam_t)
+kernel_read_system_state(yam_t)
 
-corecmd_exec_shell(yam_t)
 corecmd_exec_bin(yam_t)
+corecmd_exec_shell(yam_t)
 
-# Rsync and lftp need to network.  They also set files attributes to
-# match whats on the remote server.
 corenet_all_recvfrom_unlabeled(yam_t)
 corenet_all_recvfrom_netlabel(yam_t)
 corenet_tcp_sendrecv_generic_if(yam_t)
 corenet_tcp_sendrecv_generic_node(yam_t)
-corenet_tcp_sendrecv_all_ports(yam_t)
-corenet_tcp_connect_http_port(yam_t)
-corenet_tcp_connect_rsync_port(yam_t)
+
 corenet_sendrecv_http_client_packets(yam_t)
+corenet_tcp_connect_http_port(yam_t)
+corenet_tcp_sendrecv_http_port(yam_t)
+
 corenet_sendrecv_rsync_client_packets(yam_t)
+corenet_tcp_connect_rsync_port(yam_t)
+corenet_tcp_sendrecv_rsync_port(yam_t)
 
-# mktemp
 dev_read_urand(yam_t)
 
-files_read_etc_files(yam_t)
 files_read_etc_runtime_files(yam_t)
-# /usr/share/createrepo/genpkgmetadata.py:
 files_exec_usr_files(yam_t)
-# Programs invoked to build package lists need various permissions.
-# genpkglist creates tmp files in /var/cache/apt/genpkglist
-files_rw_var_files(yam_t)
 
 fs_search_auto_mountpoints(yam_t)
-# Content can also be on ISO image files.
 fs_read_iso9660_files(yam_t)
 
+auth_use_nsswitch(yam_t)
+
 logging_send_syslog_msg(yam_t)
 
 miscfiles_read_localization(yam_t)
 
 seutil_read_config(yam_t)
 
-sysnet_dns_name_resolve(yam_t)
-sysnet_read_config(yam_t)
-
 userdom_use_user_terminals(yam_t)
 userdom_use_unpriv_users_fds(yam_t)
-# Reading dotfiles...
-# cjp: ?
 userdom_search_user_home_dirs(yam_t)
 
-# The whole point of this program is to make updates available on a
-# local web server.  Need to go through /var to get to /var/yam
-# Go through /var/www to get to /var/www/yam
 apache_search_sys_content(yam_t)
 
 optional_policy(`
@@ -112,13 +92,5 @@
 ')
 
 optional_policy(`
-	nis_use_ypbind(yam_t)
-')
-
-optional_policy(`
-	nscd_socket_use(yam_t)
-')
-
-optional_policy(`
 	rsync_exec(yam_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/zabbix.fc refpolicy/policy/modules/contrib/zabbix.fc
--- refpolicy/policy/modules/contrib/zabbix.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/zabbix.fc	2012-11-02 20:08:21.207957404 +0100
@@ -1,9 +1,15 @@
-/etc/rc\.d/init\.d/zabbix	--	gen_context(system_u:object_r:zabbix_initrc_exec_t,s0)
-/etc/rc\.d/init\.d/zabbix-agentd --	gen_context(system_u:object_r:zabbix_agent_initrc_exec_t,s0)
+/etc/rc\.d/init\.d/((zabbix)|(zabbix-server))	--	gen_context(system_u:object_r:zabbix_initrc_exec_t,s0)
+/etc/rc\.d/init\.d/zabbix-agentd	--	gen_context(system_u:object_r:zabbix_agent_initrc_exec_t,s0)
 
-/usr/(s)?bin/zabbix_server	--	gen_context(system_u:object_r:zabbix_exec_t,s0)
-/usr/(s)?bin/zabbix_agentd	--	gen_context(system_u:object_r:zabbix_agent_exec_t,s0)
+/usr/bin/zabbix_server	--	gen_context(system_u:object_r:zabbix_exec_t,s0)
+/usr/bin/zabbix_agentd	--	gen_context(system_u:object_r:zabbix_agent_exec_t,s0)
 
-/var/log/zabbix(/.*)?			gen_context(system_u:object_r:zabbix_log_t,s0)
+/usr/sbin/zabbix_server	--	gen_context(system_u:object_r:zabbix_exec_t,s0)
+/usr/sbin/zabbix_agentd	--	gen_context(system_u:object_r:zabbix_agent_exec_t,s0)
+/usr/sbin/zabbix_server_mysql	--	gen_context(system_u:object_r:zabbix_exec_t,s0)
+/usr/sbin/zabbix_server_pgsql	--	gen_context(system_u:object_r:zabbix_exec_t,s0)
+/usr/sbin/zabbix_server_sqlite3	--	gen_context(system_u:object_r:zabbix_exec_t,s0)
 
-/var/run/zabbix(/.*)?			gen_context(system_u:object_r:zabbix_var_run_t,s0)
+/var/log/zabbix(/.*)?	gen_context(system_u:object_r:zabbix_log_t,s0)
+
+/var/run/zabbix(/.*)?	gen_context(system_u:object_r:zabbix_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/zabbix.if refpolicy/policy/modules/contrib/zabbix.if
--- refpolicy/policy/modules/contrib/zabbix.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/zabbix.if	2012-11-02 20:08:21.208957404 +0100
@@ -1,4 +1,4 @@
-## <summary>Distributed infrastructure monitoring</summary>
+## <summary>Distributed infrastructure monitoring.</summary>
 
 ########################################
 ## <summary>
@@ -15,12 +15,13 @@
 		type zabbix_t, zabbix_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, zabbix_exec_t, zabbix_t)
 ')
 
 ########################################
 ## <summary>
-## 	Allow connectivity to the zabbix server
+##	Connect to zabbit on the TCP network.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -33,7 +34,7 @@
 		type zabbix_t;
 	')
 
-	corenet_sendrecv_zabbix_agent_client_packets($1)
+	corenet_sendrecv_zabbix_client_packets($1)
 	corenet_tcp_connect_zabbix_port($1)
 	corenet_tcp_recvfrom_labeled($1, zabbix_t)
 	corenet_tcp_sendrecv_zabbix_port($1)
@@ -41,7 +42,7 @@
 
 ########################################
 ## <summary>
-##	Allow the specified domain to read zabbix's log files.
+##	Read zabbix log files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -61,13 +62,12 @@
 
 ########################################
 ## <summary>
-##	Allow the specified domain to append
-##	zabbix log files.
+##	Append zabbix log files.
 ## </summary>
 ## <param name="domain">
-## 	<summary>
+##	<summary>
 ##	Domain allowed access.
-## 	</summary>
+##	</summary>
 ## </param>
 #
 interface(`zabbix_append_log',`
@@ -81,7 +81,7 @@
 
 ########################################
 ## <summary>
-##	Read zabbix PID files.
+##	Read zabbix pid files.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -100,7 +100,7 @@
 
 ########################################
 ## <summary>
-## 	Allow connectivity to a zabbix agent
+##	Connect to zabbix agent on the TCP network.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -121,8 +121,8 @@
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate
-##	an zabbix environment
+##	All of the rules required to
+##	administrate an zabbix environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -131,7 +131,7 @@
 ## </param>
 ## <param name="role">
 ##	<summary>
-##	The role to be allowed to manage the zabbix domain.
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <rolecap/>
@@ -139,15 +139,16 @@
 interface(`zabbix_admin',`
 	gen_require(`
 		type zabbix_t, zabbix_log_t, zabbix_var_run_t;
-		type zabbix_initrc_exec_t;
+		type zabbix_initrc_exec_t, zabbit_agent_initrc_exec_t, zabbix_tmp_t;
+		type zabbit_tmpfs_t;
 	')
 
-	allow $1 zabbix_t:process { ptrace signal_perms };
-	ps_process_pattern($1, zabbix_t)
+	allow $1 { zabbix_t zabbix_agent_t }:process { ptrace signal_perms };
+	ps_process_pattern($1, { zabbix_t zabbix_agent_t })
 
-	init_labeled_script_domtrans($1, zabbix_initrc_exec_t)
+	init_labeled_script_domtrans($1, { zabbix_agent_initrc_exec_t zabbix_initrc_exec_t })
 	domain_system_change_exemption($1)
-	role_transition $2 zabbix_initrc_exec_t system_r;
+	role_transition $2 { zabbix_agent_initrc_exec_t zabbix_initrc_exec_t } system_r;
 	allow $2 system_r;
 
 	logging_list_logs($1)
@@ -155,4 +156,10 @@
 
 	files_list_pids($1)
 	admin_pattern($1, zabbix_var_run_t)
+
+	files_list_tmp($1)
+	admin_pattern($1, zabbix_tmp_t)
+
+	fs_list_tmpfs($1)
+	admin_pattern($1, zabbix_tmpfs_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/zabbix.te refpolicy/policy/modules/contrib/zabbix.te
--- refpolicy/policy/modules/contrib/zabbix.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/zabbix.te	2012-11-06 21:18:56.578011613 +0100
@@ -1,10 +1,18 @@
-policy_module(zabbix, 1.5.0)
+policy_module(zabbix, 1.5.3)
 
 ########################################
 #
 # Declarations
 #
 
+## <desc>
+##	<p>
+##	Determine whether zabbix can
+##	connect to all TCP ports
+##	</p>
+## </desc>
+gen_tunable(zabbix_can_network, false)
+
 type zabbix_t;
 type zabbix_exec_t;
 init_daemon_domain(zabbix_t, zabbix_exec_t)
@@ -19,56 +27,92 @@
 type zabbix_agent_initrc_exec_t;
 init_script_file(zabbix_agent_initrc_exec_t)
 
-# log files
 type zabbix_log_t;
 logging_log_file(zabbix_log_t)
 
-# shared memory
+type zabbix_tmp_t;
+files_tmp_file(zabbix_tmp_t)
+
 type zabbix_tmpfs_t;
 files_tmpfs_file(zabbix_tmpfs_t)
 
-# pid files
 type zabbix_var_run_t;
 files_pid_file(zabbix_var_run_t)
 
 ########################################
 #
-# zabbix local policy
+# Local policy
 #
 
-allow zabbix_t self:capability { setuid setgid };
-allow zabbix_t self:fifo_file rw_file_perms;
-allow zabbix_t self:process { setsched getsched signal };
+allow zabbix_t self:capability { dac_read_search dac_override setuid setgid };
+allow zabbix_t self:process { setsched signal_perms };
+allow zabbix_t self:fifo_file rw_fifo_file_perms;
 allow zabbix_t self:unix_stream_socket create_stream_socket_perms;
 allow zabbix_t self:sem create_sem_perms;
 allow zabbix_t self:shm create_shm_perms;
 allow zabbix_t self:tcp_socket create_stream_socket_perms;
 
-# log files
-allow zabbix_t zabbix_log_t:dir setattr;
-manage_files_pattern(zabbix_t, zabbix_log_t, zabbix_log_t)
+allow zabbix_t zabbix_log_t:dir setattr_dir_perms;
+append_files_pattern(zabbix_t, zabbix_log_t, zabbix_log_t)
+create_files_pattern(zabbix_t, zabbix_log_t, zabbix_log_t)
+setattr_files_pattern(zabbix_t, zabbix_log_t, zabbix_log_t)
 logging_log_filetrans(zabbix_t, zabbix_log_t, file)
 
-# shared memory
+manage_dirs_pattern(zabbix_t, zabbix_tmp_t, zabbix_tmp_t)
+manage_files_pattern(zabbix_t, zabbix_tmp_t, zabbix_tmp_t)
+files_tmp_filetrans(zabbix_t, zabbix_tmp_t, { dir file })
+
 rw_files_pattern(zabbix_t, zabbix_tmpfs_t, zabbix_tmpfs_t)
 fs_tmpfs_filetrans(zabbix_t, zabbix_tmpfs_t, file)
 
-# pid file
 manage_dirs_pattern(zabbix_t, zabbix_var_run_t, zabbix_var_run_t)
 manage_files_pattern(zabbix_t, zabbix_var_run_t, zabbix_var_run_t)
 files_pid_filetrans(zabbix_t, zabbix_var_run_t, { dir file })
 
+kernel_read_system_state(zabbix_t)
+kernel_read_kernel_sysctls(zabbix_t)
+
+corenet_all_recvfrom_unlabeled(zabbix_t)
+corenet_all_recvfrom_netlabel(zabbix_t)
+corenet_tcp_sendrecv_generic_if(zabbix_t)
+corenet_tcp_sendrecv_generic_node(zabbix_t)
 corenet_tcp_bind_generic_node(zabbix_t)
+
+corenet_sendrecv_ftp_client_packets(zabbix_t)
+corenet_tcp_connect_ftp_port(zabbix_t)
+corenet_tcp_sendrecv_ftp_port(zabbix_t)
+
+corenet_sendrecv_http_client_packets(zabbix_t)
+corenet_tcp_connect_http_port(zabbix_t)
+corenet_tcp_sendrecv_http_port(zabbix_t)
+
+corenet_sendrecv_zabbix_server_packets(zabbix_t)
 corenet_tcp_bind_zabbix_port(zabbix_t)
+corenet_tcp_sendrecv_zabbix_port(zabbix_t)
 
-files_read_etc_files(zabbix_t)
+corecmd_exec_bin(zabbix_t)
+corecmd_exec_shell(zabbix_t)
 
-miscfiles_read_localization(zabbix_t)
+dev_read_urand(zabbix_t)
+
+files_read_usr_files(zabbix_t)
 
-sysnet_dns_name_resolve(zabbix_t)
+auth_use_nsswitch(zabbix_t)
+
+miscfiles_read_localization(zabbix_t)
 
 zabbix_agent_tcp_connect(zabbix_t)
 
+tunable_policy(`zabbix_can_network',`
+	corenet_sendrecv_all_client_packets(zabbix_t)
+	corenet_tcp_connect_all_ports(zabbix_t)
+	corenet_tcp_sendrecv_all_ports(zabbix_t)
+')
+
+optional_policy(`
+	netutils_domtrans_ping(zabbix_t)
+')
+
 optional_policy(`
 	mysql_stream_connect(zabbix_t)
 	mysql_tcp_connect(zabbix_t)
@@ -76,30 +120,34 @@
 
 optional_policy(`
 	postgresql_stream_connect(zabbix_t)
+	postgresql_tcp_connect(zabbix_t)
+')
+
+optional_policy(`
+	snmp_read_snmp_var_lib_files(zabbix_t)
 ')
 
 ########################################
 #
-# zabbix agent local policy
+# Agent local policy
 #
 
 allow zabbix_agent_t self:capability { setuid setgid };
 allow zabbix_agent_t self:process { setsched getsched signal };
-allow zabbix_agent_t self:fifo_file rw_file_perms;
+allow zabbix_agent_t self:fifo_file rw_fifo_file_perms;
 allow zabbix_agent_t self:sem create_sem_perms;
 allow zabbix_agent_t self:shm create_shm_perms;
-allow zabbix_agent_t self:tcp_socket create_stream_socket_perms;
+allow zabbix_agent_t self:tcp_socket { accept listen };
 allow zabbix_agent_t self:unix_stream_socket create_stream_socket_perms;
 
-# Logging access
+append_files_pattern(zabbix_agent_t, zabbix_log_t, zabbix_log_t)
+create_files_pattern(zabbix_agent_t, zabbix_log_t, zabbix_log_t)
+setattr_files_pattern(zabbix_agent_t, zabbix_log_t, zabbix_log_t)
 filetrans_pattern(zabbix_agent_t, zabbix_log_t, zabbix_log_t, file)
-manage_files_pattern(zabbix_agent_t, zabbix_log_t, zabbix_log_t)
 
-# Shared Memory support
 rw_files_pattern(zabbix_agent_t, zabbix_tmpfs_t, zabbix_tmpfs_t)
 fs_tmpfs_filetrans(zabbix_agent_t, zabbix_tmpfs_t, file)
 
-# PID file management
 manage_files_pattern(zabbix_agent_t, zabbix_var_run_t, zabbix_var_run_t)
 files_pid_filetrans(zabbix_agent_t, zabbix_var_run_t, file)
 
@@ -108,10 +156,23 @@
 
 corecmd_read_all_executables(zabbix_agent_t)
 
+corenet_all_recvfrom_unlabeled(zabbix_agent_t)
+corenet_all_recvfrom_netlabel(zabbix_agent_t)
+corenet_tcp_sendrecv_generic_if(zabbix_agent_t)
+corenet_tcp_sendrecv_generic_node(zabbix_agent_t)
 corenet_tcp_bind_generic_node(zabbix_agent_t)
+
+corenet_sendrecv_zabbix_agent_server_packets(zabbix_agent_t)
 corenet_tcp_bind_zabbix_agent_port(zabbix_agent_t)
+corenet_tcp_sendrecv_zabbix_agent_port(zabbix_agent_t)
+
+corenet_sendrecv_ssh_client_packets(zabbix_agent_t)
 corenet_tcp_connect_ssh_port(zabbix_agent_t)
+corenet_tcp_sendrecv_ssh_port(zabbix_agent_t)
+
+corenet_sendrecv_zabbix_client_packets(zabbix_agent_t)
 corenet_tcp_connect_zabbix_port(zabbix_agent_t)
+corenet_tcp_sendrecv_zabbix_port(zabbix_agent_t)
 
 dev_getattr_all_blk_files(zabbix_agent_t)
 dev_getattr_all_chr_files(zabbix_agent_t)
@@ -133,5 +194,4 @@
 
 sysnet_dns_name_resolve(zabbix_agent_t)
 
-# Network access to zabbix server
 zabbix_tcp_connect(zabbix_agent_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/zarafa.fc refpolicy/policy/modules/contrib/zarafa.fc
--- refpolicy/policy/modules/contrib/zarafa.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/zarafa.fc	2012-11-02 20:08:24.956957411 +0100
@@ -1,26 +1,32 @@
-/etc/zarafa(/.*)?		gen_context(system_u:object_r:zarafa_etc_t,s0)
+/etc/zarafa(/.*)?	gen_context(system_u:object_r:zarafa_etc_t,s0)
 
-/usr/bin/zarafa-dagent		--	gen_context(system_u:object_r:zarafa_deliver_exec_t,s0)
-/usr/bin/zarafa-gateway		--	gen_context(system_u:object_r:zarafa_gateway_exec_t,s0)
-/usr/bin/zarafa-ical		--	gen_context(system_u:object_r:zarafa_ical_exec_t,s0)
-/usr/bin/zarafa-indexer		--	gen_context(system_u:object_r:zarafa_indexer_exec_t,s0)
-/usr/bin/zarafa-monitor		--	gen_context(system_u:object_r:zarafa_monitor_exec_t,s0)
-/usr/bin/zarafa-server		--	gen_context(system_u:object_r:zarafa_server_exec_t,s0)
-/usr/bin/zarafa-spooler		--	gen_context(system_u:object_r:zarafa_spooler_exec_t,s0)
+/etc/rc\.d/init\.d/zarafa.*	--	gen_context(system_u:object_r:zarafa_initrc_exec_t,s0)
 
-/var/lib/zarafa-.*			gen_context(system_u:object_r:zarafa_var_lib_t,s0)
+/usr/bin/zarafa-dagent	--	gen_context(system_u:object_r:zarafa_deliver_exec_t,s0)
+/usr/bin/zarafa-gateway	--	gen_context(system_u:object_r:zarafa_gateway_exec_t,s0)
+/usr/bin/zarafa-ical	--	gen_context(system_u:object_r:zarafa_ical_exec_t,s0)
+/usr/bin/zarafa-indexer	--	gen_context(system_u:object_r:zarafa_indexer_exec_t,s0)
+/usr/bin/zarafa-monitor	--	gen_context(system_u:object_r:zarafa_monitor_exec_t,s0)
+/usr/bin/zarafa-server	--	gen_context(system_u:object_r:zarafa_server_exec_t,s0)
+/usr/bin/zarafa-spooler	--	gen_context(system_u:object_r:zarafa_spooler_exec_t,s0)
 
-/var/log/zarafa/gateway\.log	--	gen_context(system_u:object_r:zarafa_gateway_log_t,s0)
-/var/log/zarafa/ical\.log	--	gen_context(system_u:object_r:zarafa_ical_log_t,s0)
-/var/log/zarafa/indexer\.log	--	gen_context(system_u:object_r:zarafa_indexer_log_t,s0)
-/var/log/zarafa/monitor\.log	--	gen_context(system_u:object_r:zarafa_monitor_log_t,s0)
-/var/log/zarafa/server\.log	--	gen_context(system_u:object_r:zarafa_server_log_t,s0)
-/var/log/zarafa/spooler\.log	--	gen_context(system_u:object_r:zarafa_spooler_log_t,s0)
+/var/lib/zarafa(/.*)?	gen_context(system_u:object_r:zarafa_var_lib_t,s0)
+/var/lib/zarafa-webaccess(/.*)?	gen_context(system_u:object_r:zarafa_var_lib_t,s0)
 
-/var/run/zarafa			-s	gen_context(system_u:object_r:zarafa_server_var_run_t,s0)
+/var/log/zarafa/dagent\.log.*	--	gen_context(system_u:object_r:zarafa_deliver_log_t,s0)
+/var/log/zarafa/gateway\.log.*	--	gen_context(system_u:object_r:zarafa_gateway_log_t,s0)
+/var/log/zarafa/ical\.log.*	--	gen_context(system_u:object_r:zarafa_ical_log_t,s0)
+/var/log/zarafa/indexer\.log.*	--	gen_context(system_u:object_r:zarafa_indexer_log_t,s0)
+/var/log/zarafa/monitor\.log.*	--	gen_context(system_u:object_r:zarafa_monitor_log_t,s0)
+/var/log/zarafa/server\.log.*	--	gen_context(system_u:object_r:zarafa_server_log_t,s0)
+/var/log/zarafa/spooler\.log.*	--	gen_context(system_u:object_r:zarafa_spooler_log_t,s0)
+
+/var/run/zarafa	-s	gen_context(system_u:object_r:zarafa_server_var_run_t,s0)
+/var/run/zarafa-dagent\.pid	--	gen_context(system_u:object_r:zarafa_deliver_var_run_t,s0)
 /var/run/zarafa-gateway\.pid	--	gen_context(system_u:object_r:zarafa_gateway_var_run_t,s0)
 /var/run/zarafa-ical\.pid	--	gen_context(system_u:object_r:zarafa_ical_var_run_t,s0)
-/var/run/zarafa-indexer		--	gen_context(system_u:object_r:zarafa_indexer_var_run_t,s0)
+/var/run/zarafa-indexer	-s	gen_context(system_u:object_r:zarafa_indexer_var_run_t,s0)
+/var/run/zarafa-indexer\.pid	--	gen_context(system_u:object_r:zarafa_indexer_var_run_t,s0)
 /var/run/zarafa-monitor\.pid	--	gen_context(system_u:object_r:zarafa_monitor_var_run_t,s0)
 /var/run/zarafa-server\.pid	--	gen_context(system_u:object_r:zarafa_server_var_run_t,s0)
 /var/run/zarafa-spooler\.pid	--	gen_context(system_u:object_r:zarafa_spooler_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/zarafa.if refpolicy/policy/modules/contrib/zarafa.if
--- refpolicy/policy/modules/contrib/zarafa.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/zarafa.if	2012-11-02 20:08:24.957957411 +0100
@@ -1,53 +1,55 @@
 ## <summary>Zarafa collaboration platform.</summary>
 
-######################################
+#######################################
 ## <summary>
-##	Creates types and rules for a basic
-##	zararfa init daemon domain.
+##	The template to define a zarafa domain.
 ## </summary>
-## <param name="prefix">
+## <param name="domain_prefix">
 ##	<summary>
-##	Prefix for the domain.
+##	Domain prefix to be used.
 ##	</summary>
 ## </param>
 #
 template(`zarafa_domain_template',`
 	gen_require(`
-		attribute zarafa_domain;
+		attribute zarafa_domain, zarafa_logfile, zarafa_pidfile;
 	')
 
-	##############################
+	########################################
 	#
-	# $1_t declarations
+	# Declarations
 	#
 
 	type zarafa_$1_t, zarafa_domain;
 	type zarafa_$1_exec_t;
 	init_daemon_domain(zarafa_$1_t, zarafa_$1_exec_t)
 
-	type zarafa_$1_log_t;
+	type zarafa_$1_log_t, zarafa_logfile;
 	logging_log_file(zarafa_$1_log_t)
 
-	type zarafa_$1_var_run_t;
+	type zarafa_$1_var_run_t, zarafa_pidfile;
 	files_pid_file(zarafa_$1_var_run_t)
 
-	##############################
+	########################################
 	#
-	# $1_t local policy
+	# Policy
 	#
 
 	manage_files_pattern(zarafa_$1_t, zarafa_$1_var_run_t, zarafa_$1_var_run_t)
 	manage_sock_files_pattern(zarafa_$1_t, zarafa_$1_var_run_t, zarafa_$1_var_run_t)
 	files_pid_filetrans(zarafa_$1_t, zarafa_$1_var_run_t, { file sock_file })
 
-	manage_files_pattern(zarafa_$1_t, zarafa_$1_log_t, zarafa_$1_log_t)
-	logging_log_filetrans(zarafa_$1_t, zarafa_$1_log_t, { file })
+	append_files_pattern(zarafa_$1_t, zarafa_$1_log_t, zarafa_$1_log_t)
+	create_files_pattern(zarafa_$1_t, zarafa_$1_log_t, zarafa_$1_log_t)
+	setattr_files_pattern(zarafa_$1_t, zarafa_$1_log_t, zarafa_$1_log_t)
+	logging_log_filetrans(zarafa_$1_t, zarafa_$1_log_t, file)
+
+	auth_use_nsswitch(zarafa_$1_t)
 ')
 
 ######################################
 ## <summary>
-##	Allow the specified domain to search
-##	zarafa configuration dirs.
+##	search zarafa configuration directories.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -66,7 +68,7 @@
 
 ########################################
 ## <summary>
-##	Execute a domain transition to run zarafa_deliver.
+##	Execute a domain transition to run zarafa deliver.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -79,12 +81,13 @@
 		type zarafa_deliver_t, zarafa_deliver_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, zarafa_deliver_exec_t, zarafa_deliver_t)
 ')
 
 ########################################
 ## <summary>
-##	Execute a domain transition to run zarafa_server.
+##	Execute a domain transition to run zarafa server.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -97,12 +100,14 @@
 		type zarafa_server_t, zarafa_server_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, zarafa_server_exec_t, zarafa_server_t)
 ')
 
 #######################################
 ## <summary>
-##	Connect to zarafa-server unix domain stream socket.
+##	Connect to zarafa server with a unix
+##	domain stream socket.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -118,3 +123,52 @@
 	files_search_var_lib($1)
 	stream_connect_pattern($1, zarafa_server_var_run_t, zarafa_server_var_run_t, zarafa_server_t)
 ')
+
+########################################
+## <summary>
+##	All of the rules required to
+##	administrate an zarafa environment.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="role">
+##	<summary>
+##	Role allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`zarafa_admin',`
+	gen_require(`
+		attribute zarafa_domain, zarafa_logfile, zarafa_pidfile;
+		type zarafa_etc_t, zarafa_initrc_exec_t, zarafa_deliver_tmp_t;
+		type zarafa_indexer_tmp_t, zarafa_server_tmp_t, zarafa_share_t;
+		type zarafa_var_lib_t;
+	')
+
+	allow $1 zarafa_domain:process { ptrace signal_perms };
+	ps_process_pattern($1, zarafa_domain)
+
+	init_labeled_script_domtrans($1, zarafa_initrc_exec_t)
+	domain_system_change_exemption($1)
+	role_transition $2 zarafa_initrc_exec_t system_r;
+	allow $2 system_r;
+
+	files_search_etc($1)
+	admin_pattern($1, zarafa_etc_t)
+
+	files_search_tmp($1)
+	admin_pattern($1, { zarafa_deliver_tmp_t zarafa_indexer_tmp_t zarafa_server_tmp_t })
+
+	logging_search_log($1)
+	admin_pattern($1, zarafa_logfile)
+
+	files_search_var_lib($1)
+	admin_pattern($1, { zarafa_var_lib_t zarafa_share_t })
+
+	files_search_pids($1)
+	admin_pattern($1, zarafa_pidfile)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/zarafa.te refpolicy/policy/modules/contrib/zarafa.te
--- refpolicy/policy/modules/contrib/zarafa.te	2012-07-25 20:33:05.000000000 +0200
+++ refpolicy/policy/modules/contrib/zarafa.te	2012-11-02 20:09:27.814957544 +0100
@@ -1,4 +1,4 @@
-policy_module(zarafa, 1.1.0)
+policy_module(zarafa, 1.1.2)
 
 ########################################
 #
@@ -6,6 +6,8 @@
 #
 
 attribute zarafa_domain;
+attribute zarafa_logfile;
+attribute zarafa_pidfile;
 
 zarafa_domain_template(deliver)
 
@@ -15,9 +17,16 @@
 type zarafa_etc_t;
 files_config_file(zarafa_etc_t)
 
+type zarafa_initrc_exec_t;
+init_script_file(zarafa_initrc_exec_t)
+
 zarafa_domain_template(gateway)
 zarafa_domain_template(ical)
 zarafa_domain_template(indexer)
+
+type zarafa_indexer_tmp_t;
+files_tmp_file(zarafa_indexer_tmp_t)
+
 zarafa_domain_template(monitor)
 zarafa_domain_template(server)
 
@@ -34,66 +43,62 @@
 
 ########################################
 #
-# zarafa-deliver local policy
+# Deliver local policy
 #
 
 manage_dirs_pattern(zarafa_deliver_t, zarafa_deliver_tmp_t, zarafa_deliver_tmp_t)
 manage_files_pattern(zarafa_deliver_t, zarafa_deliver_tmp_t, zarafa_deliver_tmp_t)
 files_tmp_filetrans(zarafa_deliver_t, zarafa_deliver_tmp_t, { file dir })
 
-auth_use_nsswitch(zarafa_deliver_t)
-
 ########################################
 #
-# zarafa_gateway local policy
+# Gateway local policy
 #
 
-allow zarafa_gateway_t self:capability { chown kill };
-allow zarafa_gateway_t self:process setrlimit;
-
 corenet_all_recvfrom_unlabeled(zarafa_gateway_t)
 corenet_all_recvfrom_netlabel(zarafa_gateway_t)
 corenet_tcp_sendrecv_generic_if(zarafa_gateway_t)
 corenet_tcp_sendrecv_generic_node(zarafa_gateway_t)
-corenet_tcp_sendrecv_all_ports(zarafa_gateway_t)
 corenet_tcp_bind_generic_node(zarafa_gateway_t)
-corenet_tcp_bind_pop_port(zarafa_gateway_t)
 
-auth_use_nsswitch(zarafa_gateway_t)
+corenet_sendrecv_pop_server_packets(zarafa_gateway_t)
+corenet_tcp_bind_pop_port(zarafa_gateway_t)
+corenet_tcp_sendrecv_pop_port(zarafa_gateway_t)
 
 #######################################
 #
-# zarafa-ical local policy
+# Ical local policy
 #
 
-allow zarafa_ical_t self:capability chown;
-
 corenet_all_recvfrom_unlabeled(zarafa_ical_t)
 corenet_all_recvfrom_netlabel(zarafa_ical_t)
 corenet_tcp_sendrecv_generic_if(zarafa_ical_t)
 corenet_tcp_sendrecv_generic_node(zarafa_ical_t)
-corenet_tcp_sendrecv_all_ports(zarafa_ical_t)
 corenet_tcp_bind_generic_node(zarafa_ical_t)
-corenet_tcp_bind_http_cache_port(zarafa_ical_t)
 
-auth_use_nsswitch(zarafa_ical_t)
+corenet_sendrecv_http_cache_client_packets(zarafa_ical_t)
+corenet_tcp_bind_http_cache_port(zarafa_ical_t)
+corenet_tcp_sendrecv_http_cache_port(zarafa_ical_t)
 
 ######################################
 #
-# zarafa-monitor local policy
+# Indexer local policy
 #
 
-allow zarafa_monitor_t self:capability chown;
+manage_dirs_pattern(zarafa_indexer_t, zarafa_indexer_tmp_t, zarafa_indexer_tmp_t)
+manage_files_pattern(zarafa_indexer_t, zarafa_indexer_tmp_t, zarafa_indexer_tmp_t)
+files_tmp_filetrans(zarafa_indexer_t, zarafa_indexer_tmp_t, { file dir })
 
-auth_use_nsswitch(zarafa_monitor_t)
+manage_dirs_pattern(zarafa_indexer_t, zarafa_var_lib_t, zarafa_var_lib_t)
+manage_files_pattern(zarafa_indexer_t, zarafa_var_lib_t, zarafa_var_lib_t)
+manage_lnk_files_pattern(zarafa_indexer_t, zarafa_var_lib_t, zarafa_var_lib_t)
 
 ########################################
 #
-# zarafa_server local policy
+# Server local policy
 #
 
-allow zarafa_server_t self:capability { chown kill net_bind_service };
-allow zarafa_server_t self:process setrlimit;
+allow zarafa_server_t self:capability net_bind_service;
 
 manage_dirs_pattern(zarafa_server_t, zarafa_server_tmp_t, zarafa_server_tmp_t)
 manage_files_pattern(zarafa_server_t, zarafa_server_tmp_t, zarafa_server_tmp_t)
@@ -101,7 +106,8 @@
 
 manage_dirs_pattern(zarafa_server_t, zarafa_var_lib_t, zarafa_var_lib_t)
 manage_files_pattern(zarafa_server_t, zarafa_var_lib_t, zarafa_var_lib_t)
-files_var_lib_filetrans(zarafa_server_t, zarafa_var_lib_t, { file dir })
+manage_lnk_files_pattern(zarafa_server_t, zarafa_var_lib_t, zarafa_var_lib_t)
+files_var_lib_filetrans(zarafa_server_t, zarafa_var_lib_t, { file dir lnk_file })
 
 stream_connect_pattern(zarafa_server_t, zarafa_indexer_var_run_t, zarafa_indexer_var_run_t, zarafa_indexer_t)
 
@@ -109,56 +115,56 @@
 corenet_all_recvfrom_netlabel(zarafa_server_t)
 corenet_tcp_sendrecv_generic_if(zarafa_server_t)
 corenet_tcp_sendrecv_generic_node(zarafa_server_t)
-corenet_tcp_sendrecv_all_ports(zarafa_server_t)
 corenet_tcp_bind_generic_node(zarafa_server_t)
+
+corenet_sendrecv_zarafa_server_packets(zarafa_server_t)
 corenet_tcp_bind_zarafa_port(zarafa_server_t)
+corenet_tcp_sendrecv_zarafa_port(zarafa_server_t)
 
 files_read_usr_files(zarafa_server_t)
 
-auth_use_nsswitch(zarafa_server_t)
-
-logging_send_syslog_msg(zarafa_server_t)
 logging_send_audit_msgs(zarafa_server_t)
 
-sysnet_dns_name_resolve(zarafa_server_t)
-
 optional_policy(`
 	kerberos_use(zarafa_server_t)
 ')
 
 optional_policy(`
 	mysql_stream_connect(zarafa_server_t)
+	mysql_tcp_connect(zarafa_server_t)
+')
+
+optional_policy(`
+	postgresql_stream_connect(zarafa_server_t)
+	postgresql_tcp_connect(zarafa_server_t)
 ')
 
 ########################################
 #
-# zarafa_spooler local policy
+# Spooler local policy
 #
 
-allow zarafa_spooler_t self:capability { chown kill };
-
 can_exec(zarafa_spooler_t, zarafa_spooler_exec_t)
 
 corenet_all_recvfrom_unlabeled(zarafa_spooler_t)
 corenet_all_recvfrom_netlabel(zarafa_spooler_t)
 corenet_tcp_sendrecv_generic_if(zarafa_spooler_t)
 corenet_tcp_sendrecv_generic_node(zarafa_spooler_t)
-corenet_tcp_sendrecv_all_ports(zarafa_spooler_t)
-corenet_tcp_connect_smtp_port(zarafa_spooler_t)
 
-auth_use_nsswitch(zarafa_spooler_t)
+corenet_sendrecv_smtp_client_packets(zarafa_spooler_t)
+corenet_tcp_connect_smtp_port(zarafa_spooler_t)
+corenet_tcp_sendrecv_smtp_port(zarafa_spooler_t)
 
 ########################################
 #
-# zarafa domains local policy
+# Zarafa domain local policy
 #
 
-# bad permission on /etc/zarafa
-allow zarafa_domain self:capability { dac_override setgid setuid };
-allow zarafa_domain self:process signal;
+allow zarafa_domain self:capability { kill dac_override chown setgid setuid };
+allow zarafa_domain self:process { setrlimit signal };
 allow zarafa_domain self:fifo_file rw_fifo_file_perms;
-allow zarafa_domain self:tcp_socket create_stream_socket_perms;
-allow zarafa_domain self:unix_stream_socket create_stream_socket_perms;
+allow zarafa_domain self:tcp_socket { accept listen };
+allow zarafa_domain self:unix_stream_socket { accept listen };
 
 stream_connect_pattern(zarafa_domain, zarafa_server_var_run_t, zarafa_server_var_run_t, zarafa_server_t)
 
@@ -166,6 +172,9 @@
 
 kernel_read_system_state(zarafa_domain)
 
-files_read_etc_files(zarafa_domain)
+dev_read_rand(zarafa_domain)
+dev_read_urand(zarafa_domain)
+
+logging_send_syslog_msg(zarafa_domain)
 
 miscfiles_read_localization(zarafa_domain)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/zebra.fc refpolicy/policy/modules/contrib/zebra.fc
--- refpolicy/policy/modules/contrib/zebra.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/zebra.fc	2012-11-02 20:08:28.070957418 +0100
@@ -1,22 +1,21 @@
+/etc/quagga(/.*)?	gen_context(system_u:object_r:zebra_conf_t,s0)
+/etc/zebra(/.*)?	gen_context(system_u:object_r:zebra_conf_t,s0)
+
 /etc/rc\.d/init\.d/bgpd	--	gen_context(system_u:object_r:zebra_initrc_exec_t,s0)
-/etc/rc\.d/init\.d/ospf6d --	gen_context(system_u:object_r:zebra_initrc_exec_t,s0)
-/etc/rc\.d/init\.d/ospfd --	gen_context(system_u:object_r:zebra_initrc_exec_t,s0)
+/etc/rc\.d/init\.d/ospf6d	--	gen_context(system_u:object_r:zebra_initrc_exec_t,s0)
+/etc/rc\.d/init\.d/ospfd	--	gen_context(system_u:object_r:zebra_initrc_exec_t,s0)
 /etc/rc\.d/init\.d/ripd	--	gen_context(system_u:object_r:zebra_initrc_exec_t,s0)
-/etc/rc\.d/init\.d/ripngd --	gen_context(system_u:object_r:zebra_initrc_exec_t,s0)
-/etc/rc\.d/init\.d/zebra --	gen_context(system_u:object_r:zebra_initrc_exec_t,s0)
-
-/usr/sbin/bgpd		--	gen_context(system_u:object_r:zebra_exec_t,s0)
-/usr/sbin/zebra		--	gen_context(system_u:object_r:zebra_exec_t,s0)
-
-/etc/quagga(/.*)?		gen_context(system_u:object_r:zebra_conf_t,s0)
-/etc/zebra(/.*)?		gen_context(system_u:object_r:zebra_conf_t,s0)
+/etc/rc\.d/init\.d/ripngd	--	gen_context(system_u:object_r:zebra_initrc_exec_t,s0)
+/etc/rc\.d/init\.d/zebra	--	gen_context(system_u:object_r:zebra_initrc_exec_t,s0)
 
+/usr/sbin/bgpd	--	gen_context(system_u:object_r:zebra_exec_t,s0)
 /usr/sbin/ospf.*	--	gen_context(system_u:object_r:zebra_exec_t,s0)
-/usr/sbin/rip.*		--	gen_context(system_u:object_r:zebra_exec_t,s0)
+/usr/sbin/rip.*	--	gen_context(system_u:object_r:zebra_exec_t,s0)
+/usr/sbin/zebra	--	gen_context(system_u:object_r:zebra_exec_t,s0)
 
-/var/log/quagga(/.*)?		gen_context(system_u:object_r:zebra_log_t,s0)
-/var/log/zebra(/.*)?		gen_context(system_u:object_r:zebra_log_t,s0)
+/var/log/quagga(/.*)?	gen_context(system_u:object_r:zebra_log_t,s0)
+/var/log/zebra(/.*)?	gen_context(system_u:object_r:zebra_log_t,s0)
 
 /var/run/\.zebra	-s	gen_context(system_u:object_r:zebra_var_run_t,s0)
 /var/run/\.zserv	-s	gen_context(system_u:object_r:zebra_var_run_t,s0)
-/var/run/quagga(/.*)?		gen_context(system_u:object_r:zebra_var_run_t,s0)
+/var/run/quagga(/.*)?	gen_context(system_u:object_r:zebra_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/zebra.if refpolicy/policy/modules/contrib/zebra.if
--- refpolicy/policy/modules/contrib/zebra.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/zebra.if	2012-11-02 20:08:28.070957418 +0100
@@ -1,8 +1,8 @@
-## <summary>Zebra border gateway protocol network routing service</summary>
+## <summary>Zebra border gateway protocol network routing service.</summary>
 
 ########################################
 ## <summary>
-##	Read the configuration files for zebra.
+##	Read zebra configuration content.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -18,13 +18,14 @@
 
 	files_search_etc($1)
 	allow $1 zebra_conf_t:dir list_dir_perms;
-	read_files_pattern($1, zebra_conf_t, zebra_conf_t)
-	read_lnk_files_pattern($1, zebra_conf_t, zebra_conf_t)
+	allow $1 zebra_conf_t:file read_file_perms;
+	allow $1 zebra_conf_t:lnk_file read_lnk_file_perms;
 ')
 
 ########################################
 ## <summary>
-##	Connect to zebra over an unix stream socket.
+##	Connect to zebra with a unix
+##	domain stream socket.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -38,14 +39,13 @@
 	')
 
 	files_search_pids($1)
-	allow $1 zebra_var_run_t:sock_file write;
-	allow $1 zebra_t:unix_stream_socket connectto;
+	stream_connect_pattern($1, zebra_var_run_t, zebra_var_run_t, zebra_t)
 ')
 
 ########################################
 ## <summary>
-##	All of the rules required to administrate
-##	an zebra environment
+##	All of the rules required to
+##	administrate an zebra environment.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -54,7 +54,7 @@
 ## </param>
 ## <param name="role">
 ##	<summary>
-##	The role to be allowed to manage the zebra domain.
+##	Role allowed access.
 ##	</summary>
 ## </param>
 ## <rolecap/>
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/zebra.te refpolicy/policy/modules/contrib/zebra.te
--- refpolicy/policy/modules/contrib/zebra.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/zebra.te	2012-11-02 20:08:28.070957418 +0100
@@ -1,4 +1,4 @@
-policy_module(zebra, 1.12.0)
+policy_module(zebra, 1.12.1)
 
 ########################################
 #
@@ -6,11 +6,11 @@
 #
 
 ## <desc>
-## <p>
-## Allow zebra daemon to write it configuration files
-## </p>
+##	<p>
+##	Determine whether zebra daemon can
+##	manage its configuration files.
+##	</p>
 ## </desc>
-#
 gen_tunable(allow_zebra_write_config, false)
 
 type zebra_t;
@@ -40,24 +40,24 @@
 allow zebra_t self:capability { setgid setuid net_admin net_raw };
 dontaudit zebra_t self:capability sys_tty_config;
 allow zebra_t self:process { signal_perms getcap setcap };
-allow zebra_t self:file rw_file_perms;
-allow zebra_t self:unix_dgram_socket create_socket_perms;
-allow zebra_t self:unix_stream_socket { connectto create_stream_socket_perms };
+allow zebra_t self:fifo_file rw_fifo_file_perms;
+allow zebra_t self:unix_stream_socket { accept connectto listen };
 allow zebra_t self:netlink_route_socket rw_netlink_socket_perms;
 allow zebra_t self:tcp_socket { connect connected_stream_socket_perms };
 allow zebra_t self:udp_socket create_socket_perms;
 allow zebra_t self:rawip_socket create_socket_perms;
 
 allow zebra_t zebra_conf_t:dir list_dir_perms;
-read_files_pattern(zebra_t, zebra_conf_t, zebra_conf_t)
-read_lnk_files_pattern(zebra_t, zebra_conf_t, zebra_conf_t)
+allow zebra_t zebra_conf_t:file read_file_perms;
+allow zebra_t zebra_conf_t:lnk_file read_lnk_file_perms;
 
-allow zebra_t zebra_log_t:dir setattr;
-manage_files_pattern(zebra_t, zebra_log_t, zebra_log_t)
+allow zebra_t zebra_log_t:dir setattr_dir_perms;
+append_files_pattern(zebra_t, zebra_log_t, zebra_log_t)
+create_files_pattern(zebra_t, zebra_log_t, zebra_log_t)
+setattr_files_pattern(zebra_t, zebra_log_t, zebra_log_t)
 manage_sock_files_pattern(zebra_t, zebra_log_t, zebra_log_t)
 logging_log_filetrans(zebra_t, zebra_log_t, { sock_file file dir })
 
-# /tmp/.bgpd is such a bad idea!
 allow zebra_t zebra_tmp_t:sock_file manage_sock_file_perms;
 files_tmp_filetrans(zebra_t, zebra_tmp_t, sock_file)
 
@@ -79,33 +79,38 @@
 corenet_tcp_sendrecv_generic_node(zebra_t)
 corenet_udp_sendrecv_generic_node(zebra_t)
 corenet_raw_sendrecv_generic_node(zebra_t)
-corenet_tcp_sendrecv_all_ports(zebra_t)
-corenet_udp_sendrecv_all_ports(zebra_t)
 corenet_tcp_bind_generic_node(zebra_t)
 corenet_udp_bind_generic_node(zebra_t)
+
+corenet_sendrecv_bgp_server_packets(zebra_t)
 corenet_tcp_bind_bgp_port(zebra_t)
-corenet_tcp_bind_zebra_port(zebra_t)
-corenet_udp_bind_router_port(zebra_t)
+corenet_sendrecv_bgp_client_packets(zebra_t)
 corenet_tcp_connect_bgp_port(zebra_t)
+corenet_tcp_sendrecv_bgp_port(zebra_t)
+
 corenet_sendrecv_zebra_server_packets(zebra_t)
+corenet_tcp_bind_zebra_port(zebra_t)
+corenet_tcp_sendrecv_zebra_port(zebra_t)
+
 corenet_sendrecv_router_server_packets(zebra_t)
+corenet_udp_bind_router_port(zebra_t)
+corenet_udp_sendrecv_router_port(zebra_t)
 
 dev_associate_usbfs(zebra_var_run_t)
 dev_list_all_dev_nodes(zebra_t)
 dev_read_sysfs(zebra_t)
 dev_rw_zero(zebra_t)
 
-fs_getattr_all_fs(zebra_t)
-fs_search_auto_mountpoints(zebra_t)
-
-term_list_ptys(zebra_t)
-
 domain_use_interactive_fds(zebra_t)
 
-files_search_etc(zebra_t)
 files_read_etc_files(zebra_t)
 files_read_etc_runtime_files(zebra_t)
 
+fs_getattr_all_fs(zebra_t)
+fs_search_auto_mountpoints(zebra_t)
+
+term_list_ptys(zebra_t)
+
 logging_send_syslog_msg(zebra_t)
 
 miscfiles_read_localization(zebra_t)
@@ -134,7 +139,3 @@
 optional_policy(`
 	udev_read_db(zebra_t)
 ')
-
-optional_policy(`
-	unconfined_sigchld(zebra_t)
-')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/zosremote.fc refpolicy/policy/modules/contrib/zosremote.fc
--- refpolicy/policy/modules/contrib/zosremote.fc	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/zosremote.fc	2012-11-02 20:08:29.186957421 +0100
@@ -1 +1,3 @@
 /sbin/audispd-zos-remote	--	gen_context(system_u:object_r:zos_remote_exec_t,s0)
+
+/usr/sbin/audispd-zos-remote	--	gen_context(system_u:object_r:zos_remote_exec_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/zosremote.if refpolicy/policy/modules/contrib/zosremote.if
--- refpolicy/policy/modules/contrib/zosremote.if	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/zosremote.if	2012-11-02 20:08:29.186957421 +0100
@@ -1,13 +1,13 @@
-## <summary>policy for z/OS Remote-services Audit dispatcher plugin</summary>
+## <summary>z/OS Remote-services Audit dispatcher plugin.</summary>
 
 ########################################
 ## <summary>
 ##	Execute a domain transition to run audispd-zos-remote.
 ## </summary>
 ## <param name="domain">
-## <summary>
+##	<summary>
 ##	Domain allowed to transition.
-## </summary>
+##	</summary>
 ## </param>
 #
 interface(`zosremote_domtrans',`
@@ -15,14 +15,15 @@
 		type zos_remote_t, zos_remote_exec_t;
 	')
 
+	corecmd_search_bin($1)
 	domtrans_pattern($1, zos_remote_exec_t, zos_remote_t)
 ')
 
 ########################################
 ## <summary>
-##	Allow specified type and role to transition and
-##	run in the zos_remote_t domain. Allow specified type
-##	to use zos_remote_t terminal.
+##	Execute zos remote in the zos remote
+##	domain, and allow the specified role
+##	the zos remote domain.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -37,9 +38,9 @@
 #
 interface(`zosremote_run',`
 	gen_require(`
-		type zos_remote_t;
+		attribute_role zos_remote_roles;
 	')
 
 	zosremote_domtrans($1)
-	role $2 types zos_remote_t;
+	roleattribute $2 zos_remote_roles;
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/contrib/zosremote.te refpolicy/policy/modules/contrib/zosremote.te
--- refpolicy/policy/modules/contrib/zosremote.te	2012-05-04 15:15:22.000000000 +0200
+++ refpolicy/policy/modules/contrib/zosremote.te	2012-11-02 20:08:29.187957421 +0100
@@ -1,25 +1,26 @@
-policy_module(zosremote, 1.1.0)
+policy_module(zosremote, 1.1.1)
 
 ########################################
 #
 # Declarations
 #
 
+attribute_role zos_remote_roles;
+
 type zos_remote_t;
 type zos_remote_exec_t;
 init_system_domain(zos_remote_t, zos_remote_exec_t)
 logging_dispatcher_domain(zos_remote_t, zos_remote_exec_t)
+role zos_remote_roles types zos_remote_t;
 
 ########################################
 #
-# zos_remote local policy
+# Local policy
 #
 
 allow zos_remote_t self:process signal;
 allow zos_remote_t self:fifo_file rw_file_perms;
-allow zos_remote_t self:unix_stream_socket create_stream_socket_perms;
-
-files_read_etc_files(zos_remote_t)
+allow zos_remote_t self:unix_stream_socket { accept listen };
 
 auth_use_nsswitch(zos_remote_t)
 
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/kernel/corecommands.fc refpolicy/policy/modules/kernel/corecommands.fc
--- refpolicy/policy/modules/kernel/corecommands.fc	2012-05-10 16:29:01.000000000 +0200
+++ refpolicy/policy/modules/kernel/corecommands.fc	2012-10-28 16:27:41.022007063 +0100
@@ -66,14 +66,17 @@
 /etc/hotplug/hotplug\.functions --	gen_context(system_u:object_r:bin_t,s0)
 /etc/hotplug\.d/default/default.*	gen_context(system_u:object_r:bin_t,s0)
 
-/etc/init\.d/functions		--	gen_context(system_u:object_r:bin_t,s0)
-
 /etc/kde/env(/.*)?			gen_context(system_u:object_r:bin_t,s0)
 /etc/kde/shutdown(/.*)?			gen_context(system_u:object_r:bin_t,s0)
 
 /etc/mail/make			--	gen_context(system_u:object_r:bin_t,s0)
-/etc/mcelog/cache-error-trigger	--	gen_context(system_u:object_r:bin_t,s0)
+
+/etc/mcelog/.*-error-trigger	--	gen_context(system_u:object_r:bin_t,s0)
+/etc/mcelog/.*\.local		--	gen_context(system_u:object_r:bin_t,s0)
+
+ifdef(`distro_redhat',`
 /etc/mcelog/triggers(/.*)?		gen_context(system_u:object_r:bin_t,s0)
+')
 /etc/mgetty\+sendfax/new_fax	--	gen_context(system_u:object_r:bin_t,s0)
 
 /etc/netplug\.d(/.*)? 	 		gen_context(system_u:object_r:bin_t,s0)
@@ -86,6 +89,8 @@
 /etc/pm/power\.d(/.*)?			gen_context(system_u:object_r:bin_t,s0)
 /etc/pm/sleep\.d(/.*)?			gen_context(system_u:object_r:bin_t,s0)
 
+/etc/portage/bin(/.*)?		--	gen_context(system_u:object_r:bin_t,s0)
+
 /etc/ppp/ip-down\..*		--	gen_context(system_u:object_r:bin_t,s0)
 /etc/ppp/ip-up\..*		--	gen_context(system_u:object_r:bin_t,s0)
 /etc/ppp/ipv6-up\..*		--	gen_context(system_u:object_r:bin_t,s0)
@@ -112,6 +117,8 @@
 
 /etc/vmware-tools(/.*)?			gen_context(system_u:object_r:bin_t,s0)
 
+/etc/wpa_supplicant/wpa_cli.sh	--	gen_context(system_u:object_r:bin_t,s0)
+
 /etc/X11/xdm/GiveConsole	--	gen_context(system_u:object_r:bin_t,s0)
 /etc/X11/xdm/TakeConsole	--	gen_context(system_u:object_r:bin_t,s0)
 /etc/X11/xdm/Xsetup_0		--	gen_context(system_u:object_r:bin_t,s0)
@@ -142,6 +149,9 @@
 /lib/rcscripts/sh(/.*)?			gen_context(system_u:object_r:bin_t,s0)
 /lib/rcscripts/net\.modules\.d/helpers\.d/dhclient-.* -- gen_context(system_u:object_r:bin_t,s0)
 /lib/rcscripts/net\.modules\.d/helpers\.d/udhcpc-.* -- gen_context(system_u:object_r:bin_t,s0)
+/lib/rc/bin/.*			--	gen_context(system_u:object_r:bin_t,s0)
+/lib/rc/sbin/.*			--	gen_context(system_u:object_r:bin_t,s0)
+/lib/rc/sh/.*			--	gen_context(system_u:object_r:bin_t,s0)
 ')
 
 #
@@ -184,6 +194,7 @@
 /usr/bin/scponly		--	gen_context(system_u:object_r:shell_exec_t,s0)
 /usr/bin/tcsh			--	gen_context(system_u:object_r:shell_exec_t,s0)
 
+
 /usr/lib(.*/)?bin(/.*)?			gen_context(system_u:object_r:bin_t,s0)
 
 /usr/(.*/)?sbin(/.*)?			gen_context(system_u:object_r:bin_t,s0)
@@ -198,16 +209,20 @@
 /usr/lib/ConsoleKit/scripts(/.*)?	gen_context(system_u:object_r:bin_t,s0)
 /usr/lib/ConsoleKit/run-session.d(/.*)? gen_context(system_u:object_r:bin_t,s0)
 /usr/lib/courier(/.*)?			gen_context(system_u:object_r:bin_t,s0)
+/usr/lib/courier-imap/.*	--	gen_context(system_u:object_r:bin_t,s0)
 /usr/lib/cups(/.*)? 			gen_context(system_u:object_r:bin_t,s0)
 /usr/lib/cyrus/.*		--	gen_context(system_u:object_r:bin_t,s0)
 /usr/lib/cyrus-imapd/.*		--	gen_context(system_u:object_r:bin_t,s0)
 /usr/lib/dpkg/.+		--	gen_context(system_u:object_r:bin_t,s0)
 /usr/lib/emacsen-common/.*		gen_context(system_u:object_r:bin_t,s0)
 /usr/lib/gimp/.*/plug-ins(/.*)?		gen_context(system_u:object_r:bin_t,s0)
+/usr/lib/gvfs/.*		--	gen_context(system_u:object_r:bin_t,s0)
 /usr/lib/ipsec/.*		--	gen_context(system_u:object_r:bin_t,s0)
+/usr/lib/kde4/libexec/.*	--	gen_context(system_u:object_r:bin_t,s0)
 /usr/lib/mailman/bin(/.*)?		gen_context(system_u:object_r:bin_t,s0)
 /usr/lib/mailman/mail(/.*)?		gen_context(system_u:object_r:bin_t,s0)
 /usr/lib/mediawiki/math/texvc.*		gen_context(system_u:object_r:bin_t,s0)
+/usr/lib/misc/glibc/getconf/.*	--	gen_context(system_u:object_r:bin_t,s0)
 /usr/lib/misc/sftp-server	--	gen_context(system_u:object_r:bin_t,s0)
 /usr/lib/nagios/plugins(/.*)?		gen_context(system_u:object_r:bin_t,s0)
 /usr/lib/netsaint/plugins(/.*)?		gen_context(system_u:object_r:bin_t,s0)
@@ -220,7 +235,7 @@
 /usr/lib/rpm/rpmq		-- 	gen_context(system_u:object_r:bin_t,s0)
 /usr/lib/rpm/rpmv		-- 	gen_context(system_u:object_r:bin_t,s0)
 /usr/lib/sftp-server		--	gen_context(system_u:object_r:bin_t,s0)
-/usr/lib/vte/gnome-pty-helper	--	gen_context(system_u:object_r:bin_t,s0)
+/usr/lib/vte/gnome-pty-helper 	--	gen_context(system_u:object_r:bin_t,s0)
 /usr/lib/xfce4/exo-1/exo-compose-mail-1 -- gen_context(system_u:object_r:bin_t,s0)
 /usr/lib/xfce4/exo-1/exo-helper-1 --	gen_context(system_u:object_r:bin_t,s0)
 /usr/lib/xfce4/panel/migrate	--	gen_context(system_u:object_r:bin_t,s0)
@@ -236,12 +251,15 @@
 /usr/lib/debug/usr/bin(/.*)?	--	gen_context(system_u:object_r:bin_t,s0)
 /usr/lib/debug/usr/sbin(/.*)?	--	gen_context(system_u:object_r:bin_t,s0)
 
-/usr/lib/[^/]*thunderbird[^/]*/thunderbird -- gen_context(system_u:object_r:bin_t,s0)
-/usr/lib/[^/]*thunderbird[^/]*/thunderbird-bin -- gen_context(system_u:object_r:bin_t,s0)
-/usr/lib/[^/]*thunderbird[^/]*/open-browser\.sh -- gen_context(system_u:object_r:bin_t,s0)
-/usr/lib/[^/]*/run-mozilla\.sh --	gen_context(system_u:object_r:bin_t,s0)
-/usr/lib/[^/]*/mozilla-xremote-client -- gen_context(system_u:object_r:bin_t,s0)
-/usr/lib/thunderbird.*/mozilla-xremote-client -- gen_context(system_u:object_r:bin_t,s0)
+/usr/lib/[^/]*thunderbird[^/]*/thunderbird	--	gen_context(system_u:object_r:bin_t,s0)
+/usr/lib/[^/]*thunderbird[^/]*/thunderbird-bin	--	gen_context(system_u:object_r:bin_t,s0)
+/usr/lib/[^/]*thunderbird[^/]*/open-browser\.sh --	gen_context(system_u:object_r:bin_t,s0)
+/usr/lib/[^/]*/run-mozilla\.sh			--	gen_context(system_u:object_r:bin_t,s0)
+/usr/lib/[^/]*/mozilla-xremote-client		--	gen_context(system_u:object_r:bin_t,s0)
+/usr/lib/thunderbird.*/mozilla-xremote-client	--	gen_context(system_u:object_r:bin_t,s0)
+/usr/lib/nspluginwrapper/i386/linux/npviewer.bin --	gen_context(system_u:object_r:bin_t,s0)
+/usr/lib/nspluginwrapper/i386/linux/npviewer	--	gen_context(system_u:object_r:shell_exec_t,s0)
+/usr/lib/xulrunner-.*/plugin-container		--	gen_context(system_u:object_r:bin_t,s0)
 
 /usr/lib/xen/bin(/.*)?			gen_context(system_u:object_r:bin_t,s0)
 
@@ -251,19 +269,20 @@
 
 /usr/libexec/openssh/sftp-server --	gen_context(system_u:object_r:bin_t,s0)
 
-/usr/local/lib(64)?/ipsec/.*	-- 	gen_context(system_u:object_r:bin_t,s0)
 /usr/local/Brother(/.*)?		gen_context(system_u:object_r:bin_t,s0)
 /usr/local/Printer(/.*)?		gen_context(system_u:object_r:bin_t,s0)
 /usr/local/linuxprinter/filters(/.*)?	gen_context(system_u:object_r:bin_t,s0)
 
+
 /usr/sbin/scponlyc		--	gen_context(system_u:object_r:shell_exec_t,s0)
 /usr/sbin/sesh			--	gen_context(system_u:object_r:shell_exec_t,s0)
 /usr/sbin/smrsh			--	gen_context(system_u:object_r:shell_exec_t,s0)
 
 /usr/share/ajaxterm/ajaxterm.py.* --	gen_context(system_u:object_r:bin_t,s0)
-/usr/share/ajaxterm/qweb.py.* --	gen_context(system_u:object_r:bin_t,s0)
+/usr/share/ajaxterm/qweb.py.*	--	gen_context(system_u:object_r:bin_t,s0)
 /usr/share/apr-0/build/[^/]+\.sh --	gen_context(system_u:object_r:bin_t,s0)
-/usr/share/apr-0/build/libtool --	gen_context(system_u:object_r:bin_t,s0)
+/usr/share/apr-0/build/libtool	--	gen_context(system_u:object_r:bin_t,s0)
+/usr/share/build-1/mkdir.sh	--	gen_context(system_u:object_r:bin_t,s0)
 /usr/share/dayplanner/dayplanner --	gen_context(system_u:object_r:bin_t,s0)
 /usr/share/debconf/.+		--	gen_context(system_u:object_r:bin_t,s0)
 /usr/share/denyhosts/scripts(/.*)?	gen_context(system_u:object_r:bin_t,s0)
@@ -272,12 +291,14 @@
 /usr/share/cluster/ocf-shellfuncs --	gen_context(system_u:object_r:bin_t,s0)
 /usr/share/cluster/svclib_nfslock --	gen_context(system_u:object_r:bin_t,s0)
 /usr/share/e16/misc(/.*)?		gen_context(system_u:object_r:bin_t,s0)
-/usr/share/gedit-2/plugins/externaltools/tools(/.*)? gen_context(system_u:object_r:bin_t,s0)
-/usr/share/gitolite/hooks/common/update -- gen_context(system_u:object_r:bin_t,s0)
+/usr/share/gedit-2/plugins/externaltools/tools(/.*)?	gen_context(system_u:object_r:bin_t,s0)
+/usr/share/gitolite/hooks/common/update		--	gen_context(system_u:object_r:bin_t,s0)
 /usr/share/gitolite/hooks/gitolite-admin/post-update -- gen_context(system_u:object_r:bin_t,s0)
-/usr/share/gnucash/finance-quote-check -- gen_context(system_u:object_r:bin_t,s0)
-/usr/share/gnucash/finance-quote-helper -- gen_context(system_u:object_r:bin_t,s0)
-/usr/share/hal/device-manager/hal-device-manager -- gen_context(system_u:object_r:bin_t,s0)
+/usr/share/gnucash/finance-quote-check		--	gen_context(system_u:object_r:bin_t,s0)
+/usr/share/gnucash/finance-quote-helper		--	gen_context(system_u:object_r:bin_t,s0)
+/usr/share/GNUstep/Makefiles/*\.sh		--	gen_context(system_u:object_r:bin_t,s0)
+/usr/share/GNUstep/Makefiles/mkinstalldirs	--	gen_context(system_u:object_r:bin_t,s0)
+/usr/share/hal/device-manager/hal-device-manager --	gen_context(system_u:object_r:bin_t,s0)
 /usr/share/hal/scripts(/.*)?		gen_context(system_u:object_r:bin_t,s0)
 /usr/share/mc/extfs/.*		--	gen_context(system_u:object_r:bin_t,s0)
 /usr/share/Modules/init(/.*)?		gen_context(system_u:object_r:bin_t,s0)
@@ -288,20 +309,17 @@
 /usr/share/sectool/.*\.py	--	gen_context(system_u:object_r:bin_t,s0)
 /usr/share/selinux/devel/policygentool -- gen_context(system_u:object_r:bin_t,s0)
 /usr/share/smolt/client(/.*)?		gen_context(system_u:object_r:bin_t,s0)
-/usr/share/shorewall/compiler\.pl --	gen_context(system_u:object_r:bin_t,s0)
-/usr/share/shorewall/configpath	--	gen_context(system_u:object_r:bin_t,s0)
-/usr/share/shorewall-perl(/.*)?		gen_context(system_u:object_r:bin_t,s0)
-/usr/share/shorewall-shell(/.*)?	gen_context(system_u:object_r:bin_t,s0)
-/usr/share/shorewall-lite(/.*)? 	gen_context(system_u:object_r:bin_t,s0)
-/usr/share/shorewall6-lite(/.*)?	gen_context(system_u:object_r:bin_t,s0)
 /usr/share/spamassassin/sa-update\.cron gen_context(system_u:object_r:bin_t,s0)
+/usr/share/texmf/web2c/mktexdir	--	gen_context(system_u:object_r:bin_t,s0)
 /usr/share/turboprint/lib(/.*)?	--	gen_context(system_u:object_r:bin_t,s0)
 /usr/share/vhostmd/scripts(/.*)?	gen_context(system_u:object_r:bin_t,s0)
 
 /usr/X11R6/lib(64)?/X11/xkb/xkbcomp --	gen_context(system_u:object_r:bin_t,s0)
 
 ifdef(`distro_debian',`
-/usr/lib/ConsoleKit/.*		--	gen_context(system_u:object_r:bin_t,s0)
+/usr/lib/ConsoleKit/.*	--	gen_context(system_u:object_r:bin_t,s0)
+/usr/lib/gdm3/.*	--	gen_context(system_u:object_r:bin_t,s0)
+/usr/lib/udisks/.*	--	gen_context(system_u:object_r:bin_t,s0)
 ')
 
 ifdef(`distro_gentoo', `
@@ -369,7 +387,7 @@
 ifdef(`distro_suse', `
 /usr/lib/cron/run-crons		--	gen_context(system_u:object_r:bin_t,s0)
 /usr/lib/samba/classic/.*	--	gen_context(system_u:object_r:bin_t,s0)
-/usr/lib/ssh/.*			--	gen_context(system_u:object_r:bin_t,s0)
+/usr/lib/ssh/.*		--	gen_context(system_u:object_r:bin_t,s0)
 /usr/share/apache2/[^/]*	--	gen_context(system_u:object_r:bin_t,s0)
 ')
 
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/kernel/corecommands.te refpolicy/policy/modules/kernel/corecommands.te
--- refpolicy/policy/modules/kernel/corecommands.te	2012-07-25 20:33:04.000000000 +0200
+++ refpolicy/policy/modules/kernel/corecommands.te	2012-09-28 19:54:59.287037593 +0200
@@ -1,4 +1,4 @@
-policy_module(corecommands, 1.17.0)
+policy_module(corecommands, 1.17.3)
 
 ########################################
 #
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/kernel/corenetwork.te.in refpolicy/policy/modules/kernel/corenetwork.te.in
--- refpolicy/policy/modules/kernel/corenetwork.te.in	2012-07-25 20:33:05.000000000 +0200
+++ refpolicy/policy/modules/kernel/corenetwork.te.in	2012-10-19 17:03:44.756547758 +0200
@@ -1,4 +1,4 @@
-policy_module(corenetwork, 1.18.0)
+policy_module(corenetwork, 1.18.4)
 
 ########################################
 #
@@ -78,6 +78,7 @@
 network_port(afs_ka, udp,7004,s0)
 network_port(afs_pt, udp,7002,s0)
 network_port(afs_vl, udp,7003,s0)
+network_port(afs3_callback, tcp,7001,s0, udp,7001,s0)
 network_port(agentx, udp,705,s0, tcp,705,s0)
 network_port(amanda, udp,10080-10082,s0, tcp,10080-10083,s0)
 network_port(amavisd_recv, tcp,10024,s0)
@@ -85,35 +86,49 @@
 network_port(amqp, udp,5671-5672,s0, tcp,5671-5672,s0)
 network_port(aol, udp,5190-5193,s0, tcp,5190-5193,s0)
 network_port(apcupsd, tcp,3551,s0, udp,3551,s0)
+network_port(apertus_ldp, tcp,539,s0, udp,539,s0)
+network_port(armtechdaemon, tcp,9292,s0, udp,9292,s0)
 network_port(asterisk, tcp,1720,s0, udp,2427,s0, udp,2727,s0, udp,4569,s0)
 network_port(audit, tcp,60,s0)
 network_port(auth, tcp,113,s0)
 network_port(bgp, tcp,179,s0, udp,179,s0, tcp,2605,s0, udp,2605,s0)
 network_port(boinc, tcp,31416,s0)
+network_port(boinc_client, tcp,1043,s0, udp,1034,s0)
 network_port(biff) # no defined portcon
 network_port(certmaster, tcp,51235,s0)
 network_port(chronyd, udp,323,s0)
 network_port(clamd, tcp,3310,s0)
 network_port(clockspeed, udp,4041,s0)
 network_port(cluster, tcp,5149,s0, udp,5149,s0, tcp,40040,s0, tcp,50006-50008,s0, udp,50006-50008,s0)
+network_port(cma, tcp,1050,s0, udp,1050,s0)
 network_port(cobbler, tcp,25151,s0)
+network_port(commplex_link, tcp,5001,s0, udp,5001,s0)
+network_port(commplex_main, tcp,5000,s0, udp,5000,s0)
 network_port(comsat, udp,512,s0)
+network_port(condor, tcp,9618,s0, udp,9618,s0)
+network_port(couchdb, tcp,5984,s0, udp,5984,s0)
+network_port(cslistener, tcp,9000,s0, udp,9000,s0)
+network_port(ctdb, tcp,4379,s0, udp,4397,s0)
 network_port(cvs, tcp,2401,s0, udp,2401,s0)
 network_port(cyphesis, tcp,6767,s0, tcp,6769,s0, tcp,6780-6799,s0, udp,32771,s0)
 network_port(daap, tcp,3689,s0, udp,3689,s0)
 network_port(dbskkd, tcp,1178,s0)
 network_port(dcc, udp,6276,s0, udp,6277,s0)
 network_port(dccm, tcp,5679,s0, udp,5679,s0)
-network_port(dhcpc, udp,68,s0, tcp,68,s0, udp,546,s0, tcp, 546,s0)
+network_port(dhcpc, udp,68,s0, tcp,68,s0, udp,546,s0, tcp, 546,s0, udp,5546,s0, tcp,5546,s0)
 network_port(dhcpd, udp,67,s0, udp,547,s0, tcp, 547,s0, udp,548,s0, tcp, 548,s0, tcp,647,s0, udp,647,s0, tcp,847,s0, udp,847,s0, tcp,7911,s0)
 network_port(dict, tcp,2628,s0)
 network_port(distccd, tcp,3632,s0)
-network_port(dns, udp,53,s0, tcp,53,s0)
+network_port(dns, tcp,53,s0, udp,53,s0)
+network_port(efs, tcp,520,s0)
+network_port(embrace_dp_c, tcp,3198,s0, udp,3198,s0)
 network_port(epmap, tcp,135,s0, udp,135,s0)
+network_port(epmd, tcp,4369,s0, udp,4369,s0)
 network_port(fingerd, tcp,79,s0)
 network_port(ftp, tcp,21,s0, tcp,990,s0, udp,990,s0)
 network_port(ftp_data, tcp,20,s0)
 network_port(gatekeeper, udp,1718,s0, udp,1719,s0, tcp,1721,s0, tcp,7000,s0)
+network_port(gds_db, tcp,3050,s0, udp,3050,s0)
 network_port(giftd, tcp,1213,s0)
 network_port(git, tcp,9418,s0, udp,9418,s0)
 network_port(glance_registry, tcp,9191,s0, udp,9191,s0)
@@ -123,13 +138,15 @@
 network_port(hadoop_namenode, tcp,8020,s0)
 network_port(hddtemp, tcp,7634,s0)
 network_port(howl, tcp,5335,s0, udp,5353,s0)
-network_port(hplip, tcp,1782,s0, tcp,2207,s0, tcp,2208,s0, tcp, 8290,s0, tcp,50000,s0, tcp,50002,s0, tcp,8292,s0, tcp,9100,s0, tcp,9101,s0, tcp,9102,s0, tcp,9220,s0, tcp,9221,s0, tcp,9222,s0, tcp,9280,s0, tcp,9281,s0, tcp,9282,s0, tcp,9290,s0, tcp,9291,s0, tcp,9292,s0)
+network_port(hplip, tcp,1782,s0, tcp,2207,s0, tcp,2208,s0, tcp, 8290,s0, tcp,50000,s0, tcp,50002,s0, tcp,8292,s0, tcp,9100,s0, tcp,9101,s0, tcp,9102,s0, tcp,9220,s0, tcp,9221,s0, tcp,9222,s0, tcp,9280,s0, tcp,9281,s0, tcp,9282,s0, tcp,9290,s0, tcp,9291,s0)
 network_port(http, tcp,80,s0, tcp,443,s0, tcp,488,s0, tcp,8008,s0, tcp,8009,s0, tcp,8443,s0) #8443 is mod_nss default port
 network_port(http_cache, tcp,3128,s0, udp,3130,s0, tcp,8080,s0, tcp,8118,s0, tcp,10001-10010,s0) # 8118 is for privoxy
 network_port(i18n_input, tcp,9010,s0)
 network_port(imaze, tcp,5323,s0, udp,5323,s0)
 network_port(inetd_child, tcp,1,s0, udp,1,s0, tcp,7,s0, udp,7,s0, tcp,9,s0, udp,9,s0, tcp,13,s0, udp,13,s0, tcp,19,s0, udp,19,s0, tcp,37,s0, udp,37,s0, tcp,512,s0, tcp,543,s0, tcp,544,s0, tcp,891,s0, udp,891,s0, tcp,892,s0, udp,892,s0, tcp,2105,s0, tcp,5666,s0)
 network_port(innd, tcp,119,s0)
+network_port(interwise, tcp,7778,s0, udp,7778,s0)
+network_port(ionixnetmon, tcp,7410,s0, udp,7410,s0)
 network_port(ipmi, udp,623,s0, udp,664,s0)
 network_port(ipp, tcp,631,s0, udp,631,s0, tcp,8610-8614,s0, udp,8610-8614,s0)
 network_port(ipsecnat, tcp,4500,s0, udp,4500,s0)
@@ -139,12 +156,14 @@
 network_port(isns, tcp,3205,s0, udp,3205,s0)
 network_port(jabber_client, tcp,5222,s0, tcp,5223,s0)
 network_port(jabber_interserver, tcp,5269,s0)
+network_port(jboss_iiop, tcp,3528,s0, udp,3528,s0)
 network_port(kerberos, tcp,88,s0, udp,88,s0, tcp,750,s0, udp,750,s0)
 network_port(kerberos_admin, tcp,464,s0, udp,464,s0, tcp,749,s0)
 network_port(kerberos_master, tcp,4444,s0, udp,4444,s0)
 network_port(kismet, tcp,2501,s0)
 network_port(kprop, tcp,754,s0)
 network_port(ktalkd, udp,517,s0, udp,518,s0)
+network_port(l2tp, tcp,1701,s0, udp,1701,s0)
 network_port(ldap, tcp,389,s0, udp,389,s0, tcp,636,s0, udp,636,s0, tcp,3268,s0)
 network_port(lirc, tcp,8765,s0)
 network_port(lmtp, tcp,24,s0, udp,24,s0)
@@ -155,30 +174,42 @@
 network_port(milter) # no defined portcon
 network_port(mmcc, tcp,5050,s0, udp,5050,s0)
 network_port(monopd, tcp,1234,s0)
+network_port(mountd, tcp,20048,s0, udp,20048,s0)
+network_port(movaz_ssc, tcp,5252,s0, udp,5252,s0)
 network_port(mpd, tcp,6600,s0)
+network_port(msgsrvr, tcp,8787,s0, udp,8787,s0)
 network_port(msnp, tcp,1863,s0, udp,1863,s0)
 network_port(mssql, tcp,1433-1434,s0, udp,1433-1434,s0)
+network_port(ms_streaming, tcp,1755,s0, udp,1755,s0)
 network_port(munin, tcp,4949,s0, udp,4949,s0)
+network_port(mxi, tcp,8005,s0, udp,8005,s0)
 network_port(mysqld, tcp,1186,s0, tcp,3306,s0, tcp,63132-63164,s0)
 network_port(mysqlmanagerd, tcp,2273,s0)
 network_port(nessus, tcp,1241,s0)
 network_port(netport, tcp,3129,s0, udp,3129,s0)
 network_port(netsupport, tcp,5404,s0, udp,5404,s0, tcp,5405,s0, udp,5405,s0)
+network_port(nfs, tcp,2049,s0, udp,2049,s0)
+network_port(nfsrdma, tcp,20049,s0, udp,20049,s0)
 network_port(nmbd, udp,137,s0, udp,138,s0)
 network_port(ntop, tcp,3000-3001,s0, udp,3000-3001,s0)
 network_port(ntp, udp,123,s0)
+network_port(oa_system, tcp,8022,s0, udp,8022,s0)
 network_port(oracledb, tcp, 1521,s0,udp, 1521,s0, tcp,2483,s0,udp,2483,s0, tcp,2484,s0, udp,2484,s0)
 network_port(ocsp, tcp,9080,s0)
+network_port(openhpid, tcp,4743,s0, udp,4743,s0)
 network_port(openvpn, tcp,1194,s0, udp,1194,s0)
+network_port(pdps, tcp,1314,s0, udp,1314,s0)
 network_port(pegasus_http, tcp,5988,s0)
 network_port(pegasus_https, tcp,5989,s0)
 network_port(pgpkeyserver, udp, 11371,s0, tcp,11371,s0)
 network_port(pingd, tcp,9125,s0)
+network_port(pktcable_cops, tcp,2126,s0, udp,2126,s0)
 network_port(pop, tcp,106,s0, tcp,109,s0, tcp,110,s0, tcp,143,s0, tcp,220,s0, tcp,993,s0, tcp,995,s0, tcp,1109,s0)
 network_port(portmap, udp,111,s0, tcp,111,s0)
 network_port(postfix_policyd, tcp,10031,s0)
 network_port(postgresql, tcp,5432,s0)
 network_port(postgrey, tcp,60000,s0)
+network_port(pptp, tcp,1723,s0, udp,1723,s0)
 network_port(prelude, tcp,4690,s0, udp,4690,s0)
 network_port(presence, tcp,5298-5299,s0, udp,5298-5299,s0)
 network_port(printer, tcp,515,s0)
@@ -195,42 +226,56 @@
 network_port(ricci, tcp,11111,s0, udp,11111,s0)
 network_port(ricci_modcluster, tcp,16851,s0, udp,16851,s0)
 network_port(rlogind, tcp,513,s0)
-network_port(rndc, tcp,953,s0)
+network_port(rndc, tcp,953,s0, udp,953,s0)
 network_port(router, udp,520,s0, udp,521,s0, tcp,521,s0)
 network_port(rsh, tcp,514,s0)
 network_port(rsync, tcp,873,s0, udp,873,s0)
+network_port(rtorrent, udp, 6881, s0)
+network_port(rtsp, tcp,554,s0, udp,554,s0)
 network_port(rwho, udp,513,s0)
 network_port(sap, tcp,9875,s0, udp,9875,s0)
+network_port(servistaitsm, tcp,3636,s0, udp,3636,s0)
 network_port(sieve, tcp,4190,s0)
 network_port(sip, tcp,5060,s0, udp,5060,s0, tcp,5061,s0, udp,5061,s0)
 network_port(sixxsconfig, tcp,3874,s0, udp,3874,s0)
 network_port(smbd, tcp,137-139,s0, tcp,445,s0)
 network_port(smtp, tcp,25,s0, tcp,465,s0, tcp,587,s0)
-network_port(snmp, udp,161,s0, udp,162,s0, tcp,199,s0, tcp, 1161, s0)
+network_port(snmp, udp,161,s0, udp,162,s0, tcp,199,s0, tcp,1161,s0)
 network_port(socks) # no defined portcon
 network_port(soundd, tcp,8000,s0, tcp,9433,s0, tcp, 16001, s0)
 network_port(spamd, tcp,783,s0)
 network_port(speech, tcp,8036,s0)
 network_port(squid, udp,3401,s0, tcp,3401,s0, udp,4827,s0, tcp,4827,s0) # snmp and htcp
+network_port(ssdp, tcp,1900,s0, udp,1900,s0)
 network_port(ssh, tcp,22,s0)
 network_port(stunnel) # no defined portcon
+network_port(svn, tcp,3690,s0, udp,3690,s0)
+network_port(svrloc, tcp,427,s0, udp,427,s0)
 network_port(swat, tcp,901,s0)
+network_port(sype_transport, tcp,9911,s0, udp,9911,s0)
 network_port(syslogd, udp,514,s0)
+network_port(syslog_tls, tcp,6514,s0, udp,6514,s0)
 network_port(tcs, tcp, 30003, s0)
 network_port(telnetd, tcp,23,s0)
 network_port(tftp, udp,69,s0)
-network_port(tor, tcp, 6969, s0, tcp,9001,s0, tcp,9030,s0, tcp,9050,s0, tcp,9051,s0)
+network_port(tor, tcp,6969,s0, tcp,9001,s0, tcp,9030,s0, tcp,9050,s0, tcp,9051,s0)
 network_port(traceroute, udp,64000-64010,s0)
 network_port(transproxy, tcp,8081,s0)
+network_port(trisoap, tcp,10200,s0, udp,10200,s0)
 network_port(ups, tcp,3493,s0)
 network_port(utcpserver) # no defined portcon
 network_port(uucpd, tcp,540,s0)
 network_port(varnishd, tcp,6081-6082,s0)
 network_port(virt, tcp,16509,s0, udp,16509,s0, tcp,16514,s0, udp,16514,s0)
+network_port(virtual_places, tcp,1533,s0, udp,1533,s0)
 network_port(virt_migration, tcp,49152-49216,s0)
 network_port(vnc, tcp,5900,s0)
 network_port(wccp, udp,2048,s0)
-network_port(whois, tcp,43,s0, udp,43,s0, tcp, 4321, s0 , udp, 4321, s0 )
+network_port(websm, tcp,9090,s0, udp,9090,s0)
+network_port(whois, tcp,43,s0, udp,43,s0, tcp,4321,s0, udp,4321,s0)
+network_port(winshadow, tcp,3161,s0, udp,3261,s0)
+network_port(wsdapi, tcp,5357,s0, udp,5357,s0)
+network_port(wsicopy, tcp,3378,s0, udp,3378,s0)
 network_port(xdmcp, udp,177,s0, tcp,177,s0)
 network_port(xen, tcp,8002,s0)
 network_port(xfs, tcp,7100,s0)
@@ -242,6 +287,7 @@
 network_port(zookeeper_election, tcp,3888,s0)
 network_port(zookeeper_leader, tcp,2888,s0)
 network_port(zebra, tcp,2600-2604,s0, tcp,2606,s0, udp,2600-2604,s0, udp,2606,s0)
+network_port(zented, tcp,1229,s0, udp,1229,s0)
 network_port(zope, tcp,8021,s0)
 
 # Defaults for reserved ports.	Earlier portcon entries take precedence;
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/kernel/devices.fc refpolicy/policy/modules/kernel/devices.fc
--- refpolicy/policy/modules/kernel/devices.fc	2012-05-04 15:14:47.000000000 +0200
+++ refpolicy/policy/modules/kernel/devices.fc	2012-10-04 19:33:55.521376617 +0200
@@ -17,6 +17,7 @@
 /dev/autofs.*		-c	gen_context(system_u:object_r:autofs_device_t,s0)
 /dev/beep		-c	gen_context(system_u:object_r:sound_device_t,s0)
 /dev/btrfs-control	-c	gen_context(system_u:object_r:lvm_control_t,s0)
+/dev/cachefiles		-c	gen_context(system_u:object_r:cachefiles_device_t,s0)
 /dev/controlD64		-c	gen_context(system_u:object_r:xserver_misc_device_t,s0)
 /dev/crash		-c	gen_context(system_u:object_r:crash_device_t,mls_systemhigh)
 /dev/dahdi/.*		-c	gen_context(system_u:object_r:sound_device_t,s0)
@@ -57,8 +58,10 @@
 /dev/lirc[0-9]+		-c	gen_context(system_u:object_r:lirc_device_t,s0)
 /dev/lircm		-c	gen_context(system_u:object_r:mouse_device_t,s0)
 /dev/logibm		-c	gen_context(system_u:object_r:mouse_device_t,s0)
+/dev/loop-control	-c	gen_context(system_u:object_r:loop_control_device_t,s0)
 /dev/lp.*		-c	gen_context(system_u:object_r:printer_device_t,s0)
 /dev/mcelog		-c	gen_context(system_u:object_r:kmsg_device_t,mls_systemhigh)
+/dev/mei		-c	gen_context(system_u:object_r:mei_device_t,s0)
 /dev/mem		-c	gen_context(system_u:object_r:memory_device_t,mls_systemhigh)
 /dev/mergemem		-c	gen_context(system_u:object_r:memory_device_t,mls_systemhigh)
 /dev/mga_vid.*		-c	gen_context(system_u:object_r:xserver_misc_device_t,s0)
@@ -125,8 +128,8 @@
 /dev/vrtpanel		-c	gen_context(system_u:object_r:mouse_device_t,s0)
 /dev/vttuner		-c	gen_context(system_u:object_r:v4l_device_t,s0)
 /dev/vtx.*		-c	gen_context(system_u:object_r:v4l_device_t,s0)
-/dev/watchdog		-c	gen_context(system_u:object_r:watchdog_device_t,s0)
-/dev/winradio.		-c	gen_context(system_u:object_r:v4l_device_t,s0)
+/dev/watchdog.*		-c	gen_context(system_u:object_r:watchdog_device_t,s0)
+/dev/winradio.*		-c	gen_context(system_u:object_r:v4l_device_t,s0)
 /dev/z90crypt		-c	gen_context(system_u:object_r:crypt_device_t,s0)
 /dev/zero		-c	gen_context(system_u:object_r:zero_device_t,s0)
 
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/kernel/devices.if refpolicy/policy/modules/kernel/devices.if
--- refpolicy/policy/modules/kernel/devices.if	2012-05-10 15:25:34.000000000 +0200
+++ refpolicy/policy/modules/kernel/devices.if	2012-10-30 21:21:12.848413486 +0100
@@ -588,6 +588,25 @@
 
 ########################################
 ## <summary>
+##	Setattr for generic character device files.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access
+##	</summary>
+## </param>
+#
+interface(`dev_setattr_generic_chr_files',`
+	gen_require(`
+		type device_t;
+	')
+
+	allow $1 device_t:chr_file setattr;
+')
+
+
+########################################
+## <summary>
 ##	Read generic character device files.
 ## </summary>
 ## <param name="domain">
@@ -1560,6 +1579,25 @@
 
 ########################################
 ## <summary>
+##	Read and write cachefiles character
+##	device nodes.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`dev_rw_cachefiles',`
+	gen_require(`
+		type device_t, cachefiles_device_t;
+	')
+
+	rw_chr_files_pattern($1, device_t, cachefiles_device_t)
+')
+
+########################################
+## <summary>
 ##	Read and write the PCMCIA card manager device.
 ## </summary>
 ## <param name="domain">
@@ -3800,6 +3838,42 @@
 
 ########################################
 ## <summary>
+##	Get the attributes of sysfs filesystem
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`dev_getattr_sysfs_fs',`
+	gen_require(`
+		type sysfs_t;
+	')
+
+	allow $1 sysfs_t:filesystem getattr;
+')
+
+########################################
+## <summary>
+##	Do not audit getting the attributes of sysfs filesystem
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain to dontaudit access from
+##	</summary>
+## </param>
+#
+interface(`dev_dontaudit_getattr_sysfs_fs',`
+	gen_require(`
+		type sysfs_t;
+	')
+
+	dontaudit $1 sysfs_t:filesystem getattr;
+')
+
+########################################
+## <summary>
 ##	Associate a file to a sysfs filesystem.
 ## </summary>
 ## <param name="file_type">
@@ -3946,6 +4020,26 @@
 
 ########################################
 ## <summary>
+##	Dont audit attempts to read hardware state information
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain for which the attempts do not need to be audited
+##	</summary>
+## </param>
+#
+interface(`dev_dontaudit_read_sysfs',`
+	gen_require(`
+		type sysfs_t;
+	')
+
+	dontaudit $1 sysfs_t:file read_file_perms;
+	dontaudit $1 sysfs_t:dir list_dir_perms;
+	dontaudit $1 sysfs_t:lnk_file read_lnk_file_perms;
+')
+
+########################################
+## <summary>
 ##	Read hardware state information.
 ## </summary>
 ## <desc>
@@ -4165,6 +4259,24 @@
 ')
 
 ########################################
+## <summary>
+##	Relabel generic the USB devices.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`dev_relabel_generic_usb_dev',`
+	gen_require(`
+		type usb_device_t;
+	')
+
+	relabel_chr_files_pattern($1, device_t, usb_device_t)
+')
+
+########################################
 ## <summary>
 ##	Read USB monitor devices.
 ## </summary>
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/kernel/devices.te refpolicy/policy/modules/kernel/devices.te
--- refpolicy/policy/modules/kernel/devices.te	2012-07-25 20:33:04.000000000 +0200
+++ refpolicy/policy/modules/kernel/devices.te	2012-10-30 21:22:17.539413624 +0100
@@ -1,4 +1,4 @@
-policy_module(devices, 1.14.0)
+policy_module(devices, 1.14.5)
 
 ########################################
 #
@@ -43,6 +43,9 @@
 dev_node(cardmgr_dev_t)
 files_tmp_file(cardmgr_dev_t)
 
+type cachefiles_device_t;
+dev_node(cachefiles_device_t)
+
 #
 # clock_device_t is the type of
 # /dev/rtc.
@@ -115,12 +118,18 @@
 type lirc_device_t;
 dev_node(lirc_device_t)
 
+type loop_control_device_t;
+dev_node(loop_control_device_t)
+
 #
 # Type for /dev/mapper/control
 #
 type lvm_control_t;
 dev_node(lvm_control_t)
 
+type mei_device_t;
+dev_node(mei_device_t)
+
 #
 # memory_device_t is the type of /dev/kmem,
 # /dev/mem and /dev/port.
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/kernel/files.fc refpolicy/policy/modules/kernel/files.fc
--- refpolicy/policy/modules/kernel/files.fc	2012-06-26 15:46:32.000000000 +0200
+++ refpolicy/policy/modules/kernel/files.fc	2012-08-29 20:02:12.313673338 +0200
@@ -75,7 +75,7 @@
 ifdef(`distro_gentoo', `
 /etc/profile\.env	--	gen_context(system_u:object_r:etc_runtime_t,s0)
 /etc/csh\.env		--	gen_context(system_u:object_r:etc_runtime_t,s0)
-/etc/env\.d/.*		--	gen_context(system_u:object_r:etc_runtime_t,s0)
+/etc/env\.d(/.*)?		gen_context(system_u:object_r:etc_runtime_t,s0)
 ')
 
 ifdef(`distro_redhat',`
@@ -84,7 +84,7 @@
 
 ifdef(`distro_suse',`
 /etc/defkeymap\.map	--	gen_context(system_u:object_r:etc_runtime_t,s0)
-/etc/init\.d/\.depend.*	--	gen_context(system_u:object_r:etc_runtime_t,s0)
+/etc/rc\.d/init\.d/\.depend.* -- gen_context(system_u:object_r:etc_runtime_t,s0)
 ')
 
 #
@@ -243,6 +243,12 @@
 
 /var/lock(/.*)?			gen_context(system_u:object_r:var_lock_t,s0)
 
+/var/log/lost\+found	-d	gen_context(system_u:object_r:lost_found_t,mls_systemhigh)
+/var/log/lost\+found/.*		<<none>>
+
+/var/log/audit/lost\+found -d	gen_context(system_u:object_r:lost_found_t,mls_systemhigh)
+/var/log/audit/lost\+found/.*	<<none>>
+
 /var/lost\+found	-d	gen_context(system_u:object_r:lost_found_t,mls_systemhigh)
 /var/lost\+found/.*		<<none>>
 
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/kernel/files.if refpolicy/policy/modules/kernel/files.if
--- refpolicy/policy/modules/kernel/files.if	2012-07-24 14:48:06.000000000 +0200
+++ refpolicy/policy/modules/kernel/files.if	2012-11-12 22:18:45.316143397 +0100
@@ -1182,6 +1182,24 @@
 
 ########################################
 ## <summary>
+##	Create all files as is.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`files_create_all_files_as',`
+	gen_require(`
+		attribute file_type;
+	')
+
+	allow $1 file_type:kernel_service create_files_as;
+')
+
+########################################
+## <summary>
 ##	Do not audit attempts to search the
 ##	contents of any directories on extended
 ##	attribute filesystems.
@@ -1430,6 +1448,7 @@
 	seutil_relabelto_bin_policy($1)
 ')
 
+
 #############################################
 ## <summary>
 ##	Manage all configuration directories on filesystem
@@ -1583,43 +1602,43 @@
 
 ########################################
 ## <summary>
-##	Do not audit attempts to set the attributes on all mount points.
+##	Search all mount points.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
-##	Domain to not audit.
+##	Domain allowed access.
 ##	</summary>
 ## </param>
 #
-interface(`files_dontaudit_setattr_all_mountpoints',`
+interface(`files_search_all_mountpoints',`
 	gen_require(`
 		attribute mountpoint;
 	')
 
-	dontaudit $1 mountpoint:dir setattr;
+	allow $1 mountpoint:dir search_dir_perms;
 ')
 
 ########################################
 ## <summary>
-##	Search all mount points.
+##	Do not audit searching of all mount points.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
-##	Domain allowed access.
+##	Domain to not audit.
 ##	</summary>
 ## </param>
 #
-interface(`files_search_all_mountpoints',`
+interface(`files_dontaudit_search_all_mountpoints',`
 	gen_require(`
 		attribute mountpoint;
 	')
 
-	allow $1 mountpoint:dir search_dir_perms;
+	dontaudit $1 mountpoint:dir search_dir_perms;
 ')
 
 ########################################
 ## <summary>
-##	Do not audit searching of all mount points.
+##	Do not audit listing of all mount points.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -1627,48 +1646,48 @@
 ##	</summary>
 ## </param>
 #
-interface(`files_dontaudit_search_all_mountpoints',`
+interface(`files_dontaudit_list_all_mountpoints',`
 	gen_require(`
 		attribute mountpoint;
 	')
 
-	dontaudit $1 mountpoint:dir search_dir_perms;
+	dontaudit $1 mountpoint:dir list_dir_perms;
 ')
 
 ########################################
 ## <summary>
-##	Do not audit listing of all mount points.
+##	Do not audit write attempts on mount points.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
-##	Domain to not audit.
+##	Domain to ignore write attempts from
 ##	</summary>
 ## </param>
 #
-interface(`files_dontaudit_list_all_mountpoints',`
+interface(`files_dontaudit_write_all_mountpoints',`
 	gen_require(`
 		attribute mountpoint;
 	')
 
-	dontaudit $1 mountpoint:dir list_dir_perms;
+	dontaudit $1 mountpoint:dir write;
 ')
 
 ########################################
 ## <summary>
-##	Do not audit attempts to write to mount points.
+##	Do not audit setattr attempts on mount points.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
-##	Domain to not audit.
+##	Domain to ignore setattr attempts from
 ##	</summary>
 ## </param>
 #
-interface(`files_dontaudit_write_all_mountpoints',`
+interface(`files_dontaudit_setattr_all_mountpoints',`
 	gen_require(`
 		attribute mountpoint;
 	')
 
-	dontaudit $1 mountpoint:dir write;
+	dontaudit $1 mountpoint:dir setattr;
 ')
 
 ########################################
@@ -1856,6 +1875,42 @@
 
 ########################################
 ## <summary>
+##	Associate to root file system.
+## </summary>
+## <param name="file_type">
+##	<summary>
+##	Type of the file to associate.
+##	</summary>
+## </param>
+#
+interface(`files_associate_rootfs',`
+	gen_require(`
+		type root_t;
+	')
+
+	allow $1 root_t:filesystem associate;
+')
+
+########################################
+## <summary>
+##	Relabel to and from rootfs file system.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`files_relabel_rootfs',`
+	gen_require(`
+		type root_t;
+	')
+
+	allow $1 root_t:filesystem { relabelto relabelfrom };
+')
+
+########################################
+## <summary>
 ##	Unmount a rootfs filesystem.
 ## </summary>
 ## <param name="domain">
@@ -2594,6 +2649,25 @@
 
 ########################################
 ## <summary>
+##	Do not audit attempts to read files
+##	in /etc 
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain to not audit.
+##	</summary>
+## </param>
+#
+interface(`files_dontaudit_read_etc_files',`
+	gen_require(`
+		type etc_t;
+	')
+
+	dontaudit $1 etc_t:file { getattr read };
+')
+
+########################################
+## <summary>
 ##	Read generic files in /etc.
 ## </summary>
 ## <desc>
@@ -2895,7 +2969,7 @@
 ## </summary>
 ## <param name="domain">
 ##	<summary>
-##	Domain allowed access.
+##	Domain to not audit.
 ##	</summary>
 ## </param>
 #
@@ -2909,6 +2983,24 @@
 
 ########################################
 ## <summary>
+##	Do not audit attempts to read etc_runtime resources
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`files_dontaudit_read_etc_runtime',`
+	gen_require(`
+		type etc_runtime_t;
+	')
+
+	dontaudit $1 etc_runtime_t:file read_file_perms;
+')
+
+########################################
+## <summary>
 ##	Read files in /etc that are dynamically
 ##	created on boot, such as mtab.
 ## </summary>
@@ -2969,6 +3061,25 @@
 
 ########################################
 ## <summary>
+##	Do not audit attempts to write
+##	etc runtime files.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain to not audit.
+##	</summary>
+## </param>
+#
+interface(`files_dontaudit_write_etc_runtime_files',`
+	gen_require(`
+		type etc_runtime_t;
+	')
+
+	dontaudit $1 etc_runtime_t:file write;
+')
+
+########################################
+## <summary>
 ##	Read and write files in /etc that are dynamically
 ##	created on boot, such as mtab.
 ## </summary>
@@ -3011,6 +3122,26 @@
 
 ########################################
 ## <summary>
+##	Create, read, write, and delete symbolic links in
+##	/etc that are dynamically created on boot.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`files_manage_etc_runtime_lnk_files',`
+	gen_require(`
+		type etc_t, etc_runtime_t;
+	')
+
+	manage_lnk_files_pattern($1, { etc_t etc_runtime_t }, etc_runtime_t)
+')
+
+########################################
+## <summary>
 ##	Create, etc runtime objects with an automatic
 ##	type transition.
 ## </summary>
@@ -5550,24 +5681,6 @@
 
 ########################################
 ## <summary>
-##	Set the attributes of the generic lock directories.
-## </summary>
-## <param name="domain">
-##	<summary>
-##	Domain allowed access.
-##	</summary>
-## </param>
-#
-interface(`files_setattr_lock_dirs',`
-	gen_require(`
-		type var_t, var_lock_t;
-	')
-
-	setattr_dirs_pattern($1, var_t, var_lock_t)
-')
-
-########################################
-## <summary>
 ##	Search the locks directory (/var/lock).
 ## </summary>
 ## <param name="domain">
@@ -5646,11 +5759,11 @@
 
 ########################################
 ## <summary>
-## 	Create lock directories
+##	Create lock directories.
 ## </summary>
 ## <param name="domain">
-## 	<summary>
-##	Domain allowed access
+##	<summary>
+##	Domain allowed access.
 ##	</summary>
 ## </param>
 #
@@ -5664,6 +5777,7 @@
 	create_dirs_pattern($1, var_lock_t, var_lock_t)
 ')
 
+
 ########################################
 ## <summary>
 ##	Relabel to and from all lock directory types.
@@ -5709,6 +5823,24 @@
 
 ########################################
 ## <summary>
+##	Set the attributes of generic lock directories
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`files_setattr_lock_dirs',`
+	gen_require(`
+		type var_t, var_lock_t;
+	')
+
+	setattr_dirs_pattern($1, var_t, var_lock_t)
+')
+
+########################################
+## <summary>
 ##	Delete generic lock files.
 ## </summary>
 ## <param name="domain">
@@ -5745,6 +5877,7 @@
 
 	allow $1 var_t:dir search_dir_perms;
 	allow $1 var_lock_t:lnk_file read_lnk_file_perms;
+	manage_dirs_pattern($1, var_lock_t, var_lock_t)
 	manage_files_pattern($1, var_lock_t, var_lock_t)
 ')
 
@@ -5989,6 +6122,29 @@
 	allow $1 var_run_t:lnk_file read_lnk_file_perms;
 	allow $1 var_run_t:fifo_file write;
 ')
+########################################
+## <summary>
+##	Write dirs in /var/run with the lock file type
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="name" optional="true">
+##	<summary>
+##	Name of the directory that the file transition will work on
+##	</summary>
+## </param>
+#
+interface(`files_pid_filetrans_lock_dir',`
+	gen_require(`
+		type var_t, var_run_t;
+	')
+
+	files_pid_filetrans($1, var_lock_t, dir, $2)
+')
+
 
 ########################################
 ## <summary>
@@ -6054,29 +6210,6 @@
 
 ########################################
 ## <summary>
-## 	Create a generic lock directory within the run directories
-## </summary>
-## <param name="domain">
-## 	<summary>
-##	Domain allowed access
-##	</summary>
-## </param>
-## <param name="name" optional="true">
-##	<summary>
-##	The name of the object being created.
-##	</summary>
-## </param>
-#
-interface(`files_pid_filetrans_lock_dir',`
-	gen_require(`
-		type var_lock_t;
-	')
-
-	files_pid_filetrans($1, var_lock_t, dir, $2)
-')
-
-########################################
-## <summary>
 ##	Read and write generic process ID files.
 ## </summary>
 ## <param name="domain">
@@ -6179,8 +6312,7 @@
 
 ########################################
 ## <summary>
-##	Mount filesystems on all polyinstantiation
-##	member directories.
+##	Create PID directories.
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -6188,12 +6320,14 @@
 ##	</summary>
 ## </param>
 #
-interface(`files_mounton_all_poly_members',`
+interface(`files_create_pid_dirs',`
 	gen_require(`
-		attribute polymember;
+		type var_t, var_run_t;
 	')
 
-	allow $1 polymember:dir mounton;
+	allow $1 var_t:dir search_dir_perms;
+	allow $1 var_run_t:lnk_file read_lnk_file_perms;
+	create_dirs_pattern($1, var_run_t, var_run_t)
 ')
 
 ########################################
@@ -6244,6 +6378,46 @@
 ')
 
 ########################################
+## <summary>
+##	Create, read, write and delete all
+##	var_run (pid) content
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain alloed access.
+##	</summary>
+## </param>
+#
+interface(`files_manage_all_pids',`
+	gen_require(`
+		attribute pidfile;
+	')
+
+	manage_dirs_pattern($1, pidfile, pidfile)
+	manage_files_pattern($1, pidfile, pidfile)
+	manage_lnk_files_pattern($1, pidfile, pidfile)
+')
+
+########################################
+## <summary>
+##	Mount filesystems on all polyinstantiation
+##	member directories.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`files_mounton_all_poly_members',`
+	gen_require(`
+		attribute polymember;
+	')
+
+	allow $1 polymember:dir mounton;
+')
+
+########################################
 ## <summary>
 ##	Search the contents of generic spool
 ##	directories (/var/spool).
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/kernel/files.te refpolicy/policy/modules/kernel/files.te
--- refpolicy/policy/modules/kernel/files.te	2012-07-25 20:33:04.000000000 +0200
+++ refpolicy/policy/modules/kernel/files.te	2012-10-31 19:01:48.819580048 +0100
@@ -1,4 +1,4 @@
-policy_module(files, 1.17.0)
+policy_module(files, 1.17.5)
 
 ########################################
 #
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/kernel/filesystem.if refpolicy/policy/modules/kernel/filesystem.if
--- refpolicy/policy/modules/kernel/filesystem.if	2012-05-10 15:25:34.000000000 +0200
+++ refpolicy/policy/modules/kernel/filesystem.if	2012-10-30 19:24:36.871398554 +0100
@@ -3815,6 +3815,24 @@
 
 ########################################
 ## <summary>
+##	Do not audit getting the attributes of a tmpfs filesystem
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain to not audit
+##	</summary>
+## </param>
+#
+interface(`fs_dontaudit_getattr_tmpfs',`
+	gen_require(`
+		type tmpfs_t;
+	')
+
+	dontaudit $1 tmpfs_t:filesystem getattr;
+')
+
+########################################
+## <summary>
 ##	Get the attributes of a tmpfs
 ##	filesystem.
 ## </summary>
@@ -3853,6 +3871,24 @@
 
 ########################################
 ## <summary>
+##	Relabel from tmpfs filesystem.
+## </summary>
+## <param name="type">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`fs_relabelfrom_tmpfs',`
+	gen_require(`
+		type tmpfs_t;
+	')
+
+	allow $1 tmpfs_t:filesystem relabelfrom;
+')
+
+########################################
+## <summary>
 ##	Get the attributes of tmpfs directories.
 ## </summary>
 ## <param name="domain">
@@ -3889,6 +3925,24 @@
 ')
 
 ########################################
+## <summary>
+##	Mount on tmpfs directories.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`fs_mounton_tmpfs',`
+	gen_require(`
+		type tmpfs_t;
+	')
+
+	allow $1 tmpfs_t:dir mounton;
+')
+
+########################################
 ## <summary>
 ##	Set the attributes of tmpfs directories.
 ## </summary>
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/kernel/filesystem.te refpolicy/policy/modules/kernel/filesystem.te
--- refpolicy/policy/modules/kernel/filesystem.te	2012-07-25 20:33:04.000000000 +0200
+++ refpolicy/policy/modules/kernel/filesystem.te	2012-11-10 18:39:41.548746519 +0100
@@ -1,4 +1,4 @@
-policy_module(filesystem, 1.16.0)
+policy_module(filesystem, 1.16.1)
 
 ########################################
 #
@@ -33,6 +33,7 @@
 fs_use_xattr jfs gen_context(system_u:object_r:fs_t,s0);
 fs_use_xattr lustre gen_context(system_u:object_r:fs_t,s0);
 fs_use_xattr xfs gen_context(system_u:object_r:fs_t,s0);
+fs_use_xattr zfs gen_context(system_u:object_r:fs_t,s0);
 
 # Use the allocating task SID to label inodes in the following filesystem
 # types, and label the filesystem itself with the specified context.
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/kernel/kernel.if refpolicy/policy/modules/kernel/kernel.if
--- refpolicy/policy/modules/kernel/kernel.if	2012-06-06 19:33:05.000000000 +0200
+++ refpolicy/policy/modules/kernel/kernel.if	2012-10-19 17:03:59.881547790 +0200
@@ -254,6 +254,25 @@
 
 ########################################
 ## <summary>
+##	Connect to kernel using a unix
+##	domain stream socket.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`kernel_stream_connect',`
+	gen_require(`
+		type kernel_t;
+	')
+
+	allow $1 kernel_t:unix_stream_socket connectto;
+')
+
+########################################
+## <summary>
 ##	Read and write kernel unix datagram sockets.
 ## </summary>
 ## <param name="domain">
@@ -1843,6 +1862,24 @@
 	list_dirs_pattern($1, { proc_t sysctl_t }, sysctl_crypto_t)
 ')
 
+#######################################
+## <summary>
+##	Do not audit attempted reading of kernel sysctls
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain to not audit accesses from
+##	</summary>
+## </param>
+#
+interface(`kernel_dontaudit_read_kernel_sysctls',`
+	gen_require(`
+		type sysctl_kernel_t;
+	')
+
+	dontaudit $1 sysctl_kernel_t:file read_file_perms;
+')
+
 ########################################
 ## <summary>
 ##	Read general kernel sysctls.
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/kernel/kernel.te refpolicy/policy/modules/kernel/kernel.te
--- refpolicy/policy/modules/kernel/kernel.te	2012-07-25 20:33:04.000000000 +0200
+++ refpolicy/policy/modules/kernel/kernel.te	2012-10-19 17:04:02.669547796 +0200
@@ -1,4 +1,4 @@
-policy_module(kernel, 1.16.0)
+policy_module(kernel, 1.16.1)
 
 ########################################
 #
@@ -224,6 +224,7 @@
 
 # Other possible mount points for the root fs are in files
 allow kernel_t unlabeled_t:dir mounton;
+dontaudit kernel_t unlabeled_t:dir search;
 # Kernel-generated traffic e.g., TCP resets on
 # connections with invalidated labels:
 allow kernel_t unlabeled_t:packet send;
@@ -253,6 +254,7 @@
 dev_create_generic_blk_files(kernel_t)
 dev_delete_generic_blk_files(kernel_t)
 dev_create_generic_chr_files(kernel_t)
+dev_setattr_generic_chr_files(kernel_t)
 dev_delete_generic_chr_files(kernel_t)
 dev_mounton(kernel_t)
 
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/kernel/selinux.if refpolicy/policy/modules/kernel/selinux.if
--- refpolicy/policy/modules/kernel/selinux.if	2012-05-04 15:14:47.000000000 +0200
+++ refpolicy/policy/modules/kernel/selinux.if	2012-04-21 20:07:11.479210983 +0200
@@ -63,6 +63,10 @@
 	# (/selinux) is already a selinuxfs
 	allow $1 security_t:filesystem getattr;
 
+	# Same for /sys/fs/selinux
+	dev_getattr_sysfs_fs($1)
+	dev_search_sysfs($1)
+
 	# read /proc/filesystems to see if selinuxfs is supported
 	# then read /proc/self/mount to see where selinuxfs is mounted
 	kernel_read_system_state($1)
@@ -89,6 +93,10 @@
 	# (/selinux) is already a selinuxfs
 	dontaudit $1 security_t:filesystem getattr;
 
+	# Same for /sys/fs/selinux
+	dev_dontaudit_getattr_sysfs_fs($1)
+	dev_dontaudit_search_sysfs($1)
+
 	# read /proc/filesystems to see if selinuxfs is supported
 	# then read /proc/self/mount to see where selinuxfs is mounted
 	kernel_dontaudit_read_system_state($1)
@@ -165,6 +173,8 @@
 	')
 
 	allow $1 security_t:filesystem getattr;
+	dev_getattr_sysfs_fs($1)
+	dev_search_sysfs($1)
 ')
 
 ########################################
@@ -184,6 +194,9 @@
 	')
 
 	dontaudit $1 security_t:filesystem getattr;
+
+	dev_dontaudit_getattr_sysfs_fs($1)
+	dev_dontaudit_search_sysfs($1)
 ')
 
 ########################################
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/kernel/terminal.if refpolicy/policy/modules/kernel/terminal.if
--- refpolicy/policy/modules/kernel/terminal.if	2012-05-04 15:14:47.000000000 +0200
+++ refpolicy/policy/modules/kernel/terminal.if	2012-10-30 19:24:33.092398546 +0100
@@ -384,6 +384,25 @@
 
 ########################################
 ## <summary>
+##	Relabel from and to pty filesystem.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`term_relabel_pty_fs',`
+	gen_require(`
+		type devpts_t;
+	')
+
+	dev_list_all_dev_nodes($1)
+	allow $1 devpts_t:filesystem { relabelto relabelfrom };
+')
+
+########################################
+## <summary>
 ##	Do not audit attempts to get the
 ##	attributes of the /dev/pts directory.
 ## </summary>
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/kernel/terminal.te refpolicy/policy/modules/kernel/terminal.te
--- refpolicy/policy/modules/kernel/terminal.te	2012-05-04 15:14:47.000000000 +0200
+++ refpolicy/policy/modules/kernel/terminal.te	2012-10-30 19:29:02.512400320 +0100
@@ -1,4 +1,4 @@
-policy_module(terminal, 1.10.0)
+policy_module(terminal, 1.10.1)
 
 ########################################
 #
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/roles/staff.te refpolicy/policy/modules/roles/staff.te
--- refpolicy/policy/modules/roles/staff.te	2012-05-04 15:14:47.000000000 +0200
+++ refpolicy/policy/modules/roles/staff.te	2012-10-30 21:22:17.539413624 +0100
@@ -1,4 +1,4 @@
-policy_module(staff, 2.3.0)
+policy_module(staff, 2.3.1)
 
 ########################################
 #
@@ -23,6 +23,10 @@
 ')
 
 optional_policy(`
+	chromium_role(staff_r, staff_t)
+')
+
+optional_policy(`
 	dbadm_role_change(staff_r)
 ')
 
@@ -78,6 +82,10 @@
 
 	optional_policy(`
 		dbus_role_template(staff, staff_r, staff_t)
+
+		optional_policy(`
+			gnome_role_template(staff, staff_r, staff_t)
+		')
 	')
 
 	optional_policy(`
@@ -93,7 +101,7 @@
 	')
 
 	optional_policy(`
-		gnome_role(staff_r, staff_t)
+		gorg_role(staff_r, staff_t)
 	')
 
 	optional_policy(`
@@ -109,6 +117,10 @@
 	')
 
 	optional_policy(`
+		links_role(staff_r, staff_t)
+	')
+
+	optional_policy(`
 		lockdev_role(staff_r, staff_t)
 	')
 
@@ -129,6 +141,14 @@
 	')
 
 	optional_policy(`
+		mutt_role(staff_r, staff_t)
+	')
+
+	optional_policy(`
+		pan_role(staff_r, staff_t)
+	')
+
+	optional_policy(`
 		pyzor_role(staff_r, staff_t)
 	')
 
@@ -141,6 +161,10 @@
 	')
 
 	optional_policy(`
+		skype_role(staff_r, staff_t)
+	')
+
+	optional_policy(`
 		screen_role_template(staff, staff_r, staff_t)
 	')
 
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/roles/sysadm.te refpolicy/policy/modules/roles/sysadm.te
--- refpolicy/policy/modules/roles/sysadm.te	2012-07-25 20:33:05.000000000 +0200
+++ refpolicy/policy/modules/roles/sysadm.te	2012-11-17 18:41:14.680037607 +0100
@@ -1,4 +1,4 @@
-policy_module(sysadm, 2.5.0)
+policy_module(sysadm, 2.5.1)
 
 ########################################
 #
@@ -52,6 +52,9 @@
 ')
 
 ifdef(`distro_gentoo',`
+	# To support mirrorselect / netselect
+	allow sysadm_t self:rawip_socket create_socket_perms;
+
 	init_exec_rc(sysadm_t)
 ')
 
@@ -86,6 +89,7 @@
 ')
 
 optional_policy(`
+	asterisk_admin(sysadm_t, sysadm_r)
 	asterisk_stream_connect(sysadm_t)
 ')
 
@@ -102,6 +106,7 @@
 ')
 
 optional_policy(`
+	bind_admin(sysadm_t, sysadm_r)
 	bind_run_ndc(sysadm_t, sysadm_r)
 ')
 
@@ -152,6 +157,10 @@
 ')
 
 optional_policy(`
+	dracut_run(sysadm_t, sysadm_r)
+')
+
+optional_policy(`
 	firstboot_run(sysadm_t, sysadm_r)
 ')
 
@@ -237,25 +246,45 @@
 ')
 
 optional_policy(`
+	mutt_role(sysadm_r, sysadm_t)
+')
+
+optional_policy(`
 	mysql_stream_connect(sysadm_t)
 ')
 
 optional_policy(`
+	networkmanager_run_wpa_cli(sysadm_t, sysadm_r)
+')
+
+optional_policy(`
 	netutils_run(sysadm_t, sysadm_r)
 	netutils_run_ping(sysadm_t, sysadm_r)
 	netutils_run_traceroute(sysadm_t, sysadm_r)
 ')
 
 optional_policy(`
+	nginx_admin(sysadm_t, sysadm_r)
+')
+
+optional_policy(`
 	ntp_stub()
 	corenet_udp_bind_ntp_port(sysadm_t)
 ')
 
 optional_policy(`
+	ntp_admin(sysadm_t, sysadm_r)
+')
+
+optional_policy(`
 	oav_run_update(sysadm_t, sysadm_r)
 ')
 
 optional_policy(`
+	openvpn_admin(sysadm_t, sysadm_r)
+')
+
+optional_policy(`
 	pcmcia_run_cardctl(sysadm_t, sysadm_r)
 ')
 
@@ -270,10 +299,31 @@
 ')
 
 optional_policy(`
+	postfix_admin(sysadm_t, sysadm_r)
+')
+
+optional_policy(`
+	postgresql_admin(sysadm_t, sysadm_r)
+	postgresql_exec(sysadm_t)
+')
+
+optional_policy(`
+	puppet_admin(sysadm_t, sysadm_r)
+')
+
+optional_policy(`
 	pyzor_role(sysadm_r, sysadm_t)
 ')
 
 optional_policy(`
+	qemu_read_state(sysadm_t)
+	qemu_signal(sysadm_t)
+	qemu_kill(sysadm_t)
+	qemu_setsched(sysadm_t)
+	qemu_run(sysadm_t, sysadm_r)
+')
+
+optional_policy(`
 	quota_run(sysadm_t, sysadm_r)
 ')
 
@@ -302,12 +352,16 @@
 ')
 
 optional_policy(`
+	rtorrent_admin(sysadm_t, sysadm_r)
+')
+
+optional_policy(`
 	samba_run_net(sysadm_t, sysadm_r)
 	samba_run_winbind_helper(sysadm_t, sysadm_r)
 ')
 
 optional_policy(`
-	samhain_admin(sysadm_t)
+	samhain_admin(sysadm_t, sysadm_r)
 ')
 
 optional_policy(`
@@ -394,6 +448,10 @@
 ')
 
 optional_policy(`
+	vde_role(sysadm_r, sysadm_t)
+')
+
+optional_policy(`
 	virt_stream_connect(sysadm_t)
 ')
 
@@ -444,6 +502,10 @@
 
 	optional_policy(`
 		dbus_role_template(sysadm, sysadm_r, sysadm_t)
+
+		optional_policy(`
+			gnome_role_template(sysadm, sysadm_r, sysadm_t)
+		')
 	')
 
 	optional_policy(`
@@ -459,7 +521,7 @@
 	')
 
 	optional_policy(`
-		gnome_role(sysadm_r, sysadm_t)
+		gorg_role(sysadm_r, sysadm_t)
 	')
 
 	optional_policy(`
@@ -475,3 +537,16 @@
 	')
 ')
 
+ifdef(`distro_gentoo',`
+	optional_policy(`
+		dovecot_admin(sysadm_t, sysadm_r)
+	')
+
+	optional_policy(`
+		fail2ban_run_client(sysadm_t, sysadm_r)
+	')
+
+	optional_policy(`
+		shorewall_admin(sysadm_t, sysadm_r)
+	')
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/roles/unprivuser.te refpolicy/policy/modules/roles/unprivuser.te
--- refpolicy/policy/modules/roles/unprivuser.te	2012-05-04 15:14:47.000000000 +0200
+++ refpolicy/policy/modules/roles/unprivuser.te	2012-10-30 21:22:17.540413624 +0100
@@ -1,4 +1,4 @@
-policy_module(unprivuser, 2.3.0)
+policy_module(unprivuser, 2.3.1)
 
 # this module should be named user, but that is
 # a compile error since user is a keyword.
@@ -17,6 +17,10 @@
 ')
 
 optional_policy(`
+	chromium_role(user_r, user_t)
+')
+
+optional_policy(`
 	git_role(user_r, user_t)
 ')
 
@@ -51,6 +55,10 @@
 
 	optional_policy(`
 		dbus_role_template(user, user_r, user_t)
+
+		optional_policy(`
+			gnome_role_template(user, user_r, user_t)
+		')
 	')
 
 	optional_policy(`
@@ -66,7 +74,7 @@
 	')
 
 	optional_policy(`
-		gnome_role(user_r, user_t)
+		gorg_role(user_r, user_t)
 	')
 
 	optional_policy(`
@@ -86,6 +94,10 @@
 	')
 
 	optional_policy(`
+		links_role(user_r, user_t)
+	')
+
+	optional_policy(`
 		lockdev_role(user_r, user_t)
 	')
 
@@ -106,6 +118,14 @@
 	')
 
 	optional_policy(`
+		mutt_role(user_r, user_t)
+	')
+
+	optional_policy(`
+		pan_role(user_r, user_t)
+	')
+
+	optional_policy(`
 		postgresql_role(user_r, user_t)
 	')
 
@@ -122,6 +142,14 @@
 	')
 
 	optional_policy(`
+		rtorrent_role(user_r, user_t)
+	')
+
+	optional_policy(`
+		skype_role(user_r, user_t)
+	')
+
+	optional_policy(`
 		spamassassin_role(user_r, user_t)
 	')
 
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/services/postgresql.fc refpolicy/policy/modules/services/postgresql.fc
--- refpolicy/policy/modules/services/postgresql.fc	2012-05-10 16:22:40.000000000 +0200
+++ refpolicy/policy/modules/services/postgresql.fc	2012-04-22 14:08:14.677349430 +0200
@@ -2,6 +2,9 @@
 # /etc
 #
 /etc/postgresql(/.*)?			gen_context(system_u:object_r:postgresql_etc_t,s0)
+ifdef(`distro_gentoo',`
+/etc/postgresql-.*(/.*)?		gen_context(system_u:object_r:postgresql_etc_t,s0)
+')
 /etc/rc\.d/init\.d/(se)?postgresql --	gen_context(system_u:object_r:postgresql_initrc_exec_t,s0)
 /etc/sysconfig/pgsql(/.*)? 		gen_context(system_u:object_r:postgresql_etc_t,s0)
 
@@ -13,7 +16,7 @@
 
 /usr/lib/pgsql/test/regress(/.*)?	gen_context(system_u:object_r:postgresql_db_t,s0)
 /usr/lib/pgsql/test/regress/pg_regress -- gen_context(system_u:object_r:postgresql_exec_t,s0)
-/usr/lib/postgresql/bin/.*	--	gen_context(system_u:object_r:postgresql_exec_t,s0)
+/usr/lib/postgresql/bin/.* --	gen_context(system_u:object_r:postgresql_exec_t,s0)
 
 ifdef(`distro_debian', `
 /usr/lib/postgresql/.*/bin/.*	--	gen_context(system_u:object_r:postgresql_exec_t,s0)
@@ -23,6 +26,10 @@
 /usr/share/jonas/pgsql(/.*)?		gen_context(system_u:object_r:postgresql_db_t,s0)
 ')
 
+ifdef(`distro_gentoo',`
+/usr/lib/postgresql-.*/bin/.*	--	gen_context(system_u:object_r:postgresql_exec_t,s0)
+')
+
 #
 # /var
 #
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/services/postgresql.if refpolicy/policy/modules/services/postgresql.if
--- refpolicy/policy/modules/services/postgresql.if	2012-05-18 19:59:12.000000000 +0200
+++ refpolicy/policy/modules/services/postgresql.if	2012-10-10 21:49:20.714028130 +0200
@@ -334,6 +334,24 @@
 	allow $1 postgresql_db_t:lnk_file { getattr read };
 ')
 
+#######################################
+## <summary>
+##	Execute postgresql in the calling domain.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access
+##	</summary>
+## </param>
+#
+interface(`postgresql_exec',`
+	gen_require(`
+		type postgresql_exec_t;
+	')
+
+	can_exec($1, postgresql_exec_t);
+')
+
 ########################################
 ## <summary>
 ##	Execute postgresql in the postgresql domain.
@@ -428,11 +446,10 @@
 		type postgresql_t, postgresql_var_run_t, postgresql_tmp_t;
 	')
 
+	stream_connect_pattern($1, { postgresql_var_run_t postgresql_tmp_t }, { postgresql_var_run_t postgresql_tmp_t }, postgresql_t)
+
 	files_search_pids($1)
-	allow $1 postgresql_t:unix_stream_socket connectto;
-	allow $1 postgresql_var_run_t:sock_file write;
-	# Some versions of postgresql put the sock file in /tmp
-	allow $1 postgresql_tmp_t:sock_file write;
+	files_search_tmp($1)
 ')
 
 ########################################
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/services/postgresql.te refpolicy/policy/modules/services/postgresql.te
--- refpolicy/policy/modules/services/postgresql.te	2012-07-25 20:33:04.000000000 +0200
+++ refpolicy/policy/modules/services/postgresql.te	2012-10-10 21:49:41.641027980 +0200
@@ -1,4 +1,4 @@
-policy_module(postgresql, 1.15.0)
+policy_module(postgresql, 1.15.3)
 
 gen_require(`
 	class db_database all_db_database_perms;
@@ -23,7 +23,7 @@
 ## Allow unprived users to execute DDL statement
 ## </p>
 ## </desc>
-gen_tunable(sepgsql_enable_users_ddl, true)
+gen_tunable(sepgsql_enable_users_ddl, false)
 
 ## <desc>
 ## <p>
@@ -37,7 +37,7 @@
 ## Allow database admins to execute DML statement
 ## </p>
 ## </desc>
-gen_tunable(sepgsql_unconfined_dbadm, true)
+gen_tunable(sepgsql_unconfined_dbadm, false)
 
 type postgresql_t;
 type postgresql_exec_t;
@@ -63,6 +63,7 @@
 
 type postgresql_var_run_t;
 files_pid_file(postgresql_var_run_t)
+init_daemon_run_dir(postgresql_var_run_t, "postgresql")
 
 # database clients attribute
 attribute sepgsql_admin_type;
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/services/xserver.fc refpolicy/policy/modules/services/xserver.fc
--- refpolicy/policy/modules/services/xserver.fc	2012-05-10 16:22:52.000000000 +0200
+++ refpolicy/policy/modules/services/xserver.fc	2012-09-28 19:51:40.830033021 +0200
@@ -5,6 +5,7 @@
 HOME_DIR/\.fonts(/.*)?		gen_context(system_u:object_r:user_fonts_t,s0)
 HOME_DIR/\.fonts/auto(/.*)?	gen_context(system_u:object_r:user_fonts_cache_t,s0)
 HOME_DIR/\.fonts\.cache-.* --	gen_context(system_u:object_r:user_fonts_cache_t,s0)
+HOME_DIR/\.fontconfig(/.*)?	gen_context(system_u:object_r:user_fonts_cache_t,s0)
 HOME_DIR/\.ICEauthority.* --	gen_context(system_u:object_r:iceauth_home_t,s0)
 HOME_DIR/\.serverauth.*	--	gen_context(system_u:object_r:xauth_home_t,s0)
 HOME_DIR/\.xauth.*	--	gen_context(system_u:object_r:xauth_home_t,s0)
@@ -18,11 +19,11 @@
 #
 # /etc
 #
-/etc/gdm/PostSession/.*	--	gen_context(system_u:object_r:xsession_exec_t,s0)
-/etc/gdm/PreSession/.*	--	gen_context(system_u:object_r:xsession_exec_t,s0)
-/etc/gdm/Xsession	--	gen_context(system_u:object_r:xsession_exec_t,s0)
+/etc/gdm(3)?/PostSession/.*	--	gen_context(system_u:object_r:xsession_exec_t,s0)
+/etc/gdm(3)?/PreSession/.*	--	gen_context(system_u:object_r:xsession_exec_t,s0)
+/etc/gdm(3)?/Xsession	--	gen_context(system_u:object_r:xsession_exec_t,s0)
 
-/etc/init\.d/xfree86-common --	gen_context(system_u:object_r:xserver_exec_t,s0)
+/etc/rc\.d/init\.d/xfree86-common --	gen_context(system_u:object_r:xserver_exec_t,s0)
 
 /etc/kde[34]?/kdm/Xstartup --	gen_context(system_u:object_r:xsession_exec_t,s0)
 /etc/kde[34]?/kdm/Xreset --	gen_context(system_u:object_r:xsession_exec_t,s0)
@@ -56,9 +57,10 @@
 # /usr
 #
 
+/usr/(s)?bin/gdm(3)?	--      gen_context(system_u:object_r:xdm_exec_t,s0)
 /usr/(s)?bin/gdm-binary	--	gen_context(system_u:object_r:xdm_exec_t,s0)
 /usr/(s)?bin/lxdm(-binary)? --	gen_context(system_u:object_r:xdm_exec_t,s0)
-/usr/(s)?bin/[xgkw]dm	--	gen_context(system_u:object_r:xdm_exec_t,s0)
+/usr/(s)?bin/[xkw]dm	--	gen_context(system_u:object_r:xdm_exec_t,s0)
 /usr/bin/gpe-dm		--	gen_context(system_u:object_r:xdm_exec_t,s0)
 /usr/bin/iceauth	--	gen_context(system_u:object_r:iceauth_exec_t,s0)
 /usr/bin/slim		--	gen_context(system_u:object_r:xdm_exec_t,s0)
@@ -89,18 +91,20 @@
 
 /var/[xgkw]dm(/.*)?		gen_context(system_u:object_r:xserver_log_t,s0)
 
+/var/lib/gdm(3)?(/.*)?		gen_context(system_u:object_r:xdm_var_lib_t,s0)
 /var/lib/lxdm(/.*)?		gen_context(system_u:object_r:xdm_var_lib_t,s0)
 /var/lib/[xkw]dm(/.*)?		gen_context(system_u:object_r:xdm_var_lib_t,s0)
 /var/lib/xkb(/.*)?		gen_context(system_u:object_r:xkb_var_lib_t,s0)
 
 /var/log/[kwx]dm\.log.*	--	gen_context(system_u:object_r:xserver_log_t,s0)
 /var/log/lxdm\.log	--	gen_context(system_u:object_r:xserver_log_t,s0)
-/var/log/gdm(/.*)?		gen_context(system_u:object_r:xserver_log_t,s0)
+/var/log/gdm(3)?(/.*)?		gen_context(system_u:object_r:xserver_log_t,s0)
 /var/log/slim\.log	--	gen_context(system_u:object_r:xserver_log_t,s0)
 /var/log/XFree86.*	--	gen_context(system_u:object_r:xserver_log_t,s0)
 /var/log/Xorg.*		--	gen_context(system_u:object_r:xserver_log_t,s0)
 
-/var/run/[gx]dm\.pid	--	gen_context(system_u:object_r:xdm_var_run_t,s0)
+/var/run/gdm(3)?\.pid	--	gen_context(system_u:object_r:xdm_var_run_t,s0)
+/var/run/xdm\.pid	--	gen_context(system_u:object_r:xdm_var_run_t,s0)
 /var/run/lxdm\.auth	--	gen_context(system_u:object_r:xdm_var_run_t,s0)
 /var/run/lxdm\.pid	--	gen_context(system_u:object_r:xdm_var_run_t,s0)
 /var/run/lxdm(/.*)?		gen_context(system_u:object_r:xdm_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/services/xserver.if refpolicy/policy/modules/services/xserver.if
--- refpolicy/policy/modules/services/xserver.if	2012-03-30 14:48:20.000000000 +0200
+++ refpolicy/policy/modules/services/xserver.if	2012-10-19 17:03:52.444547774 +0200
@@ -713,6 +713,47 @@
 
 ########################################
 ## <summary>
+##	Read xdm process state files.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`xserver_read_xdm_state',`
+	gen_require(`
+		type xdm_t;
+	')
+
+	kernel_search_proc($1)
+	allow $1 xdm_t:dir list_dir_perms;
+	allow $1 xdm_t:file read_file_perms;
+	allow $1 xdm_t:lnk_file read_lnk_file_perms;
+')
+
+########################################
+## <summary>
+##	Create, read, write, and delete
+##	xdm_spool files.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`xserver_manage_xdm_spool_files',`
+	gen_require(`
+		type xdm_spool_t;
+	')
+
+	files_search_spool($1)
+	manage_files_pattern($1, xdm_spool_t, xdm_spool_t)
+')
+
+########################################
+## <summary>
 ##	Connect to XDM over a unix domain
 ##	stream socket.
 ## </summary>
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/services/xserver.te refpolicy/policy/modules/services/xserver.te
--- refpolicy/policy/modules/services/xserver.te	2012-07-25 20:33:04.000000000 +0200
+++ refpolicy/policy/modules/services/xserver.te	2012-10-19 17:03:54.518547779 +0200
@@ -1,4 +1,4 @@
-policy_module(xserver, 3.8.0)
+policy_module(xserver, 3.8.3)
 
 gen_require(`
 	class x_drawable all_x_drawable_perms;
@@ -229,11 +229,14 @@
 
 allow xdm_t iceauth_home_t:file read_file_perms;
 
+files_search_tmp(iceauth_t)
 fs_search_auto_mountpoints(iceauth_t)
 
 userdom_use_user_terminals(iceauth_t)
 userdom_read_user_tmp_files(iceauth_t)
 
+getty_use_fds(iceauth_t)
+
 tunable_policy(`use_nfs_home_dirs',`
 	fs_manage_nfs_files(iceauth_t)
 ')
@@ -277,6 +280,7 @@
 
 userdom_use_user_terminals(xauth_t)
 userdom_read_user_tmp_files(xauth_t)
+userdom_read_user_tmp_files(xserver_t)
 
 xserver_rw_xdm_tmp_files(xauth_t)
 
@@ -586,6 +590,9 @@
 allow xserver_t { root_xdrawable_t x_domain }:x_drawable send;
 allow xserver_t input_xevent_t:x_event send;
 
+# Allow X to process keyboard events
+udev_read_db(xserver_t)
+
 # setuid/setgid for the wrapper program to change UID
 # sys_rawio is for iopl access - should not be needed for frame-buffer
 # sys_admin, locking shared mem?  chowning IPC message queues or semaphores?
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/system/authlogin.fc refpolicy/policy/modules/system/authlogin.fc
--- refpolicy/policy/modules/system/authlogin.fc	2012-05-04 15:14:47.000000000 +0200
+++ refpolicy/policy/modules/system/authlogin.fc	2012-04-22 10:50:38.187324123 +0200
@@ -1,7 +1,9 @@
 
 /bin/login		--	gen_context(system_u:object_r:login_exec_t,s0)
 
+ifndef(`distro_gentoo',`
 /etc/\.pwd\.lock	--	gen_context(system_u:object_r:shadow_t,s0)
+')
 /etc/group\.lock	--	gen_context(system_u:object_r:shadow_t,s0)
 /etc/gshadow.*		--	gen_context(system_u:object_r:shadow_t,s0)
 /etc/passwd\.lock	--	gen_context(system_u:object_r:shadow_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/system/authlogin.if refpolicy/policy/modules/system/authlogin.if
--- refpolicy/policy/modules/system/authlogin.if	2012-07-10 14:41:49.000000000 +0200
+++ refpolicy/policy/modules/system/authlogin.if	2012-10-19 17:03:57.279547785 +0200
@@ -395,7 +395,7 @@
 	')
 
 	optional_policy(`
-		pcscd_read_pub_files($1)
+		pcscd_read_pid_files($1)
 		pcscd_stream_connect($1)
 	')
 
@@ -1102,6 +1102,36 @@
 
 ########################################
 ## <summary>
+##	Automatically transition when a resource is created in the generic run
+##	location (/var/run or /run) to the pam console data label
+##	(pam_var_console_t).
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access
+##	</summary>
+## </param>
+## <param name="class">
+##	<summary>
+##	Class of the resource created
+##	</summary>
+## </param>
+## <param name="filename" optional="true">
+##	<summary>
+##	Name of the resource created (optional).
+##	</summary>
+## </param>
+#
+interface(`auth_generic_run_filetrans_pam_console_data',`
+	gen_require(`
+		type pam_var_console_t;
+	')
+
+	files_pid_filetrans($1, pam_var_console_t, $2, $3)
+')
+
+########################################
+## <summary>
 ##	Relabel pam_console data directories.
 ## </summary>
 ## <param name="domain">
@@ -1140,6 +1170,24 @@
 
 ########################################
 ## <summary>
+##	Create pam console data directories
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access
+##	</summary>
+## </param>
+#
+interface(`auth_create_pam_console_data_dirs',`
+	gen_require(`
+		type pam_var_console_t;
+	')
+
+	allow $1 pam_var_console_t:dir create_dir_perms;
+')
+
+########################################
+## <summary>
 ##	Create, read, write, and delete
 ##	pam_console data files.
 ## </summary>
@@ -1717,9 +1765,9 @@
 ## <infoflow type="both" weight="10"/>
 #
 interface(`auth_use_nsswitch',`
-    gen_require(`
-        attribute nsswitch_domain;
-    ')
+	gen_require(`
+		attribute nsswitch_domain;
+	')
 
 	typeattribute $1 nsswitch_domain;
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/system/authlogin.te refpolicy/policy/modules/system/authlogin.te
--- refpolicy/policy/modules/system/authlogin.te	2012-07-25 20:33:04.000000000 +0200
+++ refpolicy/policy/modules/system/authlogin.te	2012-07-28 22:50:12.435345391 +0200
@@ -405,7 +405,7 @@
 	xserver_rw_xdm_pipes(utempter_t)
 ')
 
-#######################################
+#########################################
 #
 # nsswitch_domain local policy
 #
@@ -426,7 +426,7 @@
 
 optional_policy(`
 	tunable_policy(`authlogin_nsswitch_use_ldap',`
-		ldap_stream_connect(nsswitch_domain)
+		 ldap_stream_connect(nsswitch_domain)
 	')
 ')
 
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/system/clock.if refpolicy/policy/modules/system/clock.if
--- refpolicy/policy/modules/system/clock.if	2012-05-04 15:14:47.000000000 +0200
+++ refpolicy/policy/modules/system/clock.if	2012-10-30 19:25:01.300398199 +0100
@@ -64,6 +64,25 @@
 
 ########################################
 ## <summary>
+##	Read clock drift adjustments.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`clock_read_adjtime',`
+	gen_require(`
+		type adjtime_t;
+	')
+
+	files_list_etc($1)
+	allow $1 adjtime_t:file read_file_perms;
+')
+
+########################################
+## <summary>
 ##	Do not audit attempts to write clock drift adjustments.
 ## </summary>
 ## <param name="domain">
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/system/clock.te refpolicy/policy/modules/system/clock.te
--- refpolicy/policy/modules/system/clock.te	2012-05-04 15:16:38.000000000 +0200
+++ refpolicy/policy/modules/system/clock.te	2012-10-30 19:29:02.513400282 +0100
@@ -1,4 +1,4 @@
-policy_module(clock, 1.6.0)
+policy_module(clock, 1.6.1)
 
 ########################################
 #
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/system/getty.if refpolicy/policy/modules/system/getty.if
--- refpolicy/policy/modules/system/getty.if	2012-05-04 15:14:47.000000000 +0200
+++ refpolicy/policy/modules/system/getty.if	2012-07-23 12:47:19.537346153 +0200
@@ -21,6 +21,24 @@
 
 ########################################
 ## <summary>
+##	Do not audit the use of getty file descriptors.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`getty_dontaudit_use_fds',`
+	gen_require(`
+		type getty_t;
+	')
+
+	dontaudit $1 getty_t:fd use;
+')
+
+########################################
+## <summary>
 ##	Inherit and use getty file descriptors.
 ## </summary>
 ## <param name="domain">
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/system/init.fc refpolicy/policy/modules/system/init.fc
--- refpolicy/policy/modules/system/init.fc	2012-05-10 16:18:41.000000000 +0200
+++ refpolicy/policy/modules/system/init.fc	2012-08-09 17:40:24.593873380 +0200
@@ -1,8 +1,6 @@
 #
 # /etc
 #
-/etc/init\.d/.*		--	gen_context(system_u:object_r:initrc_exec_t,s0)
-
 /etc/rc\.d/rc		--	gen_context(system_u:object_r:initrc_exec_t,s0)
 /etc/rc\.d/rc\.[^/]+	--	gen_context(system_u:object_r:initrc_exec_t,s0)
 
@@ -26,6 +24,7 @@
 #
 ifdef(`distro_gentoo', `
 /lib/rc/init\.d(/.*)?		gen_context(system_u:object_r:initrc_state_t,s0)
+/lib/rc/console(/.*)?		gen_context(system_u:object_r:initrc_state_t,s0)
 ')
 
 #
@@ -37,10 +36,6 @@
 
 ifdef(`distro_gentoo', `
 /sbin/rc		--	gen_context(system_u:object_r:rc_exec_t,s0)
-/sbin/runscript		--	gen_context(system_u:object_r:initrc_exec_t,s0)
-/sbin/runscript\.sh	--	gen_context(system_u:object_r:initrc_exec_t,s0)
-/sbin/runsvcscript\.sh	--	gen_context(system_u:object_r:initrc_exec_t,s0)
-/sbin/svcinit		--	gen_context(system_u:object_r:initrc_exec_t,s0)
 ')
 
 #
@@ -69,7 +64,9 @@
 
 ifdef(`distro_gentoo', `
 /var/lib/init\.d(/.*)?		gen_context(system_u:object_r:initrc_state_t,s0)
+/var/lib/ip6?tables(/.*)?		gen_context(system_u:object_r:initrc_tmp_t,s0)
 /var/run/svscan\.pid	--	gen_context(system_u:object_r:initrc_var_run_t,s0)
+/var/run/openrc(/.*)?		gen_context(system_u:object_r:initrc_state_t,s0)
 ')
 
 ifdef(`distro_suse', `
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/system/init.if refpolicy/policy/modules/system/init.if
--- refpolicy/policy/modules/system/init.if	2012-05-10 15:25:34.000000000 +0200
+++ refpolicy/policy/modules/system/init.if	2012-08-14 19:31:06.389412257 +0200
@@ -417,6 +417,32 @@
 
 ########################################
 ## <summary>
+##	Mark the type as a daemon run dir
+## </summary>
+## <param name="rundirtype">
+##	<summary>
+##	Type to mark as a daemon run dir
+##	</summary>
+## </param>
+## <param name="filename">
+##	<summary>
+##	Name of the run dir directory
+##	</summary>
+## </param>
+#
+interface(`init_daemon_run_dir',`
+	gen_require(`
+		attribute daemonrundir;
+		type initrc_t;
+	')
+
+	typeattribute $1 daemonrundir;
+
+	files_pid_filetrans(initrc_t, $1, dir, $2)
+')
+
+########################################
+## <summary>
 ##	Execute init (/sbin/init) with a domain transition.
 ## </summary>
 ## <param name="domain">
@@ -788,6 +814,11 @@
 		type initrc_exec_t;
 	')
 
+	# /sbin/runscript is a wrapper for /sbin/rc, so run_init_t
+	# wants to execute initrc_exec_t (no transition needed anymore) whereas
+	# runscript previously was a binary
+	# allow $1 initrc_exec_t:file execute_no_trans;
+
 	domain_entry_file($1, initrc_exec_t)
 ')
 
@@ -809,14 +840,6 @@
 	files_list_etc($1)
 	spec_domtrans_pattern($1, initrc_exec_t, initrc_t)
 
-	ifdef(`distro_gentoo',`
-		gen_require(`
-			type rc_exec_t;
-		')
-
-		domtrans_pattern($1, rc_exec_t, initrc_t)
-	')
-
 	ifdef(`enable_mcs',`
 		range_transition $1 initrc_exec_t:process s0;
 	')
@@ -851,6 +874,13 @@
 	ifdef(`enable_mls',`
 		range_transition $1 initrc_exec_t:process s0 - mls_systemhigh;
 	')
+
+	ifdef(`distro_gentoo',`
+		gen_require(`
+			type rc_exec_t;
+		')
+		domtrans_pattern($1, rc_exec_t, initrc_t)
+	')
 ')
 
 ########################################
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/system/init.te refpolicy/policy/modules/system/init.te
--- refpolicy/policy/modules/system/init.te	2012-07-25 20:33:04.000000000 +0200
+++ refpolicy/policy/modules/system/init.te	2012-10-31 19:01:57.602580072 +0100
@@ -1,4 +1,4 @@
-policy_module(init, 1.19.0)
+policy_module(init, 1.19.4)
 
 gen_require(`
 	class passwd rootok;
@@ -29,6 +29,9 @@
 # Mark process types as daemons
 attribute daemon;
 
+# Mark file as daemon run dir
+attribute daemonrundir;
+
 #
 # init_t is the domain of the init process.
 #
@@ -119,6 +122,7 @@
 
 # Modify utmp.
 allow init_t initrc_var_run_t:file { rw_file_perms setattr };
+manage_dirs_pattern(initrc_t, initrc_var_run_t, initrc_var_run_t)
 
 kernel_read_system_state(init_t)
 kernel_share_state(init_t)
@@ -222,7 +226,7 @@
 #
 
 allow initrc_t self:process { getpgid setsched setpgid setrlimit getsched };
-allow initrc_t self:capability ~{ sys_admin sys_module };
+allow initrc_t self:capability ~{ sys_module };
 dontaudit initrc_t self:capability sys_module; # sysctl is triggering this
 allow initrc_t self:passwd rootok;
 allow initrc_t self:key manage_key_perms;
@@ -242,6 +246,9 @@
 
 can_exec(initrc_t, init_script_file_type)
 
+create_dirs_pattern(initrc_t, daemonrundir, daemonrundir)
+setattr_dirs_pattern(initrc_t, daemonrundir, daemonrundir)
+
 domtrans_pattern(init_run_all_scripts_domain, initrc_exec_t, initrc_t)
 
 manage_dirs_pattern(initrc_t, initrc_state_t, initrc_state_t)
@@ -250,7 +257,7 @@
 manage_fifo_files_pattern(initrc_t, initrc_state_t, initrc_state_t)
 
 allow initrc_t initrc_var_run_t:file manage_file_perms;
-files_pid_filetrans(initrc_t, initrc_var_run_t, file)
+files_pid_filetrans(initrc_t, initrc_var_run_t, { file dir })
 
 can_exec(initrc_t, initrc_tmp_t)
 manage_files_pattern(initrc_t, initrc_tmp_t, initrc_tmp_t)
@@ -280,6 +287,7 @@
 files_pid_filetrans_lock_dir(initrc_t, "lock")
 files_read_kernel_symbol_table(initrc_t)
 files_setattr_lock_dirs(initrc_t)
+files_dontaudit_write_usr_dirs(initrc_t)
 
 corecmd_exec_all_executables(initrc_t)
 
@@ -300,6 +308,7 @@
 dev_write_rand(initrc_t)
 dev_write_urand(initrc_t)
 dev_rw_sysfs(initrc_t)
+dev_manage_sysfs_dirs(initrc_t)
 dev_list_usbfs(initrc_t)
 dev_read_framebuffer(initrc_t)
 dev_write_framebuffer(initrc_t)
@@ -339,6 +348,7 @@
 files_getattr_all_symlinks(initrc_t)
 files_getattr_all_pipes(initrc_t)
 files_getattr_all_sockets(initrc_t)
+files_create_pid_dirs(initrc_t)
 files_purge_tmp(initrc_t)
 files_delete_all_locks(initrc_t)
 files_read_all_pids(initrc_t)
@@ -357,8 +367,11 @@
 files_mounton_isid_type_dirs(initrc_t)
 files_list_default(initrc_t)
 files_mounton_default(initrc_t)
+files_manage_generic_tmp_files(initrc_t)
+files_manage_generic_tmp_dirs(initrc_t)
 
-fs_write_cgroup_files(initrc_t)
+fs_manage_cgroup_dirs(initrc_t)
+fs_manage_cgroup_files(initrc_t)
 fs_list_inotifyfs(initrc_t)
 fs_register_binary_executable_type(initrc_t)
 # rhgb-console writes to ramfs
@@ -408,6 +421,7 @@
 logging_read_all_logs(initrc_t)
 logging_append_all_logs(initrc_t)
 logging_read_audit_config(initrc_t)
+logging_delete_devlog_socket(initrc_t)
 
 miscfiles_read_localization(initrc_t)
 # slapd needs to read cert files from its initscript
@@ -452,9 +466,12 @@
 	# early init
 	dev_create_generic_dirs(initrc_t)
 	dev_delete_generic_dirs(initrc_t)
+	dev_setattr_generic_dirs(initrc_t)
 
+	files_manage_all_pids(initrc_t)
 	# allow bootmisc to create /var/lock/.keep.
 	files_manage_generic_locks(initrc_t)
+	files_manage_var_symlinks(initrc_t)
 	files_pid_filetrans(initrc_t, initrc_state_t, dir, "openrc")
 
 	# openrc uses tmpfs for its state data
@@ -486,6 +503,10 @@
 	optional_policy(`
 		dhcpd_setattr_state_files(initrc_t)
 	')
+
+	optional_policy(`
+		rpc_manage_nfs_state_data(initrc_t)
+	')
 ')
 
 ifdef(`distro_redhat',`
@@ -607,6 +628,10 @@
 ')
 
 optional_policy(`
+	courier_read_config(initrc_t)
+')
+
+optional_policy(`
 	cpucontrol_stub(initrc_t)
 	dev_getattr_cpu_dev(initrc_t)
 ')
@@ -651,6 +676,10 @@
 ')
 
 optional_policy(`
+	fail2ban_stream_connect(initrc_t)
+')
+
+optional_policy(`
 	ftp_read_config(initrc_t)
 ')
 
@@ -737,10 +766,10 @@
 	ifdef(`distro_redhat',`
 		mysql_manage_db_dirs(initrc_t)
 	')
-
+	mysql_read_config(initrc_t)
+	mysql_setattr_run_dirs(initrc_t)
 	mysql_stream_connect(initrc_t)
 	mysql_write_log(initrc_t)
-	mysql_read_config(initrc_t)
 ')
 
 optional_policy(`
@@ -816,6 +845,10 @@
 optional_policy(`
 	# allow init scripts to su
 	su_restricted_domain_template(initrc, initrc_t, system_r)
+	# Allow initrc_su_t, now defined, to transition to postgresql_t
+	postgresql_domtrans(initrc_su_t)
+	# Allow initrc_su_t to use the initrc_devpts_t (needed for init script failure output)
+	allow initrc_su_t initrc_devpts_t:chr_file { read write };
 ')
 
 optional_policy(`
@@ -828,8 +861,8 @@
 ')
 
 optional_policy(`
-	udev_rw_db(initrc_t)
-	udev_generic_pid_filetrans_run_dirs(initrc_t, "udev")
+	udev_create_db_dirs(initrc_t)
+	udev_pid_filetrans_db(initrc_t, dir, "rules.d")
 	udev_manage_pid_files(initrc_t)
 	udev_manage_pid_dirs(initrc_t)
 	udev_manage_rules_files(initrc_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/system/ipsec.fc refpolicy/policy/modules/system/ipsec.fc
--- refpolicy/policy/modules/system/ipsec.fc	2012-05-10 16:23:17.000000000 +0200
+++ refpolicy/policy/modules/system/ipsec.fc	2012-07-28 18:53:56.059315169 +0200
@@ -14,9 +14,9 @@
 
 /usr/lib/ipsec/_plutoload	-- 	gen_context(system_u:object_r:ipsec_mgmt_exec_t,s0)
 /usr/lib/ipsec/_plutorun	--	gen_context(system_u:object_r:ipsec_mgmt_exec_t,s0)
-/usr/lib/ipsec/eroute		--	gen_context(system_u:object_r:ipsec_exec_t,s0)
+/usr/lib/ipsec/eroute	--	gen_context(system_u:object_r:ipsec_exec_t,s0)
 /usr/lib/ipsec/klipsdebug	--	gen_context(system_u:object_r:ipsec_exec_t,s0)
-/usr/lib/ipsec/pluto		--	gen_context(system_u:object_r:ipsec_exec_t,s0)
+/usr/lib/ipsec/pluto	--	gen_context(system_u:object_r:ipsec_exec_t,s0)
 /usr/lib/ipsec/spi		--	gen_context(system_u:object_r:ipsec_exec_t,s0)
 
 /usr/libexec/ipsec/_plutoload	-- 	gen_context(system_u:object_r:ipsec_mgmt_exec_t,s0)
@@ -27,11 +27,6 @@
 /usr/libexec/ipsec/spi		--	gen_context(system_u:object_r:ipsec_exec_t,s0)
 /usr/libexec/nm-openswan-service -- 	gen_context(system_u:object_r:ipsec_mgmt_exec_t,s0)
 
-/usr/local/lib(64)?/ipsec/eroute --	gen_context(system_u:object_r:ipsec_exec_t,s0)
-/usr/local/lib(64)?/ipsec/klipsdebug -- gen_context(system_u:object_r:ipsec_exec_t,s0)
-/usr/local/lib(64)?/ipsec/pluto --	gen_context(system_u:object_r:ipsec_exec_t,s0)
-/usr/local/lib(64)?/ipsec/spi	--	gen_context(system_u:object_r:ipsec_exec_t,s0)
-
 /usr/sbin/ipsec			-- 	gen_context(system_u:object_r:ipsec_mgmt_exec_t,s0)
 /usr/sbin/racoon		--	gen_context(system_u:object_r:racoon_exec_t,s0)
 /usr/sbin/setkey		--	gen_context(system_u:object_r:setkey_exec_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/system/ipsec.te refpolicy/policy/modules/system/ipsec.te
--- refpolicy/policy/modules/system/ipsec.te	2012-07-25 20:33:04.000000000 +0200
+++ refpolicy/policy/modules/system/ipsec.te	2012-10-02 19:45:54.648009578 +0200
@@ -1,4 +1,4 @@
-policy_module(ipsec, 1.13.0)
+policy_module(ipsec, 1.13.2)
 
 ########################################
 #
@@ -113,6 +113,7 @@
 allow ipsec_mgmt_t ipsec_t:process { rlimitinh sigchld };
 
 kernel_read_kernel_sysctls(ipsec_t)
+kernel_read_net_sysctls(ipsec_t)
 kernel_list_proc(ipsec_t)
 kernel_read_proc_symlinks(ipsec_t)
 # allow pluto to access /proc/net/ipsec_eroute;
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/system/iptables.fc refpolicy/policy/modules/system/iptables.fc
--- refpolicy/policy/modules/system/iptables.fc	2012-05-04 15:14:47.000000000 +0200
+++ refpolicy/policy/modules/system/iptables.fc	2012-11-12 22:47:22.963147059 +0100
@@ -18,3 +18,7 @@
 /usr/sbin/iptables		--	gen_context(system_u:object_r:iptables_exec_t,s0)
 /usr/sbin/iptables-multi 	--	gen_context(system_u:object_r:iptables_exec_t,s0)
 /usr/sbin/iptables-restore	--	gen_context(system_u:object_r:iptables_exec_t,s0)
+
+ifdef(`distro_gentoo',`
+/usr/sbin/ipset			--	gen_context(system_u:object_r:iptables_exec_t,s0)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/system/libraries.fc refpolicy/policy/modules/system/libraries.fc
--- refpolicy/policy/modules/system/libraries.fc	2012-05-10 16:26:34.000000000 +0200
+++ refpolicy/policy/modules/system/libraries.fc	2012-10-30 19:21:03.653398100 +0100
@@ -33,7 +33,7 @@
 /etc/ppp/plugins/rp-pppoe\.so 		--	gen_context(system_u:object_r:lib_t,s0)
 
 #
-# /lib(64)?
+# /lib
 #
 /lib					-d	gen_context(system_u:object_r:lib_t,s0)
 /lib/.*						gen_context(system_u:object_r:lib_t,s0)
@@ -113,53 +113,55 @@
 /usr/(.*/)?lib(/.*)?				gen_context(system_u:object_r:lib_t,s0)
 /usr/(.*/)?lib64(/.*)?				gen_context(system_u:object_r:lib_t,s0)
 
-/usr/(.*/)?lib(64)?(/.*)?/ld-[^/]*\.so(\.[^/]*)* gen_context(system_u:object_r:ld_so_t,s0)
+/usr/(.*/)?lib(/.*)?/ld-[^/]*\.so(\.[^/]*)* gen_context(system_u:object_r:ld_so_t,s0)
+/usr/(.*/)?lib64(/.*)?/ld-[^/]*\.so(\.[^/]*)* gen_context(system_u:object_r:ld_so_t,s0)
 
 /usr/(.*/)?nvidia/.+\.so(\..*)?		--	gen_context(system_u:object_r:textrel_shlib_t,s0)
 
 /usr/lib/altivec/libavcodec\.so(\.[^/]*)* --	gen_context(system_u:object_r:textrel_shlib_t,s0)
 /usr/lib/cedega/.+\.so(\.[^/]*)*	--	gen_context(system_u:object_r:textrel_shlib_t,s0)
+/usr/lib/dovecot/(.*/)?lib.*\.so.*      --      gen_context(system_u:object_r:lib_t,s0)
 /usr/lib/vlc/video_chroma/libi420_rgb_mmx_plugin\.so --	gen_context(system_u:object_r:textrel_shlib_t,s0)
 /usr/lib/vlc/codec/librealvideo_plugin\.so --	gen_context(system_u:object_r:textrel_shlib_t,s0)
 /usr/lib/vlc/codec/libdmo_plugin\.so	--	gen_context(system_u:object_r:textrel_shlib_t,s0)
 /usr/lib/vlc/codec/librealaudio_plugin\.so --	gen_context(system_u:object_r:textrel_shlib_t,s0)
-/usr/lib/libtfmessbsp\.so(\.[^/]*)*	--	gen_context(system_u:object_r:textrel_shlib_t,s0)
+/usr/lib/libtfmessbsp\.so(\.[^/]*)* --	gen_context(system_u:object_r:textrel_shlib_t,s0)
 /usr/lib/xorg/libGL\.so(\.[^/]*)*	--	gen_context(system_u:object_r:textrel_shlib_t,s0)
 /usr/X11R6/lib/libGL\.so.* 		--	gen_context(system_u:object_r:textrel_shlib_t,s0)
-/usr/lib/libGL\.so(\.[^/]*)*		--	gen_context(system_u:object_r:textrel_shlib_t,s0)
-/usr/lib/catalyst/libGL\.so(\.[^/]*)*	--	gen_context(system_u:object_r:textrel_shlib_t,s0)
+/usr/lib/libGL\.so(\.[^/]*)*	--	gen_context(system_u:object_r:textrel_shlib_t,s0)
+/usr/lib/catalyst/libGL\.so(\.[^/]*)* --	gen_context(system_u:object_r:textrel_shlib_t,s0)
 /usr/lib/libADM5.*\.so(\.[^/]*)*	--	gen_context(system_u:object_r:textrel_shlib_t,s0)
 /usr/lib/libatiadlxx\.so(\.[^/]*)*	--	gen_context(system_u:object_r:textrel_shlib_t,s0)
-/usr/lib/win32/.*\.so(\.[^/]*)*		--	gen_context(system_u:object_r:textrel_shlib_t,s0)
+/usr/lib/win32/.*\.so(\.[^/]*)*	--	gen_context(system_u:object_r:textrel_shlib_t,s0)
 
 /usr/lib/ADM_plugins/videoFilter/.*\.so(\.[^/]*)* -- gen_context(system_u:object_r:textrel_shlib_t,s0)
 
-/usr/(.*/)?lib(64)?(/.*)?/nvidia/.+\.so(\..*)? -- gen_context(system_u:object_r:textrel_shlib_t,s0)
-/usr/lib(/.*)?/nvidia/.+\.so(\..*)?	--	gen_context(system_u:object_r:textrel_shlib_t,s0)
-/usr/lib/libsipphoneapi\.so.*		--	gen_context(system_u:object_r:textrel_shlib_t,s0)
+/usr/(.*/)?lib(/.*)?/nvidia/.+\.so(\..*)? -- gen_context(system_u:object_r:textrel_shlib_t,s0)
+/usr/lib(/.*)?/nvidia/.+\.so(\..*)? --	gen_context(system_u:object_r:textrel_shlib_t,s0)
+/usr/lib/libsipphoneapi\.so.*	--	gen_context(system_u:object_r:textrel_shlib_t,s0)
 /usr/lib/ati-fglrx/.+\.so(\..*)?	--	gen_context(system_u:object_r:textrel_shlib_t,s0)
-/usr/lib/fglrx/.*\.so(\.[^/]*)*		--	gen_context(system_u:object_r:textrel_shlib_t,s0)
-/usr/lib/libjs\.so.*			--	gen_context(system_u:object_r:textrel_shlib_t,s0)
-/usr/lib/sse2/libx264\.so(\.[^/]*)* 	--	gen_context(system_u:object_r:textrel_shlib_t,s0)
-/usr/lib(/.*)?/libnvidia.+\.so(\.[^/]*)* --	gen_context(system_u:object_r:textrel_shlib_t,s0)
-/usr/lib(/.*)?/nvidia_drv.*\.so(\.[^/]*)* --	gen_context(system_u:object_r:textrel_shlib_t,s0)
-/usr/lib/nero/plug-ins/libMP3\.so(\.[^/]*)* --	gen_context(system_u:object_r:textrel_shlib_t,s0)
+/usr/lib/fglrx/.*\.so(\.[^/]*)*	--	gen_context(system_u:object_r:textrel_shlib_t,s0)
+/usr/lib/libjs\.so.*		--	gen_context(system_u:object_r:textrel_shlib_t,s0)
+/usr/lib/sse2/libx264\.so(\.[^/]*)* 	-- gen_context(system_u:object_r:textrel_shlib_t,s0)
+/usr/lib(/.*)?/libnvidia.+\.so(\.[^/]*)* -- gen_context(system_u:object_r:textrel_shlib_t,s0)
+/usr/lib(/.*)?/nvidia_drv.*\.so(\.[^/]*)* -- gen_context(system_u:object_r:textrel_shlib_t,s0)
+/usr/lib/nero/plug-ins/libMP3\.so(\.[^/]*)* -- gen_context(system_u:object_r:textrel_shlib_t,s0)
 /usr/lib/nvidia-graphics(-[^/]*/)?libGL(core)?\.so(\.[^/]*)* -- gen_context(system_u:object_r:textrel_shlib_t,s0)
 /usr/lib/nvidia-graphics(-[^/]*/)?libnvidia.*\.so(\.[^/]*)* -- gen_context(system_u:object_r:textrel_shlib_t,s0)
 /usr/lib/nvidia-graphics(-[^/]*/)?libXvMCNVIDIA\.so.* -- gen_context(system_u:object_r:textrel_shlib_t,s0)
-/usr/lib/nvidia/libGL(core)?\.so(\.[^/]*)* --	gen_context(system_u:object_r:textrel_shlib_t,s0)
-/usr/lib/xorg/modules/glesx\.so(\.[^/]*)* --	gen_context(system_u:object_r:textrel_shlib_t,s0)
+/usr/lib/nvidia/libGL(core)?\.so(\.[^/]*)* -- gen_context(system_u:object_r:textrel_shlib_t,s0)
+/usr/lib/xorg/modules/glesx\.so(\.[^/]*)* -- gen_context(system_u:object_r:textrel_shlib_t,s0)
 
-/usr/(local/)?.*\.so(\.[^/]*)*		--	gen_context(system_u:object_r:lib_t,s0)
-/usr/(local/)?lib(64)?/wine/.+\.so	--	gen_context(system_u:object_r:textrel_shlib_t,s0)
-/usr/(local/)?lib(64)?/(sse2/)?libfame-.*\.so.*	--	gen_context(system_u:object_r:textrel_shlib_t,s0)
+/usr/.*\.so(\.[^/]*)*		--	gen_context(system_u:object_r:lib_t,s0)
+/usr/lib/wine/.+\.so	--	gen_context(system_u:object_r:textrel_shlib_t,s0)
+/usr/lib/(sse2/)?libfame-.*\.so.*	--	gen_context(system_u:object_r:textrel_shlib_t,s0)
 /usr/NX/lib/libXcomp\.so.*		--	gen_context(system_u:object_r:textrel_shlib_t,s0)
 /usr/NX/lib/libjpeg\.so.* 		--	gen_context(system_u:object_r:textrel_shlib_t,s0)
 
 /usr/X11R6/lib/libXvMCNVIDIA\.so.* 	--	gen_context(system_u:object_r:textrel_shlib_t,s0)
 
 /usr/lib/xorg/modules/drivers/fglrx_drv\.so(\.[^/]*)* -- gen_context(system_u:object_r:textrel_shlib_t,s0)
-/usr/lib/xorg/modules/drivers/nvidia_drv\.o --	gen_context(system_u:object_r:textrel_shlib_t,s0)
+/usr/lib/xorg/modules/drivers/nvidia_drv\.o -- gen_context(system_u:object_r:textrel_shlib_t,s0)
 /usr/lib/xorg/modules/extensions/nvidia(-[^/]*)?/libglx\.so(\.[^/]*)* -- gen_context(system_u:object_r:textrel_shlib_t,s0)
 /usr/lib/xorg/modules/extensions/libglx\.so(\.[^/]*)* -- gen_context(system_u:object_r:textrel_shlib_t,s0)
 /usr/x11R6/lib/modules/extensions/libglx\.so(\.[^/]*)* -- gen_context(system_u:object_r:textrel_shlib_t,s0)
@@ -180,11 +182,11 @@
 
 # Fedora Core packages: gstreamer-plugins, compat-libstdc++, Glide3, libdv
 # 	HelixPlayer, SDL, xorg-x11, xorg-x11-libs, Hermes, valgrind, openoffice.org-libs, httpd - php
-HOME_DIR/.*/plugins/nppdf\.so.* 	--	gen_context(system_u:object_r:textrel_shlib_t,s0)
-/usr/lib/allegro/(.*/)?alleg-vga\.so	--	gen_context(system_u:object_r:textrel_shlib_t,s0)
+HOME_DIR/.*/plugins/nppdf\.so.* --	gen_context(system_u:object_r:textrel_shlib_t,s0)
+/usr/lib/allegro/(.*/)?alleg-vga\.so --	gen_context(system_u:object_r:textrel_shlib_t,s0)
 /usr/lib/firefox-[^/]*/extensions(/.*)?/libqfaservices.so -- gen_context(system_u:object_r:textrel_shlib_t,s0)
 /usr/lib/firefox-[^/]*/plugins/nppdf.so	--	gen_context(system_u:object_r:textrel_shlib_t,s0)
-/usr/lib/firefox/plugins/libractrl\.so	--	gen_context(system_u:object_r:textrel_shlib_t,s0)
+/usr/lib/firefox/plugins/libractrl\.so --	gen_context(system_u:object_r:textrel_shlib_t,s0)
 /usr/lib/libFLAC\.so.*			--	gen_context(system_u:object_r:textrel_shlib_t,s0)
 /usr/lib/libfglrx_gamma\.so.* 		--	gen_context(system_u:object_r:textrel_shlib_t,s0)
 /usr/lib/mozilla/plugins/nppdf\.so 	-- 	gen_context(system_u:object_r:textrel_shlib_t,s0)
@@ -193,66 +195,65 @@
 /usr/lib/nx/libjpeg\.so.* 		--	gen_context(system_u:object_r:textrel_shlib_t,s0)
 /usr/lib/VBoxVMM\.so			--	gen_context(system_u:object_r:textrel_shlib_t,s0)
 
-/usr/lib/libstdc\+\+\.so\.2\.7\.2\.8	--	gen_context(system_u:object_r:textrel_shlib_t,s0)
+/usr/lib/libstdc\+\+\.so\.2\.7\.2\.8 --	gen_context(system_u:object_r:textrel_shlib_t,s0)
 /usr/lib/libg\+\+\.so\.2\.7\.2\.8	--	gen_context(system_u:object_r:textrel_shlib_t,s0)
-/usr/lib/libgpac\.so.* 			--	gen_context(system_u:object_r:textrel_shlib_t,s0)
+/usr/lib/libgpac\.so.* 		--	gen_context(system_u:object_r:textrel_shlib_t,s0)
 /usr/lib/libglide3\.so.* 		--	gen_context(system_u:object_r:textrel_shlib_t,s0)
 /usr/lib/libglide3-v[0-9]*\.so.* 	--	gen_context(system_u:object_r:textrel_shlib_t,s0)
-/usr/lib/helix/plugins/[^/]*\.so	--	gen_context(system_u:object_r:textrel_shlib_t,s0)
-/usr/lib/helix/codecs/[^/]*\.so		--	gen_context(system_u:object_r:textrel_shlib_t,s0)
+/usr/lib/helix/plugins/[^/]*\.so --	gen_context(system_u:object_r:textrel_shlib_t,s0)
+/usr/lib/helix/codecs/[^/]*\.so	--	gen_context(system_u:object_r:textrel_shlib_t,s0)
 /usr/X11R6/lib/libfglrx_gamma\.so.* 	--	gen_context(system_u:object_r:textrel_shlib_t,s0)
 /usr/lib/libHermes\.so.*		--	gen_context(system_u:object_r:textrel_shlib_t,s0)
-/usr/lib/valgrind/hp2ps			--	gen_context(system_u:object_r:textrel_shlib_t,s0)
+/usr/lib/valgrind/hp2ps		--	gen_context(system_u:object_r:textrel_shlib_t,s0)
 /usr/lib/valgrind/stage2		--	gen_context(system_u:object_r:textrel_shlib_t,s0)
 /usr/lib/valgrind/vg.*\.so		--	gen_context(system_u:object_r:textrel_shlib_t,s0)
-/usr/lib/.*/program/libicudata\.so.*	--	gen_context(system_u:object_r:textrel_shlib_t,s0)
-/usr/lib/.*/program/libsts645li\.so	--	gen_context(system_u:object_r:textrel_shlib_t,s0)
-/usr/lib/.*/program/libvclplug_gen645li\.so --	gen_context(system_u:object_r:textrel_shlib_t,s0)
-/usr/lib/.*/program/libwrp645li\.so	--	gen_context(system_u:object_r:textrel_shlib_t,s0)
-/usr/lib/.*/program/libswd680li\.so	--	gen_context(system_u:object_r:textrel_shlib_t,s0)
-/usr/lib/.*/program/librecentfile\.so	--	gen_context(system_u:object_r:textrel_shlib_t,s0)
-/usr/lib/.*/program/libsvx680li\.so	--	gen_context(system_u:object_r:textrel_shlib_t,s0)
-/usr/lib/.*/program/libcomphelp4gcc3\.so --	gen_context(system_u:object_r:textrel_shlib_t,s0)
-/usr/lib/.*/program/libsoffice\.so	--	gen_context(system_u:object_r:textrel_shlib_t,s0)
+/usr/lib/.*/program/libicudata\.so.* --	gen_context(system_u:object_r:textrel_shlib_t,s0)
+/usr/lib/.*/program/libsts645li\.so --	gen_context(system_u:object_r:textrel_shlib_t,s0)
+/usr/lib/.*/program/libvclplug_gen645li\.so -- gen_context(system_u:object_r:textrel_shlib_t,s0)
+/usr/lib/.*/program/libwrp645li\.so --	gen_context(system_u:object_r:textrel_shlib_t,s0)
+/usr/lib/.*/program/libswd680li\.so --	gen_context(system_u:object_r:textrel_shlib_t,s0)
+/usr/lib/.*/program/librecentfile\.so --	gen_context(system_u:object_r:textrel_shlib_t,s0)
+/usr/lib/.*/program/libsvx680li\.so --	gen_context(system_u:object_r:textrel_shlib_t,s0)
+/usr/lib/.*/program/libcomphelp4gcc3\.so -- gen_context(system_u:object_r:textrel_shlib_t,s0)
+/usr/lib/.*/program/libsoffice\.so --	gen_context(system_u:object_r:textrel_shlib_t,s0)
 /usr/(.*/)?pcsc/drivers(/.*)?/lib(cm2020|cm4000|SCR24x)\.so(\.[^/]*)* -- gen_context(system_u:object_r:textrel_shlib_t,s0)
 
 # Fedora Extras packages: ladspa, imlib2, ocaml
-/usr/lib/ladspa/analogue_osc_1416\.so	--	gen_context(system_u:object_r:textrel_shlib_t,s0)
-/usr/lib/ladspa/bandpass_a_iir_1893\.so	--	gen_context(system_u:object_r:textrel_shlib_t,s0)
-/usr/lib/ladspa/bandpass_iir_1892\.so	--	gen_context(system_u:object_r:textrel_shlib_t,s0)
-/usr/lib/ladspa/butterworth_1902\.so	--	gen_context(system_u:object_r:textrel_shlib_t,s0)
-/usr/lib/ladspa/fm_osc_1415\.so		--	gen_context(system_u:object_r:textrel_shlib_t,s0)
-/usr/lib/ladspa/gsm_1215\.so		--	gen_context(system_u:object_r:textrel_shlib_t,s0)
-/usr/lib/ladspa/gverb_1216\.so		--	gen_context(system_u:object_r:textrel_shlib_t,s0)
-/usr/lib/ladspa/hermes_filter_1200\.so	--	gen_context(system_u:object_r:textrel_shlib_t,s0)
-/usr/lib/ladspa/highpass_iir_1890\.so	--	gen_context(system_u:object_r:textrel_shlib_t,s0)
-/usr/lib/ladspa/lowpass_iir_1891\.so	--	gen_context(system_u:object_r:textrel_shlib_t,s0)
+/usr/lib/ladspa/analogue_osc_1416\.so --	gen_context(system_u:object_r:textrel_shlib_t,s0)
+/usr/lib/ladspa/bandpass_a_iir_1893\.so --	gen_context(system_u:object_r:textrel_shlib_t,s0)
+/usr/lib/ladspa/bandpass_iir_1892\.so --	gen_context(system_u:object_r:textrel_shlib_t,s0)
+/usr/lib/ladspa/butterworth_1902\.so --	gen_context(system_u:object_r:textrel_shlib_t,s0)
+/usr/lib/ladspa/fm_osc_1415\.so	--	gen_context(system_u:object_r:textrel_shlib_t,s0)
+/usr/lib/ladspa/gsm_1215\.so	--	gen_context(system_u:object_r:textrel_shlib_t,s0)
+/usr/lib/ladspa/gverb_1216\.so	--	gen_context(system_u:object_r:textrel_shlib_t,s0)
+/usr/lib/ladspa/hermes_filter_1200\.so --	gen_context(system_u:object_r:textrel_shlib_t,s0)
+/usr/lib/ladspa/highpass_iir_1890\.so --	gen_context(system_u:object_r:textrel_shlib_t,s0)
+/usr/lib/ladspa/lowpass_iir_1891\.so --	gen_context(system_u:object_r:textrel_shlib_t,s0)
 /usr/lib/ladspa/notch_iir_1894\.so	--	gen_context(system_u:object_r:textrel_shlib_t,s0)
-/usr/lib/ladspa/pitch_scale_1193\.so	--	gen_context(system_u:object_r:textrel_shlib_t,s0)
-/usr/lib/ladspa/pitch_scale_1194\.so	--	gen_context(system_u:object_r:textrel_shlib_t,s0)
-/usr/lib/ladspa/sc1_1425\.so		--	gen_context(system_u:object_r:textrel_shlib_t,s0)
-/usr/lib/ladspa/sc2_1426\.so		--	gen_context(system_u:object_r:textrel_shlib_t,s0)
-/usr/lib/ladspa/sc3_1427\.so		--	gen_context(system_u:object_r:textrel_shlib_t,s0)
-/usr/lib/ladspa/sc4_1882\.so		--	gen_context(system_u:object_r:textrel_shlib_t,s0)
-/usr/lib/ladspa/se4_1883\.so		--	gen_context(system_u:object_r:textrel_shlib_t,s0)
-/usr/lib/sane/libsane-epkowa\.so.*	--	gen_context(system_u:object_r:textrel_shlib_t,s0)
-/usr/lib/ocaml/stublibs/dllnums\.so	--	gen_context(system_u:object_r:textrel_shlib_t,s0)
+/usr/lib/ladspa/pitch_scale_1193\.so --	gen_context(system_u:object_r:textrel_shlib_t,s0)
+/usr/lib/ladspa/pitch_scale_1194\.so --	gen_context(system_u:object_r:textrel_shlib_t,s0)
+/usr/lib/ladspa/sc1_1425\.so	--	gen_context(system_u:object_r:textrel_shlib_t,s0)
+/usr/lib/ladspa/sc2_1426\.so	--	gen_context(system_u:object_r:textrel_shlib_t,s0)
+/usr/lib/ladspa/sc3_1427\.so	--	gen_context(system_u:object_r:textrel_shlib_t,s0)
+/usr/lib/ladspa/sc4_1882\.so	--	gen_context(system_u:object_r:textrel_shlib_t,s0)
+/usr/lib/ladspa/se4_1883\.so	--	gen_context(system_u:object_r:textrel_shlib_t,s0)
+/usr/lib/sane/libsane-epkowa\.so.* --	gen_context(system_u:object_r:textrel_shlib_t,s0)
+/usr/lib/ocaml/stublibs/dllnums\.so --	gen_context(system_u:object_r:textrel_shlib_t,s0)
 
 # Livna.org packages: xmms-mp3, ffmpeg, xvidcore, xine-lib, gsm, lame
-/usr/lib.*/libmpg123\.so(\.[^/]*)*	--	gen_context(system_u:object_r:textrel_shlib_t,s0)
-/usr/local(/.*)?/libmpg123\.so(\.[^/]*)* --	gen_context(system_u:object_r:textrel_shlib_t,s0)
+/usr/lib.*/libmpg123\.so(\.[^/]*)* --	gen_context(system_u:object_r:textrel_shlib_t,s0)
+/usr/(/.*)?/libmpg123\.so(\.[^/]*)* --	gen_context(system_u:object_r:textrel_shlib_t,s0)
 /usr/lib/codecs/drv[1-9c]\.so(\.[^/]*)* --	gen_context(system_u:object_r:textrel_shlib_t,s0)
-/usr/local/lib/codecs/drv[1-9c]\.so(\.[^/]*)* -- gen_context(system_u:object_r:textrel_shlib_t,s0)
 
-HOME_DIR/.*/plugins/nppdf\.so		--	gen_context(system_u:object_r:textrel_shlib_t,s0)
+HOME_DIR/.*/plugins/nppdf\.so	--	gen_context(system_u:object_r:textrel_shlib_t,s0)
 HOME_DIR/.mozilla/plugins/nprhapengine\.so.* --	gen_context(system_u:object_r:textrel_shlib_t,s0)
-/usr/lib/.*/nprhapengine\.so.*		--	gen_context(system_u:object_r:textrel_shlib_t,s0)
-/usr/local/(.*/)?nprhapengine\.so.*	--	gen_context(system_u:object_r:textrel_shlib_t,s0)
+/usr/lib/.*/nprhapengine\.so.*	--	gen_context(system_u:object_r:textrel_shlib_t,s0)
+/usr/local/(.*/)?nprhapengine\.so.* --	gen_context(system_u:object_r:textrel_shlib_t,s0)
 
 # Jai, Sun Microsystems (Jpackage SPRM)
 /usr/lib/libmlib_jai\.so		--	gen_context(system_u:object_r:textrel_shlib_t,s0)
-/usr/lib/libdivxdecore\.so\.0		--	gen_context(system_u:object_r:textrel_shlib_t,s0)
-/usr/lib/libdivxencore\.so\.0		--	gen_context(system_u:object_r:textrel_shlib_t,s0)
+/usr/lib/libdivxdecore\.so\.0	--	gen_context(system_u:object_r:textrel_shlib_t,s0)
+/usr/lib/libdivxencore\.so\.0	--	gen_context(system_u:object_r:textrel_shlib_t,s0)
 
 /usr/lib/libdvdcss\.so.*		--	gen_context(system_u:object_r:textrel_shlib_t,s0)
 
@@ -260,17 +261,16 @@
 
 # vmware
 /usr/lib/vmware/lib(/.*)?/libgdk-x11-.*\.so.* -- gen_context(system_u:object_r:textrel_shlib_t,s0)
-/usr/lib/vmware/lib(/.*)?/HConfig\.so	--	gen_context(system_u:object_r:textrel_shlib_t,s0)
+/usr/lib/vmware/lib(/.*)?/HConfig\.so --	gen_context(system_u:object_r:textrel_shlib_t,s0)
 /usr/lib/vmware/(.*/)?VmPerl\.so	--	gen_context(system_u:object_r:textrel_shlib_t,s0)
 /usr/lib/vmware/lib(/.*)?/libvmware-gksu.*\.so.* -- gen_context(system_u:object_r:textrel_shlib_t,s0)
 
 /usr/lib/(virtualbox(-ose)?/)?(components/)?VBox.*\.so -- gen_context(system_u:object_r:textrel_shlib_t,s0)
-/usr/lib/virtualbox/.*\.so		--	gen_context(system_u:object_r:textrel_shlib_t,s0)
+/usr/lib/virtualbox/.*\.so	--	gen_context(system_u:object_r:textrel_shlib_t,s0)
 
 # Java, Sun Microsystems (JPackage SRPM)
-/usr/(.*/)?jre.*/.*\.so(\.[^/]*)*	--	gen_context(system_u:object_r:textrel_shlib_t,s0)
-/usr/local/(.*/)?jre.*/.*\.so(\.[^/]*)*	--	gen_context(system_u:object_r:textrel_shlib_t,s0)
-/usr/lib/(.*/)?jre.*/.*\.so(\.[^/]*)*	--	gen_context(system_u:object_r:textrel_shlib_t,s0)
+/usr/(.*/)?jre.*/.*\.so(\.[^/]*)* --	gen_context(system_u:object_r:textrel_shlib_t,s0)
+/usr/lib/(.*/)?jre.*/.*\.so(\.[^/]*)* --	gen_context(system_u:object_r:textrel_shlib_t,s0)
 
 /usr/(local/)?Adobe/(.*/)?intellinux/nppdf\.so -- gen_context(system_u:object_r:textrel_shlib_t,s0)
 /usr/(local/)?Adobe/(.*/)?intellinux/sidecars/* -- gen_context(system_u:object_r:textrel_shlib_t,s0)
@@ -279,7 +279,7 @@
 /usr/(local/)?Adobe/(.*/)?lib/[^/]*\.so(\.[^/]*)* -- gen_context(system_u:object_r:textrel_shlib_t,s0)
 /usr/(local/)?acroread/(.*/)?lib/[^/]*\.so(\.[^/]*)* -- gen_context(system_u:object_r:textrel_shlib_t,s0)
 /usr/(local/)?Adobe/.*\.api		--	gen_context(system_u:object_r:textrel_shlib_t,s0)
-/usr/(local/)?lib/xchat/plugins/systray\.so --	gen_context(system_u:object_r:textrel_shlib_t,s0)
+/usr/lib/xchat/plugins/systray\.so --	gen_context(system_u:object_r:textrel_shlib_t,s0)
 /usr/(local/)?matlab.*/bin/glnx86/libmwlapack\.so -- gen_context(system_u:object_r:textrel_shlib_t,s0)
 /usr/(local/)?matlab.*/bin/glnx86/(libmw(lapack|mathutil|services)|lapack|libmkl)\.so -- gen_context(system_u:object_r:textrel_shlib_t,s0)
 /usr/(local/)?matlab.*/sys/os/glnx86/libtermcap\.so -- gen_context(system_u:object_r:textrel_shlib_t,s0)
@@ -310,6 +310,6 @@
 /var/lib/samba/bin/.+\.so(\.[^/]*)*	-l	gen_context(system_u:object_r:lib_t,s0)
 ')
 
-/var/spool/postfix/lib(64)?(/.*)? 		gen_context(system_u:object_r:lib_t,s0)
+/var/spool/postfix/lib(/.*)? 		gen_context(system_u:object_r:lib_t,s0)
 /var/spool/postfix/usr(/.*)?			gen_context(system_u:object_r:lib_t,s0)
-/var/spool/postfix/lib(64)?/ld.*\.so.*	--	gen_context(system_u:object_r:ld_so_t,s0)
+/var/spool/postfix/lib/ld.*\.so.*	--	gen_context(system_u:object_r:ld_so_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/system/libraries.te refpolicy/policy/modules/system/libraries.te
--- refpolicy/policy/modules/system/libraries.te	2012-07-25 20:33:04.000000000 +0200
+++ refpolicy/policy/modules/system/libraries.te	2012-10-30 19:21:39.315398110 +0100
@@ -1,4 +1,4 @@
-policy_module(libraries, 2.9.0)
+policy_module(libraries, 2.9.2)
 
 ########################################
 #
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/system/logging.fc refpolicy/policy/modules/system/logging.fc
--- refpolicy/policy/modules/system/logging.fc	2012-05-04 15:14:47.000000000 +0200
+++ refpolicy/policy/modules/system/logging.fc	2012-11-12 22:24:31.595144132 +0100
@@ -24,6 +24,7 @@
 /usr/sbin/syslog-ng	--	gen_context(system_u:object_r:syslogd_exec_t,s0)
 /usr/sbin/syslogd	--	gen_context(system_u:object_r:syslogd_exec_t,s0)
 
+/var/lib/misc/syslog-ng\.persist-?	--	gen_context(system_u:object_r:syslogd_var_lib_t,s0)
 /var/lib/syslog-ng(/.*)? 	gen_context(system_u:object_r:syslogd_var_lib_t,s0)
 /var/lib/r?syslog(/.*)?		gen_context(system_u:object_r:syslogd_var_lib_t,s0)
 /var/lib/syslog-ng.persist --	gen_context(system_u:object_r:syslogd_var_lib_t,s0)
@@ -34,14 +35,12 @@
 
 /var/axfrdns/log/main(/.*)?	gen_context(system_u:object_r:var_log_t,s0)
 /var/dnscache/log/main(/.*)?	gen_context(system_u:object_r:var_log_t,s0)
-/var/cfengine/outputs(/.*)?	gen_context(system_u:object_r:var_log_t,s0)
 
 /var/log		-d	gen_context(system_u:object_r:var_log_t,s0-mls_systemhigh)
 /var/log/.*			gen_context(system_u:object_r:var_log_t,s0)
 /var/log/boot\.log	--	gen_context(system_u:object_r:var_log_t,mls_systemhigh)
 /var/log/messages[^/]*		gen_context(system_u:object_r:var_log_t,mls_systemhigh)
 /var/log/secure[^/]*		gen_context(system_u:object_r:var_log_t,mls_systemhigh)
-/var/log/cron[^/]*		gen_context(system_u:object_r:var_log_t,mls_systemhigh)
 /var/log/maillog[^/]*		gen_context(system_u:object_r:var_log_t,mls_systemhigh)
 /var/log/spooler[^/]*		gen_context(system_u:object_r:var_log_t,mls_systemhigh)
 /var/log/audit(/.*)?		gen_context(system_u:object_r:auditd_log_t,mls_systemhigh)
@@ -69,7 +68,7 @@
 
 /var/spool/audit(/.*)?		gen_context(system_u:object_r:audit_spool_t,mls_systemhigh)
 /var/spool/bacula/log(/.*)? 	gen_context(system_u:object_r:var_log_t,s0)
-/var/spool/postfix/pid	-d	gen_context(system_u:object_r:var_run_t,s0)
+#/var/spool/postfix/pid	-d	gen_context(system_u:object_r:var_run_t,s0)
 /var/spool/plymouth/boot\.log	gen_context(system_u:object_r:var_log_t,mls_systemhigh)
 /var/spool/rsyslog(/.*)? 	gen_context(system_u:object_r:var_log_t,s0)
 
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/system/logging.if refpolicy/policy/modules/system/logging.if
--- refpolicy/policy/modules/system/logging.if	2012-05-10 15:25:34.000000000 +0200
+++ refpolicy/policy/modules/system/logging.if	2012-11-12 22:01:44.337141214 +0100
@@ -609,6 +609,25 @@
 
 ########################################
 ## <summary>
+##	Delete the syslog socket files
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`logging_delete_devlog_socket',`
+	gen_require(`
+		type devlog_t;
+	')
+
+	allow $1 devlog_t:sock_file unlink;
+')
+
+########################################
+## <summary>
 ##	Allows the domain to open a file in the
 ##	log directory, but does not allow the listing
 ##	of the contents of the log directory.
@@ -686,6 +705,25 @@
 
 #######################################
 ## <summary>
+##	Search through all log dirs.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`logging_search_all_logs',`
+	gen_require(`
+		attribute logfile;
+	')
+
+	allow $1 logfile:dir search_dir_perms;
+')
+
+#######################################
+## <summary>
 ##	Set attributes on all log dirs.
 ## </summary>
 ## <param name="domain">
@@ -705,7 +743,7 @@
 
 ########################################
 ## <summary>
-##	Do not audit attempts to get the atttributes
+##	Do not audit attempts to get the attributes
 ##	of any log files.
 ## </summary>
 ## <param name="domain">
@@ -724,6 +762,24 @@
 
 ########################################
 ## <summary>
+##	Read the atttributes of any log file
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access
+##	</summary>
+## </param>
+#
+interface(`logging_getattr_all_logs',`
+	gen_require(`
+		attribute logfile;
+	')
+
+	allow $1 logfile:file getattr;
+')
+
+########################################
+## <summary>
 ##	Append to all log files.
 ## </summary>
 ## <param name="domain">
@@ -1048,3 +1104,72 @@
 	logging_admin_audit($1, $2)
 	logging_admin_syslog($1, $2)
 ')
+
+########################################
+## <summary>
+##	Mark the type as a syslog managed log file
+##	and introduce the proper file transition when
+##	created by the system logger in the generic
+##	log directory
+## </summary>
+## <param name="type">
+##	<summary>
+##	Type to mark as a syslog managed log file
+##	</summary>
+## </param>
+## <param name="filename" optional="true">
+##	<summary>
+##	Name to use for the file
+##	</summary>
+## </param>
+#
+interface(`logging_syslog_managed_log_file',`
+	gen_require(`
+		attribute syslogmanaged;
+		type syslogd_t;
+	')
+
+	typeattribute $1 syslogmanaged;
+
+	logging_log_file($1)
+	logging_log_filetrans(syslogd_t, $1, file, $2)
+')
+
+########################################
+## <summary>
+##	Mark the type as a syslog managed log dir
+##	and introduce the proper file transition when
+##	created by the system logger in the generic
+##	log directory
+## </summary>
+## <desc>
+##	<p>
+##	Once set, the system logger is able to fully
+##	manage files and directory of the given type.
+##	You do not need to use logging_syslog_managed_file
+##	anymore (unless a file name transition is needed
+##	for that as well).
+##	</p>
+## </desc>
+## <param name="type">
+##	<summary>
+##	Type to mark as a syslog managed log dir
+##	</summary>
+## </param>
+## <param name="filename" optional="true">
+##	<summary>
+##	Name to use for the directory
+##	</summary>
+## </param>
+#
+interface(`logging_syslog_managed_log_dir',`
+	gen_require(`
+		attribute syslogmanaged;
+		type syslogd_t;
+	')
+
+	typeattribute $1 syslogmanaged;
+
+	logging_log_file($1)
+	logging_log_filetrans(syslogd_t, $1, dir, $2)
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/system/logging.te refpolicy/policy/modules/system/logging.te
--- refpolicy/policy/modules/system/logging.te	2012-07-25 20:33:04.000000000 +0200
+++ refpolicy/policy/modules/system/logging.te	2012-11-12 21:10:00.243134589 +0100
@@ -1,4 +1,4 @@
-policy_module(logging, 1.19.0)
+policy_module(logging, 1.19.3)
 
 ########################################
 #
@@ -86,6 +86,10 @@
 	init_ranged_daemon_domain(syslogd_t, syslogd_exec_t, mls_systemhigh)
 ')
 
+ifdef(`distro_gentoo',`
+	attribute syslogmanaged;
+')
+
 ########################################
 #
 # Auditctl local policy
@@ -355,6 +359,7 @@
 # sys_admin for the integrated klog of syslog-ng and metalog
 # cjp: why net_admin!
 allow syslogd_t self:capability { dac_override sys_resource sys_tty_config net_admin sys_admin chown fsetid };
+allow syslogd_t self:capability2 block_suspend;
 dontaudit syslogd_t self:capability sys_tty_config;
 # setpgid for metalog
 # setrlimit for syslog-ng
@@ -439,6 +444,8 @@
 # /initrd is not umounted before minilog starts
 files_dontaudit_search_isid_type_dirs(syslogd_t)
 files_read_kernel_symbol_table(syslogd_t)
+files_rw_var_lib_dirs(syslogd_t)
+files_var_lib_filetrans(syslogd_t, syslogd_var_lib_t, { file dir })
 
 fs_getattr_all_fs(syslogd_t)
 fs_search_auto_mountpoints(syslogd_t)
@@ -467,10 +474,17 @@
 userdom_dontaudit_search_user_home_dirs(syslogd_t)
 
 ifdef(`distro_gentoo',`
+	manage_dirs_pattern(syslogd_t, syslogmanaged, syslogmanaged)
+	manage_files_pattern(syslogd_t, syslogmanaged, syslogmanaged)
 	# default gentoo syslog-ng config appends kernel
 	# and high priority messages to /dev/tty12
 	term_append_unallocated_ttys(syslogd_t)
 	term_dontaudit_setattr_unallocated_ttys(syslogd_t)
+
+	cron_create_log_files(syslogd_t)
+	cron_generic_log_filetrans_log(syslogd_t, file, "cron.log")
+	cron_setattr_log_files(syslogd_t)
+	cron_write_log_files(syslogd_t)
 ')
 
 ifdef(`distro_suse',`
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/system/lvm.fc refpolicy/policy/modules/system/lvm.fc
--- refpolicy/policy/modules/system/lvm.fc	2012-05-04 15:14:47.000000000 +0200
+++ refpolicy/policy/modules/system/lvm.fc	2012-04-22 10:50:38.191324123 +0200
@@ -11,6 +11,11 @@
 ')
 
 #
+# /dev
+#
+/dev/.lvm(/.*)?		gen_context(system_u:object_r:lvm_lock_t,s0)
+
+#
 # /etc
 #
 /etc/lvm(/.*)?			gen_context(system_u:object_r:lvm_etc_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/system/lvm.te refpolicy/policy/modules/system/lvm.te
--- refpolicy/policy/modules/system/lvm.te	2012-07-25 20:33:04.000000000 +0200
+++ refpolicy/policy/modules/system/lvm.te	2012-11-12 22:51:58.262147648 +0100
@@ -191,6 +191,7 @@
 can_exec(lvm_t, lvm_exec_t)
 
 # Creating lock files
+manage_dirs_pattern(lvm_t, lvm_lock_t, lvm_lock_t)
 manage_files_pattern(lvm_t, lvm_lock_t, lvm_lock_t)
 files_lock_filetrans(lvm_t, lvm_lock_t, file)
 
@@ -215,6 +216,7 @@
 kernel_read_system_state(lvm_t)
 # Read system variables in /proc/sys
 kernel_read_kernel_sysctls(lvm_t)
+kernel_request_load_module(lvm_t)
 # it has no reason to need this
 kernel_dontaudit_getattr_core_if(lvm_t)
 kernel_use_fds(lvm_t)
@@ -310,6 +312,17 @@
 	')
 ')
 
+ifdef(`distro_gentoo',`
+	files_lock_filetrans(lvm_t, lvm_lock_t, dir, "lvm")
+
+	create_dirs_pattern(lvm_t, lvm_etc_t, lvm_metadata_t)
+	filetrans_pattern(lvm_t, lvm_etc_t, lvm_metadata_t, dir, "cache")
+
+	optional_policy(`
+		udev_read_pid_files(lvm_t)
+	')
+')
+
 optional_policy(`
 	bootloader_rw_tmp_files(lvm_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/system/miscfiles.fc refpolicy/policy/modules/system/miscfiles.fc
--- refpolicy/policy/modules/system/miscfiles.fc	2012-05-10 16:18:41.000000000 +0200
+++ refpolicy/policy/modules/system/miscfiles.fc	2012-10-28 14:20:28.220204162 +0100
@@ -11,7 +11,10 @@
 /etc/avahi/etc/localtime --	gen_context(system_u:object_r:locale_t,s0)
 /etc/httpd/alias/[^/]*\.db(\.[^/]*)* -- gen_context(system_u:object_r:cert_t,s0)
 /etc/localtime		--	gen_context(system_u:object_r:locale_t,s0)
-/etc/pki(/.*)?			gen_context(system_u:object_r:cert_t,s0)
+/etc/pki/certs/(.*)?	--	gen_context(system_u:object_r:cert_t,s0)
+/etc/pki/private/(.*)?	--	gen_context(system_u:object_r:cert_t,s0)
+/etc/ssl/certs/(.*)?	--	gen_context(system_u:object_r:cert_t,s0)
+/etc/ssl/private/(.*)?	--	gen_context(system_u:object_r:cert_t,s0)
 /etc/timezone		--	gen_context(system_u:object_r:locale_t,s0)
 
 ifdef(`distro_redhat',`
@@ -39,10 +42,11 @@
 /usr/local/man(/.*)?		gen_context(system_u:object_r:man_t,s0)
 /usr/local/share/man(/.*)?	gen_context(system_u:object_r:man_t,s0)
 
-/usr/local/share/fonts(/.*)?	gen_context(system_u:object_r:fonts_t,s0)
+/usr/local/share/fonts(/.*)?	gen_context(system_u:object_r:man_t,s0)
 
 /usr/man(/.*)?			gen_context(system_u:object_r:man_t,s0)
 
+/usr/share/ca-certificates(/.*)?	gen_context(system_u:object_r:cert_t,s0)
 /usr/share/fonts(/.*)?		gen_context(system_u:object_r:fonts_t,s0)
 /usr/share/X11/fonts(/.*)?	gen_context(system_u:object_r:fonts_t,s0)
 /usr/share/ghostscript/fonts(/.*)? gen_context(system_u:object_r:fonts_t,s0)
@@ -91,3 +95,5 @@
 /var/empty/sshd/etc/localtime -- gen_context(system_u:object_r:locale_t,s0)
 /var/spool/postfix/etc/localtime -- gen_context(system_u:object_r:locale_t,s0)
 ')
+
+HOME_DIR/.pki(/.*)?		gen_context(system_u:object_r:cert_home_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/system/miscfiles.if refpolicy/policy/modules/system/miscfiles.if
--- refpolicy/policy/modules/system/miscfiles.if	2012-05-04 15:14:47.000000000 +0200
+++ refpolicy/policy/modules/system/miscfiles.if	2012-07-27 13:56:59.175092728 +0200
@@ -86,6 +86,48 @@
 	read_lnk_files_pattern($1, cert_t, cert_t)
 ')
 
+######################################
+## <summary>
+##	Manage user-managed SSL certificates
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access
+##	</summary>
+## </param>
+#
+interface(`miscfiles_manage_user_certs',`
+	gen_require(`
+		type cert_home_t;
+	')
+
+	manage_dirs_pattern($1, cert_home_t, cert_home_t)
+	manage_files_pattern($1, cert_home_t, cert_home_t)
+	manage_lnk_files_pattern($1, cert_home_t, cert_home_t)
+
+	userdom_search_user_home_dirs($1)
+')
+
+########################################
+## <summary>
+##	Relabel from/to cert_home_t (user-managed SSL certificates)
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access
+##	</summary>
+## </param>
+#
+interface(`miscfiles_relabel_user_certs',`
+	gen_require(`
+		type cert_home_t;
+	')
+
+	relabel_dirs_pattern($1, cert_home_t, cert_home_t)
+	relabel_files_pattern($1, cert_home_t, cert_home_t)
+	relabel_lnk_files_pattern($1, cert_home_t, cert_home_t)
+')
+
 ########################################
 ## <summary>
 ##	Manage generic SSL certificates.
@@ -170,6 +212,35 @@
 ')
 
 ########################################
+## <summary>
+##	Automatically use the cert_home_t label for selected resources created
+##	in a users home directory
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access
+##	</summary>
+## </param>
+## <param name="class">
+##	<summary>
+##	Resource type(s) for which the label should be used
+##	</summary>
+## </param>
+## <param name="filename" optional="true">
+##	<summary>
+##	Name of the resource that is being created
+##	</summary>
+## </param>
+#
+interface(`miscfiles_user_home_dir_filetrans_cert_home',`
+	gen_require(`
+		type cert_home_t;
+	')
+
+	userdom_user_home_dir_filetrans($1, cert_home_t, $2, $3)
+')
+
+########################################
 ## <summary>
 ##	Read fonts.
 ## </summary>
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/system/miscfiles.te refpolicy/policy/modules/system/miscfiles.te
--- refpolicy/policy/modules/system/miscfiles.te	2012-07-25 20:33:04.000000000 +0200
+++ refpolicy/policy/modules/system/miscfiles.te	2012-10-02 19:45:26.146009260 +0200
@@ -1,4 +1,4 @@
-policy_module(miscfiles, 1.10.0)
+policy_module(miscfiles, 1.10.1)
 
 ########################################
 #
@@ -14,6 +14,13 @@
 miscfiles_cert_type(cert_t)
 
 #
+# cert_home_t is the type of files in the users' home directories.
+#
+type cert_home_t;
+miscfiles_cert_type(cert_home_t)
+userdom_user_home_content(cert_home_t)
+
+#
 # fonts_t is the type of various font
 # files in /usr
 #
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/system/modutils.fc refpolicy/policy/modules/system/modutils.fc
--- refpolicy/policy/modules/system/modutils.fc	2012-05-10 16:18:41.000000000 +0200
+++ refpolicy/policy/modules/system/modutils.fc	2012-10-02 19:43:54.167009064 +0200
@@ -1,3 +1,4 @@
+/bin/kmod		--	gen_context(system_u:object_r:insmod_exec_t,s0)
 
 /etc/modules\.conf.*	--	gen_context(system_u:object_r:modules_conf_t,s0)
 /etc/modprobe\.conf.*	--	gen_context(system_u:object_r:modules_conf_t,s0)
@@ -20,3 +21,5 @@
 /sbin/modules-update	--	gen_context(system_u:object_r:update_modules_exec_t,s0)
 /sbin/rmmod.*		--	gen_context(system_u:object_r:insmod_exec_t,s0)
 /sbin/update-modules	--	gen_context(system_u:object_r:update_modules_exec_t,s0)
+
+/usr/bin/kmod		--	gen_context(system_u:object_r:insmod_exec_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/system/modutils.if refpolicy/policy/modules/system/modutils.if
--- refpolicy/policy/modules/system/modutils.if	2012-05-04 15:14:47.000000000 +0200
+++ refpolicy/policy/modules/system/modutils.if	2012-10-19 17:03:39.960547748 +0200
@@ -39,6 +39,30 @@
 
 ########################################
 ## <summary>
+##	List the module configuration option files
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`modutils_list_module_config',`
+	gen_require(`
+		type modules_conf_t;
+	')
+
+	# This file type can be in /etc or
+	# /lib(64)?/modules
+	files_search_etc($1)
+	files_search_boot($1)
+
+	list_dirs_pattern($1, modules_conf_t, modules_conf_t)
+')
+
+########################################
+## <summary>
 ##	Read the configuration options used when
 ##	loading modules.
 ## </summary>
@@ -59,8 +83,9 @@
 	files_search_etc($1)
 	files_search_boot($1)
 
-	read_files_pattern($1, modules_conf_t, modules_conf_t)
-	read_lnk_files_pattern($1, modules_conf_t, modules_conf_t)
+	allow $1 modules_conf_t:dir list_dir_perms;
+	allow $1 modules_conf_t:file read_file_perms;
+	allow $1 modules_conf_t:lnk_file read_lnk_file_perms;
 ')
 
 ########################################
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/system/modutils.te refpolicy/policy/modules/system/modutils.te
--- refpolicy/policy/modules/system/modutils.te	2012-07-25 20:33:04.000000000 +0200
+++ refpolicy/policy/modules/system/modutils.te	2012-10-19 17:03:41.966547752 +0200
@@ -1,4 +1,4 @@
-policy_module(modutils, 1.13.0)
+policy_module(modutils, 1.13.2)
 
 ########################################
 #
@@ -89,6 +89,10 @@
 ')
 
 optional_policy(`
+	dracut_rw_tmp_files(depmod_t)
+')
+
+optional_policy(`
 	rpm_rw_pipes(depmod_t)
 	rpm_manage_script_tmp_files(depmod_t)
 ')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/system/mount.te refpolicy/policy/modules/system/mount.te
--- refpolicy/policy/modules/system/mount.te	2012-07-25 20:33:04.000000000 +0200
+++ refpolicy/policy/modules/system/mount.te	2012-07-26 22:11:32.902971651 +0200
@@ -51,6 +51,7 @@
 
 kernel_read_system_state(mount_t)
 kernel_read_kernel_sysctls(mount_t)
+kernel_setsched(mount_t)
 kernel_dontaudit_getattr_core_if(mount_t)
 kernel_dontaudit_write_debugfs_dirs(mount_t)
 kernel_dontaudit_write_proc_dirs(mount_t)
@@ -80,7 +81,7 @@
 files_mounton_all_mountpoints(mount_t)
 files_unmount_rootfs(mount_t)
 # These rules need to be generalized.  Only admin, initrc should have it:
-files_relabelto_all_file_type_fs(mount_t)
+files_relabel_all_file_type_fs(mount_t)
 files_mount_all_file_type_fs(mount_t)
 files_unmount_all_file_type_fs(mount_t)
 # for when /etc/mtab loses its type
@@ -107,6 +108,7 @@
 mls_file_write_all_levels(mount_t)
 
 selinux_get_enforce_mode(mount_t)
+selinux_get_fs_mount(mount_t)
 
 storage_raw_read_fixed_disk(mount_t)
 storage_raw_write_fixed_disk(mount_t)
@@ -193,6 +195,10 @@
 	')
 ')
 
+optional_policy(`
+	puppet_rw_tmp(mount_t)
+')
+
 # for kernel package installation
 optional_policy(`
 	rpm_rw_pipes(mount_t)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/system/selinuxutil.fc refpolicy/policy/modules/system/selinuxutil.fc
--- refpolicy/policy/modules/system/selinuxutil.fc	2012-05-10 16:27:24.000000000 +0200
+++ refpolicy/policy/modules/system/selinuxutil.fc	2012-07-28 19:25:51.767319241 +0200
@@ -9,6 +9,7 @@
 /etc/selinux/([^/]*/)?policy(/.*)?	gen_context(system_u:object_r:policy_config_t,mls_systemhigh)
 /etc/selinux/([^/]*/)?setrans\.conf --	gen_context(system_u:object_r:selinux_config_t,mls_systemhigh)
 /etc/selinux/([^/]*/)?seusers	--	gen_context(system_u:object_r:selinux_config_t,mls_systemhigh)
+/etc/selinux/([^/]*/)?modules	-d	gen_context(system_u:object_r:semanage_store_t,s0)
 /etc/selinux/([^/]*/)?modules/(active|tmp|previous)(/.*)? gen_context(system_u:object_r:semanage_store_t,s0)
 /etc/selinux/([^/]*/)?modules/semanage\.read\.LOCK -- gen_context(system_u:object_r:semanage_read_lock_t,s0)
 /etc/selinux/([^/]*/)?modules/semanage\.trans\.LOCK -- gen_context(system_u:object_r:semanage_trans_lock_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/system/selinuxutil.te refpolicy/policy/modules/system/selinuxutil.te
--- refpolicy/policy/modules/system/selinuxutil.te	2012-07-25 20:33:04.000000000 +0200
+++ refpolicy/policy/modules/system/selinuxutil.te	2012-07-28 19:26:44.438319380 +0200
@@ -234,6 +234,8 @@
 allow newrole_t self:unix_stream_socket { create_stream_socket_perms connectto };
 allow newrole_t self:netlink_audit_socket { create_netlink_socket_perms nlmsg_relay };
 
+dontaudit newrole_t self:capability dac_read_search;
+
 read_files_pattern(newrole_t, default_context_t, default_context_t)
 read_lnk_files_pattern(newrole_t, default_context_t, default_context_t)
 
@@ -517,6 +519,10 @@
 	')
 ')
 
+optional_policy(`
+	portage_eselect_module(semanage_t)
+')
+
 ########################################
 #
 # Setfiles local policy
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/system/sysnetwork.if refpolicy/policy/modules/system/sysnetwork.if
--- refpolicy/policy/modules/system/sysnetwork.if	2012-05-10 15:25:34.000000000 +0200
+++ refpolicy/policy/modules/system/sysnetwork.if	2012-10-30 19:24:42.260398563 +0100
@@ -561,6 +561,25 @@
 
 ########################################
 ## <summary>
+##	Send null signals to ifconfig.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <rolecap/>
+#
+interface(`sysnet_signull_ifconfig',`
+	gen_require(`
+		type ifconfig_t;
+	')
+
+	allow $1 ifconfig_t:process signull;
+')
+
+########################################
+## <summary>
 ##	Read the DHCP configuration files.
 ## </summary>
 ## <param name="domain">
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/system/sysnetwork.te refpolicy/policy/modules/system/sysnetwork.te
--- refpolicy/policy/modules/system/sysnetwork.te	2012-07-25 20:33:04.000000000 +0200
+++ refpolicy/policy/modules/system/sysnetwork.te	2012-10-30 19:29:02.513400282 +0100
@@ -1,4 +1,4 @@
-policy_module(sysnetwork, 1.14.0)
+policy_module(sysnetwork, 1.14.5)
 
 ########################################
 #
@@ -44,7 +44,7 @@
 # DHCP client local policy
 #
 allow dhcpc_t self:capability { dac_override fsetid net_admin net_raw net_bind_service setpcap sys_nice sys_resource sys_tty_config };
-dontaudit dhcpc_t self:capability { sys_tty_config sys_ptrace };
+dontaudit dhcpc_t self:capability { sys_tty_config sys_ptrace sys_admin };
 # for access("/etc/bashrc", X_OK) on Red Hat
 dontaudit dhcpc_t self:capability { dac_read_search sys_module };
 allow dhcpc_t self:process { getsched getcap setcap setfscreate ptrace signal_perms };
@@ -65,7 +65,10 @@
 
 # create pid file
 manage_files_pattern(dhcpc_t, dhcpc_var_run_t, dhcpc_var_run_t)
-files_pid_filetrans(dhcpc_t, dhcpc_var_run_t, file)
+create_dirs_pattern(dhcpc_t, dhcpc_var_run_t, dhcpc_var_run_t)
+# Create /var/run/dhcpc directory (state directory), needed for /run/dhcpc
+# Gets done through the dhcpcd-hooks
+files_pid_filetrans(dhcpc_t, dhcpc_var_run_t, { file dir })
 
 # Allow read/write to /etc/resolv.conf and /etc/ntp.conf. Note that any files
 # in /etc created by dhcpcd will be labelled net_conf_t.
@@ -102,6 +105,7 @@
 corenet_udp_sendrecv_all_ports(dhcpc_t)
 corenet_tcp_bind_all_nodes(dhcpc_t)
 corenet_udp_bind_all_nodes(dhcpc_t)
+corenet_tcp_bind_dhcpc_port(dhcpc_t)
 corenet_udp_bind_dhcpc_port(dhcpc_t)
 corenet_tcp_connect_all_ports(dhcpc_t)
 corenet_sendrecv_dhcpd_client_packets(dhcpc_t)
@@ -158,10 +162,9 @@
 ')
 
 optional_policy(`
-	init_dbus_chat_script(dhcpc_t)
+	dbus_system_domain(dhcpc_t, dhcpc_exec_t)
 
-	dbus_system_bus_client(dhcpc_t)
-	dbus_connect_system_bus(dhcpc_t)
+	init_dbus_chat_script(dhcpc_t)
 
 	optional_policy(`
 		networkmanager_dbus_chat(dhcpc_t)
@@ -242,7 +245,7 @@
 # Ifconfig local policy
 #
 
-allow ifconfig_t self:capability { net_raw net_admin sys_tty_config };
+allow ifconfig_t self:capability { net_raw net_admin sys_admin sys_tty_config };
 allow ifconfig_t self:process ~{ ptrace setcurrent setexec setfscreate setrlimit execmem execheap execstack };
 allow ifconfig_t self:fd use;
 allow ifconfig_t self:fifo_file rw_fifo_file_perms;
@@ -338,6 +341,10 @@
 ')
 
 optional_policy(`
+	networkmanager_dontaudit_use_wpa_cli_fds(ifconfig_t)
+')
+
+optional_policy(`
 	nis_use_ypbind(ifconfig_t)
 ')
 
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/system/udev.fc refpolicy/policy/modules/system/udev.fc
--- refpolicy/policy/modules/system/udev.fc	2012-05-04 15:14:47.000000000 +0200
+++ refpolicy/policy/modules/system/udev.fc	2012-07-17 17:31:55.765243315 +0200
@@ -9,6 +9,7 @@
 /etc/udev/rules.d(/.*)? gen_context(system_u:object_r:udev_rules_t,s0)
 /etc/udev/scripts/.+ --	gen_context(system_u:object_r:udev_helper_exec_t,s0)
 
+/lib/udev/udevd	--	gen_context(system_u:object_r:udev_exec_t,s0)
 /lib/udev/udev-acl --	gen_context(system_u:object_r:udev_exec_t,s0)
 
 ifdef(`distro_debian',`
@@ -26,10 +27,15 @@
 /sbin/start_udev --	gen_context(system_u:object_r:udev_exec_t,s0)
 ')
 
+/usr/bin/udevadm	--	gen_context(system_u:object_r:udev_exec_t,s0)
 /usr/bin/udevinfo --	gen_context(system_u:object_r:udev_exec_t,s0)
 
+/usr/lib/systemd/systemd-udevd	--	gen_context(system_u:object_r:udev_exec_t,s0)
+
 /var/run/PackageKit/udev(/.*)? gen_context(system_u:object_r:udev_var_run_t,s0)
-/var/run/udev(/.*)?	gen_context(system_u:object_r:udev_tbl_t,s0)
+/var/run/udev(/.*)?		gen_context(system_u:object_r:udev_var_run_t,s0)
+/var/run/udev/rules\.d(/.*)?	gen_context(system_u:object_r:udev_tbl_t,s0)
+/var/run/udev/data(/.*)?	gen_context(system_u:object_r:udev_tbl_t,s0)
 
 ifdef(`distro_debian',`
 /var/run/xen-hotplug -d	gen_context(system_u:object_r:udev_var_run_t,s0)
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/system/udev.if refpolicy/policy/modules/system/udev.if
--- refpolicy/policy/modules/system/udev.if	2012-07-24 14:49:22.000000000 +0200
+++ refpolicy/policy/modules/system/udev.if	2012-10-30 19:28:28.031399006 +0100
@@ -132,6 +132,27 @@
 
 ########################################
 ## <summary>
+##	Read udev rules files
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`udev_read_rules_files',`
+	gen_require(`
+		type udev_rules_t;
+	')
+
+	files_search_etc($1) # /etc/udev/rules.d
+	udev_search_pids($1) # /run/udev/rules.d
+	read_files_pattern($1, udev_rules_t, udev_rules_t)
+')
+
+
+########################################
+## <summary>
 ##	Manage udev rules files
 ## </summary>
 ## <param name="domain">
@@ -200,6 +221,7 @@
 
 	files_search_etc($1)
 
+	# Device table files are beneith /run/udev
 	udev_search_pids($1)
 ')
 
@@ -224,7 +246,57 @@
 
 ########################################
 ## <summary>
-##	Search through udev pid content
+##	Create udev database directories
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`udev_create_db_dirs',`
+	gen_require(`
+		type udev_tbl_t;
+		type udev_var_run_t;
+	')
+
+	create_dirs_pattern($1, udev_var_run_t, udev_tbl_t)
+')
+
+
+
+########################################
+## <summary>
+##	Write in /var/run/udev with the udev_tbl_t (udev database) file type
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="class">
+## 	<summary>
+##	Classes on which the file transition should occur
+##	</summary>
+## </param>
+## <param name="name" optional="true">
+##	<summary>
+##	Name of the directory that the file transition will work on
+##	</summary>
+## </param>
+#
+interface(`udev_pid_filetrans_db',`
+	gen_require(`
+		type udev_tbl_t;
+		type udev_var_run_t;
+	')
+
+	filetrans_pattern($1, udev_var_run_t, udev_tbl_t, $2, $3)
+')
+
+########################################
+## <summary>
+## 	Search through udev pid content
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -237,14 +309,14 @@
 		type udev_var_run_t;
 	')
 
-	files_search_pids($1)
+	files_search_var_lib($1)
 	search_dirs_pattern($1, udev_var_run_t, udev_var_run_t)
 ')
 
 ########################################
 ## <summary>
 ##	Create, read, write, and delete
-##	udev pid directories
+##	udev run directories
 ## </summary>
 ## <param name="domain">
 ##	<summary>
@@ -257,33 +329,30 @@
 		type udev_var_run_t;
 	')
 
-	files_search_var($1)
+	files_search_var_lib($1)
 	manage_dirs_pattern($1, udev_var_run_t, udev_var_run_t)
 ')
 
 ########################################
 ## <summary>
-##	Create directories in the run location with udev_var_run_t type
+##	Read udev pid files
 ## </summary>
 ## <param name="domain">
 ##	<summary>
 ##	Domain allowed access.
 ##	</summary>
 ## </param>
-## <param name="name" optional="true">
-## 	<summary>
-##	Name of the directory that is created
-##	</summary>
-## </param>
 #
-interface(`udev_generic_pid_filetrans_run_dirs',`
+interface(`udev_read_pid_files',`
 	gen_require(`
 		type udev_var_run_t;
 	')
 
-	files_pid_filetrans($1, udev_var_run_t, dir, $2)
+	files_search_pids($1)
+	read_files_pattern($1, udev_var_run_t, udev_var_run_t)
 ')
 
+
 ########################################
 ## <summary>
 ##	Create, read, write, and delete
@@ -303,3 +372,23 @@
 	files_search_var_lib($1)
 	manage_files_pattern($1, udev_var_run_t, udev_var_run_t)
 ')
+
+########################################
+## <summary>
+##	Write dirs in /var/run with the udev_var_run file type.
+##	This method is deprecated in favor of the init_daemon_run_dir call.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+## <param name="name" optional="true">
+##	<summary>
+##	Name of the directory that the file transition will work on
+##	</summary>
+## </param>
+#
+interface(`udev_generic_pid_filetrans_run_dirs',`
+	refpolicywarn(`$0($*) has been deprecated.')
+')
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/system/udev.te refpolicy/policy/modules/system/udev.te
--- refpolicy/policy/modules/system/udev.te	2012-07-25 20:33:04.000000000 +0200
+++ refpolicy/policy/modules/system/udev.te	2012-11-12 22:53:03.222147786 +0100
@@ -1,4 +1,4 @@
-policy_module(udev, 1.15.0)
+policy_module(udev, 1.15.3)
 
 ########################################
 #
@@ -25,6 +25,7 @@
 
 type udev_var_run_t;
 files_pid_file(udev_var_run_t)
+init_daemon_run_dir(udev_var_run_t, "udev")
 
 ifdef(`enable_mcs',`
 	kernel_ranged_domtrans_to(udev_t, udev_exec_t, s0 - mcs_systemhigh)
@@ -62,8 +63,10 @@
 # read udev config
 allow udev_t udev_etc_t:file read_file_perms;
 
-# create udev database in /dev/.udevdb
-allow udev_t udev_tbl_t:file manage_file_perms;
+allow udev_t udev_tbl_t:dir relabelto;
+manage_dirs_pattern(udev_t, udev_tbl_t, udev_tbl_t)
+manage_files_pattern(udev_t, udev_tbl_t, udev_tbl_t)
+manage_lnk_files_pattern(udev_t, udev_tbl_t, udev_tbl_t)
 dev_filetrans(udev_t, udev_tbl_t, file)
 
 list_dirs_pattern(udev_t, udev_rules_t, udev_rules_t)
@@ -72,26 +75,27 @@
 manage_dirs_pattern(udev_t, udev_var_run_t, udev_var_run_t)
 manage_files_pattern(udev_t, udev_var_run_t, udev_var_run_t)
 manage_lnk_files_pattern(udev_t, udev_var_run_t, udev_var_run_t)
+manage_sock_files_pattern(udev_t, udev_var_run_t, udev_var_run_t)
 files_pid_filetrans(udev_t, udev_var_run_t, { dir file })
 
-kernel_read_system_state(udev_t)
-kernel_request_load_module(udev_t)
+kernel_dgram_send(udev_t)
 kernel_getattr_core_if(udev_t)
-kernel_use_fds(udev_t)
+kernel_load_module(udev_t)
 kernel_read_device_sysctls(udev_t)
 kernel_read_hotplug_sysctls(udev_t)
-kernel_read_modprobe_sysctls(udev_t)
 kernel_read_kernel_sysctls(udev_t)
+kernel_read_modprobe_sysctls(udev_t)
+kernel_read_network_state(udev_t)
+kernel_read_software_raid_state(udev_t)
+kernel_read_system_state(udev_t)
+kernel_request_load_module(udev_t)
 kernel_rw_hotplug_sysctls(udev_t)
-kernel_rw_unix_dgram_sockets(udev_t)
-kernel_dgram_send(udev_t)
-kernel_signal(udev_t)
-kernel_search_debugfs(udev_t)
-
 #https://bugzilla.redhat.com/bugzilla/show_bug.cgi?id=235182
 kernel_rw_net_sysctls(udev_t)
-kernel_read_network_state(udev_t)
-kernel_read_software_raid_state(udev_t)
+kernel_rw_unix_dgram_sockets(udev_t)
+kernel_search_debugfs(udev_t)
+kernel_signal(udev_t)
+kernel_use_fds(udev_t)
 
 corecmd_exec_all_executables(udev_t)
 
@@ -109,12 +113,13 @@
 domain_read_all_domains_state(udev_t)
 domain_dontaudit_ptrace_all_domains(udev_t) #pidof triggers these
 
-files_read_usr_files(udev_t)
-files_read_etc_runtime_files(udev_t)
-files_read_etc_files(udev_t)
 files_exec_etc_files(udev_t)
-files_dontaudit_search_isid_type_dirs(udev_t)
 files_getattr_generic_locks(udev_t)
+files_read_etc_files(udev_t)
+files_read_etc_runtime_files(udev_t)
+files_read_kernel_modules(udev_t)
+files_read_usr_files(udev_t)
+files_dontaudit_search_isid_type_dirs(udev_t)
 files_search_mnt(udev_t)
 
 fs_getattr_all_fs(udev_t)
@@ -152,6 +157,7 @@
 miscfiles_read_hwdata(udev_t)
 
 modutils_domtrans_insmod(udev_t)
+modutils_read_module_config(udev_t)
 # read modules.inputmap:
 modutils_read_module_deps(udev_t)
 
@@ -171,10 +177,15 @@
 
 userdom_dontaudit_search_user_home_content(udev_t)
 
+udev_pid_filetrans_db(udev_t, dir, "data")
+
 ifdef(`distro_gentoo',`
+	allow udev_t self:capability2 block_suspend;
+
 	# during boot, init scripts use /dev/.rcsysinit
 	# existance to determine if we are in early booting
 	init_getattr_script_status_files(udev_t)
+	init_domtrans_script(udev_t)
 ')
 
 ifdef(`distro_redhat',`
@@ -264,7 +275,7 @@
 ')
 
 optional_policy(`
-	pcscd_read_pub_files(udev_t)
+	pcscd_read_pid_files(udev_t)
 	pcscd_domtrans(udev_t)
 ')
 
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/system/unconfined.te refpolicy/policy/modules/system/unconfined.te
--- refpolicy/policy/modules/system/unconfined.te	2012-07-25 20:33:04.000000000 +0200
+++ refpolicy/policy/modules/system/unconfined.te	2012-09-29 18:38:34.867927617 +0200
@@ -72,6 +72,10 @@
 ')
 
 optional_policy(`
+	chromium_role(unconfined_r, unconfined_t)
+')
+
+optional_policy(`
 	cron_unconfined_role(unconfined_r, unconfined_t)
 ')
 
@@ -183,6 +187,10 @@
 ')
 
 optional_policy(`
+	rtorrent_role(unconfined_r, unconfined_t)
+')
+
+optional_policy(`
 	samba_run_net(unconfined_t, unconfined_r)
 	samba_run_winbind_helper(unconfined_t, unconfined_r)
 ')
@@ -217,7 +225,7 @@
 ')
 
 optional_policy(`
-	xserver_domtrans(unconfined_t)
+	xserver_role(unconfined_r, unconfined_t)
 ')
 
 ########################################
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/system/userdomain.if refpolicy/policy/modules/system/userdomain.if
--- refpolicy/policy/modules/system/userdomain.if	2012-05-10 15:25:34.000000000 +0200
+++ refpolicy/policy/modules/system/userdomain.if	2012-10-31 18:59:24.000579741 +0100
@@ -243,6 +243,9 @@
 	filetrans_pattern($2, user_home_dir_t, user_home_t, { dir file lnk_file sock_file fifo_file })
 	files_list_home($2)
 
+	miscfiles_manage_user_certs($2)
+	miscfiles_relabel_user_certs($2)
+
 	# cjp: this should probably be removed:
 	allow $2 user_home_dir_t:dir { manage_dir_perms relabel_dir_perms };
 
@@ -267,6 +270,24 @@
 		fs_dontaudit_manage_cifs_dirs($2)
 		fs_dontaudit_manage_cifs_files($2)
 	')
+
+	optional_policy(`
+		flash_manage_home($2)
+		flash_relabel_home($2)
+	')
+
+	optional_policy(`
+		xdg_manage_all_cache_home($2)
+		xdg_manage_all_config_home($2)
+		xdg_manage_all_data_home($2)
+		xdg_manage_all_runtime_home($2)
+		xdg_manage_downloads_home($2)
+		xdg_manage_videos_home($2)
+		xdg_relabel_all_cache_home($2)
+		xdg_relabel_all_config_home($2)
+		xdg_relabel_all_data_home($2)
+		xdg_relabel_all_runtime_home($2)
+	')	
 ')
 
 #######################################
@@ -575,6 +596,7 @@
 	')
 
 	optional_policy(`
+		alsa_home_filetrans_alsa_home($1_t, file, ".asoundrc")
 		alsa_manage_home_files($1_t)
 		alsa_read_rw_config($1_t)
 		alsa_relabel_home_files($1_t)
@@ -597,8 +619,7 @@
 		')
 
 		optional_policy(`
-			evolution_dbus_chat($1_t)
-			evolution_alarm_dbus_chat($1_t)
+			consolekit_dbus_chat($1_t)
 		')
 
 		optional_policy(`
@@ -612,6 +633,10 @@
 		optional_policy(`
 			networkmanager_dbus_chat($1_t)
 		')
+
+		optional_policy(`
+			policykit_dbus_chat($1_t)
+		')
 	')
 
 	optional_policy(`
@@ -626,9 +651,20 @@
 	')
 
 	optional_policy(`
+		kerberos_manage_krb5_home_files($1_t)
+		kerberos_relabel_krb5_home_files($1_t)
+		kerberos_home_filetrans_krb5_home($1_t, file, ".k5login")
+	')
+
+	optional_policy(`
 		locate_read_lib_files($1_t)
 	')
 
+	optional_policy(`
+		mpd_manage_user_data_content($1_t)
+		mpd_relabel_user_data_content($1_t)
+	')
+
 	# for running depmod as part of the kernel packaging process
 	optional_policy(`
 		modutils_read_module_config($1_t)
@@ -639,6 +675,10 @@
 	')
 
 	optional_policy(`
+		mysql_manage_mysqld_home_files($1_t)
+		mysql_relabel_mysqld_home_files($1_t)
+		mysql_home_filetrans_mysqld_home($1_t, file, ".my.cnf")
+
 		tunable_policy(`allow_user_mysql_connect',`
 			mysql_stream_connect($1_t)
 		')
@@ -647,6 +687,7 @@
 	optional_policy(`
 		oident_manage_user_content($1_t)
 		oident_relabel_user_content($1_t)
+		oident_home_filetrans_oidentd_home($1_t, file, ".oidentd.conf")
 	')
 
 	optional_policy(`
@@ -655,7 +696,7 @@
 	')
 
 	optional_policy(`
-		pcscd_read_pub_files($1_t)
+		pcscd_read_pid_files($1_t)
 		pcscd_stream_connect($1_t)
 	')
 
@@ -667,6 +708,12 @@
 	')
 
 	optional_policy(`
+		ppp_manage_home_files($1_t)
+		ppp_relabel_home_files($1_t)
+		ppp_home_filetrans_ppp_home($1_t, file, ".ppprc")
+	')
+
+	optional_policy(`
 		resmgr_stream_connect($1_t)
 	')
 
@@ -906,6 +953,18 @@
 		optional_policy(`
 			cups_dbus_chat($1_t)
 		')
+
+		optional_policy(`
+			gnome_role_template($1, $1_r, $1_t)
+		')
+
+		optional_policy(`
+			gnome_role_template($1, $1_r, $1_t)
+		')
+
+		optional_policy(`
+			wm_role_template($1, $1_r, $1_t)
+		')
 	')
 
 	optional_policy(`
diff -uNr -x '.git*' -x CVS -x '*.autogen*' -x '*.part' refpolicy/policy/modules/system/userdomain.te refpolicy/policy/modules/system/userdomain.te
--- refpolicy/policy/modules/system/userdomain.te	2012-07-25 20:33:04.000000000 +0200
+++ refpolicy/policy/modules/system/userdomain.te	2012-10-31 18:59:26.419579746 +0100
@@ -1,4 +1,4 @@
-policy_module(userdomain, 4.8.0)
+policy_module(userdomain, 4.8.3)
 
 ########################################
 #
